var K=Object.defineProperty;var f=(a,e)=>K(a,"name",{value:e,configurable:!0});var G="registered as custom element";function U(a,e){console.warn(`missing implementation for ${e}(...data) in ${a.__proto__.constructor.name}`)}f(U,"NotImplemented");function C(a){return a.prototype.constructor.name.replace(/([A-Z])([a-z])/g,(e,r,t,$)=>{let x=`${r.toLowerCase()}${t}`;return $>0?`-${x}`:x})}f(C,"getElementTagName");var h=class extends HTMLElement{static{f(this,"CustomElement")}static register(e){if(!e[G]){let r=e.tagName||C(e);return customElements.define(r,e),e[G]=!0,customElements.whenDefined(r)}return Promise.resolve()}static get tagName(){return C(this)}constructor(e={}){super(),customElements.resolveScope||(customElements.resolveScope=function($){try{return $.getRootNode().host}catch(x){console.warn(x)}return window}),this._options=e;let r={childList:$=>{this.handleChildChanges(Array.from($.addedNodes),Array.from($.removedNodes)),this.render()},attributes:$=>{this.handleAttributeChange($.attributeName,$.oldValue,this.getAttribute($.attributeName)),this.render()}};this._observer=new MutationObserver($=>{this.isConnected&&$.forEach(x=>{r[x.type](x)})}),this._observer.observe(this,{childList:!0,attributes:!0});let t={mode:"open"};this._shadow=this.attachShadow(t),this._style=document.createElement("style"),this._style.textContent=this.getStyle(),this._options.header!==!1&&(this._header=document.createElement("header")),this._options.slot!==!1&&this._options.void!==!0&&(this._slot=document.createElement("slot")),this._options.footer!==!1&&(this._footer=document.createElement("footer"))}connectedCallback(){this.render()}handleChildChanges(e,r){this._options.void||U(this,"handleChildChanges")}handleAttributeChange(e,r,t){U(this,"handleAttributeChange")}getStyle(){return""}render(){this._shadow.innerHTML="",this._shadow.append(this._style),this._options.header!==!1&&this._shadow.append(this._header),this._options.slot!==!1&&this._shadow.append(this._slot),this._options.footer!==!1&&this._shadow.append(this._footer)}};var D=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREEN","DARKGREY","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREEN","GREENYELLOW","GREY","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREEN","LIGHTGREY","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TRANSPARENT","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN"],v={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(128, 128, 128)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",transparent:"rgba(0,0,0,0)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",ALICEBLUE:"rgb(240, 248, 255)",ANTIQUEWHITE:"rgb(250, 235, 215)",AQUA:"rgb(0, 255, 255)",AQUAMARINE:"rgb(127, 255, 212)",AZURE:"rgb(240, 255, 255)",BEIGE:"rgb(245, 245, 220)",BISQUE:"rgb(255, 228, 196)",BLACK:"rgb(0, 0, 0)",BLANCHEDALMOND:"rgb(255, 235, 205)",BLUE:"rgb(0, 0, 255)",BLUEVIOLET:"rgb(138, 43, 226)",BROWN:"rgb(165, 42, 42)",BURLYWOOD:"rgb(222, 184, 135)",CADETBLUE:"rgb(95, 158, 160)",CHARTREUSE:"rgb(127, 255, 0)",CHOCOLATE:"rgb(210, 105, 30)",CORAL:"rgb(255, 127, 80)",CORNFLOWERBLUE:"rgb(100, 149, 237)",CORNSILK:"rgb(255, 248, 220)",CRIMSON:"rgb(220, 20, 60)",CYAN:"rgb(0, 255, 255)",DARKBLUE:"rgb(0, 0, 139)",DARKCYAN:"rgb(0, 139, 139)",DARKGOLDENROD:"rgb(184, 134, 11)",DARKGRAY:"rgb(169, 169, 169)",DARKGREEN:"rgb(0, 100, 0)",DARKGREY:"rgb(169, 169, 169)",DARKKHAKI:"rgb(189, 183, 107)",DARKMAGENTA:"rgb(139, 0, 139)",DARKOLIVEGREEN:"rgb(85, 107, 47)",DARKORANGE:"rgb(255, 140, 0)",DARKORCHID:"rgb(153, 50, 204)",DARKRED:"rgb(139, 0, 0)",DARKSALMON:"rgb(233, 150, 122)",DARKSEAGREEN:"rgb(143, 188, 143)",DARKSLATEBLUE:"rgb(72, 61, 139)",DARKSLATEGRAY:"rgb(47, 79, 79)",DARKSLATEGREY:"rgb(47, 79, 79)",DARKTURQUOISE:"rgb(0, 206, 209)",DARKVIOLET:"rgb(148, 0, 211)",DEEPPINK:"rgb(255, 20, 147)",DEEPSKYBLUE:"rgb(0, 191, 255)",DIMGRAY:"rgb(105, 105, 105)",DIMGREY:"rgb(105, 105, 105)",DODGERBLUE:"rgb(30, 144, 255)",FIREBRICK:"rgb(178, 34, 34)",FLORALWHITE:"rgb(255, 250, 240)",FORESTGREEN:"rgb(34, 139, 34)",FUCHSIA:"rgb(255, 0, 255)",GAINSBORO:"rgb(220, 220, 220)",GHOSTWHITE:"rgb(248, 248, 255)",GOLD:"rgb(255, 215, 0)",GOLDENROD:"rgb(218, 165, 32)",GRAY:"rgb(128, 128, 128)",GREEN:"rgb(0, 128, 0)",GREENYELLOW:"rgb(173, 255, 47)",GREY:"rgb(128, 128, 128)",HONEYDEW:"rgb(240, 255, 240)",HOTPINK:"rgb(255, 105, 180)",INDIANRED:"rgb(205, 92, 92)",INDIGO:"rgb(75, 0, 130)",IVORY:"rgb(255, 255, 240)",KHAKI:"rgb(240, 230, 140)",LAVENDER:"rgb(230, 230, 250)",LAVENDERBLUSH:"rgb(255, 240, 245)",LAWNGREEN:"rgb(124, 252, 0)",LEMONCHIFFON:"rgb(255, 250, 205)",LIGHTBLUE:"rgb(173, 216, 230)",LIGHTCORAL:"rgb(240, 128, 128)",LIGHTCYAN:"rgb(224, 255, 255)",LIGHTGOLDENRODYELLOW:"rgb(250, 250, 210)",LIGHTGRAY:"rgb(211, 211, 211)",LIGHTGREEN:"rgb(144, 238, 144)",LIGHTGREY:"rgb(211, 211, 211)",LIGHTPINK:"rgb(255, 182, 193)",LIGHTSALMON:"rgb(255, 160, 122)",LIGHTSEAGREEN:"rgb(32, 178, 170)",LIGHTSKYBLUE:"rgb(135, 206, 250)",LIGHTSLATEGRAY:"rgb(119, 136, 153)",LIGHTSLATEGREY:"rgb(119, 136, 153)",LIGHTSTEELBLUE:"rgb(176, 196, 222)",LIGHTYELLOW:"rgb(255, 255, 224)",LIME:"rgb(0, 255, 0)",LIMEGREEN:"rgb(50, 205, 50)",LINEN:"rgb(250, 240, 230)",MAGENTA:"rgb(255, 0, 255)",MAROON:"rgb(128, 0, 0)",MEDIUMAQUAMARINE:"rgb(102, 205, 170)",MEDIUMBLUE:"rgb(0, 0, 205)",MEDIUMORCHID:"rgb(186, 85, 211)",MEDIUMPURPLE:"rgb(147, 112, 219)",MEDIUMSEAGREEN:"rgb(60, 179, 113)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",MEDIUMSPRINGGREEN:"rgb(0, 250, 154)",MEDIUMTURQUOISE:"rgb(72, 209, 204)",MEDIUMVIOLETRED:"rgb(199, 21, 133)",MIDNIGHTBLUE:"rgb(25, 25, 112)",MINTCREAM:"rgb(245, 255, 250)",MISTYROSE:"rgb(255, 228, 225)",MOCCASIN:"rgb(255, 228, 181)",NAVAJOWHITE:"rgb(255, 222, 173)",NAVY:"rgb(0, 0, 128)",OLDLACE:"rgb(253, 245, 230)",OLIVE:"rgb(128, 128, 0)",OLIVEDRAB:"rgb(107, 142, 35)",ORANGE:"rgb(255, 165, 0)",ORANGERED:"rgb(255, 69, 0)",ORCHID:"rgb(218, 112, 214)",PALEGOLDENROD:"rgb(238, 232, 170)",PALEGREEN:"rgb(152, 251, 152)",PALETURQUOISE:"rgb(175, 238, 238)",PALEVIOLETRED:"rgb(219, 112, 147)",PAPAYAWHIP:"rgb(255, 239, 213)",PEACHPUFF:"rgb(255, 218, 185)",PERU:"rgb(205, 133, 63)",PINK:"rgb(255, 192, 203)",PLUM:"rgb(221, 160, 221)",POWDERBLUE:"rgb(176, 224, 230)",PURPLE:"rgb(128, 0, 128)",REBECCAPURPLE:"rgb(102, 51, 153)",RED:"rgb(255, 0, 0)",ROSYBROWN:"rgb(188, 143, 143)",ROYALBLUE:"rgb(65, 105, 225)",SADDLEBROWN:"rgb(139, 69, 19)",SALMON:"rgb(250, 128, 114)",SANDYBROWN:"rgb(244, 164, 96)",SEAGREEN:"rgb(46, 139, 87)",SEASHELL:"rgb(255, 245, 238)",SIENNA:"rgb(160, 82, 45)",SILVER:"rgb(192, 192, 192)",SKYBLUE:"rgb(135, 206, 235)",SLATEBLUE:"rgb(106, 90, 205)",SLATEGRAY:"rgb(112, 128, 144)",SLATEGREY:"rgb(112, 128, 144)",SNOW:"rgb(255, 250, 250)",SPRINGGREEN:"rgb(0, 255, 127)",STEELBLUE:"rgb(70, 130, 180)",TAN:"rgb(210, 180, 140)",TEAL:"rgb(0, 128, 128)",THISTLE:"rgb(216, 191, 216)",TOMATO:"rgb(255, 99, 71)",TRANSPARENT:"rgba(0,0,0,0)",TURQUOISE:"rgb(64, 224, 208)",VIOLET:"rgb(238, 130, 238)",WHEAT:"rgb(245, 222, 179)",WHITE:"rgb(255, 255, 255)",WHITESMOKE:"rgb(245, 245, 245)",YELLOW:"rgb(255, 255, 0)",YELLOWGREEN:"rgb(154, 205, 50)"};function y(a,e,r,t,$,A,l){var i,n,s,o,g=r.length,c=r[0].length;if(e<1)throw new Error("degree must be at least 1 (linear)");if(e>g-1)throw new Error("degree must be less than or equal to point count - 1");if(!$)for($=[],i=0;i<g;i++)$[i]=1;if($.length<r.length&&($=$.concat($.slice(0,e))),t){if(t.length!==g+e+1)throw new Error("bad knot vector length")}else{var t=[];for(i=0;i<g+e+1;i++)t[i]=i}t.length===r.length&&(t=t.concat(t.slice(0,e)));var b=[e,t.length-1-e],L=t[b[0]],u=t[b[1]];if(l||(a=a*(u-L)+L),a<L||a>u)throw new Error("out of bounds");for(s=b[0];s<b[1]&&!(a>=t[s]&&a<=t[s+1]);s++);var d=[];for(i=0;i<g;i++){for(d[i]=[],n=0;n<c;n++)d[i][n]=r[i][n]*$[i];d[i][c]=$[i]}var m;for(o=1;o<=e+1;o++)for(i=s;i>s-e-1+o;i--)for(m=(a-t[i])/(t[i+e+1-o]-t[i]),n=0;n<c+1;n++)d[i][n]=(1-m)*d[i-1][n]+m*d[i][n];var A=A||[];for(i=0;i<c;i++)A[i]=d[s][i]/d[s][c];return A}f(y,"interpolate");var E=3,p=class{static{f(this,"BSpline")}constructor(e,r=!0){this.points=e,this.points=e.map(t=>t instanceof Array?t:[t.x,t.y]),this.formKnots(r),this.formWeights()}getLUT(e=100){let r=e-1;return[...new Array(e)].map((t,$)=>{let x=y($/r,E,this.points,this.knots,this.weights);return{x:x[0],y:x[1]}})}formKnots(e=!1){if(!e)return this.formUniformKnots();let r=[],t=this.points.length,$=t-E;for(let x=1;x<t-E;x++)r.push(x+E);for(let x=0;x<=E;x++)r=[E].concat(r);for(let x=0;x<=E;x++)r.push($+E);return this.knots=r}formUniformKnots(){return this.knots=[...new Array(this.points.length+E+1)].map((e,r)=>r)}formWeights(){return this.weights=this.points.map(e=>1)}};var R=class{static{f(this,"Point")}constructor(e,r){this.x=e,this.y=r}},O=class extends R{static{f(this,"Circle")}constructor(e,r,t){super(e,r),this.r=t}};var I=class a{static{f(this,"Vector")}constructor(e,r,t){arguments.length===1&&(t=e.z,r=e.y,e=e.x),this.x=e,this.y=r,t!==void 0&&(this.z=t)}dist(e,r,t=0){r!==void 0&&(e={x:e,y:r,z:t});let $=0;$+=(this.x-e.x)**2,$+=(this.y-e.y)**2;let x=this.z?this.z:0,l=e.z?e.z:0;return $+=(x-l)**2,$**.5}normalize(e){let r=this.dist(0,0,0);return new a(e*this.x/r,e*this.y/r,e*this.z/r)}getAngle(){return-Math.atan2(this.y,this.x)}reflect(e){let r=new a(e.x-this.x,e.y-this.y);return e.z!==void 0&&(r.z=e.z,this.z!==void 0&&(r.z-=this.z)),this.subtract(r)}add(e){let r=new a(this.x+e.x,this.y+e.y);return this.z!==void 0&&(r.z=this.z,e.z!==void 0&&(r.z+=e.z)),r}subtract(e){let r=new a(this.x-e.x,this.y-e.y);return this.z!==void 0&&(r.z=this.z,e.z!==void 0&&(r.z-=e.z)),r}scale(e=1){if(e===0)return new a(0,0,this.z===void 0?void 0:0);let r=new a(this.x*e,this.y*e);return this.z!==void 0&&(r.z=this.z*e),r}};function Y(a){if(a.length!==a[0].length){console.warn("Cannot invert non-square matrices");return}var e=0,r=0,t=0,$=a.length,x=0,l=0,i=[],n=[];for(e=0;e<$;e+=1)for(i[i.length]=[],n[n.length]=[],t=0;t<$;t+=1)e==t?i[e][t]=1:i[e][t]=0,n[e][t]=a[e][t];for(e=0;e<$;e+=1){if(x=n[e][e],x==0){for(r=e+1;r<$;r+=1)if(n[r][e]!=0){for(t=0;t<$;t++)x=n[e][t],n[e][t]=n[r][t],n[r][t]=x,x=i[e][t],i[e][t]=i[r][t],i[r][t]=x;break}if(x=n[e][e],x==0)return}for(t=0;t<$;t++)n[e][t]=n[e][t]/x,i[e][t]=i[e][t]/x;for(r=0;r<$;r++)if(r!=e)for(x=n[r][e],t=0;t<$;t++)n[r][t]-=x*n[e][t],i[r][t]-=x*i[e][t]}return i}f(Y,"invert");function P(a,e){var r=[],t=M(e);return a.forEach(($,x)=>{r[x]=[],t.forEach((l,i)=>{r[x][i]=$.map((n,s)=>l[s]*n).reduce((n,s)=>n+s,0)})}),r}f(P,"multiply");function M(a){return a[0].map((e,r)=>a.map(t=>t[r]))}f(M,"transpose");var N=class a{static{f(this,"Matrix")}constructor(e,r,t){t=e instanceof Array?e:t,this.data=t??[...new Array(e)].map($=>[...new Array(r)].map(x=>0)),this.rows=this.data.length,this.cols=this.data[0].length}setData(e){this.data=e}get(e,r){return this.data[e][r]}set(e,r,t){this.data[e][r]=t}row(e){return this.data[e]}col(e){var r=this.data,t=[];for(let $=0,x=r.length;$<x;$++)t.push(r[$][e]);return t}multiply(e){return new a(P(this.data,e.data))}invert(){return new a(Y(this.data))}transpose(){return new a(M(this.data))}};function S(a){let e=new TextEncoder().encode(a),r=String.fromCodePoint(...e);return btoa(r)}f(S,"base64");function H(a){let e=atob(a),r=Uint8Array.from(e,t=>t.codePointAt(0));return new TextDecoder().decode(r)}f(H,"decode64");function k(a){let e=/^(.*)\/([^.]+(\.([^\/?#]+))+)(\?[^#]*)?(#.*)?$/,r=a.match(e);if(r!==null){let{[1]:t,[2]:$,[4]:x}=r;a=t}return a}f(k,"getURLbase");function B(a){if(typeof window>"u"||typeof document>"u")return!0;var e=a.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}f(B,"isInViewport");var _=String(import.meta.url),W=H("Y29uc3QgQUxQSEFCRVRJQyA9IGBhbHBoYWJldGljYDsKY29uc3QgQVVUTyA9IGBhdXRvYDsKY29uc3QgQk9UVE9NID0gYGJvdHRvbWA7CmNvbnN0IEJPVFRPTV9MRUZUID0gYGJvdHRvbi1sZWZ0YDsKY29uc3QgQk9UVE9NX1JJR0hUID0gYGJvdHRvbS1yaWdodGA7CmNvbnN0IENFTlRFUiA9IGBjZW50ZXJgOwpjb25zdCBDT05TVFJBSU4gPSB0cnVlOwpjb25zdCBDUk9TUyA9IGBjcm9zc2hhaXJgOwpjb25zdCBFTkQgPSBgZW5kYDsKY29uc3QgSEFORCA9IGBwb2ludGVyYDsKY29uc3QgSEFOR0lORyA9IGBoYW5naW5nYDsKY29uc3QgSURFT0dSQVBISUMgPSBgaWRlb2dyYXBoaWNgOwpjb25zdCBMRUZUID0gYGxlZnRgOwpjb25zdCBNSURETEUgPSBgbWlkZGxlYDsKY29uc3QgUE9JTlRFUiA9IGBkZWZhdWx0YDsKY29uc3QgUklHSFQgPSBgcmlnaHRgOwpjb25zdCBTVEFSVCA9IGBzdGFydGA7CmNvbnN0IFRPUCA9IGB0b3BgOwpjb25zdCBUT1BfTEVGVCA9IGB0b3AtbGVmdGA7CmNvbnN0IFRPUF9SSUdIVCA9IGB0b3AtcmlnaHRgOwoKY29uc3QgcG9pbnRlciA9IHsgeDogMCwgeTogMCB9Owpjb25zdCBrZXlib2FyZCA9IHt9OwoKLy8gbWF0aCBmdW5jdGlvbnMgYW5kIGNvbnN0YW50cwpjb25zdCB7CiAgYWJzLAogIGFjb3MsCiAgYWNvc2gsCiAgYXNpbiwKICBhc2luaCwKICBhdGFuLAogIGF0YW4yLAogIGF0YW5oLAogIGNicnQsCiAgY2VpbCwKICBjbHozMiwKICBjb3MsCiAgY29zaCwKICBleHAsCiAgZXhwbTEsCiAgZmxvb3IsCiAgZnJvdW5kLAogIGh5cG90LAogIGltdWwsCiAgbG9nOiBsbiwKICBsb2cxMDogbG9nLAogIGxvZzIsCiAgbWF4LAogIG1pbiwKICBwb3csCiAgcm91bmQsCiAgc2lnbiwKICBzaW4sCiAgc2luaCwKICBzcXJ0LAogIHRhbiwKICB0YW5oLAogIHRydW5jLAp9ID0gTWF0aDsKCmNvbnN0IHsgUEksIEUgfSA9IE1hdGg7CgpmdW5jdGlvbiBjb25zdHJhaW4odiwgcywgZSkgewogIHJldHVybiB2IDwgcyA/IHMgOiB2ID4gZSA/IGUgOiB2Owp9CgpmdW5jdGlvbiBjc2ModikgewogIHJldHVybiAxIC8gc2luKHYpOwp9CgpmdW5jdGlvbiBjdG4odikgewogIHJldHVybiBjb3ModikgLyBzaW4odik7Cn0KCmZ1bmN0aW9uIGRlZ3JlZXModiwgY29uc3RyYWluKSB7CiAgbGV0IGQgPSAodiAvIFBJKSAqIDE4MDsKICBpZiAoIWNvbnN0cmFpbikgcmV0dXJuIGQ7CiAgd2hpbGUgKGQgPCAwKSBkICs9IDM2MDsKICByZXR1cm4gZCAlIDM2MDsKfQoKZnVuY3Rpb24gZGlzdCh4MSwgeTEsIHgyLCB5MikgewogIHJldHVybiAoKHgyIC0geDEpICoqIDIgKyAoeTIgLSB5MSkgKiogMikgKiogMC41Owp9Cgpjb25zdCBlcHNpbG9uID0gMWUtMTA7Cgpjb25zdCBodWdlID0gMV8wMDBfMDAwOwoKZnVuY3Rpb24gbWFwKHYsIHMsIGUsIG5zLCBuZSwgY29uc3RyYWluZWQgPSBmYWxzZSkgewogIGNvbnN0IGkxID0gZSAtIHMsCiAgICBpMiA9IG5lIC0gbnMsCiAgICBwID0gdiAtIHM7CiAgbGV0IHIgPSBucyArIChwICogaTIpIC8gaTE7CiAgaWYgKGNvbnN0cmFpbmVkKSByZXR1cm4gY29uc3RyYWluKHIsIG5zLCBuZSk7CiAgcmV0dXJuIHI7Cn0KCmZ1bmN0aW9uIHJhZGlhbnModikgewogIGxldCByID0gKHYgLyAxODApICogUEk7CiAgaWYgKCFjb25zdHJhaW4pIHJldHVybiByOwogIHdoaWxlIChyIDwgMCkgciArPSBUQVU7CiAgcmV0dXJuIHIgJSBUQVU7Cn0KCmZ1bmN0aW9uIHJhbmRvbShhID0gMSwgYikgewogIGlmIChiID09PSB1bmRlZmluZWQpIHJldHVybiBhICogTWF0aC5yYW5kb20oKTsKICByZXR1cm4gYSArIE1hdGgucmFuZG9tKCkgKiAoYiAtIGEpOwp9Cgpjb25zdCBzZWMgPSAodikgPT4gMSAvIGNvcyh2KTsKCmNvbnN0IFRBVSA9IFBJICogMjsKCi8vICJwdWJsaWMiIHZhcnMKbGV0IGN1cnJlbnRQb2ludDsKbGV0IGZyYW1lOwpsZXQgZnJhbWVEZWx0YTsKbGV0IGhlaWdodDsKbGV0IHdpZHRoOwpsZXQgcGxheWluZzsKCi8vICJpbnRlcm5hbCIgdmFycwoKbGV0IF9fY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgY2FudmFzYCk7Cl9fY2FudmFzLnRhYkluZGV4ID0gMDsKX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihgcG9pbnRlcmRvd25gLCAoKSA9PiBfX2NhbnZhcy5mb2N1cygpKTsKbGV0IF9fY3R4ID0gX19jYW52YXMuZ2V0Q29udGV4dChgMmRgKTsKCmxldCBfX2N1cnJlbnRfY3Vyc29yOwpsZXQgX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvcjsKbGV0IF9fY3VycmVudF9odWU7CmxldCBfX2RyYXdfZ3JpZDsKbGV0IF9fZHJhd2luZzsKbGV0IF9fZWxlbWVudDsKbGV0IF9fZmluaXNoZWRfc2V0dXA7CmxldCBfX2ZpcnN0OwpsZXQgX19mb250OwpsZXQgX19ncmlkX2NvbG9yOwpsZXQgX19ncmlkX3NwYWNpbmc7CmxldCBfX2hpZ2hsaWdodF9jb2xvcjsKbGV0IF9fbW92YWJsZV9wb2ludHM7CmxldCBfX3JlZHJhd2luZzsKbGV0IF9fc3RhcnRfdGltZTsKbGV0IF9fc3R5bGVfc3RhY2s7CmxldCBfX3RleHRTdHJva2U7CmxldCBfX2xhc3RfZnJhbWU7CgpmdW5jdGlvbiBmaW5kKHFzKSB7CiAgcmV0dXJuIF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKHFzKTsKfQoKZnVuY3Rpb24gZmluZEFsbChxcykgewogIHJldHVybiBfX2VsZW1lbnQucXVlcnlTZWxlY3RvckFsbChxcyk7Cn0KCmFzeW5jIGZ1bmN0aW9uIHJlc2V0KGVsZW1lbnQgPSBfX2VsZW1lbnQpIHsKICBfX2VsZW1lbnQgPSBlbGVtZW50OwoKICAvLyBkZWZhdWx0IHZhcmlhYmxlIHZhbHVlcwogIF9fY3VycmVudF9jdXJzb3IgPSBgYXV0b2A7CiAgX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvciA9IGByZ2IoMCwyNTQsMTI0KWA7CiAgX19jdXJyZW50X2h1ZSA9IDA7CiAgX19kcmF3X2dyaWQgPSB0cnVlOwogIF9fZHJhd2luZyA9IGZhbHNlOwogIF9fZmluaXNoZWRfc2V0dXAgPSBmYWxzZTsKICBfX2ZvbnQgPSB7IGZhbWlseTogYHNhbnMtc2VyaWZgLCBzaXplOiAxNiwgd2VpZ2h0OiA0MDAgfTsKICBfX2dyaWRfY29sb3IgPSBgbGlnaHRncmV5YDsKICBfX2dyaWRfc3BhY2luZyA9IDIwOwogIF9faGlnaGxpZ2h0X2NvbG9yID0gZmFsc2U7CiAgX19tb3ZhYmxlX3BvaW50cyA9IFtdOwogIF9fcmVkcmF3aW5nID0gZmFsc2U7CiAgX19zdGFydF90aW1lID0gRGF0ZS5ub3coKTsKICBfX3N0eWxlX3N0YWNrID0gW107CiAgX190ZXh0U3Ryb2tlID0gYHRyYW5zcGFyZW50YDsKCiAgY3VycmVudFBvaW50ID0gZmFsc2U7CiAgcGxheWluZyA9IGZhbHNlOwogIGZyYW1lID0gMDsKICBwb2ludGVyLnggPSAwOwogIHBvaW50ZXIueSA9IDA7CiAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoa2V5Ym9hcmQpLmZvckVhY2goKG4pID0+IGRlbGV0ZSBrZXlib2FyZFtuXSk7CgogIC8vIG1ha2Ugc3VyZSB3ZSBkb24ndCBkb3VibGUtZ2VuZXJhdGUgdGhlc2U6CiAgY2xlYXJTbGlkZXJzKCk7CiAgY2xlYXJCdXR0b25zKCk7CgogIC8vIHJ1biBzZXR1cAogIGF3YWl0IF9fc2V0dXAoKTsKICBfX2ZpbmlzaGVkX3NldHVwID0gdHJ1ZTsKCiAgLy8gcnVuIGZpcnN0IGRyYXcKICBfX2xhc3RfZnJhbWUgPSBEYXRlLm5vdygpOwogIGF3YWl0IF9fZHJhdygpOwoKICByZXR1cm4geyB3aWR0aCwgaGVpZ2h0IH07Cn0KCmZ1bmN0aW9uIGhhbHQoKSB7CiAgcGxheWluZyA9IGZhbHNlOwogIF9fY2FudmFzID0gdW5kZWZpbmVkOwogIF9fY3R4ID0gdW5kZWZpbmVkOwogIF9fZmluaXNoZWRfc2V0dXAgPSBmYWxzZTsKICBfX2RyYXdpbmcgPSB0cnVlOwogIF9fcmVkcmF3aW5nID0gdHJ1ZTsKICBfX2ZpcnN0ID0gdW5kZWZpbmVkOwogIF9fbW92YWJsZV9wb2ludHMgPSB1bmRlZmluZWQ7CiAgX19jdXJyZW50X2N1cnNvciA9IHVuZGVmaW5lZDsKICBfX2N1cnJlbnRfaHVlID0gMDsKICBfX2ZvbnQgPSB1bmRlZmluZWQ7CiAgX19zdGFydF90aW1lID0gMDsKICBjbGVhclNsaWRlcnMoKTsKICBjbGVhckJ1dHRvbnMoKTsKfQoKZnVuY3Rpb24gX19nZXREZXNjcmlwdGlvbigpIHsKICBpZiAodHlwZW9mIGdldERlc2NyaXB0aW9uICE9PSBgdW5kZWZpbmVkYCkgcmV0dXJuIGdldERlc2NyaXB0aW9uKCk7Cn0KCmFzeW5jIGZ1bmN0aW9uIF9fc2V0dXAoKSB7CiAgaWYgKHR5cGVvZiBzZXR1cCAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IHNldHVwKCk7CiAgaWYgKHR5cGVvZiBfX21vcmVfc2V0dXAgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBfX21vcmVfc2V0dXAoKTsKICBpZiAoIXdpZHRoICYmICFoZWlnaHQpIHNldFNpemUoKTsKfQoKZnVuY3Rpb24gc2V0U2l6ZSh3ID0gNDAwLCBoID0gMjAwKSB7CiAgd2lkdGggPSBfX2NhbnZhcy53aWR0aCA9IHc7CiAgaGVpZ2h0ID0gX19jYW52YXMuaGVpZ2h0ID0gaDsKICBfX2VsZW1lbnQuc3R5bGUubWF4V2lkdGggPSBgY2FsYygyZW0gKyAke3dpZHRofXB4YDsKICBfX2N0eCA9IF9fY2FudmFzLmdldENvbnRleHQoYDJkYCk7CiAgX19kcmF3KCk7Cn0KCmFzeW5jIGZ1bmN0aW9uIF9fZHJhdygpIHsKICBpZiAoIV9fZmluaXNoZWRfc2V0dXApIHJldHVybjsKICBpZiAoIV9fZHJhd2luZykgewogICAgX19kcmF3aW5nID0gdHJ1ZTsKICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CiAgICBmcmFtZURlbHRhID0gbm93IC0gX19sYXN0X2ZyYW1lOwogICAgZnJhbWUrKzsKICAgIHJlc2V0VHJhbnNmb3JtKCk7CiAgICBpZiAodHlwZW9mIGRyYXcgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBkcmF3KCk7CiAgICBpZiAodHlwZW9mIF9fbW9yZV9kcmF3ICE9PSBgdW5kZWZpbmVkYCkgYXdhaXQgX19tb3JlX2RyYXcoKTsKICAgIF9fZHJhd2luZyA9IGZhbHNlOwogICAgX19sYXN0X2ZyYW1lID0gbm93OwogICAgaWYgKHBsYXlpbmcpIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBfX2RyYXcoKSk7CiAgfQp9CgpmdW5jdGlvbiByZWRyYXcoKSB7CiAgaWYgKF9fcmVkcmF3aW5nKSByZXR1cm47CiAgaWYgKHBsYXlpbmcpIHJldHVybjsKICBfX3JlZHJhd2luZyA9IHRydWU7CiAgX19kcmF3KCk7CiAgX19yZWRyYXdpbmcgPSBmYWxzZTsKfQovKioKICogRW5zdXJlIHRoYXQgdGhlcmUgaXMgbm8gYm9yZGVyIGFyb3VuZCB0aGUgY2FudmFzIGVsZW1lbnQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEJvcmRlcig1LCBgcmVkYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgdGV4dChgY2xpY2sgbWVgLCB3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyVXAoeCwgeSkgewogKiAgICAgICBzZXRCb3JkZXIoNSwgYHJlZGApOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCwgeSkgewogKiAgICAgICBub0JvcmRlcigpOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldEJvcmRlcn0KICovCmZ1bmN0aW9uIG5vQm9yZGVyKCkgewogIHNldEJvcmRlcihmYWxzZSk7Cn0KCi8qKgogKiBEaXNhYmxlIGJvdGggc3Ryb2tlIGFuZCBmaWxsIGNvbG9yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoYE5vdyB5b3Ugc2VlIG1lYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vQ29sb3IoKTsKICogICAgICAgdGV4dChgTm93IHlvdSBkb24ndGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldENvbG9yfQogKiBAc2VlIHtAbGluayBub1N0cm9rZX0KICogQHNlZSB7QGxpbmsgbm9GaWxsfQogKi8KZnVuY3Rpb24gbm9Db2xvcigpIHsKICBub0ZpbGwoKTsKICBub1N0cm9rZSgpOwp9CgovKioKICogSGlkZSB0aGUgY3Vyc29yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGAjRkYwMmApOwogKiAgICAgICByZWN0KDAsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIHNldENvbG9yKGAjMEZGMmApOwogKiAgICAgICByZWN0KHdpZHRoLzIsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSh4LCB5KSB7CiAqICAgICAgIGlmICh4IDwgd2lkdGgvMikgewogKiAgICAgICAgIHNldEN1cnNvcihBVVRPKTsKICogICAgICAgfSBlbHNlIHsKICogICAgICAgICBub0N1cnNvcigpOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIG5vQ3Vyc29yKCkgewogIF9fY2FudmFzLnN0eWxlLmN1cnNvciA9IGBub25lYDsKfQoKLyoqCiAqIERpc2FibGUgdGhlIGZpbGwgY29sb3IuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKDEpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcmVjdCgyMCwgNzAsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYGZpbGxlZGAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgcmVjdCgzMCwgODAsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYG5vdCBmaWxsZWRgLCB3aWR0aC8yLCBoZWlnaHQvMiArIDI1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKi8KZnVuY3Rpb24gbm9GaWxsKCkgewogIHNldEZpbGwoYHRyYW5zcGFyZW50YCk7Cn0KCi8qKgogKiBEaXNhYmxlIHRoZSBkZWZhdWx0IGdyaWQgYmFja2dyb3VuZC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KGBjbGljayBtZWAsIHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJVcCh4LCB5KSB7CiAqICAgICAgIHNldEdyaWQoMjAsIGBsaWdodGdyZXlgKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgsIHkpIHsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICAgIHJlZHJhdygpCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIG5vR3JpZCgpIHsKICBfX2RyYXdfZ3JpZCA9IGZhbHNlOwp9CgovKioKICogU2V0IHRoZSBsaW5lIHN0cm9rZSB0byAic29saWQiLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRMaW5lRGFzaCgxKTsKICogICAgICAgbGluZSgwLDIwLHdpZHRoLDUwKTsKICogICAgICAgc2V0TGluZURhc2goNSk7CiAqICAgICAgIGxpbmUoMCwzMCx3aWR0aCw5MCk7CiAqICAgICAgIHNldExpbmVEYXNoKDEsMiwzLDQpOwogKiAgICAgICBsaW5lKDAsNDAsd2lkdGgsMTMwKTsKICogICAgICAgbm9MaW5lRGFzaCgpOwogKiAgICAgICBsaW5lKDAsNTAsd2lkdGgsMTgwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKi8KZnVuY3Rpb24gbm9MaW5lRGFzaCgpIHsKICBfX2N0eC5zZXRMaW5lRGFzaChbXSk7Cn0KCi8qKgogKiBEaXNhYmxlIHRoZSBzdHJva2UgY29sb3IuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKDEpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgcmVjdCgyMCwgNzAsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYHN0cm9rZWRgLCB3aWR0aC8yLCBoZWlnaHQvMiAtIDI1KTsKICogICAgICAgbm9TdHJva2UoKTsKICogICAgICAgcmVjdCg0MiwgODIsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYG5vdCBzdHJva2VkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgKyAyNSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIG5vU3Ryb2tlKCkgewogIHNldFN0cm9rZShgdHJhbnNwYXJlbnRgKTsKfQoKLyoqCiAqIERpc2FibGUgdGV4dCBzdHJva2luZywgYnV0IG5vdCByZWd1bGFyIHNoYXBlIHN0cm9raW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dFN0cm9rZSgxKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHJlY3QoMjAsIDcwLCAyMCwgMjApOwogKiAgICAgICB0ZXh0KGBzdHJva2VkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vVGV4dFN0cm9rZSgpOwogKiAgICAgICByZWN0KDQyLCA4MiwgMjAsIDIwKTsKICogICAgICAgdGV4dChgbm90IHN0cm9rZWRgLCB3aWR0aC8yLCBoZWlnaHQvMiArIDI1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKi8KZnVuY3Rpb24gbm9UZXh0U3Ryb2tlKCkgewogIHNldFRleHRTdHJva2UoZmFsc2UsIHVuZGVmaW5lZCk7Cn0KLyoqCiAqIEFkZCBhIHNsaWRlciB0byB5b3VyIGZpZ3VyZSwgYWxsb3dpbmcgdXNlcnMgdG8gY29udHJvbAogKiBhIHZhcmlhYmxlIGluIHlvdXIgZ3JhcGhpY3MgY29kZSBkaXJlY3RseSBieSBpbnRlcmFjdGluZwogKiB3aXRoIHRoYXQgb24tcGFnZSBzbGlkZXIsIHdoaWNoIGlzIGVzcGVjaWFsbHkgaW1wb3J0YW50IGlmCiAqIHlvdSB3YW50IHlvdXIgZ3JhcGhpY3MgdG8gYmUgdXNlYWJsZSBieSB1c2VycyB3aG8gZG9uJ3QKICogaGF2ZSwgb3IgY2Fubm90IHVzZSwgYSBtb3VzZS4KICoKICogVGhlIGBwcm9wTGFiZWxgIHZhbHVlIHNob3VsZCBiZSB0aGUgbmFtZSBvZiB0aGUgdmFyaWFibGUKICogdGhhdCB5b3VyIGdyYXBoaWNzIGNvZGUgdXNlcywgYW5kIHNob3VsZCBfbm90XyBiZSAicHJlYWxsb2NhdGVkIgogKiBpbiB5b3VyIGNvZGUgd2l0aCBhIGNvbnN0LCBsZXQsIG9yIHZhcjogaXQgd2lsbCBhdXRvbWF0aWNhbGx5CiAqIGdldCBhZGRlZCBhcyBwYXJ0IG9mIHRoZSBzb3VyY2UgbG9hZGluZyBwcm9jZXNzLgogKgogKiBUaGUgb3B0aW9ucyBvYmplY3QgYWNjZXB0cyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXMgYW5kIHZhbHVlczoKICoKICogLSBtaW46bnVtYmVyIC0gdGhlIHNsaWRlcidzIG1pbmltdW0gdmFsdWUsIGRlZmF1bHRzIHRvIDAKICogLSBtYXg6bnVtYmVyIC0gdGhlIHNsaWRlcidzIG1heGltdW0gdmFsdWUsIGRlZmF1bHRzIHRvIDEKICogLSBzdGVwIC0gdGhlIHN0ZXAgc2l6ZSwgZGVmYXVsdHMgdG8gKG1heCAtIG1pbikvMTAKICogLSB2YWx1ZSAtIHRoZSBpbml0aWFsIHZhbHVlLCBkZWZhdWx0cyB0byAobWF4ICsgbWluKS8yCiAqIC0gY2xhc3NlcyAtIHRoZSBDU1MgY2xhc3NlcyB0aGF0IHdpbGwgYmUgdXNlZCwgZGVmYXVsdHMgdG8gYCJzbGlkZXIiYAogKiAtIHRyYW5zZm9ybSAtIGEgdmFsdWUgcHJlcHJvY2Vzc29yICBkZWZhdWx0cyB0byAodikgPT4gdgogKgogKiBUaGUgYHRyYW5zZm9ybWAgcHJlLXByb2Nlc3NvciBydW5zIGFmdGVyIHRoZSB1c2VyIHVwZGF0ZXMKICogdGhlIHNsaWRlciwgYnV0IGJlZm9yZSBpdHMgdmFsdWUgZ2V0cyBhc3NpZ25lZCB0byB5b3VyIHZhcmlhYmxlLAogKiBzbyB0aGF0IHlvdSBjYW4gbWFwIGl0IHRvIHNvbWV0aGluZyBlbHNlIChmb3IgaW5zdGFuY2UsIG51bWJlcnMKICogaW4gb25lIHJhbmdlIHRvIG51bWJlcnMgaW4gYSBjb21wbGV0ZWx5IGRpZmZlcmVudCByYW5nZSwgb3IgZXZlbgogKiBudW1iZXJzIHRvIHN0cmluZ3Mgb3IgZW50aXJlIG9iamVjdHMpCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSg0MDAsIDIwMCk7CiAqICAgICAgIGFkZFNsaWRlcihgYmdDb2xvcmAsIHsKICogICAgICAgICBtaW46IDAsCiAqICAgICAgICAgbWF4OiAyNTUsCiAqICAgICAgICAgc3RlcDogMSwKICogICAgICAgICB2YWx1ZTogMjAwLAogKiAgICAgICAgIHRyYW5zZm9ybTogKHYpID0+IHsKICogICAgICAgICAgIC8vIGNvbnZlcnQgdiBpbnRvIGEgaGV4IGNvbG9yIGNvZGUKICogICAgICAgICAgIHYgPSAodikudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsIGAwYCk7CiAqICAgICAgICAgICByZXR1cm4gYCMke3Z9JHt2fSR7dn1gOwogKiAgICAgICAgIH0KICogICAgICAgfSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihiZ0NvbG9yKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gdmFyTmFtZSBUaGUgbmFtZSBmb3IgdGhlIHZhcmlhYmxlIHRoaXMgc2xpZGVyIGdldHMgdGllZCB0by4KICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgU2VlIGRlc2NyaXB0aW9uCiAqIEByZXR1cm5zIHtIVE1MSW5wdXRFbGVtZW50fSB0aGUgSFRNTCBpbnB1dCBlbGVtZW50IGZvciB0aGlzIHNsaWRlcgogKi8KZnVuY3Rpb24gYWRkU2xpZGVyKHByb3BMYWJlbCwgYXNzaWduLCBvcHRpb25zID0ge30pIHsKICBsZXQgewogICAgbWluLAogICAgbWF4LAogICAgc3RlcCwKICAgIHZhbHVlLAogICAgY2xhc3NlcyA9IGBzbGlkZXJgLAogICAgdHJhbnNmb3JtID0gKHYpID0+IHYsCiAgfSA9IG9wdGlvbnM7CgogIG1pbiA9IG1pbiA9PT0gdW5kZWZpbmVkID8gMCA6IG1pbjsKICBtYXggPSBtYXggPT09IHVuZGVmaW5lZCA/IDEgOiBtYXg7CiAgc3RlcCA9IHN0ZXAgPT09IHVuZGVmaW5lZCA/IChtYXggLSBtaW4pIC8gMTAgOiBzdGVwOwogIHZhbHVlID0gdmFsdWUgPT09IHVuZGVmaW5lZCA/IChtYXggKyBtaW4pIC8gMiA6IHZhbHVlOwoKICAvLyBjdXN0b20gInJvdW5kaW5nIiwgcHVyZWx5IGZvciBzdHJpbmdzCiAgY29uc3Qgcm91bmQgPSAodiwgZCA9IDQpID0+IHsKICAgIHYgPSBgJHt2fWA7CiAgICBjb25zdCBmcyA9IHYuaW5kZXhPZihgLmApOwogICAgaWYgKGZzICE9PSAtMSkgewogICAgICBsZXQgcHJlYyA9IGQgLSBmcyA+IDAgPyBkIC0gZnMgOiAwOwogICAgICB2ID0gdi5zdWJzdHJpbmcoMCwgZnMgKyBwcmVjKTsKICAgIH0KICAgIHJldHVybiB2OwogIH07CgogIGNvbnN0IGNyZWF0ZSA9ICh0YWcpID0+IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTsKCiAgbGV0IHNsaWRlciA9IGNyZWF0ZShgaW5wdXRgKTsKICBzbGlkZXIudHlwZSA9IGByYW5nZWA7CiAgc2xpZGVyLm1pbiA9IG1pbjsKICBzbGlkZXIubWF4ID0gbWF4OwogIHNsaWRlci5zdGVwID0gc3RlcDsKICBzbGlkZXIuc2V0QXR0cmlidXRlKGB2YWx1ZWAsIHZhbHVlKTsKICBzbGlkZXIuc2V0QXR0cmlidXRlKGBjbGFzc2AsIGNsYXNzZXMpOwoKICBjb25zdCB1cGRhdGUgPSAoeyB2YWx1ZSB9KSA9PiB7CiAgICB2YWx1ZUZpZWxkLnRleHRDb250ZW50ID0gcm91bmQodmFsdWUpOwogICAgYXNzaWduKHRyYW5zZm9ybShwYXJzZUZsb2F0KHZhbHVlKSkpOwogICAgaWYgKCFwbGF5aW5nKSByZWRyYXcoKTsKICB9OwoKICBzbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcihgaW5wdXRgLCAoeyB0YXJnZXQgfSkgPT4gdXBkYXRlKHRhcmdldCkpOwoKICBsZXQgdGFibGUgPSBfX2VsZW1lbnQucXVlcnlTZWxlY3RvcihgdGFibGUuc2xpZGVyLXdyYXBwZXJgKTsKICBpZiAoIXRhYmxlKSB7CiAgICB0YWJsZSA9IGNyZWF0ZShgdGFibGVgKTsKICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoYHNsaWRlci13cmFwcGVyYCk7CiAgICBfX2VsZW1lbnQucHJlcGVuZCh0YWJsZSk7CiAgfQogIGxldCB0ciA9IGNyZWF0ZShgdHJgKTsKCiAgbGV0IHRkID0gY3JlYXRlKGB0ZGApOwogIGxldCBsYWJlbCA9IGNyZWF0ZShgbGFiZWxgKTsKICBsYWJlbC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbGFiZWxgKTsKICBsYWJlbC5pbm5lckhUTUwgPSBwcm9wTGFiZWwKICAgIC5yZXBsYWNlKC9fKC4rKSQvLCBgPHN1Yj4kMTwvc3ViPmApCiAgICAucmVwbGFjZSgvKFxkKykvLCBgPHN1Yj4kMTwvc3ViPmApOwogIHRkLmFwcGVuZChsYWJlbCk7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLW1pbmApOwogIHRkLnRleHRDb250ZW50ID0gcm91bmQoc2xpZGVyLm1pbik7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdGQud2lkdGggPSBgKmA7CiAgdGQuYXBwZW5kKHNsaWRlcik7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLW1heGApOwogIHRkLnRleHRDb250ZW50ID0gcm91bmQoc2xpZGVyLm1heCk7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdmFyIHZhbHVlRmllbGQgPSBjcmVhdGUoYGxhYmVsYCk7IC8vIGZ1bmN0aW9uIHNjb3BlZAogIHZhbHVlRmllbGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLXZhbHVlYCk7CiAgdGQuYXBwZW5kKHZhbHVlRmllbGQpOwogIHRyLmFwcGVuZCh0ZCk7CiAgdGQuYWRkRXZlbnRMaXN0ZW5lcihgcG9pbnRlcmRvd25gLCAoKSA9PiB7CiAgICBjb25zdCB2YWx1ZSA9IHByb21wdChgbmV3IHZhbHVlP2AsIHNsaWRlci52YWx1ZSk7CiAgICBpZiAodmFsdWUgIT09IG51bGwpIHsKICAgICAgc2xpZGVyLnZhbHVlID0gdmFsdWU7CiAgICAgIHVwZGF0ZSh7IHZhbHVlIH0pOwogICAgfQogIH0pOwoKICB0YWJsZS5hcHBlbmQodHIpOwoKICB1cGRhdGUoc2xpZGVyKTsKICByZXR1cm4gc2xpZGVyOwp9CgovKioKICogUmVtb3ZlIGFsbCBzbGlkZXJzIGZvciB5b3VyIGZpZ3VyZSBmcm9tIHRoZSBwYWdlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRTbGlkZXIoYHhgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KGBjbGljayB0byBjbGVhcmAsIHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKCkgewogKiAgICAgICBjbGVhclNsaWRlcnMoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKi8KZnVuY3Rpb24gY2xlYXJTbGlkZXJzKCkgewogIGNvbnN0IHRhYmxlID0gX19lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYHRhYmxlLnNsaWRlci13cmFwcGVyYCk7CiAgaWYgKHRhYmxlKSB0YWJsZS5pbm5lckhUTUwgPSBgYDsKfQoKLyoqCiAqIEFkZCBhIGJ1dHRvbiBiZWxvdyB5b3VyIGZpZ3VyZSB0aGF0IGNhbiB0cmlnZ2VyIGV2ZW50LWJhc2VkCiAqIGNvZGUsIHdoaWNoIGlzIGVzcGVjaWFsbHkgaW1wb3J0YW50IGlmIHlvdSB3YW50IHlvdXIgZ3JhcGhpY3MKICogdG8gYmUgdXNlYWJsZSBieSB1c2VycyB3aG8gZG9uJ3QgaGF2ZSwgb3IgY2Fubm90IHVzZSwgYSBtb3VzZS4KICoKICogb25DbGljayBpcyBzaW1pbGFyIHRvIHRoZSBzdGFuZGFyZCBKUyBldmVudCBoYW5kbGVyLCBleGNlcHQKICogdGhhdCB0aGUgY2FsbCBhcmd1bWVudCBpcyBhIHJlZmVyZW5jZSB0byB5b3VyIGJ1dHRvbiwgbm90CiAqIHRoZSBjbGljayBldmVudC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IGNvbG9ycyA9IFtgd2hpdGVgLCBgYmxhY2tgXTsKICogICAgIGxldCBiZ0NvbG9yID0gMDsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGBmbGlwIGJhY2tncm91bmRgLCAoYnV0dG9uKSA9PiB7CiAqICAgICAgICAgYmdDb2xvciA9IC0oYmdDb2xvciAtIDEpOwogKiAgICAgICAgIHJlZHJhdygpOwogKiAgICAgICB9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGNvbG9yc1tiZ0NvbG9yXSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGxhYmVsIFRoZSB0ZXh0IGxhYmVsIGZvciB5b3VyIGJ1dHRvbgogKiBAcGFyYW0ge2Z1bmN0aW9ufSBvbkNsaWNrIFRoZSBjbGljayBoYW5kbGluZyBmdW5jdGlvbiwgc2VlIGRlc2NyaXB0aW9uLgogKiBAcmV0dXJucyBIVE1MQnV0dG9uRWxlbWVudAogKi8KZnVuY3Rpb24gYWRkQnV0dG9uKGxhYmVsLCBvbkNsaWNrKSB7CiAgaWYgKCFvbkNsaWNrKSB0aHJvdyBuZXcgRXJyb3IoYGEgYnV0dG9uIG11c3QgaGF2ZSBhbiBvbkNsaWNrIGhhbmRsZXJgKTsKICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBidXR0b25gKTsKICBidG4uY2xhc3NMaXN0LmFkZChgZ3JhcGhpY3MtZWxlbWVudC1idXR0b25gKTsKICBidG4udGV4dENvbnRlbnQgPSBsYWJlbDsKICBidG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCAoKSA9PiBvbkNsaWNrKGJ0bikpOwogIF9fZWxlbWVudC5wcmVwZW5kKGJ0bik7CiAgcmV0dXJuIGJ0bjsKfQoKLyoqCiAqIFJlbW92ZSBhbGwgYnV0dG9ucyBmb3IgeW91ciBmaWd1cmUgZnJvbSB0aGUgcGFnZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGB0aGlzIGRvZXMgbm90aGluZ2AsICgpID0+IHt9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KGBjbGljayB0byBjbGVhcmAsIHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKCkgewogKiAgICAgICBjbGVhckJ1dHRvbnMoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcmV0dXJucyB2b2lkCiAqLwpmdW5jdGlvbiBjbGVhckJ1dHRvbnMoKSB7CiAgX19lbGVtZW50CiAgICAucXVlcnlTZWxlY3RvckFsbChgYnV0dG9uLmdyYXBoaWNzLWVsZW1lbnQtYnV0dG9uYCkKICAgIC5mb3JFYWNoKChlKSA9PiBlLnJlbW92ZSgpKTsKfQovKioKICogRHJhdyBhIGNpcmN1bGFyIGFyYyB3aXRoIHJhZGl1cyBgcmAgYXQgKHgseSksCiAqIHN0YXJ0aW5nIGF0IGFuZ2xlIGBzYCBhbmQgZW5kaW5nIGF0IGFuZ2xlIGBlYC4KICogSWYgYHdlZGdlYCBpcyB0cnVlLCB0aGlzIHdpbGwgZHJhdyBhIGNsb3NlZAogKiBzaGFwZSB0aGF0IGlzIGFuY2hvcmVkIGF0ICh4LHkpLiBJZiBvbWl0dGVkCiAqIG9yIGV4cGxpY2l0bHkgc2V0IHRvIGZhbHNlLCB0aGlzIHdpbGwgZHJhdwogKiBhbiBvcGVuIHNoYXBlIHdpdGggYSBmaWxsIHRoYXQgY29ubmVjdHMgdGhlCiAqIGZpcnN0IGFuZCBsYXN0IHBvaW50IG9uIHRoZSBhcmMsIGJ1dCBubyBjbG9zaW5nCiAqIHN0cm9rZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYCNGMDAyYCk7CiAqICAgICAgIGFyYyh3aWR0aC8yICsgMzAsIGhlaWdodC8yIC0gNDAsIDQwLCAwLCAwLjY2KlRBVSk7CiAqICAgICAgIGFyYyh3aWR0aC8yIC0gMzAsIGhlaWdodC8yICsgMjAsIDQwLCAwLCAwLjY2KlRBVSwgdHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGNpcmN1bGFyIGNlbnRlciB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBjaXJjdWxhciBjZW50ZXIgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhpcyBhcmMgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydEFuZ2xlIFRoZSBzdGFydCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0gZW5kQW5nbGUgVGhlIGVuZCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge2Jvb2xlYW59IGRyYXdXZWRnZSBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRvIGRyYXcgYSB3ZWRnZSBvciBjYXBwZWQgY2lyY2xlIChkZWZhdWx0PWNpcmNsZSkKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHBvaW50IFRoZSBjaXJjdWxhciBjZW50ZXIge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhpcyBhcmMgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydEFuZ2xlIFRoZSBzdGFydCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0gZW5kQW5nbGUgVGhlIGVuZCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge2Jvb2xlYW59IGRyYXdXZWRnZSBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRvIGRyYXcgYSB3ZWRnZSBvciBjYXBwZWQgY2lyY2xlIChkZWZhdWx0PWNpcmNsZSkKICovCmZ1bmN0aW9uIGFyYyh4LCB5LCByLCBzID0gMCwgZSA9IFRBVSwgd2VkZ2UgPSBmYWxzZSkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgd2VkZ2UgPSBlOwogICAgZSA9IHM7CiAgICBzID0gcjsKICAgIHIgPSB5OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIGNvbnN0IHN0ZXAgPSAwLjE7CiAgc3RhcnQoKTsKICBpZiAod2VkZ2UpIHZlcnRleCh4LCB5KTsKICBsZXQgYSA9IHM7CiAgdmVydGV4KHggKyByICogY29zKHMpLCB5ICsgciAqIHNpbihzKSk7CiAgZm9yIChhID0gcyArIHN0ZXA7IGEgPCBlOyBhICs9IHN0ZXApIHsKICAgIHZlcnRleCh4ICsgciAqIGNvcyhhKSwgeSArIHIgKiBzaW4oYSkpOwogIH0KICB2ZXJ0ZXgoeCArIHIgKiBjb3MoZSksIHkgKyByICogc2luKGUpKTsKICBpZiAod2VkZ2UpIHZlcnRleCh4LCB5KTsKICBlbmQoKTsKfQoKLyoqCiAqIERyYXcgYSBwYWlyIG9mIGhvcml6b250YWwgYW5kIHZlcnRpY2FsIGF4ZXMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEJvcmRlcigxLCBgYmxhY2tgKTsKICogICAgICAgc2V0R3JpZCg1MCwgYGxpZ2h0Z3JleWApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgc2V0Q3Vyc29yKGBub25lYCk7CiAqICAgICAgIGNsZWFyKGAjZmZmZWY3YCk7CiAqICAgICAgIHNldENvbG9yKGAjMzMzYCk7CiAqICAgICAgIHRyYW5zbGF0ZSgyNSwyNSk7CiAqICAgICAgIGF4ZXMoCiAqICAgICAgICAgYHRpbWUgKHMpYCwgMCwgd2lkdGgtNTAsCiAqICAgICAgICAgYGRpc3RhbmNlIChrbSlgLCAwLCBoZWlnaHQtNTAsCiAqICAgICAgICAgIjAiLCAiNjAiLAogKiAgICAgICAgICIwIiwgIjUwMCIpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBoTGFiZWwgdGhlIGhvcml6b250YWwgYXhpcyBsYWJlbAogKiBAcGFyYW0ge251bWJlcn0gaHMgdGhlIHN0YXJ0IChsZWZ0KSBwaXhlbCB2YWx1ZSBmb3IgdGhlIGhvcml6b250YWwgYXhpcwogKiBAcGFyYW0ge251bWJlcn0gaGUgdGhlIGVuZCAocmlnaHQpIHBpeGVsIHZhbHVlIGZvciB0aGUgaG9yaXpvbnRhbCBheGlzCiAqIEBwYXJhbSB7c3RyaW5nfSB2TGFiZWwgdGhlIHZlcnRpY2FsIGF4aXMgbGFiZWwKICogQHBhcmFtIHtudW1iZXJ9IHZzIHRoZSBzdGFydCAodG9wKSBwaXhlbCB2YWx1ZSBmb3IgdGhlIHZlcnRpY2FsIGF4aXMKICogQHBhcmFtIHtudW1iZXJ9IHZlIHRoZSBlbmQgKGJvdHRvbSkgcGl4ZWwgdmFsdWUgZm9yIHRoZSB2ZXJ0aWNhbCBheGlzCiAqIEBwYXJhbSB7c3RyaW5nfSBoc0xhYmVsPyBhbiBvcHRpb25hbCBsYWJlbCBmb3IgdGhlIHN0YXJ0IChsZWZ0KSBvZiB0aGUgaG9yaXpvbnRhbCBheGlzCiAqIEBwYXJhbSB7c3RyaW5nfSBoZUxhYmVsPyBhbiBvcHRpb25hbCBsYWJlbCBmb3IgdGhlIGVuZCAocmlnaHQpIG9mIHRoZSBob3Jpem9udGFsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IHZzTGFiZWw/IGFuIG9wdGlvbmFsIGxhYmVsIGZvciB0aGUgc3RhcnQgKHRvcCkgb2YgdGhlIHZlcnRpY2FsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IHZlTGFiZWw/IGFuIG9wdGlvbmFsIGxhYmVsIGZvciB0aGUgZW5kIChib3R0b20pIG9mIHRoZSB2ZXJ0aWNhbCBheGlzCiAqIEByZXR1cm5zIHZvaWQKICovCmZ1bmN0aW9uIGF4ZXMoCiAgaExhYmVsLAogIGhzLAogIGhlLAogIHZMYWJlbCwKICB2cywKICB2ZSwKICBoc0xhYmVsID0gZmFsc2UsCiAgaGVMYWJlbCA9IGZhbHNlLAogIHZzTGFiZWwgPSBmYWxzZSwKICB2ZUxhYmVsID0gZmFsc2UKKSB7CiAgbGluZShocywgMCwgaGUsIDApOwogIGxpbmUoMCwgdnMsIDAsIHZlKTsKCiAgY29uc3QgaHBvcyA9IDAgLSA1OwogIHRleHQoYCR7aExhYmVsfSDihpJgLCB3aWR0aCAvIDIgKyA1LCBocG9zLCBSSUdIVCk7CiAgdGV4dChoc0xhYmVsID8gaHNMYWJlbCA6IGhzLCBocywgaHBvcywgUklHSFQpOwogIHRleHQoaGVMYWJlbCA/IGhlTGFiZWwgOiBoZSwgaGUsIGhwb3MsIFJJR0hUKTsKCiAgY29uc3QgdnBvcyA9IC01OwogIHNhdmUoKTsKICB0cmFuc2xhdGUodnBvcywgaGVpZ2h0IC8gMik7CiAgcm90YXRlKC1QSSAvIDIpOwogIHRleHQoYCR7dkxhYmVsfWAsIDAsIDAsIExFRlQpOwogIHJlc3RvcmUoKTsKICB0ZXh0KGDihpNgLCB2cG9zLCBoZWlnaHQgLyAyICsgMTYsIFJJR0hUKTsKICB0ZXh0KHZzTGFiZWwgPyB2c0xhYmVsIDogdnMsIHZwb3MsIHZzICsgNSwgUklHSFQpOwogIHRleHQodmVMYWJlbCA/IHZlTGFiZWwgOiB2ZSwgdnBvcywgdmUsIFJJR0hUKTsKfQoKLyoqCiAqIERyYXcgb25lIG9yIG1vcmUgQmV6aWVyIGN1cnZlcyBmcm9tIGFuIGFycmF5CiAqIG9mIFBvaW50IG9yIFBvaW50LWxpa2VzIHRoYXQgaW1wbGVtZW50OgogKgogKiBgYGAKICogewogKiAgIHg6IG51bWJlcgogKiAgIHk6IG51bWJlcgogKiB9CiAqIGBgYAogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgI0YwMDJgKTsKICogICAgICAgYmV6aWVyKAogKiAgICAgICAgIG5ldyBQb2ludCgyMCwgaGVpZ2h0IC0gNTUpLAogKiAgICAgICAgIG5ldyBQb2ludCgyMCwgMjUpLAogKiAgICAgICAgIHsgeDogd2lkdGggLSAyMCwgeTogMjV9LAogKiAgICAgICAgIHsgeDogd2lkdGggLSAyMCwgeTogaGVpZ2h0IC0gNTV9CiAqICAgICAgICk7CiAqICAgICAgIG5vRmlsbCgpCiAqICAgICAgIGJlemllcigKICogICAgICAgICBuZXcgUG9pbnQoMCwgaGVpZ2h0IC0gMjApLAogKiAgICAgICAgIG5ldyBQb2ludCh3aWR0aCAtIDIwLCBoZWlnaHQgLSAyMCksCiAqICAgICAgICAgeyB4OiAyMCwgeTogMjB9LAogKiAgICAgICAgIHsgeDogd2lkdGgsIHk6IDIwfQogKiAgICAgICApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyWzhdfSBjb29yZGluYXRlcyBFaWdodCB4LCB5IHZhbHVlcy4KICogQHBhcmFtIHtudW1iZXJbNm5dfSBhZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IE11bHRpcGxlcyBvZiBzaXggeCwgeSB2YWx1ZXMuCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlWzRdfSBjb29yZGluYXRlcyBGb3VyIHt4LHl9IGNvb3JkaW5hdGVzLgogKiBAcGFyYW0ge1BvaW50TGlrZVszbl19IGFkZGl0aW9uYWxDb29yZGluYXRlcz8gTXVsdGlwbGVzIG9mIHRocmVlIHt4LHl9IGNvb3JkaW5hdGVzLgogKi8KZnVuY3Rpb24gYmV6aWVyKC4uLmFyZ3MpIHsKICBsZXQgcG9pbnRzID0gYXJnczsKCiAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBgbnVtYmVyYCkgewogICAgcG9pbnRzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgcG9pbnRzLnB1c2goeyB4OiBhcmdzW2ldLCB5OiBhcmdzW2kgKyAxXSB9KTsKICAgIH0KICB9CgogIGNvbnN0IGIgPSAodCwgYSwgYiwgYywgZCkgPT4gewogICAgY29uc3QgbXQgPSAxIC0gdDsKICAgIHJldHVybiBhICogbXQgKiogMyArIDMgKiBiICogbXQgKiogMiAqIHQgKyAzICogYyAqIG10ICogdCAqKiAyICsgZCAqIHQgKiogMzsKICB9OwoKICBsZXQgW3AwLCAuLi5yZXN0XSA9IHBvaW50czsKICBzdGFydCgpOwogIGZvciAobGV0IGkgPSAwLCBlID0gcmVzdC5sZW5ndGg7IGkgPCBlOyBpICs9IDMpIHsKICAgIGxldCBbcDEsIHAyLCBwM10gPSByZXN0LnNsaWNlKGksIGkgKyAzKTsKICAgIGlmIChwMSAmJiBwMiAmJiBwMykgewogICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IDE7IHQgKz0gMC4wMSkgewogICAgICAgIHZlcnRleChiKHQsIHAwLngsIHAxLngsIHAyLngsIHAzLngpLCBiKHQsIHAwLnksIHAxLnksIHAyLnksIHAzLnkpKTsKICAgICAgfQogICAgICB2ZXJ0ZXgocDMueCwgcDMueSk7CiAgICAgIHAwID0gcDM7CiAgICB9CiAgfQogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIEItc3BsaW5lIHVzaW5nIGZvdXIgb3IgbW9yZSBQb2ludCBvcgogKiBQb2ludC1saWtlcyB0aGF0IGltcGxlbWVudDoKICoKICogICB7CiAqICAgICB4OiBudW1iZXIKICogICAgIHk6IG51bWJlcgogKiAgIH0KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICByYW5nZSgwLCBUQVUsIFBJIC8gNSwgKGEpID0+IHBvaW50cy5wdXNoKAogKiAgICAgICAgIG5ldyBQb2ludCgKICogICAgICAgICAgIHJhbmRvbSgzMCkgKyA1MCAqIGNvcyhhKSwKICogICAgICAgICAgIHJhbmRvbSgzMCkgKyA1MCAqIHNpbihhKQogKiAgICAgICAgICkKICogICAgICAgKSk7CiAqICAgICAgIHNldE1vdmFibGUoLi4ucG9pbnRzKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGggLyAyLCBoZWlnaHQgLyAyKTsKICogICAgICAgbm9TdHJva2UoKTsKICogICAgICAgc2V0RmlsbChgIzAwMDJgKTsKICogICAgICAgYnNwbGluZSguLi5wb2ludHMpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHBvaW50cy5mb3JFYWNoKHAgPT4gcG9pbnQocCkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyWzhdfSBjb29yZGluYXRlcyBFaWdodCB4LCB5IHZhbHVlcy4KICogQHBhcmFtIHtudW1iZXJbMm5dfSBhZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IE11bHRpcGxlcyBvZiB4LCB5IHZhbHVlcy4KICoKICogQHBhcmFtIHtQb2ludExpa2VbNF19IGNvb3JkaW5hdGVzIEZvdXIge3gseX0gY29vcmRpbmF0ZXMuCiAqIEBwYXJhbSB7UG9pbnRMaWtlW25dfSBhZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IFplcm8gb3IgbW9yZSB7eCx5fSBjb29yZGluYXRlcy4KICovCmZ1bmN0aW9uIGJzcGxpbmUoLi4uYXJncykgewogIGxldCBvcGVuID0gdHJ1ZTsKICBpZiAodHlwZW9mIGFyZ3NbYXJncy5sZW5ndGggLSAxXSA9PT0gYGJvb2xlYW5gKSB7CiAgICBvcGVuID0gYXJncy5zcGxpY2UoYXJncy5sZW5ndGggLSAxLCAxKVswXTsKICB9CgogIGxldCBwb2ludHMgPSBhcmdzOwoKICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09IGBudW1iZXJgKSB7CiAgICBwb2ludHMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkgKz0gMikgewogICAgICBwb2ludHMucHVzaCh7IHg6IGFyZ3NbaV0sIHk6IGFyZ3NbaSArIDFdIH0pOwogICAgfQogIH0KCiAgc3RhcnQoKTsKICBuZXcgQlNwbGluZShwb2ludHMsIG9wZW4pLmdldExVVCgpLmZvckVhY2goKHApID0+IHZlcnRleChwLngsIHAueSkpOwogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIGNpcmNsZSB3aXRoIHJhZGl1cyBgcmAgYXQgYHgseWAuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGAjRjAwMmApOwogKiAgICAgICBjaXJjbGUod2lkdGgvMiwgaGVpZ2h0LzIsIDgwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgY2lyY2xlJ3MgY2VudGVyIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIGNpcmNsZSdzIGNlbnRlciB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSByIFRoZSBjaXJjbGUncyByYWRpdXMgaW4gcGl4ZWxzCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSBjaXJjbGUncyBjZW50ZXIge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0gciBUaGUgY2lyY2xlJ3MgcmFkaXVzIGluIHBpeGVscwogKi8KZnVuY3Rpb24gY2lyY2xlKHgsIHksIHIpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHIgPSB5OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIGFyYyh4LCB5LCByLCAwLCBUQVUsIGZhbHNlKTsKfQoKLyoqCiAqIENsZWFyIHRoZSBjYW52YXMsIGFuZCBzZXQgaXQgdG8gYSBzcGVjaWZpYyAoQ1NTKSBjb2xvdXIuCiAqIElmIG5vIGBub0dyaWQoKWAgY2FsbCB3YXMgbWFkZSwgdGhpcyB3aWxsIHRoZW4gYWxzbyBkcmF3CiAqIHRoZSBiYWNrZ3JvdW5kIGdyaWQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgcGlua2ApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Kn0gY29sb3VyIGRlZmF1bHRzIHRvIGB3aGl0ZWAKICovCmZ1bmN0aW9uIGNsZWFyKGNvbG9yID0gYHdoaXRlYCkgewogIHNhdmUoKTsKICBfX2NhbnZhcy5zdHlsZS5iYWNrZ3JvdW5kID0gY29sb3I7CiAgX19jYW52YXMud2lkdGggPSB3aWR0aDsKICBfX2N0eCA9IF9fY2FudmFzLmdldENvbnRleHQoYDJkYCk7CiAgaWYgKF9fZHJhd19ncmlkKSBncmlkKCk7CiAgcmVzdG9yZSgpOwp9CgovKioKICogQ291bnRlcnBhcnQgdG8gc3RhcnQoKSwgZmluYWxpemVzIHRoZSBjdXJyZW50IHNoYXBlIGFuZAogKiBjb2xvdXJzIGl0LiBJZiBgY2xvc2VgIGlzIHRydWUsIGl0IHdpbGwgY2xvc2UgdGhlIHBhdGgKICogYmVmb3JlIGNvbG91cmluZy4KICoKICogSWYgYG5vRmlsbCgpYCBpcyBpbiBlZmZlY3QsIHRoZSBzaGFwZSB3aWxsIG5vdCBiZSBmaWxsZWQuCiAqIGlmIGBub1N0cm9rZSgpYCBpcyBpbiBlZmZlY3QsIHRoZSBzaGFwZSBvdXRsaW5lIHdpbGwgbm90IGJlIGNvbG91cmVkLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgZ29sZGApOwogKiAgICAgICBzdGFydCgpOwogKiAgICAgICB2ZXJ0ZXgoMCxoZWlnaHQvMik7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCAwKTsKICogICAgICAgdmVydGV4KHdpZHRoLCBoZWlnaHQvMik7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgICBlbmQodHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSBjbG9zZQogKi8KZnVuY3Rpb24gZW5kKGNsb3NlID0gZmFsc2UpIHsKICBpZiAoY2xvc2UpIF9fY3R4LmNsb3NlUGF0aCgpOwogIF9fY3R4LmZpbGwoKTsKICBfX2N0eC5zdHJva2UoKTsKICBpZiAoX19jdHgubGluZVdpZHRoICUgMiA9PT0gMSkgewogICAgX19jdHgudHJhbnNsYXRlKC0wLjUsIC0wLjUpOwogIH0KfQoKLyoqCiAqIERyYXcgYW4gaW1hZ2UgaW4gYSBnaXZlbiBsb2NhdGlvbiB3aXRoIGFuIG9wdGlvbmFsCiAqIHdpZHRoIGFuZCBoZWlnaHQuIElmIG9taXR0ZWQsIHRoZSB3aWR0aCBhbmQgaGVpZ2h0CiAqIHdpbGwgYmUgdGhlIGltYWdlJ3Mgb3duIGRpbWVuc2lvbnMuIE5vdGUgdGhhdCB0aGUKICogaW1hZ2UgbWF5IGJlIGVpdGhlciBhIFVSTCwgb3IgYW4gPGltZz4gZWxlbWVudC4KICoKICogTm90ZSB0aGF0IHRoaXMgaXMgYW4gYXN5bmMgZnVuY3Rpb246IGlmIGl0IGlzIGltcG9ydGFudAogKiB0aGF0IG5vdGhpbmcgZ2V0cyBkcmF3biB1bnRpbCB0aGUgaW1hZ2UgaGFzIGJlZW4gZHJhd24sCiAqIHJlbWVtYmVyIHRvIGBhd2FpdGAgaXRzIGNhbGwuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBhc3luYyBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgYXdhaXQgaW1hZ2UoYGh0dHBzOi8vZHVtbXlpbWFnZS5jb20vMTAweDEwMGAsIDUwLCA1MCwgMTAwLCAxMDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Kn0gaW1nCiAqIEBwYXJhbSB7Kn0geAogKiBAcGFyYW0geyp9IHkKICogQHBhcmFtIHsqfSB3CiAqIEBwYXJhbSB7Kn0gaAogKiBAcmV0dXJucyB7SW1hZ2V9IHRoZSBkcmF3biBpbWFnZQogKgogKiBAcGFyYW0geyp9IGltZwogKiBAcGFyYW0geyp9IHAKICogQHBhcmFtIHsqfSB3CiAqIEBwYXJhbSB7Kn0gaAogKiBAcmV0dXJucyB7SW1hZ2V9IHRoZSBkcmF3biBpbWFnZQogKi8KYXN5bmMgZnVuY3Rpb24gaW1hZ2UoaW1nLCB4ID0gMCwgeSA9IDAsIHcsIGgpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIGggPSB3OwogICAgdyA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIGlmICh0eXBlb2YgaW1nID09PSBgc3RyaW5nYCkgewogICAgaW1nID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBjb25zdCB0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBpbWdgKTsKICAgICAgdGFnLm9ubG9hZCA9ICgpID0+IHJlc29sdmUodGFnKTsKICAgICAgdGFnLm9uZXJyb3IgPSAoKSA9PiByZWplY3QoKTsKICAgICAgdGFnLnNyYyA9IGltZzsKICAgIH0pOwogIH0KICBfX2N0eC5kcmF3SW1hZ2UoaW1nLCB4LCB5LCB3IHx8IGltZy53aWR0aCwgaCB8fCBpbWcuaGVpZ2h0KTsKICByZXR1cm4gaW1nOwp9CgovKioKICogRHJhdyBhIGxpbmUgZnJvbSBvbmUgY29vcmRpbmF0ZSB0byBhbm90aGVyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgcmFuZ2UoMCxoZWlnaHQsMjAsIChpKSA9PiBsaW5lKDAsIDAsIHdpZHRoLCBpKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSB4MQogKiBAcGFyYW0geyp9IHkxCiAqIEBwYXJhbSB7Kn0geDIKICogQHBhcmFtIHsqfSB5MgogKgogKiBAcGFyYW0geyp9IHAxCiAqIEBwYXJhbSB7Kn0gcDIKICovCmZ1bmN0aW9uIGxpbmUoeDEsIHkxLCB4MiwgeTIpIHsKICBpZiAoeDEueCAhPT0gdW5kZWZpbmVkICYmIHgxLnkgIT09IHVuZGVmaW5lZCkgewogICAgeTIgPSB5MS55OwogICAgeDIgPSB5MS54OwogICAgeTEgPSB4MS55OwogICAgeDEgPSB4MS54OwogIH0KCiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICB2ZXJ0ZXgoeDIsIHkyKTsKICBlbmQoKTsKfQoKLyoqCiAqIFBsb3QgYSB5PWYoeCkgZnVuY3Rpb24uIFRoZSBpbnB1dCB0byB0aGUgZnVuY3Rpb24KICogd2lsbCBzcGFuIHRoZSBpbnRlcnZhbCBbYSxiXSB1c2luZyB0aGUgaW5kaWNhdGVkCiAqIG51bWJlciBvZiBzdGVwcywgYW5kIHRoZSByZSBzdWx0IG1heSBiZSBzY2FsZWQgYm90aAogKiBpbiB0aGUgeCBhbmQgeSBkaXJlY3Rpb24gaW4gb3JkZXIgdG8gZHJhdyBzb21ldGhpbmcKICogdGhhdCB5b3UgY2FuIGFjdHVhbGx5IHNlZSAoZS5nLiBpZiB5b3UncmUgcGxvdHRpbmcKICogdG8gdGhlIGRvbWFpbiBbMCwxXSB5b3Ugd291bGRuJ3QgYmUgYWJsZSB0byBzZWUgdGhlCiAqIHJlc3VsdCB3aXRob3V0IHNjYWxpbmcpLgogKgogKiBUaGlzIGZ1bmN0aW9uIGlzIGF3YXJlIG9mLCBhbmQgd2lsbCBwbG90LCBkaXNjb250aW51aXRpZXMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgdHJhbnNsYXRlKDAsIGhlaWdodC8yKTsKICogICAgICAgY29uc3QgZm4gPSAoeCkgPT4gY29zKHgpICoqIDIgLyBzaW4oeCk7CiAqICAgICAgIHBsb3QoZm4sIDAsIFRBVSwgdW5kZWZpbmVkLCB3aWR0aC9UQVUsIGhlaWdodC8yKQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7ZnVuY3Rpb259IGYgdGhlIHk9Zih4KSBmdW5jdGlvbgogKiBAcGFyYW0ge251bWJlcn0gYQogKiBAcGFyYW0ge251bWJlcn0gYgogKiBAcGFyYW0ge251bWJlcn0gc3RlcHMgbnVtYmVyIG9mIHBsb3QgcG9pbnRzIHRvIHVzZSAoZGVmYXVsdCA9IDEwMCkKICogQHBhcmFtIHtudW1iZXJ9IHhzY2FsZQogKiBAcGFyYW0ge251bWJlcn0geXNjYWxlCiAqLwpmdW5jdGlvbiBwbG90KGYsIGEgPSAwLCBiID0gMSwgc3RlcHMgPSAxMDAsIHhzY2FsZSA9IDEsIHlzY2FsZSA9IDEpIHsKICBjb25zdCBpbnRlcnZhbCA9IGIgLSBhOwogIHN0YXJ0KCk7CiAgbGV0IFtweSwgZHksIHBkeV0gPSBbMCwgMCwgMF07CiAgY29uc3Qgc3RlcCA9IGludGVydmFsIC8gKHN0ZXBzIC0gMSk7CiAgY29uc3QgZGlzY29udGludWl0eSA9IChpLCB4LCB5KSA9PiB7CiAgICBlbmQoKTsKICAgIHNhdmUoKTsKICAgIG5vRmlsbCgpOwogICAgY29uc29sZS5sb2coeyBpLCB4LCB5LCBweSwgZHksIHBkeSB9KTsKICAgIHBvaW50KHggKiB4c2NhbGUsIHB5ICogeXNjYWxlKTsKICAgIHBvaW50KHggKiB4c2NhbGUsIHkgKiB5c2NhbGUpOwogICAgcmVzdG9yZSgpOwogICAgc3RhcnQoKTsKICB9OwogIGZvciAobGV0IGkgPSAwLCB4LCB5OyBpIDwgc3RlcHM7IGkrKykgewogICAgeCA9IGEgKyBpICogc3RlcDsKICAgIHkgPSBmKHgpOwogICAgLy8gSWYgZih4KSBjaGFuZ2VzIGluIHZpb2xhdGlvbiBvZiB3aGF0IGl0cyBmJyh4KSBzdWdnZXN0ZWQsCiAgICAvLyB0aGF0J3MgYSBkaXNjb250aW51aXR5IGFuZCB3ZSBkcmF3IGFuIGFzeW1wdG90ZS4KICAgIGR5ID0gKHkgLSBweSkgKiBzdGVwOwogICAgaWYgKHBkeSAhPT0gbnVsbCAmJiBzaWduKHkgLSBweSkgIT09IHNpZ24ocGR5KSAmJiBhYnMocGR5KSA+IDAuMDEpIHsKICAgICAgZGlzY29udGludWl0eShpLCB4LCB5KTsKICAgICAgcGR5ID0gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHBkeSA9IGR5OwogICAgfQogICAgdmVydGV4KHggKiB4c2NhbGUsIHkgKiB5c2NhbGUpOwogICAgcHkgPSB5OwogIH0KICBlbmQoKTsKfQoKLyoqCiAqIFBsb3QgYSAyRCBncmFwaCB1c2luZyBhIGNvbGxlY3Rpb24gb2YgYW55LWRpbWVuc2lvbmFsIGRhdGEsCiAqIGJ5IGluZGljYXRpbmcgd2hpY2ggZGltZW5zaW9uIHNob3VsZCBiZSB0cmVhdGVkIGFzIHRoZSBgeGAKICogYW5kIHdoaWNoIGRpbWVuc2lvbiBzaG91bGQgYmUgdHJlYXRlZCBhcyB0aGUgYHlgLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICB0cmFuc2xhdGUoMCwgaGVpZ2h0LzIpOwogKgogKiAgICAgICBzZXRTdHJva2UoYGRhcmtncmVlbmApOwogKiAgICAgICBsZXQgZGF0YSA9IGFycmF5KHdpZHRoLCAoXyxpKSA9PiBbaSwgaGVpZ2h0LzIgKiBzaW4oaS8yNSldKTsKICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAqCiAqICAgICAgIHNldFN0cm9rZShgcHVycGxlYCk7CiAqICAgICAgIGRhdGEgPSBhcnJheSh3aWR0aCwgKF8saSkgPT4gKHsKICogICAgICAgICBtZWVwOiBpLAogKiAgICAgICAgIG1vb3A6IGhlaWdodC8yICogY29zKGkvMjUpCiAqICAgICAgIH0pKTsKICogICAgICAgcGxvdERhdGEoZGF0YSwgYG1lZXBgLCBgbW9vcGApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Kn0gZGF0YQogKiBAcGFyYW0geyp9IHgKICogQHBhcmFtIHsqfSB5CiAqLwpmdW5jdGlvbiBwbG90RGF0YShkYXRhLCB4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIHN0YXJ0KCk7CiAgZGF0YS5mb3JFYWNoKChwKSA9PiB2ZXJ0ZXgocFt4XSwgcFt5XSkpOwogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIHBvaW50IChlaXRoZXIgZnJvbSB4L3kgb3IgcG9pbnQtbGlrZSkuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcmFuZ2UoMCwgVEFVLCAoYSkgPT4gewogKiAgICAgICAgIHBvaW50KDQwICogY29zKGEpLCA0MCAqIHNpbihhKSk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Kn0geAogKiBAcGFyYW0geyp9IHkKICoKICogQHBhcmFtIHsqfSBwCiAqLwpmdW5jdGlvbiBwb2ludCh4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgY2lyY2xlKHgsIHksIDMpOwp9CgovKioKICogRHJhdyBhIHJlY3RhbmdsZSBhdCB0aGUgc3BlY2lmaWVkIGNvb3JkaW5hdGUsIHdpdGgKICogdGhlIHNwZWNpZmljIHdpZHRoIGFuZCBoZWlnaHQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg0MCwgNDAsIHdpZHRoIC0gODAsIGhlaWdodCAtIDgwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0geyp9IHgKICogQHBhcmFtIHsqfSB5CiAqIEBwYXJhbSB7Kn0gdwogKiBAcGFyYW0geyp9IGgKICoKICogQHBhcmFtIHsqfSBwCiAqIEBwYXJhbSB7Kn0gdwogKiBAcGFyYW0geyp9IGgKICovCmZ1bmN0aW9uIHJlY3QoeCwgeSwgdywgaCkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgaCA9IHc7CiAgICB3ID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeCwgeSk7CiAgdmVydGV4KHggKyB3LCB5KTsKICB2ZXJ0ZXgoeCArIHcsIHkgKyBoKTsKICB2ZXJ0ZXgoeCwgeSArIGgpOwogIHZlcnRleCh4LCB5KTsKICBlbmQoKTsKfQoKLyoqCiAqIGRyYXcgYSBjYXJkaW5hbCBzcGxpbmUgd2l0aCB2aXJ0dWFsIHN0YXJ0IGFuZCBlbmQgcG9pbnQKICoKICogQHBhcmFtIHsqfSBwb2ludHMKICogQHBhcmFtIHsqfSB2aXJ0dWFsCiAqIEBwYXJhbSB7Kn0gdGlnaHRuZXNzCiAqIEBwYXJhbSB7Kn0gVAogKi8KZnVuY3Rpb24gc3BsaW5lKC4uLmFyZ3MpIHsKICBsZXQgcG9pbnRzID0gYXJnczsKICBsZXQgdmlydHVhbCA9IHRydWU7CiAgbGV0IFQgPSAxOwoKICBpZiAodHlwZW9mIGFyZ3NbYXJncy5sZW5ndGggLSAxXSA9PT0gYGJvb2xlYW5gKSB7CiAgICBbdmlydHVhbF0gPSBhcmdzLnNwbGljZShhcmdzLmxlbmd0aCAtIDEsIDEpOwogIH0KCiAgaWYgKHR5cGVvZiBhcmdzW2FyZ3MubGVuZ3RoIC0gMl0gPT09IGBib29sZWFuYCkgewogICAgW3ZpcnR1YWwsIFRdID0gYXJncy5zcGxpY2UoYXJncy5sZW5ndGggLSAyLCAyKTsKICB9CgogIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gYG51bWJlcmApIHsKICAgIHBvaW50cyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHBvaW50cy5wdXNoKHsgeDogYXJnc1tpXSwgeTogYXJnc1tpICsgMV0gfSk7CiAgICB9CiAgfQoKICBsZXQgY3BvaW50cyA9IHBvaW50czsKICBpZiAodmlydHVhbCkgewogICAgY29uc3QgZjAgPSBwb2ludHNbMF0sCiAgICAgIGYxID0gcG9pbnRzWzFdLAogICAgICBmMiA9IHBvaW50c1syXSwKICAgICAgZnNtID0gbmV3IFZlY3RvcihmMC54IC8gMiArIGYyLnggLyAyLCBmMC55IC8gMiArIGYyLnkgLyAyKSwKICAgICAgZjByID0gbmV3IFZlY3RvcihmMCkucmVmbGVjdChmMSksCiAgICAgIGZzciA9IGZzbS5yZWZsZWN0KGYxKSwKICAgICAgZm4gPSBuZXcgVmVjdG9yKGYwci54IC8gMiArIGZzci54IC8gMiwgZjByLnkgLyAyICsgZnNyLnkgLyAyKSwKICAgICAgbDIgPSBwb2ludHMuYXQoLTMpLAogICAgICBsMSA9IHBvaW50cy5hdCgtMiksCiAgICAgIGwwID0gcG9pbnRzLmF0KC0xKSwKICAgICAgbHNtID0gbmV3IFZlY3RvcihsMC54IC8gMiArIGwyLnggLyAyLCBsMC55IC8gMiArIGwyLnkgLyAyKSwKICAgICAgbDByID0gbmV3IFZlY3RvcihsMCkucmVmbGVjdChsMSksCiAgICAgIGxuID0gbmV3IFZlY3RvcihsMHIueCAvIDIgKyBsc20ueCAvIDIsIGwwci55IC8gMiArIGxzbS55IC8gMik7CiAgICBjcG9pbnRzID0gW2ZuLCAuLi5wb2ludHMsIGxuXTsKICB9CgogIC8vIGZvdXIgcG9pbnQgc2xpZGluZyB3aW5kb3cgb3ZlciB0aGUgc2VnbWVudAogIHN0YXJ0KCk7CiAgZm9yIChsZXQgaSA9IDAsIGUgPSBjcG9pbnRzLmxlbmd0aCAtIDM7IGkgPCBlOyBpKyspIHsKICAgIGxldCBbYzEsIGMyLCBjMywgYzRdID0gY3BvaW50cy5zbGljZShpLCBpICsgNCk7CiAgICBsZXQgcDIgPSB7CiAgICAgIHg6IGMyLnggKyAoYzMueCAtIGMxLngpIC8gKDYgKiBUKSwKICAgICAgeTogYzIueSArIChjMy55IC0gYzEueSkgLyAoNiAqIFQpLAogICAgfTsKICAgIGxldCBwMyA9IHsKICAgICAgeDogYzMueCAtIChjNC54IC0gYzIueCkgLyAoNiAqIFQpLAogICAgICB5OiBjMy55IC0gKGM0LnkgLSBjMi55KSAvICg2ICogVCksCiAgICB9OwogICAgYmV6aWVyKGMyLCBwMiwgcDMsIGMzKTsKICB9CiAgZW5kKCk7Cn0KCi8qKgogKiBTdGFydHMgYSAobmV3KSBzaGFwZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYGdvbGRgKTsKICogICAgICAgc3RhcnQoKTsKICogICAgICAgdmVydGV4KDAsaGVpZ2h0LzIpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgMCk7CiAqICAgICAgIHZlcnRleCh3aWR0aCwgaGVpZ2h0LzIpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgaGVpZ2h0KTsKICogICAgICAgZW5kKHRydWUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqLwpmdW5jdGlvbiBzdGFydCgpIHsKICBpZiAoX19jdHgubGluZVdpZHRoICUgMiA9PT0gMSkgewogICAgX19jdHgudHJhbnNsYXRlKDAuNSwgMC41KTsKICB9CiAgX19jdHguYmVnaW5QYXRoKCk7CiAgX19maXJzdCA9IGZhbHNlOwp9CgovKioKICogRHJhdyBzb21lIHRleHQgdG8gdGhlIHNjcmVlbi4gSXRzIHBsYWNlbWVudCBpcwogKiBkZXRlcm1pbmVkIGJ5IGJvdGggdGhlIGNvb3JkaW5hdGUgcHJvdmlkZWQsIGFuZAogKiB0aGUgeC95IGFsaWdubWVudCBwcm92aWRlZC4gVmFsaWQgYHhBbGlnbmAgdmFsdWVzCiAqIGFyZToKICoKICogICBDRU5URVIgLSB0aGUgdGV4dCBhbmNob3IgaXMgaW4gdGhlIG1pZGRsZSBvZiB0aGUgdGV4dC4gVGV4dCBpcyBwbGFjZWQgZXZlbmx5IG9uIGVpdGhlciBzaWRlLgogKiAgIEVORCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgcmlnaHQgZm9yIExUUiB0ZXh0LCBhbmQgb24gdGhlIGxlZnQgZm9yIFJUTCB0ZXh0LgogKiAgIExFRlQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIGxlZnQgc2lkZSBvZiB0aGUgdGV4dC4gYWxsIHRleHQgaXMgdG8gdGhlIHJpZ2h0LgogKiAgIFJJR0hUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSByaWdodCBzaWRlIG9mIHRoZSB0ZXh0LiBBbGwgdGV4dCBpcyB0byB0aGUgbGVmdC4KICogICBTVEFSVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgbGVmdCBmb3IgTFRSIHRleHQsIGFuZCBvbiB0aGUgcmlnaHQgZm9yIFJUTCB0ZXh0LgogKgogKiBWYWxpZCBgeUFsaWduYCB2YWx1ZXMgYXJlOgogKgogKiAgIEFMUEhBQkVUSUMgLSBzdGFuZGFyZCB0ZXh0IGFsaWdubWVudAogKiAgIEJPVFRPTSAtIHRoZSB0ZXh0IGlzIGFsaWduZWQgdG8gdGhlIGJvdHRvbSBvZiB0aGUgYm91bmRpbmcgYm94CiAqICAgSEFOR0lORyAtIHJlbGV2YW50IGZvciBUaWJldGFuIGFuZCBvdGhlciBJbmRpYyBzY3JpcHRzLgogKiAgIElERU9HUkFQSElDIC0gcmVsZXZhbnQgZm9yIGlkZW9ncmFwaGljIENKS1YgdGV4dC4KICogICBNSURETEUgLSBUaGUgdmVydGljYWwgZXF1aXZhbGVudCBvZiAiY2VudGVyIi4KICogICBUT1AgLSBUaGUgdGV4dCBpcyBhbGlnbmVkIHRvIHRoZSB0b3Agb2YgdGhlIHR5cG9ncmFwaGljICJlbSBzcXVhcmUiLgogKgogKiBOb3RlIHRoYXQgdGhlIHByaW1hcnkgdGV4dCBjb2xvdXIgdXNlcyB0aGUgZmlsbCBjb2xvdXIuIElmIHRleHQKICogc3Ryb2tpbmcgaXMgZW5hYmxlZCwgdGhlIHRoZSB0ZXh0IG91dGxpbmUgd2lsbCBiZSBjb2xvdXJlZCB1c2luZwogKiB0aGUgY3VycmVudCBzdHJva2UgY29sb3VyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoIm5vcm1hbCB0ZXh0Iiwgd2lkdGgvMiwgNjAsIENFTlRFUiwgQ0VOVEVSKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHRleHQoInVuZmlsbGVkIHRleHQiLCB3aWR0aC8yLCAxMDAsIENFTlRFUiwgQ0VOVEVSKTsKICogICAgICAgc2V0U3Ryb2tlKGByZWRgKTsKICogICAgICAgc2V0RmlsbChgeWVsbG93YCk7CiAqICAgICAgIHRleHQoImZhbmN5IHRleHQiLCB3aWR0aC8yLCAxNDAsIENFTlRFUiwgQ0VOVEVSKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0geyp9IHN0cgogKiBAcGFyYW0geyp9IHgKICogQHBhcmFtIHsqfSB5CiAqIEBwYXJhbSB7Kn0geEFsaWduCiAqIEBwYXJhbSB7Kn0geUFsaWduCiAqCiAqIEBwYXJhbSB7Kn0gc3RyCiAqIEBwYXJhbSB7Kn0gcAogKiBAcGFyYW0geyp9IHhBbGlnbgogKiBAcGFyYW0geyp9IHlBbGlnbgogKi8KZnVuY3Rpb24gdGV4dChzdHIsIHgsIHksIHhBbGlnbiwgeUFsaWduKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5QWxpZ24gPSB4QWxpZ247CiAgICB4QWxpZ24gPSB5OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBzYXZlKCk7CiAgaWYgKHhBbGlnbikgewogICAgc2V0VGV4dEFsaWduKHhBbGlnbiwgeUFsaWduKTsKICB9CiAgX19jdHguZmlsbFRleHQoc3RyLCB4LCB5KTsKICBpZiAoX190ZXh0U3Ryb2tlKSB7CiAgICBzZXRTdHJva2UoX190ZXh0U3Ryb2tlKTsKICAgIF9fY3R4LnN0cm9rZVRleHQoc3RyLCB4LCB5KTsKICB9CiAgcmVzdG9yZSgpOwp9CgovKioKICogRHJhdyBhIHRyaWFuZ2xlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHRyaWFuZ2xlKHdpZHRoLzIsIDMwLCAxLzQgKiB3aWR0aCwgMTYwLCAzLzQgKiB3aWR0aCwgMTEwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0geyp9IHgxCiAqIEBwYXJhbSB7Kn0geTEKICogQHBhcmFtIHsqfSB4MgogKiBAcGFyYW0geyp9IHkyCiAqIEBwYXJhbSB7Kn0geDMKICogQHBhcmFtIHsqfSB5MwogKgogKiBAcGFyYW0geyp9IHAxCiAqIEBwYXJhbSB7Kn0gcDIKICogQHBhcmFtIHsqfSBwMwogKi8KZnVuY3Rpb24gdHJpYW5nbGUoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykgewogIGlmICh4MS54ICE9PSB1bmRlZmluZWQgJiYgeDEueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5MyA9IHgyLnk7CiAgICB4MyA9IHgyLng7CiAgICB5MiA9IHkxLnk7CiAgICB4MiA9IHkxLng7CiAgICB5MSA9IHgxLnk7CiAgICB4MSA9IHgxLng7CiAgfQoKICBzdGFydCgpOwogIHZlcnRleCh4MSwgeTEpOwogIHZlcnRleCh4MiwgeTIpOwogIHZlcnRleCh4MywgeTMpOwogIHZlcnRleCh4MSwgeTEpOwogIGVuZCgpOwp9CgovKioKICogQWRkIGEgdmVydGV4IHRvIHRoZSBjdXJyZW50bHkgYWN0aXZlIHNoYXBlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHN0YXJ0KCk7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCAzMCk7CiAqICAgICAgIHZlcnRleCgxLzQgKiB3aWR0aCwgMTYwKTsKICogICAgICAgdmVydGV4KDMvNCAqIHdpZHRoLCAxMTApOwogKiAgICAgICBlbmQoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0geyp9IHgKICogQHBhcmFtIHsqfSB5CiAqCiAqIEBwYXJhbSB7Kn0gcAogKi8KZnVuY3Rpb24gdmVydGV4KHgsIHkpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBpZiAoX19maXJzdCkgewogICAgX19jdHgubGluZVRvKHgsIHkpOwogIH0gZWxzZSB7CiAgICBfX2ZpcnN0ID0geyB4LCB5IH07CiAgICBfX2N0eC5tb3ZlVG8oeCwgeSk7CiAgfQp9Ci8qKgogKiBDcmVhdGUgYW4gYXJyYXkgb2Ygc3BlY2lmaWVkIGxlbmd0aCwgb3B0aW9uYWxseQogKiBmaWxsZWQgdXNpbmcgdGhlIHNhbWUga2luZCBvZiBmdW5jdGlvbiB5b3UnZCBub3JtYWxsCiAqIHVzZSB3aXRoIC5tYXAoKQogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICB0cmFuc2xhdGUoMCwgaGVpZ2h0LzIpOwogKiAgICAgICBsZXQgZGF0YSA9IGFycmF5KHdpZHRoLCAoXyxpKSA9PiBbaSwgaGVpZ2h0LzIgKiBzaW4oaS8yNSldKTsKICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAqICAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Kn0gbGVuCiAqIEBwYXJhbSB7Kn0gZmlsbEZ1bmN0aW9uCiAqLwpmdW5jdGlvbiBhcnJheShsZW4sIGZpbGxGdW5jdGlvbikgewogIGNvbnN0IGFyciA9IG5ldyBBcnJheShsZW4pLmZpbGwoKTsKICBpZiAoZmlsbEZ1bmN0aW9uKSB7CiAgICByZXR1cm4gYXJyLm1hcChmaWxsRnVuY3Rpb24pOwogIH0KICByZXR1cm4gYXJyOwp9CgovKioKICogRW1wdHkgdGhlIGxpc3Qgb2YgbW92YWJsZSBwb2ludHMgaW4geW91ciBncmFwaGljLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGFkZEJ1dHRvbihgbG9ja2AsICgpID0+IHsKICogICAgICAgICBjbGVhck1vdmFibGUoKTsKICogICAgICAgICByZWRyYXcoKTsKICogICAgICAgfSk7CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgZm9yKGxldCBwIG9mIHBvaW50cykgewogKiAgICAgICAgIHNldENvbG9yKGlzTW92YWJsZShwKSA/IGByZWRgIDogYGdyZXlgKTsKICogICAgICAgICBwb2ludChwKTsKICogICAgICAgfQogKiAgICAgfQogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCx5KSB7CiAqICAgICAgIGlmIChjdXJyZW50UG9pbnQpIHJldHVybjsKICogICAgICAgY29uc3QgcCA9IG5ldyBQb2ludCh4LHkpOwogKiAgICAgICBwb2ludHMucHVzaChwKTsKICogICAgICAgc2V0TW92YWJsZShwKTsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICovCmZ1bmN0aW9uIGNsZWFyTW92YWJsZSgpIHsKICBfX21vdmFibGVfcG9pbnRzLnNwbGljZSgwLCBfX21vdmFibGVfcG9pbnRzLmxlbmd0aCk7Cn0KCi8qKgogKiBDcmVhdGUgYSBjb3B5IG9mIHRoZSBjdXJyZW50IGNhbnZhcyBlbGVtZW50CiAqIGZvciB1c2Ugc29tZXdoZXJlIGVsc2UgaW4geW91ciBvd24gY29kZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBwaW5rYCk7CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bih4LHkpIHsKICogICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCgKICogICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoYGdyYXBoaWNzOnVwZGF0ZWAsIHsKICogICAgICAgICAgIGRldGFpbDogewogKiAgICAgICAgICAgICBjYW52YXM6IGNvcHkoKQogKiAgICAgICAgICAgfQogKiAgICAgICAgIH0pCiAqICAgICAgICk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMgYSBjb3B5IG9mIHRoZSBjdXJyZW50IGNhbnZhcwogKi8KZnVuY3Rpb24gY29weSgpIHsKICBjb25zdCBjb3B5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgY2FudmFzYCk7CiAgY29weS53aWR0aCA9IHdpZHRoOwogIGNvcHkuaGVpZ2h0ID0gaGVpZ2h0OwogIGNvbnN0IGN0eCA9IGNvcHkuZ2V0Q29udGV4dChgMmRgKTsKICBjdHguZHJhd0ltYWdlKF9fY2FudmFzLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICByZXR1cm4gY29weTsKfQoKLyoqCiAqIEdlbmVyYXRlcyBhIGNvbG9yIGJhc2VkIG9uIHRoZSBIU0wgY29sb3Igc3BhY2UuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihjb2xvcig0NSwgODAsIDkwKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSBodWUgKDAsMzYwKQogKiBAcGFyYW0geyp9IHNhdHVyYXRpb24gKDAsMTAwKQogKiBAcGFyYW0geyp9IGxpZ2h0bmVzcyAoMCwxMDApCiAqIEBwYXJhbSB7Kn0gb3BhY2l0eSAoMCwxKQogKi8KZnVuY3Rpb24gY29sb3IoaCA9IF9fY3VycmVudF9odWUsIHMgPSA1MCwgbCA9IDUwLCBhID0gMSkgewogIHJldHVybiBgaHNsYSgke2h9LCR7c30lLCR7bH0lLCR7YX0pYDsKfQoKLyoqCiAqIE1hcmsgYSBzcGVjaWZpYyBjb2xvciBhcyB0aGUgaGlnaGxpZ2h0IGNvbG9yLAogKiB3aGljaCBjYXVzZXMgdGhlIGdyYXBoaWMgdG8gcmVkcmF3IHdpdGggdGhhdAogKiBjb2xvciByZXBsYWNlZCBieSB3aGljaGV2ZXIgY29sb3IgeW91IHBpY2tlZAogKiBhcyBoaWdobGlnaHQgY29sb3IuCiAqCiAqIE5vdGUgdGhhdCB5b3UgY2FuIG9ubHkgdXNlIG5hbWVkIChDU1MpIGNvbG9ycwogKiB3aXRoIHRoaXMgZnVuY3Rpb24uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEhpZ2hsaWdodENvbG9yKGBsaW1lYCk7CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dCgibGV0J3MgZ28iLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICogICAgIGZ1bmN0aW9uIHBvaW50ZXJBY3RpdmUoc3RhdGUpIHsKICogICAgICAgaWYgKHN0YXRlKSBoaWdobGlnaHQoYHJlZGApOwogKiAgICAgICBlbHNlIGhpZ2hsaWdodChmYWxzZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSBjb2xvcgogKi8KZnVuY3Rpb24gaGlnaGxpZ2h0KGNvbG9yKSB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdKSB7CiAgICBfX2hpZ2hsaWdodF9jb2xvciA9IENTU19DT0xPUl9NQVBbY29sb3JdOwogIH0gZWxzZSB7CiAgICBfX2hpZ2hsaWdodF9jb2xvciA9IGNvbG9yOwogIH0KICByZWRyYXcoKTsKfQoKLyoqCiAqIENoZWNrIHdoZXRoZXIgYSBwb2ludCBpcyByZWdpc3RlcmVkIGFzIG1vdmFibGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGBsb2NrYCwgKCkgPT4gewogKiAgICAgICAgIGNsZWFyTW92YWJsZSgpOwogKiAgICAgICAgIHJlZHJhdygpOwogKiAgICAgICB9KTsKICogICAgIH0KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBmb3IobGV0IHAgb2YgcG9pbnRzKSB7CiAqICAgICAgICAgc2V0Q29sb3IoaXNNb3ZhYmxlKHApID8gYHJlZGAgOiBgZ3JleWApOwogKiAgICAgICAgIHBvaW50KHApOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bih4LHkpIHsKICogICAgICAgaWYgKGN1cnJlbnRQb2ludCkgcmV0dXJuOwogKiAgICAgICBjb25zdCBwID0gbmV3IFBvaW50KHgseSk7CiAqICAgICAgIHBvaW50cy5wdXNoKHApOwogKiAgICAgICBzZXRNb3ZhYmxlKHApOwogKiAgICAgICByZWRyYXcoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcmV0dXJucyB0cnVlIG9yIGZhbHNlCiAqLwpmdW5jdGlvbiBpc01vdmFibGUocG9pbnQpIHsKICByZXR1cm4gX19tb3ZhYmxlX3BvaW50cy5pbmNsdWRlcyhwb2ludCk7Cn0KCi8qKgogKiBHZXQgdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdGhhdCB0aGlzCiAqIGdyYXBoaWMgaGFzIGJlZW4gcnVubmluZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKXwwOwogKiAgICAgICB0ZXh0KGAke3NlY29uZHN9c2AsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEByZXR1cm5zIG51bWJlciBvZiBtaWxsaXNlY29uZHMKICovCmZ1bmN0aW9uIG1pbGxpcygpIHsKICByZXR1cm4gRGF0ZS5ub3coKSAtIF9fc3RhcnRfdGltZTsKfQoKLyoqCiAqIFBhdXNlIHRoZSBncmFwaGljIGlmIGl0cyBjdXJyZW50bHkgcGxheWluZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKS50b0ZpeGVkKDEpOwogKiAgICAgICB0ZXh0KGAke3NlY29uZHN9c2AsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICBpZihzdGF0ZSkgewogKiAgICAgICAgIHBhdXNlKCk7CiAqICAgICAgIH0gZWxzZSB7CiAqICAgICAgICAgcGxheSgpOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIHBhdXNlKCkgewogIHBsYXlpbmcgPSBmYWxzZTsKfQoKLyoqCiAqIFN0YXJ0IHBsYXlpbmcgeW91ciBncmFwaGljLCBtZWFuaW5nIGl0IHdpbGwgY2FsbCBkcmF3KCkKICogYXQgd2hhdGV2ZXIgcmF0ZSB0aGUgcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGxvb3AgaXMKICogYWxsb3dlZCB0byBydW4gb24geW91ciBjb21wdXRlci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGxldCBmcHMgPSAwOwogKiAgICAgbGV0IGNoZWNrZWQgPSBmYWxzZTsKICogICAgIGxldCBsYXN0RnJhbWVDaGVjayA9IDA7CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIGNvbnN0IHNlY29uZHMgPSAobWlsbGlzKCkvMTAwMCkudG9GaXhlZCgxKTsKICogICAgICAgdGV4dChgZnBzOiAke2Zwc31gLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgICAgaWYgKHNlY29uZHMuZW5kc1dpdGgoYC4wYCkpIHsKICogICAgICAgICBpZiAoIWNoZWNrZWQpIHsKICogICAgICAgICAgIGNoZWNrZWQgPSB0cnVlOwogKiAgICAgICAgICAgZnBzID0gZnJhbWUgLSBsYXN0RnJhbWVDaGVjazsKICogICAgICAgICAgIGxhc3RGcmFtZUNoZWNrID0gZnJhbWU7CiAqICAgICAgICAgfQogKiAgICAgICB9IGVsc2UgewogKiAgICAgICAgIGNoZWNrZWQgPSBmYWxzZTsKICogICAgICAgfQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqLwpmdW5jdGlvbiBwbGF5KCkgewogIHBsYXlpbmcgPSB0cnVlOwogIF9fZHJhdygpOwp9CgovKioKICogR2VuZXJhdGUgYSByYW5kb20gY29sb3VyLiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbgogKiBhbGxvd3MgeW91IHRvIGdldCAidGhlIGN1cnJlbnRseSBnZW5lcmF0ZWQgcmFuZG9tCiAqIGNvbG91ciIgaW4gZGlmZmVyZW50IG9wYWNpdGllcyBieSBjYWxsaW5nIHRoZSBmdW5jdGlvbgogKiB3aXRoIGFuIG9wYWNpdHkgdmFsdWUsIGFuZCBgZmFsc2VgIGFzIGN5Y2xlIGFyZ3VtZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIocmFuZG9tQ29sb3IoKSk7CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bigpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICoKICogQHBhcmFtIHsqfSBvcGFjaXR5CiAqIEBwYXJhbSB7Kn0gY3ljbGUgdG8gbmV4dCBjb2xvdXIgKGRlZmF1bHQ9dHJ1ZSkKICovCmZ1bmN0aW9uIHJhbmRvbUNvbG9yKGEgPSAxLjAsIGN5Y2xlID0gdHJ1ZSkgewogIGlmIChjeWNsZSkgX19jdXJyZW50X2h1ZSA9IChfX2N1cnJlbnRfaHVlICsgNzMpICUgMzYwOwogIHJldHVybiBgaHNsYSgke19fY3VycmVudF9odWV9LDUwJSw1MCUsJHthfSlgOwp9CgovKioKICogQW4gYWx0ZXJuYXRpdmUgdG8gd3JpdGluZyBmb3IgbG9vcHMsIGJlY2F1c2UKICogbm8gb25lIHdhbnRzIHRvIGNvbnN0YW50bHkgd3JpdGUgdmFyIGFsbG9jYXRpb25zCiAqIHRoYXQgb25seSBsaXZlIGZvciB0aGUgZHVyYXRpb24gb2YgYSBsb29wLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHJhbmdlKDAsIFRBVSwgKGEpID0+IHBvaW50KDQwICogY29zKGEpLCA0MCAqIHNpbihhKSkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqCiAqIEBwYXJhbSB7Kn0gc3RhcnQKICogQHBhcmFtIHsqfSBlbmQKICogQHBhcmFtIHsqfSBzdGVwPwogKiBAcGFyYW0geyp9IHJ1bkZ1bmN0aW9uCiAqLwpmdW5jdGlvbiByYW5nZShzdGFydCwgZW5kLCBzdGVwLCBydW5GdW5jdGlvbikgewogIGlmICh0eXBlb2Ygc3RlcCA9PT0gYGZ1bmN0aW9uYCkgewogICAgcnVuRnVuY3Rpb24gPSBzdGVwOwogICAgc3RlcCA9IChlbmQgLSBzdGFydCkgLyAxMDsKICB9CiAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpICs9IHN0ZXApIHsKICAgIHJ1bkZ1bmN0aW9uKGkpOwogIH0KfQoKLyoqCiAqIE1hcmsgb25lIG9yIG1vcmUgcG9pbnRzIGFzIG1vdmFibGUsIG1lYW5pbmcKICogdGhhdCB0aGUgdXNlciBjYW4gcmVwb3NpdGlvbiB0aGUgcG9pbnQgYXJvdW5kIG9uCiAqIHRoZSBjYW52YXMgYnkgdG91Y2gvY2xpY2stZHJhZ2dpbmcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgZm9yIChsZXQgaSA9IDQwOyBpIDwgMjAwOyBpICs9IDIwKSB7CiAqICAgICAgICAgcG9pbnRzLnB1c2gobmV3IFBvaW50KGkgLSAyMCwgMTIwKSk7CiAqICAgICAgIH0KICogICAgICAgc2V0TW92YWJsZSguLi5wb2ludHMpOwogKiAgICAgfQogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHNldFN0cm9rZShgcHVycGxlYCk7CiAqICAgICAgIGJzcGxpbmUoLi4ucG9pbnRzKTsKICogICAgICAgZm9yKGxldCBwIG9mIHBvaW50cykgcG9pbnQocCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSBwb2ludHMKICovCmZ1bmN0aW9uIHNldE1vdmFibGUoLi4ucG9pbnRzKSB7CiAgcG9pbnRzLmZvckVhY2goKHApID0+IHsKICAgIGlmIChfX21vdmFibGVfcG9pbnRzLmluZGV4T2YocCkgPT09IC0xKSB7CiAgICAgIF9fbW92YWJsZV9wb2ludHMucHVzaChwKTsKICAgIH0KICB9KTsKfQoKLyoqCiAqIFJlc3RvcmUgdGhlIGdyYXBoaWNzIGNvbnRleHQgKHRyYW5zZm9ybXMsCiAqIGN1cnJlbnQgY29sb3JzLCBldGMpIHRvIHdoYXQgdGhleSB3ZXJlCiAqIHdoZW4gc2F2ZSgpIHdhcyBjYWxsZWQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIGxpbmUoMCwwLDgwLDApOwogKiAgICAgICBzYXZlKCk7CiAqICAgICAgIHNldENvbG9yKGBkYXJrZ3JlZW5gKQogKiAgICAgICByYW5nZSgwLCA1LCAxLCAoYSkgPT4gewogKiAgICAgICAgIHJvdGF0ZShQSS84KTsKICogICAgICAgICBsaW5lKDAsMCw4MCwwKTsKICogICAgICAgfSk7CiAqICAgICAgIHJlc3RvcmUoKTsKICogICAgICAgbGluZSgtMjAsMCwtODAsMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIHJlc3RvcmUoKSB7CiAgX19jdHgucmVzdG9yZSgpOwp9CgovKioKICogU2F2ZSB0aGUgY3VycmVudCBncmFwaGljcyBjb250ZXh0ICh0cmFuc2Zvcm1zLAogKiBjdXJyZW50IGNvbG9ycywgZXRjKSBzbyB0aGF0IHRob3NlIGNhbiBiZSByZXN0b3JlZAogKiBhZnRlciBjaGFuZ2luZyB0aGVtLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICBsaW5lKDAsMCw4MCwwKTsKICogICAgICAgc2F2ZSgpOwogKiAgICAgICBzZXRDb2xvcihgZGFya2dyZWVuYCkKICogICAgICAgcmFuZ2UoMCwgNSwgMSwgKGEpID0+IHsKICogICAgICAgICByb3RhdGUoUEkvOCk7CiAqICAgICAgICAgbGluZSgwLDAsODAsMCk7CiAqICAgICAgIH0pOwogKiAgICAgICByZXN0b3JlKCk7CiAqICAgICAgIGxpbmUoLTIwLDAsLTgwLDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqLwpmdW5jdGlvbiBzYXZlKCkgewogIF9fY3R4LnNhdmUoKTsKfQoKLyoqCiAqIENvbnZlcnQgdGhlIGN1cnJlbnQgY2FudmFzIGludG8gYW4gZGF0YSBVUkwKICogdGhhdCByZXByZXNlbnRzIGEgUE5HIGltYWdlLgogKiBAcmV0dXJucyBkYXRhVVJMCiAqLwpmdW5jdGlvbiB0b0RhdGFVUkwoKSB7CiAgcmV0dXJuIF9fY2FudmFzLnRvRGF0YVVSTCgpOwp9CgovKioKICogSWYgdGhlIGdyYXBoaWMgaXMgY3VycmVudGx5IHBsYXlpbmcsIHBhdXNlIGl0LAogKiBhbmQgaWYgaXQncyBwYXVzZWQsIHBsYXkgaXQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIGNvbnN0IHNlY29uZHMgPSAobWlsbGlzKCkvMTAwMCkudG9GaXhlZCgxKTsKICogICAgICAgdGV4dChgJHtzZWNvbmRzfXNgLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICogICAgIGZ1bmN0aW9uIHBvaW50ZXJBY3RpdmUoc3RhdGUpIHsKICogICAgICAgdG9nZ2xlUGxheSgpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEByZXR1cm5zIHRoZSBuZXcgcGxheSBzdGF0ZSBhcyBib29sZWFuCiAqLwpmdW5jdGlvbiB0b2dnbGVQbGF5KCkgewogIHBsYXlpbmcgPyBwYXVzZSgpIDogcGxheSgpOwogIHJldHVybiBwbGF5aW5nOwp9Ci8qKgogKiBQcm9qZWN0IGEgM0QgY29vcmRpbmF0ZSB0byAyRC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgNTAsIC0wLjQpOwogKiAgICAgfQogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIC0xLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAtMSksIHByb2plY3QoMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgMSwgMSksIHByb2plY3QoLTEsIC0xLCAxKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKiBAcGFyYW0geyp9IHoKICogLW9yLQogKiBAcGFyYW0geyp9IHAKICoKICogQHJldHVybnMgcAogKi8KZnVuY3Rpb24gcHJvamVjdCh4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkICYmIHgueiAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICByZXR1cm4gX19wcm9qZWN0b3IucHJvamVjdCh4LCB5LCB6KTsKfQoKLyoqCiAqIFNldCB0aGUgcHJvamVjdG9yJ3MgeCwgeSwgYW5kIHogYXhpcyByb3RhdGlvbgogKiBpbiByYWRpYW5zLiBOb3RlIHRoYXQgdGhlc2UgYXJlIGFwcGxpZWQgaW4gb3JkZXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldFByb2plY3Rvcih3aWR0aCAvIDIsIGhlaWdodCAvIDIsIDUwLCAtMC40KTsKICogICAgICAgcGxheSgpOwogKiAgICAgfSoqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgY29uc3QgbSA9IG1pbGxpcygpIC8gNTAwMDsKICogICAgICAgcm90YXRlUHJvamVjdG9yKG0sIDIgKiBtLCAzICogbSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIC0xLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAtMSksIHByb2plY3QoMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgMSwgMSksIHByb2plY3QoLTEsIC0xLCAxKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKiBAcGFyYW0geyp9IHoKICovCmZ1bmN0aW9uIHJvdGF0ZVByb2plY3Rvcih4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkICYmIHgueiAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIF9fcHJvamVjdG9yLnNldFJvdGF0aW9uKHgsIHksIHopOwp9CgovKioKICogU2V0IHRoZSBwcm9qZWN0IHBhcmFtZXRlcnMuIEN1cnJlbnRseSwgb25seQogKiBjYWJpbmV0IHByb2plY3QgaXMgc3VwcG9ydGVkLCB3aGljaCBhY2NlcHRzCiAqIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgNTAsIC0wLjQpOwogKiAgICAgfQogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIC0xLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAtMSksIHByb2plY3QoMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgMSwgMSksIHByb2plY3QoLTEsIC0xLCAxKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtICB7bnVtYmVyfSB4T2Zmc2V0IG9mIHRoZSBwcm9qZWN0aW9uIHdydCB0aGUgY2FudmFzIChkZWZhdWx0ID0gMCkKICogQHBhcmFtICB7bnVtYmVyfSB5T2Zmc2V0IG9mIHRoZSBwcm9qZWN0aW9uIHdydCB0aGUgY2FudmFzIChkZWZhdWx0ID0gMCkKICogQHBhcmFtICB7bnVtYmVyfSBzY2FsZSBmYWN0b3IgZm9yIHRoZSAzRCBpbnB1dCAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSAge251bWJlcn0gY2FiaW5ldCBhbmdsZSBpbiByYWRpYW5zIChkZWZhdWx0ID0gLXBpLzYpCiAqLwpmdW5jdGlvbiBzZXRQcm9qZWN0b3IoLi4uYXJncykgewogIF9fcHJvamVjdG9yLnVwZGF0ZSguLi5hcmdzKTsKfQovKioKICogU2V0IGEgYm9yZGVyIGFyb3VuZCB0aGUgY2FudmFzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRCb3JkZXIoMTAsIGByZWRgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0geyp9IHdpZHRoCiAqIEBwYXJhbSB7Kn0gY29sb3IKICovCmZ1bmN0aW9uIHNldEJvcmRlcih3aWR0aCA9IDEsIGNvbG9yID0gYGJsYWNrYCkgewogIGlmICghd2lkdGgpIHsKICAgIF9fY2FudmFzLnN0eWxlLmJvcmRlciA9IGBub25lYDsKICB9IGVsc2UgewogICAgX19jYW52YXMuc3R5bGUuYm9yZGVyID0gYCR7d2lkdGh9cHggc29saWQgJHtjb2xvcn1gOwogIH0KfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBzdHJva2UgYW5kIGZpbGwgY29sb3VyIGF0CiAqIHRoZSBzYW1lIHRpbWUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICByZWN0KDUwLCA1MCwgMTAwLCAxMDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Kn0gY29sb3IKICovCmZ1bmN0aW9uIHNldENvbG9yKGNvbG9yKSB7CiAgc2V0RmlsbChjb2xvcik7CiAgc2V0U3Ryb2tlKGNvbG9yKTsKfQoKLyoqCiAqIENoYW5nZSB0aGUgY3Vyc29yIHRvIGEgc3BlY2lmaWMgaWNvbjoKICoKICogIEFVVE8gLSB1c2Ugd2hhdGV2ZXIgdGhlIGJyb3dzZXIgd291bGQgb3RoZXJ3aXNlIHVzZQogKiAgQ1JPU1MgLSB1c2UgYSBjcm9zcy1oYWlyIGljb24KICogIFBPSU5URVIgLSB1c2UgdGhlICJwb2ludGVyIiBpY29uIHRoYXQgaXMgYWxzbyB1c2VkIGZvciBjbGlja2FibGUgbGlua3MKICoKICogVXNlIGFueSBvdGhlciBzdHJpbmcgZm91bmQgb3ZlciBvbiB0aGUgTUROIGN1cnNvciBhcnRpY2xlIHRvIHNldCBhIGN1cnNvciBub3QgY292ZXJlZCBieSB0aGUgYWJvdmUgY29uc3RhbnRzLgogKgogKiBAcGFyYW0geyp9IHR5cGUKICovCmZ1bmN0aW9uIHNldEN1cnNvcih0eXBlKSB7CiAgX19jdXJyZW50X2N1cnNvciA9IHR5cGU7CiAgX19jYW52YXMuc3R5bGUuY3Vyc29yID0gX19jdXJyZW50X2N1cnNvcjsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBmaWxsIGNvbG91ci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHJlY3QoNTAsIDUwLCAxMDAsIDEwMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSBjb2xvcgogKi8KZnVuY3Rpb24gc2V0RmlsbChjb2xvciA9IGBibGFja2ApIHsKICBpZiAoQ1NTX0NPTE9SX01BUFtjb2xvcl0gPT09IF9faGlnaGxpZ2h0X2NvbG9yKSB7CiAgICBjb2xvciA9IF9fY3VycmVudF9oaWdobGlnaHRfY29sb3I7CiAgfQogIF9fY3R4LmZpbGxTdHlsZSA9IGNvbG9yOwp9CgovKioKICoKICogQHBhcmFtIHsqfSBmb250CiAqLwpmdW5jdGlvbiBzZXRGb250KGZvbnQpIHsKICBfX2N0eC5mb250ID0gZm9udCB8fCBgJHtfX2ZvbnQud2VpZ2h0fSAke19fZm9udC5zaXplfXB4ICR7X19mb250LmZhbWlseX1gOwp9CgovKioKICoKICogQHBhcmFtIHsqfSBuYW1lCiAqLwpmdW5jdGlvbiBzZXRGb250RmFtaWx5KG5hbWUpIHsKICBfX2ZvbnQuZmFtaWx5ID0gbmFtZTsKICBzZXRGb250KCk7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IHB4CiAqLwpmdW5jdGlvbiBzZXRGb250U2l6ZShweCkgewogIF9fZm9udC5zaXplID0gcHg7CiAgc2V0Rm9udCgpOwp9CgovKioKICoKICogQHBhcmFtIHsqfSB2YWwKICovCmZ1bmN0aW9uIHNldEZvbnRXZWlnaHQodmFsKSB7CiAgX19mb250LndlaWdodCA9IHZhbDsKICBzZXRGb250KCk7Cn0KCi8qKgogKiBTZXQgdGhlIGJhY2tncm91bmQgZ3JpZCBzcGFjaW5nIGFuZCBjb2xvdXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRHcmlkKDIwLCBgbGF2ZW5kZXJgKTsKICogICAgIH0KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Kn0gc3BhY2luZwogKiBAcGFyYW0geyp9IGNvbG9yCiAqLwpmdW5jdGlvbiBzZXRHcmlkKHNwYWNpbmcgPSAyMCwgY29sb3IgPSBgbGlnaHRncmV5YCkgewogIF9fZHJhd19ncmlkID0gdHJ1ZTsKICBfX2dyaWRfc3BhY2luZyA9IHNwYWNpbmc7CiAgX19ncmlkX2NvbG9yID0gY29sb3I7Cn0KCi8qKgogKiBTZXQgdGhlIGNvbG9yIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gcmVwbGFjZSB3aGF0ZXZlcgogKiBoaWdobGlnaHQoKSBtYXJrZWQgYXMgdGhlICJ0byBoaWdobGlnaHQiIGNvbG9yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRIaWdobGlnaHRDb2xvcihgbGltZWApOwogKiAgICAgfQogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHRleHQoImxldCdzIGdvIiwgd2lkdGgvMiwgaGVpZ2h0LzIpCiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBwb2ludGVyQWN0aXZlKHN0YXRlKSB7CiAqICAgICAgIGlmIChzdGF0ZSkgaGlnaGxpZ2h0KGByZWRgKTsKICogICAgICAgZWxzZSBoaWdobGlnaHQoZmFsc2UpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Kn0gY29sb3IKICovCmZ1bmN0aW9uIHNldEhpZ2hsaWdodENvbG9yKGNvbG9yKSB7CiAgX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvciA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBsaW5lIGRhc2ggcHJvcGVydHkuIFNlZSB0aGUgZm9sbG93aW5nIE1ETiBhcnRpY2xlIGZvciB0aGUgZGV0YWlsczoKICoKICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZG9jcy9XZWIvQVBJL0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC9zZXRMaW5lRGFzaAogKgogKiBAcGFyYW0gIHthbnlbXX0gdmFsdWVzCiAqLwpmdW5jdGlvbiBzZXRMaW5lRGFzaCguLi52YWx1ZXMpIHsKICBfX2N0eC5zZXRMaW5lRGFzaCh2YWx1ZXMpOwp9CgovKioKICogU2V0IHRoZSBsaW5lIHdpZHRoIGluIHBpeGVscy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcmFuZ2UoMSwgMTAsIChpKSA9PiB7CiAqICAgICAgICAgc2V0TGluZVdpZHRoKGkpOwogKiAgICAgICAgIGxpbmUoMjAsIGkgKiAyMCwgMTgwLCBpICogMjApOwogKiAgICAgICB9KQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Kn0gd2lkdGgKICovCmZ1bmN0aW9uIHNldExpbmVXaWR0aCh3aWR0aCA9IDEpIHsKICBfX2N0eC5saW5lV2lkdGggPSB3aWR0aDsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBzdHJva2UgY29sb3VyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0geyp9IGNvbG9yCiAqLwpmdW5jdGlvbiBzZXRTdHJva2UoY29sb3IgPSBgYmxhY2tgKSB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdID09PSBfX2hpZ2hsaWdodF9jb2xvcikgewogICAgY29sb3IgPSBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwogIH0KICBfX2N0eC5zdHJva2VTdHlsZSA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IHRleHQgYWxpZ25tZW50IHZhbHVlcy4KICoKICogVmFsaWQgYHhBbGlnbmAgdmFsdWVzIGFyZToKICoKICogICBDRU5URVIgLSB0aGUgdGV4dCBhbmNob3IgaXMgaW4gdGhlIG1pZGRsZSBvZiB0aGUgdGV4dC4gVGV4dCBpcyBwbGFjZWQgZXZlbmx5IG9uIGVpdGhlciBzaWRlLgogKiAgIEVORCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgcmlnaHQgZm9yIExUUiB0ZXh0LCBhbmQgb24gdGhlIGxlZnQgZm9yIFJUTCB0ZXh0LgogKiAgIExFRlQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIGxlZnQgc2lkZSBvZiB0aGUgdGV4dC4gYWxsIHRleHQgaXMgdG8gdGhlIHJpZ2h0LgogKiAgIFJJR0hUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSByaWdodCBzaWRlIG9mIHRoZSB0ZXh0LiBBbGwgdGV4dCBpcyB0byB0aGUgbGVmdC4KICogICBTVEFSVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgbGVmdCBmb3IgTFRSIHRleHQsIGFuZCBvbiB0aGUgcmlnaHQgZm9yIFJUTCB0ZXh0LgogKgogKiBWYWxpZCBgeUFsaWduYCB2YWx1ZXMgYXJlOgogKgogKiAgIEFMUEhBQkVUSUMgLSBzdGFuZGFyZCB0ZXh0IGFsaWdubWVudCAoZGVmYXVsdCkKICogICBCT1RUT00gLSB0aGUgdGV4dCBpcyBhbGlnbmVkIHRvIHRoZSBib3R0b20gb2YgdGhlIGJvdW5kaW5nIGJveAogKiAgIEhBTkdJTkcgLSByZWxldmFudCBmb3IgVGliZXRhbiBhbmQgb3RoZXIgSW5kaWMgc2NyaXB0cy4KICogICBJREVPR1JBUEhJQyAtIHJlbGV2YW50IGZvciBpZGVvZ3JhcGhpYyBDSktWIHRleHQuCiAqICAgTUlERExFIC0gVGhlIHZlcnRpY2FsIGVxdWl2YWxlbnQgb2YgImNlbnRlciIuCiAqICAgVE9QIC0gVGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgdG9wIG9mIHRoZSB0eXBvZ3JhcGhpYyAiZW0gc3F1YXJlIi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRGb250U2l6ZSgyMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBsaW5lKHdpZHRoIC8gMiwgMCwgd2lkdGggLyAyLCBoZWlnaHQpOwogKiAgICAgICBsaW5lKDAsIGhlaWdodCAvIDIsIHdpZHRoLCBoZWlnaHQgLyAyKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dCgiY2VudGVyIG1pZGRsZSIsIHdpZHRoIC8gMiwgaGVpZ2h0LzIpOwogKiAgICAgICBsaW5lKDAsIGhlaWdodCAvIDIgLSA1MCwgd2lkdGgsIGhlaWdodCAvIDIgLSA1MCk7CiAqICAgICAgIHNldFRleHRBbGlnbihSSUdIVCwgVE9QKTsKICogICAgICAgdGV4dCgicmlnaHQgdG9wIiwgd2lkdGggLyAyLCBoZWlnaHQvMiAtIDUwKTsKICogICAgICAgbGluZSgwLCBoZWlnaHQgLyAyICsgNTAsIHdpZHRoLCBoZWlnaHQgLyAyICsgNTApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oTEVGVCwgQk9UVE9NKTsKICogICAgICAgdGV4dCgibGVmdCBib3R0b20iLCB3aWR0aCAvIDIsIGhlaWdodC8yICsgNTApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Kn0geEFsaWduCiAqIEBwYXJhbSB7Kn0geUFsaWduCiAqLwpmdW5jdGlvbiBzZXRUZXh0QWxpZ24oeEFsaWduLCB5QWxpZ24pIHsKICBfX2N0eC50ZXh0QWxpZ24gPSB4QWxpZ247CiAgX19jdHgudGV4dEJhc2VsaW5lID0geUFsaWduOwp9CgovKioKICogU2V0IHRoZSB0ZXh0IG91dGxpbmUgc3Ryb2tpbmcgcHJvcGVydGllcy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoYHJlZGAsIDEpOwogKiAgICAgICBzZXRGaWxsKGB5ZWxsb3dgKTsKICogICAgICAgdGV4dCgiZmFuY3kgdGV4dCIsIHdpZHRoLzIsIDgwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICAgIHNldEZvbnRTaXplKDY1KTsKICogICAgICAgc2V0VGV4dFN0cm9rZShgcmVkYCwgMyk7CiAqICAgICAgIHNldEZpbGwoYHllbGxvd2ApOwogKiAgICAgICB0ZXh0KCJmYW5jeSB0ZXh0Iiwgd2lkdGgvMiwgMTQwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSBjb2xvcgogKiBAcGFyYW0geyp9IHdpZHRoCiAqLwpmdW5jdGlvbiBzZXRUZXh0U3Ryb2tlKGNvbG9yLCB3aWR0aCA9IDEpIHsKICBfX3RleHRTdHJva2UgPSBjb2xvcjsKICBzZXRMaW5lV2lkdGgod2lkdGgpOwp9Ci8qKgogKiBSZXNldCB0aGUgY29vcmRpbmF0ZSB0cmFuc2Zvcm0gbWF0cml4LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBub0dyaWQoKTsKICogICAgIH0KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBsaWdodGdyZXlgKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICB0cmFuc2xhdGUoNTAsNTApOwogKiAgICAgICBsaW5lKDAsMCwxMDAsMCk7CiAqICAgICAgIHBvaW50KDAsMCk7CiAqICAgICAgIHNldENvbG9yKGBkYXJrZ3JlZW5gKTsKICogICAgICAgcG9pbnQoMTAsMCk7CiAqICAgICAgIHJvdGF0ZShQSS80KTsKICogICAgICAgcG9pbnQoMTAsMCk7CiAqICAgICAgIGxpbmUoMCwwLDEwMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgcm90YXRlKC1QSS82KQogKiAgICAgICBwb2ludCgxMDAsMCk7CiAqICAgICAgIHNjYWxlKDAuNSwgMC41KTsKICogICAgICAgcG9pbnQoMTAwLDApOwogKiAgICAgICBsaW5lKDEwMCwwLDIwMCwwKTsKICogICAgICAgcmVzZXRUcmFuc2Zvcm0oKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIGxpbmUoMCwzLDEwMCwzKTsKICogICAgICAgcG9pbnQoMCwzKTsKICogICAgICAgcG9pbnQoMTAsMyk7CiAqICAgICAgIHBvaW50KDEwMCwzKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKi8KZnVuY3Rpb24gcmVzZXRUcmFuc2Zvcm0oKSB7CiAgX19jdHgucmVzZXRUcmFuc2Zvcm0oKTsKfQoKLyoqCiAqIFJvdGF0ZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gd3J0IHRoZSBjdXJyZW50IG9yaWdpbi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgbGlnaHRncmV5YCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwb2ludCgwLDApOwogKiAgICAgICBzZXRDb2xvcihgZGFya2dyZWVuYCk7CiAqICAgICAgIGxpbmUoMCwwLDIwLDIwKTsKICogICAgICAgcG9pbnQoMjAsMjApOwogKiAgICAgICByb3RhdGUoUEkvNCk7CiAqICAgICAgIGxpbmUoMCwwLDIwLDIwKTsKICogICAgICAgcG9pbnQoMjAsMjApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Kn0gYW5nbGUKICovCmZ1bmN0aW9uIHJvdGF0ZShhbmdsZSA9IDApIHsKICBfX2N0eC5yb3RhdGUoYW5nbGUpOwp9CgovKioKICogU2NhbGUgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIHdydCB0aGUgY3VycmVudCBvcmlnaW4uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIG5vR3JpZCgpOwogKiAgICAgfQogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYGxpZ2h0Z3JleWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBzY2FsZSgyKTsKICogICAgICAgbGluZSgwLDAsMjAsMjApOwogKiAgICAgICBwb2ludCgyMCwyMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geT8KICovCmZ1bmN0aW9uIHNjYWxlKHggPSAxLCB5ID0geCkgewogIF9fY3R4LnNjYWxlKHgsIHkpOwp9CgovKioKICogQ29udmVydCBhIHNjcmVlbiAoZS5nLiBicm93c2VyKSBjb29yZGluYXRlIGludG8gaXRzCiAqIGNvcnJlc3BvbmRpbmcgInRyYW5zZm9ybWVkIiBjb29yZGluYXRlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBub0dyaWQoKTsKICogICAgIH0KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBsaWdodGdyZXlgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBzY2FsZSgwLjUpOwogKiAgICAgICBpZiAocG9pbnRlci5hY3RpdmUpIHsKICogICAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgICAgcG9pbnQocG9pbnRlci54LCBwb2ludGVyLnkpOwogKiAgICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgICAgcG9pbnQoc2NyZWVuVG9Xb3JsZChwb2ludGVyLngsIHBvaW50ZXIueSkpOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSgpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKiBAcmV0dXJucyBwCiAqCiAqIEBwYXJhbSB7Kn0gcAogKiBAcmV0dXJucyBwCiAqLwpmdW5jdGlvbiBzY3JlZW5Ub1dvcmxkKHgsIHkpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgbGV0IE0gPSBfX2N0eC5nZXRUcmFuc2Zvcm0oKS5pbnZlcnRTZWxmKCk7CgogIHJldHVybiBuZXcgUG9pbnQoeCAqIE0uYSArIHkgKiBNLmMgKyBNLmUsIHggKiBNLmIgKyB5ICogTS5kICsgTS5mKTsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCB0cmFuc2Zvcm0gbWF0cml4LCBiYXNlZCBvbiBhcHBseWluZzoKICoKICogICAgICAgfCBhIGIgYyB8CiAqICAgbSA9IHwgZCBlIGYgfAogKiAgICAgICB8IDAgMCAxIHwKICoKICogV2l0aCB0aGUgcGFyYW1ldGVycyBkZWZhdWx0aW5nIHRvIHRoZSBpZGVudGl0eSBtYXRyaXguCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBhCiAqIEBwYXJhbSB7bnVtYmVyfSBiCiAqIEBwYXJhbSB7bnVtYmVyfSBjCiAqIEBwYXJhbSB7bnVtYmVyfSBkCiAqIEBwYXJhbSB7bnVtYmVyfSBlCiAqIEBwYXJhbSB7bnVtYmVyfSBmCiAqLwpmdW5jdGlvbiB0cmFuc2Zvcm0oYSA9IDEsIGIgPSAwLCBjID0gMCwgZCA9IDAsIGUgPSAxLCBmID0gMCkgewogIF9fY3R4LnRyYW5zZm9ybShhLCBiLCBjLCBkLCBlLCBmKTsKfQoKLyoqCiAqIFRyYW5zbGF0ZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gYnkgc29tZSBhbW91bnQgb2YgeCBhbmQgeSB1bml0cy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHBvaW50KDAsMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKiAtb3ItCiAqIEBwYXJhbSB7Kn0gcAogKi8KZnVuY3Rpb24gdHJhbnNsYXRlKHggPSAwLCB5ID0gMCkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIF9fY3R4LnRyYW5zbGF0ZSh4LCB5KTsKfQoKLyoqCiAqIENvbnZlcnQgYW4gaW4tY2FudmFzICJ0cmFuc2Zvcm1lZCIgY29vcmRpbmF0ZSBpbnRvIGl0cwogKiBjb3JyZXNwb25kaW5nICJzY3JlZW4iIChpLmUuIGJyb3dzZXIgY2FudmFzIG9mZnNldCkgY29vcmRpbmF0ZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7CiAqICAgICAgIHJvdGF0ZShtaWxsaXMoKSAvIDIwMDApOwogKiAgICAgICBjb25zdCBwID0gbmV3IFBvaW50KDMwLCAwKTsKICogICAgICAgY29uc3QgcyA9IHdvcmxkVG9TY3JlZW4ocCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgcG9pbnQocCk7CiAqICAgICAgIHRleHQoYCR7cC54fSwke3AueX1gLCBwLnggKyAxMCwgcC55ICsgMTApOwogKiAgICAgICByZXNldFRyYW5zZm9ybSgpOwogKiAgICAgICBzZXRGb250U2l6ZSgxNik7CiAqICAgICAgIHRleHQoYCR7cy54LnRvRml4ZWQoKX0sJHtzLnkudG9GaXhlZCgpfWAsIHMueCAtIDI1LCBzLnkgLSAxNSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKiBAcmV0dXJucyBwCiAqCiAqIEBwYXJhbSB7Kn0gcAogKiBAcmV0dXJucyBwCiAqLwpmdW5jdGlvbiB3b3JsZFRvU2NyZWVuKHgsIHkpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgbGV0IE0gPSBfX2N0eC5nZXRUcmFuc2Zvcm0oKTsKCiAgcmV0dXJuIG5ldyBQb2ludCh4ICogTS5hICsgeSAqIE0uYyArIE0uZSwgeCAqIE0uYiArIHkgKiBNLmQgKyBNLmYpOwp9CmZ1bmN0aW9uIGdyaWQoKSB7CiAgc2F2ZSgpOwogIHNldExpbmVXaWR0aCgwLjUpOwogIG5vRmlsbCgpOwogIHNldFN0cm9rZShfX2dyaWRfY29sb3IpOwogIGZvciAoCiAgICBsZXQgeCA9ICgtMC41ICsgX19ncmlkX3NwYWNpbmcgLyAyKSB8IDA7CiAgICB4IDwgd2lkdGg7CiAgICB4ICs9IF9fZ3JpZF9zcGFjaW5nCiAgKSB7CiAgICBsaW5lKHgsIDAsIHgsIGhlaWdodCk7CiAgfQogIGZvciAoCiAgICBsZXQgeSA9ICgtMC41ICsgX19ncmlkX3NwYWNpbmcgLyAyKSB8IDA7CiAgICB5IDwgaGVpZ2h0OwogICAgeSArPSBfX2dyaWRfc3BhY2luZwogICkgewogICAgbGluZSgwLCB5LCB3aWR0aCwgeSk7CiAgfQogIHJlc3RvcmUoKTsKfQpmdW5jdGlvbiBfX3NhZmVseUludGVyY2VwdEtleShldnQpIHsKICAvLyBXZSBkb24ndCB3YW50IHRvIGludGVyZmVyZSB3aXRoIHRoZSBicm93c2VyLCBzbyB3ZSdyZSBvbmx5CiAgLy8gZ29pbmcgdG8gYWxsb3cgdW5tb2RpZmllZCBrZXlzLCBvciBzaGlmdC1tb2RpZmllZCBrZXlzLAogIC8vIGFuZCB0YWIgaGFzIHRvIGFsd2F5cyB3b3JrLiBGb3Igb2J2aW91cyByZWFzb25zLgogIGNvbnN0IHRhYiA9IGV2dC5rZXkgIT09ICJUYWIiOwogIGNvbnN0IGZ1bmN0aW9uS2V5ID0gZXZ0LmtleS5tYXRjaCgvRlxkKy8pID09PSBudWxsOwogIGNvbnN0IHNwZWNpZmljQ2hlY2sgPSB0YWIgJiYgZnVuY3Rpb25LZXk7CiAgaWYgKCFldnQuYWx0S2V5ICYmICFldnQuY3RybEtleSAmJiAhZXZ0Lm1ldGFLZXkgJiYgc3BlY2lmaWNDaGVjaykgewogICAgaWYgKGV2dC50YXJnZXQgPT09IF9fY2FudmFzKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBfX2tleURvd24oa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KSB7CiAga2V5Ym9hcmRba2V5XSA9IERhdGUubm93KCk7CiAgaWYgKHR5cGVvZiBrZXlEb3duICE9PSBgdW5kZWZpbmVkYCkKICAgIGtleURvd24oa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KTsKfQoKX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihga2V5ZG93bmAsIChldnQpID0+IHsKICBfX3NhZmVseUludGVyY2VwdEtleShldnQpOwogIGNvbnN0IHsga2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5IH0gPSBldnQ7CiAgaWYgKF9fZmluaXNoZWRfc2V0dXApIF9fa2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9KTsKCmZ1bmN0aW9uIF9fa2V5VXAoa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KSB7CiAgZGVsZXRlIGtleWJvYXJkW2tleV07CiAgaWYgKHR5cGVvZiBrZXlVcCAhPT0gYHVuZGVmaW5lZGApCiAgICBrZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9CgpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBrZXl1cGAsIChldnQpID0+IHsKICBfX3NhZmVseUludGVyY2VwdEtleShldnQpOwogIGNvbnN0IHsga2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5IH0gPSBldnQ7CiAgaWYgKF9fZmluaXNoZWRfc2V0dXApIF9fa2V5VXAoa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KTsKfSk7CmZ1bmN0aW9uIF9fY2hlY2tGb3JDdXJyZW50UG9pbnQoeCwgeSwgdHlwZSkgewogIGNvbnN0IG1hdGNoZXMgPSBbXTsKICBjb25zdCBtYXRjaFBhZGRpbmcgPSB0eXBlLmluY2x1ZGVzKGBtb3VzZWApID8gMTAgOiAzMDsKICBfX21vdmFibGVfcG9pbnRzLmZvckVhY2goKHAsIHBvcykgPT4gewogICAgbGV0IHgyID0gcFswXSA9PT0gdW5kZWZpbmVkID8gcC54IDogcFswXTsKICAgIGxldCB5MiA9IHBbMV0gPT09IHVuZGVmaW5lZCA/IHAueSA6IHBbMV07CiAgICBjb25zdCBkID0gZGlzdCh4LCB5LCB4MiwgeTIpOwogICAgaWYgKGQgPCAocC5yID8gcC5yIDogMCkgKyBtYXRjaFBhZGRpbmcpIHsKICAgICAgbWF0Y2hlcy5wdXNoKHsgcCwgZCB9KTsKICAgIH0KICB9KTsKICBjdXJyZW50UG9pbnQgPSBmYWxzZTsKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgYXV0b2A7CiAgaWYgKG1hdGNoZXMubGVuZ3RoKSB7CiAgICBtYXRjaGVzLnNvcnQoKGEsIGIpID0+IGEuZCAtIGIuZCk7CiAgICBjdXJyZW50UG9pbnQgPSBtYXRjaGVzWzBdLnA7CiAgICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgcG9pbnRlcmA7CiAgfQp9CgpmdW5jdGlvbiBfX3RvUG9pbnRlckV2ZW50KGV2dCkgewogIGxldCBwb2ludGVyID0gZXZ0OwogIC8vIENvbnZlcnQgbW91c2Ugb3IgdG91Y2ggaW50byBnZW5lcmljIHBvaW50ZXIuIFdoaWNoIHdlIG5lZWQKICAvLyB0byBkbyBiZWNhdXNlIENocm9tZSBvbiBNYWNPUyBoYXMgZGVjaWRlZCB0byBub3QgZ2VuZXJhdGUKICAvLyBwb2ludGVyIGV2ZW50cyB3aGVuIHRoZXJlJ3MgYSBtb3VzZS4gVGhhbmtzIEdvb2dsZSEKICBpZiAoZXZ0LnR5cGUuaW5jbHVkZXMoYHRvdWNoYCkpIHsKICAgIGNvbnN0IHsgdG91Y2hlcywgY2hhbmdlZFRvdWNoZXMgfSA9IGV2dC5vcmlnaW5hbEV2ZW50ID8/IGV2dDsKICAgIHBvaW50ZXIgPSB0b3VjaGVzWzBdID8/IGNoYW5nZWRUb3VjaGVzWzBdOwogIH0KICBjb25zdCB7IGNsaWVudFgsIGNsaWVudFkgfSA9IHBvaW50ZXI7CiAgY29uc3QgeyBsZWZ0LCB0b3AgfSA9IF9fY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogIHJldHVybiB7IG9mZnNldFg6IGNsaWVudFggLSBsZWZ0LCBvZmZzZXRZOiBjbGllbnRZIC0gdG9wIH07Cn0KCmZ1bmN0aW9uIF9fcG9pbnRlckRvd24oeCwgeSkgewogIGlmIChjdXJyZW50UG9pbnQpIHsKICAgIGN1cnJlbnRQb2ludC5fZHggPSBjdXJyZW50UG9pbnQueCAtIHg7CiAgICBjdXJyZW50UG9pbnQuX2R5ID0gY3VycmVudFBvaW50LnkgLSB5OwogIH0KICBpZiAodHlwZW9mIHBvaW50ZXJEb3duICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlckRvd24oeCwgeSk7Cn0KCltgdG91Y2hzdGFydGAsIGBtb3VzZWRvd25gXS5mb3JFYWNoKCh0eXBlKSA9PiB7CiAgX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCAoZXZ0KSA9PiB7CiAgICBpZiAoX19maW5pc2hlZF9zZXR1cCkgewogICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICBjb25zdCB7IG9mZnNldFgsIG9mZnNldFkgfSA9IF9fdG9Qb2ludGVyRXZlbnQoZXZ0KTsKICAgICAgY29uc3QgeyB4LCB5IH0gPSBzY3JlZW5Ub1dvcmxkKG9mZnNldFgsIG9mZnNldFkpOwogICAgICBPYmplY3QuYXNzaWduKHBvaW50ZXIsIHsgeCwgeSwgdHlwZSwgZG93bjogdHJ1ZSwgbWFyazogeyB4LCB5IH0gfSk7CiAgICAgIF9fY2hlY2tGb3JDdXJyZW50UG9pbnQoeCwgeSwgdHlwZSk7CiAgICAgIF9fcG9pbnRlckRvd24oeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyVXAoeCwgeSkgewogIGlmICh0eXBlb2YgcG9pbnRlclVwICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlclVwKHgsIHkpOwogIGlmIChwb2ludGVyLm1hcms/LnggPT09IHggJiYgcG9pbnRlci5tYXJrPy55ID09PSB5KSB7CiAgICBpZiAodHlwZW9mIHBvaW50ZXJDbGljayAhPT0gYHVuZGVmaW5lZGApIHBvaW50ZXJDbGljayh4LCB5KTsKICB9Cn0KCltgdG91Y2hlbmRgLCBgbW91c2V1cGBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChldnQpID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGNvbnN0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gX190b1BvaW50ZXJFdmVudChldnQpOwogICAgICBjb25zdCB7IHgsIHkgfSA9IHNjcmVlblRvV29ybGQob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwgeyB4LCB5LCB0eXBlLCBkb3duOiBmYWxzZSwgbWFyazogZmFsc2UgfSk7CiAgICAgIF9fcG9pbnRlclVwKHgsIHkpOwogICAgfQogIH0pOwp9KTsKCmZ1bmN0aW9uIF9fcG9pbnRlck1vdmUoeCwgeSkgewogIGxldCBwb2ludE1vdmVkID0gZmFsc2U7CiAgaWYgKHBvaW50ZXIuZG93biAmJiBjdXJyZW50UG9pbnQpIHsKICAgIGlmIChjdXJyZW50UG9pbnRbMF0pIHsKICAgICAgY3VycmVudFBvaW50WzBdID0geCArIGN1cnJlbnRQb2ludC5fZHg7CiAgICAgIGN1cnJlbnRQb2ludFsxXSA9IHkgKyBjdXJyZW50UG9pbnQuX2R5OwogICAgfSBlbHNlIHsKICAgICAgY3VycmVudFBvaW50LnggPSB4ICsgY3VycmVudFBvaW50Ll9keDsKICAgICAgY3VycmVudFBvaW50LnkgPSB5ICsgY3VycmVudFBvaW50Ll9keTsKICAgIH0KICAgIHBvaW50TW92ZWQgPSB0cnVlOwogIH0KCiAgaWYgKHR5cGVvZiBwb2ludGVyTW92ZSAhPT0gYHVuZGVmaW5lZGApIHsKICAgIHBvaW50ZXJNb3ZlKHgsIHkpOwogICAgcG9pbnRlci5kcmFnID0gZmFsc2U7CiAgICBpZiAocG9pbnRlci5kb3duICYmIHR5cGVvZiBwb2ludGVyRHJhZyAhPT0gYHVuZGVmaW5lZGApIHsKICAgICAgcG9pbnRlci5kcmFnID0gdHJ1ZTsKICAgICAgcG9pbnRlckRyYWcoeCwgeSk7CiAgICB9CiAgfQogIGlmIChwb2ludE1vdmVkICYmICFwbGF5aW5nKSByZWRyYXcoKTsKfQoKW2B0b3VjaG1vdmVgLCBgbW91c2Vtb3ZlYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2dCkgPT4gewogICAgaWYgKF9fZmluaXNoZWRfc2V0dXApIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgY29uc3QgeyBvZmZzZXRYLCBvZmZzZXRZIH0gPSBfX3RvUG9pbnRlckV2ZW50KGV2dCk7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUgfSk7CiAgICAgIGlmICghcG9pbnRlci5kb3duKSBfX2NoZWNrRm9yQ3VycmVudFBvaW50KHgsIHksIHR5cGUpOwogICAgICBfX3BvaW50ZXJNb3ZlKHgsIHkpOwogICAgfQogIH0pOwp9KTsKCmZ1bmN0aW9uIF9fcG9pbnRlckFjdGl2ZShhY3RpdmUpIHsKICBpZiAodHlwZW9mIHBvaW50ZXJBY3RpdmUgIT09IGB1bmRlZmluZWRgKSB7CiAgICBwb2ludGVyQWN0aXZlKGFjdGl2ZSk7CiAgfQp9CgpbYHRvdWNoc3RhcnRgLCBgbW91c2VlbnRlcmBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsICgpID0+IHsKICAgIHBvaW50ZXIuYWN0aXZlID0gdHJ1ZTsKICAgIF9fcG9pbnRlckFjdGl2ZSh0cnVlKTsKICB9KTsKfSk7CgpbYHRvdWNoZW5kYCwgYG1vdXNlbGVhdmVgXS5mb3JFYWNoKCh0eXBlKSA9PiB7CiAgX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCAoKSA9PiB7CiAgICBwb2ludGVyLmFjdGl2ZSA9IGZhbHNlOwogICAgX19wb2ludGVyQWN0aXZlKGZhbHNlKTsKICB9KTsKfSk7Ci8qKgogKiBjb2RlIHVzZWQgYnkgcHJvamVjdC5qcywgYnV0IG5hbWVkIHNvIHRoYXQgaXQgbG9hZHMKICogZmlyc3QsIGFuZCBkb2VzIG5vdCBnZXQgYWRkZWQgdG8gdGhlIGQudHMgZmlsZS4KICovCmNsYXNzIENhYmluZXRQcm9qZWN0b3IgewogIM6xID0gMDsKICDOsiA9IDA7CiAgzrMgPSAwOwoKICBjb25zdHJ1Y3RvcihveCwgb3ksIHNjYWxlLCBwaGkpIHsKICAgIHRoaXMudXBkYXRlKG94LCBveSwgc2NhbGUsIHBoaSk7CiAgfQoKICBzZXRSb3RhdGlvbih4ID0gMCwgeSA9IDAsIHogPSAwKSB7CiAgICB0aGlzLs6xID0geDsKICAgIHRoaXMuzrIgPSB6OwogICAgdGhpcy7OsyA9IHk7CiAgfQoKICByb3RhdGUoeCwgeSwgeikgewogICAgbGV0IHsgzrEsIM6yLCDOsyB9ID0gdGhpczsKICAgIGxldCBhID0geDsKICAgIGxldCBiID0geSAqIGNvcyjOsSkgLSB6ICogc2luKM6xKTsKICAgIGxldCBjID0geSAqIHNpbijOsSkgKyB6ICogY29zKM6xKTsKICAgIHggPSBhOwogICAgeSA9IGI7CiAgICB6ID0gYzsKICAgIGEgPSB4ICogY29zKM6yKSArIHogKiBzaW4ozrIpOwogICAgYiA9IHk7CiAgICBjID0geCAqIC1zaW4ozrIpICsgeiAqIGNvcyjOsik7CiAgICB4ID0gYTsKICAgIHkgPSBiOwogICAgeiA9IGM7CiAgICBhID0geCAqIGNvcyjOsykgLSB5ICogc2luKM6zKTsKICAgIGIgPSB4ICogc2luKM6zKSArIHkgKiBjb3MozrMpOwogICAgYyA9IHo7CgogICAgcmV0dXJuIFthLCBiLCBjXTsKICB9CgogIHVwZGF0ZShveCA9IDAsIG95ID0gMCwgc2NhbGUgPSAxLCBwaGkgPSAtUEkgLyA2KSB7CiAgICB0aGlzLm9mZnNldCA9IG5ldyBQb2ludChveCwgb3kpOwogICAgdGhpcy5zY2FsZSA9IHNjYWxlOwogICAgdGhpcy5waGkgPSBwaGk7CiAgfQoKICBwcm9qZWN0KHgsIHksIHopIHsKICAgIGNvbnN0IHsgb2Zmc2V0LCBzY2FsZSwgcGhpIH0gPSB0aGlzOwogICAgeCAqPSBzY2FsZTsKICAgIHkgKj0gc2NhbGU7CiAgICB6ICo9IHNjYWxlOwogICAgW3gsIHksIHpdID0gdGhpcy5yb3RhdGUoeCwgeSwgeik7CiAgICBjb25zdCBhID0geSwKICAgICAgYiA9IC16LAogICAgICBjID0gLXggLyAyOwoKICAgIHJldHVybiBuZXcgUG9pbnQoCiAgICAgIG9mZnNldC54ICsgYSArIGMgKiBjb3MocGhpKSwKICAgICAgb2Zmc2V0LnkgKyBiICsgYyAqIHNpbihwaGkpCiAgICApOwogIH0KfQoKbGV0IF9fcHJvamVjdG9yID0gbmV3IENhYmluZXRQcm9qZWN0b3IoKTsK"),w=class extends h{static{f(this,"GraphicsElement")}handleAttributeChange(...e){}handleChildChanges(...e){}connectedCallback(){super.connectedCallback(),this.label=document.createElement("label"),this.title||(console.warn("<graphics-element> is missing a title attribute. Always caption your figures."),this.title=""),this.label.textContent=this.title,B(this)?this.loadSource():new IntersectionObserver((e,r)=>e.forEach(t=>{t.isIntersecting&&(this.loadSource(),r.disconnect())}),{threshold:.1,rootMargin:`${window.innerHeight}px`}).observe(this)}getStyle(){return`
:host([hidden]) { display: none; }
style { display: none; }
.top-title { display: flex; flex-direction: row; justify-content: space-between; }
canvas { touch-action: none; user-select: none; position: relative; z-index: 1; display: block; margin: auto; border-radius: 0; box-sizing: content-box !important; border: 1px solid lightgrey;
&.crisp { image-rendering: -moz-crisp-edges; image-rendering: -webkit-crisp-edges; image-rendering: pixelated; image-rendering: crisp-edges; }
&:focus { border: 1px solid red; }}
a { &.view-source { font-size: 60%; text-decoration: none;
&.plus { padding-left: 0.5em; }}}
button.reset { font-size: 0.5em; top: -0.35em; position: relative; }
label:not(:empty) { display: block; font-style: italic; font-size: 0.9em; text-align: right; padding-right: 1em; margin-top: 0.35em; }
`}async loadSource(e,r=this.width,t=this.height,$){if(!r&&!t&&(r=parseFloat(this.getAttribute("width")),t=parseFloat(this.getAttribute("height")),isNaN(r)&&(r=void 0),isNaN(t)&&(t=void 0)),!e)if(this.userCode)e=this.userCode;else{let s=this.getAttribute("src");if(s)e=await(await fetch(s)).text();else{let o=this.querySelector("graphics-source");o?e=o.textContent:e=`function setup() {
}
function draw() {
}
`}}if(this.userCode=e,!$)if(this.additionalSources)$=this.additionalSources;else{let s=this.querySelectorAll("source");$=await Promise.all(Array.from(s).map(o=>fetch(o.src).then(g=>g.text())))}this.additionalSources=$;let x=this.userCode;this.additionalSources.length>0&&(x=this.loadAdditionalSources(this.userCode,this.additionalSources));let l=x.matchAll(/addSlider\(['"`](.*)['"`]/g),i=[];for(let s of l)i.push(s[1]),x=x.replace(s[0],s[0]+`, (v) => (${s[1]} = v)`);if(i.length&&(x="let "+i.join(", ")+`;
`+x),x=x.replaceAll(/ from ['"].([^'"]+)['"]/g,` from "${k(location.href)}/$1"`),x.includes("function setup()")||(x=`function setup() {
}
`+x),!x.includes("setSize(")){let s="setSize();";r&&t&&(s=`setSize(${r}, ${t});`),x=x.replace("function setup() {",`function setup() {
  ${s}`)}import(`data:text/javascript;base64,${S(['"use strict";',`import { BSpline, Point, Circle, Vector, Matrix, CSS_COLOR_MAP } from "${_}";`,`const __randomId = "${Date.now()}";`,W,x,"export { reset as start, __canvas as canvas, halt, highlight, __getDescription as getDescription }"].join(`
`))}`).then(async s=>{let{start:o,canvas:g,halt:c,highlight:b,getDescription:L}=s;this.canvas=g,this.halt=()=>c(),this.highlight=A=>b(A),this.render();let{width:u,height:d}=await o(this),m="graphics-element-description";this.querySelector(`.${m}`)?.remove(),this.querySelector("p")||this.handleGraphicsDescription(m,L),u&&d&&(this.style.width="",this.style.height="",this.width=u,this.height=d,this.setAttribute("width",u),this.setAttribute("height",d)),this.dispatchEvent(new CustomEvent("load")),this.onload&&this.onload()})}handleGraphicsDescription(e,r=()=>{}){try{let t=r();if(t){let $=new DocumentFragment,x=document.createElement("div");x.classList.add(e),$.append(x),x.innerHTML=t,this.append(x),this.crossLink(!0)}}catch(t){console.error(t)}}loadAdditionalSources(e,r){if(!r)return e;let t=new Array(r.length);return e+`
`+r.map(($,x)=>$.replace("function setup()",`function setup${x+1}()`).replace("function draw()",`function draw${x+1}()`)).join(`
`)+`
function __more_setup() { ${[...t].map(($,x)=>`if (typeof setup${x+1} !== \`undefined\`) setup${x+1}();`).join(`
`)} }
function __more_draw() { ${[...t].map(($,x)=>`if (typeof draw${x+1} !== \`undefined\`) draw${x+1}();`).join(`
`)} }
`}loadFromFunction(e){let r=e.toString();this.reset(r.substring(r.indexOf("{")+1,r.lastIndexOf("}")))}reset(e,r=[]){this.halt&&this.halt(),this.querySelector("button.remove-color")?.remove(),this.loadSource(e||this.userCode,this.width,this.height,r||this.additionalSources)}render(){super.render();let e=this._slot.parentNode;this.canvas&&e.insertBefore(this.canvas,this._slot),this.label&&e.insertBefore(this.label,this._slot);let r=document.createElement("div");r.classList.add("top-title");let t=document.createElement("span");t.classList.add("sources"),r.append(t);let $=document.createElement("button");$.classList.add("reset"),$.textContent=this.getAttribute("reset")||"reset",$.addEventListener("click",()=>this.reset()),r.append($);let x=this.getAttribute("src");if(x||(x=`data:text/plain;base64,${S(this.userCode)}`),x){let i=document.createElement("a");i.classList.add("view-source"),i.textContent=this.getAttribute("viewSource")||"view source",i.href=x,i.target="_blank",t.append(i),x.startsWith("data")&&(delete i.href,delete i.target,i.classList.add("fake-source-link"),i.addEventListener("click",()=>{let n=`<iframe width="100%" height="100%" src="${x}"></iframe>`,s=window.open(""),{document:o}=s;o.open(),o.write(n),o.write("<style>iframe { position: fixed; top: 0; right: 0; bottom: 0; left: 0; border:0; margin: 0; padding:0 }</style>"),o.close()}))}let l=this.querySelectorAll("source");l.length===0&&(l=(this.additionalSources??[]).map(i=>({src:`data:text/plain;base64,${S(i)}`}))),l.length&&l.forEach((i,n)=>{let{src:s}=i,o=document.createElement("a");o.classList.add("view-source","plus"),o.textContent=`[+${n+1}]`,o.href=s,o.target="_blank",t.append(o),s.startsWith("data")&&(delete o.href,delete o.target,o.classList.add("fake-source-link"),o.addEventListener("click",()=>{let g=`<iframe width="100%" height="100%" src="${s}"></iframe>`,c=window.open(""),{document:b}=c;b.open(),b.write(g),b.write("<style>iframe { position: fixed; top: 0; right: 0; bottom: 0; left: 0; border:0; margin: 0; padding:0 }</style>"),b.close()}))}),this.label&&e.insertBefore(r,this.canvas),this.crossLink()}crossLink(e){if(e&&(this.crossLinked=!1),this.crossLinked)return;this.crossLinked=!0;let r=!1;if(this.querySelectorAll("p").forEach(t=>{t.querySelectorAll("*").forEach($=>{if(!D.includes($.tagName))return;r=!0;let x;$.classList.remove("calm"),$.addEventListener("pointerenter",()=>{x??=getComputedStyle($)["-webkit-text-stroke-color"],this.highlight?.(x)}),$.addEventListener("pointerleave",()=>this.highlight?.(!1))})}),r){let t=document.createElement("button");t.textContent="remove colors",t.classList.add("remove-color"),t.addEventListener("click",()=>{this.querySelectorAll("p").forEach($=>{$.querySelectorAll("*").forEach(x=>{D.includes(x.tagName)&&x.classList.add("calm")})}),t.remove()}),this.append(t)}}},T=class extends h{static{f(this,"GraphicsSource")}constructor(){super(),this.style.display="none"}};await h.register(w),await h.register(T);export{p as BSpline,v as CSS_COLOR_MAP,O as Circle,N as Matrix,R as Point,I as Vector};
