var B=Object.defineProperty;var o=(i,e)=>B(i,"name",{value:e,configurable:!0});var y="registered as custom element";function G(i,e){console.warn(`missing implementation for ${e}(...data) in ${i.__proto__.constructor.name}`)}o(G,"NotImplemented");function U(i){return i.prototype.constructor.name.replace(/([A-Z])([a-z])/g,(e,x,r,$)=>{let t=`${x.toLowerCase()}${r}`;return $>0?`-${t}`:t})}o(U,"getElementTagName");var h=class extends HTMLElement{static{o(this,"CustomElement")}static register(e){if(!e[y]){let x=e.tagName||U(e);return customElements.define(x,e),e[y]=!0,customElements.whenDefined(x)}return Promise.resolve()}static get tagName(){return U(this)}constructor(e={}){super(),customElements.resolveScope||(customElements.resolveScope=function($){try{return $.getRootNode().host}catch(t){console.warn(t)}return window}),this._options=e;let x={childList:$=>{this.handleChildChanges(Array.from($.addedNodes),Array.from($.removedNodes)),this.render()},attributes:$=>{this.handleAttributeChange($.attributeName,$.oldValue,this.getAttribute($.attributeName)),this.render()}};this._observer=new MutationObserver($=>{this.isConnected&&$.forEach(t=>{x[t.type](t)})}),this._observer.observe(this,{childList:!0,attributes:!0});let r={mode:"open"};this._shadow=this.attachShadow(r),this._style=document.createElement("style"),this._style.textContent=this.getStyle(),this._options.header!==!1&&(this._header=document.createElement("header")),this._options.slot!==!1&&this._options.void!==!0&&(this._slot=document.createElement("slot")),this._options.footer!==!1&&(this._footer=document.createElement("footer"))}connectedCallback(){this.render()}handleChildChanges(e,x){this._options.void||G(this,"handleChildChanges")}handleAttributeChange(e,x,r){G(this,"handleAttributeChange")}getStyle(){return""}render(){this._shadow.innerHTML="",this._shadow.append(this._style),this._options.header!==!1&&this._shadow.append(this._header),this._options.slot!==!1&&this._shadow.append(this._slot),this._options.footer!==!1&&this._shadow.append(this._footer)}};var O=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREEN","DARKGREY","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREEN","GREENYELLOW","GREY","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREEN","LIGHTGREY","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TRANSPARENT","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN"],w={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(128, 128, 128)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",transparent:"rgba(0,0,0,0)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",ALICEBLUE:"rgb(240, 248, 255)",ANTIQUEWHITE:"rgb(250, 235, 215)",AQUA:"rgb(0, 255, 255)",AQUAMARINE:"rgb(127, 255, 212)",AZURE:"rgb(240, 255, 255)",BEIGE:"rgb(245, 245, 220)",BISQUE:"rgb(255, 228, 196)",BLACK:"rgb(0, 0, 0)",BLANCHEDALMOND:"rgb(255, 235, 205)",BLUE:"rgb(0, 0, 255)",BLUEVIOLET:"rgb(138, 43, 226)",BROWN:"rgb(165, 42, 42)",BURLYWOOD:"rgb(222, 184, 135)",CADETBLUE:"rgb(95, 158, 160)",CHARTREUSE:"rgb(127, 255, 0)",CHOCOLATE:"rgb(210, 105, 30)",CORAL:"rgb(255, 127, 80)",CORNFLOWERBLUE:"rgb(100, 149, 237)",CORNSILK:"rgb(255, 248, 220)",CRIMSON:"rgb(220, 20, 60)",CYAN:"rgb(0, 255, 255)",DARKBLUE:"rgb(0, 0, 139)",DARKCYAN:"rgb(0, 139, 139)",DARKGOLDENROD:"rgb(184, 134, 11)",DARKGRAY:"rgb(169, 169, 169)",DARKGREEN:"rgb(0, 100, 0)",DARKGREY:"rgb(169, 169, 169)",DARKKHAKI:"rgb(189, 183, 107)",DARKMAGENTA:"rgb(139, 0, 139)",DARKOLIVEGREEN:"rgb(85, 107, 47)",DARKORANGE:"rgb(255, 140, 0)",DARKORCHID:"rgb(153, 50, 204)",DARKRED:"rgb(139, 0, 0)",DARKSALMON:"rgb(233, 150, 122)",DARKSEAGREEN:"rgb(143, 188, 143)",DARKSLATEBLUE:"rgb(72, 61, 139)",DARKSLATEGRAY:"rgb(47, 79, 79)",DARKSLATEGREY:"rgb(47, 79, 79)",DARKTURQUOISE:"rgb(0, 206, 209)",DARKVIOLET:"rgb(148, 0, 211)",DEEPPINK:"rgb(255, 20, 147)",DEEPSKYBLUE:"rgb(0, 191, 255)",DIMGRAY:"rgb(105, 105, 105)",DIMGREY:"rgb(105, 105, 105)",DODGERBLUE:"rgb(30, 144, 255)",FIREBRICK:"rgb(178, 34, 34)",FLORALWHITE:"rgb(255, 250, 240)",FORESTGREEN:"rgb(34, 139, 34)",FUCHSIA:"rgb(255, 0, 255)",GAINSBORO:"rgb(220, 220, 220)",GHOSTWHITE:"rgb(248, 248, 255)",GOLD:"rgb(255, 215, 0)",GOLDENROD:"rgb(218, 165, 32)",GRAY:"rgb(128, 128, 128)",GREEN:"rgb(0, 128, 0)",GREENYELLOW:"rgb(173, 255, 47)",GREY:"rgb(128, 128, 128)",HONEYDEW:"rgb(240, 255, 240)",HOTPINK:"rgb(255, 105, 180)",INDIANRED:"rgb(205, 92, 92)",INDIGO:"rgb(75, 0, 130)",IVORY:"rgb(255, 255, 240)",KHAKI:"rgb(240, 230, 140)",LAVENDER:"rgb(230, 230, 250)",LAVENDERBLUSH:"rgb(255, 240, 245)",LAWNGREEN:"rgb(124, 252, 0)",LEMONCHIFFON:"rgb(255, 250, 205)",LIGHTBLUE:"rgb(173, 216, 230)",LIGHTCORAL:"rgb(240, 128, 128)",LIGHTCYAN:"rgb(224, 255, 255)",LIGHTGOLDENRODYELLOW:"rgb(250, 250, 210)",LIGHTGRAY:"rgb(211, 211, 211)",LIGHTGREEN:"rgb(144, 238, 144)",LIGHTGREY:"rgb(211, 211, 211)",LIGHTPINK:"rgb(255, 182, 193)",LIGHTSALMON:"rgb(255, 160, 122)",LIGHTSEAGREEN:"rgb(32, 178, 170)",LIGHTSKYBLUE:"rgb(135, 206, 250)",LIGHTSLATEGRAY:"rgb(119, 136, 153)",LIGHTSLATEGREY:"rgb(119, 136, 153)",LIGHTSTEELBLUE:"rgb(176, 196, 222)",LIGHTYELLOW:"rgb(255, 255, 224)",LIME:"rgb(0, 255, 0)",LIMEGREEN:"rgb(50, 205, 50)",LINEN:"rgb(250, 240, 230)",MAGENTA:"rgb(255, 0, 255)",MAROON:"rgb(128, 0, 0)",MEDIUMAQUAMARINE:"rgb(102, 205, 170)",MEDIUMBLUE:"rgb(0, 0, 205)",MEDIUMORCHID:"rgb(186, 85, 211)",MEDIUMPURPLE:"rgb(147, 112, 219)",MEDIUMSEAGREEN:"rgb(60, 179, 113)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",MEDIUMSPRINGGREEN:"rgb(0, 250, 154)",MEDIUMTURQUOISE:"rgb(72, 209, 204)",MEDIUMVIOLETRED:"rgb(199, 21, 133)",MIDNIGHTBLUE:"rgb(25, 25, 112)",MINTCREAM:"rgb(245, 255, 250)",MISTYROSE:"rgb(255, 228, 225)",MOCCASIN:"rgb(255, 228, 181)",NAVAJOWHITE:"rgb(255, 222, 173)",NAVY:"rgb(0, 0, 128)",OLDLACE:"rgb(253, 245, 230)",OLIVE:"rgb(128, 128, 0)",OLIVEDRAB:"rgb(107, 142, 35)",ORANGE:"rgb(255, 165, 0)",ORANGERED:"rgb(255, 69, 0)",ORCHID:"rgb(218, 112, 214)",PALEGOLDENROD:"rgb(238, 232, 170)",PALEGREEN:"rgb(152, 251, 152)",PALETURQUOISE:"rgb(175, 238, 238)",PALEVIOLETRED:"rgb(219, 112, 147)",PAPAYAWHIP:"rgb(255, 239, 213)",PEACHPUFF:"rgb(255, 218, 185)",PERU:"rgb(205, 133, 63)",PINK:"rgb(255, 192, 203)",PLUM:"rgb(221, 160, 221)",POWDERBLUE:"rgb(176, 224, 230)",PURPLE:"rgb(128, 0, 128)",REBECCAPURPLE:"rgb(102, 51, 153)",RED:"rgb(255, 0, 0)",ROSYBROWN:"rgb(188, 143, 143)",ROYALBLUE:"rgb(65, 105, 225)",SADDLEBROWN:"rgb(139, 69, 19)",SALMON:"rgb(250, 128, 114)",SANDYBROWN:"rgb(244, 164, 96)",SEAGREEN:"rgb(46, 139, 87)",SEASHELL:"rgb(255, 245, 238)",SIENNA:"rgb(160, 82, 45)",SILVER:"rgb(192, 192, 192)",SKYBLUE:"rgb(135, 206, 235)",SLATEBLUE:"rgb(106, 90, 205)",SLATEGRAY:"rgb(112, 128, 144)",SLATEGREY:"rgb(112, 128, 144)",SNOW:"rgb(255, 250, 250)",SPRINGGREEN:"rgb(0, 255, 127)",STEELBLUE:"rgb(70, 130, 180)",TAN:"rgb(210, 180, 140)",TEAL:"rgb(0, 128, 128)",THISTLE:"rgb(216, 191, 216)",TOMATO:"rgb(255, 99, 71)",TRANSPARENT:"rgba(0,0,0,0)",TURQUOISE:"rgb(64, 224, 208)",VIOLET:"rgb(238, 130, 238)",WHEAT:"rgb(245, 222, 179)",WHITE:"rgb(255, 255, 255)",WHITESMOKE:"rgb(245, 245, 245)",YELLOW:"rgb(255, 255, 0)",YELLOWGREEN:"rgb(154, 205, 50)"};function D(i,e,x,r,$,p,s){var a,n,f,l,d=x.length,E=x[0].length;if(e<1)throw new Error("degree must be at least 1 (linear)");if(e>d-1)throw new Error("degree must be less than or equal to point count - 1");if(!$)for($=[],a=0;a<d;a++)$[a]=1;if($.length<x.length&&($=$.concat($.slice(0,e))),r){if(r.length!==d+e+1)throw new Error("bad knot vector length")}else{var r=[];for(a=0;a<d+e+1;a++)r[a]=a}r.length===x.length&&(r=r.concat(r.slice(0,e)));var c=[e,r.length-1-e],u=r[c[0]],T=r[c[1]];if(s||(i=i*(T-u)+u),i<u||i>T)throw new Error("out of bounds");for(f=c[0];f<c[1]&&!(i>=r[f]&&i<=r[f+1]);f++);var b=[];for(a=0;a<d;a++){for(b[a]=[],n=0;n<E;n++)b[a][n]=x[a][n]*$[a];b[a][E]=$[a]}var N;for(l=1;l<=e+1;l++)for(a=f;a>f-e-1+l;a--)for(N=(i-r[a])/(r[a+e+1-l]-r[a]),n=0;n<E+1;n++)b[a][n]=(1-N)*b[a-1][n]+N*b[a][n];var p=p||[];for(a=0;a<E;a++)p[a]=b[f][a]/b[f][E];return p}o(D,"interpolate");var g=3,A=class{static{o(this,"BSpline")}constructor(e,x=!0){this.points=e,this.points=e.map(r=>r instanceof Array?r:[r.x,r.y]),this.formKnots(x),this.formWeights()}getLUT(e=100){let x=e-1;return[...new Array(e)].map((r,$)=>{let t=D($/x,g,this.points,this.knots,this.weights);return{x:t[0],y:t[1]}})}formKnots(e=!1){if(!e)return this.formUniformKnots();let x=[],r=this.points.length,$=r-g;for(let t=1;t<r-g;t++)x.push(t+g);for(let t=0;t<=g;t++)x=[g].concat(x);for(let t=0;t<=g;t++)x.push($+g);return this.knots=x}formUniformKnots(){return this.knots=[...new Array(this.points.length+g+1)].map((e,x)=>x)}formWeights(){return this.weights=this.points.map(e=>1)}};var L=class{static{o(this,"Point")}constructor(e,x){this.x=e,this.y=x}},I=class extends L{static{o(this,"Circle")}constructor(e,x,r){super(e,x),this.r=r}};var R=class i{static{o(this,"Vector")}constructor(e,x,r){arguments.length===1&&(r=e.z,x=e.y,e=e.x),this.x=e,this.y=x,r!==void 0&&(this.z=r)}dist(e,x,r=0){x!==void 0&&(e={x:e,y:x,z:r});let $=0;$+=(this.x-e.x)**2,$+=(this.y-e.y)**2;let t=this.z?this.z:0,s=e.z?e.z:0;return $+=(t-s)**2,$**.5}normalize(e){let x=this.dist(0,0,0);return new i(e*this.x/x,e*this.y/x,e*this.z/x)}getAngle(){return-Math.atan2(this.y,this.x)}reflect(e){let x=new i(e.x-this.x,e.y-this.y);return e.z!==void 0&&(x.z=e.z,this.z!==void 0&&(x.z-=this.z)),this.subtract(x)}add(e){let x=new i(this.x+e.x,this.y+e.y);return this.z!==void 0&&(x.z=this.z,e.z!==void 0&&(x.z+=e.z)),x}subtract(e){let x=new i(this.x-e.x,this.y-e.y);return this.z!==void 0&&(x.z=this.z,e.z!==void 0&&(x.z-=e.z)),x}scale(e=1){if(e===0)return new i(0,0,this.z===void 0?void 0:0);let x=new i(this.x*e,this.y*e);return this.z!==void 0&&(x.z=this.z*e),x}};function K(i){if(i.length!==i[0].length){console.log("not square");return}var e=0,x=0,r=0,$=i.length,t=0,s=0,a=[],n=[];for(e=0;e<$;e+=1)for(a[a.length]=[],n[n.length]=[],r=0;r<$;r+=1)e==r?a[e][r]=1:a[e][r]=0,n[e][r]=i[e][r];for(e=0;e<$;e+=1){if(t=n[e][e],t==0){for(x=e+1;x<$;x+=1)if(n[x][e]!=0){for(r=0;r<$;r++)t=n[e][r],n[e][r]=n[x][r],n[x][r]=t,t=a[e][r],a[e][r]=a[x][r],a[x][r]=t;break}if(t=n[e][e],t==0)return}for(r=0;r<$;r++)n[e][r]=n[e][r]/t,a[e][r]=a[e][r]/t;for(x=0;x<$;x++)if(x!=e)for(t=n[x][e],r=0;r<$;r++)n[x][r]-=t*n[e][r],a[x][r]-=t*a[e][r]}return a}o(K,"invert");function Y(i,e){var x=[],r=v(e);return i.forEach(($,t)=>{x[t]=[],r.forEach((s,a)=>{x[t][a]=$.map((n,f)=>s[f]*n).reduce((n,f)=>n+f,0)})}),x}o(Y,"multiply");function v(i){return i[0].map((e,x)=>i.map(r=>r[x]))}o(v,"transpose");var m=class i{static{o(this,"Matrix")}constructor(e,x,r){r=e instanceof Array?e:r,this.data=r??[...new Array(e)].map($=>[...new Array(x)].map(t=>0)),this.rows=this.data.length,this.cols=this.data[0].length}setData(e){this.data=e}get(e,x){return this.data[e][x]}set(e,x,r){this.data[e][x]=r}row(e){return this.data[e]}col(e){var x=this.data,r=[];for(let $=0,t=x.length;$<t;$++)r.push(x[$][e]);return r}multiply(e){return new i(Y(this.data,e.data))}invert(){return new i(K(this.data))}transpose(){return new i(v(this.data))}};function M(i){let e=new TextEncoder().encode(i),x=String.fromCodePoint(...e);return btoa(x)}o(M,"base64");function H(i){let e=atob(i),x=Uint8Array.from(e,r=>r.codePointAt(0));return new TextDecoder().decode(x)}o(H,"decode64");function C(i){let e=/^(.*)\/([^.]+(\.([^\/?#]+))+)(\?[^#]*)?(#.*)?$/,x=i.match(e);if(x!==null){let{[1]:r,[2]:$,[4]:t}=x;console.log(`URL is for a file "${$}", with extension "${t}"`),i=r}return i}o(C,"getURLbase");function k(i){if(typeof window>"u"||typeof document>"u")return!0;var e=i.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}o(k,"isInViewport");var P=String(import.meta.url),W=H("Y29uc3QgQUxQSEFCRVRJQyA9IGBhbHBoYWJldGljYDsKY29uc3QgQVVUTyA9IGBhdXRvYDsKY29uc3QgQk9UVE9NID0gYGJvdHRvbWA7CmNvbnN0IEJPVFRPTV9MRUZUID0gYGJvdHRvbi1sZWZ0YDsKY29uc3QgQk9UVE9NX1JJR0hUID0gYGJvdHRvbS1yaWdodGA7CmNvbnN0IENFTlRFUiA9IGBjZW50ZXJgOwpjb25zdCBDT05TVFJBSU4gPSB0cnVlOwpjb25zdCBDUk9TUyA9IGBjcm9zc2hhaXJgOwpjb25zdCBFTkQgPSBgZW5kYDsKY29uc3QgSEFORCA9IGBwb2ludGVyYDsKY29uc3QgSEFOR0lORyA9IGBoYW5naW5nYDsKY29uc3QgSURFT0dSQVBISUMgPSBgaWRlb2dyYXBoaWNgOwpjb25zdCBMRUZUID0gYGxlZnRgOwpjb25zdCBMVFIgPSBgbHRyYDsKY29uc3QgTUlERExFID0gYG1pZGRsZWA7CmNvbnN0IFBPSU5URVIgPSBgZGVmYXVsdGA7CmNvbnN0IFJJR0hUID0gYHJpZ2h0YDsKY29uc3QgUlRMID0gYHJ0bGA7CmNvbnN0IFNUQVJUID0gYHN0YXJ0YDsKY29uc3QgVE9QID0gYHRvcGA7CmNvbnN0IFRPUF9MRUZUID0gYHRvcC1sZWZ0YDsKY29uc3QgVE9QX1JJR0hUID0gYHRvcC1yaWdodGA7Cgpjb25zdCBwb2ludGVyID0geyB4OiAwLCB5OiAwIH07CmNvbnN0IGtleWJvYXJkID0ge307CgovLyBtYXRoIGZ1bmN0aW9ucyBhbmQgY29uc3RhbnRzCmNvbnN0IHsKICBhYnMsCiAgYWNvcywKICBhY29zaCwKICBhc2luLAogIGFzaW5oLAogIGF0YW4sCiAgYXRhbjIsCiAgYXRhbmgsCiAgY2JydCwKICBjZWlsLAogIGNsejMyLAogIGNvcywKICBjb3NoLAogIGV4cCwKICBleHBtMSwKICBmbG9vciwKICBmcm91bmQsCiAgaHlwb3QsCiAgaW11bCwKICBsb2c6IGxuLAogIGxvZzEwOiBsb2csCiAgbG9nMiwKICBtYXgsCiAgbWluLAogIHBvdywKICByb3VuZCwKICBzaWduLAogIHNpbiwKICBzaW5oLAogIHNxcnQsCiAgdGFuLAogIHRhbmgsCiAgdHJ1bmMsCn0gPSBNYXRoOwpjb25zdCB7IFBJLCBFIH0gPSBNYXRoOwpjb25zdCBjb25zdHJhaW4gPSAodiwgcywgZSkgPT4gKHYgPCBzID8gcyA6IHYgPiBlID8gZSA6IHYpOwpjb25zdCBjc2MgPSAodikgPT4gMSAvIHNpbih2KTsKY29uc3QgY3RuID0gKHYpID0+IGNvcyh2KSAvIHNpbih2KTsKY29uc3QgZGlzdCA9ICh4MSwgeTEsIHgyLCB5MikgPT4gKCh4MiAtIHgxKSAqKiAyICsgKHkyIC0geTEpICoqIDIpICoqIDAuNTsKY29uc3QgZXBzaWxvbiA9IE51bWJlci5NSU5fVkFMVUU7CmNvbnN0IGh1Z2UgPSAxXzAwMF8wMDBfMDAwOwpjb25zdCBtYXAgPSAodiwgcywgZSwgbnMsIG5lLCBjb25zdHJhaW5lZCA9IGZhbHNlKSA9PiB7CiAgY29uc3QgaTEgPSBlIC0gcywKICAgIGkyID0gbmUgLSBucywKICAgIHAgPSB2IC0gczsKICBsZXQgciA9IG5zICsgKHAgKiBpMikgLyBpMTsKICBpZiAoY29uc3RyYWluZWQpIHJldHVybiBjb25zdHJhaW4ociwgbnMsIG5lKTsKICByZXR1cm4gcjsKfTsKY29uc3QgcmFuZG9tID0gKGEgPSAxLCBiKSA9PiB7CiAgaWYgKGIgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGEgKiBNYXRoLnJhbmRvbSgpOwogIHJldHVybiBhICsgTWF0aC5yYW5kb20oKSAqIChiIC0gYSk7Cn07CmNvbnN0IHNlYyA9ICh2KSA9PiAxIC8gY29zKHYpOwpjb25zdCBUQVUgPSBQSSAqIDI7CgovLyAicHVibGljIiB2YXJzCgpsZXQgY3VycmVudFBvaW50OwpsZXQgZnJhbWU7CmxldCBoZWlnaHQ7CmxldCB3aWR0aDsKbGV0IHBsYXlpbmc7CgovLyAiaW50ZXJuYWwiIHZhcnMKCmxldCBfX2NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGNhbnZhc2ApOwpfX2NhbnZhcy50YWJJbmRleCA9IDA7Cl9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoYHBvaW50ZXJkb3duYCwgKCkgPT4gX19jYW52YXMuZm9jdXMoKSk7CgpsZXQgX19jdHg7CmxldCBfX2N1cnJlbnRfY3Vyc29yOwpsZXQgX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvcjsKbGV0IF9fY3VycmVudF9odWU7CmxldCBfX2RyYXdfZ3JpZDsKbGV0IF9fZHJhd2luZzsKbGV0IF9fZWxlbWVudDsKbGV0IF9fZmluaXNoZWRfc2V0dXA7CmxldCBfX2ZpcnN0OwpsZXQgX19mb250OwpsZXQgX19ncmlkX2NvbG9yOwpsZXQgX19ncmlkX3NwYWNpbmc7CmxldCBfX2hpZ2hsaWdodF9jb2xvcjsKbGV0IF9fbW92YWJsZV9wb2ludHM7CmxldCBfX3JlZHJhd2luZzsKbGV0IF9fc3RhcnRfdGltZTsKbGV0IF9fc3R5bGVfc3RhY2s7CmxldCBfX3RleHRTdHJva2U7Cgpjb25zdCBmaW5kID0gKHFzKSA9PiB7CiAgcmV0dXJuIF9fZWxlbWVudC5wYXJlbnROb2RlPy5xdWVyeVNlbGVjdG9yKHFzKTsKfTsKCmNvbnN0IGZpbmRBbGwgPSAocXMpID0+IHsKICByZXR1cm4gX19lbGVtZW50LnBhcmVudE5vZGU/LnF1ZXJ5U2VsZWN0b3JBbGwocXMpOwp9OwoKY29uc3Qgc2V0U2l6ZSA9ICh3ID0gNDAwLCBoID0gMjAwKSA9PiB7CiAgd2lkdGggPSBfX2NhbnZhcy53aWR0aCA9IHc7CiAgaGVpZ2h0ID0gX19jYW52YXMuaGVpZ2h0ID0gaDsKICBfX2VsZW1lbnQuc3R5bGUubWF4V2lkdGggPSBgY2FsYygyZW0gKyAke3dpZHRofXB4YDsKICBfX2N0eCA9IF9fY2FudmFzLmdldENvbnRleHQoYDJkYCk7CiAgX19kcmF3KCk7Cn07Cgpjb25zdCByZXNldCA9IGFzeW5jIChlbGVtZW50ID0gX19lbGVtZW50KSA9PiB7CiAgX19lbGVtZW50ID0gZWxlbWVudDsKCiAgLy8gZGVmYXVsdCB2YXJpYWJsZSB2YWx1ZXMKICBfX2N1cnJlbnRfY3Vyc29yID0gYGF1dG9gOwogIF9fY3VycmVudF9oaWdobGlnaHRfY29sb3IgPSBgcmdiKDAsMjU0LDEyNClgOwogIF9fY3VycmVudF9odWUgPSAwOwogIF9fZHJhd19ncmlkID0gdHJ1ZTsKICBfX2RyYXdpbmcgPSBmYWxzZTsKICBfX2ZpbmlzaGVkX3NldHVwID0gZmFsc2U7CiAgX19mb250ID0geyBmYW1pbHk6IGBzYW5zLXNlcmlmYCwgc2l6ZTogMTYsIHdlaWdodDogNDAwIH07CiAgX19ncmlkX2NvbG9yID0gYGxpZ2h0Z3JleWA7CiAgX19ncmlkX3NwYWNpbmcgPSAyMDsKICBfX2hpZ2hsaWdodF9jb2xvciA9IGZhbHNlOwogIF9fbW92YWJsZV9wb2ludHMgPSBbXTsKICBfX3JlZHJhd2luZyA9IGZhbHNlOwogIF9fc3RhcnRfdGltZSA9IERhdGUubm93KCk7CiAgX19zdHlsZV9zdGFjayA9IFtdOwogIF9fdGV4dFN0cm9rZSA9IGB0cmFuc3BhcmVudGA7CgogIGN1cnJlbnRQb2ludCA9IGZhbHNlOwogIHBsYXlpbmcgPSBmYWxzZTsKICBmcmFtZSA9IDA7CiAgcG9pbnRlci54ID0gMDsKICBwb2ludGVyLnkgPSAwOwogIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGtleWJvYXJkKS5mb3JFYWNoKChuKSA9PiBkZWxldGUga2V5Ym9hcmRbbl0pOwoKICAvLyBydW4gc2V0dXAKICBhd2FpdCBfX3NldHVwKCk7CiAgX19maW5pc2hlZF9zZXR1cCA9IHRydWU7CgogIC8vIHJ1biBmaXJzdCBkcmF3CiAgYXdhaXQgX19kcmF3KCk7Cn07Cgpjb25zdCBoYWx0ID0gKCkgPT4gewogIGNvbnN0IHN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShfX2VsZW1lbnQpOwogIHdpZHRoID0gc3R5bGUud2lkdGg7CiAgaGVpZ2h0ID0gc3R5bGUuaGVpZ2h0OwogIHBsYXlpbmcgPSBmYWxzZTsKICBfX2NhbnZhcyA9IHVuZGVmaW5lZDsKICBfX2N0eCA9IHVuZGVmaW5lZDsKICBfX2ZpbmlzaGVkX3NldHVwID0gZmFsc2U7CiAgX19kcmF3aW5nID0gdHJ1ZTsKICBfX3JlZHJhd2luZyA9IHRydWU7CiAgX19maXJzdCA9IHVuZGVmaW5lZDsKICBfX21vdmFibGVfcG9pbnRzID0gdW5kZWZpbmVkOwogIF9fY3VycmVudF9jdXJzb3IgPSB1bmRlZmluZWQ7CiAgX19jdXJyZW50X2h1ZSA9IDA7CiAgX19mb250ID0gdW5kZWZpbmVkOwogIF9fc3RhcnRfdGltZSA9IDA7CiAgY2xlYXJTbGlkZXJzKCk7CiAgcmV0dXJuIHsgd2lkdGgsIGhlaWdodCB9Owp9OwoKY29uc3QgX19zZXR1cCA9IGFzeW5jICgpID0+IHsKICBpZiAodHlwZW9mIHNldHVwICE9PSBgdW5kZWZpbmVkYCkgYXdhaXQgc2V0dXAoKTsKfTsKCmNvbnN0IF9fZHJhdyA9IGFzeW5jICgpID0+IHsKICBpZiAoIV9fZmluaXNoZWRfc2V0dXApIHJldHVybjsKICBpZiAoIV9fZHJhd2luZykgewogICAgX19kcmF3aW5nID0gdHJ1ZTsKICAgIGZyYW1lKys7CiAgICByZXNldFRyYW5zZm9ybSgpOwogICAgdHJhbnNsYXRlKC0wLjUsIC0wLjUpOwogICAgaWYgKHR5cGVvZiBkcmF3ICE9PSBgdW5kZWZpbmVkYCkgYXdhaXQgZHJhdygpOwogICAgX19kcmF3aW5nID0gZmFsc2U7CiAgICBpZiAocGxheWluZykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IF9fZHJhdygpKTsKICB9Cn07Cgpjb25zdCByZWRyYXcgPSAoKSA9PiB7CiAgaWYgKF9fcmVkcmF3aW5nKSByZXR1cm47CiAgaWYgKHBsYXlpbmcpIHJldHVybjsKICBfX3JlZHJhd2luZyA9IHRydWU7CiAgX19kcmF3KCk7CiAgX19yZWRyYXdpbmcgPSBmYWxzZTsKfTsKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLSBwb2ludGVyIGhlbHBlciAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgpjb25zdCBfX2NoZWNrRm9yQ3VycmVudFBvaW50ID0gKHgsIHksIHR5cGUpID0+IHsKICBjb25zdCBtYXRjaGVzID0gW107CiAgY29uc3QgbWF0Y2hQYWRkaW5nID0gdHlwZSA9PT0gYG1vdXNlYCA/IDEwIDogMzA7CiAgX19tb3ZhYmxlX3BvaW50cy5mb3JFYWNoKChwKSA9PiB7CiAgICBsZXQgeDIgPSBwWzBdID09PSB1bmRlZmluZWQgPyBwLnggOiBwWzBdOwogICAgbGV0IHkyID0gcFsxXSA9PT0gdW5kZWZpbmVkID8gcC55IDogcFsxXTsKICAgIGNvbnN0IGQgPSBkaXN0KHgsIHksIHgyLCB5Mik7CiAgICBpZiAoZCA8IChwLnIgPyBwLnIgOiAwKSArIG1hdGNoUGFkZGluZykgewogICAgICBtYXRjaGVzLnB1c2goeyBwLCBkIH0pOwogICAgfQogIH0pOwogIGN1cnJlbnRQb2ludCA9IGZhbHNlOwogIF9fY2FudmFzLnN0eWxlLmN1cnNvciA9IGBhdXRvYDsKICBpZiAobWF0Y2hlcy5sZW5ndGgpIHsKICAgIG1hdGNoZXMuc29ydCgoYSwgYikgPT4gYS5kIC0gYi5kKTsKICAgIGN1cnJlbnRQb2ludCA9IG1hdGNoZXNbMF0ucDsKICAgIF9fY2FudmFzLnN0eWxlLmN1cnNvciA9IGBwb2ludGVyYDsKICB9Cn07CgovLyAtLS0tLS0tLS0tLS0tLS0gcG9pbnRlciBldmVudCBoYW5kbGluZyAtLS0tLS0tLS0tLS0tLS0tLS0tCgpjb25zdCBfX3BvaW50ZXJEb3duID0gKHgsIHkpID0+IHsKICBpZiAoY3VycmVudFBvaW50KSB7CiAgICBjdXJyZW50UG9pbnQuX2R4ID0gY3VycmVudFBvaW50LnggLSB4OwogICAgY3VycmVudFBvaW50Ll9keSA9IGN1cnJlbnRQb2ludC55IC0geTsKICB9CiAgaWYgKHR5cGVvZiBwb2ludGVyRG93biAhPT0gYHVuZGVmaW5lZGApIHBvaW50ZXJEb3duKHgsIHkpOwp9OwoKX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigKICBgcG9pbnRlcmRvd25gLAogICh7IG9mZnNldFgsIG9mZnNldFksIHBvaW50ZXJUeXBlOiB0eXBlIH0pID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUsIGRvd246IHRydWUsIG1hcms6IHsgeCwgeSB9IH0pOwogICAgICBpZiAodHlwZSAhPT0gYG1vdXNlYCkgewogICAgICAgIF9fY2hlY2tGb3JDdXJyZW50UG9pbnQoeCwgeSwgdHlwZSk7CiAgICAgIH0KICAgICAgX19wb2ludGVyRG93bih4LCB5KTsKICAgIH0KICB9Cik7Cgpjb25zdCBfX3BvaW50ZXJVcCA9ICh4LCB5KSA9PiB7CiAgaWYgKHR5cGVvZiBwb2ludGVyVXAgIT09IGB1bmRlZmluZWRgKSBwb2ludGVyVXAoeCwgeSk7CiAgaWYgKHBvaW50ZXIubWFyaz8ueCA9PT0geCAmJiBwb2ludGVyLm1hcms/LnkgPT09IHkpIHsKICAgIGlmICh0eXBlb2YgcG9pbnRlckNsaWNrICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlckNsaWNrKHgsIHkpOwogIH0KfTsKCl9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoCiAgYHBvaW50ZXJ1cGAsCiAgKHsgb2Zmc2V0WCwgb2Zmc2V0WSwgcG9pbnRlclR5cGU6IHR5cGUgfSkgPT4gewogICAgaWYgKF9fZmluaXNoZWRfc2V0dXApIHsKICAgICAgY29uc3QgeyB4LCB5IH0gPSBzY3JlZW5Ub1dvcmxkKG9mZnNldFgsIG9mZnNldFkpOwogICAgICBPYmplY3QuYXNzaWduKHBvaW50ZXIsIHsgeCwgeSwgdHlwZSwgZG93bjogZmFsc2UsIG1hcms6IGZhbHNlIH0pOwogICAgICBfX3BvaW50ZXJVcCh4LCB5KTsKICAgIH0KICB9Cik7Cgpjb25zdCBfX3BvaW50ZXJNb3ZlID0gKHgsIHkpID0+IHsKICBsZXQgcG9pbnRNb3ZlZCA9IGZhbHNlOwogIGlmIChwb2ludGVyLmRvd24gJiYgY3VycmVudFBvaW50KSB7CiAgICBpZiAoY3VycmVudFBvaW50WzBdKSB7CiAgICAgIGN1cnJlbnRQb2ludFswXSA9IHggKyBjdXJyZW50UG9pbnQuX2R4OwogICAgICBjdXJyZW50UG9pbnRbMV0gPSB5ICsgY3VycmVudFBvaW50Ll9keTsKICAgIH0gZWxzZSB7CiAgICAgIGN1cnJlbnRQb2ludC54ID0geCArIGN1cnJlbnRQb2ludC5fZHg7CiAgICAgIGN1cnJlbnRQb2ludC55ID0geSArIGN1cnJlbnRQb2ludC5fZHk7CiAgICB9CiAgICBwb2ludE1vdmVkID0gdHJ1ZTsKICB9CgogIGlmICh0eXBlb2YgcG9pbnRlck1vdmUgIT09IGB1bmRlZmluZWRgKSB7CiAgICBwb2ludGVyTW92ZSh4LCB5KTsKICAgIHBvaW50ZXIuZHJhZyA9IGZhbHNlOwogICAgaWYgKHBvaW50ZXIuZG93biAmJiB0eXBlb2YgcG9pbnRlckRyYWcgIT09IGB1bmRlZmluZWRgKSB7CiAgICAgIHBvaW50ZXIuZHJhZyA9IHRydWU7CiAgICAgIHBvaW50ZXJEcmFnKHgsIHkpOwogICAgfQogIH0KICBpZiAocG9pbnRNb3ZlZCAmJiAhcGxheWluZykgcmVkcmF3KCk7Cn07CgpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKAogIGBwb2ludGVybW92ZWAsCiAgKHsgb2Zmc2V0WCwgb2Zmc2V0WSwgcG9pbnRlclR5cGU6IHR5cGUgfSkgPT4gewogICAgaWYgKF9fZmluaXNoZWRfc2V0dXApIHsKICAgICAgY29uc3QgeyB4LCB5IH0gPSBzY3JlZW5Ub1dvcmxkKG9mZnNldFgsIG9mZnNldFkpOwogICAgICBPYmplY3QuYXNzaWduKHBvaW50ZXIsIHsgeCwgeSwgdHlwZSB9KTsKICAgICAgaWYgKCFwb2ludGVyLmRvd24pIF9fY2hlY2tGb3JDdXJyZW50UG9pbnQoeCwgeSwgdHlwZSk7CiAgICAgIF9fcG9pbnRlck1vdmUoeCwgeSk7CiAgICB9CiAgfQopOwoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tIGtleSBldmVudCBoYW5kbGluZyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgpjb25zdCBfX3NhZmVseUludGVyY2VwdEtleSA9IChldnQpID0+IHsKICAvLyBXZSBkb24ndCB3YW50IHRvIGludGVyZmVyZSB3aXRoIHRoZSBicm93c2VyLCBzbyB3ZSdyZSBvbmx5CiAgLy8gZ29pbmcgdG8gYWxsb3cgdW5tb2RpZmllZCBrZXlzLCBvciBzaGlmdC1tb2RpZmllZCBrZXlzLAogIC8vIGFuZCB0YWIgaGFzIHRvIGFsd2F5cyB3b3JrLiBGb3Igb2J2aW91cyByZWFzb25zLgogIGNvbnN0IHRhYiA9IGV2dC5rZXkgIT09ICJUYWIiOwogIGNvbnN0IGZ1bmN0aW9uS2V5ID0gZXZ0LmtleS5tYXRjaCgvRlxkKy8pID09PSBudWxsOwogIGNvbnN0IHNwZWNpZmljQ2hlY2sgPSB0YWIgJiYgZnVuY3Rpb25LZXk7CiAgaWYgKCFldnQuYWx0S2V5ICYmICFldnQuY3RybEtleSAmJiAhZXZ0Lm1ldGFLZXkgJiYgc3BlY2lmaWNDaGVjaykgewogICAgaWYgKGV2dC50YXJnZXQgPT09IF9fY2FudmFzKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CiAgfQp9OwoKY29uc3QgX19rZXlEb3duID0gKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSkgPT4gewogIGtleWJvYXJkW2tleV0gPSBEYXRlLm5vdygpOwogIGlmICh0eXBlb2Yga2V5RG93biAhPT0gYHVuZGVmaW5lZGApCiAgICBrZXlEb3duKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn07CgpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBrZXlkb3duYCwgKGV2dCkgPT4gewogIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCk7CiAgY29uc3QgeyBrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkgfSA9IGV2dDsKICBpZiAoX19maW5pc2hlZF9zZXR1cCkgX19rZXlEb3duKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn0pOwoKY29uc3QgX19rZXlVcCA9IChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpID0+IHsKICBkZWxldGUga2V5Ym9hcmRba2V5XTsKICBpZiAodHlwZW9mIGtleVVwICE9PSBgdW5kZWZpbmVkYCkKICAgIGtleVVwKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn07CgpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBrZXl1cGAsIChldnQpID0+IHsKICBfX3NhZmVseUludGVyY2VwdEtleShldnQpOwogIGNvbnN0IHsga2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5IH0gPSBldnQ7CiAgaWYgKF9fZmluaXNoZWRfc2V0dXApIF9fa2V5VXAoa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KTsKfSk7CgovLyAtLS0tLS0tLS0tLS0tLS0tIHNsaWRlciBmdW5jdGlvbnMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgpjb25zdCBhZGRTbGlkZXIgPSAocHJvcExhYmVsLCBhc3NpZ24sIG9wdGlvbnMpID0+IHsKICBjb25zdCB7CiAgICBtaW4gPSAwLAogICAgbWF4ID0gMSwKICAgIHN0ZXAgPSAxLAogICAgdmFsdWUgPSAwLAogICAgY2xhc3NlcyA9IGBzbGlkZXJgLAogICAgdHJhbnNmb3JtID0gKHYpID0+IHYsCiAgfSA9IG9wdGlvbnM7CgogIGNvbnN0IGNyZWF0ZSA9ICh0YWcpID0+IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTsKCiAgbGV0IHNsaWRlciA9IGNyZWF0ZShgaW5wdXRgKTsKICBzbGlkZXIudHlwZSA9IGByYW5nZWA7CiAgc2xpZGVyLm1pbiA9IG1pbjsKICBzbGlkZXIubWF4ID0gbWF4OwogIHNsaWRlci5zdGVwID0gc3RlcDsKICBzbGlkZXIuc2V0QXR0cmlidXRlKGB2YWx1ZWAsIHZhbHVlKTsKICBzbGlkZXIuc2V0QXR0cmlidXRlKGBjbGFzc2AsIGNsYXNzZXMpOwoKICBjb25zdCB1cGRhdGUgPSAoeyB2YWx1ZSB9KSA9PiB7CiAgICB2YWx1ZUZpZWxkLnRleHRDb250ZW50ID0gdmFsdWU7CiAgICBhc3NpZ24odHJhbnNmb3JtKHBhcnNlRmxvYXQodmFsdWUpKSk7CiAgICBpZiAoIXBsYXlpbmcpIHJlZHJhdygpOwogIH07CgogIHNsaWRlci5hZGRFdmVudExpc3RlbmVyKGBpbnB1dGAsICh7IHRhcmdldCB9KSA9PiB1cGRhdGUodGFyZ2V0KSk7CgogIGxldCB0YWJsZSA9IF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKGB0YWJsZS5zbGlkZXItd3JhcHBlcmApOwogIGlmICghdGFibGUpIHsKICAgIHRhYmxlID0gY3JlYXRlKGB0YWJsZWApOwogICAgdGFibGUuY2xhc3NMaXN0LmFkZChgc2xpZGVyLXdyYXBwZXJgKTsKICAgIF9fZWxlbWVudC5wcmVwZW5kKHRhYmxlKTsKICB9CiAgbGV0IHRyID0gY3JlYXRlKGB0cmApOwoKICBsZXQgdGQgPSBjcmVhdGUoYHRkYCk7CiAgbGV0IGxhYmVsID0gY3JlYXRlKGBsYWJlbGApOwogIGxhYmVsLmNsYXNzTGlzdC5hZGQoYHNsaWRlci1sYWJlbGApOwogIGxhYmVsLmlubmVySFRNTCA9IHByb3BMYWJlbAogICAgLnJlcGxhY2UoL18oLispJC8sIGA8c3ViPiQxPC9zdWI+YCkKICAgIC5yZXBsYWNlKC8oXGQrKS8sIGA8c3ViPiQxPC9zdWI+YCk7CiAgdGQuYXBwZW5kKGxhYmVsKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbWluYCk7CiAgdGQudGV4dENvbnRlbnQgPSBzbGlkZXIubWluOwogIHRyLmFwcGVuZCh0ZCk7CgogIHRkID0gY3JlYXRlKGB0ZGApOwogIHRkLndpZHRoID0gYCpgOwogIHRkLmFwcGVuZChzbGlkZXIpOwogIHRyLmFwcGVuZCh0ZCk7CgogIHRkID0gY3JlYXRlKGB0ZGApOwogIHRkLmNsYXNzTGlzdC5hZGQoYHNsaWRlci1tYXhgKTsKICB0ZC50ZXh0Q29udGVudCA9IHNsaWRlci5tYXg7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdmFyIHZhbHVlRmllbGQgPSBjcmVhdGUoYGxhYmVsYCk7IC8vIGZ1bmN0aW9uIHNjb3BlZAogIHZhbHVlRmllbGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLXZhbHVlYCk7CiAgdGQuYXBwZW5kKHZhbHVlRmllbGQpOwogIHRyLmFwcGVuZCh0ZCk7CiAgdGQuYWRkRXZlbnRMaXN0ZW5lcihgcG9pbnRlcmRvd25gLCAoKSA9PiB7CiAgICBjb25zdCB2YWx1ZSA9IHByb21wdChgbmV3IHZhbHVlP2AsIHNsaWRlci52YWx1ZSk7CiAgICBpZiAodmFsdWUgIT09IG51bGwpIHsKICAgICAgc2xpZGVyLnZhbHVlID0gdmFsdWU7CiAgICAgIHVwZGF0ZSh7IHZhbHVlIH0pOwogICAgfQogIH0pOwoKICB0YWJsZS5hcHBlbmQodHIpOwoKICB1cGRhdGUoc2xpZGVyKTsKfTsKCmNvbnN0IGNsZWFyU2xpZGVycyA9ICgpID0+IHsKICBjb25zdCB0YWJsZSA9IF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKGB0YWJsZS5zbGlkZXItd3JhcHBlcmApOwogIGlmICh0YWJsZSkgdGFibGUuaW5uZXJIVE1MID0gYGA7Cn07CgovLyAtLS0tLS0tLS0tIGdlbmVyYWwgZnVuY3Rpb25zIC0tLS0tLS0tLS0tLS0KCmNvbnN0IGNsZWFyTW92YWJsZSA9ICgpID0+IHsKICBfX21vdmFibGVfcG9pbnRzLnNwbGljZSgwLCBfX21vdmFibGVfcG9pbnRzLmxlbmd0aCk7Cn07Cgpjb25zdCBjb3B5ID0gKCkgPT4gewogIGNvbnN0IGNvcHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBjYW52YXNgKTsKICBjb3B5LndpZHRoID0gd2lkdGg7CiAgY29weS5oZWlnaHQgPSBoZWlnaHQ7CiAgY29uc3QgY3R4ID0gY29weS5nZXRDb250ZXh0KGAyZGApOwogIGN0eC5kcmF3SW1hZ2UoX19jYW52YXMsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogIHJldHVybiBjb3B5Owp9OwoKY29uc3QgY29sb3IgPSAoaCA9IF9fY3VycmVudF9odWUsIHMgPSA1MCwgbCA9IDUwLCBhID0gMSkgPT4gewogIHJldHVybiBgaHNsYSgke2h9LCR7c30lLCR7bH0lLCR7YX0pYDsKfTsKCmNvbnN0IGhpZ2hsaWdodCA9IChjb2xvcikgPT4gewogIF9faGlnaGxpZ2h0X2NvbG9yID0gY29sb3I7CiAgcmVkcmF3KCk7Cn07Cgpjb25zdCBtaWxsaXMgPSAoKSA9PiB7CiAgcmV0dXJuIERhdGUubm93KCkgLSBfX3N0YXJ0X3RpbWU7Cn07Cgpjb25zdCBwYXVzZSA9ICgpID0+IHsKICBwbGF5aW5nID0gZmFsc2U7Cn07Cgpjb25zdCBwbGF5ID0gKCkgPT4gewogIHBsYXlpbmcgPSB0cnVlOwogIF9fZHJhdygpOwp9OwoKY29uc3QgcmFuZG9tQ29sb3IgPSAoYSA9IDEuMCwgY3ljbGUgPSB0cnVlKSA9PiB7CiAgaWYgKGN5Y2xlKSBfX2N1cnJlbnRfaHVlID0gKF9fY3VycmVudF9odWUgKyA3MykgJSAzNjA7CiAgcmV0dXJuIGBoc2xhKCR7X19jdXJyZW50X2h1ZX0sNTAlLDUwJSwke2F9KWA7Cn07Cgpjb25zdCBzZXRNb3ZhYmxlID0gKHBvaW50cykgPT4gewogIC8vIFRPRE86IHNoYXBlcwogIGlmICghcG9pbnRzLmZvckVhY2gpIHsKICAgIHBvaW50cyA9IFtwb2ludHNdOwogIH0KICBwb2ludHMuZm9yRWFjaCgocCkgPT4gewogICAgaWYgKF9fbW92YWJsZV9wb2ludHMuaW5kZXhPZihwKSA9PT0gLTEpIHsKICAgICAgX19tb3ZhYmxlX3BvaW50cy5wdXNoKHApOwogICAgfQogIH0pOwp9OwoKY29uc3QgcmVzdG9yZSA9ICgpID0+IHsKICBfX2N0eC5yZXN0b3JlKCk7Cn07CgovKioKICogU2F2ZSB0aGUgY2FudmFzIGNvbnRleHQuCiAqLwpjb25zdCBzYXZlID0gKCkgPT4gewogIF9fY3R4LnNhdmUoKTsKfTsKCmNvbnN0IHRvRGF0YVVSTCA9ICgpID0+IHsKICByZXR1cm4gX19jYW52YXMudG9EYXRhVVJMKCk7Cn07Cgpjb25zdCB0b2dnbGVQbGF5ID0gKCkgPT4gewogIHBsYXlpbmcgPyBwYXVzZSgpIDogcGxheSgpOwogIHJldHVybiBwbGF5aW5nOwp9OwoKLy8gLS0tLS0tLS0tLSBkcmF3IGZ1bmN0aW9ucyAtLS0tLS0tLS0tLS0tCgpjb25zdCBhcmMgPSAoeCwgeSwgciwgcyA9IDAsIGUgPSBUQVUsIHdlZGdlID0gZmFsc2UpID0+IHsKICBzdGFydCgpOwogIGlmICh3ZWRnZSkgX19jdHgubW92ZVRvKHgsIHkpOwogIF9fY3R4LmFyYyh4LCB5LCByLCBzLCBlKTsKICBpZiAod2VkZ2UpIF9fY3R4LmxpbmVUbyh4LCB5KTsKICBlbmQoKTsKfTsKCmNvbnN0IGF4ZXMgPSAoCiAgaExhYmVsLAogIGhzLAogIGhlLAogIHZMYWJlbCwKICB2cywKICB2ZSwKICBoc0xhYmVsID0gZmFsc2UsCiAgaGVMYWJlbCA9IGZhbHNlLAogIHZzTGFiZWwgPSBmYWxzZSwKICB2ZUxhYmVsID0gZmFsc2UKKSA9PiB7CiAgbGluZShocywgMCwgaGUsIDApOwogIGxpbmUoMCwgdnMsIDAsIHZlKTsKCiAgY29uc3QgaHBvcyA9IDAgLSA1OwogIHRleHQoYCR7aExhYmVsfSDihpJgLCB3aWR0aCAvIDIsIGhwb3MsIENFTlRFUik7CiAgdGV4dChoc0xhYmVsID8gaHNMYWJlbCA6IGhzLCBocywgaHBvcywgQ0VOVEVSKTsKICB0ZXh0KGhlTGFiZWwgPyBoZUxhYmVsIDogaGUsIGhlLCBocG9zLCBDRU5URVIpOwoKICBjb25zdCB2cG9zID0gLTU7CiAgdGV4dChgJHt2TGFiZWx9YCwgdnBvcywgaGVpZ2h0IC8gMiwgUklHSFQpOwogIHRleHQoYOKGk2AsIHZwb3MsIGhlaWdodCAvIDIgKyAxNiwgUklHSFQpOwogIHRleHQodnNMYWJlbCA/IHZzTGFiZWwgOiB2cywgdnBvcywgdnMgKyA1LCBSSUdIVCk7CiAgdGV4dCh2ZUxhYmVsID8gdmVMYWJlbCA6IHZlLCB2cG9zLCB2ZSwgUklHSFQpOwp9OwoKY29uc3QgYmV6aWVyID0gKHBvaW50cykgPT4gewogIGNvbnN0IFtmaXJzdCwgLi4ucmVzdF0gPSBwb2ludHM7CiAgc3RhcnQoKTsKICB2ZXJ0ZXgoZmlyc3QueCwgZmlyc3QueSk7CiAgZm9yIChsZXQgaSA9IDAsIGUgPSByZXN0Lmxlbmd0aDsgaSA8IGU7IGkgKz0gMykgewogICAgbGV0IFtwMSwgcDIsIHAzXSA9IHJlc3Quc2xpY2UoaSwgaSArIDMpOwogICAgaWYgKHAxICYmIHAyICYmIHAzKSBfX2N0eC5iZXppZXJDdXJ2ZVRvKHAxLngsIHAxLnksIHAyLngsIHAyLnksIHAzLngsIHAzLnkpOwogIH0KICBlbmQoKTsKfTsKCmNvbnN0IGJzcGxpbmUgPSAocG9pbnRzLCBvcGVuID0gdHJ1ZSkgPT4gewogIHN0YXJ0KCk7CiAgbmV3IEJTcGxpbmUocG9pbnRzLCBvcGVuKS5nZXRMVVQoKS5mb3JFYWNoKChwKSA9PiB2ZXJ0ZXgocC54LCBwLnkpKTsKICBlbmQoKTsKfTsKCmNvbnN0IGNpcmNsZSA9ICh4LCB5LCByKSA9PiB7CiAgYXJjKHgsIHksIHIpOwp9OwoKY29uc3QgY2xlYXIgPSAoY29sb3IgPSBgd2hpdGVgKSA9PiB7CiAgc2F2ZSgpOwogIF9fY2FudmFzLnN0eWxlLmJhY2tncm91bmQgPSBjb2xvcjsKICBfX2NhbnZhcy53aWR0aCA9IHdpZHRoOwogIF9fY3R4ID0gX19jYW52YXMuZ2V0Q29udGV4dChgMmRgKTsKICBpZiAoX19kcmF3X2dyaWQpIGdyaWQoKTsKICByZXN0b3JlKCk7Cn07Cgpjb25zdCBlbmQgPSAoY2xvc2UgPSBmYWxzZSkgPT4gewogIGlmIChjbG9zZSkgX19jdHguY2xvc2VQYXRoKCk7CiAgX19jdHguZmlsbCgpOwogIF9fY3R4LnN0cm9rZSgpOwogIGlmIChfX2N0eC5saW5lV2lkdGggJSAyID09PSAxKSB7CiAgICBfX2N0eC50cmFuc2xhdGUoLTAuNSwgLTAuNSk7CiAgfQp9OwoKY29uc3QgZ3JpZCA9ICgpID0+IHsKICBzYXZlKCk7CiAgc2V0TGluZVdpZHRoKDAuNSk7CiAgbm9GaWxsKCk7CiAgc2V0U3Ryb2tlKF9fZ3JpZF9jb2xvcik7CiAgZm9yICgKICAgIGxldCB4ID0gKC0wLjUgKyBfX2dyaWRfc3BhY2luZyAvIDIpIHwgMDsKICAgIHggPCB3aWR0aDsKICAgIHggKz0gX19ncmlkX3NwYWNpbmcKICApIHsKICAgIGxpbmUoeCwgMCwgeCwgaGVpZ2h0KTsKICB9CiAgZm9yICgKICAgIGxldCB5ID0gKC0wLjUgKyBfX2dyaWRfc3BhY2luZyAvIDIpIHwgMDsKICAgIHkgPCBoZWlnaHQ7CiAgICB5ICs9IF9fZ3JpZF9zcGFjaW5nCiAgKSB7CiAgICBsaW5lKDAsIHksIHdpZHRoLCB5KTsKICB9CiAgcmVzdG9yZSgpOwp9OwoKY29uc3QgaW1hZ2UgPSBhc3luYyAoaW1nLCB4ID0gMCwgeSA9IDAsIHcsIGgpID0+IHsKICBpZiAodHlwZW9mIGltZyA9PT0gYHN0cmluZ2ApIHsKICAgIGltZyA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgY29uc3QgdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgaW1nYCk7CiAgICAgIHRhZy5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKHRhZyk7CiAgICAgIHRhZy5vbmVycm9yID0gKCkgPT4gcmVqZWN0KCk7CiAgICAgIHRhZy5zcmMgPSBpbWc7CiAgICB9KTsKICB9CiAgX19jdHguZHJhd0ltYWdlKGltZywgeCwgeSwgdyB8fCBpbWcud2lkdGgsIGggfHwgaW1nLmhlaWdodCk7Cn07Cgpjb25zdCBsaW5lID0gKHgxLCB5MSwgeDIsIHkyKSA9PiB7CiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICB2ZXJ0ZXgoeDIsIHkyKTsKICBlbmQoKTsKfTsKCmNvbnN0IHBsb3QgPSAoZiwgYSA9IDAsIGIgPSAxLCBzdGVwcyA9IDI0LCB4c2NhbGUgPSAxLCB5c2NhbGUgPSAxKSA9PiB7CiAgY29uc3QgaW50ZXJ2YWwgPSBiIC0gYTsKICBzdGFydCgpOwogIGZvciAobGV0IGkgPSAwLCBlID0gc3RlcHMgLSAxLCB4LCB5LCB2OyBpIDwgc3RlcHM7IGkrKykgewogICAgeCA9IGEgKyBpbnRlcnZhbCAqIChpIC8gZSk7CiAgICB5ID0gZih4KTsKICAgIHZlcnRleCh4ICogeHNjYWxlLCB5ICogeXNjYWxlKTsKICB9CiAgZW5kKCk7Cn07Cgpjb25zdCBwbG90RGF0YSA9IChkYXRhLCB4LCB5KSA9PiB7CiAgc3RhcnQoKTsKICBkYXRhLmZvckVhY2goKHApID0+IHZlcnRleChwW3hdLCBwW3ldKSk7CiAgZW5kKCk7Cn07Cgpjb25zdCBwb2ludCA9ICh4LCB5KSA9PiB7CiAgY2lyY2xlKHgsIHksIDMpOwp9OwoKY29uc3QgcmVjdCA9ICh4LCB5LCB3LCBoKSA9PiB7CiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeCwgeSk7CiAgdmVydGV4KHggKyB3aWR0aCwgeSk7CiAgdmVydGV4KHggKyB3aWR0aCwgeSArIGhlaWdodCk7CiAgdmVydGV4KHgsIHkgKyBoZWlnaHQpOwogIHZlcnRleCh4LCB5KTsKICBlbmQoKTsKfTsKCi8vIGRyYXcgYSBjYXJkaW5hbCBzcGxpbmUgd2l0aCB2aXJ0dWFsIHN0YXJ0IGFuZCBlbmQgcG9pbnQKY29uc3Qgc3BsaW5lID0gKHBvaW50cywgdmlydHVhbCA9IHRydWUsIHRpZ2h0bmVzcyA9IDEsIFQgPSB0aWdodG5lc3MpID0+IHsKICBsZXQgY3BvaW50cyA9IHBvaW50czsKICBpZiAodmlydHVhbCkgewogICAgY29uc3QgZjAgPSBwb2ludHNbMF0sCiAgICAgIGYxID0gcG9pbnRzWzFdLAogICAgICBmMiA9IHBvaW50c1syXSwKICAgICAgZnNtID0gbmV3IFZlY3RvcihmMC54IC8gMiArIGYyLnggLyAyLCBmMC55IC8gMiArIGYyLnkgLyAyKSwKICAgICAgZjByID0gbmV3IFZlY3RvcihmMCkucmVmbGVjdChmMSksCiAgICAgIGZzciA9IGZzbS5yZWZsZWN0KGYxKSwKICAgICAgZm4gPSBuZXcgVmVjdG9yKGYwci54IC8gMiArIGZzci54IC8gMiwgZjByLnkgLyAyICsgZnNyLnkgLyAyKSwKICAgICAgbDIgPSBwb2ludHMuYXQoLTMpLAogICAgICBsMSA9IHBvaW50cy5hdCgtMiksCiAgICAgIGwwID0gcG9pbnRzLmF0KC0xKSwKICAgICAgbHNtID0gbmV3IFZlY3RvcihsMC54IC8gMiArIGwyLnggLyAyLCBsMC55IC8gMiArIGwyLnkgLyAyKSwKICAgICAgbDByID0gbmV3IFZlY3RvcihsMCkucmVmbGVjdChsMSksCiAgICAgIGxuID0gbmV3IFZlY3RvcihsMHIueCAvIDIgKyBsc20ueCAvIDIsIGwwci55IC8gMiArIGxzbS55IC8gMik7CiAgICBjcG9pbnRzID0gW2ZuLCAuLi5wb2ludHMsIGxuXTsKICB9CgogIC8vIGZvdXIgcG9pbnQgc2xpZGluZyB3aW5kb3cgb3ZlciB0aGUgc2VnbWVudAogIHN0YXJ0KCk7CiAgX19jdHgubW92ZVRvKGNwb2ludHNbMV0ueCwgY3BvaW50c1sxXS55KTsKICBmb3IgKGxldCBpID0gMCwgZSA9IGNwb2ludHMubGVuZ3RoIC0gMzsgaSA8IGU7IGkrKykgewogICAgbGV0IFtjMSwgYzIsIGMzLCBjNF0gPSBjcG9pbnRzLnNsaWNlKGksIGkgKyA0KTsKICAgIGxldCBwMiA9IHsKICAgICAgeDogYzIueCArIChjMy54IC0gYzEueCkgLyAoNiAqIFQpLAogICAgICB5OiBjMi55ICsgKGMzLnkgLSBjMS55KSAvICg2ICogVCksCiAgICB9OwogICAgbGV0IHAzID0gewogICAgICB4OiBjMy54IC0gKGM0LnggLSBjMi54KSAvICg2ICogVCksCiAgICAgIHk6IGMzLnkgLSAoYzQueSAtIGMyLnkpIC8gKDYgKiBUKSwKICAgIH07CiAgICBfX2N0eC5iZXppZXJDdXJ2ZVRvKHAyLngsIHAyLnksIHAzLngsIHAzLnksIGMzLngsIGMzLnkpOwogIH0KICBlbmQoKTsKfTsKCmNvbnN0IHN0YXJ0ID0gKCkgPT4gewogIGlmIChfX2N0eC5saW5lV2lkdGggJSAyID09PSAxKSB7CiAgICBfX2N0eC50cmFuc2xhdGUoMC41LCAwLjUpOwogIH0KICBfX2N0eC5iZWdpblBhdGgoKTsKICBfX2ZpcnN0ID0gZmFsc2U7Cn07Cgpjb25zdCB0ZXh0ID0gKHN0ciwgeCwgeSwgeGFsaWduLCB5YWxpZ24gPSBgaW5oZXJpdGApID0+IHsKICBzYXZlKCk7CiAgaWYgKHhhbGlnbikgewogICAgc2V0VGV4dEFsaWduKHhhbGlnbiwgeWFsaWduKTsKICB9CiAgX19jdHguZmlsbFRleHQoc3RyLCB4LCB5KTsKICBpZiAoX190ZXh0U3Ryb2tlKSB7CiAgICBzZXRTdHJva2UoX190ZXh0U3Ryb2tlKTsKICAgIF9fY3R4LnN0cm9rZVRleHQoc3RyLCB4LCB5KTsKICB9CiAgcmVzdG9yZSgpOwp9OwoKY29uc3QgdHJpYW5nbGUgPSAoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykgPT4gewogIHN0YXJ0KCk7CiAgdmVydGV4KHgxLCB5MSk7CiAgdmVydGV4KHgyLCB5Mik7CiAgdmVydGV4KHgzLCB5Myk7CiAgdmVydGV4KHgxLCB5MSk7CiAgZW5kKCk7Cn07Cgpjb25zdCB2ZXJ0ZXggPSAoeCwgeSkgPT4gewogIGlmIChfX2ZpcnN0KSB7CiAgICBfX2N0eC5saW5lVG8oeCwgeSk7CiAgfSBlbHNlIHsKICAgIF9fZmlyc3QgPSB7IHgsIHkgfTsKICAgIF9fY3R4Lm1vdmVUbyh4LCB5KTsKICB9Cn07CgovLyAtLS0tLS0tLS0tIHRyYW5zZm9ybSBmdW5jdGlvbnMgLS0tLS0tLS0tLS0tLQoKY29uc3QgcmVzZXRUcmFuc2Zvcm0gPSAoKSA9PiB7CiAgX19jdHgucmVzZXRUcmFuc2Zvcm0oKTsKfTsKCmNvbnN0IHJvdGF0ZSA9IChhbmdsZSA9IDApID0+IHsKICBfX2N0eC5yb3RhdGUoYW5nbGUpOwp9OwoKY29uc3Qgc2NhbGUgPSAoeCA9IDEsIHkgPSB4KSA9PiB7CiAgX19jdHguc2NhbGUoeCwgeSk7Cn07Cgpjb25zdCBzY3JlZW5Ub1dvcmxkID0gKHgsIHkpID0+IHsKICBpZiAoeSA9PT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIGxldCBNID0gX19jdHguZ2V0VHJhbnNmb3JtKCkuaW52ZXJ0U2VsZigpOwoKICBsZXQgcmV0ID0gewogICAgeDogeCAqIE0uYSArIHkgKiBNLmMgKyBNLmUsCiAgICB5OiB4ICogTS5iICsgeSAqIE0uZCArIE0uZiwKICB9OwoKICByZXR1cm4gcmV0Owp9OwoKLyoqCiAqIHRyYW5zZm9ybXM6IHVuaXZlcnNhbCBmcmVlIHRyYW5zZm9ybSBiYXNlZCBvbiBhcHBseWluZwogKgogKiAgICAgICB8IGEgYiBjIHwKICogICBtID0gfCBkIGUgZiB8CiAqICAgICAgIHwgMCAwIDEgfAogKi8KY29uc3QgdHJhbnNmb3JtID0gKGEgPSAxLCBiID0gMCwgYyA9IDAsIGQgPSAwLCBlID0gMSwgZiA9IDApID0+IHsKICBfX2N0eC50cmFuc2Zvcm0oYSwgYiwgYywgZCwgZSwgZik7Cn07Cgpjb25zdCB0cmFuc2xhdGUgPSAoeCA9IDAsIHkgPSAwKSA9PiB7CiAgX19jdHgudHJhbnNsYXRlKHgsIHkpOwp9OwoKY29uc3Qgd29ybGRUb1NjcmVlbiA9ICh4LCB5KSA9PiB7CiAgaWYgKHkgPT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBsZXQgTSA9IF9fY3R4LmdldFRyYW5zZm9ybSgpOwoKICBsZXQgcmV0ID0gewogICAgeDogeCAqIE0uYSArIHkgKiBNLmMgKyBNLmUsCiAgICB5OiB4ICogTS5iICsgeSAqIE0uZCArIE0uZiwKICB9OwoKICByZXR1cm4gcmV0Owp9OwoKLy8gLS0tLS0tLS0tLS0tLS0tLSBzZXR0ZXJzIC0tLS0tLS0tLS0tLS0tLS0tLS0KCmNvbnN0IHNldEJvcmRlciA9ICh3aWR0aCA9IDEsIGNvbG9yID0gYGJsYWNrYCkgPT4gewogIGlmICghd2lkdGgpIHsKICAgIF9fY2FudmFzLnN0eWxlLmJvcmRlciA9IGBub25lYDsKICB9IGVsc2UgewogICAgX19jYW52YXMuc3R5bGUuYm9yZGVyID0gYCR7d2lkdGh9cHggc29saWQgJHtjb2xvcn1gOwogIH0KfTsKCmNvbnN0IHNldENvbG9yID0gKGNvbG9yKSA9PiB7CiAgc2V0RmlsbChjb2xvcik7CiAgc2V0U3Ryb2tlKGNvbG9yKTsKfTsKCmNvbnN0IHNldENyaXNwID0gKGVuYWJsZWQgPSB0cnVlKSA9PiB7CiAgX19jYW52YXMuY2xhc3NMaXN0LnRvZ2dsZShgY3Jpc3BgLCBlbmFibGVkKTsKfTsKCmNvbnN0IHNldEN1cnNvciA9ICh0eXBlKSA9PiB7CiAgX19jdXJyZW50X2N1cnNvciA9IHR5cGU7CiAgX19jYW52YXMuc3R5bGUuY3Vyc29yID0gX19jdXJyZW50X2N1cnNvcjsKfTsKCmNvbnN0IHNldEZpbGwgPSAoY29sb3IgPSBgYmxhY2tgKSA9PiB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdID09PSBfX2hpZ2hsaWdodF9jb2xvcikgewogICAgY29sb3IgPSBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwogIH0KICBfX2N0eC5maWxsU3R5bGUgPSBjb2xvcjsKfTsKCmNvbnN0IHNldEZvbnQgPSAoZm9udCkgPT4gewogIF9fY3R4LmZvbnQgPSBmb250IHx8IGAke19fZm9udC53ZWlnaHR9ICR7X19mb250LnNpemV9cHggJHtfX2ZvbnQuZmFtaWx5fWA7Cn07Cgpjb25zdCBzZXRGb250RmFtaWx5ID0gKG5hbWUpID0+IHsKICBfX2ZvbnQuZmFtaWx5ID0gbmFtZTsKICBzZXRGb250KCk7Cn07CmNvbnN0IHNldEZvbnRTaXplID0gKHB4KSA9PiB7CiAgX19mb250LnNpemUgPSBweDsKICBzZXRGb250KCk7Cn07Cgpjb25zdCBzZXRGb250V2VpZ2h0ID0gKHZhbCkgPT4gewogIF9fZm9udC53ZWlnaHQgPSB2YWw7CiAgc2V0Rm9udCgpOwp9OwoKY29uc3Qgc2V0R3JpZCA9IChzcGFjaW5nID0gMjAsIGNvbG9yID0gYGxpZ2h0Z3JleWApID0+IHsKICBfX2RyYXdfZ3JpZCA9IHRydWU7CiAgX19ncmlkX3NwYWNpbmcgPSBzcGFjaW5nOwogIF9fZ3JpZF9jb2xvciA9IGNvbG9yOwp9OwoKY29uc3Qgc2V0SGlnaGxpZ2h0Q29sb3IgPSAoY29sb3IpID0+IHsKICBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yID0gY29sb3I7Cn07Cgpjb25zdCBzZXRMaW5lRGFzaCA9ICguLi52YWx1ZXMpID0+IHsKICBfX2N0eC5zZXRMaW5lRGFzaCh2YWx1ZXMpOwp9OwoKY29uc3Qgc2V0TGluZVdpZHRoID0gKHdpZHRoID0gMSkgPT4gewogIF9fY3R4LmxpbmVXaWR0aCA9IHdpZHRoOwp9OwoKY29uc3Qgc2V0U3Ryb2tlID0gKGNvbG9yID0gYGJsYWNrYCkgPT4gewogIGlmIChDU1NfQ09MT1JfTUFQW2NvbG9yXSA9PT0gX19oaWdobGlnaHRfY29sb3IpIHsKICAgIGNvbG9yID0gX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvcjsKICB9CiAgX19jdHguc3Ryb2tlU3R5bGUgPSBjb2xvcjsKfTsKCmNvbnN0IHNldFRleHRBbGlnbiA9ICh4YWxpZ24sIHlhbGlnbiA9IEFMUEhBQkVUSUMpID0+IHsKICBfX2N0eC50ZXh0QWxpZ24gPSB4YWxpZ247CiAgX19jdHgudGV4dEJhc2VMaW5lID0geWFsaWduOwp9OwoKY29uc3Qgc2V0VGV4dERpcmVjdGlvbiA9IChkaXIgPSBgaW5oZXJpdGApID0+IHsKICBfX2N0eC5kaXJlY3Rpb24gPSBkaXI7Cn07Cgpjb25zdCBzZXRUZXh0U3Ryb2tlID0gKGNvbG9yLCB3aWR0aCkgPT4gewogIF9fdGV4dFN0cm9rZSA9IGNvbG9yOwogIHNldExpbmVXaWR0aCh3aWR0aCk7Cn07CgovLyAtLS0tLS0tLS0tLS0tLS0tICJubyAuLi4iIC0tLS0tLS0tLS0tLS0tLS0tLS0KCmNvbnN0IG5vQm9yZGVyID0gKCkgPT4gewogIHNldEJvcmRlcihmYWxzZSk7Cn07Cgpjb25zdCBub0NvbG9yID0gKCkgPT4gewogIG5vRmlsbCgpOwogIG5vU3Ryb2tlKCk7Cn07Cgpjb25zdCBub0N1cnNvciA9ICgpID0+IHsKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgbm9uZWA7Cn07Cgpjb25zdCBub0ZpbGwgPSAoKSA9PiB7CiAgc2V0RmlsbChgdHJhbnNwYXJlbnRgKTsKfTsKCmNvbnN0IG5vR3JpZCA9ICgpID0+IHsKICBfX2RyYXdfZ3JpZCA9IGZhbHNlOwp9OwoKY29uc3Qgbm9MaW5lRGFzaCA9ICgpID0+IHsKICBfX2N0eC5zZXRMaW5lRGFzaChbXSk7Cn07Cgpjb25zdCBub01hcmdpbmcgPSAoKSA9PiB7CiAgc2V0TWFyZ2luKDApOwp9OwoKY29uc3Qgbm9TaGFkb3cgPSAoKSA9PiB7CiAgc2V0U2hhZG93KGB0cmFuc3BhcmVudGAsIDApOwp9OwoKY29uc3Qgbm9TdHJva2UgPSAoKSA9PiB7CiAgc2V0U3Ryb2tlKGB0cmFuc3BhcmVudGApOwp9OwoKY29uc3Qgbm9UZXh0U3Ryb2tlID0gKCkgPT4gewogIHNldFRleHRTdHJva2UoZmFsc2UsIHVuZGVmaW5lZCk7Cn07Cg=="),S=class extends h{static{o(this,"GraphicsElement")}constructor(){super(),this.label=document.createElement("label"),this.title||(this.title=""),this.label.textContent=this.title}handleAttributeChange(...e){}handleChildChanges(...e){}connectedCallback(){super.connectedCallback(),k(this)?this.loadSource():new IntersectionObserver((e,x)=>e.forEach(r=>{r.isIntersecting&&(this.loadSource(),x.disconnect())}),{threshold:.1,rootMargin:`${window.innerHeight}px`}).observe(this)}getStyle(){return`
      :host([hidden]) {
        display: none;
      }
      :host style {
        display: none;
      }
      :host .top-title {
        display: flex;
        flex-direction: row-reverse;
        justify-content: space-between;
      }
      :host canvas {
        touch-action: none;
        user-select: none;
        position: relative;
        z-index: 1;
        display: block;
        margin: auto;
        border-radius: 0;
        box-sizing: content-box!important;
        border: 1px solid lightgrey;
      }
      :host canvas.crisp {
        image-rendering: -moz-crisp-edges;
        image-rendering: -webkit-crisp-edges;
        image-rendering: pixelated;
        image-rendering: crisp-edges;
      }
      :host canvas:focus {
        border: 1px solid red;
      }
      :host a.view-source {
        font-size: 60%;
        text-decoration: none;
      }
      :host button.reset {
        font-size: 0.5em;
        top: -0.35em;
        position: relative;
      }
      :host label:not(:empty) {
        display: block;
        font-style:italic;
        font-size: 0.9em;
        text-align: right;
        padding-right: 1em;
        margin-top: 0.35em;
      }
    `}async loadSource(e,x,r){if(e&&x&&(this.style.width=e,this.style.height=x),!r)if(this.userCode)r=this.userCode;else{let f=this.getAttribute("src");f?r=await(await fetch(f)).text():r=`function setup() {
}
function draw() {
}
`}this.userCode=r;let $=r.matchAll(/addSlider\(['"`](.*)['"`],\s*/g),t=[];for(let f of $)t.push(f[1]),r=r.replace(f[0],f[0]+`(v) => (${f[1]} = v), `);t.length&&(r="let "+t.join(", ")+`;
`+r),r=r.replaceAll(/ from ['"].([^'"]+)['"]/g,` from "${C(location.href)}/$1"`);let s=this.getAttribute("width"),a=this.getAttribute("height");s&&a&&(r=r.replace("function setup() {",`function setup() {
  setSize(${s}, ${a});`)),import(`data:text/javascript;base64,${M([`import { BSpline, Point, Circle, Vector, Matrix, CSS_COLOR_MAP } from "${P}";`,`const __randomId = "${Date.now()}";`,W,r,"export { reset as start, __canvas as canvas, halt, highlight }"].join(`
`))}`).then(f=>{let{start:l,canvas:d,halt:E,highlight:c}=f;this.canvas=d,this.halt=()=>E(),this.highlight=u=>c(u),this.render(),e&&x&&(this.style.width="",this.style.height=""),l(this),this.dispatchEvent(new CustomEvent("load")),this.onload&&this.onload()})}render(){super.render();let e=this._slot.parentNode;this.canvas&&e.insertBefore(this.canvas,this._slot),this.label&&e.insertBefore(this.label,this._slot);let x=document.createElement("div");x.classList.add("top-title");let r=document.createElement("button");r.classList.add("reset"),r.textContent=this.getAttribute("reset")||"reset",r.addEventListener("click",()=>{let{width:t,height:s}=this.halt();this.crosslinked=!1,this.querySelector("button.remove-color")?.remove(),this.loadSource(t,s)}),x.append(r);let $=this.getAttribute("src");if($){let t=document.createElement("a");t.classList.add("view-source"),t.textContent=this.getAttribute("viewSource")||"view source",t.href=$,t.target="_blank",x.append(t)}this.label&&e.insertBefore(x,this.canvas),this.crosslink()}crosslink(){if(this.crosslinked)return;this.crosslinked=!0;let e=!1;if(this.querySelectorAll("p").forEach(x=>{x.querySelectorAll("*").forEach(r=>{if(!O.includes(r.tagName))return;e=!0;let $;r.classList.remove("calm"),r.addEventListener("pointerenter",()=>{$??=getComputedStyle(r)["-webkit-text-stroke-color"],this.highlight($)}),r.addEventListener("pointerleave",()=>this.highlight(!1))})}),e){let x=document.createElement("button");x.textContent="remove colors",x.classList.add("remove-color"),x.addEventListener("click",()=>{this.querySelectorAll("p").forEach(r=>{r.querySelectorAll("*").forEach($=>{O.includes($.tagName)&&$.classList.add("calm")})}),x.remove()}),this.append(x)}}};await h.register(S);export{A as BSpline,w as CSS_COLOR_MAP,I as Circle,m as Matrix,L as Point,R as Vector};
