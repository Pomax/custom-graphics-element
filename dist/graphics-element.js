var K=Object.defineProperty;var f=(a,e)=>K(a,"name",{value:e,configurable:!0});var G="registered as custom element";function U(a,e){console.warn(`missing implementation for ${e}(...data) in ${a.__proto__.constructor.name}`)}f(U,"NotImplemented");function C(a){return a.prototype.constructor.name.replace(/([A-Z])([a-z])/g,(e,t,r,$)=>{let x=`${t.toLowerCase()}${r}`;return $>0?`-${x}`:x})}f(C,"getElementTagName");var E=class extends HTMLElement{static{f(this,"CustomElement")}static register(e){if(!e[G]){let t=e.tagName||C(e);return customElements.define(t,e),e[G]=!0,customElements.whenDefined(t)}return Promise.resolve()}static get tagName(){return C(this)}constructor(e={}){super(),customElements.resolveScope||(customElements.resolveScope=function($){try{return $.getRootNode().host}catch(x){console.warn(x)}return window}),this._options=e;let t={childList:$=>{this.handleChildChanges(Array.from($.addedNodes),Array.from($.removedNodes)),this.render()},attributes:$=>{this.handleAttributeChange($.attributeName,$.oldValue,this.getAttribute($.attributeName)),this.render()}};this._observer=new MutationObserver($=>{this.isConnected&&$.forEach(x=>{t[x.type](x)})}),this._observer.observe(this,{childList:!0,attributes:!0});let r={mode:"open"};this._shadow=this.attachShadow(r),this._style=document.createElement("style"),this._style.textContent=this.getStyle(),this._options.header!==!1&&(this._header=document.createElement("header")),this._options.slot!==!1&&this._options.void!==!0&&(this._slot=document.createElement("slot")),this._options.footer!==!1&&(this._footer=document.createElement("footer"))}connectedCallback(){this.render()}handleChildChanges(e,t){this._options.void||U(this,"handleChildChanges")}handleAttributeChange(e,t,r){U(this,"handleAttributeChange")}getStyle(){return""}render(){this._shadow.innerHTML="",this._shadow.append(this._style),this._options.header!==!1&&this._shadow.append(this._header),this._options.slot!==!1&&this._shadow.append(this._slot),this._options.footer!==!1&&this._shadow.append(this._footer)}};var y=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREEN","DARKGREY","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREEN","GREENYELLOW","GREY","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREEN","LIGHTGREY","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TRANSPARENT","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN"],v={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(128, 128, 128)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",transparent:"rgba(0,0,0,0)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",ALICEBLUE:"rgb(240, 248, 255)",ANTIQUEWHITE:"rgb(250, 235, 215)",AQUA:"rgb(0, 255, 255)",AQUAMARINE:"rgb(127, 255, 212)",AZURE:"rgb(240, 255, 255)",BEIGE:"rgb(245, 245, 220)",BISQUE:"rgb(255, 228, 196)",BLACK:"rgb(0, 0, 0)",BLANCHEDALMOND:"rgb(255, 235, 205)",BLUE:"rgb(0, 0, 255)",BLUEVIOLET:"rgb(138, 43, 226)",BROWN:"rgb(165, 42, 42)",BURLYWOOD:"rgb(222, 184, 135)",CADETBLUE:"rgb(95, 158, 160)",CHARTREUSE:"rgb(127, 255, 0)",CHOCOLATE:"rgb(210, 105, 30)",CORAL:"rgb(255, 127, 80)",CORNFLOWERBLUE:"rgb(100, 149, 237)",CORNSILK:"rgb(255, 248, 220)",CRIMSON:"rgb(220, 20, 60)",CYAN:"rgb(0, 255, 255)",DARKBLUE:"rgb(0, 0, 139)",DARKCYAN:"rgb(0, 139, 139)",DARKGOLDENROD:"rgb(184, 134, 11)",DARKGRAY:"rgb(169, 169, 169)",DARKGREEN:"rgb(0, 100, 0)",DARKGREY:"rgb(169, 169, 169)",DARKKHAKI:"rgb(189, 183, 107)",DARKMAGENTA:"rgb(139, 0, 139)",DARKOLIVEGREEN:"rgb(85, 107, 47)",DARKORANGE:"rgb(255, 140, 0)",DARKORCHID:"rgb(153, 50, 204)",DARKRED:"rgb(139, 0, 0)",DARKSALMON:"rgb(233, 150, 122)",DARKSEAGREEN:"rgb(143, 188, 143)",DARKSLATEBLUE:"rgb(72, 61, 139)",DARKSLATEGRAY:"rgb(47, 79, 79)",DARKSLATEGREY:"rgb(47, 79, 79)",DARKTURQUOISE:"rgb(0, 206, 209)",DARKVIOLET:"rgb(148, 0, 211)",DEEPPINK:"rgb(255, 20, 147)",DEEPSKYBLUE:"rgb(0, 191, 255)",DIMGRAY:"rgb(105, 105, 105)",DIMGREY:"rgb(105, 105, 105)",DODGERBLUE:"rgb(30, 144, 255)",FIREBRICK:"rgb(178, 34, 34)",FLORALWHITE:"rgb(255, 250, 240)",FORESTGREEN:"rgb(34, 139, 34)",FUCHSIA:"rgb(255, 0, 255)",GAINSBORO:"rgb(220, 220, 220)",GHOSTWHITE:"rgb(248, 248, 255)",GOLD:"rgb(255, 215, 0)",GOLDENROD:"rgb(218, 165, 32)",GRAY:"rgb(128, 128, 128)",GREEN:"rgb(0, 128, 0)",GREENYELLOW:"rgb(173, 255, 47)",GREY:"rgb(128, 128, 128)",HONEYDEW:"rgb(240, 255, 240)",HOTPINK:"rgb(255, 105, 180)",INDIANRED:"rgb(205, 92, 92)",INDIGO:"rgb(75, 0, 130)",IVORY:"rgb(255, 255, 240)",KHAKI:"rgb(240, 230, 140)",LAVENDER:"rgb(230, 230, 250)",LAVENDERBLUSH:"rgb(255, 240, 245)",LAWNGREEN:"rgb(124, 252, 0)",LEMONCHIFFON:"rgb(255, 250, 205)",LIGHTBLUE:"rgb(173, 216, 230)",LIGHTCORAL:"rgb(240, 128, 128)",LIGHTCYAN:"rgb(224, 255, 255)",LIGHTGOLDENRODYELLOW:"rgb(250, 250, 210)",LIGHTGRAY:"rgb(211, 211, 211)",LIGHTGREEN:"rgb(144, 238, 144)",LIGHTGREY:"rgb(211, 211, 211)",LIGHTPINK:"rgb(255, 182, 193)",LIGHTSALMON:"rgb(255, 160, 122)",LIGHTSEAGREEN:"rgb(32, 178, 170)",LIGHTSKYBLUE:"rgb(135, 206, 250)",LIGHTSLATEGRAY:"rgb(119, 136, 153)",LIGHTSLATEGREY:"rgb(119, 136, 153)",LIGHTSTEELBLUE:"rgb(176, 196, 222)",LIGHTYELLOW:"rgb(255, 255, 224)",LIME:"rgb(0, 255, 0)",LIMEGREEN:"rgb(50, 205, 50)",LINEN:"rgb(250, 240, 230)",MAGENTA:"rgb(255, 0, 255)",MAROON:"rgb(128, 0, 0)",MEDIUMAQUAMARINE:"rgb(102, 205, 170)",MEDIUMBLUE:"rgb(0, 0, 205)",MEDIUMORCHID:"rgb(186, 85, 211)",MEDIUMPURPLE:"rgb(147, 112, 219)",MEDIUMSEAGREEN:"rgb(60, 179, 113)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",MEDIUMSPRINGGREEN:"rgb(0, 250, 154)",MEDIUMTURQUOISE:"rgb(72, 209, 204)",MEDIUMVIOLETRED:"rgb(199, 21, 133)",MIDNIGHTBLUE:"rgb(25, 25, 112)",MINTCREAM:"rgb(245, 255, 250)",MISTYROSE:"rgb(255, 228, 225)",MOCCASIN:"rgb(255, 228, 181)",NAVAJOWHITE:"rgb(255, 222, 173)",NAVY:"rgb(0, 0, 128)",OLDLACE:"rgb(253, 245, 230)",OLIVE:"rgb(128, 128, 0)",OLIVEDRAB:"rgb(107, 142, 35)",ORANGE:"rgb(255, 165, 0)",ORANGERED:"rgb(255, 69, 0)",ORCHID:"rgb(218, 112, 214)",PALEGOLDENROD:"rgb(238, 232, 170)",PALEGREEN:"rgb(152, 251, 152)",PALETURQUOISE:"rgb(175, 238, 238)",PALEVIOLETRED:"rgb(219, 112, 147)",PAPAYAWHIP:"rgb(255, 239, 213)",PEACHPUFF:"rgb(255, 218, 185)",PERU:"rgb(205, 133, 63)",PINK:"rgb(255, 192, 203)",PLUM:"rgb(221, 160, 221)",POWDERBLUE:"rgb(176, 224, 230)",PURPLE:"rgb(128, 0, 128)",REBECCAPURPLE:"rgb(102, 51, 153)",RED:"rgb(255, 0, 0)",ROSYBROWN:"rgb(188, 143, 143)",ROYALBLUE:"rgb(65, 105, 225)",SADDLEBROWN:"rgb(139, 69, 19)",SALMON:"rgb(250, 128, 114)",SANDYBROWN:"rgb(244, 164, 96)",SEAGREEN:"rgb(46, 139, 87)",SEASHELL:"rgb(255, 245, 238)",SIENNA:"rgb(160, 82, 45)",SILVER:"rgb(192, 192, 192)",SKYBLUE:"rgb(135, 206, 235)",SLATEBLUE:"rgb(106, 90, 205)",SLATEGRAY:"rgb(112, 128, 144)",SLATEGREY:"rgb(112, 128, 144)",SNOW:"rgb(255, 250, 250)",SPRINGGREEN:"rgb(0, 255, 127)",STEELBLUE:"rgb(70, 130, 180)",TAN:"rgb(210, 180, 140)",TEAL:"rgb(0, 128, 128)",THISTLE:"rgb(216, 191, 216)",TOMATO:"rgb(255, 99, 71)",TRANSPARENT:"rgba(0,0,0,0)",TURQUOISE:"rgb(64, 224, 208)",VIOLET:"rgb(238, 130, 238)",WHEAT:"rgb(245, 222, 179)",WHITE:"rgb(255, 255, 255)",WHITESMOKE:"rgb(245, 245, 245)",YELLOW:"rgb(255, 255, 0)",YELLOWGREEN:"rgb(154, 205, 50)"};function D(a,e,t,r,$,A,l){var i,n,s,o,g=t.length,c=t[0].length;if(e<1)throw new Error("degree must be at least 1 (linear)");if(e>g-1)throw new Error("degree must be less than or equal to point count - 1");if(!$)for($=[],i=0;i<g;i++)$[i]=1;if($.length<t.length&&($=$.concat($.slice(0,e))),r){if(r.length!==g+e+1)throw new Error("bad knot vector length")}else{var r=[];for(i=0;i<g+e+1;i++)r[i]=i}r.length===t.length&&(r=r.concat(r.slice(0,e)));var b=[e,r.length-1-e],L=r[b[0]],u=r[b[1]];if(l||(a=a*(u-L)+L),a<L||a>u)throw new Error("out of bounds");for(s=b[0];s<b[1]&&!(a>=r[s]&&a<=r[s+1]);s++);var d=[];for(i=0;i<g;i++){for(d[i]=[],n=0;n<c;n++)d[i][n]=t[i][n]*$[i];d[i][c]=$[i]}var m;for(o=1;o<=e+1;o++)for(i=s;i>s-e-1+o;i--)for(m=(a-r[i])/(r[i+e+1-o]-r[i]),n=0;n<c+1;n++)d[i][n]=(1-m)*d[i-1][n]+m*d[i][n];var A=A||[];for(i=0;i<c;i++)A[i]=d[s][i]/d[s][c];return A}f(D,"interpolate");var h=3,p=class{static{f(this,"BSpline")}constructor(e,t=!0){this.points=e,this.points=e.map(r=>r instanceof Array?r:[r.x,r.y]),this.formKnots(t),this.formWeights()}getLUT(e=100){let t=e-1;return[...new Array(e)].map((r,$)=>{let x=D($/t,h,this.points,this.knots,this.weights);return{x:x[0],y:x[1]}})}formKnots(e=!1){if(!e)return this.formUniformKnots();let t=[],r=this.points.length,$=r-h;for(let x=1;x<r-h;x++)t.push(x+h);for(let x=0;x<=h;x++)t=[h].concat(t);for(let x=0;x<=h;x++)t.push($+h);return this.knots=t}formUniformKnots(){return this.knots=[...new Array(this.points.length+h+1)].map((e,t)=>t)}formWeights(){return this.weights=this.points.map(e=>1)}};var R=class{static{f(this,"Point")}constructor(e,t){this.x=e,this.y=t}},O=class extends R{static{f(this,"Circle")}constructor(e,t,r){super(e,t),this.r=r}};var I=class a{static{f(this,"Vector")}constructor(e,t,r){arguments.length===1&&(r=e.z,t=e.y,e=e.x),this.x=e,this.y=t,r!==void 0&&(this.z=r)}dist(e,t,r=0){t!==void 0&&(e={x:e,y:t,z:r});let $=0;$+=(this.x-e.x)**2,$+=(this.y-e.y)**2;let x=this.z?this.z:0,l=e.z?e.z:0;return $+=(x-l)**2,$**.5}normalize(e){let t=this.dist(0,0,0);return new a(e*this.x/t,e*this.y/t,e*this.z/t)}getAngle(){return-Math.atan2(this.y,this.x)}reflect(e){let t=new a(e.x-this.x,e.y-this.y);return e.z!==void 0&&(t.z=e.z,this.z!==void 0&&(t.z-=this.z)),this.subtract(t)}add(e){let t=new a(this.x+e.x,this.y+e.y);return this.z!==void 0&&(t.z=this.z,e.z!==void 0&&(t.z+=e.z)),t}subtract(e){let t=new a(this.x-e.x,this.y-e.y);return this.z!==void 0&&(t.z=this.z,e.z!==void 0&&(t.z-=e.z)),t}scale(e=1){if(e===0)return new a(0,0,this.z===void 0?void 0:0);let t=new a(this.x*e,this.y*e);return this.z!==void 0&&(t.z=this.z*e),t}};function Y(a){if(a.length!==a[0].length){console.warn("Cannot invert non-square matrices");return}var e=0,t=0,r=0,$=a.length,x=0,l=0,i=[],n=[];for(e=0;e<$;e+=1)for(i[i.length]=[],n[n.length]=[],r=0;r<$;r+=1)e==r?i[e][r]=1:i[e][r]=0,n[e][r]=a[e][r];for(e=0;e<$;e+=1){if(x=n[e][e],x==0){for(t=e+1;t<$;t+=1)if(n[t][e]!=0){for(r=0;r<$;r++)x=n[e][r],n[e][r]=n[t][r],n[t][r]=x,x=i[e][r],i[e][r]=i[t][r],i[t][r]=x;break}if(x=n[e][e],x==0)return}for(r=0;r<$;r++)n[e][r]=n[e][r]/x,i[e][r]=i[e][r]/x;for(t=0;t<$;t++)if(t!=e)for(x=n[t][e],r=0;r<$;r++)n[t][r]-=x*n[e][r],i[t][r]-=x*i[e][r]}return i}f(Y,"invert");function P(a,e){var t=[],r=M(e);return a.forEach(($,x)=>{t[x]=[],r.forEach((l,i)=>{t[x][i]=$.map((n,s)=>l[s]*n).reduce((n,s)=>n+s,0)})}),t}f(P,"multiply");function M(a){return a[0].map((e,t)=>a.map(r=>r[t]))}f(M,"transpose");var N=class a{static{f(this,"Matrix")}constructor(e,t,r){r=e instanceof Array?e:r,this.data=r??[...new Array(e)].map($=>[...new Array(t)].map(x=>0)),this.rows=this.data.length,this.cols=this.data[0].length}setData(e){this.data=e}get(e,t){return this.data[e][t]}set(e,t,r){this.data[e][t]=r}row(e){return this.data[e]}col(e){var t=this.data,r=[];for(let $=0,x=t.length;$<x;$++)r.push(t[$][e]);return r}multiply(e){return new a(P(this.data,e.data))}invert(){return new a(Y(this.data))}transpose(){return new a(M(this.data))}};function S(a){let e=new TextEncoder().encode(a),t=String.fromCodePoint(...e);return btoa(t)}f(S,"base64");function H(a){let e=atob(a),t=Uint8Array.from(e,r=>r.codePointAt(0));return new TextDecoder().decode(t)}f(H,"decode64");function k(a){let e=/^(.*)\/([^.]+(\.([^\/?#]+))+)(\?[^#]*)?(#.*)?$/,t=a.match(e);if(t!==null){let{[1]:r,[2]:$,[4]:x}=t;a=r}return a}f(k,"getURLbase");function B(a){if(typeof window>"u"||typeof document>"u")return!0;var e=a.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}f(B,"isInViewport");var _=String(import.meta.url),W=H("Y29uc3QgQUxQSEFCRVRJQyA9IGBhbHBoYWJldGljYDsKY29uc3QgQVVUTyA9IGBhdXRvYDsKY29uc3QgQk9UVE9NID0gYGJvdHRvbWA7CmNvbnN0IEJPVFRPTV9MRUZUID0gYGJvdHRvbi1sZWZ0YDsKY29uc3QgQk9UVE9NX1JJR0hUID0gYGJvdHRvbS1yaWdodGA7CmNvbnN0IENFTlRFUiA9IGBjZW50ZXJgOwpjb25zdCBDT05TVFJBSU4gPSB0cnVlOwpjb25zdCBDUk9TUyA9IGBjcm9zc2hhaXJgOwpjb25zdCBFTkQgPSBgZW5kYDsKY29uc3QgSEFORCA9IGBwb2ludGVyYDsKY29uc3QgSEFOR0lORyA9IGBoYW5naW5nYDsKY29uc3QgSURFT0dSQVBISUMgPSBgaWRlb2dyYXBoaWNgOwpjb25zdCBMRUZUID0gYGxlZnRgOwpjb25zdCBNSURETEUgPSBgbWlkZGxlYDsKY29uc3QgUE9JTlRFUiA9IGBkZWZhdWx0YDsKY29uc3QgUklHSFQgPSBgcmlnaHRgOwpjb25zdCBTVEFSVCA9IGBzdGFydGA7CmNvbnN0IFRPUCA9IGB0b3BgOwpjb25zdCBUT1BfTEVGVCA9IGB0b3AtbGVmdGA7CmNvbnN0IFRPUF9SSUdIVCA9IGB0b3AtcmlnaHRgOwoKLy8gImludGVybmFsIiB2YXJzCgpsZXQgX19jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBjYW52YXNgKTsKX19jYW52YXMudGFiSW5kZXggPSAwOwpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBwb2ludGVyZG93bmAsICgpID0+IF9fY2FudmFzLmZvY3VzKCkpOwpsZXQgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwoKbGV0IF9fY3VycmVudF9jdXJzb3I7CmxldCBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19jdXJyZW50X2h1ZTsKbGV0IF9fZHJhd19ncmlkOwpsZXQgX19kcmF3aW5nOwpsZXQgX19lbGVtZW50OwpsZXQgX19maW5pc2hlZF9zZXR1cDsKbGV0IF9fZmlyc3Q7CmxldCBfX2ZvbnQ7CmxldCBfX2dyaWRfY29sb3I7CmxldCBfX2dyaWRfc3BhY2luZzsKbGV0IF9faGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19tb3ZhYmxlX3BvaW50czsKbGV0IF9fcmVkcmF3aW5nOwpsZXQgX19zdGFydF90aW1lOwpsZXQgX19zdHlsZV9zdGFjazsKbGV0IF9fdGV4dFN0cm9rZTsKbGV0IF9fbGFzdF9mcmFtZTsKCmNvbnN0IF9fcHJuZyA9IG5ldyAoY2xhc3MgewogIGNvbnN0cnVjdG9yKHNlZWQgPSBEYXRlLm5vdygpKSB7CiAgICB0aGlzLmEgPSBzZWVkOwogIH0KICByZXNlZWQoc2VlZCkgewogICAgdGhpcy5hID0gc2VlZDsKICB9CiAgbmV4dCgpIHsKICAgIC8vIFNwbGl0TWl4MzIsIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS80NzU5MzMxNi83NDA1NTMKICAgIGxldCB7IGEgfSA9IHRoaXM7CiAgICBhIHw9IDA7CiAgICBhID0gKGEgKyAweDllMzc3OWI5KSB8IDA7CiAgICBsZXQgdCA9IGEgXiAoYSA+Pj4gMTYpOwogICAgdCA9IE1hdGguaW11bCh0LCAweDIxZjBhYWFkKTsKICAgIHQgPSB0IF4gKHQgPj4+IDE1KTsKICAgIHQgPSBNYXRoLmltdWwodCwgMHg3MzVhMmQ5Nyk7CiAgICB0aGlzLmEgPSBhOwogICAgcmV0dXJuICgodCA9IHQgXiAodCA+Pj4gMTUpKSA+Pj4gMCkgLyA0Mjk0OTY3Mjk2OwogIH0KfSkoKTsKCmFzeW5jIGZ1bmN0aW9uIHJlc2V0KGVsZW1lbnQgPSBfX2VsZW1lbnQpIHsKICBfX2VsZW1lbnQgPSBlbGVtZW50OwoKICAvLyBkZWZhdWx0IHZhcmlhYmxlIHZhbHVlcwogIF9fY3VycmVudF9jdXJzb3IgPSBgYXV0b2A7CiAgX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvciA9IGByZ2IoMCwyNTQsMTI0KWA7CiAgX19jdXJyZW50X2h1ZSA9IDA7CiAgX19kcmF3X2dyaWQgPSB0cnVlOwogIF9fZHJhd2luZyA9IGZhbHNlOwogIF9fZmluaXNoZWRfc2V0dXAgPSBmYWxzZTsKICBfX2ZvbnQgPSB7IGZhbWlseTogYHNhbnMtc2VyaWZgLCBzaXplOiAxNiwgd2VpZ2h0OiA0MDAgfTsKICBfX2dyaWRfY29sb3IgPSBgbGlnaHRncmV5YDsKICBfX2dyaWRfc3BhY2luZyA9IDIwOwogIF9faGlnaGxpZ2h0X2NvbG9yID0gZmFsc2U7CiAgX19tb3ZhYmxlX3BvaW50cyA9IFtdOwogIF9fcmVkcmF3aW5nID0gZmFsc2U7CiAgX19zdGFydF90aW1lID0gRGF0ZS5ub3coKTsKICBfX3N0eWxlX3N0YWNrID0gW107CiAgX190ZXh0U3Ryb2tlID0gYHRyYW5zcGFyZW50YDsKCiAgY3VycmVudFBvaW50ID0gZmFsc2U7CiAgcGxheWluZyA9IGZhbHNlOwogIGZyYW1lID0gMDsKICBwb2ludGVyLnggPSAwOwogIHBvaW50ZXIueSA9IDA7CiAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoa2V5Ym9hcmQpLmZvckVhY2goKG4pID0+IGRlbGV0ZSBrZXlib2FyZFtuXSk7CgogIC8vIG1ha2Ugc3VyZSB3ZSBkb24ndCBkb3VibGUtZ2VuZXJhdGUgdGhlc2U6CiAgY2xlYXJTbGlkZXJzKCk7CiAgY2xlYXJCdXR0b25zKCk7CgogIC8vIHJ1biBzZXR1cAogIGF3YWl0IF9fc2V0dXAoKTsKICBfX2ZpbmlzaGVkX3NldHVwID0gdHJ1ZTsKCiAgLy8gcnVuIGZpcnN0IGRyYXcKICBfX2xhc3RfZnJhbWUgPSBEYXRlLm5vdygpOwogIGF3YWl0IF9fZHJhdygpOwoKICByZXR1cm4geyB3aWR0aCwgaGVpZ2h0IH07Cn0KCmZ1bmN0aW9uIGhhbHQoKSB7CiAgcGxheWluZyA9IGZhbHNlOwogIF9fY2FudmFzID0gdW5kZWZpbmVkOwogIF9fY3R4ID0gdW5kZWZpbmVkOwogIF9fZmluaXNoZWRfc2V0dXAgPSBmYWxzZTsKICBfX2RyYXdpbmcgPSB0cnVlOwogIF9fcmVkcmF3aW5nID0gdHJ1ZTsKICBfX2ZpcnN0ID0gdW5kZWZpbmVkOwogIF9fbW92YWJsZV9wb2ludHMgPSB1bmRlZmluZWQ7CiAgX19jdXJyZW50X2N1cnNvciA9IHVuZGVmaW5lZDsKICBfX2N1cnJlbnRfaHVlID0gMDsKICBfX2ZvbnQgPSB1bmRlZmluZWQ7CiAgX19zdGFydF90aW1lID0gMDsKICBjbGVhclNsaWRlcnMoKTsKICBjbGVhckJ1dHRvbnMoKTsKfQoKZnVuY3Rpb24gX19nZXREZXNjcmlwdGlvbigpIHsKICBpZiAodHlwZW9mIGdldERlc2NyaXB0aW9uICE9PSBgdW5kZWZpbmVkYCkgcmV0dXJuIGdldERlc2NyaXB0aW9uKCk7Cn0KCmFzeW5jIGZ1bmN0aW9uIF9fc2V0dXAoKSB7CiAgaWYgKHR5cGVvZiBzZXR1cCAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IHNldHVwKCk7CiAgaWYgKHR5cGVvZiBfX21vcmVfc2V0dXAgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBfX21vcmVfc2V0dXAoKTsKICBpZiAoIXdpZHRoICYmICFoZWlnaHQpIHNldFNpemUoKTsKfQoKYXN5bmMgZnVuY3Rpb24gX19kcmF3KCkgewogIGlmICghX19maW5pc2hlZF9zZXR1cCkgcmV0dXJuOwogIGlmICghX19kcmF3aW5nKSB7CiAgICBfX2RyYXdpbmcgPSB0cnVlOwogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICAgIGZyYW1lRGVsdGEgPSBub3cgLSBfX2xhc3RfZnJhbWU7CiAgICBmcmFtZSsrOwogICAgcmVzZXRUcmFuc2Zvcm0oKTsKICAgIGlmICh0eXBlb2YgZHJhdyAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IGRyYXcoKTsKICAgIGlmICh0eXBlb2YgX19tb3JlX2RyYXcgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBfX21vcmVfZHJhdygpOwogICAgX19kcmF3aW5nID0gZmFsc2U7CiAgICBfX2xhc3RfZnJhbWUgPSBub3c7CiAgICBpZiAocGxheWluZykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IF9fZHJhdygpKTsKICB9Cn0KLyoqCiAqIFRoZSBjdXJyZW50IGZyYW1lIG51bWJlcgogKgogKiBAY29uc3RhbnQge251bWJlcn0KICovCmxldCBmcmFtZSA9IDA7CgovKioKICogVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgc2luY2UgdGhlIGxhc3QgZnJhbWUuCiAqCiAqIEBjb25zdGFudCB7bnVtYmVyfQogKi8KbGV0IGZyYW1lRGVsdGEgPSAwOwoKLyoqCiAqIFRoZSBoZWlnaHQgb2YgdGhlIGNhbnZhcyBpbiBwaXhlbHMKICoKICogQGNvbnN0YW50IHtudW1iZXJ9CiAqLwpsZXQgaGVpZ2h0ID0gMDsKCi8qKgogKiBUaGUgd2lkdGggb2YgdGhlIGNhbnZhcyBpbiBwaXhlbHMKICoKICogQGNvbnN0YW50IHtudW1iZXJ9CiAqLwpsZXQgd2lkdGggPSAwOwoKLyoqCiAqIFRoZSBjdXJyZW50IHBsYXkgc3RhdGUKICoKICogQGNvbnN0YW50IHtib29sZWFufQogKi8KbGV0IHBsYXlpbmcgPSBmYWxzZTsKCi8qKgogKiBUaGUgYHBvaW50ZXJgIG9iamVjdCByZXByZXNlbnRzIHRoZSBtb3VzZSBjdXJzb3IgKHdoZW4gdXNpbmcKICogYSBtb3VzZSkgb3IgZmluZ2VyIHBvc2l0aW9uIChmb3IgdG91Y2ggZGV2aWNlcyksIGFuZCBtb2RlbHMKICogc2V2ZXJhbCBhc3BlY3RzOgogKgogKiAtIGBhY3RpdmVgIChib29sZWFuKSBXaGV0aGVyIHRoZSBwb2ludGVyIGlzIGV2ZW4gb24gb3Igb3ZlciB0aGUgY2FudmFzLgogKiAtIGB4YCAobnVtYmVyKSBUaGUgcG9pbnRlcidzIHggb2Zmc2V0IGluIHBpeGVscyB3aXRoIHJlc3BlY3QgdG8gdGhlIGNhbnZhcwogKiAtIGB5YCAobnVtYmVyKSBUaGUgcG9pbnRlcidzIHkgb2Zmc2V0IGluIHBpeGVscyB3aXRoIHJlc3BlY3QgdG8gdGhlIGNhbnZhcwogKiAtIGBkb3duYCAoYm9vbGVhbikgV2hldGhlciB0aGUgcG9pbnRlciBpcyAiZW5nYWdlZCIgb3Igbm90CiAqIC0gYGRyYWdgIChib29sZWFuKSBXaGV0aGVyIGEgY2xpY2svdG91Y2gtZHJhZyBpcyBpbiBwcm9ncmVzcwogKiAtIGBtYXJrYCAoe3gseX0pIFdoZW4gZHJhZ2dpbmcsIHRoaXMgcmVwcmVzZW50cyB0aGUgb3JpZ2luYWwgY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnRlciAiZG93biIgZXZlbnQKICoKICogQGNvbnN0YW50IHtvYmplY3R9CiAqLwpjb25zdCBwb2ludGVyID0geyB4OiAwLCB5OiAwIH07CgovKioKICogSWYgYW55IHBvaW50cyB3ZXJlIHJlZ2lzdGVyZWQgYXMgbW92YWJsZSwgYW5kIHRoZSBwb2ludGVyIGlzCiAqIG5lYXIgZW5vdWdoIHRvIGEgbW92YWJsZSBwb2ludCwgdGhpcyB2YWx1ZSB3aWxsIHBvaW50IHRvCiAqIHRoYXQgbW92YWJsZSBwb2ludCwgb3IgYGZhbHNlYCBpZiB0aGUgcG9pbnRlciBpcyBub3QgbmVhcgogKiBhbnkgbW92YWJsZSBwb2ludCAob3IsIG9mIGNvdXJzZSwgdGhlcmUgYXJlIG5vIG1vdmFibGUgcG9pbnRzKQogKgogKiBAY29uc3RhbnQge1BvaW50TGlrZXxmYWxzZX0KICovCmxldCBjdXJyZW50UG9pbnQgPSBmYWxzZTsKCi8qKgogKiBUaGUgYGtleWJvYXJkYCBvYmplY3QgaXMgYSB0cnV0aCB0YWJsZSB0aGF0IGNhbiBiZSBjaGVja2VkIHRvCiAqIHNlZSBpZiBhbnkga2V5IGlzIGN1cnJlbnRseSBwcmVzc2VkLCBhbmQgaWYgc28sIHdoZW4gdGhhdAogKiBrZXlwcmVzcyB3YXMgaW5pdGlhdGVkLCBieSBzdG9yaW5nOgogKgogKiBgYGAKICogewogKiAgIFtrZXk6c3RyaW5nXTogZGF0ZXRpbWUKICogfQogKiBgYGAKICoKICogV2hlbiBhIGtleSBpcyByZWxlYXNlZCwgaXRzIG1hcHBpbmcgaXMgcmVtb3ZlZCBlbnRpcmVseSwKICogcmF0aGVyIHRoYW4gaXQgYmVpbmcgc2V0IHRvIGEgZmFsc2V5IHZhbHVlLgogKgogKiBAY29uc3RhbnQge29iamVjdH0KICovCmNvbnN0IGtleWJvYXJkID0ge307CgovLyBjb25zdGFudHMuLi4KY29uc3QgewogIC8qKgogICAqIFRoZSByYXRpbyBvZiBhIGNpcmNsZSdzIGNpcmN1bWZlcmVuY2UgdG8gaXRzIGRpYW1ldGVyLgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1BpCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKgogICAqIEBzZWUge0BsaW5rIFRBVX0KICAgKi8KICBQSSwKCiAgLyoqCiAgICogVGhlIGJhc2UgZm9yIHRoZSBuYXR1cmFsIGxvZ2FyaXRobS4KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FXyhtYXRoZW1hdGljYWxfY29uc3RhbnQpCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKi8KICBFLAp9ID0gTWF0aDsKCmNvbnN0IHsKICAvKioKICAgKiBBIHZlcnkgc21hbGwgdmFsdWUgZm9yIHBlcmZvcm1pbmcgaW1wcmVjaXNlIG1hdGggb3BlcmF0aW9ucwogICAqIHN1Y2ggYXMgY2hlY2tpbmcgd2hldGhlciBhIHZhbHVlIGlzIGFwcHJveGltYXRlbHkgdGhlIHNhbWUKICAgKiBhcyBzb21lIG90aGVyIHZhbHVlLgogICAqCiAgICogQGNvbnN0YW50IHtudW1iZXJ9CiAgICovCiAgZXBzaWxvbiwKCiAgLyoqCiAgICogQSB2ZXJ5IGxhcmdlIHZhbHVlIHRoYXQgY2FuIHN0aWxsIGJlIHVzZWQgdG8gZHJhdyB0aGluZ3MKICAgKiBvbiB0aGUgY2FudmFzIChzdWNoIGFzIGxpbmVzIGZyb20gLWh1Z2UgdG8gK2h1Z2UpLgogICAqCiAgICogQGNvbnN0YW50IHtudW1iZXJ9CiAgICovCiAgaHVnZSwKCiAgLyoqCiAgICogVGhlIHJhdGlvIG9mIGEgY2lyY2xlJ3MgY2lyY3VtZmVyZW5jZSB0byBpdHMgcmFkaXVzLgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1R1cm5fKGFuZ2xlKSNUYXVfcHJvcG9zYWxzCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKgogICAqIEBzZWUge0BsaW5rIFBJfQogICAqLwogIFRBVSwKfSA9IHsgZXBzaWxvbjogMWUtMTAsIGh1Z2U6IDFfMDAwXzAwMCwgVEFVOiBQSSAqIDIgfTsKZnVuY3Rpb24gZ3JpZCgpIHsKICBzYXZlKCk7CiAgc2V0TGluZVdpZHRoKDAuNSk7CiAgbm9GaWxsKCk7CiAgc2V0U3Ryb2tlKF9fZ3JpZF9jb2xvcik7CiAgZm9yICgKICAgIGxldCB4ID0gKC0wLjUgKyBfX2dyaWRfc3BhY2luZyAvIDIpIHwgMDsKICAgIHggPCB3aWR0aDsKICAgIHggKz0gX19ncmlkX3NwYWNpbmcKICApIHsKICAgIGxpbmUoeCwgMCwgeCwgaGVpZ2h0KTsKICB9CiAgZm9yICgKICAgIGxldCB5ID0gKC0wLjUgKyBfX2dyaWRfc3BhY2luZyAvIDIpIHwgMDsKICAgIHkgPCBoZWlnaHQ7CiAgICB5ICs9IF9fZ3JpZF9zcGFjaW5nCiAgKSB7CiAgICBsaW5lKDAsIHksIHdpZHRoLCB5KTsKICB9CiAgcmVzdG9yZSgpOwp9CmZ1bmN0aW9uIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCkgewogIC8vIFdlIGRvbid0IHdhbnQgdG8gaW50ZXJmZXJlIHdpdGggdGhlIGJyb3dzZXIsIHNvIHdlJ3JlIG9ubHkKICAvLyBnb2luZyB0byBhbGxvdyB1bm1vZGlmaWVkIGtleXMsIG9yIHNoaWZ0LW1vZGlmaWVkIGtleXMsCiAgLy8gYW5kIHRhYiBoYXMgdG8gYWx3YXlzIHdvcmsuIEZvciBvYnZpb3VzIHJlYXNvbnMuCiAgY29uc3QgdGFiID0gZXZ0LmtleSAhPT0gIlRhYiI7CiAgY29uc3QgZnVuY3Rpb25LZXkgPSBldnQua2V5Lm1hdGNoKC9GXGQrLykgPT09IG51bGw7CiAgY29uc3Qgc3BlY2lmaWNDaGVjayA9IHRhYiAmJiBmdW5jdGlvbktleTsKICBpZiAoIWV2dC5hbHRLZXkgJiYgIWV2dC5jdHJsS2V5ICYmICFldnQubWV0YUtleSAmJiBzcGVjaWZpY0NoZWNrKSB7CiAgICBpZiAoZXZ0LnRhcmdldCA9PT0gX19jYW52YXMpIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIF9fa2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpIHsKICBrZXlib2FyZFtrZXldID0gRGF0ZS5ub3coKTsKICBpZiAodHlwZW9mIGtleURvd24gIT09IGB1bmRlZmluZWRgKQogICAga2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9CgpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBrZXlkb3duYCwgKGV2dCkgPT4gewogIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCk7CiAgY29uc3QgeyBrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkgfSA9IGV2dDsKICBpZiAoX19maW5pc2hlZF9zZXR1cCkgX19rZXlEb3duKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn0pOwoKZnVuY3Rpb24gX19rZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpIHsKICBkZWxldGUga2V5Ym9hcmRba2V5XTsKICBpZiAodHlwZW9mIGtleVVwICE9PSBgdW5kZWZpbmVkYCkKICAgIGtleVVwKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn0KCl9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoYGtleXVwYCwgKGV2dCkgPT4gewogIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCk7CiAgY29uc3QgeyBrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkgfSA9IGV2dDsKICBpZiAoX19maW5pc2hlZF9zZXR1cCkgX19rZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9KTsKZnVuY3Rpb24gX19jaGVja0ZvckN1cnJlbnRQb2ludCh4LCB5LCB0eXBlKSB7CiAgY3VycmVudFBvaW50ID0gZmFsc2U7CgogIGlmICghX19tb3ZhYmxlX3BvaW50cy5sZW5ndGgpIHJldHVybjsKCiAgY29uc3QgbWF0Y2hlcyA9IFtdOwogIGNvbnN0IG1hdGNoUGFkZGluZyA9IHR5cGUuaW5jbHVkZXMoYG1vdXNlYCkgPyAxMCA6IDMwOwoKICBfX21vdmFibGVfcG9pbnRzLmZvckVhY2goKHAsIHBvcykgPT4gewogICAgbGV0IHgyID0gcFswXSA9PT0gdW5kZWZpbmVkID8gcC54IDogcFswXTsKICAgIGxldCB5MiA9IHBbMV0gPT09IHVuZGVmaW5lZCA/IHAueSA6IHBbMV07CiAgICBjb25zdCBkID0gZGlzdCh4LCB5LCB4MiwgeTIpOwogICAgaWYgKGQgPCAocC5yID8gcC5yIDogMCkgKyBtYXRjaFBhZGRpbmcpIHsKICAgICAgbWF0Y2hlcy5wdXNoKHsgcCwgZCB9KTsKICAgIH0KICB9KTsKCiAgX19jYW52YXMuc3R5bGUuY3Vyc29yID0gYGF1dG9gOwoKICBpZiAobWF0Y2hlcy5sZW5ndGgpIHsKICAgIG1hdGNoZXMuc29ydCgoYSwgYikgPT4gYS5kIC0gYi5kKTsKICAgIGN1cnJlbnRQb2ludCA9IG1hdGNoZXNbMF0ucDsKICAgIF9fY2FudmFzLnN0eWxlLmN1cnNvciA9IGBwb2ludGVyYDsKICB9Cn0KCmZ1bmN0aW9uIF9fdG9Qb2ludGVyRXZlbnQoZXZ0KSB7CiAgbGV0IHBvaW50ZXIgPSBldnQ7CiAgLy8gQ29udmVydCBtb3VzZSBvciB0b3VjaCBpbnRvIGdlbmVyaWMgcG9pbnRlci4gV2hpY2ggd2UgbmVlZAogIC8vIHRvIGRvIGJlY2F1c2UgQ2hyb21lIG9uIE1hY09TIGhhcyBkZWNpZGVkIHRvIG5vdCBnZW5lcmF0ZQogIC8vIHBvaW50ZXIgZXZlbnRzIHdoZW4gdGhlcmUncyBhIG1vdXNlLiBUaGFua3MgR29vZ2xlIQogIGlmIChldnQudHlwZS5pbmNsdWRlcyhgdG91Y2hgKSkgewogICAgY29uc3QgeyB0b3VjaGVzLCBjaGFuZ2VkVG91Y2hlcyB9ID0gZXZ0Lm9yaWdpbmFsRXZlbnQgPz8gZXZ0OwogICAgcG9pbnRlciA9IHRvdWNoZXNbMF0gPz8gY2hhbmdlZFRvdWNoZXNbMF07CiAgfQogIGNvbnN0IHsgY2xpZW50WCwgY2xpZW50WSB9ID0gcG9pbnRlcjsKICBjb25zdCB7IGxlZnQsIHRvcCB9ID0gX19jYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgcmV0dXJuIHsgb2Zmc2V0WDogY2xpZW50WCAtIGxlZnQsIG9mZnNldFk6IGNsaWVudFkgLSB0b3AgfTsKfQoKZnVuY3Rpb24gX19wb2ludGVyRG93bih4LCB5KSB7CiAgaWYgKGN1cnJlbnRQb2ludCkgewogICAgY3VycmVudFBvaW50Ll9keCA9IGN1cnJlbnRQb2ludC54IC0geDsKICAgIGN1cnJlbnRQb2ludC5fZHkgPSBjdXJyZW50UG9pbnQueSAtIHk7CiAgfQogIGlmICh0eXBlb2YgcG9pbnRlckRvd24gIT09IGB1bmRlZmluZWRgKSBwb2ludGVyRG93bih4LCB5KTsKfQoKW2B0b3VjaHN0YXJ0YCwgYG1vdXNlZG93bmBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChldnQpID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGNvbnN0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gX190b1BvaW50ZXJFdmVudChldnQpOwogICAgICBjb25zdCB7IHgsIHkgfSA9IHNjcmVlblRvV29ybGQob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwgeyB4LCB5LCB0eXBlLCBkb3duOiB0cnVlLCBtYXJrOiB7IHgsIHkgfSB9KTsKICAgICAgX19jaGVja0ZvckN1cnJlbnRQb2ludCh4LCB5LCB0eXBlKTsKICAgICAgX19wb2ludGVyRG93bih4LCB5KTsKICAgIH0KICB9KTsKfSk7CgpmdW5jdGlvbiBfX3BvaW50ZXJVcCh4LCB5KSB7CiAgaWYgKHR5cGVvZiBwb2ludGVyVXAgIT09IGB1bmRlZmluZWRgKSBwb2ludGVyVXAoeCwgeSk7CiAgaWYgKHBvaW50ZXIubWFyaz8ueCA9PT0geCAmJiBwb2ludGVyLm1hcms/LnkgPT09IHkpIHsKICAgIGlmICh0eXBlb2YgcG9pbnRlckNsaWNrICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlckNsaWNrKHgsIHkpOwogIH0KfQoKW2B0b3VjaGVuZGAsIGBtb3VzZXVwYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2dCkgPT4gewogICAgaWYgKF9fZmluaXNoZWRfc2V0dXApIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgY29uc3QgeyBvZmZzZXRYLCBvZmZzZXRZIH0gPSBfX3RvUG9pbnRlckV2ZW50KGV2dCk7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUsIGRvd246IGZhbHNlLCBtYXJrOiBmYWxzZSB9KTsKICAgICAgX19wb2ludGVyVXAoeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyTW92ZSh4LCB5KSB7CiAgbGV0IHBvaW50TW92ZWQgPSBmYWxzZTsKICBpZiAocG9pbnRlci5kb3duICYmIGN1cnJlbnRQb2ludCkgewogICAgaWYgKGN1cnJlbnRQb2ludFswXSkgewogICAgICBjdXJyZW50UG9pbnRbMF0gPSB4ICsgY3VycmVudFBvaW50Ll9keDsKICAgICAgY3VycmVudFBvaW50WzFdID0geSArIGN1cnJlbnRQb2ludC5fZHk7CiAgICB9IGVsc2UgewogICAgICBjdXJyZW50UG9pbnQueCA9IHggKyBjdXJyZW50UG9pbnQuX2R4OwogICAgICBjdXJyZW50UG9pbnQueSA9IHkgKyBjdXJyZW50UG9pbnQuX2R5OwogICAgfQogICAgcG9pbnRNb3ZlZCA9IHRydWU7CiAgfQoKICBpZiAodHlwZW9mIHBvaW50ZXJNb3ZlICE9PSBgdW5kZWZpbmVkYCkgewogICAgcG9pbnRlck1vdmUoeCwgeSk7CiAgICBwb2ludGVyLmRyYWcgPSBmYWxzZTsKICAgIGlmIChwb2ludGVyLmRvd24gJiYgdHlwZW9mIHBvaW50ZXJEcmFnICE9PSBgdW5kZWZpbmVkYCkgewogICAgICBwb2ludGVyLmRyYWcgPSB0cnVlOwogICAgICBwb2ludGVyRHJhZyh4LCB5KTsKICAgIH0KICB9CiAgaWYgKHBvaW50TW92ZWQgJiYgIXBsYXlpbmcpIHJlZHJhdygpOwp9CgpbYHRvdWNobW92ZWAsIGBtb3VzZW1vdmVgXS5mb3JFYWNoKCh0eXBlKSA9PiB7CiAgX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCAoZXZ0KSA9PiB7CiAgICBpZiAoX19maW5pc2hlZF9zZXR1cCkgewogICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICBjb25zdCB7IG9mZnNldFgsIG9mZnNldFkgfSA9IF9fdG9Qb2ludGVyRXZlbnQoZXZ0KTsKICAgICAgY29uc3QgeyB4LCB5IH0gPSBzY3JlZW5Ub1dvcmxkKG9mZnNldFgsIG9mZnNldFkpOwogICAgICBPYmplY3QuYXNzaWduKHBvaW50ZXIsIHsgeCwgeSwgdHlwZSB9KTsKICAgICAgaWYgKCFwb2ludGVyLmRvd24pIF9fY2hlY2tGb3JDdXJyZW50UG9pbnQoeCwgeSwgdHlwZSk7CiAgICAgIF9fcG9pbnRlck1vdmUoeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyQWN0aXZlKGFjdGl2ZSkgewogIGlmICh0eXBlb2YgcG9pbnRlckFjdGl2ZSAhPT0gYHVuZGVmaW5lZGApIHsKICAgIHBvaW50ZXJBY3RpdmUoYWN0aXZlKTsKICB9Cn0KCltgdG91Y2hzdGFydGAsIGBtb3VzZWVudGVyYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKCkgPT4gewogICAgcG9pbnRlci5hY3RpdmUgPSB0cnVlOwogICAgX19wb2ludGVyQWN0aXZlKHRydWUpOwogIH0pOwp9KTsKCltgdG91Y2hlbmRgLCBgbW91c2VsZWF2ZWBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsICgpID0+IHsKICAgIHBvaW50ZXIuYWN0aXZlID0gZmFsc2U7CiAgICBfX3BvaW50ZXJBY3RpdmUoZmFsc2UpOwogIH0pOwp9KTsKLyoqCiAqIGNvZGUgdXNlZCBieSBwcm9qZWN0LmpzLCBidXQgbmFtZWQgc28gdGhhdCBpdCBsb2FkcwogKiBmaXJzdCwgYW5kIGRvZXMgbm90IGdldCBhZGRlZCB0byB0aGUgZC50cyBmaWxlLgogKi8KY2xhc3MgQ2FiaW5ldFByb2plY3RvciB7CiAgQSA9IDA7CiAgQiA9IDA7CiAgQyA9IDA7CgogIGNvbnN0cnVjdG9yKG94LCBveSwgc2NhbGUsIHBoaSkgewogICAgdGhpcy51cGRhdGUob3gsIG95LCBzY2FsZSwgcGhpKTsKICB9CgogIHNldFJvdGF0aW9uKHggPSAwLCB5ID0gMCwgeiA9IDApIHsKICAgIHRoaXMuQSA9IHg7CiAgICB0aGlzLkIgPSB6OwogICAgdGhpcy5DID0geTsKICB9CgogIHJvdGF0ZSh4LCB5LCB6KSB7CiAgICBsZXQgeyBBLCBCLCBDIH0gPSB0aGlzOwogICAgbGV0IGEgPSB4OwogICAgbGV0IGIgPSB5ICogY29zKEEpIC0geiAqIHNpbihBKTsKICAgIGxldCBjID0geSAqIHNpbihBKSArIHogKiBjb3MoQSk7CiAgICB4ID0gYTsKICAgIHkgPSBiOwogICAgeiA9IGM7CiAgICBhID0geCAqIGNvcyhCKSArIHogKiBzaW4oQik7CiAgICBiID0geTsKICAgIGMgPSB4ICogLXNpbihCKSArIHogKiBjb3MoQik7CiAgICB4ID0gYTsKICAgIHkgPSBiOwogICAgeiA9IGM7CiAgICBhID0geCAqIGNvcyhDKSAtIHkgKiBzaW4oQyk7CiAgICBiID0geCAqIHNpbihDKSArIHkgKiBjb3MoQyk7CiAgICBjID0gejsKCiAgICByZXR1cm4gW2EsIGIsIGNdOwogIH0KCiAgdXBkYXRlKG94ID0gMCwgb3kgPSAwLCBzY2FsZSA9IDEsIHBoaSA9IC1QSSAvIDYpIHsKICAgIHRoaXMub2Zmc2V0ID0gbmV3IFBvaW50KG94LCBveSk7CiAgICB0aGlzLnNjYWxlID0gc2NhbGU7CiAgICB0aGlzLnBoaSA9IHBoaTsKICB9CgogIHByb2plY3QoeCwgeSwgeikgewogICAgY29uc3QgeyBvZmZzZXQsIHNjYWxlLCBwaGkgfSA9IHRoaXM7CiAgICB4ICo9IHNjYWxlOwogICAgeSAqPSBzY2FsZTsKICAgIHogKj0gc2NhbGU7CiAgICBbeCwgeSwgel0gPSB0aGlzLnJvdGF0ZSh4LCB5LCB6KTsKICAgIGNvbnN0IGEgPSB5LAogICAgICBiID0gLXosCiAgICAgIGMgPSAteCAvIDI7CgogICAgcmV0dXJuIG5ldyBQb2ludCgKICAgICAgb2Zmc2V0LnggKyBhICsgYyAqIGNvcyhwaGkpLAogICAgICBvZmZzZXQueSArIGIgKyBjICogc2luKHBoaSkKICAgICk7CiAgfQp9CgpsZXQgX19wcm9qZWN0b3IgPSBuZXcgQ2FiaW5ldFByb2plY3RvcigpOwovKioKICogRW5zdXJlIHRoYXQgdGhlcmUgaXMgbm8gYm9yZGVyIGFyb3VuZCB0aGUgY2FudmFzIGVsZW1lbnQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEJvcmRlcig1LCBgcmVkYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgdGV4dChgY2xpY2sgbWVgLCB3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyVXAoeCwgeSkgewogKiAgICAgICBzZXRCb3JkZXIoNSwgYHJlZGApOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCwgeSkgewogKiAgICAgICBub0JvcmRlcigpOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldEJvcmRlcn0KICovCmZ1bmN0aW9uIG5vQm9yZGVyKCkgewogIHNldEJvcmRlcihmYWxzZSk7Cn0KCi8qKgogKiBEaXNhYmxlIGJvdGggc3Ryb2tlIGFuZCBmaWxsIGNvbG9yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoYE5vdyB5b3Ugc2VlIG1lYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vQ29sb3IoKTsKICogICAgICAgdGV4dChgTm93IHlvdSBkb24ndGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldENvbG9yfQogKiBAc2VlIHtAbGluayBub1N0cm9rZX0KICogQHNlZSB7QGxpbmsgbm9GaWxsfQogKi8KZnVuY3Rpb24gbm9Db2xvcigpIHsKICBub0ZpbGwoKTsKICBub1N0cm9rZSgpOwp9CgovKioKICogSGlkZSB0aGUgY3Vyc29yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGAjRkYwMmApOwogKiAgICAgICByZWN0KDAsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIHNldENvbG9yKGAjMEZGMmApOwogKiAgICAgICByZWN0KHdpZHRoLzIsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSh4LCB5KSB7CiAqICAgICAgIGlmICh4IDwgd2lkdGgvMikgewogKiAgICAgICAgIHNldEN1cnNvcihBVVRPKTsKICogICAgICAgfSBlbHNlIHsKICogICAgICAgICBub0N1cnNvcigpOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2V0Q3Vyc29yfQogKi8KZnVuY3Rpb24gbm9DdXJzb3IoKSB7CiAgX19jYW52YXMuc3R5bGUuY3Vyc29yID0gYG5vbmVgOwp9CgovKioKICogRGlzYWJsZSB0aGUgZmlsbCBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICByZWN0KDIwLCA3MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgZmlsbGVkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICByZWN0KDMwLCA4MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgbm90IGZpbGxlZGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldEZpbGx9CiAqLwpmdW5jdGlvbiBub0ZpbGwoKSB7CiAgc2V0RmlsbChgdHJhbnNwYXJlbnRgKTsKfQoKLyoqCiAqIERpc2FibGUgdGhlIGRlZmF1bHQgZ3JpZCBiYWNrZ3JvdW5kLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoYGNsaWNrIG1lYCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlclVwKHgsIHkpIHsKICogICAgICAgc2V0R3JpZCgyMCwgYGxpZ2h0Z3JleWApOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCwgeSkgewogKiAgICAgICBub0dyaWQoKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRHcmlkfQogKi8KZnVuY3Rpb24gbm9HcmlkKCkgewogIF9fZHJhd19ncmlkID0gZmFsc2U7Cn0KCi8qKgogKiBTZXQgdGhlIGxpbmUgc3Ryb2tlIHRvICJzb2xpZCIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldExpbmVEYXNoKDEpOwogKiAgICAgICBsaW5lKDAsMjAsd2lkdGgsNTApOwogKiAgICAgICBzZXRMaW5lRGFzaCg1KTsKICogICAgICAgbGluZSgwLDMwLHdpZHRoLDkwKTsKICogICAgICAgc2V0TGluZURhc2goMSwyLDMsNCk7CiAqICAgICAgIGxpbmUoMCw0MCx3aWR0aCwxMzApOwogKiAgICAgICBub0xpbmVEYXNoKCk7CiAqICAgICAgIGxpbmUoMCw1MCx3aWR0aCwxODApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldExpbmVEYXNofQogKi8KCmZ1bmN0aW9uIG5vTGluZURhc2goKSB7CiAgX19jdHguc2V0TGluZURhc2goW10pOwp9CgovKioKICogRGlzYWJsZSB0aGUgc3Ryb2tlIGNvbG9yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dFN0cm9rZSgxKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHJlY3QoMjAsIDcwLCAyMCwgMjApOwogKiAgICAgICB0ZXh0KGBzdHJva2VkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vU3Ryb2tlKCk7CiAqICAgICAgIHJlY3QoNDIsIDgyLCAyMCwgMjApOwogKiAgICAgICB0ZXh0KGBub3Qgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldFN0cm9rZX0KICovCgpmdW5jdGlvbiBub1N0cm9rZSgpIHsKICBzZXRTdHJva2UoYHRyYW5zcGFyZW50YCk7Cn0KCi8qKgogKiBEaXNhYmxlIHRleHQgc3Ryb2tpbmcsIGJ1dCBub3QgcmVndWxhciBzaGFwZSBzdHJva2luZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICByZWN0KDIwLCA3MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub1RleHRTdHJva2UoKTsKICogICAgICAgcmVjdCg0MiwgODIsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYG5vdCBzdHJva2VkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgKyAyNSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2V0VGV4dFN0cm9rZX0KICovCgpmdW5jdGlvbiBub1RleHRTdHJva2UoKSB7CiAgc2V0VGV4dFN0cm9rZShmYWxzZSwgdW5kZWZpbmVkKTsKfQovKioKICogQWRkIGEgc2xpZGVyIHRvIHlvdXIgZmlndXJlLCBhbGxvd2luZyB1c2VycyB0byBjb250cm9sCiAqIGEgdmFyaWFibGUgaW4geW91ciBncmFwaGljcyBjb2RlIGRpcmVjdGx5IGJ5IGludGVyYWN0aW5nCiAqIHdpdGggdGhhdCBvbi1wYWdlIHNsaWRlciwgd2hpY2ggaXMgZXNwZWNpYWxseSBpbXBvcnRhbnQgaWYKICogeW91IHdhbnQgeW91ciBncmFwaGljcyB0byBiZSB1c2VhYmxlIGJ5IHVzZXJzIHdobyBkb24ndAogKiBoYXZlLCBvciBjYW5ub3QgdXNlLCBhIG1vdXNlLgogKgogKiBUaGUgYHByb3BMYWJlbGAgdmFsdWUgc2hvdWxkIGJlIHRoZSBuYW1lIG9mIHRoZSB2YXJpYWJsZQogKiB0aGF0IHlvdXIgZ3JhcGhpY3MgY29kZSB1c2VzLCBhbmQgc2hvdWxkIF9ub3RfIGJlICJwcmVhbGxvY2F0ZWQiCiAqIGluIHlvdXIgY29kZSB3aXRoIGEgY29uc3QsIGxldCwgb3IgdmFyOiBpdCB3aWxsIGF1dG9tYXRpY2FsbHkKICogZ2V0IGFkZGVkIGFzIHBhcnQgb2YgdGhlIHNvdXJjZSBsb2FkaW5nIHByb2Nlc3MuCiAqCiAqIFRoZSBvcHRpb25zIG9iamVjdCBhY2NlcHRzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllcyBhbmQgdmFsdWVzOgogKgogKiAtIG1pbjpudW1iZXIgLSB0aGUgc2xpZGVyJ3MgbWluaW11bSB2YWx1ZSwgZGVmYXVsdHMgdG8gMAogKiAtIG1heDpudW1iZXIgLSB0aGUgc2xpZGVyJ3MgbWF4aW11bSB2YWx1ZSwgZGVmYXVsdHMgdG8gMQogKiAtIHN0ZXAgLSB0aGUgc3RlcCBzaXplLCBkZWZhdWx0cyB0byAobWF4IC0gbWluKS8xMAogKiAtIHZhbHVlIC0gdGhlIGluaXRpYWwgdmFsdWUsIGRlZmF1bHRzIHRvIChtYXggKyBtaW4pLzIKICogLSBjbGFzc2VzIC0gdGhlIENTUyBjbGFzc2VzIHRoYXQgd2lsbCBiZSB1c2VkLCBkZWZhdWx0cyB0byBgInNsaWRlciJgCiAqIC0gdHJhbnNmb3JtIC0gYSB2YWx1ZSBwcmVwcm9jZXNzb3IgIGRlZmF1bHRzIHRvICh2KSA9PiB2CiAqCiAqIFRoZSBgdHJhbnNmb3JtYCBwcmUtcHJvY2Vzc29yIHJ1bnMgYWZ0ZXIgdGhlIHVzZXIgdXBkYXRlcwogKiB0aGUgc2xpZGVyLCBidXQgYmVmb3JlIGl0cyB2YWx1ZSBnZXRzIGFzc2lnbmVkIHRvIHlvdXIgdmFyaWFibGUsCiAqIHNvIHRoYXQgeW91IGNhbiBtYXAgaXQgdG8gc29tZXRoaW5nIGVsc2UgKGZvciBpbnN0YW5jZSwgbnVtYmVycwogKiBpbiBvbmUgcmFuZ2UgdG8gbnVtYmVycyBpbiBhIGNvbXBsZXRlbHkgZGlmZmVyZW50IHJhbmdlLCBvciBldmVuCiAqIG51bWJlcnMgdG8gc3RyaW5ncyBvciBlbnRpcmUgb2JqZWN0cykKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDQwMCwgMjAwKTsKICogICAgICAgYWRkU2xpZGVyKGBiZ0NvbG9yYCwgewogKiAgICAgICAgIG1pbjogMCwKICogICAgICAgICBtYXg6IDI1NSwKICogICAgICAgICBzdGVwOiAxLAogKiAgICAgICAgIHZhbHVlOiAyMDAsCiAqICAgICAgICAgdHJhbnNmb3JtOiAodikgPT4gewogKiAgICAgICAgICAgLy8gY29udmVydCB2IGludG8gYSBoZXggY29sb3IgY29kZQogKiAgICAgICAgICAgdiA9ICh2KS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgYDBgKTsKICogICAgICAgICAgIHJldHVybiBgIyR7dn0ke3Z9JHt2fWA7CiAqICAgICAgICAgfQogKiAgICAgICB9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGJnQ29sb3IpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YXJOYW1lIFRoZSBuYW1lIGZvciB0aGUgdmFyaWFibGUgdGhpcyBzbGlkZXIgZ2V0cyB0aWVkIHRvLgogKiBAcGFyYW0ge29iamVjdH0gb3B0aW9ucyBTZWUgZGVzY3JpcHRpb24KICogQHJldHVybnMge0hUTUxJbnB1dEVsZW1lbnR9IHRoZSBIVE1MIGlucHV0IGVsZW1lbnQgZm9yIHRoaXMgc2xpZGVyCiAqCiAqIEBzZWUge0BsaW5rIGNsZWFyU2xpZGVyc30KICovCmZ1bmN0aW9uIGFkZFNsaWRlcihwcm9wTGFiZWwsIGFzc2lnbiwgb3B0aW9ucyA9IHt9KSB7CiAgbGV0IHsKICAgIG1pbiwKICAgIG1heCwKICAgIHN0ZXAsCiAgICB2YWx1ZSwKICAgIGNsYXNzZXMgPSBgc2xpZGVyYCwKICAgIHRyYW5zZm9ybSA9ICh2KSA9PiB2LAogIH0gPSBvcHRpb25zOwoKICBtaW4gPSBtaW4gPT09IHVuZGVmaW5lZCA/IDAgOiBtaW47CiAgbWF4ID0gbWF4ID09PSB1bmRlZmluZWQgPyAxIDogbWF4OwogIHN0ZXAgPSBzdGVwID09PSB1bmRlZmluZWQgPyAobWF4IC0gbWluKSAvIDEwIDogc3RlcDsKICB2YWx1ZSA9IHZhbHVlID09PSB1bmRlZmluZWQgPyAobWF4ICsgbWluKSAvIDIgOiB2YWx1ZTsKCiAgLy8gY3VzdG9tICJyb3VuZGluZyIsIHB1cmVseSBmb3Igc3RyaW5ncwogIGNvbnN0IHJvdW5kID0gKHYsIGQgPSA0KSA9PiB7CiAgICB2ID0gYCR7dn1gOwogICAgY29uc3QgZnMgPSB2LmluZGV4T2YoYC5gKTsKICAgIGlmIChmcyAhPT0gLTEpIHsKICAgICAgbGV0IHByZWMgPSBkIC0gZnMgPiAwID8gZCAtIGZzIDogMDsKICAgICAgdiA9IHYuc3Vic3RyaW5nKDAsIGZzICsgcHJlYyk7CiAgICB9CiAgICByZXR1cm4gdjsKICB9OwoKICBjb25zdCBjcmVhdGUgPSAodGFnKSA9PiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7CgogIGxldCBzbGlkZXIgPSBjcmVhdGUoYGlucHV0YCk7CiAgc2xpZGVyLnR5cGUgPSBgcmFuZ2VgOwogIHNsaWRlci5taW4gPSBtaW47CiAgc2xpZGVyLm1heCA9IG1heDsKICBzbGlkZXIuc3RlcCA9IHN0ZXA7CiAgc2xpZGVyLnNldEF0dHJpYnV0ZShgdmFsdWVgLCB2YWx1ZSk7CiAgc2xpZGVyLnNldEF0dHJpYnV0ZShgY2xhc3NgLCBjbGFzc2VzKTsKCiAgY29uc3QgdXBkYXRlID0gKHsgdmFsdWUgfSkgPT4gewogICAgdmFsdWVGaWVsZC50ZXh0Q29udGVudCA9IHJvdW5kKHZhbHVlKTsKICAgIGFzc2lnbih0cmFuc2Zvcm0ocGFyc2VGbG9hdCh2YWx1ZSkpKTsKICAgIGlmICghcGxheWluZykgcmVkcmF3KCk7CiAgfTsKCiAgc2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoYGlucHV0YCwgKHsgdGFyZ2V0IH0pID0+IHVwZGF0ZSh0YXJnZXQpKTsKCiAgbGV0IHRhYmxlID0gX19lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYHRhYmxlLnNsaWRlci13cmFwcGVyYCk7CiAgaWYgKCF0YWJsZSkgewogICAgdGFibGUgPSBjcmVhdGUoYHRhYmxlYCk7CiAgICB0YWJsZS5jbGFzc0xpc3QuYWRkKGBzbGlkZXItd3JhcHBlcmApOwogICAgX19lbGVtZW50LnByZXBlbmQodGFibGUpOwogIH0KICBsZXQgdHIgPSBjcmVhdGUoYHRyYCk7CgogIGxldCB0ZCA9IGNyZWF0ZShgdGRgKTsKICBsZXQgbGFiZWwgPSBjcmVhdGUoYGxhYmVsYCk7CiAgbGFiZWwuY2xhc3NMaXN0LmFkZChgc2xpZGVyLWxhYmVsYCk7CiAgbGFiZWwuaW5uZXJIVE1MID0gcHJvcExhYmVsCiAgICAucmVwbGFjZSgvXyguKykkLywgYDxzdWI+JDE8L3N1Yj5gKQogICAgLnJlcGxhY2UoLyhcZCspLywgYDxzdWI+JDE8L3N1Yj5gKTsKICB0ZC5hcHBlbmQobGFiZWwpOwogIHRyLmFwcGVuZCh0ZCk7CgogIHRkID0gY3JlYXRlKGB0ZGApOwogIHRkLmNsYXNzTGlzdC5hZGQoYHNsaWRlci1taW5gKTsKICB0ZC50ZXh0Q29udGVudCA9IHJvdW5kKHNsaWRlci5taW4pOwogIHRyLmFwcGVuZCh0ZCk7CgogIHRkID0gY3JlYXRlKGB0ZGApOwogIHRkLndpZHRoID0gYCpgOwogIHRkLmFwcGVuZChzbGlkZXIpOwogIHRyLmFwcGVuZCh0ZCk7CgogIHRkID0gY3JlYXRlKGB0ZGApOwogIHRkLmNsYXNzTGlzdC5hZGQoYHNsaWRlci1tYXhgKTsKICB0ZC50ZXh0Q29udGVudCA9IHJvdW5kKHNsaWRlci5tYXgpOwogIHRyLmFwcGVuZCh0ZCk7CgogIHRkID0gY3JlYXRlKGB0ZGApOwogIHZhciB2YWx1ZUZpZWxkID0gY3JlYXRlKGBsYWJlbGApOyAvLyBmdW5jdGlvbiBzY29wZWQKICB2YWx1ZUZpZWxkLmNsYXNzTGlzdC5hZGQoYHNsaWRlci12YWx1ZWApOwogIHRkLmFwcGVuZCh2YWx1ZUZpZWxkKTsKICB0ci5hcHBlbmQodGQpOwogIHRkLmFkZEV2ZW50TGlzdGVuZXIoYHBvaW50ZXJkb3duYCwgKCkgPT4gewogICAgY29uc3QgdmFsdWUgPSBwcm9tcHQoYG5ldyB2YWx1ZT9gLCBzbGlkZXIudmFsdWUpOwogICAgaWYgKHZhbHVlICE9PSBudWxsKSB7CiAgICAgIHNsaWRlci52YWx1ZSA9IHZhbHVlOwogICAgICB1cGRhdGUoeyB2YWx1ZSB9KTsKICAgIH0KICB9KTsKCiAgdGFibGUuYXBwZW5kKHRyKTsKCiAgdXBkYXRlKHNsaWRlcik7CiAgcmV0dXJuIHNsaWRlcjsKfQoKLyoqCiAqIFJlbW92ZSBhbGwgc2xpZGVycyBmb3IgeW91ciBmaWd1cmUgZnJvbSB0aGUgcGFnZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkU2xpZGVyKGB4YCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dChgY2xpY2sgdG8gY2xlYXJgLCB3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bigpIHsKICogICAgICAgY2xlYXJTbGlkZXJzKCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgYWRkU2xpZGVyfQogKi8KCmZ1bmN0aW9uIGNsZWFyU2xpZGVycygpIHsKICBjb25zdCB0YWJsZSA9IF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKGB0YWJsZS5zbGlkZXItd3JhcHBlcmApOwogIGlmICh0YWJsZSkgdGFibGUuaW5uZXJIVE1MID0gYGA7Cn0KCi8qKgogKiBBZGQgYSBidXR0b24gYmVsb3cgeW91ciBmaWd1cmUgdGhhdCBjYW4gdHJpZ2dlciBldmVudC1iYXNlZAogKiBjb2RlLCB3aGljaCBpcyBlc3BlY2lhbGx5IGltcG9ydGFudCBpZiB5b3Ugd2FudCB5b3VyIGdyYXBoaWNzCiAqIHRvIGJlIHVzZWFibGUgYnkgdXNlcnMgd2hvIGRvbid0IGhhdmUsIG9yIGNhbm5vdCB1c2UsIGEgbW91c2UuCiAqCiAqIG9uQ2xpY2sgaXMgc2ltaWxhciB0byB0aGUgc3RhbmRhcmQgSlMgZXZlbnQgaGFuZGxlciwgZXhjZXB0CiAqIHRoYXQgdGhlIGNhbGwgYXJndW1lbnQgaXMgYSByZWZlcmVuY2UgdG8geW91ciBidXR0b24sIG5vdAogKiB0aGUgY2xpY2sgZXZlbnQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBjb2xvcnMgPSBbYHdoaXRlYCwgYGJsYWNrYF07CiAqICAgICBsZXQgYmdDb2xvciA9IDA7CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGFkZEJ1dHRvbihgZmxpcCBiYWNrZ3JvdW5kYCwgKGJ1dHRvbikgPT4gewogKiAgICAgICAgIGJnQ29sb3IgPSAtKGJnQ29sb3IgLSAxKTsKICogICAgICAgICByZWRyYXcoKTsKICogICAgICAgfSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihjb2xvcnNbYmdDb2xvcl0pOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBsYWJlbCBUaGUgdGV4dCBsYWJlbCBmb3IgeW91ciBidXR0b24KICogQHBhcmFtIHtmdW5jdGlvbn0gb25DbGljayBUaGUgY2xpY2sgaGFuZGxpbmcgZnVuY3Rpb24sIHNlZSBkZXNjcmlwdGlvbi4KICogQHJldHVybnMge0hUTUxCdXR0b25FbGVtZW50fSBUaGUgYnV0dG9uIGVsZW1lbnQgdGhpcyBhZGRlZCB0byB0aGUgcGFnZQogKgogKiBAc2VlIHtAbGluayBjbGVhckJ1dHRvbnN9CiAqLwpmdW5jdGlvbiBhZGRCdXR0b24obGFiZWwsIG9uQ2xpY2spIHsKICBpZiAoIW9uQ2xpY2spIHRocm93IG5ldyBFcnJvcihgYSBidXR0b24gbXVzdCBoYXZlIGFuIG9uQ2xpY2sgaGFuZGxlcmApOwogIGNvbnN0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGJ1dHRvbmApOwogIGJ0bi5jbGFzc0xpc3QuYWRkKGBncmFwaGljcy1lbGVtZW50LWJ1dHRvbmApOwogIGJ0bi50ZXh0Q29udGVudCA9IGxhYmVsOwogIGJ0bi5hZGRFdmVudExpc3RlbmVyKGBjbGlja2AsICgpID0+IG9uQ2xpY2soYnRuKSk7CiAgX19lbGVtZW50LnByZXBlbmQoYnRuKTsKICByZXR1cm4gYnRuOwp9CgovKioKICogUmVtb3ZlIGFsbCBidXR0b25zIGZvciB5b3VyIGZpZ3VyZSBmcm9tIHRoZSBwYWdlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRCdXR0b24oYHRoaXMgZG9lcyBub3RoaW5nYCwgKCkgPT4ge30pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHRleHQoYGNsaWNrIHRvIGNsZWFyYCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oKSB7CiAqICAgICAgIGNsZWFyQnV0dG9ucygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIGFkZEJ1dHRvbn0KICovCmZ1bmN0aW9uIGNsZWFyQnV0dG9ucygpIHsKICBfX2VsZW1lbnQKICAgIC5xdWVyeVNlbGVjdG9yQWxsKGBidXR0b24uZ3JhcGhpY3MtZWxlbWVudC1idXR0b25gKQogICAgLmZvckVhY2goKGUpID0+IGUucmVtb3ZlKCkpOwp9Ci8qKgogKiBEcmF3IGEgY2lyY3VsYXIgYXJjIHdpdGggcmFkaXVzIGByYCBhdCAoeCx5KSwKICogc3RhcnRpbmcgYXQgYW5nbGUgYHNgIGFuZCBlbmRpbmcgYXQgYW5nbGUgYGVgLgogKiBJZiBgd2VkZ2VgIGlzIHRydWUsIHRoaXMgd2lsbCBkcmF3IGEgY2xvc2VkCiAqIHNoYXBlIHRoYXQgaXMgYW5jaG9yZWQgYXQgKHgseSkuIElmIG9taXR0ZWQKICogb3IgZXhwbGljaXRseSBzZXQgdG8gZmFsc2UsIHRoaXMgd2lsbCBkcmF3CiAqIGFuIG9wZW4gc2hhcGUgd2l0aCBhIGZpbGwgdGhhdCBjb25uZWN0cyB0aGUKICogZmlyc3QgYW5kIGxhc3QgcG9pbnQgb24gdGhlIGFyYywgYnV0IG5vIGNsb3NpbmcKICogc3Ryb2tlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgI0YwMDJgKTsKICogICAgICAgYXJjKHdpZHRoLzIgKyAzMCwgaGVpZ2h0LzIgLSA0MCwgNDAsIDAsIDAuNjYqVEFVKTsKICogICAgICAgYXJjKHdpZHRoLzIgLSAzMCwgaGVpZ2h0LzIgKyAyMCwgNDAsIDAsIDAuNjYqVEFVLCB0cnVlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgY2lyY3VsYXIgY2VudGVyIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIGNpcmN1bGFyIGNlbnRlciB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGlzIGFyYyBpbiBwaXhlbHMKICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0QW5nbGUgVGhlIHN0YXJ0IGFuZ2xlIGZvciB0aGlzIGFyYyBpbiByYWRpYW5zCiAqIEBwYXJhbSB7bnVtYmVyfSBlbmRBbmdsZSBUaGUgZW5kIGFuZ2xlIGZvciB0aGlzIGFyYyBpbiByYWRpYW5zCiAqIEBwYXJhbSB7Ym9vbGVhbn0gZHJhd1dlZGdlIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdG8gZHJhdyBhIHdlZGdlIG9yIGNhcHBlZCBjaXJjbGUgKGRlZmF1bHQ9Y2lyY2xlKQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcG9pbnQgVGhlIGNpcmN1bGFyIGNlbnRlciB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGlzIGFyYyBpbiBwaXhlbHMKICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0QW5nbGUgVGhlIHN0YXJ0IGFuZ2xlIGZvciB0aGlzIGFyYyBpbiByYWRpYW5zCiAqIEBwYXJhbSB7bnVtYmVyfSBlbmRBbmdsZSBUaGUgZW5kIGFuZ2xlIGZvciB0aGlzIGFyYyBpbiByYWRpYW5zCiAqIEBwYXJhbSB7Ym9vbGVhbn0gZHJhd1dlZGdlIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdG8gZHJhdyBhIHdlZGdlIG9yIGNhcHBlZCBjaXJjbGUgKGRlZmF1bHQ9Y2lyY2xlKQogKgogKiBAc2VlIHtAbGluayBjaXJjbGV9CiAqLwpmdW5jdGlvbiBhcmMoeCwgeSwgciwgcyA9IDAsIGUgPSBUQVUsIHdlZGdlID0gZmFsc2UpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHdlZGdlID0gZTsKICAgIGUgPSBzOwogICAgcyA9IHI7CiAgICByID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBjb25zdCBzdGVwID0gMC4xOwogIHN0YXJ0KCk7CiAgaWYgKHdlZGdlKSB2ZXJ0ZXgoeCwgeSk7CiAgbGV0IGEgPSBzOwogIHZlcnRleCh4ICsgciAqIGNvcyhzKSwgeSArIHIgKiBzaW4ocykpOwogIGZvciAoYSA9IHMgKyBzdGVwOyBhIDwgZTsgYSArPSBzdGVwKSB7CiAgICB2ZXJ0ZXgoeCArIHIgKiBjb3MoYSksIHkgKyByICogc2luKGEpKTsKICB9CiAgdmVydGV4KHggKyByICogY29zKGUpLCB5ICsgciAqIHNpbihlKSk7CiAgaWYgKHdlZGdlKSB2ZXJ0ZXgoeCwgeSk7CiAgZW5kKCk7Cn0KCi8qKgogKiBEcmF3IGEgcGFpciBvZiBob3Jpem9udGFsIGFuZCB2ZXJ0aWNhbCBheGVzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRCb3JkZXIoMSwgYGJsYWNrYCk7CiAqICAgICAgIHNldEdyaWQoNTAsIGBsaWdodGdyZXlgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIHNldEN1cnNvcihgbm9uZWApOwogKiAgICAgICBjbGVhcihgI2ZmZmVmN2ApOwogKiAgICAgICBzZXRDb2xvcihgIzMzM2ApOwogKiAgICAgICB0cmFuc2xhdGUoMjUsMjUpOwogKiAgICAgICBheGVzKAogKiAgICAgICAgIGB0aW1lIChzKWAsIDAsIHdpZHRoLTUwLAogKiAgICAgICAgIGBkaXN0YW5jZSAoa20pYCwgMCwgaGVpZ2h0LTUwLAogKiAgICAgICAgICIwIiwgIjYwIiwKICogICAgICAgICAiMCIsICI1MDAiKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gaExhYmVsIHRoZSBob3Jpem9udGFsIGF4aXMgbGFiZWwKICogQHBhcmFtIHtudW1iZXJ9IGhzIHRoZSBzdGFydCAobGVmdCkgcGl4ZWwgdmFsdWUgZm9yIHRoZSBob3Jpem9udGFsIGF4aXMKICogQHBhcmFtIHtudW1iZXJ9IGhlIHRoZSBlbmQgKHJpZ2h0KSBwaXhlbCB2YWx1ZSBmb3IgdGhlIGhvcml6b250YWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gdkxhYmVsIHRoZSB2ZXJ0aWNhbCBheGlzIGxhYmVsCiAqIEBwYXJhbSB7bnVtYmVyfSB2cyB0aGUgc3RhcnQgKHRvcCkgcGl4ZWwgdmFsdWUgZm9yIHRoZSB2ZXJ0aWNhbCBheGlzCiAqIEBwYXJhbSB7bnVtYmVyfSB2ZSB0aGUgZW5kIChib3R0b20pIHBpeGVsIHZhbHVlIGZvciB0aGUgdmVydGljYWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gaHNMYWJlbD8gYW4gb3B0aW9uYWwgbGFiZWwgZm9yIHRoZSBzdGFydCAobGVmdCkgb2YgdGhlIGhvcml6b250YWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gaGVMYWJlbD8gYW4gb3B0aW9uYWwgbGFiZWwgZm9yIHRoZSBlbmQgKHJpZ2h0KSBvZiB0aGUgaG9yaXpvbnRhbCBheGlzCiAqIEBwYXJhbSB7c3RyaW5nfSB2c0xhYmVsPyBhbiBvcHRpb25hbCBsYWJlbCBmb3IgdGhlIHN0YXJ0ICh0b3ApIG9mIHRoZSB2ZXJ0aWNhbCBheGlzCiAqIEBwYXJhbSB7c3RyaW5nfSB2ZUxhYmVsPyBhbiBvcHRpb25hbCBsYWJlbCBmb3IgdGhlIGVuZCAoYm90dG9tKSBvZiB0aGUgdmVydGljYWwgYXhpcwogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIGF4ZXMoCiAgaExhYmVsLAogIGhzLAogIGhlLAogIHZMYWJlbCwKICB2cywKICB2ZSwKICBoc0xhYmVsID0gZmFsc2UsCiAgaGVMYWJlbCA9IGZhbHNlLAogIHZzTGFiZWwgPSBmYWxzZSwKICB2ZUxhYmVsID0gZmFsc2UKKSB7CiAgbGluZShocywgMCwgaGUsIDApOwogIGxpbmUoMCwgdnMsIDAsIHZlKTsKCiAgY29uc3QgaHBvcyA9IDAgLSA1OwogIHRleHQoYCR7aExhYmVsfSDihpJgLCB3aWR0aCAvIDIgKyA1LCBocG9zLCBSSUdIVCk7CiAgdGV4dChoc0xhYmVsID8gaHNMYWJlbCA6IGhzLCBocywgaHBvcywgUklHSFQpOwogIHRleHQoaGVMYWJlbCA/IGhlTGFiZWwgOiBoZSwgaGUsIGhwb3MsIFJJR0hUKTsKCiAgY29uc3QgdnBvcyA9IC01OwogIHNhdmUoKTsKICB0cmFuc2xhdGUodnBvcywgaGVpZ2h0IC8gMik7CiAgcm90YXRlKC1QSSAvIDIpOwogIHRleHQoYCR7dkxhYmVsfWAsIDAsIDAsIExFRlQpOwogIHJlc3RvcmUoKTsKICB0ZXh0KGDihpNgLCB2cG9zLCBoZWlnaHQgLyAyICsgMTYsIFJJR0hUKTsKICB0ZXh0KHZzTGFiZWwgPyB2c0xhYmVsIDogdnMsIHZwb3MsIHZzICsgNSwgUklHSFQpOwogIHRleHQodmVMYWJlbCA/IHZlTGFiZWwgOiB2ZSwgdnBvcywgdmUsIFJJR0hUKTsKfQoKLyoqCiAqIERyYXcgb25lIG9yIG1vcmUgQmV6aWVyIGN1cnZlcyBmcm9tIGFuIGFycmF5CiAqIG9mIFBvaW50IG9yIFBvaW50LWxpa2VzIHRoYXQgaW1wbGVtZW50OgogKgogKiBgYGAKICogewogKiAgIHg6IG51bWJlcgogKiAgIHk6IG51bWJlcgogKiB9CiAqIGBgYAogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgI0YwMDJgKTsKICogICAgICAgYmV6aWVyKAogKiAgICAgICAgIG5ldyBQb2ludCgyMCwgaGVpZ2h0IC0gNTUpLAogKiAgICAgICAgIG5ldyBQb2ludCgyMCwgMjUpLAogKiAgICAgICAgIHsgeDogd2lkdGggLSAyMCwgeTogMjV9LAogKiAgICAgICAgIHsgeDogd2lkdGggLSAyMCwgeTogaGVpZ2h0IC0gNTV9CiAqICAgICAgICk7CiAqICAgICAgIG5vRmlsbCgpCiAqICAgICAgIGJlemllcigKICogICAgICAgICBuZXcgUG9pbnQoMCwgaGVpZ2h0IC0gMjApLAogKiAgICAgICAgIG5ldyBQb2ludCh3aWR0aCAtIDIwLCBoZWlnaHQgLSAyMCksCiAqICAgICAgICAgeyB4OiAyMCwgeTogMjB9LAogKiAgICAgICAgIHsgeDogd2lkdGgsIHk6IDIwfQogKiAgICAgICApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyWzhdfSAuLi5jb29yZGluYXRlcyBFaWdodCB4LCB5IHZhbHVlcy4KICogQHBhcmFtIHtudW1iZXJbNm5dfSAuLi5hZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IE11bHRpcGxlcyBvZiBzaXggeCwgeSB2YWx1ZXMuCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlWzRdfSAuLi5jb29yZGluYXRlcyBGb3VyIHt4LHl9IGNvb3JkaW5hdGVzLgogKiBAcGFyYW0ge1BvaW50TGlrZVszbl19IC4uLmFkZGl0aW9uYWxDb29yZGluYXRlcz8gTXVsdGlwbGVzIG9mIHRocmVlIHt4LHl9IGNvb3JkaW5hdGVzLgogKgogKiBAc2VlIHtAbGluayBic3BsaW5lfQogKiBAc2VlIHtAbGluayBzcGxpbmV9CiAqLwpmdW5jdGlvbiBiZXppZXIoLi4uYXJncykgewogIGxldCBwb2ludHMgPSBhcmdzOwoKICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09IGBudW1iZXJgKSB7CiAgICBwb2ludHMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkgKz0gMikgewogICAgICBwb2ludHMucHVzaCh7IHg6IGFyZ3NbaV0sIHk6IGFyZ3NbaSArIDFdIH0pOwogICAgfQogIH0KCiAgY29uc3QgYiA9ICh0LCBhLCBiLCBjLCBkKSA9PiB7CiAgICBjb25zdCBtdCA9IDEgLSB0OwogICAgcmV0dXJuIGEgKiBtdCAqKiAzICsgMyAqIGIgKiBtdCAqKiAyICogdCArIDMgKiBjICogbXQgKiB0ICoqIDIgKyBkICogdCAqKiAzOwogIH07CgogIGxldCBbcDAsIC4uLnJlc3RdID0gcG9pbnRzOwogIHN0YXJ0KCk7CiAgZm9yIChsZXQgaSA9IDAsIGUgPSByZXN0Lmxlbmd0aDsgaSA8IGU7IGkgKz0gMykgewogICAgbGV0IFtwMSwgcDIsIHAzXSA9IHJlc3Quc2xpY2UoaSwgaSArIDMpOwogICAgaWYgKHAxICYmIHAyICYmIHAzKSB7CiAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgMTsgdCArPSAwLjAxKSB7CiAgICAgICAgdmVydGV4KGIodCwgcDAueCwgcDEueCwgcDIueCwgcDMueCksIGIodCwgcDAueSwgcDEueSwgcDIueSwgcDMueSkpOwogICAgICB9CiAgICAgIHZlcnRleChwMy54LCBwMy55KTsKICAgICAgcDAgPSBwMzsKICAgIH0KICB9CiAgZW5kKCk7Cn0KCi8qKgogKiBEcmF3IGEgQi1zcGxpbmUgdXNpbmcgZm91ciBvciBtb3JlIFBvaW50IG9yCiAqIFBvaW50LWxpa2VzIHRoYXQgaW1wbGVtZW50OgogKgogKiBgYGAKICogewogKiAgIHg6IG51bWJlcgogKiAgIHk6IG51bWJlcgogKiB9CiAqIGBgYAogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHJhbmdlKDAsIFRBVSwgUEkgLyA1LCAoYSkgPT4gcG9pbnRzLnB1c2goCiAqICAgICAgICAgbmV3IFBvaW50KAogKiAgICAgICAgICAgcmFuZG9tKDMwKSArIDUwICogY29zKGEpLAogKiAgICAgICAgICAgcmFuZG9tKDMwKSArIDUwICogc2luKGEpCiAqICAgICAgICAgKQogKiAgICAgICApKTsKICogICAgICAgc2V0TW92YWJsZSguLi5wb2ludHMpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwogKiAgICAgICBub1N0cm9rZSgpOwogKiAgICAgICBzZXRGaWxsKGAjMDAwMmApOwogKiAgICAgICBic3BsaW5lKC4uLnBvaW50cyk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgcG9pbnRzLmZvckVhY2gocCA9PiBwb2ludChwKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJbOF19IC4uLmNvb3JkaW5hdGVzIEVpZ2h0IHgsIHkgdmFsdWVzLgogKiBAcGFyYW0ge251bWJlclsybl19IC4uLmFkZGl0aW9uYWxDb29yZGluYXRlcz8gTXVsdGlwbGVzIG9mIHgsIHkgdmFsdWVzLgogKgogKiBAcGFyYW0ge1BvaW50TGlrZVs0XX0gLi4uY29vcmRpbmF0ZXMgRm91ciB7eCx5fSBjb29yZGluYXRlcy4KICogQHBhcmFtIHtQb2ludExpa2Vbbl19IC4uLmFkZGl0aW9uYWxDb29yZGluYXRlcz8gWmVybyBvciBtb3JlIHt4LHl9IGNvb3JkaW5hdGVzLgogKgogKiBAc2VlIHtAbGluayBiZXppZXJ9CiAqIEBzZWUge0BsaW5rIHNwbGluZX0KICovCgpmdW5jdGlvbiBic3BsaW5lKC4uLmFyZ3MpIHsKICBsZXQgb3BlbiA9IHRydWU7CiAgaWYgKHR5cGVvZiBhcmdzW2FyZ3MubGVuZ3RoIC0gMV0gPT09IGBib29sZWFuYCkgewogICAgb3BlbiA9IGFyZ3Muc3BsaWNlKGFyZ3MubGVuZ3RoIC0gMSwgMSlbMF07CiAgfQoKICBsZXQgcG9pbnRzID0gYXJnczsKCiAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBgbnVtYmVyYCkgewogICAgcG9pbnRzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgcG9pbnRzLnB1c2goeyB4OiBhcmdzW2ldLCB5OiBhcmdzW2kgKyAxXSB9KTsKICAgIH0KICB9CgogIHN0YXJ0KCk7CiAgbmV3IEJTcGxpbmUocG9pbnRzLCBvcGVuKS5nZXRMVVQoKS5mb3JFYWNoKChwKSA9PiB2ZXJ0ZXgocC54LCBwLnkpKTsKICBlbmQoKTsKfQoKLyoqCiAqIERyYXcgYSBjaXJjbGUgd2l0aCByYWRpdXMgYHJgIGF0IGB4LHlgLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgI0YwMDJgKTsKICogICAgICAgY2lyY2xlKHdpZHRoLzIsIGhlaWdodC8yLCA4MCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGNpcmNsZSdzIGNlbnRlciB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBjaXJjbGUncyBjZW50ZXIgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gciBUaGUgY2lyY2xlJ3MgcmFkaXVzIGluIHBpeGVscwogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgY2lyY2xlJ3MgY2VudGVyIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHIgVGhlIGNpcmNsZSdzIHJhZGl1cyBpbiBwaXhlbHMKICoKICogQHNlZSB7QGxpbmsgYXJjfQogKi8KZnVuY3Rpb24gY2lyY2xlKHgsIHksIHIpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHIgPSB5OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIGFyYyh4LCB5LCByLCAwLCBUQVUsIGZhbHNlKTsKfQoKLyoqCiAqIENsZWFyIHRoZSBjYW52YXMsIGFuZCBzZXQgaXQgdG8gYSBzcGVjaWZpYyAoQ1NTKSBjb2xvdXIuCiAqIElmIG5vIGBub0dyaWQoKWAgY2FsbCB3YXMgbWFkZSwgdGhpcyB3aWxsIHRoZW4gYWxzbyBkcmF3CiAqIHRoZSBiYWNrZ3JvdW5kIGdyaWQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgcGlua2ApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Y29sb3J9IGNvbG9yPyBUaGUgKENTUykgYmFja2dyb3VuZCBjb2xvciB0byB1c2UgKGRlZmF1bHQgPSBgd2hpdGVgKQogKi8KZnVuY3Rpb24gY2xlYXIoY29sb3IgPSBgd2hpdGVgKSB7CiAgc2F2ZSgpOwogIF9fY2FudmFzLnN0eWxlLmJhY2tncm91bmQgPSBjb2xvcjsKICBfX2NhbnZhcy53aWR0aCA9IHdpZHRoOwogIF9fY3R4ID0gX19jYW52YXMuZ2V0Q29udGV4dChgMmRgKTsKICBpZiAoX19kcmF3X2dyaWQpIGdyaWQoKTsKICByZXN0b3JlKCk7Cn0KCi8qKgogKiBDb3VudGVycGFydCB0byBzdGFydCgpLCBmaW5hbGl6ZXMgdGhlIGN1cnJlbnQgc2hhcGUgYW5kCiAqIGNvbG91cnMgaXQuIElmIGBjbG9zZWAgaXMgdHJ1ZSwgaXQgd2lsbCBjbG9zZSB0aGUgcGF0aAogKiBiZWZvcmUgY29sb3VyaW5nLgogKgogKiBJZiBgbm9GaWxsKClgIGlzIGluIGVmZmVjdCwgdGhlIHNoYXBlIHdpbGwgbm90IGJlIGZpbGxlZC4KICogaWYgYG5vU3Ryb2tlKClgIGlzIGluIGVmZmVjdCwgdGhlIHNoYXBlIG91dGxpbmUgd2lsbCBub3QgYmUgY29sb3VyZWQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGBnb2xkYCk7CiAqICAgICAgIHN0YXJ0KCk7CiAqICAgICAgIHZlcnRleCgwLGhlaWdodC8yKTsKICogICAgICAgdmVydGV4KHdpZHRoLzIsIDApOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgsIGhlaWdodC8yKTsKICogICAgICAgdmVydGV4KHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIGVuZCh0cnVlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge2Jvb2xlYW59IGNsb3NlPyBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgd2hldGhlciBvciBub3QgdG8gY2xvc2UgdGhlIHBhdGggKGRlZmF1bHQgPSBmYWxzZSkKICoKICogQHNlZSB7QGxpbmsgc3RhcnR9CiAqIEBzZWUge0BsaW5rIHZlcnRleH0KICovCmZ1bmN0aW9uIGVuZChjbG9zZSA9IGZhbHNlKSB7CiAgaWYgKGNsb3NlKSBfX2N0eC5jbG9zZVBhdGgoKTsKICBfX2N0eC5maWxsKCk7CiAgX19jdHguc3Ryb2tlKCk7CiAgaWYgKF9fY3R4LmxpbmVXaWR0aCAlIDIgPT09IDEpIHsKICAgIF9fY3R4LnRyYW5zbGF0ZSgtMC41LCAtMC41KTsKICB9Cn0KCi8qKgogKiBEcmF3IGFuIGltYWdlIGluIGEgZ2l2ZW4gbG9jYXRpb24gd2l0aCBhbiBvcHRpb25hbAogKiB3aWR0aCBhbmQgaGVpZ2h0LiBJZiBvbWl0dGVkLCB0aGUgd2lkdGggYW5kIGhlaWdodAogKiB3aWxsIGJlIHRoZSBpbWFnZSdzIG93biBkaW1lbnNpb25zLiBOb3RlIHRoYXQgdGhlCiAqIGltYWdlIG1heSBiZSBlaXRoZXIgYSBVUkwsIG9yIGFuIDxpbWc+IGVsZW1lbnQuCiAqCiAqIE5vdGUgdGhhdCB0aGlzIGlzIGFuIGFzeW5jIGZ1bmN0aW9uOiBpZiBpdCBpcyBpbXBvcnRhbnQKICogdGhhdCBub3RoaW5nIGdldHMgZHJhd24gdW50aWwgdGhlIGltYWdlIGhhcyBiZWVuIGRyYXduLAogKiByZW1lbWJlciB0byBgYXdhaXRgIGl0cyBjYWxsLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgYXN5bmMgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGF3YWl0IGltYWdlKGBodHRwczovL2R1bW15aW1hZ2UuY29tLzEwMHgxMDBgLCA1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge0ltYWdlfHN0cmluZ30gaW1nT3JVUkwgVGhlIGltYWdlIHRvIGRyYXcgZWl0aGVyIGFzIEltYWdlIG9iamVjdCwgb3IgaW1hZ2UgVVJMLgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgZHJhdyBwb3NpdGlvbidzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIGRyYXcgcG9zaXRpb24ncyB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB3IFRoZSB3aWR0aCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEBwYXJhbSB7bnVtYmVyfSBoIFRoZSBoZWlnaHQgb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcmV0dXJucyB7SW1hZ2V9IFRoZSBkcmF3biBpbWFnZQogKgogKiBAcGFyYW0ge0ltYWdlfHN0cmluZ30gaW1nT3JVUkwgVGhlIGltYWdlIHRvIGRyYXcgZWl0aGVyIGFzIEltYWdlIG9iamVjdCwgb3IgaW1hZ2UgVVJMLgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgZHJhdyBwb3NpdGlvbiBhcyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB3IFRoZSB3aWR0aCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEBwYXJhbSB7bnVtYmVyfSBoIFRoZSBoZWlnaHQgb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcmV0dXJucyB7SW1hZ2V9IFRoZSBkcmF3biBpbWFnZQogKi8KYXN5bmMgZnVuY3Rpb24gaW1hZ2UoaW1nLCB4ID0gMCwgeSA9IDAsIHcsIGgpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIGggPSB3OwogICAgdyA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIGlmICh0eXBlb2YgaW1nID09PSBgc3RyaW5nYCkgewogICAgaW1nID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBjb25zdCB0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBpbWdgKTsKICAgICAgdGFnLm9ubG9hZCA9ICgpID0+IHJlc29sdmUodGFnKTsKICAgICAgdGFnLm9uZXJyb3IgPSAoKSA9PiByZWplY3QoKTsKICAgICAgdGFnLnNyYyA9IGltZzsKICAgIH0pOwogIH0KICBfX2N0eC5kcmF3SW1hZ2UoaW1nLCB4LCB5LCB3IHx8IGltZy53aWR0aCwgaCB8fCBpbWcuaGVpZ2h0KTsKICByZXR1cm4gaW1nOwp9CgovKioKICogRHJhdyBhIGxpbmUgZnJvbSBvbmUgY29vcmRpbmF0ZSB0byBhbm90aGVyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgcmFuZ2UoMCxoZWlnaHQsMjAsIChpKSA9PiBsaW5lKDAsIDAsIHdpZHRoLCBpKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHgxIFRoZSBmaXJzdCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkxIFRoZSBmaXJzdCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHgyIFRoZSBzZWNvbmQgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MiBUaGUgc2Vjb25kIHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDEgVGhlIGZpcnN0IHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDIgVGhlIHNlY29uZCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICovCmZ1bmN0aW9uIGxpbmUoeDEsIHkxLCB4MiwgeTIpIHsKICBpZiAoeDEueCAhPT0gdW5kZWZpbmVkICYmIHgxLnkgIT09IHVuZGVmaW5lZCkgewogICAgeTIgPSB5MS55OwogICAgeDIgPSB5MS54OwogICAgeTEgPSB4MS55OwogICAgeDEgPSB4MS54OwogIH0KCiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICB2ZXJ0ZXgoeDIsIHkyKTsKICBlbmQoKTsKfQoKLyoqCiAqIFBsb3QgYSB5PWYoeCkgZnVuY3Rpb24uIFRoZSBpbnB1dCB0byB0aGUgZnVuY3Rpb24KICogd2lsbCBzcGFuIHRoZSBpbnRlcnZhbCBbYSxiXSB1c2luZyB0aGUgaW5kaWNhdGVkCiAqIG51bWJlciBvZiBzdGVwcywgYW5kIHRoZSByZSBzdWx0IG1heSBiZSBzY2FsZWQgYm90aAogKiBpbiB0aGUgeCBhbmQgeSBkaXJlY3Rpb24gaW4gb3JkZXIgdG8gZHJhdyBzb21ldGhpbmcKICogdGhhdCB5b3UgY2FuIGFjdHVhbGx5IHNlZSAoZS5nLiBpZiB5b3UncmUgcGxvdHRpbmcKICogdG8gdGhlIGRvbWFpbiBbMCwxXSB5b3Ugd291bGRuJ3QgYmUgYWJsZSB0byBzZWUgdGhlCiAqIHJlc3VsdCB3aXRob3V0IHNjYWxpbmcpLgogKgogKiBUaGlzIGZ1bmN0aW9uIGlzIGF3YXJlIG9mLCBhbmQgd2lsbCBwbG90LCBkaXNjb250aW51aXRpZXMKICogdXNpbmcgdGhlIHN0YW5kYXJkIG9wZW4gY2lyY2xlIG5vdGF0aW9uLCB1bmxlc3MgaW5zdHJ1Y3RlZAogKiBub3QgdG8gZG8gc28gdXNpbmcgdGhlIGBpZ25vcmVEaXNjb250aW51aXR5YCBib29sZWFuIGZsYWcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgdHJhbnNsYXRlKDAsIGhlaWdodCAvIDIpOwogKiAgICAgICBjb25zdCBmbiA9ICh4KSA9PiBjb3MoeCkgKiogNiAvIHNpbih4KSAtIHNpbih4KS8yOwogKiAgICAgICBwbG90KGZuLCAwLCAyKlRBVSwgMTIwLCB3aWR0aCAvIFRBVSwgaGVpZ2h0IC8gMik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtmdW5jdGlvbn0gZiB0aGUgYHkgPSBmKHgpYCBmdW5jdGlvbiB0byBwbG90CiAqIEBwYXJhbSB7bnVtYmVyfSBhPyBUaGUgbG93ZXIgYm91bmQgZm9yIHRoZSBpbnB1dCB2YWx1ZSAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSB7bnVtYmVyfSBiPyBUaGUgdXBwZXIgYm91bmQgZm9yIHRoZSBpbnB1dCB2YWx1ZSAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGVwcz8gVGhlIG51bWJlciBvZiBwbG90IHBvaW50cyB0byBwbG90IG92ZXIgdGhlIGludGVydmFsIFthLGJdIChkZWZhdWx0ID0gMTAwKQogKiBAcGFyYW0ge251bWJlcn0geHNjYWxlPyBBbiBvcHRpb25hbCBzY2FsaW5nIGZhY3RvciB0byBhcHBseSB0byBlYWNoIHBsb3QgcG9pbnQncyB4IHZhbHVlIChkZWZhdWx0ID0gMSkKICogQHBhcmFtIHtudW1iZXJ9IHlzY2FsZT8gQW4gb3B0aW9uYWwgc2NhbGluZyBmYWN0b3IgdG8gYXBwbHkgdG8gZWFjaCBwbG90IHBvaW50J3MgeSB2YWx1ZSAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSB7Ym9vbGVhbn0gaWdub3JlRGlzY29udGludWl0eT8gRG8gbm90IGRyYXcgc3BlY2lhbCBlbGVtZW50cyBmb3IgZGlzY29udGludWl0aWVzIChkZWZhdWx0ID0gZmFsc2UpCiAqCiAqIEBzZWUge0BsaW5rIHBsb3REYXRhfQogKi8KZnVuY3Rpb24gcGxvdCgKICBmLAogIGEgPSAwLAogIGIgPSAxLAogIHN0ZXBzID0gMTAwLAogIHhzY2FsZSA9IDEsCiAgeXNjYWxlID0gMSwKICBpZ25vcmVEaXNjb250aW51aXR5ID0gZmFsc2UKKSB7CiAgY29uc3QgaW50ZXJ2YWwgPSBiIC0gYTsKICBzdGFydCgpOwogIGxldCBbcHksIGR5LCBwZHldID0gWzAsIDAsIDBdOwogIGNvbnN0IHN0ZXAgPSBpbnRlcnZhbCAvIChzdGVwcyAtIDEpOwogIGNvbnN0IGRpc2NvbnRpbnVpdHkgPSAoaSwgeCwgeSkgPT4gewogICAgZW5kKCk7CiAgICBzYXZlKCk7CiAgICBub0ZpbGwoKTsKICAgIHBvaW50KHggKiB4c2NhbGUsIHB5ICogeXNjYWxlKTsKICAgIHBvaW50KHggKiB4c2NhbGUsIHkgKiB5c2NhbGUpOwogICAgcmVzdG9yZSgpOwogICAgc3RhcnQoKTsKICB9OwogIGZvciAobGV0IGkgPSAwLCB4LCB5OyBpIDwgc3RlcHM7IGkrKykgewogICAgeCA9IGEgKyBpICogc3RlcDsKICAgIHkgPSBmKHgpOwogICAgLy8gSWYgZih4KSBjaGFuZ2VzIGluIHZpb2xhdGlvbiBvZiB3aGF0IGl0cyBmJyh4KSBzdWdnZXN0ZWQsCiAgICAvLyB0aGF0J3MgYSBkaXNjb250aW51aXR5IGFuZCB3ZSBkcmF3IGFuIGFzeW1wdG90ZS4KICAgIGR5ID0gKHkgLSBweSkgKiBzdGVwOwogICAgaWYgKCFpZ25vcmVEaXNjb250aW51aXR5KSB7CiAgICAgIGlmIChwZHkgIT09IG51bGwgJiYgc2lnbih5IC0gcHkpICE9PSBzaWduKHBkeSkgJiYgYWJzKHBkeSkgPiAwLjAxKSB7CiAgICAgICAgZGlzY29udGludWl0eShpLCB4LCB5KTsKICAgICAgICBwZHkgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHBkeSA9IGR5OwogICAgICB9CiAgICB9CiAgICB2ZXJ0ZXgoeCAqIHhzY2FsZSwgeSAqIHlzY2FsZSk7CiAgICBweSA9IHk7CiAgfQogIGVuZCgpOwp9CgovKioKICogUGxvdCBhIDJEIGdyYXBoIHVzaW5nIGEgY29sbGVjdGlvbiBvZiBhbnktZGltZW5zaW9uYWwgZGF0YSwKICogYnkgaW5kaWNhdGluZyB3aGljaCBkaW1lbnNpb24gc2hvdWxkIGJlIHRyZWF0ZWQgYXMgdGhlIGB4YAogKiBhbmQgd2hpY2ggZGltZW5zaW9uIHNob3VsZCBiZSB0cmVhdGVkIGFzIHRoZSBgeWAuIElmIG5vIGB4YAogKiBhbmQgYHlgIGFyZSBwcm92aWRlZCwgYGRhdGFgIHdpbGwgYmUgdHJlYXRlZCBhIDFEIGFycmF5IGFuZAogKiB3aWxsIHBsb3Qgd2l0aCB0aGUgYXJyYXkgaW5kZXggYXMgYHhgIGFuZCBlbGVtZW50IGF0IHRoYXQKICogaW5kZXggYXMgYHlgLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICB0cmFuc2xhdGUoMCwgaGVpZ2h0LzIpOwogKgogKiAgICAgICBzZXRTdHJva2UoYGRhcmtncmVlbmApOwogKiAgICAgICBsZXQgZGF0YSA9IGFycmF5KHdpZHRoLCAoaSkgPT4gW2ksIGhlaWdodC8yICogc2luKGkvMjUpXSk7CiAqICAgICAgIHBsb3REYXRhKGRhdGEsIDAsIDEpOwogKgogKiAgICAgICBzZXRTdHJva2UoYHB1cnBsZWApOwogKiAgICAgICBkYXRhID0gYXJyYXkod2lkdGgsIChpKSA9PiAoewogKiAgICAgICAgIG1lZXA6IGksCiAqICAgICAgICAgbW9vcDogaGVpZ2h0LzIgKiBjb3MoaS8yNSkKICogICAgICAgfSkpOwogKiAgICAgICBwbG90RGF0YShkYXRhLCBgbWVlcGAsIGBtb29wYCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtvYmplY3RbXX0gZGF0YSBUaGUgYW55LWRpbWVuc2lvbmFsIGRhdGEgZnJvbSB3aGljaCB0byBwbG90IG9uZSBkaW1lbnNpb24gYWdhaW4gYW5vdGhlcgogKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IHg/IFRoZSBwcm9wZXJ0eSBuYW1lIG9yIGluZGl2aWR1YWwgZWxlbWVudCBhcnJheSBpbmRleCB0byB1c2UgYXMgeCBkaW1lbnNpb24KICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSB5PyBUaGUgcHJvcGVydHkgbmFtZSBvciBpbmRpdmlkdWFsIGVsZW1lbnQgYXJyYXkgaW5kZXggdG8gdXNlIGFzIHkgZGltZW5zaW9uCiAqCiAqIEBzZWUge0BsaW5rIHBsb3R9CiAqLwpmdW5jdGlvbiBwbG90RGF0YShkYXRhLCB4LCB5KSB7CiAgc3RhcnQoKTsKICBpZiAoeCAhPT0gdW5kZWZpbmVkICYmIHkgIT09IHVuZGVmaW5lZCkgewogICAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHkgPSB4Lnk7CiAgICAgIHggPSB4Lng7CiAgICB9CiAgICBkYXRhLmZvckVhY2goKHApID0+IHZlcnRleChwW3hdLCBwW3ldKSk7CiAgfSBlbHNlIHsKICAgIGRhdGEuZm9yRWFjaCgoeSwgeCkgPT4gdmVydGV4KHgsIHkpKTsKICB9CiAgZW5kKCk7Cn0KCi8qKgogKiBEcmF3IGEgcG9pbnQgKGVpdGhlciBmcm9tIHgveSBvciBwb2ludC1saWtlKS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICByYW5nZSgwLCBUQVUsIChhKSA9PiB7CiAqICAgICAgICAgcG9pbnQoNDAgKiBjb3MoYSksIDQwICogc2luKGEpKTsKICogICAgICAgfSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHBvaW50J3MgY2VudGVyIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHBvaW50J3MgY2VudGVyIHkgcGl4ZWwgdmFsdWUKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHBvaW50J3MgY2VudGVyIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgY2lyY2xlfQogKi8KZnVuY3Rpb24gcG9pbnQoeCwgeSkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIGNpcmNsZSh4LCB5LCAzKTsKfQoKLyoqCiAqIERyYXcgYSByZWN0YW5nbGUgYXQgdGhlIHNwZWNpZmllZCBjb29yZGluYXRlLCB3aXRoCiAqIHRoZSBzcGVjaWZpYyB3aWR0aCBhbmQgaGVpZ2h0LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHJlY3QoNDAsIDQwLCB3aWR0aCAtIDgwLCBoZWlnaHQgLSA4MCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHJlY3QncyBjb3JuZXIgIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHJlY3QncyBjb3JuZXIgIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHcgVGhlIHdpZHRoIG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHBhcmFtIHtudW1iZXJ9IGggVGhlIGhlaWdodCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSByZWN0O3MgY29yZGVyIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHcgVGhlIHdpZHRoIG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHBhcmFtIHtudW1iZXJ9IGggVGhlIGhlaWdodCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqLwpmdW5jdGlvbiByZWN0KHgsIHksIHcsIGgpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIGggPSB3OwogICAgdyA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIHN0YXJ0KCk7CiAgdmVydGV4KHgsIHkpOwogIHZlcnRleCh4ICsgdywgeSk7CiAgdmVydGV4KHggKyB3LCB5ICsgaCk7CiAgdmVydGV4KHgsIHkgKyBoKTsKICB2ZXJ0ZXgoeCwgeSk7CiAgZW5kKCk7Cn0KCi8qKgogKiBEcmF3IGEgY2FyZGluYWwgKGhlcm1pdGUpIHNwbGluZSB0aGF0IHBhc3NlcyB0aHJvdWdoIGVhY2gKICogcG9pbnQgcHJvdmlkZWQsIHVzaW5nIGEgbWF0aGVtYXRpY2FsbHkgdmlydHVhbCBzdGFydCBhbmQKICogZW5kIHRvIGVuc3VyZSB0aGUgY3VydmUgc3RhcnRzIGFuZCBlbmRzIGF0IHRoZSBwcm92aWRlZAogKiBzdGFydCBhbmQgZW5kIHBvaW50LiBUaGlzIGNhbiBiZSBieXBhc3NlZCBieSBzZXR0aW5nCiAqIHRoZSBgdmlydHVhbGAgYXJndW1lbnQgdG8gYGZhbHNlYC4KICoKICogQWRkaXRpb25hbGx5LCB0aGUgc3BsaW5lJ3MgdGlnaHRuZXNzLCB3aGljaCBjb250cm9scwogKiBob3cgImJlbmR5IiB0aGUgc3BsaW5lIGlzICh0aGUgdGlnaHRlciB0aGUgc3BsaW5lLAogKiB0aGUgc2hhcnBlciBiZW5kcyBiZWNvbWUpIGNhbiBiZSBjb250cm9sbGVkIGJ5IHNldHRpbmcKICogdGhlIGB0aWdodG5lc3NgIHZhbHVlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHJhbmdlKDAsIFRBVSwgUEkgLyA1LCAoYSkgPT4gcG9pbnRzLnB1c2goCiAqICAgICAgICAgbmV3IFBvaW50KAogKiAgICAgICAgICAgcmFuZG9tKDMwKSArIDUwICogY29zKGEpLAogKiAgICAgICAgICAgcmFuZG9tKDMwKSArIDUwICogc2luKGEpCiAqICAgICAgICAgKQogKiAgICAgICApKTsKICogICAgICAgc2V0TW92YWJsZSguLi5wb2ludHMpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwogKiAgICAgICBzZXRGaWxsKGAjMDAwMmApOwogKiAgICAgICBzcGxpbmUoLi4ucG9pbnRzKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBwb2ludHMuZm9yRWFjaChwID0+IHBvaW50KHApKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKgogKiBAcGFyYW0ge1BvaW50TGlrZVtdfSAuLi5wb2ludHMgVGhlIHBvaW50cyBhY3Jvc3Mgd2hpY2ggdG8gZml0IGEgc3BsaW5lCiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmlydHVhbD8gV2hldGhlciBvciBub3QgdG8gaW52ZW50IG5ldyBtYXRoZW1hdGljYWwgcG9pbnRzIHRoYXQgZW5zdXJlIHRoZSBjdXJ2ZSBzdGFydHMgYW5kIGVuZHMgYXQgdGhlIHByb3ZpZGVkIHN0YXJ0IGFuZCBlbmQgcG9pbnRzLiAoZGVmYXVsdCA9IHRydWUpCiAqIEBwYXJhbSB7bnVtYmVyfSB0aWdodG5lc3M/IEhvdyB0aWdodCB0aGlzIHNwbGluZSBzaG91bGQgYmUgZml0IHRocm91Z2ggdGhlIHBvaW50cyBwcm92aWRlZC4gVGhlIGhpZ2hlciB0aGUgdGlnaHRuZXNzLCB0aGUgbW9yZSBwb2x5Z29uYWwgdGhlIGN1cnZlIGJlY29tZXMgKGRlZmF1bHQgPSAxKQogKgogKiBAc2VlIHtAbGluayBiZXppZXJ9CiAqIEBzZWUge0BsaW5rIGJzcGxpbmV9CiAqLwpmdW5jdGlvbiBzcGxpbmUoLi4uYXJncykgewogIGxldCBwb2ludHMgPSBhcmdzOwogIGxldCB2aXJ0dWFsID0gdHJ1ZTsKICBsZXQgVCA9IDE7CgogIGlmICh0eXBlb2YgYXJnc1thcmdzLmxlbmd0aCAtIDFdID09PSBgYm9vbGVhbmApIHsKICAgIFt2aXJ0dWFsXSA9IGFyZ3Muc3BsaWNlKGFyZ3MubGVuZ3RoIC0gMSwgMSk7CiAgfQoKICBpZiAodHlwZW9mIGFyZ3NbYXJncy5sZW5ndGggLSAyXSA9PT0gYGJvb2xlYW5gKSB7CiAgICBbdmlydHVhbCwgVF0gPSBhcmdzLnNwbGljZShhcmdzLmxlbmd0aCAtIDIsIDIpOwogIH0KCiAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBgbnVtYmVyYCkgewogICAgcG9pbnRzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgcG9pbnRzLnB1c2goeyB4OiBhcmdzW2ldLCB5OiBhcmdzW2kgKyAxXSB9KTsKICAgIH0KICB9CgogIGxldCBjcG9pbnRzID0gcG9pbnRzOwogIGlmICh2aXJ0dWFsKSB7CiAgICBjb25zdCBmMCA9IHBvaW50c1swXSwKICAgICAgZjEgPSBwb2ludHNbMV0sCiAgICAgIGYyID0gcG9pbnRzWzJdLAogICAgICBmc20gPSBuZXcgVmVjdG9yKGYwLnggLyAyICsgZjIueCAvIDIsIGYwLnkgLyAyICsgZjIueSAvIDIpLAogICAgICBmMHIgPSBuZXcgVmVjdG9yKGYwKS5yZWZsZWN0KGYxKSwKICAgICAgZnNyID0gZnNtLnJlZmxlY3QoZjEpLAogICAgICBmbiA9IG5ldyBWZWN0b3IoZjByLnggLyAyICsgZnNyLnggLyAyLCBmMHIueSAvIDIgKyBmc3IueSAvIDIpLAogICAgICBsMiA9IHBvaW50cy5hdCgtMyksCiAgICAgIGwxID0gcG9pbnRzLmF0KC0yKSwKICAgICAgbDAgPSBwb2ludHMuYXQoLTEpLAogICAgICBsc20gPSBuZXcgVmVjdG9yKGwwLnggLyAyICsgbDIueCAvIDIsIGwwLnkgLyAyICsgbDIueSAvIDIpLAogICAgICBsMHIgPSBuZXcgVmVjdG9yKGwwKS5yZWZsZWN0KGwxKSwKICAgICAgbG4gPSBuZXcgVmVjdG9yKGwwci54IC8gMiArIGxzbS54IC8gMiwgbDByLnkgLyAyICsgbHNtLnkgLyAyKTsKICAgIGNwb2ludHMgPSBbZm4sIC4uLnBvaW50cywgbG5dOwogIH0KCiAgLy8gZm91ciBwb2ludCBzbGlkaW5nIHdpbmRvdyBvdmVyIHRoZSBzZWdtZW50CiAgY29uc3QgYmV6aWVyUG9pbnRzID0gW107CiAgZm9yIChsZXQgaSA9IDAsIGUgPSBjcG9pbnRzLmxlbmd0aCAtIDM7IGkgPCBlOyBpKyspIHsKICAgIGxldCBbYzEsIGMyLCBjMywgYzRdID0gY3BvaW50cy5zbGljZShpLCBpICsgNCk7CiAgICBsZXQgcDIgPSB7CiAgICAgIHg6IGMyLnggKyAoYzMueCAtIGMxLngpIC8gKDYgKiBUKSwKICAgICAgeTogYzIueSArIChjMy55IC0gYzEueSkgLyAoNiAqIFQpLAogICAgfTsKICAgIGxldCBwMyA9IHsKICAgICAgeDogYzMueCAtIChjNC54IC0gYzIueCkgLyAoNiAqIFQpLAogICAgICB5OiBjMy55IC0gKGM0LnkgLSBjMi55KSAvICg2ICogVCksCiAgICB9OwogICAgaWYgKGkgPT09IDApIGJlemllclBvaW50cy5wdXNoKGMyKTsKICAgIGJlemllclBvaW50cy5wdXNoKHAyLCBwMywgYzMpOwogIH0KCiAgYmV6aWVyKC4uLmJlemllclBvaW50cyk7Cn0KCi8qKgogKiBTdGFydHMgYSAobmV3KSBzaGFwZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYGdvbGRgKTsKICogICAgICAgc3RhcnQoKTsKICogICAgICAgdmVydGV4KDAsaGVpZ2h0LzIpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgMCk7CiAqICAgICAgIHZlcnRleCh3aWR0aCwgaGVpZ2h0LzIpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgaGVpZ2h0KTsKICogICAgICAgZW5kKHRydWUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIGVuZH0KICogQHNlZSB7QGxpbmsgdmVydGV4fQogKi8KZnVuY3Rpb24gc3RhcnQoKSB7CiAgaWYgKF9fY3R4LmxpbmVXaWR0aCAlIDIgPT09IDEpIHsKICAgIF9fY3R4LnRyYW5zbGF0ZSgwLjUsIDAuNSk7CiAgfQogIF9fY3R4LmJlZ2luUGF0aCgpOwogIF9fZmlyc3QgPSBmYWxzZTsKfQoKLyoqCiAqIERyYXcgc29tZSB0ZXh0IHRvIHRoZSBzY3JlZW4uIEl0cyBwbGFjZW1lbnQgaXMKICogZGV0ZXJtaW5lZCBieSBib3RoIHRoZSBjb29yZGluYXRlIHByb3ZpZGVkLCBhbmQKICogdGhlIHgveSBhbGlnbm1lbnQgcHJvdmlkZWQuIFZhbGlkIGB4QWxpZ25gIHZhbHVlcwogKiBhcmU6CiAqCiAqIC0gQ0VOVEVSIC0gdGhlIHRleHQgYW5jaG9yIGlzIGluIHRoZSBtaWRkbGUgb2YgdGhlIHRleHQuIFRleHQgaXMgcGxhY2VkIGV2ZW5seSBvbiBlaXRoZXIgc2lkZS4KICogLSBFTkQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIHJpZ2h0IGZvciBMVFIgdGV4dCwgYW5kIG9uIHRoZSBsZWZ0IGZvciBSVEwgdGV4dC4KICogLSBMRUZUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIHRleHQuIGFsbCB0ZXh0IGlzIHRvIHRoZSByaWdodC4KICogLSBSSUdIVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgdGV4dC4gQWxsIHRleHQgaXMgdG8gdGhlIGxlZnQuCiAqIC0gU1RBUlQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIGxlZnQgZm9yIExUUiB0ZXh0LCBhbmQgb24gdGhlIHJpZ2h0IGZvciBSVEwgdGV4dC4KICoKICogVmFsaWQgYHlBbGlnbmAgdmFsdWVzIGFyZToKICoKICogLSBBTFBIQUJFVElDIC0gc3RhbmRhcmQgdGV4dCBhbGlnbm1lbnQKICogLSBCT1RUT00gLSB0aGUgdGV4dCBpcyBhbGlnbmVkIHRvIHRoZSBib3R0b20gb2YgdGhlIGJvdW5kaW5nIGJveAogKiAtIEhBTkdJTkcgLSByZWxldmFudCBmb3IgVGliZXRhbiBhbmQgb3RoZXIgSW5kaWMgc2NyaXB0cy4KICogLSBJREVPR1JBUEhJQyAtIHJlbGV2YW50IGZvciBpZGVvZ3JhcGhpYyBDSktWIHRleHQuCiAqIC0gTUlERExFIC0gVGhlIHZlcnRpY2FsIGVxdWl2YWxlbnQgb2YgImNlbnRlciIuCiAqIC0gVE9QIC0gVGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgdG9wIG9mIHRoZSB0eXBvZ3JhcGhpYyAiZW0gc3F1YXJlIi4KICoKICogTm90ZSB0aGF0IHRoZSBwcmltYXJ5IHRleHQgY29sb3VyIHVzZXMgdGhlIGZpbGwgY29sb3VyLiBJZiB0ZXh0CiAqIHN0cm9raW5nIGlzIGVuYWJsZWQsIHRoZSB0aGUgdGV4dCBvdXRsaW5lIHdpbGwgYmUgY29sb3VyZWQgdXNpbmcKICogdGhlIGN1cnJlbnQgc3Ryb2tlIGNvbG91ci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KCJub3JtYWwgdGV4dCIsIHdpZHRoLzIsIDYwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKDEpOwogKiAgICAgICB0ZXh0KCJ1bmZpbGxlZCB0ZXh0Iiwgd2lkdGgvMiwgMTAwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICAgIHNldFN0cm9rZShgcmVkYCk7CiAqICAgICAgIHNldEZpbGwoYHllbGxvd2ApOwogKiAgICAgICB0ZXh0KCJmYW5jeSB0ZXh0Iiwgd2lkdGgvMiwgMTQwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgdGV4dCB3ZSB3YW50IHRvIHNob3cKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHRleHQgbG9jYXRpb24ncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSB0ZXh0IGxvY2F0aW9uJ3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge3N0cmluZ30geEFsaWduPyBBbiBvcHRpb25hbCBob3Jpem9udGFsIGFsaWdubWVudCBzdHJpbmcKICogQHBhcmFtIHtzdHJpbmd9IHlBbGlnbj8gQW4gb3B0aW9uYWwgdmVydGljYWwgIGFsaWdubWVudCBzdHJpbmcKICoKICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgdGV4dCB3ZSB3YW50IHRvIHNob3cKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHRleHQgbG9jYXRpb24ncyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7c3RyaW5nfSB4QWxpZ24/IEFuIG9wdGlvbmFsIGhvcml6b250YWwgYWxpZ25tZW50IHN0cmluZwogKiBAcGFyYW0ge3N0cmluZ30geUFsaWduPyBBbiBvcHRpb25hbCB2ZXJ0aWNhbCAgYWxpZ25tZW50IHN0cmluZwogKgogKiBAc2VlIHtAbGluayBzZXRUZXh0U3Ryb2tlfQogKi8KZnVuY3Rpb24gdGV4dChzdHIsIHgsIHksIHhBbGlnbiwgeUFsaWduKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5QWxpZ24gPSB4QWxpZ247CiAgICB4QWxpZ24gPSB5OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBzYXZlKCk7CiAgaWYgKHhBbGlnbikgewogICAgc2V0VGV4dEFsaWduKHhBbGlnbiwgeUFsaWduKTsKICB9CiAgX19jdHguZmlsbFRleHQoc3RyLCB4LCB5KTsKICBpZiAoX190ZXh0U3Ryb2tlKSB7CiAgICBzZXRTdHJva2UoX190ZXh0U3Ryb2tlKTsKICAgIF9fY3R4LnN0cm9rZVRleHQoc3RyLCB4LCB5KTsKICB9CiAgcmVzdG9yZSgpOwp9CgovKioKICogRHJhdyBhIHRyaWFuZ2xlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHRyaWFuZ2xlKHdpZHRoLzIsIDMwLCAxLzQgKiB3aWR0aCwgMTYwLCAzLzQgKiB3aWR0aCwgMTEwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geDEgVGhlIGZpcnN0IHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTEgVGhlIGZpcnN0IHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geDIgVGhlIHNlY29uZCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkyIFRoZSBzZWNvbmQgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB4MyBUaGUgdGhpcmQgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MyBUaGUgdGhpcmQgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMSBUaGUgZmlyc3QgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMiBUaGUgc2Vjb25kIHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDMgVGhlIHRoaXJkIHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKi8KZnVuY3Rpb24gdHJpYW5nbGUoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykgewogIGlmICh4MS54ICE9PSB1bmRlZmluZWQgJiYgeDEueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5MyA9IHgyLnk7CiAgICB4MyA9IHgyLng7CiAgICB5MiA9IHkxLnk7CiAgICB4MiA9IHkxLng7CiAgICB5MSA9IHgxLnk7CiAgICB4MSA9IHgxLng7CiAgfQoKICBzdGFydCgpOwogIHZlcnRleCh4MSwgeTEpOwogIHZlcnRleCh4MiwgeTIpOwogIHZlcnRleCh4MywgeTMpOwogIHZlcnRleCh4MSwgeTEpOwogIGVuZCgpOwp9CgovKioKICogQWRkIGEgdmVydGV4IHRvIHRoZSBjdXJyZW50bHkgYWN0aXZlIHNoYXBlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHN0YXJ0KCk7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCAzMCk7CiAqICAgICAgIHZlcnRleCgxLzQgKiB3aWR0aCwgMTYwKTsKICogICAgICAgdmVydGV4KDMvNCAqIHdpZHRoLCAxMTApOwogKiAgICAgICBlbmQoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgdmVydGV4J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgdmVydGV4J3MgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgdmVydGV4IHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgZW5kfQogKiBAc2VlIHtAbGluayBzdGFydH0KICovCmZ1bmN0aW9uIHZlcnRleCh4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgaWYgKF9fZmlyc3QpIHsKICAgIF9fY3R4LmxpbmVUbyh4LCB5KTsKICB9IGVsc2UgewogICAgX19maXJzdCA9IHsgeCwgeSB9OwogICAgX19jdHgubW92ZVRvKHgsIHkpOwogIH0KfQovKioKICogQ3JlYXRlIGFuIGFycmF5IG9mIHNwZWNpZmllZCBsZW5ndGgsIG9wdGlvbmFsbHkgZmlsbGVkIHVzaW5nIGEKICogdGhhdCB0YWtlcyBhbiBpbmRleCBhcyBzaW5nbGUgaW5wdXQgYXJndW1lbnQgZnVuY3Rpb24uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHRyYW5zbGF0ZSgwLCBoZWlnaHQvMik7CiAqICAgICAgIGxldCBkYXRhID0gYXJyYXkod2lkdGgsIChpKSA9PiBbaSwgaGVpZ2h0LzIgKiBzaW4oaS8yNSldKTsKICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAqICAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggVGhlIHNpemUgb2YgdGhlIGFycmF5IHlvdSB3YW50CiAqIEBwYXJhbSB7ZnVuY3Rpb259IGZpbGxGdW5jdGlvbj8gVGhlIG9wdGlvbmFsIGZ1bmN0aW9uIHRoYXQgZ2V0cyB1c2VkIHRvIGZpbGwgdGhlIGFycmF5CiAqLwpmdW5jdGlvbiBhcnJheShsZW4sIGZpbGxGdW5jdGlvbikgewogIGNvbnN0IGFyciA9IG5ldyBBcnJheShsZW4pLmZpbGwoKTsKICBpZiAoZmlsbEZ1bmN0aW9uKSB7CiAgICByZXR1cm4gYXJyLm1hcCgoXywgaSkgPT4gZmlsbEZ1bmN0aW9uKGkpKTsKICB9CiAgcmV0dXJuIGFycjsKfQoKLyoqCiAqIEVtcHR5IHRoZSBsaXN0IG9mIG1vdmFibGUgcG9pbnRzIGluIHlvdXIgZ3JhcGhpYy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRCdXR0b24oYGxvY2tgLCAoKSA9PiB7CiAqICAgICAgICAgY2xlYXJNb3ZhYmxlKCk7CiAqICAgICAgICAgcmVkcmF3KCk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGZvcihsZXQgcCBvZiBwb2ludHMpIHsKICogICAgICAgICBzZXRDb2xvcihpc01vdmFibGUocCkgPyBgcmVkYCA6IGBncmV5YCk7CiAqICAgICAgICAgcG9pbnQocCk7CiAqICAgICAgIH0KICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgseSkgewogKiAgICAgICBpZiAoY3VycmVudFBvaW50KSByZXR1cm47CiAqICAgICAgIGNvbnN0IHAgPSBuZXcgUG9pbnQoeCx5KTsKICogICAgICAgcG9pbnRzLnB1c2gocCk7CiAqICAgICAgIHNldE1vdmFibGUocCk7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIGlzTW92YWJsZX0KICogQHNlZSB7QGxpbmsgc2V0TW92YWJsZX0KICovCmZ1bmN0aW9uIGNsZWFyTW92YWJsZSgpIHsKICBfX21vdmFibGVfcG9pbnRzLnNwbGljZSgwLCBfX21vdmFibGVfcG9pbnRzLmxlbmd0aCk7Cn0KCi8qKgogKiBDcmVhdGUgYSBjb3B5IG9mIHRoZSBjdXJyZW50IGNhbnZhcyBlbGVtZW50CiAqIGZvciB1c2Ugc29tZXdoZXJlIGVsc2UgaW4geW91ciBvd24gY29kZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBwaW5rYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bih4LHkpIHsKICogICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCgKICogICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoYGdyYXBoaWNzOnVwZGF0ZWAsIHsKICogICAgICAgICAgIGRldGFpbDogewogKiAgICAgICAgICAgICBjYW52YXM6IGNvcHkoKQogKiAgICAgICAgICAgfQogKiAgICAgICAgIH0pCiAqICAgICAgICk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge0hUTUxDYW52YXNFbGVtZW50fSBBIGNvcHkgb2YgdGhlIGN1cnJlbnQgY2FudmFzCiAqLwpmdW5jdGlvbiBjb3B5KCkgewogIGNvbnN0IGNvcHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBjYW52YXNgKTsKICBjb3B5LndpZHRoID0gd2lkdGg7CiAgY29weS5oZWlnaHQgPSBoZWlnaHQ7CiAgY29uc3QgY3R4ID0gY29weS5nZXRDb250ZXh0KGAyZGApOwogIGN0eC5kcmF3SW1hZ2UoX19jYW52YXMsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogIHJldHVybiBjb3B5Owp9CgovKioKICogR2VuZXJhdGVzIGEgY29sb3IgYmFzZWQgb24gdGhlIEhTTCBjb2xvciBzcGFjZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGNvbG9yKDQ1LCA4MCwgOTApKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gaHVlIGluIHRoZSByYW5nZSBbMCwgMzYwXQogKiBAcGFyYW0ge251bWJlcn0gc2F0dXJhdGlvbiBpbiB0aGUgcmFuZ2UgWzAsIDEwMF0KICogQHBhcmFtIHtudW1iZXJ9IGxpZ2h0bmVzcyBpbiB0aGUgcmFuZ2UgWzAsIDEwMF0KICogQHBhcmFtIHtudW1iZXJ9IG9wYWNpdHkgaW4gdGhlIHJhbmdlIFswLCAxXQogKiBAcmV0dXJucyB7c3RyaW5nfSBBIENTUyBoc2xhIGNvbG9yIHN0cmluZwogKgogKiBAc2VlIHtAbGluayByYW5kb21Db2xvcn0KICovCmZ1bmN0aW9uIGNvbG9yKGggPSBfX2N1cnJlbnRfaHVlLCBzID0gNTAsIGwgPSA1MCwgYSA9IDEpIHsKICByZXR1cm4gYGhzbGEoJHtofSwke3N9JSwke2x9JSwke2F9KWA7Cn0KCi8qKgogKiBGaW5kIGFuIEhUTUwgZWxlbWVudCBpbnNpZGUgeW91ciBncmFwaGljcy1lbGVtZW50CiAqIGJ5IHF1ZXJ5IHNlbGVjdG9yLiBUaGlzIGlzIGVxdWl2YWxlbnQgdG86CiAqCiAqIGBgYAogKiB5b3VyRWxlbWVudC5xdWVyeVNlbGVjdG9yKHFzKQogKiBgYGAKICoKICogQHBhcmFtIHtzdHJpbmd9IHF1ZXJ5U2VsZWN0b3IgQSBxdWVyeSBzZWxlY3RvcgogKiBAcmV0dXJucyB7SFRNTEVsZW1lbnR8bnVsbH0gVGhlIG1hdGNoZWQgZWxlbWVudCwgb3IgbnVsbCBpZiB0aGVyZSB3YXMgbm8gbWF0Y2guCiAqLwpmdW5jdGlvbiBmaW5kKHFzKSB7CiAgcmV0dXJuIF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKHFzKTsKfQoKLyoqCiAqIEZpbmQgYWxsIEhUTUwgZWxlbWVudHMgaW5zaWRlIHlvdXIgZ3JhcGhpY3MtZWxlbWVudAogKiB0aGF0IG1hdGNoIGEgZ2l2ZW4gcXVlcnkgc2VsZWN0b3IuIFRoaXMgaXMgZXF1aXZhbGVudCB0bzoKICoKICogYGBgCiAqIHlvdXJFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocXMpCiAqIGBgYAogKgogKiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBkb2VzIF9ub3RfIHJldHVybiBhIE5vZGVMaXN0CiAqIGFuZCBpbnN0ZWFkIHJldHVybnMgYSBwbGFpbiBhcnJheS4KICoKICogQHBhcmFtIHtzdHJpbmd9IHF1ZXJ5U2VsZWN0b3IgQSBxdWVyeSBzZWxlY3RvcgogKiBAcmV0dXJucyB7SFRNTEVsZW1lbnRbXX0gQW4gYXJyYXkgd2l0aCBhbGwgbWF0Y2hpbmcgZWxlbWVudHMsIFtdIGlmIHRoZXJlIHdlcmUgbm8gbWF0Y2hlcy4KICovCmZ1bmN0aW9uIGZpbmRBbGwocXMpIHsKICByZXR1cm4gWy4uLl9fZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHFzKV07Cn0KCi8qKgogKiBNYXJrIGEgc3BlY2lmaWMgY29sb3IgYXMgdGhlIGhpZ2hsaWdodCBjb2xvciwKICogd2hpY2ggY2F1c2VzIHRoZSBncmFwaGljIHRvIHJlZHJhdyB3aXRoIHRoYXQKICogY29sb3IgcmVwbGFjZWQgYnkgd2hpY2hldmVyIGNvbG9yIHlvdSBwaWNrZWQKICogYXMgaGlnaGxpZ2h0IGNvbG9yLgogKgogKiBOb3RlIHRoYXQgeW91IGNhbiBvbmx5IHVzZSBuYW1lZCAoQ1NTKSBjb2xvcnMKICogd2l0aCB0aGlzIGZ1bmN0aW9uLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRIaWdobGlnaHRDb2xvcihgbGltZWApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHRleHQoImxldCdzIGdvIiwgd2lkdGgvMiwgaGVpZ2h0LzIpCiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyQWN0aXZlKHN0YXRlKSB7CiAqICAgICAgIGlmIChzdGF0ZSkgaGlnaGxpZ2h0KGByZWRgKTsKICogICAgICAgZWxzZSBoaWdobGlnaHQoZmFsc2UpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Y29sb3J8Ym9vbGVhbn0gY29sb3IgU2V0IHRoZSBjb2xvciB0aGF0IHNob3VsZCBnZXQgcmVwbGFjZWQgd2l0aCB0aGUgaGlnaGxpZ2h0IGNvbG9yLCBvciBkaXNhYmxlIGhpZ2hsaWdodCB3aGVuIGNvbG9yIGlzIGBmYWxzZWAKICoKICogQHNlZSB7QGxpbmsgc2V0SGlnaGxpZ2h0Q29sb3J9CiAqLwpmdW5jdGlvbiBoaWdobGlnaHQoY29sb3IpIHsKICBpZiAoQ1NTX0NPTE9SX01BUFtjb2xvcl0pIHsKICAgIF9faGlnaGxpZ2h0X2NvbG9yID0gQ1NTX0NPTE9SX01BUFtjb2xvcl07CiAgfSBlbHNlIHsKICAgIF9faGlnaGxpZ2h0X2NvbG9yID0gY29sb3I7CiAgfQogIHJlZHJhdygpOwp9CgovKioKICogQ2hlY2sgd2hldGhlciBhIHBvaW50IGlzIHJlZ2lzdGVyZWQgYXMgbW92YWJsZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRCdXR0b24oYGxvY2tgLCAoKSA9PiB7CiAqICAgICAgICAgY2xlYXJNb3ZhYmxlKCk7CiAqICAgICAgICAgcmVkcmF3KCk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGZvcihsZXQgcCBvZiBwb2ludHMpIHsKICogICAgICAgICBzZXRDb2xvcihpc01vdmFibGUocCkgPyBgcmVkYCA6IGBncmV5YCk7CiAqICAgICAgICAgcG9pbnQocCk7CiAqICAgICAgIH0KICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgseSkgewogKiAgICAgICBpZiAoY3VycmVudFBvaW50KSByZXR1cm47CiAqICAgICAgIGNvbnN0IHAgPSBuZXcgUG9pbnQoeCx5KTsKICogICAgICAgcG9pbnRzLnB1c2gocCk7CiAqICAgICAgIHNldE1vdmFibGUocCk7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBUaGUgcG9pbnQgdGhhdCB3ZSB3YW50IHRvIGNoZWNrICJtb3ZhYmlsaXR5IiBmb3IKICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgb3VyIHBvaW50IGlzIGluIHRoZSBsaXN0IG9mIG1vdmFibGUgcG9pbnRzLCBvdGhlcndpc2UgZmFsc2UKICoKICogQHNlZSB7QGxpbmsgY2xlYXJNb3ZhYmxlfQogKiBAc2VlIHtAbGluayBzZXRNb3ZhYmxlfQogKi8KZnVuY3Rpb24gaXNNb3ZhYmxlKHBvaW50KSB7CiAgcmV0dXJuIF9fbW92YWJsZV9wb2ludHMuaW5jbHVkZXMocG9pbnQpOwp9CgovKioKICogR2V0IHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRoYXQgdGhpcwogKiBncmFwaGljIGhhcyBiZWVuIHJ1bm5pbmcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIGNvbnN0IHNlY29uZHMgPSAobWlsbGlzKCkvMTAwMCl8MDsKICogICAgICAgdGV4dChgJHtzZWNvbmRzfXNgLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcmV0dXJucyB7bnVtYmVyfSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHNpbmNlIHRoZSBncmFwaGljIGxvYWRlZCBpbgogKi8KZnVuY3Rpb24gbWlsbGlzKCkgewogIHJldHVybiBEYXRlLm5vdygpIC0gX19zdGFydF90aW1lOwp9CgovKioKICogUGF1c2UgdGhlIGdyYXBoaWMgaWYgaXRzIGN1cnJlbnRseSBwbGF5aW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBjb25zdCBzZWNvbmRzID0gKG1pbGxpcygpLzEwMDApLnRvRml4ZWQoMSk7CiAqICAgICAgIHRleHQoYCR7c2Vjb25kc31zYCwgd2lkdGgvMiwgaGVpZ2h0LzIpCiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyQWN0aXZlKHN0YXRlKSB7CiAqICAgICAgIGlmKHN0YXRlKSB7CiAqICAgICAgICAgcGF1c2UoKTsKICogICAgICAgfSBlbHNlIHsKICogICAgICAgICBwbGF5KCk7CiAqICAgICAgIH0KICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBwbGF5fQogKiBAc2VlIHtAbGluayB0b2dnbGVQbGF5fQogKi8KZnVuY3Rpb24gcGF1c2UoKSB7CiAgcGxheWluZyA9IGZhbHNlOwp9CgovKioKICogU3RhcnQgcGxheWluZyB5b3VyIGdyYXBoaWMsIG1lYW5pbmcgaXQgd2lsbCBjYWxsIGRyYXcoKQogKiBhdCB3aGF0ZXZlciByYXRlIHRoZSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgbG9vcCBpcwogKiBhbGxvd2VkIHRvIHJ1biBvbiB5b3VyIGNvbXB1dGVyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgbGV0IGZwcyA9IDA7CiAqICAgICBsZXQgY2hlY2tlZCA9IGZhbHNlOwogKiAgICAgbGV0IGxhc3RGcmFtZUNoZWNrID0gMDsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKS50b0ZpeGVkKDEpOwogKiAgICAgICB0ZXh0KGBmcHM6ICR7ZnBzfWAsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgICBpZiAoc2Vjb25kcy5lbmRzV2l0aChgLjBgKSkgewogKiAgICAgICAgIGlmICghY2hlY2tlZCkgewogKiAgICAgICAgICAgY2hlY2tlZCA9IHRydWU7CiAqICAgICAgICAgICBmcHMgPSBmcmFtZSAtIGxhc3RGcmFtZUNoZWNrOwogKiAgICAgICAgICAgbGFzdEZyYW1lQ2hlY2sgPSBmcmFtZTsKICogICAgICAgICB9CiAqICAgICAgIH0gZWxzZSB7CiAqICAgICAgICAgY2hlY2tlZCA9IGZhbHNlOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgcGF1c2V9CiAqIEBzZWUge0BsaW5rIHRvZ2dsZVBsYXl9CiAqLwpmdW5jdGlvbiBwbGF5KCkgewogIHBsYXlpbmcgPSB0cnVlOwogIF9fZHJhdygpOwp9CgovKioKICogR2VuZXJhdGUgYSByYW5kb20gY29sb3VyLiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbgogKiBhbGxvd3MgeW91IHRvIGdldCAidGhlIGN1cnJlbnRseSBnZW5lcmF0ZWQgcmFuZG9tCiAqIGNvbG91ciIgaW4gZGlmZmVyZW50IG9wYWNpdGllcyBieSBjYWxsaW5nIHRoZSBmdW5jdGlvbgogKiB3aXRoIGFuIG9wYWNpdHkgdmFsdWUsIGFuZCBgZmFsc2VgIGFzIGN5Y2xlIGFyZ3VtZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIocmFuZG9tQ29sb3IoKSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bigpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICoKICogQHBhcmFtIHtudW1iZXJ9IG9wYWNpdHkgVGhlIG9wYWNpdHkgdmFsdWUgaW4gdGhlIHJhbmdlIFswLDFdCiAqIEBwYXJhbSB7bnVtYmVyfSBjeWNsZT8gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IHRvIG1vdmUgb24gdG8gdGhlIG5leHQgY29sb3VyIChkZWZhdWx0ID0gdHJ1ZSkKICoKICogQHNlZSB7QGxpbmsgY29sb3J9CiAqLwpmdW5jdGlvbiByYW5kb21Db2xvcihhID0gMS4wLCBjeWNsZSA9IHRydWUpIHsKICBpZiAoY3ljbGUpIF9fY3VycmVudF9odWUgPSByYW5kb20oMCwgMzYwKTsKICByZXR1cm4gYGhzbGEoJHtfX2N1cnJlbnRfaHVlfSw1MCUsNTAlLCR7YX0pYDsKfQoKLyoqCiAqIEFuIGFsdGVybmF0aXZlIHRvIHdyaXRpbmcgZm9yIGxvb3BzLCBiZWNhdXNlCiAqIG5vIG9uZSB3YW50cyB0byBjb25zdGFudGx5IHdyaXRlIHZhciBhbGxvY2F0aW9ucwogKiB0aGF0IG9ubHkgbGl2ZSBmb3IgdGhlIGR1cmF0aW9uIG9mIGEgbG9vcC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICByYW5nZSgwLCBUQVUsIChhKSA9PiBwb2ludCg0MCAqIGNvcyhhKSwgNDAgKiBzaW4oYSkpKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgVGhlIGVxdWl2YWxlbnQgb2YgYSBmb3IgbG9vcCdzIGluaXRpYWwgYGxldCBpID0gLi4uYAogKiBAcGFyYW0ge251bWJlcn0gZW5kIFRoZSBlcXVpdmFsZW50IG9mIGEgZm9yIGxvb3AncyBgaSA8IGVuZGAKICogQHBhcmFtIHtudW1iZXJ9IHN0ZXA/IFRoZSBzdGVwIHNpemUgYnkgd2hpY2ggdG8gaW5jcmVtZW50IGF0IGVhY2ggaXRlcmF0aW9uIChkZWZhdWx0cyA9IGAoc3RhcnQtZW5kKS8xMGApCiAqIEBwYXJhbSB7ZnVuY3Rpb259IHJ1bkZ1bmN0aW9uIFRoZSBmdW5jdGlvbiB0byBydW4gYXQgZWFjaCBpdGVyYXRpb24KICovCmZ1bmN0aW9uIHJhbmdlKHN0YXJ0LCBlbmQsIHN0ZXAsIHJ1bkZ1bmN0aW9uKSB7CiAgaWYgKHR5cGVvZiBzdGVwID09PSBgZnVuY3Rpb25gKSB7CiAgICBydW5GdW5jdGlvbiA9IHN0ZXA7CiAgICBzdGVwID0gKGVuZCAtIHN0YXJ0KSAvIDEwOwogIH0KICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkgKz0gc3RlcCkgewogICAgcnVuRnVuY3Rpb24oaSk7CiAgfQp9CgovKioKICogU2FmZWx5IHRyaWdnZXIgYSBuZXcgZHJhdyBwYXNzLiBJZiB0aGUgZ3JhcGhpYyBpcyBydW5uaW5nCiAqIGluIGFuaW1hdGVkIG1vZGUsIG9yIGEgcmVkcmF3KCkgaXMgdHJpZ2dlcmVkIF9kdXJpbmdfIGEKICogcmVkcmF3KCksIHRoaXMgY2FsbCB3aWxsIGRvIG5vdGhpbmcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjb25zdCBoID0gbWFwKHBvaW50ZXIueCwgMCwgd2lkdGgsIDAsIDM2MCk7CiAqICAgICAgIGNvbnN0IGwgPSBtYXAocG9pbnRlci55LCAwLCBoZWlnaHQsIDUwLCAwKTsKICogICAgICAgY2xlYXIoY29sb3IoaCwgMTAwLCBsKSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSgpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIHJlZHJhdygpIHsKICBpZiAoX19yZWRyYXdpbmcpIHJldHVybjsKICBpZiAocGxheWluZykgcmV0dXJuOwogIF9fcmVkcmF3aW5nID0gdHJ1ZTsKICBfX2RyYXcoKTsKICBfX3JlZHJhd2luZyA9IGZhbHNlOwp9CgovKioKICogUmVzdG9yZSB0aGUgZ3JhcGhpY3MgY29udGV4dCAodHJhbnNmb3JtcywKICogY3VycmVudCBjb2xvcnMsIGV0YykgdG8gd2hhdCB0aGV5IHdlcmUKICogd2hlbiBzYXZlKCkgd2FzIGNhbGxlZC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZSgwLDAsODAsMCk7CiAqICAgICAgIHNhdmUoKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApCiAqICAgICAgIHJhbmdlKDAsIDUsIDEsIChhKSA9PiB7CiAqICAgICAgICAgcm90YXRlKFBJLzgpOwogKiAgICAgICAgIGxpbmUoMCwwLDgwLDApOwogKiAgICAgICB9KTsKICogICAgICAgcmVzdG9yZSgpOwogKiAgICAgICBsaW5lKC0yMCwwLC04MCwwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzYXZlfQogKi8KZnVuY3Rpb24gcmVzdG9yZSgpIHsKICBfX2N0eC5yZXN0b3JlKCk7Cn0KCi8qKgogKiBNYXJrIG9uZSBvciBtb3JlIHBvaW50cyBhcyBtb3ZhYmxlLCBtZWFuaW5nCiAqIHRoYXQgdGhlIHVzZXIgY2FuIHJlcG9zaXRpb24gdGhlIHBvaW50IGFyb3VuZCBvbgogKiB0aGUgY2FudmFzIGJ5IHRvdWNoL2NsaWNrLWRyYWdnaW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGZvciAobGV0IGkgPSA0MDsgaSA8IDIwMDsgaSArPSAyMCkgewogKiAgICAgICAgIHBvaW50cy5wdXNoKG5ldyBQb2ludChpIC0gMjAsIDEyMCkpOwogKiAgICAgICB9CiAqICAgICAgIHNldE1vdmFibGUoLi4ucG9pbnRzKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICBzZXRTdHJva2UoYHB1cnBsZWApOwogKiAgICAgICBic3BsaW5lKC4uLnBvaW50cyk7CiAqICAgICAgIGZvcihsZXQgcCBvZiBwb2ludHMpIHBvaW50KHApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlW25dfSBwb2ludHMgT25lIG9yIG1vcmUgcG9pbnRzIHRvIG1hcmsgYXMgbW92YWJsZS4KICoKICogQHNlZSB7QGxpbmsgaXNNb3ZhYmxlfQogKiBAc2VlIHtAbGluayBjbGVhck1vdmFibGV9CiAqLwpmdW5jdGlvbiBzZXRNb3ZhYmxlKC4uLnBvaW50cykgewogIHBvaW50cy5mb3JFYWNoKChwKSA9PiB7CiAgICBpZiAoX19tb3ZhYmxlX3BvaW50cy5pbmRleE9mKHApID09PSAtMSkgewogICAgICBfX21vdmFibGVfcG9pbnRzLnB1c2gocCk7CiAgICB9CiAgfSk7Cn0KCi8qKgogKiBTZXQgKG9yIGNoYW5nZSkgdGhlIGdyYXBoaWMncyBzaXplLiBOb3RlIHRoYXQgeW91ciB3aWR0aAogKiBhbmQgaGVpZ2h0IHZhbHVlcyB3aWxsIGdldCByb3VuZGVkIHRvIGludGVnZXIgdmFsdWVzLgogKgogKiBOb3RlIHRoYXQgYHNldFNpemVgIHdpbGwgaW1tZWRpYXRlbHkgdHJpZ2dlciBhIHJlZHJhdywKICogd2hldGhlciB5b3Ugd2FudCBpdCB0byBvciBub3QsIGJlY2F1c2UgY2hhbmdpbmcgY2FudmFzCiAqIGRpbWVuc2lvbnMgY2xlYXJzIHRoZSBjYW52YXMsIG5lY2Vzc2l0YXRpbmcgYSByZWRyYXcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSg0MDAsIDIwMCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBjZW50ZXIoKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCkKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KGAke3dpZHRofS8ke2hlaWdodH1gLCAwLCAwLCBDRU5URVIsIE1JRERMRSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyVXAoKSB7CiAqICAgICAgIHNldFNpemUocmFuZG9tKDEwMCw0MDApLCAyMDApOwogKiAgICAgICAvLyBOb3RlIHRoYXQgdGhlcmUgaXMgbm8gcmVkcmF3KCkgaGVyZSEKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gd2lkdGggVGhlIGdyYXBoaWNzIHdpZHRoIGluIHBpeGVscwogKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IFRoZSBncmFwaGljcyBoZWlnaHQgaW4gcGl4ZWxzCiAqLwpmdW5jdGlvbiBzZXRTaXplKHcgPSA0MDAsIGggPSAyMDApIHsKICB3aWR0aCA9IF9fY2FudmFzLndpZHRoID0gdyB8IDA7CiAgaGVpZ2h0ID0gX19jYW52YXMuaGVpZ2h0ID0gaCB8IDA7CiAgX19lbGVtZW50LnN0eWxlLm1heFdpZHRoID0gYGNhbGMoMmVtICsgJHt3aWR0aH1weGA7CiAgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwogIF9fZHJhdygpOwp9CgovKioKICogU2F2ZSB0aGUgY3VycmVudCBncmFwaGljcyBjb250ZXh0ICh0cmFuc2Zvcm1zLAogKiBjdXJyZW50IGNvbG9ycywgZXRjKSBzbyB0aGF0IHRob3NlIGNhbiBiZSByZXN0b3JlZAogKiBhZnRlciBjaGFuZ2luZyB0aGVtLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICBsaW5lKDAsMCw4MCwwKTsKICogICAgICAgc2F2ZSgpOwogKiAgICAgICBzZXRDb2xvcihgZGFya2dyZWVuYCkKICogICAgICAgcmFuZ2UoMCwgNSwgMSwgKGEpID0+IHsKICogICAgICAgICByb3RhdGUoUEkvOCk7CiAqICAgICAgICAgbGluZSgwLDAsODAsMCk7CiAqICAgICAgIH0pOwogKiAgICAgICByZXN0b3JlKCk7CiAqICAgICAgIGxpbmUoLTIwLDAsLTgwLDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqICogQHNlZSB7QGxpbmsgcmVzdG9yZX0KICovCmZ1bmN0aW9uIHNhdmUoKSB7CiAgX19jdHguc2F2ZSgpOwp9CgovKioKICogQ29udmVydCB0aGUgY3VycmVudCBjYW52YXMgaW50byBhbiBkYXRhIFVSTAogKiB0aGF0IHJlcHJlc2VudHMgYSBQTkcgaW1hZ2UuCiAqCiAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBjdXJyZW50IGNhbnZhcyBhcyBQTkcgZGF0YSBVUkwKICovCmZ1bmN0aW9uIHRvRGF0YVVSTCgpIHsKICByZXR1cm4gX19jYW52YXMudG9EYXRhVVJMKCk7Cn0KCi8qKgogKiBJZiB0aGUgZ3JhcGhpYyBpcyBjdXJyZW50bHkgcGxheWluZywgcGF1c2UgaXQsCiAqIGFuZCBpZiBpdCdzIHBhdXNlZCwgcGxheSBpdC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKS50b0ZpeGVkKDEpOwogKiAgICAgICB0ZXh0KGAke3NlY29uZHN9c2AsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICB0b2dnbGVQbGF5KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge2Jvb2xlYW59IFRoZSBuZXcgcGxheSBzdGF0ZQogKgogKiBAc2VlIHtAbGluayBwYXVzZX0KICogQHNlZSB7QGxpbmsgcGxheX0KICovCmZ1bmN0aW9uIHRvZ2dsZVBsYXkoKSB7CiAgcGxheWluZyA/IHBhdXNlKCkgOiBwbGF5KCk7CiAgcmV0dXJuIHBsYXlpbmc7Cn0KY29uc3QgewogIC8qKgogICAqIEdldCB0aGUgYWJzb2x1dGUgdmFsdWUgZm9yIHNvbWUgaW5wdXQKICAgKgogICAqIEV4YW1wbGU6CiAgICoKICAgKiA8Z3JhcGhpY3MtZWxlbWVudD4KICAgKiAgIDxncmFwaGljcy1zb3VyY2U+CiAgICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAgICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAgICogICAgICAgdHJhbnNsYXRlKDAsIGhlaWdodC8yKTsKICAgKiAgICAgICBub0ZpbGwoKTsKICAgKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAgICogICAgICAgbGluZSgtaHVnZSwgMCwgaHVnZSwgMCk7CiAgICoKICAgKiAgICAgICBjb25zdCB3MiA9IHdpZHRoLzI7CiAgICogICAgICAgY29uc3QgZGF0YSA9IGFycmF5KHdpZHRoLCAoeCkgPT4gW3gsIHggLSB3MiwgYWJzKHggLSB3MildKTsKICAgKgogICAqICAgICAgIHNldFN0cm9rZShgcmVkYCk7CiAgICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAgICoKICAgKiAgICAgICBzZXRTdHJva2UoYGJsdWVgKTsKICAgKiAgICAgICBwbG90RGF0YShkYXRhLCAwLCAyKTsKICAgKiAgICAgfQogICAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAgICogPC9ncmFwaGljcy1lbGVtZW50PgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IHYgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnB1dCB2YWx1ZSB3aXRoIGl0cyBzaWduIHNldCB0byBwb3NpdGl2ZQogICAqLwogIGFicywKCiAgLyoqCiAgICogVGhlIGludmVyc2UgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gdiBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludmVyc2UgY29zaW5lIG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBhc2lufQogICAqIEBzZWUge0BsaW5rIGFjb3NofQogICAqLwogIGFjb3MsCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGludmVyc2UgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIGNvc2luZQogICAqCiAgICogQHNlZSB7QGxpbmsgYXNpbmh9CiAgICogQHNlZSB7QGxpbmsgYWNvc30KICAgKi8KICBhY29zaCwKCiAgLyoqCiAgICogVGhlIGludmVyc2Ugc2luZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIGludmVyc2Ugc2luZQogICAqCiAgICogQHNlZSB7QGxpbmsgYWNvc30KICAgKiBAc2VlIHtAbGluayBhc2luaH0KICAgKi8KICBhc2luLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIHNpbmUgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnNlX2h5cGVyYm9saWNfZnVuY3Rpb25zI0RlZmluaXRpb25zX2luX3Rlcm1zX29mX2xvZ2FyaXRobXMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBoeXBlcmJvbGljIGludmVyc2Ugc2luZQogICAqCiAgICogQHNlZSB7QGxpbmsgYWNvc2h9CiAgICogQHNlZSB7QGxpbmsgYXNpbn0KICAgKi8KICBhc2luaCwKCiAgLyoqCiAgICogVGhlIGludmVyc2UgdGFuZ2VudCBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIGludmVyc2UgdGFuZ2VudAogICAqCiAgICogQHNlZSB7QGxpbmsgdGFufQogICAqLwogIGF0YW4sCgogIC8qKgogICAqIFRoZSAiYXRhbjIiIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQXRhbjIKICAgKgogICAqIEBwYXJhbSB7eX0gaW5wdXQgQW55IG51bWJlcgogICAqIEBwYXJhbSB7eH0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgYXRhbjIgYW5nbGUgZm9yIHRoaXMgbnVtYmVyIHBhaXIKICAgKi8KICBhdGFuMiwKCiAgLyoqCiAgICogVGhlIGh5cGVyYm9saWMgaW52ZXJzZSB0YW5nZW50IGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIHRhbmdlbnQKICAgKgogICAqIEBzZWUge0BsaW5rIHRhbn0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKiBAc2VlIHtAbGluayBhc2luaH0KICAgKi8KICBhdGFuaCwKCiAgLyoqCiAgICogVGhlIGN1YmUgcm9vdCBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIChyZWFsKSBjdWJlIHJvb3Qgb2YgdGhhdCBudW1iZXIKICAgKgogICAqIEBzZWUge0BsaW5rIHNxcnR9CiAgICovCiAgY2JydCwKCiAgLyoqCiAgICogVGhlICJyb3VuZCB1cCB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIiBmdW5jdGlvbi4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBpbnRlZ2VyIHJlc3VsdCBhZnRlciByb3VuZGluZyB1cC4KICAgKgogICAqIEBzZWUge0BsaW5rIGZsb29yfQogICAqIEBzZWUge0BsaW5rIHJvdW5kfQogICAqLwogIGNlaWwsCgogIC8qKgogICAqIEdldCB0aGUgbnVtYmVyIG9mIGxlYWRpbmcgemVybyBiaXRzIGluIHRoZSAzMi1iaXQgYmluYXJ5IHJlcHJlc2VudGF0aW9uIG9mIGEgbnVtYmVyCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgbnVtYmVyIG9mIGxlYWRpbmcgemVybyBiaXRzIGluIHRoZSAzMi1iaXQgYmluYXJ5IHJlcHJlc2VudGF0aW9uIG9mIHRoYXQgbnVtYmVyLgogICAqLwogIGNsejMyLAoKICAvKioKICAgKiBUaGUgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgY29zaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBzaW59CiAgICovCiAgY29zLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBjb3NpbmUgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnNlX2h5cGVyYm9saWNfZnVuY3Rpb25zI0RlZmluaXRpb25zX2luX3Rlcm1zX29mX2xvZ2FyaXRobXMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBoeXBlcmJvbGljIGNvc2luZQogICAqCiAgICogQHNlZSB7QGxpbmsgY29zfQogICAqIEBzZWUge0BsaW5rIGFjb3NofQogICAqLwogIGNvc2gsCgogIC8qKgogICAqIFRoZSBleHBvbmVudCBmdW5jdGlvbiwgdGhhdCBpczogZV54CiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgdmFsdWUgb2YgRSByYWlzZWQgdG8gdGhhdCBudW1iZXIncyBwb3dlcgogICAqCiAgICogQHNlZSB7QGxpbmsgRX0KICAgKi8KICBleHAsCgogIC8qKgogICAqIFRoZSAicm91bmQgZG93biB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIiBmdW5jdGlvbi4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBpbnRlZ2VyIHJlc3VsdCBhZnRlciByb3VuZGluZyBkb3duLgogICAqCiAgICogQHNlZSB7QGxpbmsgY2VpbH0KICAgKiBAc2VlIHtAbGluayByb3VuZH0KICAgKi8KICBmbG9vciwKCiAgLyoqCiAgICogUm91bmQgYSBudW1iZXIgdG8gdGhlIG5lYXJlc3QgMzIgYml0LCByYXRoZXIgdGhhbiB0aGUKICAgKiBzdGFuZGFyZCBKUyA2NCBiaXQsIGZsb2F0aW5nIHBvaW50IHJlcHJlc2VudGF0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIG51bWJlciBhZnRlciByb3VuZGluZyB0byB0aGUgbmVhcmVzdCAzMiBiaXQgZmxvYXRpbmcgcG9pbnQgcmVwcmVzZW50YXRpb24uCiAgICoKICAgKiBAc2VlIHtAbGluayByb3VuZH0KICAgKi8KICBmcm91bmQsCgogIC8qKgogICAqIFRoZSBFdWNsaWRlYW4gaHlwb3RlbnVzZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJbXX0gLi4uaW5wdXQgVHdvIG9yIG1vcmUgbnVtYmVycwogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgaHlwb3RlbnVzZSBnaXZlbiB0aG9zZSBudW1iZXJzLgogICAqLwogIGh5cG90LAoKICAvKioKICAgKiBUaGUgMzIgYml0IGludGVnZXIgbXVsdGlwbGljYXRpb24gZnVuY3Rpb24uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gYSBBbnkgMzIgYml0IGludGVnZXIKICAgKiBAcGFyYW0ge251bWJlcn0gYiBBbnkgMzIgYml0IGludGVnZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIDMyIGJpdCBpbnRlZ2VyIHJlc3VsdCBvZiBhICogYgogICAqLwogIGltdWwsCgogIC8qKgogICAqIFRoZSBuYXR1cmFsIGxvZ2FyaXRobSBmdW5jdGlvbiwgaS5lLiB0aGUgYmFzZS1FIGxvZ2FyaXRobQogICAqCiAgICogKE5vdGUgdGhhdCBpbiBKUyB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCAibG9nIiByYXRoZXIgdGhhbiAibG4iKQogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIG5hdHVyYWwgbG9nYXJpdGhtIG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBFfQogICAqIEBzZWUge0BsaW5rIGxvZ30KICAgKi8KICBsb2c6IGxuLAoKICAvKioKICAgKiBUaGUgImNvbW1vbiBsb2dhcml0aG0iIGZ1bmN0aW9uLCBpLmUuIHRoZSBiYXNlLTEwIGxvZ2FyaXRobS4KICAgKgogICAqIChOb3RlIHRoYXQgaW4gSlMgdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgImxvZzEwIiByYXRoZXIgdGhhbiAibG9nIikKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBjb21tb24gbG9nYXJpdGhtIG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBsbn0KICAgKi8KICBsb2cxMDogbG9nLAoKICAvKioKICAgKiBUaGUgYmluYXJ5IGxvZ2FyaXRobSBmdW5jdGlvbiwgaS5lLiB0aGUgYmFzZS0yIGxvZ2FyaXRobS4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBiYXNlIDIgbG9nYXJpdGhtIG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBsbn0KICAgKiBAc2VlIHtAbGluayBsb2d9CiAgICovCiAgbG9nMiwKCiAgLyoqCiAgICogRmluZCB0aGUgbWF4aW11bSB2YWx1ZSBpbiBhIHNldCBvZiBudW1iZXJzCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gLi4uaW5wdXQgQW55IHR3byBvciAgbW9yZSBudW1iZXJzCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBoaWdoZXN0IHZhbHVlZCBudW1iZXIgZnJvbSBhbW9uZyB0aGUgaW5wdXQuCiAgICoKICAgKiBAc2VlIHtAbGluayBtaW59CiAgICovCiAgbWF4LAoKICAvKioKICAgKiBGaW5kIHRoZSBtaW5pbXVtIHZhbHVlIGluIGEgc2V0IG9mIG51bWJlcnMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSAuLi5pbnB1dCBBbnkgdHdvIG9yICBtb3JlIG51bWJlcnMKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIGxvd2VzdCB2YWx1ZWQgbnVtYmVyIGZyb20gYW1vbmcgdGhlIGlucHV0LgogICAqCiAgICogQHNlZSB7QGxpbmsgbWF4fQogICAqLwogIG1pbiwKCiAgLyoqCiAgICogVGhlIHBvd2VyIGZ1bmN0aW9uLgogICAqCiAgICogTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gaXMgYSBob2xkb3ZlciBmcm9tIGJlZm9yZSBKUwogICAqIGhhZCB0aGUgYCoqYCBvcGVyYXRvciBmb3IgcGVyZm9ybWluZyB0aGlzIGNhbGN1bGF0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGEgQW55IG51bWJlcgogICAqIEBwYXJhbSB7bnVtYmVyfSBiIEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfE5hTn0gb3V0cHV0IGEgKiogYiBvciBOYU4gaWYgdGhhdCBpcyB1bmRlZmluZWQKICAgKi8KICBwb3csCgogIC8qKgogICAqIFRoZSAicm91bmQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciIgZnVuY3Rpb24sIHJvdW5kaW5nIGFueQogICAqIHZhbHVlIFt4LjAsIHguNDk5OS4uLl0gdG8geCwgYW5kIGFueSB2YWx1ZSBbeC41LCB4Ljk5OS4uLl0KICAgKiB0byB4ICsgMS4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBpbnRlZ2VyIHJlc3VsdCBhZnRlciByb3VuZGluZy4KICAgKgogICAqIEBzZWUge0BsaW5rIGNlaWx9CiAgICogQHNlZSB7QGxpbmsgZmxvb3J9CiAgICovCiAgcm91bmQsCgogIC8qKgogICAqIEdldCB0aGUgc2lnbiBvZiBhIG51bWJlcgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgKzEgaWYgdGhlIG51bWJlciB3YXMgcG9zaXRpdmUsIC0xIGlmIGl0IHdhcyBuZWdhdGl2ZSwgb3IgMCBpZiB0aGUgaW5wdXQgd2FzIHplcm8uCiAgICovCiAgc2lnbiwKCiAgLyoqCiAgICogVGhlIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIHNpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGNvc30KICAgKi8KICBzaW4sCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIHNpbmUgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnNlX2h5cGVyYm9saWNfZnVuY3Rpb25zI0RlZmluaXRpb25zX2luX3Rlcm1zX29mX2xvZ2FyaXRobXMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBoeXBlcmJvbGljIHNpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIHNpbn0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICBzaW5oLAoKICAvKioKICAgKiBUaGUgc3F1YXJlIHJvb3QgZnVuY3Rpb24uCiAgICoKICAgKgogICAqIE5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIGEgaG9sZG92ZXIgZnJvbSBiZWZvcmUgSlMKICAgKiBoYWQgdGhlIGAqKmAgb3BlcmF0b3IgZm9yIHBlcmZvcm1pbmcgdGhpcyBjYWxjdWxhdGlvbgogICAqIGJ5IHVzaW5nIGB4ICoqIDAuNWAuCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgc3F1YXJlIHJvb3Qgb2YgdGhhdCBudW1iZXIKICAgKgogICAqIEBzZWUge0BsaW5rIGNicnR9CiAgICogQHNlZSB7QGxpbmsgcG93fQogICAqLwogIHNxcnQsCgogIC8qKgogICAqIFRoZSB0YW5nZW50IGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgdGFuZ2VudAogICAqLwogIHRhbiwKCiAgLyoqCiAgICogVGhlIGh5cGVyYm9saWMgdGFuZ2VudCBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIGh5cGVyYm9saWMgdGFuZ2VudAogICAqCiAgICogQHNlZSB7QGxpbmsgdGFufQogICAqIEBzZWUge0BsaW5rIGFzaW5ofQogICAqIEBzZWUge0BsaW5rIGFjb3NofQogICAqLwogIHRhbmgsCgogIC8qKgogICAqIFRydW5jYXRlIGEgZnJhY3Rpb24gdG8gYW4gaW50ZWdlciBieSBzaW1wbHkgZHJvcHBpbmcgdGhlIGZyYWN0aW9uYWwgcGFydC4KICAgKiBOb3RlIHRoYXQgdGhpcyBkaWZmZXJzIGZyb20gdGhlIGBmbG9vcmAgZnVuY3Rpb246CiAgICoKICAgKiBgYGAKICAgKiBmbG9vcig0LjIpOyAgLy8gNAogICAqIGZsb29yKC00LjIpOyAvLyAtNQogICAqCiAgICogdHJ1bmMoNC4yKTsgIC8vIDQKICAgKiB0cnVuYygtNC4yKTsgLy8gLTQKICAgKiBgYGAKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBpbnRlZ2VyIHBhcnQgb25seSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgZmxvb3J9CiAgICovCiAgdHJ1bmMsCn0gPSBNYXRoOwoKLyoqCiAqIENvbnN0cmFpbiBhIG51bWJlciB0byB3aXRoaW4gYSBnaXZlbiByYW5nZS4KICogVGhpcyBpcyByZWFsbHkgbm90aGluZyBtb3JlIHRoYW4gYSBjb252ZW5pZW50CiAqIGZ1bmN0aW9uIHdyYXBwZXIgYXJvdW5kIHRoZSBzdGF0ZW1lbnQ6CiAqCiAqIGBgYAogKiB2IDwgcyA/IHMgOiB2ID4gZSA/IGUgOiB2CiAqIGBgYAogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnN0cmFpbgogKiBAcGFyYW0ge251bWJlcn0gbG93ZXJCb3VuZCBUaGUgbG93ZXIgYm91bmQgb24gb3VyIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB1cHBlckJvdW5kIFRoZSB1cHBlciBib3VuZCBvbiBvdXIgdmFsdWUKICogQHJldHVybnMge251bWJlcn0gVGhlIHZhbHVlLCBpZiBpdCBmYWxscyB3aXRoaW5nIFtsb3dlckJvdW5kLHVwcGVyQm91bmRdLCBvdGhlcndpc2Ugb25lIG9mIHRob3NlIGJvdW5kcy4KICoKICogQHNlZSB7QGxpbmsgY29uc3RyYWluTWFwfQogKi8KZnVuY3Rpb24gY29uc3RyYWluKHYsIHMsIGUpIHsKICByZXR1cm4gdiA8IHMgPyBzIDogdiA+IGUgPyBlIDogdjsKfQoKLyoqCiAqIFRoZSBjb3NlY2FudCBmdW5jdGlvbiwgd2hpY2ggaXM6CiAqCiAqIGBgYAogKiAxIC8gc2luKHYpCiAqIGBgYAogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIGlucHV0IHZhbHVlLCBpbiByYWRpYW5zLgogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY29zZWNhbnQgb2Ygb3VyIHZhbHVlLgogKgogKiBAc2VlIHtAbGluayBzZWN9CiAqLwpmdW5jdGlvbiBjc2ModikgewogIHJldHVybiAxIC8gc2luKHYpOwp9CgovKioKICogVGhlIGNvdGFuZ2VudCBmdW5jdGlvbiwgd2hpY2ggaXM6CiAqCiAqIGBgYAogKiBjb3ModikgLyBzaW4odikKICogYGBgCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgaW5wdXQgdmFsdWUsIGluIHJhZGlhbnMuCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBjb3RhbmdlbnQgb2Ygb3VyIHZhbHVlLgogKgogKiBAc2VlIHtAbGluayB0YW59CiAqLwpmdW5jdGlvbiBjdG4odikgewogIHJldHVybiBjb3ModikgLyBzaW4odik7Cn0KCi8qKgogKiBDb252ZXJ0IGEgbnVtYmVyIGluIHJhZGlhbnMgdG8gYSBudW1iZXIgaW4gZGVncmVlcy4KICogVGhpcyBpcyByZWFsbHkgbm90aGluZyBtb3JlIHRoYW4gYSBjb252ZW5pZW50CiAqIGZ1bmN0aW9uIHdyYXBwZXIgYXJvdW5kIHRoZSBzdGF0ZW1lbnQ6CiAqCiAqIGBgYAogKiB2L1BJICogMTgwCiAqIGBgYAogKgogKiBXaXRoIG9uZSB0cmljaywgaW4gdGhhdCBpdCBhbGxvd3MgeW91IHRvIGNvbnN0cmFpbiB0aGUKICogcmVzdWx0YW50IHZhbHVlIHRvIHRoZSBzdGFuZGFyZCBbMCwgMzYwXSBpbnRlcnZhbC4KICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb25zdHJhaW4KICogQHBhcmFtIHtib29sZWFufSBjb25zdHJhaW4/IEEgYm9vbGVhbiB0aGF0IGRldGVybWluZXMgd2hldGhlciBvciBub3QgdG8gY29uc3RyYWluIHRoZSByZXN1bHRhbnQgdmFsdWUgdG8gWzAsIDM2MF0gKGRlZmF1bHQgPSBmYWxzZSkKICogQHJldHVybnMge251bWJlcn0gVGhlIGRlZ3JlZSB2YWx1ZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBpbnB1dCB2YWx1ZSBpbiByYWRpYW5zLCBvcHRpb25hbGx5IGNvbnN0cmFpbmVkIHRvIFswLCAzNjBdCiAqCiAqIEBzZWUge0BsaW5rIHJhZGlhbnN9CiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbn0KICovCmZ1bmN0aW9uIGRlZ3JlZXModiwgY29uc3RyYWluID0gZmFsc2UpIHsKICBsZXQgZCA9ICh2IC8gUEkpICogMTgwOwogIGlmICghY29uc3RyYWluKSByZXR1cm4gZDsKICB3aGlsZSAoZCA8IDApIGQgKz0gMzYwOwogIHJldHVybiBkICUgMzYwOwp9CgovKioKICogQ2FsY3VsYXRlIHRoZSAyRCBFdWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiB0d28gcG9pbnRzLgogKgogKiBAcGFyYW0ge251bWJlcn0geDEgVGhlIGZpcnN0IHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTEgVGhlIGZpcnN0IHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geDIgVGhlIHNlY29uZCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkyIFRoZSBzZWNvbmQgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBldWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiB0aGUgdHdvIGNvb3JkaW5hdGVzCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMSBUaGUgZmlyc3QgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMiBUaGUgc2Vjb25kIHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgZXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gdGhlIHR3byBjb29yZGluYXRlcwogKi8KZnVuY3Rpb24gZGlzdCh4MSwgeTEsIHgyLCB5MikgewogIGlmICh4MS54ICE9PSB1bmRlZmluZWQgJiYgeDEueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5MiA9IHkxLnk7CiAgICB4MiA9IHkxLng7CiAgICB5MSA9IHgxLnk7CiAgICB4MSA9IHgxLnk7CiAgfQogIGNvbnN0IGR4ID0geDIgLSB4MTsKICBjb25zdCBkeSA9IHkyIC0geTE7CiAgcmV0dXJuIGh5cG90KGR4LCBkeSk7Cn0KCi8qKgogKiBNYXAgYSB2YWx1ZSBmcm9tIG9uZSBpbnRlcnZhbCB0byBhbm90aGVyLCBvcHRpb25hbGx5CiAqIGNvbnN0cmFpbmVkIHRvIHRoZSB0YXJnZXQgaW50ZXJ2YWwuCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBPdXIgaW5wdXQgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IG9yaWdpbmFsU3RhcnQgVGhlIGxvd2VyIGJvdW5kIG9mIG91ciBkb21haW4KICogQHBhcmFtIHtudW1iZXJ9IG9yaWdpbmFsRW5kIFRoZSB1cHBlciBib3VuZCBvZiBvdXIgZG9tYWluCiAqIEBwYXJhbSB7bnVtYmVyfSBuZXdTdGFydCBUaGUgbG93ZXIgYm91bmQgb2Ygb3VyIHRhcmdldCBpbnRlcnZhbAogKiBAcGFyYW0ge251bWJlcn0gbmV3RW5kIFRoZSB1cHBlciBib3VuZCBvbiBvdXIgdGFyZ2V0IGludGVydmFsCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY29uc3RyYWluPyAgQSBib29sZWFuIHRoYXQgZGV0ZXJtaW5lcyB3aGV0aGVyIG9yIG5vdCB0byBjb25zdHJhaW4gdGhlIHJlc3VsdGFudCB2YWx1ZSB0byBbMCwzNjBdIChkZWZhdWx0ID0gZmFsc2UpCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSByZXN1bHQgb2YgbWFwcGluZyBvdXIgdmFsdWUgZnJvbSBvdXIgZG9tYWluIGludGVydmFsIHRvIG91ciB0YXJnZXQgaW50ZXJ2YWwsIG9wdGlvbmFsbHkgY29uc3RyYWluZWQgdG8gdGhlIHRhcmdldCBpbnRlcnZhbC4KICoKICogQHNlZSB7QGxpbmsgY29uc3RyYWlufQogKiBAc2VlIHtAbGluayBjb25zdHJhaW5NYXB9CiAqLwpmdW5jdGlvbiBtYXAodiwgcywgZSwgbnMsIG5lLCBjb25zdHJhaW5lZCA9IGZhbHNlKSB7CiAgY29uc3QgaTEgPSBlIC0gcywKICAgIGkyID0gbmUgLSBucywKICAgIHAgPSB2IC0gczsKICBsZXQgciA9IG5zICsgKHAgKiBpMikgLyBpMTsKICBpZiAoY29uc3RyYWluZWQpIHJldHVybiBjb25zdHJhaW4ociwgbnMsIG5lKTsKICByZXR1cm4gcjsKfQoKLyoqCiAqIENvbnZlcnQgYSBudW1iZXIgaW4gZGVncmVlcyB0byBhIG51bWJlciBpbiByYWRpYW5zLgogKiBUaGlzIGlzIHJlYWxseSBub3RoaW5nIG1vcmUgdGhhbiBhIGNvbnZlbmllbnQKICogZnVuY3Rpb24gd3JhcHBlciBhcm91bmQgdGhlIHN0YXRlbWVudDoKICoKICogYGBgCiAqIHYvMTgwICogUEkKICogYGBgCiAqCiAqIFdpdGggb25lIHRyaWNrLCBpbiB0aGF0IGl0IGFsbG93cyB5b3UgdG8gY29uc3RyYWluIHRoZQogKiByZXN1bHRhbnQgdmFsdWUgdG8gdGhlIHN0YW5kYXJkIFswLCBUQVVdIGludGVydmFsLgogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnN0cmFpbgogKiBAcGFyYW0ge2Jvb2xlYW59IGNvbnN0cmFpbj8gQSBib29sZWFuIHRoYXQgZGV0ZXJtaW5lcyB3aGV0aGVyIG9yIG5vdCB0byBjb25zdHJhaW4gdGhlIHJlc3VsdGFudCB2YWx1ZSB0byBbMCwgVEFVXSAoZGVmYXVsdCA9IGZhbHNlKQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgcmFkaWFucyB2YWx1ZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBpbnB1dCB2YWx1ZSBpbiBkZWdyZWVzLCBvcHRpb25hbGx5IGNvbnN0cmFpbmVkIHRvIFswLCBUQVVdCiAqCiAqIEBzZWUge0BsaW5rIGRlZ3JlZXN9CiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbn0KICovCmZ1bmN0aW9uIHJhZGlhbnModiwgY29uc3RyYWluID0gZmFsc2UpIHsKICBsZXQgciA9ICh2IC8gMTgwKSAqIFBJOwogIGlmICghY29uc3RyYWluKSByZXR1cm4gcjsKICB3aGlsZSAociA8IDApIHIgKz0gVEFVOwogIHJldHVybiByICUgVEFVOwp9CgovKioKICogR2VuZXJhdGUgYSBwc2V1ZG8tcmFuZG9tIG51bWJlci4KICoKICogVGhpcyBpcyBiYXNlZCBvbiB0aGUgU3BsaXRNaXgzMiBhbGdvcml0aG0sIGNvdmVyZWQKICogb3ZlciBvbiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDc1OTMzMTYvNzQwNTUzCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDIwKTsKICogICAgICAgcmFuZ2UoMCwgaGVpZ2h0ICsgMjAsIDIwLCAodikgPT4gewogKiAgICAgICAgIHRleHQocmFuZG9tKCksIDUsIHYpOwogKiAgICAgICB9KQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqCiAqCiAqIEByZXR1cm5zIHtudW1iZXJ9IEEgcmFuZG9tIG51bWJlciBpbiB0aGUgaW50ZXJ2YWwgWzAsMSkKICoKICogQHBhcmFtIHtudW1iZXJ9IGEgVGhlIHVwcGVyIGJvdW5kIGZvciB0aGUgcmFuZG9tIG51bWJlcgogKiBAcmV0dXJucyB7bnVtYmVyfSBBIHJhbmRvbSBudW1iZXIgaW4gdGhlIGludGVydmFsIFswLGEpCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBhIFRoZSBsb3dlciBib3VuZCBmb3IgdGhlIHJhbmRvbSBudW1iZXIKICogQHBhcmFtIHtudW1iZXJ9IGIgVGhlIHVwcGVyIGJvdW5kIGZvciB0aGUgcmFuZG9tIG51bWJlcgogKiBAcmV0dXJucyB7bnVtYmVyfSBBIHJhbmRvbSBudW1iZXIgaW4gdGhlIGludGVydmFsIFthLCBiKQogKgogKiBAc2VlIHtAbGluayByYW5kb21TZWVkfQogKi8KZnVuY3Rpb24gcmFuZG9tKGEgPSAxLCBiKSB7CiAgY29uc3QgciA9IF9fcHJuZy5uZXh0KCk7CiAgaWYgKGIgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGEgKiByOwogIHJldHVybiBhICsgciAqIChiIC0gYSk7Cn0KCi8qKgogKiBTZXQgdGhlIHBzZXVkby1yYW5kb20gbnVtYmVyIGdlbmVyYXRvciBzZWVkLiBJZiBubyBzZWVkCiAqIHZhbHVlIGlzIHByb3ZpZGVkLCB0aGlzIGlzIGVxdWl2YWxlbnQgdG8gY2FsbGluZzoKICoKICogYGBgCiAqIHJhbmRvbVNlZWQoRGF0ZS5ub3coKSAqIE1hdGgucmFuZG9tKCkpCiAqIGBgYAogKgogKiBAcGFyYW0ge251bWJlcn0gc2VlZD8gVGhlIHJhbmRvbSBzZWVkIHZhbHVlLgogKgogKiBAc2VlIHtAbGluayByYW5kb219CiAqLwpmdW5jdGlvbiByYW5kb21TZWVkKHNlZWQgPSBEYXRlLm5vdygpICogTWF0aC5yYW5kb20oKSkgewogIF9fcHJuZy5yZXNlZWQoc2VlZCk7Cn0KCi8qKgogKiBUaGUgc2VjYW50IGZ1bmN0aW9uLCB3aGljaCBpczoKICoKICogYGBgCiAqIDEgLyBjb3ModikKICogYGBgCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgaW5wdXQgdmFsdWUsIGluIHJhZGlhbnMuCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBzZWNhbnQgb2Ygb3VyIHZhbHVlLgogKgogKiBAc2VlIHtAbGluayBjc2N9CiAqLwpmdW5jdGlvbiBzZWModikgewogIHJldHVybiAxIC8gY29zKHYpOwp9Ci8qKgogKiBQcm9qZWN0IGEgM0QgY29vcmRpbmF0ZSB0byAyRC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgNTAsIC0wLjQpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIC0xLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAtMSksIHByb2plY3QoMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgMSwgMSksIHByb2plY3QoLTEsIC0xLCAxKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIDNEIGNvb3JkaW5hdGUncyB4IHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSAzRCBjb29yZGluYXRlJ3MgeCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geiBUaGUgM0QgY29vcmRpbmF0ZSdzIHggdmFsdWUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCAgVGhlIHByb2plY3RlZCAyRCB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSAyRCBjb29yZGluYXRlIGFzIHt4LHksen0gY29vcmRpbmF0ZQogKiBAcmV0dXJucyB7UG9pbnRMaWtlfSBwICBUaGUgcHJvamVjdGVkIDJEIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgc2V0UHJvamVjdG9yfQogKi8KZnVuY3Rpb24gcHJvamVjdCh4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkICYmIHgueiAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIHJldHVybiBfX3Byb2plY3Rvci5wcm9qZWN0KHgsIHksIHopOwp9CgovKioKICogU2V0IHRoZSBwcm9qZWN0b3IncyB4LCB5LCBhbmQgeiBheGlzIHJvdGF0aW9uCiAqIGluIHJhZGlhbnMuIE5vdGUgdGhhdCB0aGVzZSBhcmUgYXBwbGllZCBpbiBvcmRlci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgNTAsIC0wLjQpOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgY29uc3QgbSA9IG1pbGxpcygpIC8gNTAwMDsKICogICAgICAgcm90YXRlUHJvamVjdG9yKG0sIDIgKiBtLCAzICogbSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIC0xLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAtMSksIHByb2plY3QoMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgMSwgMSksIHByb2plY3QoLTEsIC0xLCAxKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGFuZ2xlIG9mIHJvdGF0aW9uIG92ZXIgdGhlIHggYXhpcyBpbiByYWRpYW5zCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBhbmdsZSBvZiByb3RhdGlvbiBvdmVyIHRoZSB5IGF4aXMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0geiBUaGUgYW5nbGUgb2Ygcm90YXRpb24gb3ZlciB0aGUgeiBheGlzIGluIHJhZGlhbnMKICoKICogQHNlZSB7QGxpbmsgcHJvamVjdH0KICovCmZ1bmN0aW9uIHJvdGF0ZVByb2plY3Rvcih4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkICYmIHgueiAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIF9fcHJvamVjdG9yLnNldFJvdGF0aW9uKHgsIHksIHopOwp9CgovKioKICogU2V0IHRoZSBwcm9qZWN0IHBhcmFtZXRlcnMuIEN1cnJlbnRseSwgb25seQogKiBjYWJpbmV0IHByb2plY3QgaXMgc3VwcG9ydGVkLCB3aGljaCBhY2NlcHRzCiAqIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgNTAsIC0wLjQpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIC0xLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAtMSksIHByb2plY3QoMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgMSwgMSksIHByb2plY3QoLTEsIC0xLCAxKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtICB7bnVtYmVyfSB4T2Zmc2V0IG9mIHRoZSBwcm9qZWN0aW9uIHdydCB0aGUgY2FudmFzIChkZWZhdWx0ID0gMCkKICogQHBhcmFtICB7bnVtYmVyfSB5T2Zmc2V0IG9mIHRoZSBwcm9qZWN0aW9uIHdydCB0aGUgY2FudmFzIChkZWZhdWx0ID0gMCkKICogQHBhcmFtICB7bnVtYmVyfSBzY2FsZSBmYWN0b3IgZm9yIHRoZSAzRCBpbnB1dCAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSAge251bWJlcn0gY2FiaW5ldCBhbmdsZSBpbiByYWRpYW5zIChkZWZhdWx0ID0gLXBpLzYpCiAqCiAqIEBzZWUge0BsaW5rIHByb2plY3R9CiAqLwpmdW5jdGlvbiBzZXRQcm9qZWN0b3IoLi4uYXJncykgewogIF9fcHJvamVjdG9yLnVwZGF0ZSguLi5hcmdzKTsKfQovKioKICogU2V0IGEgYm9yZGVyIGFyb3VuZCB0aGUgY2FudmFzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRCb3JkZXIoMTAsIGByZWRgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcnxib29sZWFufSB3aWR0aD8gVGhlIHdpZHRoIG9mIHRoZSBib3JkZXIgaW4gcGl4ZWxzLCBkaXNhYmxpbmcgdGhlIGJvcmRlciBvbWl0dGVkCiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvcj8gVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBibGFjaykKICoKICogQHNlZSB7QGxpbmsgbm9Cb3JkZXJ9CiAqLwpmdW5jdGlvbiBzZXRCb3JkZXIod2lkdGggPSAxLCBjb2xvciA9IGBibGFja2ApIHsKICBpZiAoIXdpZHRoKSB7CiAgICBfX2NhbnZhcy5zdHlsZS5ib3JkZXIgPSBgbm9uZWA7CiAgfSBlbHNlIHsKICAgIF9fY2FudmFzLnN0eWxlLmJvcmRlciA9IGAke3dpZHRofXB4IHNvbGlkICR7Y29sb3J9YDsKICB9Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgc3Ryb2tlIGFuZCBmaWxsIGNvbG91ciBhdAogKiB0aGUgc2FtZSB0aW1lLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIKICoKICogQHNlZSB7QGxpbmsgc2V0U3Ryb2tlfQogKiBAc2VlIHtAbGluayBzZXRGaWxsfQogKiBAc2VlIHtAbGluayBub0NvbG9yfQogKi8KZnVuY3Rpb24gc2V0Q29sb3IoY29sb3IpIHsKICBzZXRGaWxsKGNvbG9yKTsKICBzZXRTdHJva2UoY29sb3IpOwp9CgovKioKICogQ2hhbmdlIHRoZSBjdXJzb3IgdG8gYSBzcGVjaWZpYyBpY29uOgogKgogKiAtIEFVVE8gLSB1c2Ugd2hhdGV2ZXIgdGhlIGJyb3dzZXIgd291bGQgb3RoZXJ3aXNlIHVzZQogKiAtIENST1NTIC0gdXNlIGEgY3Jvc3MtaGFpciBpY29uCiAqIC0gUE9JTlRFUiAtIHVzZSB0aGUgInBvaW50ZXIiIGljb24gdGhhdCBpcyBhbHNvIHVzZWQgZm9yIGNsaWNrYWJsZSBsaW5rcwogKgogKiBVc2UgYW55IG90aGVyIHN0cmluZyBmb3VuZCBvdmVyIG9uIHRoZSBNRE4gY3Vyc29yIGFydGljbGUgdG8gc2V0IGEgY3Vyc29yIG5vdCBjb3ZlcmVkIGJ5IHRoZSBhYm92ZSBjb25zdGFudHMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYCNGRjAyYCk7CiAqICAgICAgIHJlY3QoMCwgMCwgd2lkdGgvMiwgaGVpZ2h0KTsKICogICAgICAgc2V0Q29sb3IoYCMwRkYyYCk7CiAqICAgICAgIHJlY3Qod2lkdGgvMiwgMCwgd2lkdGgvMiwgaGVpZ2h0KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJNb3ZlKHgsIHkpIHsKICogICAgICAgaWYgKHggPCB3aWR0aC8yKSB7CiAqICAgICAgICAgc2V0Q3Vyc29yKEFVVE8pOwogKiAgICAgICB9IGVsc2UgewogKiAgICAgICAgIG5vQ3Vyc29yKCk7CiAqICAgICAgIH0KICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBUaGUgQ1NTIGN1cnNvciB0eXBlCiAqCiAqIEBzZWUge0BsaW5rIG5vQ3Vyc29yfQogKi8KZnVuY3Rpb24gc2V0Q3Vyc29yKHR5cGUpIHsKICBfX2N1cnJlbnRfY3Vyc29yID0gdHlwZTsKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBfX2N1cnJlbnRfY3Vyc29yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZpbGwgY29sb3VyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBibGFjaykKICoKICogQHNlZSB7QGxpbmsgbm9GaWxsfQogKi8KZnVuY3Rpb24gc2V0RmlsbChjb2xvciA9IGBibGFja2ApIHsKICBpZiAoQ1NTX0NPTE9SX01BUFtjb2xvcl0gPT09IF9faGlnaGxpZ2h0X2NvbG9yKSB7CiAgICBjb2xvciA9IF9fY3VycmVudF9oaWdobGlnaHRfY29sb3I7CiAgfQogIF9fY3R4LmZpbGxTdHlsZSA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZvbnQgdXNpbmcgYSBzaW5nbGUgc3RyaW5nLiBGb3IgdGhlIHN5bnRheCwKICogc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0NTUy9mb250CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBmb250IEEgQ1NTIHNob3J0aGFuZCBmb250IHByb3BlcnR5CiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRGYW1pbHl9CiAqIEBzZWUge0BsaW5rIHNldEZvbnRTaXplfQogKiBAc2VlIHtAbGluayBzZXRGb250V2VpZ2h0fQogKi8KZnVuY3Rpb24gc2V0Rm9udChmb250KSB7CiAgX19jdHguZm9udCA9IGZvbnQgfHwgYCR7X19mb250LndlaWdodH0gJHtfX2ZvbnQuc2l6ZX1weCAke19fZm9udC5mYW1pbHl9YDsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBmb250IGZhbWlseS4KICoKICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgVGhlIENTUyBmb250IGZhbWlseSBuYW1lCiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRTaXplfQogKiBAc2VlIHtAbGluayBzZXRGb250V2VpZ2h0fQogKi8KZnVuY3Rpb24gc2V0Rm9udEZhbWlseShuYW1lKSB7CiAgX19mb250LmZhbWlseSA9IG5hbWU7CiAgc2V0Rm9udCgpOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZvbnQgc2l6ZQogKgogKiBAcGFyYW0ge251bWJlcn0gcHggVGhlIGZvbnQgc2l6ZSBpbiBwaXhlbHMKICoKICogQHNlZSB7QGxpbmsgc2V0Rm9udEZhbWlseX0KICogQHNlZSB7QGxpbmsgc2V0Rm9udFdlaWdodH0KICovCmZ1bmN0aW9uIHNldEZvbnRTaXplKHB4KSB7CiAgX19mb250LnNpemUgPSBweDsKICBzZXRGb250KCk7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgZm9udCB3ZWlnaHQKICoKICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSB2YWwgVGhlIENTUyB3ZWlnaHQgbnVtYmVyIG9yIGVpdGhlciBvZiB0aGUgc3BlY2lhbCBzdHJpbmdzICJub3JtYWwiLCAiYm9sZCIsICJib2xkZXIiLCBvciAibGlnaHRlciIuCiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRGYW1pbHl9CiAqIEBzZWUge0BsaW5rIHNldEZvbnRTaXplfQogKi8KZnVuY3Rpb24gc2V0Rm9udFdlaWdodCh2YWwpIHsKICBfX2ZvbnQud2VpZ2h0ID0gdmFsOwogIHNldEZvbnQoKTsKfQoKLyoqCiAqIFNldCB0aGUgYmFja2dyb3VuZCBncmlkIHNwYWNpbmcgYW5kIGNvbG91ci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEdyaWQoMjAsIGBsYXZlbmRlcmApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHNwYWNpbmc/IFRoZSBzcGFjaW5nIGJldHdlZW4gZ3JpZCBsaW5lcyBpbiBwaXhlbHMgKGRlZmF1bHQgPSAyMCkKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yPyBUaGUgQ1NTIGNvbG9yIHRvIHVzZSBmb3IgdGhlIGJvcmRlciAoZGVmYXVsdCA9IGxpZ2h0Z3JleSkKICoKICogQHNlZSB7QGxpbmsgbm9HcmlkfQogKi8KZnVuY3Rpb24gc2V0R3JpZChzcGFjaW5nID0gMjAsIGNvbG9yID0gYGxpZ2h0Z3JleWApIHsKICBfX2RyYXdfZ3JpZCA9IHRydWU7CiAgX19ncmlkX3NwYWNpbmcgPSBzcGFjaW5nOwogIF9fZ3JpZF9jb2xvciA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjb2xvciB0aGF0IHNob3VsZCBiZSB1c2VkIHRvIHJlcGxhY2Ugd2hhdGV2ZXIKICogaGlnaGxpZ2h0KCkgbWFya2VkIGFzIHRoZSAidG8gaGlnaGxpZ2h0IiBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0SGlnaGxpZ2h0Q29sb3IoYGxpbWVgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KCJsZXQncyBnbyIsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICBpZiAoc3RhdGUpIGhpZ2hsaWdodChgcmVkYCk7CiAqICAgICAgIGVsc2UgaGlnaGxpZ2h0KGZhbHNlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIKICoKICogQHNlZSB7QGxpbmsgaGlnaGxpZ2h0fQogKi8KZnVuY3Rpb24gc2V0SGlnaGxpZ2h0Q29sb3IoY29sb3IpIHsKICBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yID0gY29sb3I7Cn0KCi8qKgogKiBTZXQgdGhlIGxpbmUgZGFzaCBwcm9wZXJ0eS4gU2VlIHRoZSBmb2xsb3dpbmcgTUROIGFydGljbGUgZm9yIHRoZSBkZXRhaWxzOgogKgogKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9kb2NzL1dlYi9BUEkvQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEL3NldExpbmVEYXNoCiAqCiAqIEBwYXJhbSAge251bWJlcltdfSAuLi52YWx1ZXMgVGhlIGRhc2ggaW50ZXJ2YWxzIGluIHBpeGVsCiAqCiAqIEBzZWUge0BsaW5rIG5vTGluZURhc2h9CiAqLwpmdW5jdGlvbiBzZXRMaW5lRGFzaCguLi52YWx1ZXMpIHsKICBfX2N0eC5zZXRMaW5lRGFzaCh2YWx1ZXMpOwp9CgovKioKICogU2V0IHRoZSBsaW5lIHdpZHRoIGluIHBpeGVscy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcmFuZ2UoMSwgMTAsIChpKSA9PiB7CiAqICAgICAgICAgc2V0TGluZVdpZHRoKGkpOwogKiAgICAgICAgIGxpbmUoMjAsIGkgKiAyMCwgMTgwLCBpICogMjApOwogKiAgICAgICB9KQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aD8gVGhlIGxpbmUgd2lkdGggaW4gcGl4ZWxzIChkZWZhdWx0ID0gMSkKICoKICogQHNlZSB7QGxpbmsgc2V0VGV4dFN0cm9rZX0KICovCmZ1bmN0aW9uIHNldExpbmVXaWR0aCh3aWR0aCA9IDEpIHsKICBfX2N0eC5saW5lV2lkdGggPSB3aWR0aDsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBzdHJva2UgY29sb3VyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBibGFjaykKICoKICogQHNlZSB7QGxpbmsgc2V0RmlsbH0KICogQHNlZSB7QGxpbmsgc2V0Q29sb3J9CiAqLwpmdW5jdGlvbiBzZXRTdHJva2UoY29sb3IgPSBgYmxhY2tgKSB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdID09PSBfX2hpZ2hsaWdodF9jb2xvcikgewogICAgY29sb3IgPSBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwogIH0KICBfX2N0eC5zdHJva2VTdHlsZSA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IHRleHQgYWxpZ25tZW50IHZhbHVlcy4KICoKICogVmFsaWQgYHhBbGlnbmAgdmFsdWVzIGFyZToKICoKICogLSBDRU5URVIgLSB0aGUgdGV4dCBhbmNob3IgaXMgaW4gdGhlIG1pZGRsZSBvZiB0aGUgdGV4dC4gVGV4dCBpcyBwbGFjZWQgZXZlbmx5IG9uIGVpdGhlciBzaWRlLgogKiAtIEVORCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgcmlnaHQgZm9yIExUUiB0ZXh0LCBhbmQgb24gdGhlIGxlZnQgZm9yIFJUTCB0ZXh0LgogKiAtIExFRlQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIGxlZnQgc2lkZSBvZiB0aGUgdGV4dC4gYWxsIHRleHQgaXMgdG8gdGhlIHJpZ2h0LgogKiAtIFJJR0hUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSByaWdodCBzaWRlIG9mIHRoZSB0ZXh0LiBBbGwgdGV4dCBpcyB0byB0aGUgbGVmdC4KICogLSBTVEFSVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgbGVmdCBmb3IgTFRSIHRleHQsIGFuZCBvbiB0aGUgcmlnaHQgZm9yIFJUTCB0ZXh0LgogKgogKiBWYWxpZCBgeUFsaWduYCB2YWx1ZXMgYXJlOgogKgogKiAtIEFMUEhBQkVUSUMgLSBzdGFuZGFyZCB0ZXh0IGFsaWdubWVudCAoZGVmYXVsdCkKICogLSBCT1RUT00gLSB0aGUgdGV4dCBpcyBhbGlnbmVkIHRvIHRoZSBib3R0b20gb2YgdGhlIGJvdW5kaW5nIGJveAogKiAtIEhBTkdJTkcgLSByZWxldmFudCBmb3IgVGliZXRhbiBhbmQgb3RoZXIgSW5kaWMgc2NyaXB0cy4KICogLSBJREVPR1JBUEhJQyAtIHJlbGV2YW50IGZvciBpZGVvZ3JhcGhpYyBDSktWIHRleHQuCiAqIC0gTUlERExFIC0gVGhlIHZlcnRpY2FsIGVxdWl2YWxlbnQgb2YgImNlbnRlciIuCiAqIC0gVE9QIC0gVGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgdG9wIG9mIHRoZSB0eXBvZ3JhcGhpYyAiZW0gc3F1YXJlIi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRGb250U2l6ZSgyMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBsaW5lKHdpZHRoIC8gMiwgMCwgd2lkdGggLyAyLCBoZWlnaHQpOwogKiAgICAgICBsaW5lKDAsIGhlaWdodCAvIDIsIHdpZHRoLCBoZWlnaHQgLyAyKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dCgiY2VudGVyIG1pZGRsZSIsIHdpZHRoIC8gMiwgaGVpZ2h0LzIpOwogKiAgICAgICBsaW5lKDAsIGhlaWdodCAvIDIgLSA1MCwgd2lkdGgsIGhlaWdodCAvIDIgLSA1MCk7CiAqICAgICAgIHNldFRleHRBbGlnbihSSUdIVCwgVE9QKTsKICogICAgICAgdGV4dCgicmlnaHQgdG9wIiwgd2lkdGggLyAyLCBoZWlnaHQvMiAtIDUwKTsKICogICAgICAgbGluZSgwLCBoZWlnaHQgLyAyICsgNTAsIHdpZHRoLCBoZWlnaHQgLyAyICsgNTApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oTEVGVCwgQk9UVE9NKTsKICogICAgICAgdGV4dCgibGVmdCBib3R0b20iLCB3aWR0aCAvIDIsIGhlaWdodC8yICsgNTApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSB4QWxpZ24gVGhlIENTUyBob3Jpem9udGFsIGFsaWdubWVudAogKiBAcGFyYW0ge3N0cmluZ30geUFsaWduIFRoZSBDU1MgdmVydGljYWwgYWxpZ25tZW50CiAqLwpmdW5jdGlvbiBzZXRUZXh0QWxpZ24oeEFsaWduLCB5QWxpZ24pIHsKICBfX2N0eC50ZXh0QWxpZ24gPSB4QWxpZ247CiAgX19jdHgudGV4dEJhc2VsaW5lID0geUFsaWduOwp9CgovKioKICogU2V0IHRoZSB0ZXh0IG91dGxpbmUgc3Ryb2tpbmcgcHJvcGVydGllcy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoYHJlZGAsIDEpOwogKiAgICAgICBzZXRGaWxsKGB5ZWxsb3dgKTsKICogICAgICAgdGV4dCgiZmFuY3kgdGV4dCIsIHdpZHRoLzIsIDgwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICAgIHNldEZvbnRTaXplKDY1KTsKICogICAgICAgc2V0VGV4dFN0cm9rZShgcmVkYCwgMyk7CiAqICAgICAgIHNldEZpbGwoYHllbGxvd2ApOwogKiAgICAgICB0ZXh0KCJmYW5jeSB0ZXh0Iiwgd2lkdGgvMiwgMTQwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yIFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyCiAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aD8gVGhlIHRleHQgc3Ryb2tlIHdpZHRoIGluIHBpeGVscyAoZGVmYXVsdCA9IDEpCiAqCiAqIEBzZWUge0BsaW5rIHNldFN0cm9rZX0KICogQHNlZSB7QGxpbmsgc2V0TGluZVdpZHRofQogKi8KZnVuY3Rpb24gc2V0VGV4dFN0cm9rZShjb2xvciwgd2lkdGggPSAxKSB7CiAgX190ZXh0U3Ryb2tlID0gY29sb3I7CiAgc2V0TGluZVdpZHRoKHdpZHRoKTsKfQovKioKICogQ2VudGVycyB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gb24geW91ciBncmFwaGljLgogKiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gY2FsbGluZzoKICoKICogYGBgCiAqIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqIGBgYAogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgY2VudGVyKCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBsaW5lKDAsIC1odWdlLCAwLCBodWdlKTsKICogICAgICAgbGluZSgtaHVnZSwgMCwgaHVnZSwgMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCggMTAsICAxMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCggMTAsIC0xMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCgtMTAsIC0xMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCgtMTAsICAxMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIGNlbnRlcigpIHsKICB0cmFuc2xhdGUod2lkdGggLyAyLCBoZWlnaHQgLyAyKTsKfQoKLyoqCiAqIFJlc2V0IHRoZSBjb29yZGluYXRlIHRyYW5zZm9ybSBtYXRyaXguCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIG5vR3JpZCgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYGxpZ2h0Z3JleWApOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHRyYW5zbGF0ZSg1MCw1MCk7CiAqICAgICAgIGxpbmUoMCwwLDEwMCwwKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApOwogKiAgICAgICBwb2ludCgxMCwwKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBwb2ludCgxMCwwKTsKICogICAgICAgbGluZSgwLDAsMTAwLDApOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICByb3RhdGUoLVBJLzYpCiAqICAgICAgIHBvaW50KDEwMCwwKTsKICogICAgICAgc2NhbGUoMC41LCAwLjUpOwogKiAgICAgICBwb2ludCgxMDAsMCk7CiAqICAgICAgIGxpbmUoMTAwLDAsMjAwLDApOwogKiAgICAgICByZXNldFRyYW5zZm9ybSgpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgbGluZSgwLDMsMTAwLDMpOwogKiAgICAgICBwb2ludCgwLDMpOwogKiAgICAgICBwb2ludCgxMCwzKTsKICogICAgICAgcG9pbnQoMTAwLDMpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHJlc2V0VHJhbnNmb3JtKCkgewogIF9fY3R4LnJlc2V0VHJhbnNmb3JtKCk7Cn0KCi8qKgogKiBSb3RhdGUgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIHdydCB0aGUgY3VycmVudCBvcmlnaW4uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIG5vR3JpZCgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYGxpZ2h0Z3JleWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgVGhlIGFuZ2xlIGJ5IHdoaWNoIHRvIHJvdGF0ZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gaW4gcmFkaWFucwogKgogKiBAc2VlIHtAbGluayB0cmFuc2Zvcm19CiAqIEBzZWUge0BsaW5rIHJlc2V0VHJhbnNmb3JtfQogKi8KZnVuY3Rpb24gcm90YXRlKGFuZ2xlID0gMCkgewogIF9fY3R4LnJvdGF0ZShhbmdsZSk7Cn0KCi8qKgogKiBTY2FsZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gd3J0IHRoZSBjdXJyZW50IG9yaWdpbi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgbGlnaHRncmV5YCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwb2ludCgwLDApOwogKiAgICAgICBzZXRDb2xvcihgZGFya2dyZWVuYCk7CiAqICAgICAgIGxpbmUoMCwwLDIwLDIwKTsKICogICAgICAgcG9pbnQoMjAsMjApOwogKiAgICAgICByb3RhdGUoUEkvNCk7CiAqICAgICAgIHNjYWxlKDIpOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgYW1vdW50IGJ5IHdoaWNoIHRvIHNjYWxlIHRoZSB4IGNvb3JkaW5hdGVzLgogKiBAcGFyYW0ge251bWJlcn0geT8gVGhlIGFtb3VudCBieSB3aGljaCB0byBzY2FsZSB0aGUgeCBjb29yZGluYXRlcyAoZGVmYXVsdCA9IHNhbWUgYXMgeCkKICoKICogQHNlZSB7QGxpbmsgdHJhbnNmb3JtfQogKiBAc2VlIHtAbGluayByZXNldFRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHNjYWxlKHggPSAxLCB5ID0geCkgewogIF9fY3R4LnNjYWxlKHgsIHkpOwp9CgovKioKICogQ29udmVydCBhIHNjcmVlbiAoZS5nLiBicm93c2VyKSBjb29yZGluYXRlIGludG8gaXRzCiAqIGNvcnJlc3BvbmRpbmcgInRyYW5zZm9ybWVkIiBjb29yZGluYXRlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBub0dyaWQoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBsaWdodGdyZXlgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBzY2FsZSgwLjUpOwogKiAgICAgICBpZiAocG9pbnRlci5hY3RpdmUpIHsKICogICAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgICAgcG9pbnQocG9pbnRlci54LCBwb2ludGVyLnkpOwogKiAgICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgICAgcG9pbnQoc2NyZWVuVG9Xb3JsZChwb2ludGVyLngsIHBvaW50ZXIueSkpOwogKiAgICAgICB9CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSgpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHNjcmVlbiBjb29yZGluYXRlJ3MgeCB2YWx1ZSBpbiBwaXhlbHMKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHNjcmVlbiBjb29yZGluYXRlJ3MgeSB2YWx1ZSBpbiBwaXhlbHMKICogQHJldHVybnMge1BvaW50TGlrZX0gcCBUaGUgd29ybGQge3gseX0gY29vcmRpbmF0ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgc2NyZWVuIHt4LHl9IGNvb3JkaW5hdGUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCBUaGUgd29ybGQge3gseX0gY29vcmRpbmF0ZQogKgogKiBAc2VlIHtAbGluayBwcm9qZWN0fQogKiBAc2VlIHtAbGluayB3b3JsZFRvU2NyZWVufQogKi8KZnVuY3Rpb24gc2NyZWVuVG9Xb3JsZCh4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIGxldCBNID0gX19jdHguZ2V0VHJhbnNmb3JtKCkuaW52ZXJ0U2VsZigpOwoKICByZXR1cm4gbmV3IFBvaW50KHggKiBNLmEgKyB5ICogTS5jICsgTS5lLCB4ICogTS5iICsgeSAqIE0uZCArIE0uZik7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgdHJhbnNmb3JtIG1hdHJpeCwgYmFzZWQgb24gYXBwbHlpbmc6CiAqCiAqICAgICAgIHwgYSBiIGMgfAogKiAgIG0gPSB8IGQgZSBmIHwKICogICAgICAgfCAwIDAgMSB8CiAqCiAqIFdpdGggdGhlIHBhcmFtZXRlcnMgZGVmYXVsdGluZyB0byB0aGUgaWRlbnRpdHkgbWF0cml4LgogKgogKiBTZWUgdGhlIGZvbGxvd2luZyBNRE4gYXJ0aWNsZSBmb3IgbW9yZSBkZXRhaWxzIGFib3V0IHRoaXMgZnVuY3Rpb246CiAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2RvY3MvV2ViL0FQSS9DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQvdHJhbnNmb3JtCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBhIChkZWZhdWx0ID0gMSkKICogQHBhcmFtIHtudW1iZXJ9IGIgKGRlZmF1bHQgPSAwKQogKiBAcGFyYW0ge251bWJlcn0gYyAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSB7bnVtYmVyfSBkIChkZWZhdWx0ID0gMCkKICogQHBhcmFtIHtudW1iZXJ9IGUgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0ge251bWJlcn0gZiAoZGVmYXVsdCA9IDApCiAqCiAqIEBzZWUge0BsaW5rIHJlc2V0VHJhbnNmb3JtfQogKi8KZnVuY3Rpb24gdHJhbnNmb3JtKGEgPSAxLCBiID0gMCwgYyA9IDAsIGQgPSAwLCBlID0gMSwgZiA9IDApIHsKICBfX2N0eC50cmFuc2Zvcm0oYSwgYiwgYywgZCwgZSwgZik7Cn0KCi8qKgogKiBUcmFuc2xhdGUgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIGJ5IHNvbWUgYW1vdW50IG9mIHggYW5kIHkgdW5pdHMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBwb2ludCgwLDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSB4IHZhbHVlIGluIHBpeGVscyB0byBiZSB0cmVhdGVkIGFzIHRoZSBuZXcgInplcm8iCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSB5IHZhbHVlIGluIHBpeGVscyB0byBiZSB0cmVhdGVkIGFzIHRoZSBuZXcgInplcm8iCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSB7eCx5fSBjb29yZGluYXRlIHRvIGJlIHRyZWF0ZWQgYXMgdGhlIG5ldyAiemVybyIKICoKICogQHNlZSB7QGxpbmsgdHJhbnNmb3JtfQogKiBAc2VlIHtAbGluayByZXNldFRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHRyYW5zbGF0ZSh4ID0gMCwgeSA9IDApIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBfX2N0eC50cmFuc2xhdGUoeCwgeSk7Cn0KCi8qKgogKiBDb252ZXJ0IGFuIGluLWNhbnZhcyAidHJhbnNmb3JtZWQiIGNvb3JkaW5hdGUgaW50byBpdHMKICogY29ycmVzcG9uZGluZyAic2NyZWVuIiAoaS5lLiBicm93c2VyIGNhbnZhcyBvZmZzZXQpIGNvb3JkaW5hdGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwogKgogKiAgICAgICByb3RhdGUobWlsbGlzKCkgLyAyMDAwKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBjb25zdCBwID0gbmV3IFBvaW50KDMwLCAwKTsKICogICAgICAgcG9pbnQocCk7CiAqICAgICAgIHRleHQoYCR7cC54fSwke3AueX1gLCBwLnggKyAxMCwgcC55ICsgMTApOwogKgogKiAgICAgICBjb25zdCB7eCwgeX0gPSB3b3JsZFRvU2NyZWVuKHApOwogKiAgICAgICByZXNldFRyYW5zZm9ybSgpOwogKiAgICAgICBzZXRGb250U2l6ZSgxNik7CiAqICAgICAgIHRleHQoYCR7eC50b0ZpeGVkKCl9LCR7eS50b0ZpeGVkKCl9YCwgeCAtIDI1LCB5IC0gMTUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSB3b3JsZCBjb29yZGluYXRlJ3MgeCB2YWx1ZSBpbiBwaXhlbHMKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHdvcmxkIGNvb3JkaW5hdGUncyB5IHZhbHVlIGluIHBpeGVscwogKiBAcmV0dXJucyB7UG9pbnRMaWtlfSBwIFRoZSBzY3JlZW4ge3gseX0gY29vcmRpbmF0ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgd29ybGQge3gseX0gY29vcmRpbmF0ZQogKiBAcmV0dXJucyB7UG9pbnRMaWtlfSBwIFRoZSBzY3JlZW4ge3gseX0gY29vcmRpbmF0ZQogKgogKiBAc2VlIHtAbGluayBwcm9qZWN0fQogKiBAc2VlIHtAbGluayBzY3JlZW5Ub1dvcmxkfQogKi8KZnVuY3Rpb24gd29ybGRUb1NjcmVlbih4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIGxldCBNID0gX19jdHguZ2V0VHJhbnNmb3JtKCk7CgogIHJldHVybiBuZXcgUG9pbnQoeCAqIE0uYSArIHkgKiBNLmMgKyBNLmUsIHggKiBNLmIgKyB5ICogTS5kICsgTS5mKTsKfQo="),w=class extends E{static{f(this,"GraphicsElement")}handleAttributeChange(...e){}handleChildChanges(...e){}connectedCallback(){super.connectedCallback(),this.label=document.createElement("label"),this.title||(console.warn("<graphics-element> is missing a title attribute. Always caption your figures."),this.title=""),this.label.textContent=this.title,B(this)?this.loadSource():new IntersectionObserver((e,t)=>e.forEach(r=>{r.isIntersecting&&(this.loadSource(),t.disconnect())}),{threshold:.1,rootMargin:`${window.innerHeight}px`}).observe(this)}getStyle(){return`
:host([hidden]) { display: none; }
style { display: none; }
.top-title { display: flex; flex-direction: row; justify-content: space-between; }
canvas { touch-action: none; user-select: none; position: relative; z-index: 1; display: block; margin: auto; border-radius: 0; box-sizing: content-box !important; border: 1px solid lightgrey;
&.crisp { image-rendering: -moz-crisp-edges; image-rendering: -webkit-crisp-edges; image-rendering: pixelated; image-rendering: crisp-edges; }
&:focus { border: 1px solid red; }}
a { &.view-source { font-size: 60%; text-decoration: none;
&.plus { padding-left: 0.5em; }}}
button.reset { font-size: 0.5em; top: -0.35em; position: relative; }
label:not(:empty) { display: block; font-style: italic; font-size: 0.9em; text-align: right; padding-right: 1em; margin-top: 0.35em; }
`}async loadSource(e,t=this.width,r=this.height,$){if(!t&&!r&&(t=parseFloat(this.getAttribute("width")),r=parseFloat(this.getAttribute("height")),isNaN(t)&&(t=void 0),isNaN(r)&&(r=void 0)),e){if(typeof e=="function")return console.warn(".loadSource() called with a function rather than string data: use .loadFromFunction() instead."),this.loadFromFunction(e)}else if(this.userCode)e=this.userCode;else{let s=this.getAttribute("src");if(s)e=await(await fetch(s)).text();else{let o=this.querySelector("graphics-source");o?e=o.textContent:e=`function setup() {
}
function draw() {
}
`}}if(this.userCode=e,!$)if(this.additionalSources)$=this.additionalSources;else{let s=this.querySelectorAll("source");$=await Promise.all(Array.from(s).map(o=>fetch(o.src).then(g=>g.text())))}this.additionalSources=$;let x=this.userCode;this.additionalSources.length>0&&(x=this.loadAdditionalSources(this.userCode,this.additionalSources));let l=x.matchAll(/addSlider\(['"`](.*)['"`]/g),i=[];for(let s of l)i.push(s[1]),x=x.replace(s[0],s[0]+`, (v) => (${s[1]} = v)`);if(i.length&&(x="let "+i.join(", ")+`;
`+x),x=x.replaceAll(/ from ['"].([^'"]+)['"]/g,` from "${k(location.href)}/$1"`),x.includes("function setup()")||(x=`function setup() {
}
`+x),!x.includes("setSize(")){let s="setSize();";t&&r&&(s=`setSize(${t}, ${r});`),x=x.replace("function setup() {",`function setup() {
  ${s}`)}import(`data:text/javascript;base64,${S(['"use strict";',`import { BSpline, Point, Circle, Vector, Matrix, CSS_COLOR_MAP } from "${_}";`,`const __randomId = "${Date.now()}";`,W,x,"export { reset as start, __canvas as canvas, halt, highlight, __getDescription as getDescription }"].join(`
`))}`).then(async s=>{let{start:o,canvas:g,halt:c,highlight:b,getDescription:L}=s;this.canvas=g,this.halt=()=>c(),this.highlight=A=>b(A),this.render();let{width:u,height:d}=await o(this),m="graphics-element-description";this.querySelector(`.${m}`)?.remove(),this.querySelector("p")||this.handleGraphicsDescription(m,L),u&&d&&(this.style.width="",this.style.height="",this.width=u,this.height=d,this.setAttribute("width",u),this.setAttribute("height",d)),this.dispatchEvent(new CustomEvent("load")),this.onload&&this.onload()})}handleGraphicsDescription(e,t=()=>{}){try{let r=t();if(r){let $=new DocumentFragment,x=document.createElement("div");x.classList.add(e),$.append(x),x.innerHTML=r,this.append(x),this.crossLink(!0)}}catch(r){console.error(r)}}loadAdditionalSources(e,t){if(!t)return e;let r=new Array(t.length);return e+`
`+t.map(($,x)=>$.replace("function setup()",`function setup${x+1}()`).replace("function draw()",`function draw${x+1}()`)).join(`
`)+`
function __more_setup() { ${[...r].map(($,x)=>`if (typeof setup${x+1} !== \`undefined\`) setup${x+1}();`).join(`
`)} }
function __more_draw() { ${[...r].map(($,x)=>`if (typeof draw${x+1} !== \`undefined\`) draw${x+1}();`).join(`
`)} }
`}loadFromFunction(e){let t=e.toString();this.reset(t.substring(t.indexOf("{")+1,t.lastIndexOf("}")))}reset(e,t=[]){this.halt&&this.halt(),this.querySelector("button.remove-color")?.remove(),this.loadSource(e||this.userCode,this.width,this.height,t||this.additionalSources)}render(){super.render();let e=this._slot.parentNode;this.canvas&&e.insertBefore(this.canvas,this._slot),this.label&&e.insertBefore(this.label,this._slot);let t=document.createElement("div");t.classList.add("top-title");let r=document.createElement("span");r.classList.add("sources"),t.append(r);let $=document.createElement("button");$.classList.add("reset"),$.textContent=this.getAttribute("reset")||"reset",$.addEventListener("click",()=>this.reset()),t.append($);let x=this.getAttribute("src");if(x||(x=`data:text/plain;base64,${S(this.userCode)}`),x){let i=document.createElement("a");i.classList.add("view-source"),i.textContent=this.getAttribute("viewSource")||"view source",i.href=x,i.target="_blank",r.append(i),x.startsWith("data")&&(delete i.href,delete i.target,i.classList.add("fake-source-link"),i.addEventListener("click",()=>{let n=`<iframe width="100%" height="100%" src="${x}"></iframe>`,s=window.open(""),{document:o}=s;o.open(),o.write(n),o.write("<style>iframe { position: fixed; top: 0; right: 0; bottom: 0; left: 0; border:0; margin: 0; padding:0 }</style>"),o.close()}))}let l=this.querySelectorAll("source");l.length===0&&(l=(this.additionalSources??[]).map(i=>({src:`data:text/plain;base64,${S(i)}`}))),l.length&&l.forEach((i,n)=>{let{src:s}=i,o=document.createElement("a");o.classList.add("view-source","plus"),o.textContent=`[+${n+1}]`,o.href=s,o.target="_blank",r.append(o),s.startsWith("data")&&(delete o.href,delete o.target,o.classList.add("fake-source-link"),o.addEventListener("click",()=>{let g=`<iframe width="100%" height="100%" src="${s}"></iframe>`,c=window.open(""),{document:b}=c;b.open(),b.write(g),b.write("<style>iframe { position: fixed; top: 0; right: 0; bottom: 0; left: 0; border:0; margin: 0; padding:0 }</style>"),b.close()}))}),this.label&&e.insertBefore(t,this.canvas),this.crossLink()}crossLink(e){if(e&&(this.crossLinked=!1),this.crossLinked)return;this.crossLinked=!0;let t=!1;if(this.querySelectorAll("p").forEach(r=>{r.querySelectorAll("*").forEach($=>{if(!y.includes($.tagName))return;t=!0;let x;$.classList.remove("calm"),$.addEventListener("pointerenter",()=>{x??=getComputedStyle($)["-webkit-text-stroke-color"],this.highlight?.(x)}),$.addEventListener("pointerleave",()=>this.highlight?.(!1))})}),t){let r=document.createElement("button");r.textContent="remove colors",r.classList.add("remove-color"),r.addEventListener("click",()=>{this.querySelectorAll("p").forEach($=>{$.querySelectorAll("*").forEach(x=>{y.includes(x.tagName)&&x.classList.add("calm")})}),r.remove()}),this.append(r)}}},T=class extends E{static{f(this,"GraphicsSource")}constructor(){super(),this.style.display="none"}handleAttributeChange(){}handleChildChanges(){}};await E.register(w),await E.register(T);export{p as BSpline,v as CSS_COLOR_MAP,O as Circle,N as Matrix,R as Point,I as Vector};
