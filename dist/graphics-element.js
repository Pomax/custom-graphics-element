var _=Object.defineProperty;var l=(n,e)=>_(n,"name",{value:e,configurable:!0});var I="Potentially infinite loop detected.",B=/\b(for|while)[\r\n\s]*\([^\)]+\)[\r\n\s]*{/,K=/\bdo[\r\n\s]*{/,P=/}(\s*(\/\/)[^\n\r]*[\r\n])?[\r\n\s]*while[\r\n\s]*\([^\)]+\)([\r\n\s]*;)?/;function y(n,e=1e3,x=1e3){let r=0,$=0;for(;r<n.length;){if($++>x)throw new Error(I);let t=n.length,g="",i=r+n.substring(r).search(B),o=r+n.substring(r).search(K);if(i<r&&(i=t),o<r&&(o=t),i===t&&o===t)return n;let f=-1;if(i<t&&i<=o?(f=i,g=Y(n,i)):o<t&&(f=o,g=W(n,o)),g===""||f===-1)return n;let a=V(g,e);n=n.substring(0,r)+n.substring(r).replace(g,a),r=f+a.indexOf(I)+I.length+6}return n}l(y,"loopGuard");function Y(n,e=0){let x="",r=1,$=n.indexOf("{",e)+1;for(;r>0&&e<n.length;)x=n[$],x==="{"?r++:x==="}"&&r--,$++;if($>=n.length)throw new Error("Parse error: source code end prematurely.");return n.substring(e,$)}l(Y,"getLoopBlock");function W(n,e=0){let x=n.substring(e),r=x.match(P)[0],$=x.indexOf(r)+r.length;return x.substring(0,$)}l(W,"getDoLoopBlock");function V(n,e=1e3){return`((__break__counter=0) => {
${n.replace("{",`{
  if (__break__counter++ > ${e}) {
    throw new Error("${I}");
  }`)}
})();`}l(V,"wrap");var T="registered as custom element";function G(n,e){console.warn(`missing implementation for ${e}(...data) in ${n.__proto__.constructor.name}`)}l(G,"NotImplemented");function U(n){return n.prototype.constructor.name.replace(/([A-Z])([a-z])/g,(e,x,r,$)=>{let t=`${x.toLowerCase()}${r}`;return $>0?`-${t}`:t})}l(U,"getElementTagName");var h=class extends HTMLElement{static{l(this,"CustomElement")}static register(e){if(!e[T]){let x=e.tagName||U(e);return customElements.define(x,e),e[T]=!0,customElements.whenDefined(x)}return Promise.resolve()}static get tagName(){return U(this)}constructor(e={}){super(),customElements.resolveScope||(customElements.resolveScope=function($){try{return $.getRootNode().host}catch(t){console.warn(t)}return window}),this._options=e;let x={childList:$=>{this.handleChildChanges(Array.from($.addedNodes),Array.from($.removedNodes)),this.render()},attributes:$=>{this.handleAttributeChange($.attributeName,$.oldValue,this.getAttribute($.attributeName)),this.render()}};this._observer=new MutationObserver($=>{this.isConnected&&$.forEach(t=>{x[t.type](t)})}),this._observer.observe(this,{childList:!0,attributes:!0});let r={mode:"open"};this._shadow=this.attachShadow(r),this._style=document.createElement("style"),this._style.textContent=this.getStyle(),this._options.header!==!1&&(this._header=document.createElement("header")),this._options.slot!==!1&&this._options.void!==!0&&(this._slot=document.createElement("slot")),this._options.footer!==!1&&(this._footer=document.createElement("footer"))}connectedCallback(){this.render()}handleChildChanges(e,x){this._options.void||G(this,"handleChildChanges")}handleAttributeChange(e,x,r){G(this,"handleAttributeChange")}getStyle(){return""}render(){this._shadow.innerHTML="",this._shadow.append(this._style),this._options.header!==!1&&this._shadow.append(this._header),this._options.slot!==!1&&this._shadow.append(this._slot),this._options.footer!==!1&&this._shadow.append(this._footer)}};var S=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREEN","DARKGREY","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREEN","GREENYELLOW","GREY","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREEN","LIGHTGREY","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TRANSPARENT","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN"],C={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(128, 128, 128)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",transparent:"rgba(0,0,0,0)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",ALICEBLUE:"rgb(240, 248, 255)",ANTIQUEWHITE:"rgb(250, 235, 215)",AQUA:"rgb(0, 255, 255)",AQUAMARINE:"rgb(127, 255, 212)",AZURE:"rgb(240, 255, 255)",BEIGE:"rgb(245, 245, 220)",BISQUE:"rgb(255, 228, 196)",BLACK:"rgb(0, 0, 0)",BLANCHEDALMOND:"rgb(255, 235, 205)",BLUE:"rgb(0, 0, 255)",BLUEVIOLET:"rgb(138, 43, 226)",BROWN:"rgb(165, 42, 42)",BURLYWOOD:"rgb(222, 184, 135)",CADETBLUE:"rgb(95, 158, 160)",CHARTREUSE:"rgb(127, 255, 0)",CHOCOLATE:"rgb(210, 105, 30)",CORAL:"rgb(255, 127, 80)",CORNFLOWERBLUE:"rgb(100, 149, 237)",CORNSILK:"rgb(255, 248, 220)",CRIMSON:"rgb(220, 20, 60)",CYAN:"rgb(0, 255, 255)",DARKBLUE:"rgb(0, 0, 139)",DARKCYAN:"rgb(0, 139, 139)",DARKGOLDENROD:"rgb(184, 134, 11)",DARKGRAY:"rgb(169, 169, 169)",DARKGREEN:"rgb(0, 100, 0)",DARKGREY:"rgb(169, 169, 169)",DARKKHAKI:"rgb(189, 183, 107)",DARKMAGENTA:"rgb(139, 0, 139)",DARKOLIVEGREEN:"rgb(85, 107, 47)",DARKORANGE:"rgb(255, 140, 0)",DARKORCHID:"rgb(153, 50, 204)",DARKRED:"rgb(139, 0, 0)",DARKSALMON:"rgb(233, 150, 122)",DARKSEAGREEN:"rgb(143, 188, 143)",DARKSLATEBLUE:"rgb(72, 61, 139)",DARKSLATEGRAY:"rgb(47, 79, 79)",DARKSLATEGREY:"rgb(47, 79, 79)",DARKTURQUOISE:"rgb(0, 206, 209)",DARKVIOLET:"rgb(148, 0, 211)",DEEPPINK:"rgb(255, 20, 147)",DEEPSKYBLUE:"rgb(0, 191, 255)",DIMGRAY:"rgb(105, 105, 105)",DIMGREY:"rgb(105, 105, 105)",DODGERBLUE:"rgb(30, 144, 255)",FIREBRICK:"rgb(178, 34, 34)",FLORALWHITE:"rgb(255, 250, 240)",FORESTGREEN:"rgb(34, 139, 34)",FUCHSIA:"rgb(255, 0, 255)",GAINSBORO:"rgb(220, 220, 220)",GHOSTWHITE:"rgb(248, 248, 255)",GOLD:"rgb(255, 215, 0)",GOLDENROD:"rgb(218, 165, 32)",GRAY:"rgb(128, 128, 128)",GREEN:"rgb(0, 128, 0)",GREENYELLOW:"rgb(173, 255, 47)",GREY:"rgb(128, 128, 128)",HONEYDEW:"rgb(240, 255, 240)",HOTPINK:"rgb(255, 105, 180)",INDIANRED:"rgb(205, 92, 92)",INDIGO:"rgb(75, 0, 130)",IVORY:"rgb(255, 255, 240)",KHAKI:"rgb(240, 230, 140)",LAVENDER:"rgb(230, 230, 250)",LAVENDERBLUSH:"rgb(255, 240, 245)",LAWNGREEN:"rgb(124, 252, 0)",LEMONCHIFFON:"rgb(255, 250, 205)",LIGHTBLUE:"rgb(173, 216, 230)",LIGHTCORAL:"rgb(240, 128, 128)",LIGHTCYAN:"rgb(224, 255, 255)",LIGHTGOLDENRODYELLOW:"rgb(250, 250, 210)",LIGHTGRAY:"rgb(211, 211, 211)",LIGHTGREEN:"rgb(144, 238, 144)",LIGHTGREY:"rgb(211, 211, 211)",LIGHTPINK:"rgb(255, 182, 193)",LIGHTSALMON:"rgb(255, 160, 122)",LIGHTSEAGREEN:"rgb(32, 178, 170)",LIGHTSKYBLUE:"rgb(135, 206, 250)",LIGHTSLATEGRAY:"rgb(119, 136, 153)",LIGHTSLATEGREY:"rgb(119, 136, 153)",LIGHTSTEELBLUE:"rgb(176, 196, 222)",LIGHTYELLOW:"rgb(255, 255, 224)",LIME:"rgb(0, 255, 0)",LIMEGREEN:"rgb(50, 205, 50)",LINEN:"rgb(250, 240, 230)",MAGENTA:"rgb(255, 0, 255)",MAROON:"rgb(128, 0, 0)",MEDIUMAQUAMARINE:"rgb(102, 205, 170)",MEDIUMBLUE:"rgb(0, 0, 205)",MEDIUMORCHID:"rgb(186, 85, 211)",MEDIUMPURPLE:"rgb(147, 112, 219)",MEDIUMSEAGREEN:"rgb(60, 179, 113)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",MEDIUMSPRINGGREEN:"rgb(0, 250, 154)",MEDIUMTURQUOISE:"rgb(72, 209, 204)",MEDIUMVIOLETRED:"rgb(199, 21, 133)",MIDNIGHTBLUE:"rgb(25, 25, 112)",MINTCREAM:"rgb(245, 255, 250)",MISTYROSE:"rgb(255, 228, 225)",MOCCASIN:"rgb(255, 228, 181)",NAVAJOWHITE:"rgb(255, 222, 173)",NAVY:"rgb(0, 0, 128)",OLDLACE:"rgb(253, 245, 230)",OLIVE:"rgb(128, 128, 0)",OLIVEDRAB:"rgb(107, 142, 35)",ORANGE:"rgb(255, 165, 0)",ORANGERED:"rgb(255, 69, 0)",ORCHID:"rgb(218, 112, 214)",PALEGOLDENROD:"rgb(238, 232, 170)",PALEGREEN:"rgb(152, 251, 152)",PALETURQUOISE:"rgb(175, 238, 238)",PALEVIOLETRED:"rgb(219, 112, 147)",PAPAYAWHIP:"rgb(255, 239, 213)",PEACHPUFF:"rgb(255, 218, 185)",PERU:"rgb(205, 133, 63)",PINK:"rgb(255, 192, 203)",PLUM:"rgb(221, 160, 221)",POWDERBLUE:"rgb(176, 224, 230)",PURPLE:"rgb(128, 0, 128)",REBECCAPURPLE:"rgb(102, 51, 153)",RED:"rgb(255, 0, 0)",ROSYBROWN:"rgb(188, 143, 143)",ROYALBLUE:"rgb(65, 105, 225)",SADDLEBROWN:"rgb(139, 69, 19)",SALMON:"rgb(250, 128, 114)",SANDYBROWN:"rgb(244, 164, 96)",SEAGREEN:"rgb(46, 139, 87)",SEASHELL:"rgb(255, 245, 238)",SIENNA:"rgb(160, 82, 45)",SILVER:"rgb(192, 192, 192)",SKYBLUE:"rgb(135, 206, 235)",SLATEBLUE:"rgb(106, 90, 205)",SLATEGRAY:"rgb(112, 128, 144)",SLATEGREY:"rgb(112, 128, 144)",SNOW:"rgb(255, 250, 250)",SPRINGGREEN:"rgb(0, 255, 127)",STEELBLUE:"rgb(70, 130, 180)",TAN:"rgb(210, 180, 140)",TEAL:"rgb(0, 128, 128)",THISTLE:"rgb(216, 191, 216)",TOMATO:"rgb(255, 99, 71)",TRANSPARENT:"rgba(0,0,0,0)",TURQUOISE:"rgb(64, 224, 208)",VIOLET:"rgb(238, 130, 238)",WHEAT:"rgb(245, 222, 179)",WHITE:"rgb(255, 255, 255)",WHITESMOKE:"rgb(245, 245, 245)",YELLOW:"rgb(255, 255, 0)",YELLOWGREEN:"rgb(154, 205, 50)"};function D(n,e,x,r,$,m,g){var i,o,f,a,s=x.length,b=x[0].length;if(e<1)throw new Error("degree must be at least 1 (linear)");if(e>s-1)throw new Error("degree must be less than or equal to point count - 1");if(!$)for($=[],i=0;i<s;i++)$[i]=1;if($.length<x.length&&($=$.concat($.slice(0,e))),r){if(r.length!==s+e+1)throw new Error("bad knot vector length")}else{var r=[];for(i=0;i<s+e+1;i++)r[i]=i}r.length===x.length&&(r=r.concat(r.slice(0,e)));var c=[e,r.length-1-e],L=r[c[0]],R=r[c[1]];if(g||(n=n*(R-L)+L),n<L||n>R)throw new Error("out of bounds");for(f=c[0];f<c[1]&&!(n>=r[f]&&n<=r[f+1]);f++);var d=[];for(i=0;i<s;i++){for(d[i]=[],o=0;o<b;o++)d[i][o]=x[i][o]*$[i];d[i][b]=$[i]}var u;for(a=1;a<=e+1;a++)for(i=f;i>f-e-1+a;i--)for(u=(n-r[i])/(r[i+e+1-a]-r[i]),o=0;o<b+1;o++)d[i][o]=(1-u)*d[i-1][o]+u*d[i][o];var m=m||[];for(i=0;i<b;i++)m[i]=d[f][i]/d[f][b];return m}l(D,"interpolate");var E=3,A=class{static{l(this,"BSpline")}constructor(e,x=!0){this.points=e,this.points=e.map(r=>r instanceof Array?r:[r.x,r.y]),this.formKnots(x),this.formWeights()}getLUT(e=100){let x=e-1;return[...new Array(e)].map((r,$)=>{let t=D($/x,E,this.points,this.knots,this.weights);return{x:t[0],y:t[1]}})}formKnots(e=!1){if(!e)return this.formUniformKnots();let x=[],r=this.points.length,$=r-E;for(let t=1;t<r-E;t++)x.push(t+E);for(let t=0;t<=E;t++)x=[E].concat(x);for(let t=0;t<=E;t++)x.push($+E);return this.knots=x}formUniformKnots(){return this.knots=[...new Array(this.points.length+E+1)].map((e,x)=>x)}formWeights(){return this.weights=this.points.map(e=>1)}};function N(n,e=512){let x=new TextEncoder().encode(n),r="";for(let $=0;$<x.length;$+=e){let t=x.slice($,$+e);r+=String.fromCodePoint(...t)}return btoa(r)}l(N,"base64");function k(n){let e=atob(n),x=Uint8Array.from(e,r=>r.codePointAt(0));return new TextDecoder().decode(x)}l(k,"decode64");function M(n){let e=/^(.*)\/([^.]+(\.([^\/?#]+))+)(\?[^#]*)?(#.*)?$/,x=n.match(e);if(x!==null){let{[1]:r,[2]:$,[4]:t}=x;n=r}return n}l(M,"getURLbase");function H(n){if(typeof window>"u"||typeof document>"u")return!0;var e=n.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}l(H,"isInViewport");var q=String(import.meta.url),F=k("Y29uc3QgQUxQSEFCRVRJQyA9IGBhbHBoYWJldGljYDsKY29uc3QgQVVUTyA9IGBhdXRvYDsKY29uc3QgQk9UVE9NID0gYGJvdHRvbWA7CmNvbnN0IEJPVFRPTV9MRUZUID0gYGJvdHRvbi1sZWZ0YDsKY29uc3QgQk9UVE9NX1JJR0hUID0gYGJvdHRvbS1yaWdodGA7CmNvbnN0IENFTlRFUiA9IGBjZW50ZXJgOwpjb25zdCBDT05TVFJBSU4gPSB0cnVlOwpjb25zdCBDUk9TUyA9IGBjcm9zc2hhaXJgOwpjb25zdCBFTkQgPSBgZW5kYDsKY29uc3QgSEFORCA9IGBwb2ludGVyYDsKY29uc3QgSEFOR0lORyA9IGBoYW5naW5nYDsKY29uc3QgSURFT0dSQVBISUMgPSBgaWRlb2dyYXBoaWNgOwpjb25zdCBMRUZUID0gYGxlZnRgOwpjb25zdCBNSURETEUgPSBgbWlkZGxlYDsKY29uc3QgUE9JTlRFUiA9IGBkZWZhdWx0YDsKY29uc3QgUklHSFQgPSBgcmlnaHRgOwpjb25zdCBTVEFSVCA9IGBzdGFydGA7CmNvbnN0IFRPUCA9IGB0b3BgOwpjb25zdCBUT1BfTEVGVCA9IGB0b3AtbGVmdGA7CmNvbnN0IFRPUF9SSUdIVCA9IGB0b3AtcmlnaHRgOwoKLy8gImludGVybmFsIiB2YXJzCgpsZXQgX19jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBjYW52YXNgKTsKX19jYW52YXMudGFiSW5kZXggPSAwOwpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBwb2ludGVyZG93bmAsICgpID0+IF9fY2FudmFzLmZvY3VzKCkpOwpsZXQgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwoKbGV0IF9fY3VycmVudF9jdXJzb3I7CmxldCBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19jdXJyZW50X2h1ZTsKbGV0IF9fZHJhd19ncmlkOwpsZXQgX19kcmF3aW5nOwpsZXQgX19lbGVtZW50OwpsZXQgX19maW5pc2hlZF9zZXR1cDsKbGV0IF9fZmlyc3Q7CmxldCBfX2ZvbnQ7CmxldCBfX2dyaWRfY29sb3I7CmxldCBfX2dyaWRfc3BhY2luZzsKbGV0IF9faGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19sYXN0X2ZyYW1lOwpsZXQgX19tb3ZhYmxlX3BvaW50czsKbGV0IF9fcHJvamVjdG9yOwpsZXQgX19yZWRyYXdpbmc7CmxldCBfX3NoYXBlOwpsZXQgX19zdGFydF90aW1lOwpsZXQgX19zdHlsZV9zdGFjazsKbGV0IF9fdGV4dFN0cm9rZTsKbGV0IF9fdXNlX3Byb2plY3Rpb247Cgpjb25zdCBfX3BybmcgPSBuZXcgKGNsYXNzIHsKICBjb25zdHJ1Y3RvcihzZWVkID0gRGF0ZS5ub3coKSkgewogICAgdGhpcy5hID0gc2VlZDsKICB9CiAgcmVzZWVkKHNlZWQpIHsKICAgIHRoaXMuYSA9IHNlZWQ7CiAgfQogIG5leHQoKSB7CiAgICAvLyBTcGxpdE1peDMyLCBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDc1OTMzMTYvNzQwNTUzCiAgICBsZXQgeyBhIH0gPSB0aGlzOwogICAgYSB8PSAwOwogICAgYSA9IChhICsgMHg5ZTM3NzliOSkgfCAwOwogICAgbGV0IHQgPSBhIF4gKGEgPj4+IDE2KTsKICAgIHQgPSBNYXRoLmltdWwodCwgMHgyMWYwYWFhZCk7CiAgICB0ID0gdCBeICh0ID4+PiAxNSk7CiAgICB0ID0gTWF0aC5pbXVsKHQsIDB4NzM1YTJkOTcpOwogICAgdGhpcy5hID0gYTsKICAgIHJldHVybiAoKHQgPSB0IF4gKHQgPj4+IDE1KSkgPj4+IDApIC8gNDI5NDk2NzI5NjsKICB9Cn0pKCk7Cgphc3luYyBmdW5jdGlvbiBfX3Jlc2V0KGVsZW1lbnQgPSBfX2VsZW1lbnQpIHsKICBfX2VsZW1lbnQgPSBlbGVtZW50OwoKICAvLyBkZWZhdWx0IHZhcmlhYmxlIHZhbHVlcwogIF9fY3VycmVudF9jdXJzb3IgPSBgYXV0b2A7CiAgX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvciA9IGByZ2IoMCwyNTQsMTI0KWA7CiAgX19jdXJyZW50X2h1ZSA9IDA7CiAgX19kcmF3X2dyaWQgPSB0cnVlOwogIF9fZHJhd2luZyA9IGZhbHNlOwogIF9fZmluaXNoZWRfc2V0dXAgPSBmYWxzZTsKICBfX2ZvbnQgPSB7IGZhbWlseTogYHNhbnMtc2VyaWZgLCBzaXplOiAxNiwgd2VpZ2h0OiA0MDAgfTsKICBfX2dyaWRfY29sb3IgPSBgbGlnaHRncmV5YDsKICBfX2dyaWRfc3BhY2luZyA9IDIwOwogIF9faGlnaGxpZ2h0X2NvbG9yID0gZmFsc2U7CiAgX19tb3ZhYmxlX3BvaW50cyA9IFtdOwogIF9fcHJvamVjdG9yID0gZmFsc2U7CiAgX19yZWRyYXdpbmcgPSBmYWxzZTsKICBfX3NoYXBlID0gdW5kZWZpbmVkOwogIF9fc3RhcnRfdGltZSA9IERhdGUubm93KCk7CiAgX19zdHlsZV9zdGFjayA9IFtdOwogIF9fdGV4dFN0cm9rZSA9IGB0cmFuc3BhcmVudGA7CiAgX191c2VfcHJvamVjdGlvbiA9IGZhbHNlOwoKICBjdXJyZW50TW92YWJsZSA9IGZhbHNlOwogIHBsYXlpbmcgPSBmYWxzZTsKICBmcmFtZSA9IDA7CiAgcG9pbnRlci54ID0gMDsKICBwb2ludGVyLnkgPSAwOwogIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGtleWJvYXJkKS5mb3JFYWNoKChuKSA9PiBkZWxldGUga2V5Ym9hcmRbbl0pOwoKICAvLyBtYWtlIHN1cmUgd2UgZG9uJ3QgZG91YmxlLWdlbmVyYXRlIHRoZXNlOgogIGNsZWFyU2xpZGVycygpOwogIGNsZWFyQnV0dG9ucygpOwoKICAvLyBydW4gc2V0dXAKICBhd2FpdCBfX3NldHVwKCk7CiAgX19maW5pc2hlZF9zZXR1cCA9IHRydWU7CgogIC8vIHJ1biBmaXJzdCBkcmF3CiAgX19sYXN0X2ZyYW1lID0gRGF0ZS5ub3coKTsKICBhd2FpdCBfX2RyYXcoKTsKCiAgcmV0dXJuIHsgd2lkdGgsIGhlaWdodCB9Owp9CgpmdW5jdGlvbiBfX2hhbHQoKSB7CiAgcGxheWluZyA9IGZhbHNlOwogIF9fY2FudmFzID0gdW5kZWZpbmVkOwogIF9fY3R4ID0gdW5kZWZpbmVkOwogIF9fZmluaXNoZWRfc2V0dXAgPSBmYWxzZTsKICBfX2RyYXdpbmcgPSB0cnVlOwogIF9fcmVkcmF3aW5nID0gdHJ1ZTsKICBfX2ZpcnN0ID0gdW5kZWZpbmVkOwogIF9fbW92YWJsZV9wb2ludHMgPSB1bmRlZmluZWQ7CiAgX19jdXJyZW50X2N1cnNvciA9IHVuZGVmaW5lZDsKICBfX2N1cnJlbnRfaHVlID0gMDsKICBfX2ZvbnQgPSB1bmRlZmluZWQ7CiAgX19zdGFydF90aW1lID0gMDsKICBjbGVhclNsaWRlcnMoKTsKICBjbGVhckJ1dHRvbnMoKTsKfQoKZnVuY3Rpb24gX19nZXREZXNjcmlwdGlvbigpIHsKICBpZiAodHlwZW9mIGdldERlc2NyaXB0aW9uICE9PSBgdW5kZWZpbmVkYCkgcmV0dXJuIGdldERlc2NyaXB0aW9uKCk7Cn0KCmFzeW5jIGZ1bmN0aW9uIF9fc2V0dXAoKSB7CiAgaWYgKHR5cGVvZiBzZXR1cCAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IHNldHVwKCk7CiAgaWYgKHR5cGVvZiBfX21vcmVfc2V0dXAgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBfX21vcmVfc2V0dXAoKTsKICBpZiAoIXdpZHRoICYmICFoZWlnaHQpIHNldFNpemUoKTsKfQoKYXN5bmMgZnVuY3Rpb24gX19kcmF3KCkgewogIGlmICghX19maW5pc2hlZF9zZXR1cCkgcmV0dXJuOwogIGlmICghX19kcmF3aW5nKSB7CiAgICBfX2RyYXdpbmcgPSB0cnVlOwogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICAgIGZyYW1lRGVsdGEgPSBub3cgLSBfX2xhc3RfZnJhbWU7CiAgICBmcmFtZSsrOwogICAgcmVzZXRUcmFuc2Zvcm0oKTsKICAgIGlmICh0eXBlb2YgZHJhdyAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IGRyYXcoKTsKICAgIGlmICh0eXBlb2YgX19tb3JlX2RyYXcgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBfX21vcmVfZHJhdygpOwogICAgX19kcmF3aW5nID0gZmFsc2U7CiAgICBfX2xhc3RfZnJhbWUgPSBub3c7CiAgICBpZiAocGxheWluZykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IF9fZHJhdygpKTsKICB9Cn0KLyoqCiAqIFRoZSBjdXJyZW50IGZyYW1lIG51bWJlcgogKgogKiBAY29uc3RhbnQge251bWJlcn0KICovCmxldCBmcmFtZSA9IDA7CgovKioKICogVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgc2luY2UgdGhlIGxhc3QgZnJhbWUuCiAqCiAqIEBjb25zdGFudCB7bnVtYmVyfQogKi8KbGV0IGZyYW1lRGVsdGEgPSAwOwoKLyoqCiAqIFRoZSBoZWlnaHQgb2YgdGhlIGNhbnZhcyBpbiBwaXhlbHMKICoKICogQGNvbnN0YW50IHtudW1iZXJ9CiAqLwpsZXQgaGVpZ2h0ID0gMDsKCi8qKgogKiBUaGUgd2lkdGggb2YgdGhlIGNhbnZhcyBpbiBwaXhlbHMKICoKICogQGNvbnN0YW50IHtudW1iZXJ9CiAqLwpsZXQgd2lkdGggPSAwOwoKLyoqCiAqIFRoZSBjdXJyZW50IHBsYXkgc3RhdGUKICoKICogQGNvbnN0YW50IHtib29sZWFufQogKi8KbGV0IHBsYXlpbmcgPSBmYWxzZTsKCi8qKgogKiBUaGUgYHBvaW50ZXJgIG9iamVjdCByZXByZXNlbnRzIHRoZSBtb3VzZSBjdXJzb3IgKHdoZW4gdXNpbmcKICogYSBtb3VzZSkgb3IgZmluZ2VyIHBvc2l0aW9uIChmb3IgdG91Y2ggZGV2aWNlcyksIGFuZCBtb2RlbHMKICogc2V2ZXJhbCBhc3BlY3RzOgogKgogKiAtIGBhY3RpdmVgIChib29sZWFuKSBXaGV0aGVyIHRoZSBwb2ludGVyIGlzIGV2ZW4gb24gb3Igb3ZlciB0aGUgY2FudmFzLgogKiAtIGB4YCAobnVtYmVyKSBUaGUgcG9pbnRlcidzIHggb2Zmc2V0IGluIHBpeGVscyB3aXRoIHJlc3BlY3QgdG8gdGhlIGNhbnZhcwogKiAtIGB5YCAobnVtYmVyKSBUaGUgcG9pbnRlcidzIHkgb2Zmc2V0IGluIHBpeGVscyB3aXRoIHJlc3BlY3QgdG8gdGhlIGNhbnZhcwogKiAtIGBkb3duYCAoYm9vbGVhbikgV2hldGhlciB0aGUgcG9pbnRlciBpcyAiZW5nYWdlZCIgb3Igbm90CiAqIC0gYGRyYWdgIChib29sZWFuKSBXaGV0aGVyIGEgY2xpY2svdG91Y2gtZHJhZyBpcyBpbiBwcm9ncmVzcwogKiAtIGBtYXJrYCAoe3gseX0pIFdoZW4gZHJhZ2dpbmcsIHRoaXMgcmVwcmVzZW50cyB0aGUgb3JpZ2luYWwgY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnRlciAiZG93biIgZXZlbnQKICoKICogQGNvbnN0YW50IHtvYmplY3R9CiAqLwpjb25zdCBwb2ludGVyID0geyB4OiAwLCB5OiAwIH07CgovKioKICogSWYgYW55IHBvaW50cyB3ZXJlIHJlZ2lzdGVyZWQgYXMgbW92YWJsZSwgYW5kIHRoZSBwb2ludGVyIGlzCiAqIG5lYXIgZW5vdWdoIHRvIGEgbW92YWJsZSBwb2ludCwgdGhpcyB2YWx1ZSB3aWxsIHBvaW50IHRvCiAqIHRoYXQgbW92YWJsZSBwb2ludCwgb3IgYGZhbHNlYCBpZiB0aGUgcG9pbnRlciBpcyBub3QgbmVhcgogKiBhbnkgbW92YWJsZSBwb2ludCAob3IsIG9mIGNvdXJzZSwgdGhlcmUgYXJlIG5vIG1vdmFibGUgcG9pbnRzKQogKgogKiBAY29uc3RhbnQge1BvaW50TGlrZXxmYWxzZX0KICovCmxldCBjdXJyZW50TW92YWJsZSA9IGZhbHNlOwoKLyoqCiAqIFRoZSBga2V5Ym9hcmRgIG9iamVjdCBpcyBhIHRydXRoIHRhYmxlIHRoYXQgY2FuIGJlIGNoZWNrZWQgdG8KICogc2VlIGlmIGFueSBrZXkgaXMgY3VycmVudGx5IHByZXNzZWQsIGFuZCBpZiBzbywgd2hlbiB0aGF0CiAqIGtleXByZXNzIHdhcyBpbml0aWF0ZWQsIGJ5IHN0b3Jpbmc6CiAqCiAqIGBgYAogKiB7CiAqICAgW2tleTpzdHJpbmddOiBkYXRldGltZQogKiB9CiAqIGBgYAogKgogKiBXaGVuIGEga2V5IGlzIHJlbGVhc2VkLCBpdHMgbWFwcGluZyBpcyByZW1vdmVkIGVudGlyZWx5LAogKiByYXRoZXIgdGhhbiBpdCBiZWluZyBzZXQgdG8gYSBmYWxzZXkgdmFsdWUuCiAqCiAqIEBjb25zdGFudCB7b2JqZWN0fQogKi8KY29uc3Qga2V5Ym9hcmQgPSB7fTsKCi8vIGNvbnN0YW50cy4uLgpjb25zdCB7CiAgLyoqCiAgICogVGhlIHJhdGlvIG9mIGEgY2lyY2xlJ3MgY2lyY3VtZmVyZW5jZSB0byBpdHMgZGlhbWV0ZXIuCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUGkKICAgKgogICAqIEBjb25zdGFudCB7bnVtYmVyfQogICAqCiAgICogQHNlZSB7QGxpbmsgVEFVfQogICAqLwogIFBJLAoKICAvKioKICAgKiBUaGUgYmFzZSBmb3IgdGhlIG5hdHVyYWwgbG9nYXJpdGhtLgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0VfKG1hdGhlbWF0aWNhbF9jb25zdGFudCkKICAgKgogICAqIEBjb25zdGFudCB7bnVtYmVyfQogICAqLwogIEUsCn0gPSBNYXRoOwoKY29uc3QgewogIC8qKgogICAqIEEgdmVyeSBzbWFsbCB2YWx1ZSBmb3IgcGVyZm9ybWluZyBpbXByZWNpc2UgbWF0aCBvcGVyYXRpb25zCiAgICogc3VjaCBhcyBjaGVja2luZyB3aGV0aGVyIGEgdmFsdWUgaXMgYXBwcm94aW1hdGVseSB0aGUgc2FtZQogICAqIGFzIHNvbWUgb3RoZXIgdmFsdWUuCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKi8KICBlcHNpbG9uLAoKICAvKioKICAgKiBBIHZlcnkgbGFyZ2UgdmFsdWUgdGhhdCBjYW4gc3RpbGwgYmUgdXNlZCB0byBkcmF3IHRoaW5ncwogICAqIG9uIHRoZSBjYW52YXMgKHN1Y2ggYXMgbGluZXMgZnJvbSAtaHVnZSB0byAraHVnZSkuCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKi8KICBodWdlLAoKICAvKioKICAgKiBUaGUgcmF0aW8gb2YgYSBjaXJjbGUncyBjaXJjdW1mZXJlbmNlIHRvIGl0cyByYWRpdXMsIGkuZS4gMipQSQogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1R1cm5fKGFuZ2xlKSNUYXVfcHJvcG9zYWxzCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKgogICAqIEBzZWUge0BsaW5rIFBJfQogICAqLwogIFRBVSwKfSA9IHsgZXBzaWxvbjogMWUtMTAsIGh1Z2U6IDFfMDAwXzAwMCwgVEFVOiBQSSAqIDIgfTsKCgovKioKICogVGhlIGNvbnN0YW50IGZvciBpbmRpY2F0aW5nIGEgcHJvamVjdG9yIHNob3VsZCBiZSBhICJjYWJpbmV0IiBwcm9qZWN0b3IsCiAqIGkuZS4gYSBwcm9qZWN0b3Igd2l0aG91dCBwZXJzcGVjdGl2ZSwgd2hlcmUgY29vcmRpbmF0ZXMgZnVydGhlciBhd2F5CiAqIGFyZSBkcmF3IHByb2dyZXNzaXZlbHkgbW9yZSB1cCBhbmQgcmlnaHQsIHNpbWlsYXIgdG8gdGhlIGtpbmQgb2YgcGljdHVyZXMKICogb25lIG1pZ2h0IGZpbmQgaW4gYW4gaW5zdHJ1Y3Rpb24gbGVhZmxldCBmb3IgYnVpbGRpbmcgYSBjYWJpbmV0LgogKgogKiBAY29uc3RhbnQge1N5bWJvbH0KICovCmNvbnN0IENBQklORVQgPSBTeW1ib2woYGNhYmluZXQgcHJvamVjdGlvbmApOwoKLyoqCiAqIFRoZSBjb25zdGFudCBmb3IgaW5kaWNhdGluZyBhIHByb2plY3RvciBzaG91bGQgYmUgYSAibm9ybWFsIiBob21vZ2VuZW91cwogKiBwcm9qZWN0b3IsIGkuZS4gcHJvamVjdGlvbiB3aXRoIGEgInBvaW50IGF0IGluZmluaXR5IiBhbmQgbm9ybWFsIHBlcnNwZWN0aXZlCiAqIGFwcGxpZWQuCiAqCiAqIEBjb25zdGFudCB7U3ltYm9sfQogKi8KY29uc3QgSE9NT0dFTkVPVVMgPSBTeW1ib2woYGhvbW9nZW5lb3VzIHByb2plY3Rpb25gKTsKLyoqCiAqIEVuc3VyZSB0aGF0IHRoZXJlIGlzIG5vIGJvcmRlciBhcm91bmQgdGhlIGNhbnZhcyBlbGVtZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRCb3JkZXIoNSwgYHJlZGApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoYGNsaWNrIG1lYCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlclVwKHgsIHkpIHsKICogICAgICAgc2V0Qm9yZGVyKDUsIGByZWRgKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgsIHkpIHsKICogICAgICAgbm9Cb3JkZXIoKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRCb3JkZXJ9CiAqLwpmdW5jdGlvbiBub0JvcmRlcigpIHsKICBzZXRCb3JkZXIoZmFsc2UpOwp9CgovKioKICogRGlzYWJsZSBib3RoIHN0cm9rZSBhbmQgZmlsbCBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KGBOb3cgeW91IHNlZSBtZWAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub0NvbG9yKCk7CiAqICAgICAgIHRleHQoYE5vdyB5b3UgZG9uJ3RgLCB3aWR0aC8yLCBoZWlnaHQvMiArIDI1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRDb2xvcn0KICogQHNlZSB7QGxpbmsgbm9TdHJva2V9CiAqIEBzZWUge0BsaW5rIG5vRmlsbH0KICovCmZ1bmN0aW9uIG5vQ29sb3IoKSB7CiAgbm9GaWxsKCk7CiAgbm9TdHJva2UoKTsKfQoKLyoqCiAqIEhpZGUgdGhlIGN1cnNvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgI0ZGMDJgKTsKICogICAgICAgcmVjdCgwLCAwLCB3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgICBzZXRDb2xvcihgIzBGRjJgKTsKICogICAgICAgcmVjdCh3aWR0aC8yLCAwLCB3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlck1vdmUoeCwgeSkgewogKiAgICAgICBpZiAoeCA8IHdpZHRoLzIpIHsKICogICAgICAgICBzZXRDdXJzb3IoQVVUTyk7CiAqICAgICAgIH0gZWxzZSB7CiAqICAgICAgICAgbm9DdXJzb3IoKTsKICogICAgICAgfQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldEN1cnNvcn0KICovCmZ1bmN0aW9uIG5vQ3Vyc29yKCkgewogIF9fY2FudmFzLnN0eWxlLmN1cnNvciA9IGBub25lYDsKfQoKLyoqCiAqIERpc2FibGUgdGhlIGZpbGwgY29sb3IuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKDEpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcmVjdCgyMCwgNzAsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYGZpbGxlZGAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgcmVjdCgzMCwgODAsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYG5vdCBmaWxsZWRgLCB3aWR0aC8yLCBoZWlnaHQvMiArIDI1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRGaWxsfQogKi8KZnVuY3Rpb24gbm9GaWxsKCkgewogIHNldEZpbGwoYHRyYW5zcGFyZW50YCk7Cn0KCi8qKgogKiBEaXNhYmxlIHRoZSBkZWZhdWx0IGdyaWQgYmFja2dyb3VuZC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KGBjbGljayBtZWAsIHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJVcCh4LCB5KSB7CiAqICAgICAgIHNldEdyaWQoMjAsIGBsaWdodGdyZXlgKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgsIHkpIHsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICAgIHJlZHJhdygpCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2V0R3JpZH0KICovCmZ1bmN0aW9uIG5vR3JpZCgpIHsKICBfX2RyYXdfZ3JpZCA9IGZhbHNlOwp9CgovKioKICogU2V0IHRoZSBsaW5lIHN0cm9rZSB0byAic29saWQiLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRMaW5lRGFzaCgxKTsKICogICAgICAgbGluZSgwLDIwLHdpZHRoLDUwKTsKICogICAgICAgc2V0TGluZURhc2goNSk7CiAqICAgICAgIGxpbmUoMCwzMCx3aWR0aCw5MCk7CiAqICAgICAgIHNldExpbmVEYXNoKDEsMiwzLDQpOwogKiAgICAgICBsaW5lKDAsNDAsd2lkdGgsMTMwKTsKICogICAgICAgbm9MaW5lRGFzaCgpOwogKiAgICAgICBsaW5lKDAsNTAsd2lkdGgsMTgwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRMaW5lRGFzaH0KICovCgpmdW5jdGlvbiBub0xpbmVEYXNoKCkgewogIF9fY3R4LnNldExpbmVEYXNoKFtdKTsKfQoKLyoqCiAqIERpc2FibGUgdGhlIHN0cm9rZSBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICByZWN0KDIwLCA3MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub1N0cm9rZSgpOwogKiAgICAgICByZWN0KDQyLCA4MiwgMjAsIDIwKTsKICogICAgICAgdGV4dChgbm90IHN0cm9rZWRgLCB3aWR0aC8yLCBoZWlnaHQvMiArIDI1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRTdHJva2V9CiAqLwoKZnVuY3Rpb24gbm9TdHJva2UoKSB7CiAgc2V0U3Ryb2tlKGB0cmFuc3BhcmVudGApOwp9CgovKioKICogRGlzYWJsZSB0ZXh0IHN0cm9raW5nLCBidXQgbm90IHJlZ3VsYXIgc2hhcGUgc3Ryb2tpbmcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKDEpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgcmVjdCgyMCwgNzAsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYHN0cm9rZWRgLCB3aWR0aC8yLCBoZWlnaHQvMiAtIDI1KTsKICogICAgICAgbm9UZXh0U3Ryb2tlKCk7CiAqICAgICAgIHJlY3QoNDIsIDgyLCAyMCwgMjApOwogKiAgICAgICB0ZXh0KGBub3Qgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldFRleHRTdHJva2V9CiAqLwoKZnVuY3Rpb24gbm9UZXh0U3Ryb2tlKCkgewogIHNldFRleHRTdHJva2UoZmFsc2UsIHVuZGVmaW5lZCk7Cn0KLyoqCiAqIEFkZCBhIHNsaWRlciB0byB5b3VyIGZpZ3VyZSwgYWxsb3dpbmcgdXNlcnMgdG8gY29udHJvbAogKiBhIHZhcmlhYmxlIGluIHlvdXIgZ3JhcGhpY3MgY29kZSBkaXJlY3RseSBieSBpbnRlcmFjdGluZwogKiB3aXRoIHRoYXQgb24tcGFnZSBzbGlkZXIsIHdoaWNoIGlzIGVzcGVjaWFsbHkgaW1wb3J0YW50IGlmCiAqIHlvdSB3YW50IHlvdXIgZ3JhcGhpY3MgdG8gYmUgdXNlYWJsZSBieSB1c2VycyB3aG8gZG9uJ3QKICogaGF2ZSwgb3IgY2Fubm90IHVzZSwgYSBtb3VzZS4KICoKICogVGhlIGBwcm9wTGFiZWxgIHZhbHVlIHNob3VsZCBiZSB0aGUgbmFtZSBvZiB0aGUgdmFyaWFibGUKICogdGhhdCB5b3VyIGdyYXBoaWNzIGNvZGUgdXNlcywgYW5kIHNob3VsZCBfbm90XyBiZSAicHJlYWxsb2NhdGVkIgogKiBpbiB5b3VyIGNvZGUgd2l0aCBhIGNvbnN0LCBsZXQsIG9yIHZhcjogaXQgd2lsbCBhdXRvbWF0aWNhbGx5CiAqIGdldCBhZGRlZCBhcyBwYXJ0IG9mIHRoZSBzb3VyY2UgbG9hZGluZyBwcm9jZXNzLgogKgogKiBUaGUgb3B0aW9ucyBvYmplY3QgYWNjZXB0cyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXMgYW5kIHZhbHVlczoKICoKICogLSBtaW4gLSB0aGUgc2xpZGVyJ3MgbWluaW11bSB2YWx1ZSwgZGVmYXVsdHMgdG8gMAogKiAtIG1heCAtIHRoZSBzbGlkZXIncyBtYXhpbXVtIHZhbHVlLCBkZWZhdWx0cyB0byAxCiAqIC0gc3RlcCAtIHRoZSBzdGVwIHNpemUsIGRlZmF1bHRzIHRvIChtYXggLSBtaW4pLzEwCiAqIC0gdmFsdWUgLSB0aGUgaW5pdGlhbCB2YWx1ZSwgZGVmYXVsdHMgdG8gKG1heCArIG1pbikvMgogKiAtIGNsYXNzZXMgLSB0aGUgQ1NTIGNsYXNzZXMgdGhhdCB3aWxsIGJlIHVzZWQsIGRlZmF1bHRzIHRvIGAic2xpZGVyImAKICogLSB0cmFuc2Zvcm0gLSBhIHZhbHVlIHByZXByb2Nlc3NvciAgZGVmYXVsdHMgdG8gKHYpID0+IHYKICoKICogVGhlIGB0cmFuc2Zvcm1gIHByZS1wcm9jZXNzb3IgcnVucyBhZnRlciB0aGUgdXNlciB1cGRhdGVzCiAqIHRoZSBzbGlkZXIsIGJ1dCBiZWZvcmUgaXRzIHZhbHVlIGdldHMgYXNzaWduZWQgdG8geW91ciB2YXJpYWJsZSwKICogc28gdGhhdCB5b3UgY2FuIG1hcCBpdCB0byBzb21ldGhpbmcgZWxzZSAoZm9yIGluc3RhbmNlLCBudW1iZXJzCiAqIGluIG9uZSByYW5nZSB0byBudW1iZXJzIGluIGEgY29tcGxldGVseSBkaWZmZXJlbnQgcmFuZ2UsIG9yIGV2ZW4KICogbnVtYmVycyB0byBzdHJpbmdzIG9yIGVudGlyZSBvYmplY3RzKQogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoNDAwLCAyMDApOwogKiAgICAgICBhZGRTbGlkZXIoYGJnQ29sb3JgLCB7CiAqICAgICAgICAgbWluOiAwLAogKiAgICAgICAgIG1heDogMjU1LAogKiAgICAgICAgIHN0ZXA6IDEsCiAqICAgICAgICAgdmFsdWU6IDIwMCwKICogICAgICAgICB0cmFuc2Zvcm06ICh2KSA9PiB7CiAqICAgICAgICAgICAvLyBjb252ZXJ0IHYgaW50byBhIGhleCBjb2xvciBjb2RlCiAqICAgICAgICAgICB2ID0gKHYpLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCBgMGApOwogKiAgICAgICAgICAgcmV0dXJuIGAjJHt2fSR7dn0ke3Z9YDsKICogICAgICAgICB9CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYmdDb2xvcik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IHZhck5hbWUgVGhlIG5hbWUgZm9yIHRoZSB2YXJpYWJsZSB0aGlzIHNsaWRlciBnZXRzIHRpZWQgdG8uCiAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIFNlZSBkZXNjcmlwdGlvbgogKiBAcmV0dXJucyB7SFRNTElucHV0RWxlbWVudH0gdGhlIEhUTUwgaW5wdXQgZWxlbWVudCBmb3IgdGhpcyBzbGlkZXIKICoKICogQHNlZSB7QGxpbmsgY2xlYXJTbGlkZXJzfQogKi8KZnVuY3Rpb24gYWRkU2xpZGVyKHByb3BMYWJlbCwgYXNzaWduLCBvcHRpb25zID0ge30pIHsKICBsZXQgewogICAgbWluLAogICAgbWF4LAogICAgc3RlcCwKICAgIHZhbHVlLAogICAgY2xhc3NlcyA9IGBzbGlkZXJgLAogICAgdHJhbnNmb3JtID0gKHYpID0+IHYsCiAgfSA9IG9wdGlvbnM7CgogIG1pbiA9IG1pbiA9PT0gdW5kZWZpbmVkID8gMCA6IG1pbjsKICBtYXggPSBtYXggPT09IHVuZGVmaW5lZCA/IDEgOiBtYXg7CiAgc3RlcCA9IHN0ZXAgPT09IHVuZGVmaW5lZCA/IChtYXggLSBtaW4pIC8gMTAgOiBzdGVwOwogIHZhbHVlID0gdmFsdWUgPT09IHVuZGVmaW5lZCA/IChtYXggKyBtaW4pIC8gMiA6IHZhbHVlOwoKICAvLyBjdXN0b20gInJvdW5kaW5nIiwgcHVyZWx5IGZvciBzdHJpbmdzCiAgY29uc3Qgcm91bmQgPSAodiwgZCA9IDQpID0+IHsKICAgIHYgPSBgJHt2fWA7CiAgICBjb25zdCBmcyA9IHYuaW5kZXhPZihgLmApOwogICAgaWYgKGZzICE9PSAtMSkgewogICAgICBsZXQgcHJlYyA9IGQgLSBmcyA+IDAgPyBkIC0gZnMgOiAwOwogICAgICB2ID0gdi5zdWJzdHJpbmcoMCwgZnMgKyBwcmVjKTsKICAgIH0KICAgIHJldHVybiB2OwogIH07CgogIGNvbnN0IGNyZWF0ZSA9ICh0YWcpID0+IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTsKCiAgbGV0IHNsaWRlciA9IGNyZWF0ZShgaW5wdXRgKTsKICBzbGlkZXIudHlwZSA9IGByYW5nZWA7CiAgc2xpZGVyLm1pbiA9IG1pbjsKICBzbGlkZXIubWF4ID0gbWF4OwogIHNsaWRlci5zdGVwID0gc3RlcDsKICBzbGlkZXIuc2V0QXR0cmlidXRlKGB2YWx1ZWAsIHZhbHVlKTsKICBzbGlkZXIuc2V0QXR0cmlidXRlKGBjbGFzc2AsIGNsYXNzZXMpOwoKICBjb25zdCB1cGRhdGUgPSAoeyB2YWx1ZSB9KSA9PiB7CiAgICB2YWx1ZUZpZWxkLnRleHRDb250ZW50ID0gcm91bmQodmFsdWUpOwogICAgYXNzaWduKHRyYW5zZm9ybShwYXJzZUZsb2F0KHZhbHVlKSkpOwogICAgaWYgKCFwbGF5aW5nKSByZWRyYXcoKTsKICB9OwoKICBzbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcihgaW5wdXRgLCAoeyB0YXJnZXQgfSkgPT4gdXBkYXRlKHRhcmdldCkpOwoKICBsZXQgdGFibGUgPSBfX2VsZW1lbnQucXVlcnlTZWxlY3RvcihgdGFibGUuc2xpZGVyLXdyYXBwZXJgKTsKICBpZiAoIXRhYmxlKSB7CiAgICB0YWJsZSA9IGNyZWF0ZShgdGFibGVgKTsKICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoYHNsaWRlci13cmFwcGVyYCk7CiAgICBfX2VsZW1lbnQucHJlcGVuZCh0YWJsZSk7CiAgfQogIGxldCB0ciA9IGNyZWF0ZShgdHJgKTsKCiAgbGV0IHRkID0gY3JlYXRlKGB0ZGApOwogIGxldCBsYWJlbCA9IGNyZWF0ZShgbGFiZWxgKTsKICBsYWJlbC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbGFiZWxgKTsKICBsYWJlbC5pbm5lckhUTUwgPSBwcm9wTGFiZWwKICAgIC5yZXBsYWNlKC9fKC4rKSQvLCBgPHN1Yj4kMTwvc3ViPmApCiAgICAucmVwbGFjZSgvKFxkKykvLCBgPHN1Yj4kMTwvc3ViPmApOwogIHRkLmFwcGVuZChsYWJlbCk7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLW1pbmApOwogIHRkLnRleHRDb250ZW50ID0gcm91bmQoc2xpZGVyLm1pbik7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdGQud2lkdGggPSBgKmA7CiAgdGQuYXBwZW5kKHNsaWRlcik7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLW1heGApOwogIHRkLnRleHRDb250ZW50ID0gcm91bmQoc2xpZGVyLm1heCk7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdmFyIHZhbHVlRmllbGQgPSBjcmVhdGUoYGxhYmVsYCk7IC8vIGZ1bmN0aW9uIHNjb3BlZAogIHZhbHVlRmllbGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLXZhbHVlYCk7CiAgdGQuYXBwZW5kKHZhbHVlRmllbGQpOwogIHRyLmFwcGVuZCh0ZCk7CiAgdGQuYWRkRXZlbnRMaXN0ZW5lcihgcG9pbnRlcmRvd25gLCAoKSA9PiB7CiAgICBjb25zdCB2YWx1ZSA9IHByb21wdChgbmV3IHZhbHVlP2AsIHNsaWRlci52YWx1ZSk7CiAgICBpZiAodmFsdWUgIT09IG51bGwpIHsKICAgICAgc2xpZGVyLnZhbHVlID0gdmFsdWU7CiAgICAgIHVwZGF0ZSh7IHZhbHVlIH0pOwogICAgfQogIH0pOwoKICB0YWJsZS5hcHBlbmQodHIpOwoKICB1cGRhdGUoc2xpZGVyKTsKICByZXR1cm4gc2xpZGVyOwp9CgovKioKICogUmVtb3ZlIGFsbCBzbGlkZXJzIGZvciB5b3VyIGZpZ3VyZSBmcm9tIHRoZSBwYWdlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRTbGlkZXIoYHhgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KGBjbGljayB0byBjbGVhcmAsIHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKCkgewogKiAgICAgICBjbGVhclNsaWRlcnMoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBhZGRTbGlkZXJ9CiAqLwoKZnVuY3Rpb24gY2xlYXJTbGlkZXJzKCkgewogIGNvbnN0IHRhYmxlID0gX19lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYHRhYmxlLnNsaWRlci13cmFwcGVyYCk7CiAgaWYgKHRhYmxlKSB0YWJsZS5pbm5lckhUTUwgPSBgYDsKfQoKLyoqCiAqIEFkZCBhIGJ1dHRvbiBiZWxvdyB5b3VyIGZpZ3VyZSB0aGF0IGNhbiB0cmlnZ2VyIGV2ZW50LWJhc2VkCiAqIGNvZGUsIHdoaWNoIGlzIGVzcGVjaWFsbHkgaW1wb3J0YW50IGlmIHlvdSB3YW50IHlvdXIgZ3JhcGhpY3MKICogdG8gYmUgdXNlYWJsZSBieSB1c2VycyB3aG8gZG9uJ3QgaGF2ZSwgb3IgY2Fubm90IHVzZSwgYSBtb3VzZS4KICoKICogb25DbGljayBpcyBzaW1pbGFyIHRvIHRoZSBzdGFuZGFyZCBKUyBldmVudCBoYW5kbGVyLCBleGNlcHQKICogdGhhdCB0aGUgY2FsbCBhcmd1bWVudCBpcyBhIHJlZmVyZW5jZSB0byB5b3VyIGJ1dHRvbiwgbm90CiAqIHRoZSBjbGljayBldmVudC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IGNvbG9ycyA9IFtgd2hpdGVgLCBgYmxhY2tgXTsKICogICAgIGxldCBiZ0NvbG9yID0gMDsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGBmbGlwIGJhY2tncm91bmRgLCAoYnV0dG9uKSA9PiB7CiAqICAgICAgICAgYmdDb2xvciA9IC0oYmdDb2xvciAtIDEpOwogKiAgICAgICAgIHJlZHJhdygpOwogKiAgICAgICB9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGNvbG9yc1tiZ0NvbG9yXSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGxhYmVsIFRoZSB0ZXh0IGxhYmVsIGZvciB5b3VyIGJ1dHRvbgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkNsaWNrIFRoZSBjbGljayBoYW5kbGluZyBmdW5jdGlvbiwgc2VlIGRlc2NyaXB0aW9uLgogKiBAcmV0dXJucyB7SFRNTEJ1dHRvbkVsZW1lbnR9IFRoZSBidXR0b24gZWxlbWVudCB0aGlzIGFkZGVkIHRvIHRoZSBwYWdlCiAqCiAqIEBzZWUge0BsaW5rIGNsZWFyQnV0dG9uc30KICovCmZ1bmN0aW9uIGFkZEJ1dHRvbihsYWJlbCwgb25DbGljaykgewogIGlmICghb25DbGljaykgdGhyb3cgbmV3IEVycm9yKGBhIGJ1dHRvbiBtdXN0IGhhdmUgYW4gb25DbGljayBoYW5kbGVyYCk7CiAgY29uc3QgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgYnV0dG9uYCk7CiAgYnRuLmNsYXNzTGlzdC5hZGQoYGdyYXBoaWNzLWVsZW1lbnQtYnV0dG9uYCk7CiAgYnRuLnRleHRDb250ZW50ID0gbGFiZWw7CiAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoYGNsaWNrYCwgKCkgPT4gb25DbGljayhidG4pKTsKICBfX2VsZW1lbnQucHJlcGVuZChidG4pOwogIHJldHVybiBidG47Cn0KCi8qKgogKiBSZW1vdmUgYWxsIGJ1dHRvbnMgZm9yIHlvdXIgZmlndXJlIGZyb20gdGhlIHBhZ2UuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGFkZEJ1dHRvbihgdGhpcyBkb2VzIG5vdGhpbmdgLCAoKSA9PiB7fSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dChgY2xpY2sgdG8gY2xlYXJgLCB3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bigpIHsKICogICAgICAgY2xlYXJCdXR0b25zKCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgYWRkQnV0dG9ufQogKi8KZnVuY3Rpb24gY2xlYXJCdXR0b25zKCkgewogIF9fZWxlbWVudAogICAgLnF1ZXJ5U2VsZWN0b3JBbGwoYGJ1dHRvbi5ncmFwaGljcy1lbGVtZW50LWJ1dHRvbmApCiAgICAuZm9yRWFjaCgoZSkgPT4gZS5yZW1vdmUoKSk7Cn0KLyoqCiAqIERyYXcgYSBjaXJjdWxhciBhcmMgd2l0aCByYWRpdXMgYHJgIGF0ICh4LHkpLAogKiBzdGFydGluZyBhdCBhbmdsZSBgc2AgYW5kIGVuZGluZyBhdCBhbmdsZSBgZWAuCiAqIElmIGB3ZWRnZWAgaXMgdHJ1ZSwgdGhpcyB3aWxsIGRyYXcgYSBjbG9zZWQKICogc2hhcGUgdGhhdCBpcyBhbmNob3JlZCBhdCAoeCx5KS4gSWYgb21pdHRlZAogKiBvciBleHBsaWNpdGx5IHNldCB0byBmYWxzZSwgdGhpcyB3aWxsIGRyYXcKICogYW4gb3BlbiBzaGFwZSB3aXRoIGEgZmlsbCB0aGF0IGNvbm5lY3RzIHRoZQogKiBmaXJzdCBhbmQgbGFzdCBwb2ludCBvbiB0aGUgYXJjLCBidXQgbm8gY2xvc2luZwogKiBzdHJva2UuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGAjRjAwMmApOwogKiAgICAgICBhcmMod2lkdGgvMiArIDMwLCBoZWlnaHQvMiAtIDQwLCA0MCwgMCwgMC42NipUQVUpOwogKiAgICAgICBhcmMod2lkdGgvMiAtIDMwLCBoZWlnaHQvMiArIDIwLCA0MCwgMCwgMC42NipUQVUsIHRydWUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBjaXJjdWxhciBjZW50ZXIgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgY2lyY3VsYXIgY2VudGVyIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHJhZGl1cyBUaGUgcmFkaXVzIG9mIHRoaXMgYXJjIGluIHBpeGVscwogKiBAcGFyYW0ge251bWJlcn0gc3RhcnRBbmdsZSBUaGUgc3RhcnQgYW5nbGUgZm9yIHRoaXMgYXJjIGluIHJhZGlhbnMKICogQHBhcmFtIHtudW1iZXJ9IGVuZEFuZ2xlIFRoZSBlbmQgYW5nbGUgZm9yIHRoaXMgYXJjIGluIHJhZGlhbnMKICogQHBhcmFtIHtib29sZWFufSBkcmF3V2VkZ2UgQSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0byBkcmF3IGEgd2VkZ2Ugb3IgY2FwcGVkIGNpcmNsZSAoZGVmYXVsdD1jaXJjbGUpCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwb2ludCBUaGUgY2lyY3VsYXIgY2VudGVyIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHJhZGl1cyBUaGUgcmFkaXVzIG9mIHRoaXMgYXJjIGluIHBpeGVscwogKiBAcGFyYW0ge251bWJlcn0gc3RhcnRBbmdsZSBUaGUgc3RhcnQgYW5nbGUgZm9yIHRoaXMgYXJjIGluIHJhZGlhbnMKICogQHBhcmFtIHtudW1iZXJ9IGVuZEFuZ2xlIFRoZSBlbmQgYW5nbGUgZm9yIHRoaXMgYXJjIGluIHJhZGlhbnMKICogQHBhcmFtIHtib29sZWFufSBkcmF3V2VkZ2UgQSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0byBkcmF3IGEgd2VkZ2Ugb3IgY2FwcGVkIGNpcmNsZSAoZGVmYXVsdD1jaXJjbGUpCiAqCiAqIEBzZWUge0BsaW5rIGNpcmNsZX0KICovCmZ1bmN0aW9uIGFyYyh4LCB5LCByLCBzID0gMCwgZSA9IFRBVSwgd2VkZ2UgPSBmYWxzZSkgewogIC8vIEZJWE1FOiBUT0RPOiBuZWVkcyBfX2FyYzNkIGFuZCBfX2FyYzJkCiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB3ZWRnZSA9IGU7CiAgICBlID0gczsKICAgIHMgPSByOwogICAgciA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgY29uc3Qgc3RlcCA9IDAuMTsKICBzdGFydCgpOwogIGlmICh3ZWRnZSkgdmVydGV4KHgsIHkpOwogIGxldCBhID0gczsKICB2ZXJ0ZXgoeCArIHIgKiBjb3MocyksIHkgKyByICogc2luKHMpKTsKICBmb3IgKGEgPSBzICsgc3RlcDsgYSA8IGU7IGEgKz0gc3RlcCkgewogICAgdmVydGV4KHggKyByICogY29zKGEpLCB5ICsgciAqIHNpbihhKSk7CiAgfQogIHZlcnRleCh4ICsgciAqIGNvcyhlKSwgeSArIHIgKiBzaW4oZSkpOwogIGlmICh3ZWRnZSkgdmVydGV4KHgsIHkpOwogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIHBhaXIgb2YgaG9yaXpvbnRhbCBhbmQgdmVydGljYWwgYXhlcy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Qm9yZGVyKDEsIGBibGFja2ApOwogKiAgICAgICBzZXRHcmlkKDUwLCBgbGlnaHRncmV5YCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBzZXRDdXJzb3IoYG5vbmVgKTsKICogICAgICAgY2xlYXIoYCNmZmZlZjdgKTsKICogICAgICAgc2V0Q29sb3IoYCMzMzNgKTsKICogICAgICAgdHJhbnNsYXRlKDI1LDI1KTsKICogICAgICAgYXhlcygKICogICAgICAgICBgdGltZSAocylgLCAwLCB3aWR0aC01MCwKICogICAgICAgICBgZGlzdGFuY2UgKGttKWAsIDAsIGhlaWdodC01MCwKICogICAgICAgICAiMCIsICI2MCIsCiAqICAgICAgICAgIjAiLCAiNTAwIik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGhMYWJlbCB0aGUgaG9yaXpvbnRhbCBheGlzIGxhYmVsCiAqIEBwYXJhbSB7bnVtYmVyfSBocyB0aGUgc3RhcnQgKGxlZnQpIHBpeGVsIHZhbHVlIGZvciB0aGUgaG9yaXpvbnRhbCBheGlzCiAqIEBwYXJhbSB7bnVtYmVyfSBoZSB0aGUgZW5kIChyaWdodCkgcGl4ZWwgdmFsdWUgZm9yIHRoZSBob3Jpem9udGFsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IHZMYWJlbCB0aGUgdmVydGljYWwgYXhpcyBsYWJlbAogKiBAcGFyYW0ge251bWJlcn0gdnMgdGhlIHN0YXJ0ICh0b3ApIHBpeGVsIHZhbHVlIGZvciB0aGUgdmVydGljYWwgYXhpcwogKiBAcGFyYW0ge251bWJlcn0gdmUgdGhlIGVuZCAoYm90dG9tKSBwaXhlbCB2YWx1ZSBmb3IgdGhlIHZlcnRpY2FsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IGhzTGFiZWw/IGFuIG9wdGlvbmFsIGxhYmVsIGZvciB0aGUgc3RhcnQgKGxlZnQpIG9mIHRoZSBob3Jpem9udGFsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IGhlTGFiZWw/IGFuIG9wdGlvbmFsIGxhYmVsIGZvciB0aGUgZW5kIChyaWdodCkgb2YgdGhlIGhvcml6b250YWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gdnNMYWJlbD8gYW4gb3B0aW9uYWwgbGFiZWwgZm9yIHRoZSBzdGFydCAodG9wKSBvZiB0aGUgdmVydGljYWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gdmVMYWJlbD8gYW4gb3B0aW9uYWwgbGFiZWwgZm9yIHRoZSBlbmQgKGJvdHRvbSkgb2YgdGhlIHZlcnRpY2FsIGF4aXMKICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiBheGVzKAogIGhMYWJlbCwKICBocywKICBoZSwKICB2TGFiZWwsCiAgdnMsCiAgdmUsCiAgaHNMYWJlbCA9IGZhbHNlLAogIGhlTGFiZWwgPSBmYWxzZSwKICB2c0xhYmVsID0gZmFsc2UsCiAgdmVMYWJlbCA9IGZhbHNlCikgewogIGxpbmUoaHMsIDAsIGhlLCAwKTsKICBsaW5lKDAsIHZzLCAwLCB2ZSk7CgogIGNvbnN0IGhwb3MgPSAwIC0gNTsKICB0ZXh0KGAke2hMYWJlbH0g4oaSYCwgd2lkdGggLyAyICsgNSwgaHBvcywgUklHSFQpOwogIHRleHQoaHNMYWJlbCA/IGhzTGFiZWwgOiBocywgaHMsIGhwb3MsIFJJR0hUKTsKICB0ZXh0KGhlTGFiZWwgPyBoZUxhYmVsIDogaGUsIGhlLCBocG9zLCBSSUdIVCk7CgogIGNvbnN0IHZwb3MgPSAtNTsKICBzYXZlKCk7CiAgdHJhbnNsYXRlKHZwb3MsIGhlaWdodCAvIDIpOwogIHJvdGF0ZSgtUEkgLyAyKTsKICB0ZXh0KGAke3ZMYWJlbH1gLCAwLCAwLCBMRUZUKTsKICByZXN0b3JlKCk7CiAgdGV4dChg4oaTYCwgdnBvcywgaGVpZ2h0IC8gMiArIDE2LCBSSUdIVCk7CiAgdGV4dCh2c0xhYmVsID8gdnNMYWJlbCA6IHZzLCB2cG9zLCB2cyArIDUsIFJJR0hUKTsKICB0ZXh0KHZlTGFiZWwgPyB2ZUxhYmVsIDogdmUsIHZwb3MsIHZlLCBSSUdIVCk7Cn0KCi8qKgogKiBEcmF3IG9uZSBvciBtb3JlIEJlemllciBjdXJ2ZXMgZnJvbSBhbiBhcnJheQogKiBvZiBQb2ludCBvciBQb2ludC1saWtlcyB0aGF0IGltcGxlbWVudDoKICoKICogYGBgCiAqIHsKICogICB4OiBudW1iZXIKICogICB5OiBudW1iZXIKICogfQogKiBgYGAKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYCNGMDAyYCk7CiAqICAgICAgIGJlemllcigKICogICAgICAgICBuZXcgUG9pbnQoMjAsIGhlaWdodCAtIDU1KSwKICogICAgICAgICBuZXcgUG9pbnQoMjAsIDI1KSwKICogICAgICAgICB7IHg6IHdpZHRoIC0gMjAsIHk6IDI1fSwKICogICAgICAgICB7IHg6IHdpZHRoIC0gMjAsIHk6IGhlaWdodCAtIDU1fQogKiAgICAgICApOwogKiAgICAgICBub0ZpbGwoKQogKiAgICAgICBiZXppZXIoCiAqICAgICAgICAgbmV3IFBvaW50KDAsIGhlaWdodCAtIDIwKSwKICogICAgICAgICBuZXcgUG9pbnQod2lkdGggLSAyMCwgaGVpZ2h0IC0gMjApLAogKiAgICAgICAgIHsgeDogMjAsIHk6IDIwfSwKICogICAgICAgICB7IHg6IHdpZHRoLCB5OiAyMH0KICogICAgICAgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcls4XX0gLi4uY29vcmRpbmF0ZXMgRWlnaHQgeCwgeSB2YWx1ZXMuCiAqIEBwYXJhbSB7bnVtYmVyWzZuXX0gLi4uYWRkaXRpb25hbENvb3JkaW5hdGVzPyBNdWx0aXBsZXMgb2Ygc2l4IHgsIHkgdmFsdWVzLgogKgogKiBAcGFyYW0ge1BvaW50TGlrZVs0XX0gLi4uY29vcmRpbmF0ZXMgRm91ciB7eCx5fSBjb29yZGluYXRlcy4KICogQHBhcmFtIHtQb2ludExpa2VbM25dfSAuLi5hZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IE11bHRpcGxlcyBvZiB0aHJlZSB7eCx5fSBjb29yZGluYXRlcy4KICoKICogQHNlZSB7QGxpbmsgYnNwbGluZX0KICogQHNlZSB7QGxpbmsgc3BsaW5lfQogKi8KZnVuY3Rpb24gYmV6aWVyKC4uLmFyZ3MpIHsKICAvLyBGSVhNRTogVE9ETzogbmVlZHMgX19iZXppZXIzZCBhbmQgX19iZXppZXIyZAogIGxldCBwb2ludHMgPSBhcmdzOwoKICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09IGBudW1iZXJgKSB7CiAgICBwb2ludHMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkgKz0gMikgewogICAgICBwb2ludHMucHVzaCh7IHg6IGFyZ3NbaV0sIHk6IGFyZ3NbaSArIDFdIH0pOwogICAgfQogIH0KCiAgY29uc3QgYiA9ICh0LCBhLCBiLCBjLCBkKSA9PiB7CiAgICBjb25zdCBtdCA9IDEgLSB0OwogICAgcmV0dXJuIGEgKiBtdCAqKiAzICsgMyAqIGIgKiBtdCAqKiAyICogdCArIDMgKiBjICogbXQgKiB0ICoqIDIgKyBkICogdCAqKiAzOwogIH07CgogIGxldCBbcDAsIC4uLnJlc3RdID0gcG9pbnRzOwogIHN0YXJ0KCk7CiAgZm9yIChsZXQgaSA9IDAsIGUgPSByZXN0Lmxlbmd0aDsgaSA8IGU7IGkgKz0gMykgewogICAgbGV0IFtwMSwgcDIsIHAzXSA9IHJlc3Quc2xpY2UoaSwgaSArIDMpOwogICAgaWYgKHAxICYmIHAyICYmIHAzKSB7CiAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgMTsgdCArPSAwLjAxKSB7CiAgICAgICAgdmVydGV4KGIodCwgcDAueCwgcDEueCwgcDIueCwgcDMueCksIGIodCwgcDAueSwgcDEueSwgcDIueSwgcDMueSkpOwogICAgICB9CiAgICAgIHZlcnRleChwMy54LCBwMy55KTsKICAgICAgcDAgPSBwMzsKICAgIH0KICB9CiAgZW5kKCk7Cn0KCi8qKgogKiBEcmF3IGEgQi1zcGxpbmUgdXNpbmcgZm91ciBvciBtb3JlIFBvaW50IG9yCiAqIFBvaW50LWxpa2VzIHRoYXQgaW1wbGVtZW50OgogKgogKiBgYGAKICogewogKiAgIHg6IG51bWJlcgogKiAgIHk6IG51bWJlcgogKiB9CiAqIGBgYAogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHJhbmdlKDAsIFRBVSwgUEkgLyA1LCAoYSkgPT4gcG9pbnRzLnB1c2goCiAqICAgICAgICAgbmV3IFBvaW50KAogKiAgICAgICAgICAgcmFuZG9tKDMwKSArIDUwICogY29zKGEpLAogKiAgICAgICAgICAgcmFuZG9tKDMwKSArIDUwICogc2luKGEpCiAqICAgICAgICAgKQogKiAgICAgICApKTsKICogICAgICAgc2V0TW92YWJsZSguLi5wb2ludHMpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwogKiAgICAgICBub1N0cm9rZSgpOwogKiAgICAgICBzZXRGaWxsKGAjMDAwMmApOwogKiAgICAgICBic3BsaW5lKC4uLnBvaW50cyk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgcG9pbnRzLmZvckVhY2gocCA9PiBwb2ludChwKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJbOF19IC4uLmNvb3JkaW5hdGVzIEVpZ2h0IHgsIHkgdmFsdWVzLgogKiBAcGFyYW0ge251bWJlclsybl19IC4uLmFkZGl0aW9uYWxDb29yZGluYXRlcz8gTXVsdGlwbGVzIG9mIHgsIHkgdmFsdWVzLgogKgogKiBAcGFyYW0ge1BvaW50TGlrZVs0XX0gLi4uY29vcmRpbmF0ZXMgRm91ciB7eCx5fSBjb29yZGluYXRlcy4KICogQHBhcmFtIHtQb2ludExpa2Vbbl19IC4uLmFkZGl0aW9uYWxDb29yZGluYXRlcz8gWmVybyBvciBtb3JlIHt4LHl9IGNvb3JkaW5hdGVzLgogKgogKiBAc2VlIHtAbGluayBiZXppZXJ9CiAqIEBzZWUge0BsaW5rIHNwbGluZX0KICovCgpmdW5jdGlvbiBic3BsaW5lKC4uLmFyZ3MpIHsKICAvLyBGSVhNRTogVE9ETzogbmVlZHMgX19zcGxpbmUzZCBhbmQgX19zcGxpbmUyZAoKICBsZXQgb3BlbiA9IHRydWU7CiAgaWYgKHR5cGVvZiBhcmdzW2FyZ3MubGVuZ3RoIC0gMV0gPT09IGBib29sZWFuYCkgewogICAgb3BlbiA9IGFyZ3Muc3BsaWNlKGFyZ3MubGVuZ3RoIC0gMSwgMSlbMF07CiAgfQoKICBsZXQgcG9pbnRzID0gYXJnczsKCiAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBgbnVtYmVyYCkgewogICAgcG9pbnRzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgcG9pbnRzLnB1c2goeyB4OiBhcmdzW2ldLCB5OiBhcmdzW2kgKyAxXSB9KTsKICAgIH0KICB9CgogIHN0YXJ0KCk7CiAgbmV3IEJTcGxpbmUocG9pbnRzLCBvcGVuKS5nZXRMVVQoKS5mb3JFYWNoKChwKSA9PiB2ZXJ0ZXgocC54LCBwLnkpKTsKICBlbmQoKTsKfQoKLyoqCiAqIERyYXcgYSBjaXJjbGUgd2l0aCByYWRpdXMgYHJgIGF0IGB4LHlgLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgI0YwMDJgKTsKICogICAgICAgY2lyY2xlKHdpZHRoLzIsIGhlaWdodC8yLCA4MCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGNpcmNsZSdzIGNlbnRlciB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBjaXJjbGUncyBjZW50ZXIgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gciBUaGUgY2lyY2xlJ3MgcmFkaXVzIGluIHBpeGVscwogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgY2lyY2xlJ3MgY2VudGVyIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHIgVGhlIGNpcmNsZSdzIHJhZGl1cyBpbiBwaXhlbHMKICoKICogQHNlZSB7QGxpbmsgYXJjfQogKi8KZnVuY3Rpb24gY2lyY2xlKC4uLmFyZ3MpIHsKICBpZiAoX191c2VfcHJvamVjdGlvbikgewogICAgX19jaXJjbGUzZCguLi5hcmdzKTsKICB9IGVsc2UgewogICAgX19jaXJjbGUyZCguLi5hcmdzKTsKICB9Cn0KCmZ1bmN0aW9uIF9fY2lyY2xlM2QoeCwgeSwgeiwgcikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgciA9IHk7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogICh7IHgsIHkgfSA9IHByb2plY3QoeCwgeSwgeikpOwogIF9fY2lyY2xlMmQoeCwgeSwgcik7Cn0KCmZ1bmN0aW9uIF9fY2lyY2xlMmQoeCwgeSwgcikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgciA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgYXJjKHgsIHksIHIsIDAsIFRBVSwgZmFsc2UpOwp9CgovKioKICogQ2xlYXIgdGhlIGNhbnZhcywgYW5kIHNldCBpdCB0byBhIHNwZWNpZmljIChDU1MpIGNvbG91ci4KICogSWYgbm8gYG5vR3JpZCgpYCBjYWxsIHdhcyBtYWRlLCB0aGlzIHdpbGwgdGhlbiBhbHNvIGRyYXcKICogdGhlIGJhY2tncm91bmQgZ3JpZC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBwaW5rYCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtjb2xvcn0gY29sb3I/IFRoZSAoQ1NTKSBiYWNrZ3JvdW5kIGNvbG9yIHRvIHVzZSAoZGVmYXVsdCA9IGB3aGl0ZWApCiAqLwpmdW5jdGlvbiBjbGVhcihjb2xvciA9IGB3aGl0ZWApIHsKICBzYXZlKCk7CiAgX19jYW52YXMuc3R5bGUuYmFja2dyb3VuZCA9IGNvbG9yOwogIF9fY2FudmFzLndpZHRoID0gd2lkdGg7CiAgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwogIGlmIChfX2RyYXdfZ3JpZCkgZ3JpZCgpOwogIHJlc3RvcmUoKTsKfQoKLyoqCiAqIENvdW50ZXJwYXJ0IHRvIHN0YXJ0KCksIGZpbmFsaXplcyB0aGUgY3VycmVudCBzaGFwZSBhbmQKICogY29sb3VycyBpdC4gSWYgYGNsb3NlYCBpcyB0cnVlLCBpdCB3aWxsIGNsb3NlIHRoZSBwYXRoCiAqIGJlZm9yZSBjb2xvdXJpbmcuCiAqCiAqIElmIGBub0ZpbGwoKWAgaXMgaW4gZWZmZWN0LCB0aGUgc2hhcGUgd2lsbCBub3QgYmUgZmlsbGVkLgogKiBpZiBgbm9TdHJva2UoKWAgaXMgaW4gZWZmZWN0LCB0aGUgc2hhcGUgb3V0bGluZSB3aWxsIG5vdCBiZSBjb2xvdXJlZC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYGdvbGRgKTsKICogICAgICAgc3RhcnQoKTsKICogICAgICAgdmVydGV4KDAsaGVpZ2h0LzIpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgMCk7CiAqICAgICAgIHZlcnRleCh3aWR0aCwgaGVpZ2h0LzIpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgaGVpZ2h0KTsKICogICAgICAgZW5kKHRydWUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY2xvc2U/IEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyB3aGV0aGVyIG9yIG5vdCB0byBjbG9zZSB0aGUgcGF0aCAoZGVmYXVsdCA9IGZhbHNlKQogKgogKiBAc2VlIHtAbGluayBzdGFydH0KICogQHNlZSB7QGxpbmsgdmVydGV4fQogKiBAc2VlIHtAbGluayBlbmRTaGFwZX0KICovCmZ1bmN0aW9uIGVuZChjbG9zZSA9IGZhbHNlKSB7CiAgaWYgKGNsb3NlKSBfX2N0eC5jbG9zZVBhdGgoKTsKICBfX2N0eC5maWxsKCk7CiAgX19jdHguc3Ryb2tlKCk7CiAgaWYgKF9fY3R4LmxpbmVXaWR0aCAlIDIgPT09IDEpIHsKICAgIF9fY3R4LnRyYW5zbGF0ZSgtMC41LCAtMC41KTsKICB9Cn0KCi8qKgogKiBEcmF3IGFuIGltYWdlIGluIGEgZ2l2ZW4gbG9jYXRpb24gd2l0aCBhbiBvcHRpb25hbAogKiB3aWR0aCBhbmQgaGVpZ2h0LiBJZiBvbWl0dGVkLCB0aGUgd2lkdGggYW5kIGhlaWdodAogKiB3aWxsIGJlIHRoZSBpbWFnZSdzIG93biBkaW1lbnNpb25zLiBOb3RlIHRoYXQgdGhlCiAqIGltYWdlIG1heSBiZSBlaXRoZXIgYSBVUkwsIG9yIGFuIDxpbWc+IGVsZW1lbnQuCiAqCiAqIE5vdGUgdGhhdCB0aGlzIGlzIGFuIGFzeW5jIGZ1bmN0aW9uOiBpZiBpdCBpcyBpbXBvcnRhbnQKICogdGhhdCBub3RoaW5nIGdldHMgZHJhd24gdW50aWwgdGhlIGltYWdlIGhhcyBiZWVuIGRyYXduLAogKiByZW1lbWJlciB0byBgYXdhaXRgIGl0cyBjYWxsLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgYXN5bmMgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGF3YWl0IGltYWdlKGBodHRwczovL2R1bW15aW1hZ2UuY29tLzEwMHgxMDBgLCA1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge0ltYWdlfHN0cmluZ30gaW1nT3JVUkwgVGhlIGltYWdlIHRvIGRyYXcgZWl0aGVyIGFzIEltYWdlIG9iamVjdCwgb3IgaW1hZ2UgVVJMLgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgZHJhdyBwb3NpdGlvbidzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIGRyYXcgcG9zaXRpb24ncyB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB3IFRoZSB3aWR0aCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEBwYXJhbSB7bnVtYmVyfSBoIFRoZSBoZWlnaHQgb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcmV0dXJucyB7SW1hZ2V9IFRoZSBkcmF3biBpbWFnZQogKgogKiBAcGFyYW0ge0ltYWdlfHN0cmluZ30gaW1nT3JVUkwgVGhlIGltYWdlIHRvIGRyYXcgZWl0aGVyIGFzIEltYWdlIG9iamVjdCwgb3IgaW1hZ2UgVVJMLgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgZHJhdyBwb3NpdGlvbiBhcyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB3IFRoZSB3aWR0aCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEBwYXJhbSB7bnVtYmVyfSBoIFRoZSBoZWlnaHQgb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcmV0dXJucyB7SW1hZ2V9IFRoZSBkcmF3biBpbWFnZQogKi8KYXN5bmMgZnVuY3Rpb24gaW1hZ2UoaW1nLCB4ID0gMCwgeSA9IDAsIHcsIGgpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIGggPSB3OwogICAgdyA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIGlmICh0eXBlb2YgaW1nID09PSBgc3RyaW5nYCkgewogICAgaW1nID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBjb25zdCB0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBpbWdgKTsKICAgICAgdGFnLm9ubG9hZCA9ICgpID0+IHJlc29sdmUodGFnKTsKICAgICAgdGFnLm9uZXJyb3IgPSAoKSA9PiByZWplY3QoKTsKICAgICAgdGFnLnNyYyA9IGltZzsKICAgIH0pOwogIH0KICBfX2N0eC5kcmF3SW1hZ2UoaW1nLCB4LCB5LCB3IHx8IGltZy53aWR0aCwgaCB8fCBpbWcuaGVpZ2h0KTsKICByZXR1cm4gaW1nOwp9CgovKioKICogRHJhdyBhIGxpbmUgZnJvbSBvbmUgY29vcmRpbmF0ZSB0byBhbm90aGVyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgcmFuZ2UoMCxoZWlnaHQsMjAsIChpKSA9PiBsaW5lKDAsIDAsIHdpZHRoLCBpKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHgxIFRoZSBmaXJzdCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkxIFRoZSBmaXJzdCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHgyIFRoZSBzZWNvbmQgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MiBUaGUgc2Vjb25kIHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDEgVGhlIGZpcnN0IHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDIgVGhlIHNlY29uZCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICovCmZ1bmN0aW9uIGxpbmUoLi4uYXJncykgewogIGlmIChfX3VzZV9wcm9qZWN0aW9uKSB7CiAgICBfX2xpbmUzZCguLi5hcmdzKTsKICB9IGVsc2UgewogICAgX19saW5lMmQoLi4uYXJncyk7CiAgfQp9CgpmdW5jdGlvbiBfX2xpbmUzZCh4MSwgeTEsIHoxLCB4MiwgeTIsIHoyKSB7CiAgaWYgKHgxLnggIT09IHVuZGVmaW5lZCAmJiB4MS55ICE9PSB1bmRlZmluZWQpIHsKICAgIHoyID0geTEuejsKICAgIHkyID0geTEueTsKICAgIHgyID0geTEueDsKICAgIHoxID0geDEuejsKICAgIHkxID0geDEueTsKICAgIHgxID0geDEueDsKICB9CiAgKHsgeDogeDEsIHk6IHkxIH0gPSBwcm9qZWN0KHgxLCB5MSwgejEpKTsKICAoeyB4OiB4MiwgeTogeTIgfSA9IHByb2plY3QoeDIsIHkyLCB6MikpOwogIF9fbGluZTJkKHgxLCB5MSwgeDIsIHkyKTsKfQoKZnVuY3Rpb24gX19saW5lMmQoeDEsIHkxLCB4MiwgeTIpIHsKICBpZiAoeDEueCAhPT0gdW5kZWZpbmVkICYmIHgxLnkgIT09IHVuZGVmaW5lZCkgewogICAgeTIgPSB5MS55OwogICAgeDIgPSB5MS54OwogICAgeTEgPSB4MS55OwogICAgeDEgPSB4MS54OwogIH0KICBzdGFydCgpOwogIHZlcnRleCh4MSwgeTEpOwogIHZlcnRleCh4MiwgeTIpOwogIGVuZCgpOwp9CgovKioKICogUGxvdCBhIHk9Zih4KSBmdW5jdGlvbi4gVGhlIGlucHV0IHRvIHRoZSBmdW5jdGlvbgogKiB3aWxsIHNwYW4gdGhlIGludGVydmFsIFthLGJdIHVzaW5nIHRoZSBpbmRpY2F0ZWQKICogbnVtYmVyIG9mIHN0ZXBzLCBhbmQgdGhlIHJlIHN1bHQgbWF5IGJlIHNjYWxlZCBib3RoCiAqIGluIHRoZSB4IGFuZCB5IGRpcmVjdGlvbiBpbiBvcmRlciB0byBkcmF3IHNvbWV0aGluZwogKiB0aGF0IHlvdSBjYW4gYWN0dWFsbHkgc2VlIChlLmcuIGlmIHlvdSdyZSBwbG90dGluZwogKiB0byB0aGUgZG9tYWluIFswLDFdIHlvdSB3b3VsZG4ndCBiZSBhYmxlIHRvIHNlZSB0aGUKICogcmVzdWx0IHdpdGhvdXQgc2NhbGluZykuCiAqCiAqIFRoaXMgZnVuY3Rpb24gaXMgYXdhcmUgb2YsIGFuZCB3aWxsIHBsb3QsIGRpc2NvbnRpbnVpdGllcwogKiB1c2luZyB0aGUgc3RhbmRhcmQgb3BlbiBjaXJjbGUgbm90YXRpb24sIHVubGVzcyBpbnN0cnVjdGVkCiAqIG5vdCB0byBkbyBzbyB1c2luZyB0aGUgYGlnbm9yZURpc2NvbnRpbnVpdHlgIGJvb2xlYW4gZmxhZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICB0cmFuc2xhdGUoMCwgaGVpZ2h0IC8gMik7CiAqICAgICAgIGNvbnN0IGZuID0gKHgpID0+IGNvcyh4KSAqKiA2IC8gc2luKHgpIC0gc2luKHgpLzI7CiAqICAgICAgIHBsb3QoZm4sIDAsIDIqVEFVLCAxMjAsIHdpZHRoIC8gVEFVLCBoZWlnaHQgLyAyKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmIHRoZSBgeSA9IGYoeClgIGZ1bmN0aW9uIHRvIHBsb3QKICogQHBhcmFtIHtudW1iZXJ9IGE/IFRoZSBsb3dlciBib3VuZCBmb3IgdGhlIGlucHV0IHZhbHVlIChkZWZhdWx0ID0gMCkKICogQHBhcmFtIHtudW1iZXJ9IGI/IFRoZSB1cHBlciBib3VuZCBmb3IgdGhlIGlucHV0IHZhbHVlIChkZWZhdWx0ID0gMSkKICogQHBhcmFtIHtudW1iZXJ9IHN0ZXBzPyBUaGUgbnVtYmVyIG9mIHBsb3QgcG9pbnRzIHRvIHBsb3Qgb3ZlciB0aGUgaW50ZXJ2YWwgW2EsYl0gKGRlZmF1bHQgPSAxMDApCiAqIEBwYXJhbSB7bnVtYmVyfSB4c2NhbGU/IEFuIG9wdGlvbmFsIHNjYWxpbmcgZmFjdG9yIHRvIGFwcGx5IHRvIGVhY2ggcGxvdCBwb2ludCdzIHggdmFsdWUgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0ge251bWJlcn0geXNjYWxlPyBBbiBvcHRpb25hbCBzY2FsaW5nIGZhY3RvciB0byBhcHBseSB0byBlYWNoIHBsb3QgcG9pbnQncyB5IHZhbHVlIChkZWZhdWx0ID0gMSkKICogQHBhcmFtIHtib29sZWFufSBpZ25vcmVEaXNjb250aW51aXR5PyBEbyBub3QgZHJhdyBzcGVjaWFsIGVsZW1lbnRzIGZvciBkaXNjb250aW51aXRpZXMgKGRlZmF1bHQgPSBmYWxzZSkKICoKICogQHNlZSB7QGxpbmsgcGxvdERhdGF9CiAqLwpmdW5jdGlvbiBwbG90KAogIGYsCiAgYSA9IDAsCiAgYiA9IDEsCiAgc3RlcHMgPSAxMDAsCiAgeHNjYWxlID0gMSwKICB5c2NhbGUgPSAxLAogIGlnbm9yZURpc2NvbnRpbnVpdHkgPSBmYWxzZQopIHsKICBjb25zdCBpbnRlcnZhbCA9IGIgLSBhOwogIHN0YXJ0KCk7CiAgbGV0IFtweSwgZHksIHBkeV0gPSBbMCwgMCwgMF07CiAgY29uc3Qgc3RlcCA9IGludGVydmFsIC8gKHN0ZXBzIC0gMSk7CiAgY29uc3QgZGlzY29udGludWl0eSA9IChpLCB4LCB5KSA9PiB7CiAgICBlbmQoKTsKICAgIHNhdmUoKTsKICAgIG5vRmlsbCgpOwogICAgcG9pbnQoeCAqIHhzY2FsZSwgcHkgKiB5c2NhbGUpOwogICAgcG9pbnQoeCAqIHhzY2FsZSwgeSAqIHlzY2FsZSk7CiAgICByZXN0b3JlKCk7CiAgICBzdGFydCgpOwogIH07CiAgZm9yIChsZXQgaSA9IDAsIHgsIHk7IGkgPCBzdGVwczsgaSsrKSB7CiAgICB4ID0gYSArIGkgKiBzdGVwOwogICAgeSA9IGYoeCk7CiAgICAvLyBJZiBmKHgpIGNoYW5nZXMgaW4gdmlvbGF0aW9uIG9mIHdoYXQgaXRzIGYnKHgpIHN1Z2dlc3RlZCwKICAgIC8vIHRoYXQncyBhIGRpc2NvbnRpbnVpdHkgYW5kIHdlIGRyYXcgYW4gYXN5bXB0b3RlLgogICAgZHkgPSAoeSAtIHB5KSAqIHN0ZXA7CiAgICBpZiAoIWlnbm9yZURpc2NvbnRpbnVpdHkpIHsKICAgICAgaWYgKHBkeSAhPT0gbnVsbCAmJiBzaWduKHkgLSBweSkgIT09IHNpZ24ocGR5KSAmJiBhYnMocGR5KSA+IDAuMDEpIHsKICAgICAgICBkaXNjb250aW51aXR5KGksIHgsIHkpOwogICAgICAgIHBkeSA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcGR5ID0gZHk7CiAgICAgIH0KICAgIH0KICAgIHZlcnRleCh4ICogeHNjYWxlLCB5ICogeXNjYWxlKTsKICAgIHB5ID0geTsKICB9CiAgZW5kKCk7Cn0KCi8qKgogKiBQbG90IGEgMkQgZ3JhcGggdXNpbmcgYSBjb2xsZWN0aW9uIG9mIGFueS1kaW1lbnNpb25hbCBkYXRhLAogKiBieSBpbmRpY2F0aW5nIHdoaWNoIGRpbWVuc2lvbiBzaG91bGQgYmUgdHJlYXRlZCBhcyB0aGUgYHhgCiAqIGFuZCB3aGljaCBkaW1lbnNpb24gc2hvdWxkIGJlIHRyZWF0ZWQgYXMgdGhlIGB5YC4gSWYgbm8gYHhgCiAqIGFuZCBgeWAgYXJlIHByb3ZpZGVkLCBgZGF0YWAgd2lsbCBiZSB0cmVhdGVkIGEgMUQgYXJyYXkgYW5kCiAqIHdpbGwgcGxvdCB3aXRoIHRoZSBhcnJheSBpbmRleCBhcyBgeGAgYW5kIGVsZW1lbnQgYXQgdGhhdAogKiBpbmRleCBhcyBgeWAuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHRyYW5zbGF0ZSgwLCBoZWlnaHQvMik7CiAqCiAqICAgICAgIHNldFN0cm9rZShgZGFya2dyZWVuYCk7CiAqICAgICAgIGxldCBkYXRhID0gYXJyYXkod2lkdGgsIChpKSA9PiBbaSwgaGVpZ2h0LzIgKiBzaW4oaS8yNSldKTsKICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAqCiAqICAgICAgIHNldFN0cm9rZShgcHVycGxlYCk7CiAqICAgICAgIGRhdGEgPSBhcnJheSh3aWR0aCwgKGkpID0+ICh7CiAqICAgICAgICAgbWVlcDogaSwKICogICAgICAgICBtb29wOiBoZWlnaHQvMiAqIGNvcyhpLzI1KQogKiAgICAgICB9KSk7CiAqICAgICAgIHBsb3REYXRhKGRhdGEsIGBtZWVwYCwgYG1vb3BgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge29iamVjdFtdfSBkYXRhIFRoZSBhbnktZGltZW5zaW9uYWwgZGF0YSBmcm9tIHdoaWNoIHRvIHBsb3Qgb25lIGRpbWVuc2lvbiBhZ2FpbiBhbm90aGVyCiAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30geD8gVGhlIHByb3BlcnR5IG5hbWUgb3IgaW5kaXZpZHVhbCBlbGVtZW50IGFycmF5IGluZGV4IHRvIHVzZSBhcyB4IGRpbWVuc2lvbgogKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IHk/IFRoZSBwcm9wZXJ0eSBuYW1lIG9yIGluZGl2aWR1YWwgZWxlbWVudCBhcnJheSBpbmRleCB0byB1c2UgYXMgeSBkaW1lbnNpb24KICoKICogQHNlZSB7QGxpbmsgcGxvdH0KICovCmZ1bmN0aW9uIHBsb3REYXRhKGRhdGEsIHgsIHkpIHsKICBzdGFydCgpOwogIGlmICh4ICE9PSB1bmRlZmluZWQgJiYgeSAhPT0gdW5kZWZpbmVkKSB7CiAgICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgICAgeSA9IHgueTsKICAgICAgeCA9IHgueDsKICAgIH0KICAgIGRhdGEuZm9yRWFjaCgocCkgPT4gdmVydGV4KHBbeF0sIHBbeV0pKTsKICB9IGVsc2UgewogICAgZGF0YS5mb3JFYWNoKCh5LCB4KSA9PiB2ZXJ0ZXgoeCwgeSkpOwogIH0KICBlbmQoKTsKfQoKLyoqCiAqIERyYXcgYSBwb2ludCAoZWl0aGVyIGZyb20geC95IG9yIHBvaW50LWxpa2UpLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHJhbmdlKDAsIFRBVSwgKGEpID0+IHsKICogICAgICAgICBwb2ludCg0MCAqIGNvcyhhKSwgNDAgKiBzaW4oYSkpOwogKiAgICAgICB9KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgcG9pbnQncyBjZW50ZXIgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgcG9pbnQncyBjZW50ZXIgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgcG9pbnQncyBjZW50ZXIge3gseX0gY29vcmRpbmF0ZQogKgogKiBAc2VlIHtAbGluayBjaXJjbGV9CiAqLwpmdW5jdGlvbiBwb2ludCguLi5hcmdzKSB7CiAgYXJncy5wdXNoKDMpOwogIGlmIChfX3VzZV9wcm9qZWN0aW9uKSB7CiAgICBfX2NpcmNsZTNkKC4uLmFyZ3MpOwogIH0gZWxzZSB7CiAgICBfX2NpcmNsZTJkKC4uLmFyZ3MpOwogIH0KfQoKLyoqCiAqIERyYXcgYSBjbG9zZWQgcG9seWdvbiBmcm9tIGFuIGFycmF5IG9mIHBvaW50IGxpa2VzIG9yIG51bWJlciBhcnJheXMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgY2VudGVyKCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgb3JhbmdlYCk7CiAqICAgICAgIHBvbHkoWwogKiAgICAgICAgIFstNTAsIC01MF0sCiAqICAgICAgICAgWy01MCwgNTBdLAogKiAgICAgICAgIHt4OiA1MCwgeTogNTB9LAogKiAgICAgICAgIG5ldyBQb2ludCg1MCwgLTUwKSwKICogICAgICAgXSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJbXX0gY29vcmRpbmF0ZXMgVGhlIGFycmF5IG9mIHBvbHlnb24gdmVydGljZXMgYXMgcG9pbnQtbGlrZXMgb3IgbnVtYmVyIGFycmF5cy4KICovCmZ1bmN0aW9uIHBvbHkoY29vcmRzKSB7CiAgc3RhcnQoKTsKICBjb29yZHMuY29uY2F0KFtjb29yZHNbMF1dKS5mb3JFYWNoKCh2KSA9PiB7CiAgICBpZiAodiBpbnN0YW5jZW9mIEFycmF5KSB2ZXJ0ZXgoLi4udik7CiAgICBlbHNlIHZlcnRleCh2KTsKICB9KTsKICBlbmQoKTsKfQoKLyoqCiAqIERyYXcgYSByZWN0YW5nbGUgYXQgdGhlIHNwZWNpZmllZCBjb29yZGluYXRlLCB3aXRoCiAqIHRoZSBzcGVjaWZpYyB3aWR0aCBhbmQgaGVpZ2h0LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHJlY3QoNDAsIDQwLCB3aWR0aCAtIDgwLCBoZWlnaHQgLSA4MCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHJlY3QncyBjb3JuZXIgIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHJlY3QncyBjb3JuZXIgIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHcgVGhlIHdpZHRoIG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHBhcmFtIHtudW1iZXJ9IGggVGhlIGhlaWdodCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSByZWN0O3MgY29yZGVyIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHcgVGhlIHdpZHRoIG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHBhcmFtIHtudW1iZXJ9IGggVGhlIGhlaWdodCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqLwpmdW5jdGlvbiByZWN0KHgsIHksIHcsIGgpIHsKICAvLyBGSVhNRTogVE9ETzogZG8gd2UgbmVlZCBfX3JlY3QzZCBhbmQgX19yZWN0MmQ/CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICBoID0gdzsKICAgIHcgPSB5OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBzdGFydCgpOwogIHZlcnRleCh4LCB5KTsKICB2ZXJ0ZXgoeCArIHcsIHkpOwogIHZlcnRleCh4ICsgdywgeSArIGgpOwogIHZlcnRleCh4LCB5ICsgaCk7CiAgdmVydGV4KHgsIHkpOwogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIGNhcmRpbmFsIChoZXJtaXRlKSBzcGxpbmUgdGhhdCBwYXNzZXMgdGhyb3VnaCBlYWNoCiAqIHBvaW50IHByb3ZpZGVkLCB1c2luZyBhIG1hdGhlbWF0aWNhbGx5IHZpcnR1YWwgc3RhcnQgYW5kCiAqIGVuZCB0byBlbnN1cmUgdGhlIGN1cnZlIHN0YXJ0cyBhbmQgZW5kcyBhdCB0aGUgcHJvdmlkZWQKICogc3RhcnQgYW5kIGVuZCBwb2ludC4gVGhpcyBjYW4gYmUgYnlwYXNzZWQgYnkgc2V0dGluZwogKiB0aGUgYHZpcnR1YWxgIGFyZ3VtZW50IHRvIGBmYWxzZWAuCiAqCiAqIEFkZGl0aW9uYWxseSwgdGhlIHNwbGluZSdzIHRpZ2h0bmVzcywgd2hpY2ggY29udHJvbHMKICogaG93ICJiZW5keSIgdGhlIHNwbGluZSBpcyAodGhlIHRpZ2h0ZXIgdGhlIHNwbGluZSwKICogdGhlIHNoYXJwZXIgYmVuZHMgYmVjb21lKSBjYW4gYmUgY29udHJvbGxlZCBieSBzZXR0aW5nCiAqIHRoZSBgdGlnaHRuZXNzYCB2YWx1ZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICByYW5nZSgwLCBUQVUsIFBJIC8gNSwgKGEpID0+IHBvaW50cy5wdXNoKAogKiAgICAgICAgIG5ldyBQb2ludCgKICogICAgICAgICAgIHJhbmRvbSgzMCkgKyA1MCAqIGNvcyhhKSwKICogICAgICAgICAgIHJhbmRvbSgzMCkgKyA1MCAqIHNpbihhKQogKiAgICAgICAgICkKICogICAgICAgKSk7CiAqICAgICAgIHNldE1vdmFibGUoLi4ucG9pbnRzKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGggLyAyLCBoZWlnaHQgLyAyKTsKICogICAgICAgc2V0RmlsbChgIzAwMDJgKTsKICogICAgICAgc3BsaW5lKC4uLnBvaW50cyk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgcG9pbnRzLmZvckVhY2gocCA9PiBwb2ludChwKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICoKICogQHBhcmFtIHtQb2ludExpa2VbXX0gLi4ucG9pbnRzIFRoZSBwb2ludHMgYWNyb3NzIHdoaWNoIHRvIGZpdCBhIHNwbGluZQogKiBAcGFyYW0ge2Jvb2xlYW59IHZpcnR1YWw/IFdoZXRoZXIgb3Igbm90IHRvIGludmVudCBuZXcgbWF0aGVtYXRpY2FsIHBvaW50cyB0aGF0IGVuc3VyZSB0aGUgY3VydmUgc3RhcnRzIGFuZCBlbmRzIGF0IHRoZSBwcm92aWRlZCBzdGFydCBhbmQgZW5kIHBvaW50cy4gKGRlZmF1bHQgPSB0cnVlKQogKiBAcGFyYW0ge251bWJlcn0gdGlnaHRuZXNzPyBIb3cgdGlnaHQgdGhpcyBzcGxpbmUgc2hvdWxkIGJlIGZpdCB0aHJvdWdoIHRoZSBwb2ludHMgcHJvdmlkZWQuIFRoZSBoaWdoZXIgdGhlIHRpZ2h0bmVzcywgdGhlIG1vcmUgcG9seWdvbmFsIHRoZSBjdXJ2ZSBiZWNvbWVzIChkZWZhdWx0ID0gMSkKICoKICogQHNlZSB7QGxpbmsgYmV6aWVyfQogKiBAc2VlIHtAbGluayBic3BsaW5lfQogKi8KZnVuY3Rpb24gc3BsaW5lKC4uLmFyZ3MpIHsKICAvLyBGSVhNRTogVE9ETzogbmVlZHMgX19zcGxpbmUzZCBhbmQgX19zcGxpbmUyZAoKICBsZXQgcG9pbnRzID0gYXJnczsKICBsZXQgdmlydHVhbCA9IHRydWU7CiAgbGV0IFQgPSAxOwoKICAvLyBpZiB0aGUgbGFzdCBvciBzaW5nbGUtdG8tbGFzdCBpcyBhIGJvb2wsIHRoYXQncyBgdmlydHVhbGA6CiAgaWYgKHR5cGVvZiBhcmdzW2FyZ3MubGVuZ3RoIC0gMV0gPT09IGBib29sZWFuYCkgewogICAgW3ZpcnR1YWxdID0gYXJncy5zcGxpY2UoYXJncy5sZW5ndGggLSAxLCAxKTsKICB9IGVsc2UgaWYgKHR5cGVvZiBhcmdzW2FyZ3MubGVuZ3RoIC0gMl0gPT09IGBib29sZWFuYCkgewogICAgW3ZpcnR1YWxdID0gYXJncy5zcGxpY2UoYXJncy5sZW5ndGggLSAyLCAxKTsKICB9CgogIC8vIElmIHRoaXMgbWFrZXMgdGhlIG51bWJlciBvZiBhcmdzIG9kZCwgdGhlIGxhc3QgYXJnIGlzIFQKICBpZiAoYXJncy5sZW5ndGggJSAyID09PSAxKSB7CiAgICBbVF0gPSBhcmdzLnNwbGljZShhcmdzLmxlbmd0aCAtIDEsIDEpOwogIH0KCiAgLy8gdGhlbiwgd2UgY2FuIGNvbnZlcnQKICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09IGBudW1iZXJgKSB7CiAgICBwb2ludHMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkgKz0gMikgewogICAgICBwb2ludHMucHVzaCh7IHg6IGFyZ3NbaV0sIHk6IGFyZ3NbaSArIDFdIH0pOwogICAgfQogIH0KCiAgbGV0IGNwb2ludHMgPSBwb2ludHM7CiAgaWYgKHZpcnR1YWwpIHsKICAgIGNvbnN0IGYwID0gcG9pbnRzWzBdLAogICAgICBmMSA9IHBvaW50c1sxXSwKICAgICAgZjIgPSBwb2ludHNbMl0sCiAgICAgIGZzbSA9IG5ldyBWZWN0b3IoZjAueCAvIDIgKyBmMi54IC8gMiwgZjAueSAvIDIgKyBmMi55IC8gMiksCiAgICAgIGYwciA9IG5ldyBWZWN0b3IoZjApLnJlZmxlY3QoZjEpLAogICAgICBmc3IgPSBmc20ucmVmbGVjdChmMSksCiAgICAgIGZuID0gbmV3IFZlY3RvcihmMHIueCAvIDIgKyBmc3IueCAvIDIsIGYwci55IC8gMiArIGZzci55IC8gMiksCiAgICAgIGwyID0gcG9pbnRzLmF0KC0zKSwKICAgICAgbDEgPSBwb2ludHMuYXQoLTIpLAogICAgICBsMCA9IHBvaW50cy5hdCgtMSksCiAgICAgIGxzbSA9IG5ldyBWZWN0b3IobDAueCAvIDIgKyBsMi54IC8gMiwgbDAueSAvIDIgKyBsMi55IC8gMiksCiAgICAgIGwwciA9IG5ldyBWZWN0b3IobDApLnJlZmxlY3QobDEpLAogICAgICBsbiA9IG5ldyBWZWN0b3IobDByLnggLyAyICsgbHNtLnggLyAyLCBsMHIueSAvIDIgKyBsc20ueSAvIDIpOwogICAgY3BvaW50cyA9IFtmbiwgLi4ucG9pbnRzLCBsbl07CiAgfQoKICAvLyBmb3VyIHBvaW50IHNsaWRpbmcgd2luZG93IG92ZXIgdGhlIHNlZ21lbnQKICBjb25zdCBiZXppZXJQb2ludHMgPSBbXTsKICBmb3IgKGxldCBpID0gMCwgZSA9IGNwb2ludHMubGVuZ3RoIC0gMzsgaSA8IGU7IGkrKykgewogICAgbGV0IFtjMSwgYzIsIGMzLCBjNF0gPSBjcG9pbnRzLnNsaWNlKGksIGkgKyA0KTsKICAgIGxldCBwMiA9IHsKICAgICAgeDogYzIueCArIChjMy54IC0gYzEueCkgLyAoNiAqIFQpLAogICAgICB5OiBjMi55ICsgKGMzLnkgLSBjMS55KSAvICg2ICogVCksCiAgICB9OwogICAgbGV0IHAzID0gewogICAgICB4OiBjMy54IC0gKGM0LnggLSBjMi54KSAvICg2ICogVCksCiAgICAgIHk6IGMzLnkgLSAoYzQueSAtIGMyLnkpIC8gKDYgKiBUKSwKICAgIH07CiAgICBpZiAoaSA9PT0gMCkgYmV6aWVyUG9pbnRzLnB1c2goYzIpOwogICAgYmV6aWVyUG9pbnRzLnB1c2gocDIsIHAzLCBjMyk7CiAgfQoKICBiZXppZXIoLi4uYmV6aWVyUG9pbnRzKTsKfQoKLyoqCiAqIFN0YXJ0cyBhIChuZXcpIHNoYXBlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgZ29sZGApOwogKiAgICAgICBzdGFydCgpOwogKiAgICAgICB2ZXJ0ZXgoMCxoZWlnaHQvMik7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCAwKTsKICogICAgICAgdmVydGV4KHdpZHRoLCBoZWlnaHQvMik7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgICBlbmQodHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgZW5kfQogKiBAc2VlIHtAbGluayB2ZXJ0ZXh9CiAqIEBzZWUge0BsaW5rIHN0YXJ0U2hhcGV9CiAqLwpmdW5jdGlvbiBzdGFydCgpIHsKICBpZiAoX19jdHgubGluZVdpZHRoICUgMiA9PT0gMSkgewogICAgX19jdHgudHJhbnNsYXRlKDAuNSwgMC41KTsKICB9CiAgX19jdHguYmVnaW5QYXRoKCk7CiAgX19maXJzdCA9IGZhbHNlOwp9CgovKioKICogRHJhdyBzb21lIHRleHQgdG8gdGhlIHNjcmVlbi4gSXRzIHBsYWNlbWVudCBpcwogKiBkZXRlcm1pbmVkIGJ5IGJvdGggdGhlIGNvb3JkaW5hdGUgcHJvdmlkZWQsIGFuZAogKiB0aGUgeC95IGFsaWdubWVudCBwcm92aWRlZC4gVmFsaWQgYHhBbGlnbmAgdmFsdWVzCiAqIGFyZToKICoKICogLSBDRU5URVIgLSB0aGUgdGV4dCBhbmNob3IgaXMgaW4gdGhlIG1pZGRsZSBvZiB0aGUgdGV4dC4gVGV4dCBpcyBwbGFjZWQgZXZlbmx5IG9uIGVpdGhlciBzaWRlLgogKiAtIEVORCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgcmlnaHQgZm9yIExUUiB0ZXh0LCBhbmQgb24gdGhlIGxlZnQgZm9yIFJUTCB0ZXh0LgogKiAtIExFRlQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIGxlZnQgc2lkZSBvZiB0aGUgdGV4dC4gYWxsIHRleHQgaXMgdG8gdGhlIHJpZ2h0LgogKiAtIFJJR0hUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSByaWdodCBzaWRlIG9mIHRoZSB0ZXh0LiBBbGwgdGV4dCBpcyB0byB0aGUgbGVmdC4KICogLSBTVEFSVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgbGVmdCBmb3IgTFRSIHRleHQsIGFuZCBvbiB0aGUgcmlnaHQgZm9yIFJUTCB0ZXh0LgogKgogKiBWYWxpZCBgeUFsaWduYCB2YWx1ZXMgYXJlOgogKgogKiAtIEFMUEhBQkVUSUMgLSBzdGFuZGFyZCB0ZXh0IGFsaWdubWVudAogKiAtIEJPVFRPTSAtIHRoZSB0ZXh0IGlzIGFsaWduZWQgdG8gdGhlIGJvdHRvbSBvZiB0aGUgYm91bmRpbmcgYm94CiAqIC0gSEFOR0lORyAtIHJlbGV2YW50IGZvciBUaWJldGFuIGFuZCBvdGhlciBJbmRpYyBzY3JpcHRzLgogKiAtIElERU9HUkFQSElDIC0gcmVsZXZhbnQgZm9yIGlkZW9ncmFwaGljIENKS1YgdGV4dC4KICogLSBNSURETEUgLSBUaGUgdmVydGljYWwgZXF1aXZhbGVudCBvZiAiY2VudGVyIi4KICogLSBUT1AgLSBUaGUgdGV4dCBpcyBhbGlnbmVkIHRvIHRoZSB0b3Agb2YgdGhlIHR5cG9ncmFwaGljICJlbSBzcXVhcmUiLgogKgogKiBOb3RlIHRoYXQgdGhlIHByaW1hcnkgdGV4dCBjb2xvdXIgdXNlcyB0aGUgZmlsbCBjb2xvdXIuIElmIHRleHQKICogc3Ryb2tpbmcgaXMgZW5hYmxlZCwgdGhlIHRoZSB0ZXh0IG91dGxpbmUgd2lsbCBiZSBjb2xvdXJlZCB1c2luZwogKiB0aGUgY3VycmVudCBzdHJva2UgY29sb3VyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoIm5vcm1hbCB0ZXh0Iiwgd2lkdGgvMiwgNjAsIENFTlRFUiwgQ0VOVEVSKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHRleHQoInVuZmlsbGVkIHRleHQiLCB3aWR0aC8yLCAxMDAsIENFTlRFUiwgQ0VOVEVSKTsKICogICAgICAgc2V0U3Ryb2tlKGByZWRgKTsKICogICAgICAgc2V0RmlsbChgeWVsbG93YCk7CiAqICAgICAgIHRleHQoImZhbmN5IHRleHQiLCB3aWR0aC8yLCAxNDAsIENFTlRFUiwgQ0VOVEVSKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSB0ZXh0IHdlIHdhbnQgdG8gc2hvdwogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgdGV4dCBsb2NhdGlvbidzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHRleHQgbG9jYXRpb24ncyB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7c3RyaW5nfSB4QWxpZ24/IEFuIG9wdGlvbmFsIGhvcml6b250YWwgYWxpZ25tZW50IHN0cmluZwogKiBAcGFyYW0ge3N0cmluZ30geUFsaWduPyBBbiBvcHRpb25hbCB2ZXJ0aWNhbCAgYWxpZ25tZW50IHN0cmluZwogKgogKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSB0ZXh0IHdlIHdhbnQgdG8gc2hvdwogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgdGV4dCBsb2NhdGlvbidzIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtzdHJpbmd9IHhBbGlnbj8gQW4gb3B0aW9uYWwgaG9yaXpvbnRhbCBhbGlnbm1lbnQgc3RyaW5nCiAqIEBwYXJhbSB7c3RyaW5nfSB5QWxpZ24/IEFuIG9wdGlvbmFsIHZlcnRpY2FsICBhbGlnbm1lbnQgc3RyaW5nCiAqCiAqIEBzZWUge0BsaW5rIHNldFRleHRTdHJva2V9CiAqLwpmdW5jdGlvbiB0ZXh0KHN0ciwgeCwgeSwgeEFsaWduLCB5QWxpZ24pIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHlBbGlnbiA9IHhBbGlnbjsKICAgIHhBbGlnbiA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIHNhdmUoKTsKICBpZiAoeEFsaWduKSB7CiAgICBzZXRUZXh0QWxpZ24oeEFsaWduLCB5QWxpZ24pOwogIH0KICBfX2N0eC5maWxsVGV4dChzdHIsIHgsIHkpOwogIGlmIChfX3RleHRTdHJva2UpIHsKICAgIHNldFN0cm9rZShfX3RleHRTdHJva2UpOwogICAgX19jdHguc3Ryb2tlVGV4dChzdHIsIHgsIHkpOwogIH0KICByZXN0b3JlKCk7Cn0KCi8qKgogKiBEcmF3IGEgdHJpYW5nbGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgdHJpYW5nbGUod2lkdGgvMiwgMzAsIDEvNCAqIHdpZHRoLCAxNjAsIDMvNCAqIHdpZHRoLCAxMTApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4MSBUaGUgZmlyc3QgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MSBUaGUgZmlyc3QgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB4MiBUaGUgc2Vjb25kIHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTIgVGhlIHNlY29uZCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHgzIFRoZSB0aGlyZCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkzIFRoZSB0aGlyZCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAxIFRoZSBmaXJzdCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtQb2ludExpa2V9IHAyIFRoZSBzZWNvbmQgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMyBUaGUgdGhpcmQgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqLwpmdW5jdGlvbiB0cmlhbmdsZSh4MSwgeTEsIHgyLCB5MiwgeDMsIHkzKSB7CiAgLy8gRklYTUU6IFRPRE86IGRvIHdlIG5lZWQgX190cmlhbmdsZTNkIGFuZCBfX3RyaWFuZ2xlMmQ/CgogIGlmICh4MS54ICE9PSB1bmRlZmluZWQgJiYgeDEueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5MyA9IHgyLnk7CiAgICB4MyA9IHgyLng7CiAgICB5MiA9IHkxLnk7CiAgICB4MiA9IHkxLng7CiAgICB5MSA9IHgxLnk7CiAgICB4MSA9IHgxLng7CiAgfQoKICBzdGFydCgpOwogIHZlcnRleCh4MSwgeTEpOwogIHZlcnRleCh4MiwgeTIpOwogIHZlcnRleCh4MywgeTMpOwogIHZlcnRleCh4MSwgeTEpOwogIGVuZCgpOwp9CgovKioKICogQWRkIGEgdmVydGV4IHRvIHRoZSBjdXJyZW50bHkgYWN0aXZlIHNoYXBlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHN0YXJ0KCk7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCAzMCk7CiAqICAgICAgIHZlcnRleCgxLzQgKiB3aWR0aCwgMTYwKTsKICogICAgICAgdmVydGV4KDMvNCAqIHdpZHRoLCAxMTApOwogKiAgICAgICBlbmQoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgdmVydGV4J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgdmVydGV4J3MgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgdmVydGV4IHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgZW5kfQogKiBAc2VlIHtAbGluayBzdGFydH0KICovCmZ1bmN0aW9uIHZlcnRleCh4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIGlmIChfX3VzZV9wcm9qZWN0aW9uICYmIHogIT09IHVuZGVmaW5lZCkgewogICAgKHsgeCwgeSB9ID0gX19wcm9qZWN0b3IucHJvamVjdCh4LCB5LCB6KSk7CiAgfQogIGlmIChfX2ZpcnN0KSB7CiAgICBfX2N0eC5saW5lVG8oeCwgeSk7CiAgfSBlbHNlIHsKICAgIF9fZmlyc3QgPSB7IHgsIHkgfTsKICAgIF9fY3R4Lm1vdmVUbyh4LCB5KTsKICB9Cn0KLyoqCiAqIENyZWF0ZSBhbiBhcnJheSBvZiBzcGVjaWZpZWQgbGVuZ3RoLCBvcHRpb25hbGx5IGZpbGxlZCB1c2luZyBhCiAqIGZ1bmN0aW9uIHRoYXQgdGFrZXMgdGhlIGVsZW1lbnQgaW5kZXggYXMgc2luZ2xlIGlucHV0IGFyZ3VtZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICB0cmFuc2xhdGUoMCwgaGVpZ2h0LzIpOwogKiAgICAgICBsZXQgZGF0YSA9IGFycmF5KHdpZHRoLCAoaSkgPT4gW2ksIGhlaWdodC8yICogc2luKGkvMjUpXSk7CiAqICAgICAgIHBsb3REYXRhKGRhdGEsIDAsIDEpOwogKiAgICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIFRoZSBzaXplIG9mIHRoZSBhcnJheSB5b3Ugd2FudAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmaWxsRnVuY3Rpb24/IFRoZSBvcHRpb25hbCBmdW5jdGlvbiB0aGF0IGdldHMgdXNlZCB0byBmaWxsIHRoZSBhcnJheQogKi8KZnVuY3Rpb24gYXJyYXkobGVuLCBmaWxsRnVuY3Rpb24pIHsKICBjb25zdCBhcnIgPSBuZXcgQXJyYXkobGVuKS5maWxsKCk7CiAgaWYgKGZpbGxGdW5jdGlvbikgewogICAgcmV0dXJuIGFyci5tYXAoKF8sIGkpID0+IGZpbGxGdW5jdGlvbihpKSk7CiAgfQogIHJldHVybiBhcnI7Cn0KCi8qKgogKiBFbXB0eSB0aGUgbGlzdCBvZiBtb3ZhYmxlIHBvaW50cyBpbiB5b3VyIGdyYXBoaWMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGBsb2NrYCwgKCkgPT4gewogKiAgICAgICAgIGNsZWFyTW92YWJsZSgpOwogKiAgICAgICAgIHJlZHJhdygpOwogKiAgICAgICB9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBmb3IobGV0IHAgb2YgcG9pbnRzKSB7CiAqICAgICAgICAgc2V0Q29sb3IoaXNNb3ZhYmxlKHApID8gYHJlZGAgOiBgZ3JleWApOwogKiAgICAgICAgIHBvaW50KHApOwogKiAgICAgICB9CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bih4LHkpIHsKICogICAgICAgaWYgKGN1cnJlbnRNb3ZhYmxlKSByZXR1cm47CiAqICAgICAgIGNvbnN0IHAgPSBuZXcgUG9pbnQoeCx5KTsKICogICAgICAgcG9pbnRzLnB1c2gocCk7CiAqICAgICAgIHNldE1vdmFibGUocCk7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIGlzTW92YWJsZX0KICogQHNlZSB7QGxpbmsgc2V0TW92YWJsZX0KICovCmZ1bmN0aW9uIGNsZWFyTW92YWJsZSgpIHsKICBfX21vdmFibGVfcG9pbnRzLnNwbGljZSgwLCBfX21vdmFibGVfcG9pbnRzLmxlbmd0aCk7Cn0KCi8qKgogKiBDcmVhdGUgYSBjb3B5IG9mIHRoZSBjdXJyZW50IGNhbnZhcyBlbGVtZW50CiAqIGZvciB1c2Ugc29tZXdoZXJlIGVsc2UgaW4geW91ciBvd24gY29kZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBwaW5rYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bih4LHkpIHsKICogICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCgKICogICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoYGdyYXBoaWNzOnVwZGF0ZWAsIHsKICogICAgICAgICAgIGRldGFpbDogewogKiAgICAgICAgICAgICBjYW52YXM6IGNvcHkoKQogKiAgICAgICAgICAgfQogKiAgICAgICAgIH0pCiAqICAgICAgICk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge0hUTUxDYW52YXNFbGVtZW50fSBBIGNvcHkgb2YgdGhlIGN1cnJlbnQgY2FudmFzCiAqLwpmdW5jdGlvbiBjb3B5KCkgewogIGNvbnN0IGNvcHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBjYW52YXNgKTsKICBjb3B5LndpZHRoID0gd2lkdGg7CiAgY29weS5oZWlnaHQgPSBoZWlnaHQ7CiAgY29uc3QgY3R4ID0gY29weS5nZXRDb250ZXh0KGAyZGApOwogIGN0eC5kcmF3SW1hZ2UoX19jYW52YXMsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogIHJldHVybiBjb3B5Owp9CgovKioKICogR2VuZXJhdGVzIGEgY29sb3IgYmFzZWQgb24gdGhlIEhTTCBjb2xvciBzcGFjZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGNvbG9yKDQ1LCA4MCwgOTApKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gaHVlIGluIHRoZSByYW5nZSBbMCwgMzYwXQogKiBAcGFyYW0ge251bWJlcn0gc2F0dXJhdGlvbiBpbiB0aGUgcmFuZ2UgWzAsIDEwMF0KICogQHBhcmFtIHtudW1iZXJ9IGxpZ2h0bmVzcyBpbiB0aGUgcmFuZ2UgWzAsIDEwMF0KICogQHBhcmFtIHtudW1iZXJ9IG9wYWNpdHkgaW4gdGhlIHJhbmdlIFswLCAxXQogKiBAcmV0dXJucyB7c3RyaW5nfSBBIENTUyBoc2xhIGNvbG9yIHN0cmluZwogKgogKiBAc2VlIHtAbGluayByYW5kb21Db2xvcn0KICovCmZ1bmN0aW9uIGNvbG9yKGggPSBfX2N1cnJlbnRfaHVlLCBzID0gNTAsIGwgPSA1MCwgYSA9IDEpIHsKICByZXR1cm4gYGhzbGEoJHtofSwke3N9JSwke2x9JSwke2F9KWA7Cn0KCi8qKgogKiBGaW5kIGFuIEhUTUwgZWxlbWVudCBpbnNpZGUgeW91ciBncmFwaGljcy1lbGVtZW50CiAqIGJ5IHF1ZXJ5IHNlbGVjdG9yLiBUaGlzIGlzIGVxdWl2YWxlbnQgdG86CiAqCiAqIGBgYAogKiB5b3VyRWxlbWVudC5xdWVyeVNlbGVjdG9yKHFzKQogKiBgYGAKICoKICogQHBhcmFtIHtzdHJpbmd9IHF1ZXJ5U2VsZWN0b3IgQSBxdWVyeSBzZWxlY3RvcgogKiBAcmV0dXJucyB7SFRNTEVsZW1lbnR8bnVsbH0gVGhlIG1hdGNoZWQgZWxlbWVudCwgb3IgbnVsbCBpZiB0aGVyZSB3YXMgbm8gbWF0Y2guCiAqLwpmdW5jdGlvbiBmaW5kKHFzKSB7CiAgcmV0dXJuIF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKHFzKTsKfQoKLyoqCiAqIEZpbmQgYWxsIEhUTUwgZWxlbWVudHMgaW5zaWRlIHlvdXIgZ3JhcGhpY3MtZWxlbWVudAogKiB0aGF0IG1hdGNoIGEgZ2l2ZW4gcXVlcnkgc2VsZWN0b3IuIFRoaXMgaXMgZXF1aXZhbGVudCB0bzoKICoKICogYGBgCiAqIEFycmF5LmZyb20oeW91ckVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChxcykpCiAqIGBgYAogKgogKiBAcGFyYW0ge3N0cmluZ30gcXVlcnlTZWxlY3RvciBBIHF1ZXJ5IHNlbGVjdG9yCiAqIEByZXR1cm5zIHtIVE1MRWxlbWVudFtdfSBBbiBhcnJheSB3aXRoIGFsbCBtYXRjaGluZyBlbGVtZW50cywgW10gaWYgdGhlcmUgd2VyZSBubyBtYXRjaGVzLgogKi8KZnVuY3Rpb24gZmluZEFsbChxcykgewogIHJldHVybiBbLi4uX19lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocXMpXTsKfQoKLyoqCiAqIE1hcmsgYSBzcGVjaWZpYyBjb2xvciBhcyB0aGUgaGlnaGxpZ2h0IGNvbG9yLAogKiB3aGljaCBjYXVzZXMgdGhlIGdyYXBoaWMgdG8gcmVkcmF3IHdpdGggdGhhdAogKiBjb2xvciByZXBsYWNlZCBieSB3aGljaGV2ZXIgY29sb3IgeW91IHBpY2tlZAogKiBhcyBoaWdobGlnaHQgY29sb3IuCiAqCiAqIE5vdGUgdGhhdCB5b3UgY2FuIG9ubHkgdXNlIG5hbWVkIChDU1MpIGNvbG9ycwogKiB3aXRoIHRoaXMgZnVuY3Rpb24uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEhpZ2hsaWdodENvbG9yKGBsaW1lYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dCgibGV0J3MgZ28iLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJBY3RpdmUoc3RhdGUpIHsKICogICAgICAgaWYgKHN0YXRlKSBoaWdobGlnaHQoYHJlZGApOwogKiAgICAgICBlbHNlIGhpZ2hsaWdodChmYWxzZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtjb2xvcnxib29sZWFufSBjb2xvciBTZXQgdGhlIGNvbG9yIHRoYXQgc2hvdWxkIGdldCByZXBsYWNlZCB3aXRoIHRoZSBoaWdobGlnaHQgY29sb3IsIG9yIGRpc2FibGUgaGlnaGxpZ2h0IHdoZW4gY29sb3IgaXMgYGZhbHNlYAogKgogKiBAc2VlIHtAbGluayBzZXRIaWdobGlnaHRDb2xvcn0KICovCmZ1bmN0aW9uIGhpZ2hsaWdodChjb2xvcikgewogIGlmIChDU1NfQ09MT1JfTUFQW2NvbG9yXSkgewogICAgX19oaWdobGlnaHRfY29sb3IgPSBDU1NfQ09MT1JfTUFQW2NvbG9yXTsKICB9IGVsc2UgewogICAgX19oaWdobGlnaHRfY29sb3IgPSBjb2xvcjsKICB9CiAgcmVkcmF3KCk7Cn0KCi8qKgogKiBDaGVjayB3aGV0aGVyIGEgcG9pbnQgaXMgcmVnaXN0ZXJlZCBhcyBtb3ZhYmxlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGFkZEJ1dHRvbihgbG9ja2AsICgpID0+IHsKICogICAgICAgICBjbGVhck1vdmFibGUoKTsKICogICAgICAgICByZWRyYXcoKTsKICogICAgICAgfSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgZm9yKGxldCBwIG9mIHBvaW50cykgewogKiAgICAgICAgIHNldENvbG9yKGlzTW92YWJsZShwKSA/IGByZWRgIDogYGdyZXlgKTsKICogICAgICAgICBwb2ludChwKTsKICogICAgICAgfQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCx5KSB7CiAqICAgICAgIGlmIChjdXJyZW50TW92YWJsZSkgcmV0dXJuOwogKiAgICAgICBjb25zdCBwID0gbmV3IFBvaW50KHgseSk7CiAqICAgICAgIHBvaW50cy5wdXNoKHApOwogKiAgICAgICBzZXRNb3ZhYmxlKHApOwogKiAgICAgICByZWRyYXcoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gVGhlIHBvaW50IHRoYXQgd2Ugd2FudCB0byBjaGVjayAibW92YWJpbGl0eSIgZm9yCiAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIG91ciBwb2ludCBpcyBpbiB0aGUgbGlzdCBvZiBtb3ZhYmxlIHBvaW50cywgb3RoZXJ3aXNlIGZhbHNlCiAqCiAqIEBzZWUge0BsaW5rIGNsZWFyTW92YWJsZX0KICogQHNlZSB7QGxpbmsgc2V0TW92YWJsZX0KICovCmZ1bmN0aW9uIGlzTW92YWJsZShwb2ludCkgewogIHJldHVybiBfX21vdmFibGVfcG9pbnRzLmluY2x1ZGVzKHBvaW50KTsKfQoKLyoqCiAqIEdldCB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0aGF0IHRoaXMKICogZ3JhcGhpYyBoYXMgYmVlbiBydW5uaW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBjb25zdCBzZWNvbmRzID0gKG1pbGxpcygpLzEwMDApfDA7CiAqICAgICAgIHRleHQoYCR7c2Vjb25kc31zYCwgd2lkdGgvMiwgaGVpZ2h0LzIpCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge251bWJlcn0gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZSB0aGUgZ3JhcGhpYyBsb2FkZWQgaW4KICovCmZ1bmN0aW9uIG1pbGxpcygpIHsKICByZXR1cm4gRGF0ZS5ub3coKSAtIF9fc3RhcnRfdGltZTsKfQoKLyoqCiAqIFBhdXNlIHRoZSBncmFwaGljIGlmIGl0cyBjdXJyZW50bHkgcGxheWluZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKS50b0ZpeGVkKDEpOwogKiAgICAgICB0ZXh0KGAke3NlY29uZHN9c2AsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICBpZihzdGF0ZSkgewogKiAgICAgICAgIHBhdXNlKCk7CiAqICAgICAgIH0gZWxzZSB7CiAqICAgICAgICAgcGxheSgpOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgcGxheX0KICogQHNlZSB7QGxpbmsgdG9nZ2xlUGxheX0KICovCmZ1bmN0aW9uIHBhdXNlKCkgewogIHBsYXlpbmcgPSBmYWxzZTsKfQoKLyoqCiAqIFN0YXJ0IHBsYXlpbmcgeW91ciBncmFwaGljLCBtZWFuaW5nIGl0IHdpbGwgY2FsbCBkcmF3KCkKICogYXQgd2hhdGV2ZXIgcmF0ZSB0aGUgcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGxvb3AgaXMKICogYWxsb3dlZCB0byBydW4gb24geW91ciBjb21wdXRlci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGxldCBmcHMgPSAwOwogKiAgICAgbGV0IGNoZWNrZWQgPSBmYWxzZTsKICogICAgIGxldCBsYXN0RnJhbWVDaGVjayA9IDA7CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIGNvbnN0IHNlY29uZHMgPSAobWlsbGlzKCkvMTAwMCkudG9GaXhlZCgxKTsKICogICAgICAgdGV4dChgZnBzOiAke2Zwc31gLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgICAgaWYgKHNlY29uZHMuZW5kc1dpdGgoYC4wYCkpIHsKICogICAgICAgICBpZiAoIWNoZWNrZWQpIHsKICogICAgICAgICAgIGNoZWNrZWQgPSB0cnVlOwogKiAgICAgICAgICAgZnBzID0gZnJhbWUgLSBsYXN0RnJhbWVDaGVjazsKICogICAgICAgICAgIGxhc3RGcmFtZUNoZWNrID0gZnJhbWU7CiAqICAgICAgICAgfQogKiAgICAgICB9IGVsc2UgewogKiAgICAgICAgIGNoZWNrZWQgPSBmYWxzZTsKICogICAgICAgfQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHBhdXNlfQogKiBAc2VlIHtAbGluayB0b2dnbGVQbGF5fQogKi8KZnVuY3Rpb24gcGxheSgpIHsKICBwbGF5aW5nID0gdHJ1ZTsKICBfX2RyYXcoKTsKfQoKLyoqCiAqIEdlbmVyYXRlIGEgcmFuZG9tIGNvbG91ci4gTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24KICogYWxsb3dzIHlvdSB0byBnZXQgInRoZSBjdXJyZW50bHkgZ2VuZXJhdGVkIHJhbmRvbQogKiBjb2xvdXIiIGluIGRpZmZlcmVudCBvcGFjaXRpZXMgYnkgY2FsbGluZyB0aGUgZnVuY3Rpb24KICogd2l0aCBhbiBvcGFjaXR5IHZhbHVlLCBhbmQgYGZhbHNlYCBhcyBjeWNsZSBhcmd1bWVudC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oKSB7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBvcGFjaXR5IFRoZSBvcGFjaXR5IHZhbHVlIGluIHRoZSByYW5nZSBbMCwxXQogKiBAcGFyYW0ge251bWJlcn0gY3ljbGU/IEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyB3aGV0aGVyIG9yIG5vdCB0byBtb3ZlIG9uIHRvIHRoZSBuZXh0IGNvbG91ciAoZGVmYXVsdCA9IHRydWUpCiAqCiAqIEBzZWUge0BsaW5rIGNvbG9yfQogKi8KZnVuY3Rpb24gcmFuZG9tQ29sb3IoYSA9IDEuMCwgY3ljbGUgPSB0cnVlKSB7CiAgaWYgKGN5Y2xlKSBfX2N1cnJlbnRfaHVlID0gcmFuZG9tKDAsIDM2MCk7CiAgcmV0dXJuIGBoc2xhKCR7X19jdXJyZW50X2h1ZX0sNTAlLDUwJSwke2F9KWA7Cn0KCi8qKgogKiBBbiBhbHRlcm5hdGl2ZSB0byB3cml0aW5nIGZvciBsb29wcywgYmVjYXVzZQogKiBubyBvbmUgd2FudHMgdG8gY29uc3RhbnRseSB3cml0ZSB2YXIgYWxsb2NhdGlvbnMKICogdGhhdCBvbmx5IGxpdmUgZm9yIHRoZSBkdXJhdGlvbiBvZiBhIGxvb3AuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcmFuZ2UoMCwgVEFVLCAoYSkgPT4gcG9pbnQoNDAgKiBjb3MoYSksIDQwICogc2luKGEpKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IFRoZSBlcXVpdmFsZW50IG9mIGEgZm9yIGxvb3AncyBpbml0aWFsIGBsZXQgaSA9IC4uLmAKICogQHBhcmFtIHtudW1iZXJ9IGVuZCBUaGUgZXF1aXZhbGVudCBvZiBhIGZvciBsb29wJ3MgYGkgPCBlbmRgCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGVwPyBUaGUgc3RlcCBzaXplIGJ5IHdoaWNoIHRvIGluY3JlbWVudCBhdCBlYWNoIGl0ZXJhdGlvbiAoZGVmYXVsdHMgPSBgKHN0YXJ0LWVuZCkvMTBgKQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBydW5GdW5jdGlvbiBUaGUgZnVuY3Rpb24gdG8gcnVuIGF0IGVhY2ggaXRlcmF0aW9uCiAqLwpmdW5jdGlvbiByYW5nZShzdGFydCwgZW5kLCBzdGVwLCBydW5GdW5jdGlvbikgewogIGlmICh0eXBlb2Ygc3RlcCA9PT0gYGZ1bmN0aW9uYCkgewogICAgcnVuRnVuY3Rpb24gPSBzdGVwOwogICAgc3RlcCA9IChlbmQgLSBzdGFydCkgLyAxMDsKICB9CiAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpICs9IHN0ZXApIHsKICAgIHJ1bkZ1bmN0aW9uKGkpOwogIH0KfQoKLyoqCiAqIFNhZmVseSB0cmlnZ2VyIGEgbmV3IGRyYXcgcGFzcy4gSWYgdGhlIGdyYXBoaWMgaXMgcnVubmluZwogKiBpbiBhbmltYXRlZCBtb2RlLCBvciBhIHJlZHJhdygpIGlzIHRyaWdnZXJlZCBfZHVyaW5nXyBhCiAqIHJlZHJhdygpLCB0aGlzIGNhbGwgd2lsbCBkbyBub3RoaW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY29uc3QgaCA9IG1hcChwb2ludGVyLngsIDAsIHdpZHRoLCAwLCAzNjApOwogKiAgICAgICBjb25zdCBsID0gbWFwKHBvaW50ZXIueSwgMCwgaGVpZ2h0LCA1MCwgMCk7CiAqICAgICAgIGNsZWFyKGNvbG9yKGgsIDEwMCwgbCkpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlck1vdmUoKSB7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqLwpmdW5jdGlvbiByZWRyYXcoKSB7CiAgaWYgKF9fcmVkcmF3aW5nKSByZXR1cm47CiAgaWYgKHBsYXlpbmcpIHJldHVybjsKICBfX3JlZHJhd2luZyA9IHRydWU7CiAgX19kcmF3KCk7CiAgX19yZWRyYXdpbmcgPSBmYWxzZTsKfQoKLyoqCiAqIFJlc3RvcmUgdGhlIGdyYXBoaWNzIGNvbnRleHQgKHRyYW5zZm9ybXMsCiAqIGN1cnJlbnQgY29sb3JzLCBldGMpIHRvIHdoYXQgdGhleSB3ZXJlCiAqIHdoZW4gc2F2ZSgpIHdhcyBjYWxsZWQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIGxpbmUoMCwwLDgwLDApOwogKiAgICAgICBzYXZlKCk7CiAqICAgICAgIHNldENvbG9yKGBkYXJrZ3JlZW5gKQogKiAgICAgICByYW5nZSgwLCA1LCAxLCAoYSkgPT4gewogKiAgICAgICAgIHJvdGF0ZShQSS84KTsKICogICAgICAgICBsaW5lKDAsMCw4MCwwKTsKICogICAgICAgfSk7CiAqICAgICAgIHJlc3RvcmUoKTsKICogICAgICAgbGluZSgtMjAsMCwtODAsMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2F2ZX0KICovCmZ1bmN0aW9uIHJlc3RvcmUoKSB7CiAgX19jdHgucmVzdG9yZSgpOwp9CgovKioKICogTWFyayBvbmUgb3IgbW9yZSBwb2ludHMgYXMgbW92YWJsZSwgbWVhbmluZwogKiB0aGF0IHRoZSB1c2VyIGNhbiByZXBvc2l0aW9uIHRoZSBwb2ludCBhcm91bmQgb24KICogdGhlIGNhbnZhcyBieSB0b3VjaC9jbGljay1kcmFnZ2luZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBmb3IgKGxldCBpID0gNDA7IGkgPCAyMDA7IGkgKz0gMjApIHsKICogICAgICAgICBwb2ludHMucHVzaChuZXcgUG9pbnQoaSAtIDIwLCAxMjApKTsKICogICAgICAgfQogKiAgICAgICBzZXRNb3ZhYmxlKC4uLnBvaW50cyk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgc2V0U3Ryb2tlKGBwdXJwbGVgKTsKICogICAgICAgYnNwbGluZSguLi5wb2ludHMpOwogKiAgICAgICBmb3IobGV0IHAgb2YgcG9pbnRzKSBwb2ludChwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge1BvaW50TGlrZVtuXX0gcG9pbnRzIE9uZSBvciBtb3JlIHBvaW50cyB0byBtYXJrIGFzIG1vdmFibGUuCiAqCiAqIEBzZWUge0BsaW5rIGlzTW92YWJsZX0KICogQHNlZSB7QGxpbmsgY2xlYXJNb3ZhYmxlfQogKi8KZnVuY3Rpb24gc2V0TW92YWJsZSguLi5wb2ludHMpIHsKICBwb2ludHMuZm9yRWFjaCgocCkgPT4gewogICAgaWYgKF9fbW92YWJsZV9wb2ludHMuaW5kZXhPZihwKSA9PT0gLTEpIHsKICAgICAgX19tb3ZhYmxlX3BvaW50cy5wdXNoKHApOwogICAgfQogIH0pOwp9CgovKioKICogU2V0IChvciBjaGFuZ2UpIHRoZSBncmFwaGljJ3Mgc2l6ZS4gTm90ZSB0aGF0IHlvdXIgd2lkdGgKICogYW5kIGhlaWdodCB2YWx1ZXMgd2lsbCBnZXQgcm91bmRlZCB0byBpbnRlZ2VyIHZhbHVlcy4KICoKICogTm90ZSB0aGF0IGBzZXRTaXplYCB3aWxsIGltbWVkaWF0ZWx5IHRyaWdnZXIgYSByZWRyYXcsCiAqIHdoZXRoZXIgeW91IHdhbnQgaXQgdG8gb3Igbm90LCBiZWNhdXNlIGNoYW5naW5nIGNhbnZhcwogKiBkaW1lbnNpb25zIGNsZWFycyB0aGUgY2FudmFzLCBuZWNlc3NpdGF0aW5nIGEgcmVkcmF3LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoNDAwLCAyMDApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgY2VudGVyKCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApCiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgdGV4dChgJHt3aWR0aH0vJHtoZWlnaHR9YCwgMCwgMCwgQ0VOVEVSLCBNSURETEUpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlclVwKCkgewogKiAgICAgICBzZXRTaXplKHJhbmRvbSgxMDAsNDAwKSwgMjAwKTsKICogICAgICAgLy8gTm90ZSB0aGF0IHRoZXJlIGlzIG5vIHJlZHJhdygpIGhlcmUhCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIFRoZSBncmFwaGljcyB3aWR0aCBpbiBwaXhlbHMKICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCBUaGUgZ3JhcGhpY3MgaGVpZ2h0IGluIHBpeGVscwogKi8KZnVuY3Rpb24gc2V0U2l6ZSh3ID0gNDAwLCBoID0gMjAwKSB7CiAgd2lkdGggPSBfX2NhbnZhcy53aWR0aCA9IHcgfCAwOwogIGhlaWdodCA9IF9fY2FudmFzLmhlaWdodCA9IGggfCAwOwogIF9fZWxlbWVudC5zdHlsZS5tYXhXaWR0aCA9IGBjYWxjKDJlbSArICR7d2lkdGh9cHhgOwogIF9fY3R4ID0gX19jYW52YXMuZ2V0Q29udGV4dChgMmRgKTsKICBfX2RyYXcoKTsKfQoKLyoqCiAqIFNhdmUgdGhlIGN1cnJlbnQgZ3JhcGhpY3MgY29udGV4dCAodHJhbnNmb3JtcywKICogY3VycmVudCBjb2xvcnMsIGV0Yykgc28gdGhhdCB0aG9zZSBjYW4gYmUgcmVzdG9yZWQKICogYWZ0ZXIgY2hhbmdpbmcgdGhlbS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZSgwLDAsODAsMCk7CiAqICAgICAgIHNhdmUoKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApCiAqICAgICAgIHJhbmdlKDAsIDUsIDEsIChhKSA9PiB7CiAqICAgICAgICAgcm90YXRlKFBJLzgpOwogKiAgICAgICAgIGxpbmUoMCwwLDgwLDApOwogKiAgICAgICB9KTsKICogICAgICAgcmVzdG9yZSgpOwogKiAgICAgICBsaW5lKC0yMCwwLC04MCwwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiAqIEBzZWUge0BsaW5rIHJlc3RvcmV9CiAqLwpmdW5jdGlvbiBzYXZlKCkgewogIF9fY3R4LnNhdmUoKTsKfQoKLyoqCiAqIENvbnZlcnQgdGhlIGN1cnJlbnQgY2FudmFzIGludG8gYW4gZGF0YSBVUkwKICogdGhhdCByZXByZXNlbnRzIGEgUE5HIGltYWdlLgogKgogKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgY3VycmVudCBjYW52YXMgYXMgUE5HIGRhdGEgVVJMCiAqLwpmdW5jdGlvbiB0b0RhdGFVUkwoKSB7CiAgcmV0dXJuIF9fY2FudmFzLnRvRGF0YVVSTCgpOwp9CgovKioKICogSWYgdGhlIGdyYXBoaWMgaXMgY3VycmVudGx5IHBsYXlpbmcsIHBhdXNlIGl0LAogKiBhbmQgaWYgaXQncyBwYXVzZWQsIHBsYXkgaXQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIGNvbnN0IHNlY29uZHMgPSAobWlsbGlzKCkvMTAwMCkudG9GaXhlZCgxKTsKICogICAgICAgdGV4dChgJHtzZWNvbmRzfXNgLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJBY3RpdmUoc3RhdGUpIHsKICogICAgICAgdG9nZ2xlUGxheSgpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEByZXR1cm5zIHtib29sZWFufSBUaGUgbmV3IHBsYXkgc3RhdGUKICoKICogQHNlZSB7QGxpbmsgcGF1c2V9CiAqIEBzZWUge0BsaW5rIHBsYXl9CiAqLwpmdW5jdGlvbiB0b2dnbGVQbGF5KCkgewogIHBsYXlpbmcgPyBwYXVzZSgpIDogcGxheSgpOwogIHJldHVybiBwbGF5aW5nOwp9CmNvbnN0IHsKICAvKioKICAgKiBHZXQgdGhlIGFic29sdXRlIHZhbHVlIGZvciBzb21lIGlucHV0CiAgICoKICAgKiBFeGFtcGxlOgogICAqCiAgICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAgICogICA8Z3JhcGhpY3Mtc291cmNlPgogICAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogICAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogICAqICAgICAgIHRyYW5zbGF0ZSgwLCBoZWlnaHQvMik7CiAgICogICAgICAgbm9GaWxsKCk7CiAgICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogICAqICAgICAgIGxpbmUoLWh1Z2UsIDAsIGh1Z2UsIDApOwogICAqCiAgICogICAgICAgY29uc3QgdzIgPSB3aWR0aC8yOwogICAqICAgICAgIGNvbnN0IGRhdGEgPSBhcnJheSh3aWR0aCwgKHgpID0+IFt4LCB4IC0gdzIsIGFicyh4IC0gdzIpXSk7CiAgICoKICAgKiAgICAgICBzZXRTdHJva2UoYHJlZGApOwogICAqICAgICAgIHBsb3REYXRhKGRhdGEsIDAsIDEpOwogICAqCiAgICogICAgICAgc2V0U3Ryb2tlKGBibHVlYCk7CiAgICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMik7CiAgICogICAgIH0KICAgKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogICAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSB2IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaW5wdXQgdmFsdWUgd2l0aCBpdHMgc2lnbiBzZXQgdG8gcG9zaXRpdmUKICAgKi8KICBhYnMsCgogIC8qKgogICAqIFRoZSBpbnZlcnNlIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IHYgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnZlcnNlIGNvc2luZSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgYXNpbn0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICBhY29zLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIGNvc2luZQogICAqCiAgICogQHNlZSB7QGxpbmsgYXNpbmh9CiAgICogQHNlZSB7QGxpbmsgYWNvc30KICAgKi8KICBhY29zaCwKCiAgLyoqCiAgICogVGhlIGludmVyc2Ugc2luZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaW52ZXJzZSBzaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBhY29zfQogICAqIEBzZWUge0BsaW5rIGFzaW5ofQogICAqLwogIGFzaW4sCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGludmVyc2Ugc2luZSBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIHNpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGFjb3NofQogICAqIEBzZWUge0BsaW5rIGFzaW59CiAgICovCiAgYXNpbmgsCgogIC8qKgogICAqIFRoZSBpbnZlcnNlIHRhbmdlbnQgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludmVyc2UgdGFuZ2VudAogICAqCiAgICogQHNlZSB7QGxpbmsgdGFufQogICAqLwogIGF0YW4sCgogIC8qKgogICAqIFRoZSAiYXRhbjIiIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQXRhbjIKICAgKgogICAqIEBwYXJhbSB7eX0gaW5wdXQgQW55IG51bWJlcgogICAqIEBwYXJhbSB7eH0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBhdGFuMiBhbmdsZSBmb3IgdGhpcyBudW1iZXIgcGFpcgogICAqLwogIGF0YW4yLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIHRhbmdlbnQgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnNlX2h5cGVyYm9saWNfZnVuY3Rpb25zI0RlZmluaXRpb25zX2luX3Rlcm1zX29mX2xvZ2FyaXRobXMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGh5cGVyYm9saWMgaW52ZXJzZSB0YW5nZW50CiAgICoKICAgKiBAc2VlIHtAbGluayB0YW59CiAgICogQHNlZSB7QGxpbmsgYWNvc2h9CiAgICogQHNlZSB7QGxpbmsgYXNpbmh9CiAgICovCiAgYXRhbmgsCgogIC8qKgogICAqIFRoZSBjdWJlIHJvb3QgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIChyZWFsKSBjdWJlIHJvb3Qgb2YgdGhhdCBudW1iZXIKICAgKgogICAqIEBzZWUge0BsaW5rIHNxcnR9CiAgICovCiAgY2JydCwKCiAgLyoqCiAgICogVGhlICJyb3VuZCB1cCB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIiBmdW5jdGlvbi4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludGVnZXIgcmVzdWx0IGFmdGVyIHJvdW5kaW5nIHVwLgogICAqCiAgICogQHNlZSB7QGxpbmsgZmxvb3J9CiAgICogQHNlZSB7QGxpbmsgcm91bmR9CiAgICovCiAgY2VpbCwKCiAgLyoqCiAgICogR2V0IHRoZSBudW1iZXIgb2YgbGVhZGluZyB6ZXJvIGJpdHMgaW4gdGhlIDMyLWJpdCBiaW5hcnkgcmVwcmVzZW50YXRpb24gb2YgYSBudW1iZXIKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIG51bWJlciBvZiBsZWFkaW5nIHplcm8gYml0cyBpbiB0aGUgMzItYml0IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGF0IG51bWJlci4KICAgKi8KICBjbHozMiwKCiAgLyoqCiAgICogVGhlIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY29zaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBzaW59CiAgICovCiAgY29zLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBjb3NpbmUgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnNlX2h5cGVyYm9saWNfZnVuY3Rpb25zI0RlZmluaXRpb25zX2luX3Rlcm1zX29mX2xvZ2FyaXRobXMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGh5cGVyYm9saWMgY29zaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBjb3N9CiAgICogQHNlZSB7QGxpbmsgYWNvc2h9CiAgICovCiAgY29zaCwKCiAgLyoqCiAgICogVGhlIGV4cG9uZW50IGZ1bmN0aW9uLCB0aGF0IGlzOiBlXngKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIHZhbHVlIG9mIEUgcmFpc2VkIHRvIHRoYXQgbnVtYmVyJ3MgcG93ZXIKICAgKgogICAqIEBzZWUge0BsaW5rIEV9CiAgICovCiAgZXhwLAoKICAvKioKICAgKiBUaGUgInJvdW5kIGRvd24gdG8gdGhlIG5lYXJlc3QgaW50ZWdlciIgZnVuY3Rpb24uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnRlZ2VyIHJlc3VsdCBhZnRlciByb3VuZGluZyBkb3duLgogICAqCiAgICogQHNlZSB7QGxpbmsgY2VpbH0KICAgKiBAc2VlIHtAbGluayByb3VuZH0KICAgKi8KICBmbG9vciwKCiAgLyoqCiAgICogUm91bmQgYSBudW1iZXIgdG8gdGhlIG5lYXJlc3QgMzIgYml0LCByYXRoZXIgdGhhbiB0aGUKICAgKiBzdGFuZGFyZCBKUyA2NCBiaXQsIGZsb2F0aW5nIHBvaW50IHJlcHJlc2VudGF0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgbnVtYmVyIGFmdGVyIHJvdW5kaW5nIHRvIHRoZSBuZWFyZXN0IDMyIGJpdCBmbG9hdGluZyBwb2ludCByZXByZXNlbnRhdGlvbi4KICAgKgogICAqIEBzZWUge0BsaW5rIHJvdW5kfQogICAqLwogIGZyb3VuZCwKCiAgLyoqCiAgICogVGhlIEV1Y2xpZGVhbiBoeXBvdGVudXNlIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcltdfSAuLi5pbnB1dCBUd28gb3IgbW9yZSBudW1iZXJzCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGh5cG90ZW51c2UgZ2l2ZW4gdGhvc2UgbnVtYmVycy4KICAgKi8KICBoeXBvdCwKCiAgLyoqCiAgICogVGhlIDMyIGJpdCBpbnRlZ2VyIG11bHRpcGxpY2F0aW9uIGZ1bmN0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGEgQW55IDMyIGJpdCBpbnRlZ2VyCiAgICogQHBhcmFtIHtudW1iZXJ9IGIgQW55IDMyIGJpdCBpbnRlZ2VyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIDMyIGJpdCBpbnRlZ2VyIHJlc3VsdCBvZiBhICogYgogICAqLwogIGltdWwsCgogIC8qKgogICAqIFRoZSBuYXR1cmFsIGxvZ2FyaXRobSBmdW5jdGlvbiwgaS5lLiB0aGUgYmFzZS1FIGxvZ2FyaXRobQogICAqCiAgICogKE5vdGUgdGhhdCBpbiBKUyB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCAibG9nIiByYXRoZXIgdGhhbiAibG4iKQogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgbmF0dXJhbCBsb2dhcml0aG0gb2YgdGhhdCBudW1iZXIKICAgKgogICAqIEBzZWUge0BsaW5rIEV9CiAgICogQHNlZSB7QGxpbmsgbG9nfQogICAqLwogIGxvZzogbG4sCgogIC8qKgogICAqIFRoZSAiY29tbW9uIGxvZ2FyaXRobSIgZnVuY3Rpb24sIGkuZS4gdGhlIGJhc2UtMTAgbG9nYXJpdGhtLgogICAqCiAgICogKE5vdGUgdGhhdCBpbiBKUyB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCAibG9nMTAiIHJhdGhlciB0aGFuICJsb2ciKQogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY29tbW9uIGxvZ2FyaXRobSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgbG59CiAgICovCiAgbG9nMTA6IGxvZywKCiAgLyoqCiAgICogVGhlIGJpbmFyeSBsb2dhcml0aG0gZnVuY3Rpb24sIGkuZS4gdGhlIGJhc2UtMiBsb2dhcml0aG0uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBiYXNlIDIgbG9nYXJpdGhtIG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBsbn0KICAgKiBAc2VlIHtAbGluayBsb2d9CiAgICovCiAgbG9nMiwKCiAgLyoqCiAgICogRmluZCB0aGUgbWF4aW11bSB2YWx1ZSBpbiBhIHNldCBvZiBudW1iZXJzCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gLi4uaW5wdXQgQW55IHR3byBvciAgbW9yZSBudW1iZXJzCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGhpZ2hlc3QgdmFsdWVkIG51bWJlciBmcm9tIGFtb25nIHRoZSBpbnB1dC4KICAgKgogICAqIEBzZWUge0BsaW5rIG1pbn0KICAgKi8KICBtYXgsCgogIC8qKgogICAqIEZpbmQgdGhlIG1pbmltdW0gdmFsdWUgaW4gYSBzZXQgb2YgbnVtYmVycwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IC4uLmlucHV0IEFueSB0d28gb3IgIG1vcmUgbnVtYmVycwogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBsb3dlc3QgdmFsdWVkIG51bWJlciBmcm9tIGFtb25nIHRoZSBpbnB1dC4KICAgKgogICAqIEBzZWUge0BsaW5rIG1heH0KICAgKi8KICBtaW4sCgogIC8qKgogICAqIFRoZSBwb3dlciBmdW5jdGlvbi4KICAgKgogICAqIE5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIGEgaG9sZG92ZXIgZnJvbSBiZWZvcmUgSlMKICAgKiBoYWQgdGhlIGAqKmAgb3BlcmF0b3IgZm9yIHBlcmZvcm1pbmcgdGhpcyBjYWxjdWxhdGlvbi4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBhIEFueSBudW1iZXIKICAgKiBAcGFyYW0ge251bWJlcn0gYiBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcnxOYU59IG91dHB1dCBhICoqIGIgb3IgTmFOIGlmIHRoYXQgaXMgdW5kZWZpbmVkCiAgICovCiAgcG93LAoKICAvKioKICAgKiBUaGUgInJvdW5kIHRvIHRoZSBuZWFyZXN0IGludGVnZXIiIGZ1bmN0aW9uLCByb3VuZGluZyBhbnkKICAgKiB2YWx1ZSBbeC4wLCB4LjQ5OTkuLi5dIHRvIHgsIGFuZCBhbnkgdmFsdWUgW3guNSwgeC45OTkuLi5dCiAgICogdG8geCArIDEuCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnRlZ2VyIHJlc3VsdCBhZnRlciByb3VuZGluZy4KICAgKgogICAqIEBzZWUge0BsaW5rIGNlaWx9CiAgICogQHNlZSB7QGxpbmsgZmxvb3J9CiAgICovCiAgcm91bmQsCgogIC8qKgogICAqIEdldCB0aGUgc2lnbiBvZiBhIG51bWJlcgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSArMSBpZiB0aGUgbnVtYmVyIHdhcyBwb3NpdGl2ZSwgLTEgaWYgaXQgd2FzIG5lZ2F0aXZlLCBvciAwIGlmIHRoZSBpbnB1dCB3YXMgemVyby4KICAgKi8KICBzaWduLAoKICAvKioKICAgKiBUaGUgc2luZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgc2luZQogICAqCiAgICogQHNlZSB7QGxpbmsgY29zfQogICAqLwogIHNpbiwKCiAgLyoqCiAgICogVGhlIGh5cGVyYm9saWMgc2luZSBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwZXJib2xpYyBzaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBzaW59CiAgICogQHNlZSB7QGxpbmsgYWNvc2h9CiAgICovCiAgc2luaCwKCiAgLyoqCiAgICogVGhlIHNxdWFyZSByb290IGZ1bmN0aW9uLgogICAqCiAgICoKICAgKiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBpcyBhIGhvbGRvdmVyIGZyb20gYmVmb3JlIEpTCiAgICogaGFkIHRoZSBgKipgIG9wZXJhdG9yIGZvciBwZXJmb3JtaW5nIHRoaXMgY2FsY3VsYXRpb24KICAgKiBieSB1c2luZyBgeCAqKiAwLjVgLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgc3F1YXJlIHJvb3Qgb2YgdGhhdCBudW1iZXIKICAgKgogICAqIEBzZWUge0BsaW5rIGNicnR9CiAgICogQHNlZSB7QGxpbmsgcG93fQogICAqLwogIHNxcnQsCgogIC8qKgogICAqIFRoZSB0YW5nZW50IGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSB0YW5nZW50CiAgICovCiAgdGFuLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyB0YW5nZW50IGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBoeXBlcmJvbGljIHRhbmdlbnQKICAgKgogICAqIEBzZWUge0BsaW5rIHRhbn0KICAgKiBAc2VlIHtAbGluayBhc2luaH0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICB0YW5oLAoKICAvKioKICAgKiBUcnVuY2F0ZSBhIGZyYWN0aW9uIHRvIGFuIGludGVnZXIgYnkgc2ltcGx5IGRyb3BwaW5nIHRoZSBmcmFjdGlvbmFsIHBhcnQuCiAgICogTm90ZSB0aGF0IHRoaXMgZGlmZmVycyBmcm9tIHRoZSBgZmxvb3JgIGZ1bmN0aW9uOgogICAqCiAgICogYGBgCiAgICogZmxvb3IoNC4yKTsgIC8vIDQKICAgKiBmbG9vcigtNC4yKTsgLy8gLTUKICAgKgogICAqIHRydW5jKDQuMik7ICAvLyA0CiAgICogdHJ1bmMoLTQuMik7IC8vIC00CiAgICogYGBgCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnRlZ2VyIHBhcnQgb25seSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgZmxvb3J9CiAgICovCiAgdHJ1bmMsCn0gPSBNYXRoOwoKLyoqCiAqIEdldCB0aGUgYmlub21pYWwgY29lZmZpY2llbnQgKG4gY2hvb3NlIGspLgogKgogKiBAcGFyYW0ge251bWJlcn0gbiBBIHBvc2l0aXZlIGludGVnZXIKICogQHBhcmFtIHtudW1iZXJ9IGsgQSBwb3NpdGl2ZSBpbnRlZ2VyIGxlc3MgdGhhbiBvciBlcXVhbCB0byBgbmAKICogQHJldHVybnMge251bWJlcn0gVGhlIHZhbHVlIChuIGNob29zZSBrKQogKi8KZnVuY3Rpb24gYmlub21pYWwobiwgaykgewogIGlmIChuID09PSAwKSByZXR1cm4gMTsKICB2YXIgbHV0ID0gX19iaW5vbWlhbENvZWZmaWNpZW50czsKICB3aGlsZSAobiA+PSBsdXQubGVuZ3RoKSB7CiAgICB2YXIgcyA9IGx1dC5sZW5ndGg7CiAgICB2YXIgbmV4dFJvdyA9IFsxXTsKICAgIGZvciAodmFyIGkgPSAxLCBwcmV2ID0gcyAtIDE7IGkgPCBzOyBpKyspIHsKICAgICAgbmV4dFJvd1tpXSA9IGx1dFtwcmV2XVtpIC0gMV0gKyBsdXRbcHJldl1baV07CiAgICB9CiAgICBuZXh0Um93W3NdID0gMTsKICAgIGx1dC5wdXNoKG5leHRSb3cpOwogIH0KICByZXR1cm4gbHV0W25dW2tdOwp9CgovKioKICogQ29uc3RyYWluIGEgbnVtYmVyIHRvIHdpdGhpbiBhIGdpdmVuIHJhbmdlLgogKiBUaGlzIGlzIHJlYWxseSBub3RoaW5nIG1vcmUgdGhhbiBhIGNvbnZlbmllbnQKICogZnVuY3Rpb24gd3JhcHBlciBhcm91bmQgdGhlIHN0YXRlbWVudDoKICoKICogYGBgCiAqIHYgPCBzID8gcyA6IHYgPiBlID8gZSA6IHYKICogYGBgCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29uc3RyYWluCiAqIEBwYXJhbSB7bnVtYmVyfSBsb3dlckJvdW5kIFRoZSBsb3dlciBib3VuZCBvbiBvdXIgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHVwcGVyQm91bmQgVGhlIHVwcGVyIGJvdW5kIG9uIG91ciB2YWx1ZQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgdmFsdWUsIGlmIGl0IGZhbGxzIHdpdGhpbmcgW2xvd2VyQm91bmQsdXBwZXJCb3VuZF0sIG90aGVyd2lzZSBvbmUgb2YgdGhvc2UgYm91bmRzLgogKgogKiBAc2VlIHtAbGluayBjb25zdHJhaW5NYXB9CiAqLwpmdW5jdGlvbiBjb25zdHJhaW4odiwgcywgZSkgewogIHJldHVybiB2IDwgcyA/IHMgOiB2ID4gZSA/IGUgOiB2Owp9CgovKioKICogVGhlIGNvc2VjYW50IGZ1bmN0aW9uLCB3aGljaCBpczoKICoKICogYGBgCiAqIDEgLyBzaW4odikKICogYGBgCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgaW5wdXQgdmFsdWUsIGluIHJhZGlhbnMuCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBjb3NlY2FudCBvZiBvdXIgdmFsdWUuCiAqCiAqIEBzZWUge0BsaW5rIHNlY30KICovCmZ1bmN0aW9uIGNzYyh2KSB7CiAgcmV0dXJuIDEgLyBzaW4odik7Cn0KCi8qKgogKiBUaGUgY290YW5nZW50IGZ1bmN0aW9uLCB3aGljaCBpczoKICoKICogYGBgCiAqIGNvcyh2KSAvIHNpbih2KQogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSBpbnB1dCB2YWx1ZSwgaW4gcmFkaWFucy4KICogQHJldHVybnMge251bWJlcn0gVGhlIGNvdGFuZ2VudCBvZiBvdXIgdmFsdWUuCiAqCiAqIEBzZWUge0BsaW5rIHRhbn0KICovCmZ1bmN0aW9uIGN0bih2KSB7CiAgcmV0dXJuIGNvcyh2KSAvIHNpbih2KTsKfQoKLyoqCiAqIENvbnZlcnQgYSBudW1iZXIgaW4gcmFkaWFucyB0byBhIG51bWJlciBpbiBkZWdyZWVzLgogKiBUaGlzIGlzIHJlYWxseSBub3RoaW5nIG1vcmUgdGhhbiBhIGNvbnZlbmllbnQKICogZnVuY3Rpb24gd3JhcHBlciBhcm91bmQgdGhlIHN0YXRlbWVudDoKICoKICogYGBgCiAqIHYvUEkgKiAxODAKICogYGBgCiAqCiAqIFdpdGggb25lIHRyaWNrLCBpbiB0aGF0IGl0IGFsbG93cyB5b3UgdG8gY29uc3RyYWluIHRoZQogKiByZXN1bHRhbnQgdmFsdWUgdG8gdGhlIHN0YW5kYXJkIFswLCAzNjBdIGludGVydmFsLgogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnN0cmFpbgogKiBAcGFyYW0ge2Jvb2xlYW59IGNvbnN0cmFpbj8gQSBib29sZWFuIHRoYXQgZGV0ZXJtaW5lcyB3aGV0aGVyIG9yIG5vdCB0byBjb25zdHJhaW4gdGhlIHJlc3VsdGFudCB2YWx1ZSB0byBbMCwgMzYwXSAoZGVmYXVsdCA9IGZhbHNlKQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgZGVncmVlIHZhbHVlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGlucHV0IHZhbHVlIGluIHJhZGlhbnMsIG9wdGlvbmFsbHkgY29uc3RyYWluZWQgdG8gWzAsIDM2MF0KICoKICogQHNlZSB7QGxpbmsgcmFkaWFuc30KICogQHNlZSB7QGxpbmsgY29uc3RyYWlufQogKi8KZnVuY3Rpb24gZGVncmVlcyh2LCBjb25zdHJhaW4gPSBmYWxzZSkgewogIGxldCBkID0gKHYgLyBQSSkgKiAxODA7CiAgaWYgKCFjb25zdHJhaW4pIHJldHVybiBkOwogIHdoaWxlIChkIDwgMCkgZCArPSAzNjA7CiAgcmV0dXJuIGQgJSAzNjA7Cn0KCi8qKgogKiBDYWxjdWxhdGUgdGhlIDJEIEV1Y2xpZGVhbiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwb2ludHMuCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4MSBUaGUgZmlyc3QgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MSBUaGUgZmlyc3QgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB4MiBUaGUgc2Vjb25kIHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTIgVGhlIHNlY29uZCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICogQHJldHVybnMge251bWJlcn0gVGhlIGV1Y2xpZGVhbiBkaXN0YW5jZSBiZXR3ZWVuIHRoZSB0d28gY29vcmRpbmF0ZXMKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAxIFRoZSBmaXJzdCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtQb2ludExpa2V9IHAyIFRoZSBzZWNvbmQgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBldWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiB0aGUgdHdvIGNvb3JkaW5hdGVzCiAqLwpmdW5jdGlvbiBkaXN0KHgxLCB5MSwgeDIsIHkyKSB7CiAgaWYgKHgxLnggIT09IHVuZGVmaW5lZCAmJiB4MS55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkyID0geTEueTsKICAgIHgyID0geTEueDsKICAgIHkxID0geDEueTsKICAgIHgxID0geDEueDsKICB9CiAgY29uc3QgZHggPSB4MiAtIHgxOwogIGNvbnN0IGR5ID0geTIgLSB5MTsKICByZXR1cm4gaHlwb3QoZHgsIGR5KTsKfQoKLyoqCiAqIFBlcmZvcm1zIGEgbGluZS9saW5lIGludGVyc2VjdGlvbiB0ZXN0IGdpdmUgZWl0aGVyIGZvdXIgcG9pbnRzCiAqIGRlZmluaW5nIHRoZSBsaW5lcyAocDEtLXAyKSBhbmQgKHAzLS1wNCksIG9yIGVpZ2h0IGNvb3JkaW5hdGVzCiAqIHNwYW5uaW5nIGxpbmVzICh4MSx5MSktLSh4Mix5MikgYW5kICh4Myx5MyktLSh4NCx5NCkuCiAqCiAqIFRoaXMgZnVuY3Rpb24gY292ZXJzIGJvdGggImxpbmUvbGluZSIgYW5kICJzZWdtZW50Ii8ic2VnbWVudCIKICogdGVzdGluZyBieSBzZXR0aW5nIGEgYm9vbGVhbiB2YWx1ZSBgaW5Cb3VuZHNgIG9uIHRoZSByZXN1bHQ6CiAqIHdoZW4gZmFsc2UsIHRoZXJlIGlzIG9ubHkgYSBsaW5lL2xpbmUgaW50ZXJzZWN0aW9uLCBidXQgd2hlbgogKiB0cnVlLCB0aGUgYWN0dWFsIGxpbmUgc2VnbWVudHMgaW50ZXJzZWN0LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgY2VudGVyKCk7CiAqICAgICAgIC8vIC4uLmNvZGUgZ29lcyBoZXJlLi4uCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHgxIFRoZSBmaXJzdCBwb2ludCdzIHggY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0geTEgVGhlIGZpcnN0IHBvaW50J3MgeSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB4MiBUaGUgc2Vjb25kIHBvaW50J3MgeCBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MiBUaGUgc2Vjb25kIHBvaW50J3MgeSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB4MyBUaGUgdGhpcmQgcG9pbnQncyB4IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHkzIFRoZSB0aGlyZCBwb2ludCdzIHkgY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0geDQgVGhlIGZvdXJ0aCBwb2ludCdzIHggY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0geTQgVGhlIGZvdXJ0aCBwb2ludCdzIHkgY29vcmRpbmF0ZQogKiBAcmV0dXJucyB7UG9pbnRMaWtlfGZhbHNlfSBFaXRoZXIgdGhlIGludGVyc2VjdGlvbiBwb2ludCwgb3IgZmFsc2UgaWYgdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uCiAqCiAqIEBwYXJhbSB7UG9pbnRMaW5lfSBwMSBUaGUgZmlyc3QgY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGluZX0gcDIgVGhlIHNlY29uZCBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaW5lfSBwMyBUaGUgdGhpcmQgY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGluZX0gcDQgVGhlIGZvdXJ0aCBjb29yZGluYXRlCiAqIEByZXR1cm5zIHtQb2ludExpa2V8ZmFsc2V9IEVpdGhlciB0aGUgaW50ZXJzZWN0aW9uIHBvaW50LCBvciBmYWxzZSBpZiB0aGVyZSBpcyBubyBpbnRlcnNlY3Rpb24KICovCmZ1bmN0aW9uIGxsaSh4MSwgeTEsIHgyLCB5MiwgeDMsIHkzLCB4NCwgeTQpIHsKICBpZiAoeDEueCAhPT0gdW5kZWZpbmVkICYmIHgxLnkgIT09IHVuZGVmaW5lZCkgewogICAgeTQgPSB5Mi55OwogICAgeDQgPSB5Mi54OwogICAgeTMgPSB4Mi55OwogICAgeDMgPSB4Mi54OwogICAgeTIgPSB5MS55OwogICAgeDIgPSB5MS54OwogICAgeTEgPSB4MS55OwogICAgeDEgPSB4MS54OwogIH0KICBjb25zdCBueCA9ICh4MSAqIHkyIC0geTEgKiB4MikgKiAoeDMgLSB4NCkgLSAoeDEgLSB4MikgKiAoeDMgKiB5NCAtIHkzICogeDQpOwogIGNvbnN0IG55ID0gKHgxICogeTIgLSB5MSAqIHgyKSAqICh5MyAtIHk0KSAtICh5MSAtIHkyKSAqICh4MyAqIHk0IC0geTMgKiB4NCk7CiAgY29uc3QgZCA9ICh4MSAtIHgyKSAqICh5MyAtIHk0KSAtICh5MSAtIHkyKSAqICh4MyAtIHg0KTsKCiAgaWYgKGQgPT09IDApIHJldHVybiBmYWxzZTsKCiAgY29uc3QgciA9IHsgeDogbnggLyBkLCB5OiBueSAvIGQsIGluQm91bmRzOiB0cnVlIH07CiAgbGV0IGEgPSB4MTsKICBsZXQgYiA9IHgyOwogIGlmICh4MSA+IHgyKSB7CiAgICBhID0geDI7CiAgICBiID0geDE7CiAgfQogIGlmIChyLnggPCBhIHx8IHIueCA+IGIpIHIuaW5Cb3VuZHMgPSBmYWxzZTsKICBlbHNlIHsKICAgIGEgPSB5MTsKICAgIGIgPSB5MjsKICAgIGlmICh5MSA+IHkyKSB7CiAgICAgIGEgPSB5MjsKICAgICAgYiA9IHkxOwogICAgfQogICAgaWYgKHIueSA8IGEgfHwgci55ID4gYikgci5pbkJvdW5kcyA9IGZhbHNlOwogICAgZWxzZSB7CiAgICAgIGEgPSB4MzsKICAgICAgYiA9IHg0OwogICAgICBpZiAoeDMgPiB4NCkgewogICAgICAgIGEgPSB4NDsKICAgICAgICBiID0geDM7CiAgICAgIH0KICAgICAgaWYgKHIueCA8IGEgfHwgci54ID4gYikgci5pbkJvdW5kcyA9IGZhbHNlOwogICAgICBlbHNlIHsKICAgICAgICBhID0geTM7CiAgICAgICAgYiA9IHk0OwogICAgICAgIGlmICh5MyA+IHk0KSB7CiAgICAgICAgICBhID0geTQ7CiAgICAgICAgICBiID0geTM7CiAgICAgICAgfQogICAgICAgIGlmIChyLnkgPCBhIHx8IHIueSA+IGIpIHIuaW5Cb3VuZHMgPSBmYWxzZTsKICAgICAgfQogICAgfQogIH0KICByZXR1cm4gcjsKfQoKLyoqCiAqIE1hcCBhIHZhbHVlIGZyb20gb25lIGludGVydmFsIHRvIGFub3RoZXIsIG9wdGlvbmFsbHkKICogY29uc3RyYWluZWQgdG8gdGhlIHRhcmdldCBpbnRlcnZhbC4KICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIE91ciBpbnB1dCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gb3JpZ2luYWxTdGFydCBUaGUgbG93ZXIgYm91bmQgb2Ygb3VyIGRvbWFpbgogKiBAcGFyYW0ge251bWJlcn0gb3JpZ2luYWxFbmQgVGhlIHVwcGVyIGJvdW5kIG9mIG91ciBkb21haW4KICogQHBhcmFtIHtudW1iZXJ9IG5ld1N0YXJ0IFRoZSBsb3dlciBib3VuZCBvZiBvdXIgdGFyZ2V0IGludGVydmFsCiAqIEBwYXJhbSB7bnVtYmVyfSBuZXdFbmQgVGhlIHVwcGVyIGJvdW5kIG9uIG91ciB0YXJnZXQgaW50ZXJ2YWwKICogQHBhcmFtIHtib29sZWFufSBjb25zdHJhaW4/ICBBIGJvb2xlYW4gdGhhdCBkZXRlcm1pbmVzIHdoZXRoZXIgb3Igbm90IHRvIGNvbnN0cmFpbiB0aGUgcmVzdWx0YW50IHZhbHVlIHRvIFtuZXdTdGFydCxuZXdFbmRdIChkZWZhdWx0ID0gZmFsc2UpCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSByZXN1bHQgb2YgbWFwcGluZyBvdXIgdmFsdWUgZnJvbSBvdXIgZG9tYWluIGludGVydmFsIHRvIG91ciB0YXJnZXQgaW50ZXJ2YWwsIG9wdGlvbmFsbHkgY29uc3RyYWluZWQgdG8gdGhlIHRhcmdldCBpbnRlcnZhbC4KICoKICogQHNlZSB7QGxpbmsgY29uc3RyYWlufQogKiBAc2VlIHtAbGluayBjb25zdHJhaW5NYXB9CiAqLwpmdW5jdGlvbiBtYXAodiwgcywgZSwgbnMsIG5lLCBjb25zdHJhaW5lZCA9IGZhbHNlKSB7CiAgY29uc3QgaTEgPSBlIC0gcywKICAgIGkyID0gbmUgLSBucywKICAgIHAgPSB2IC0gczsKICBsZXQgciA9IG5zICsgKHAgKiBpMikgLyBpMTsKICBpZiAoY29uc3RyYWluZWQpIHJldHVybiBjb25zdHJhaW4ociwgbnMsIG5lKTsKICByZXR1cm4gcjsKfQoKLyoqCiAqIENvbnZlcnQgYSBudW1iZXIgaW4gZGVncmVlcyB0byBhIG51bWJlciBpbiByYWRpYW5zLgogKiBUaGlzIGlzIHJlYWxseSBub3RoaW5nIG1vcmUgdGhhbiBhIGNvbnZlbmllbnQKICogZnVuY3Rpb24gd3JhcHBlciBhcm91bmQgdGhlIHN0YXRlbWVudDoKICoKICogYGBgCiAqIHYvMTgwICogUEkKICogYGBgCiAqCiAqIFdpdGggb25lIHRyaWNrLCBpbiB0aGF0IGl0IGFsbG93cyB5b3UgdG8gY29uc3RyYWluIHRoZQogKiByZXN1bHRhbnQgdmFsdWUgdG8gdGhlIHN0YW5kYXJkIFswLCBUQVVdIGludGVydmFsLgogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnN0cmFpbgogKiBAcGFyYW0ge2Jvb2xlYW59IGNvbnN0cmFpbj8gQSBib29sZWFuIHRoYXQgZGV0ZXJtaW5lcyB3aGV0aGVyIG9yIG5vdCB0byBjb25zdHJhaW4gdGhlIHJlc3VsdGFudCB2YWx1ZSB0byBbMCwgVEFVXSAoZGVmYXVsdCA9IGZhbHNlKQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgcmFkaWFucyB2YWx1ZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBpbnB1dCB2YWx1ZSBpbiBkZWdyZWVzLCBvcHRpb25hbGx5IGNvbnN0cmFpbmVkIHRvIFswLCBUQVVdCiAqCiAqIEBzZWUge0BsaW5rIGRlZ3JlZXN9CiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbn0KICovCmZ1bmN0aW9uIHJhZGlhbnModiwgY29uc3RyYWluID0gZmFsc2UpIHsKICBsZXQgciA9ICh2IC8gMTgwKSAqIFBJOwogIGlmICghY29uc3RyYWluKSByZXR1cm4gcjsKICB3aGlsZSAociA8IDApIHIgKz0gVEFVOwogIHJldHVybiByICUgVEFVOwp9CgovKioKICogR2VuZXJhdGUgYSBwc2V1ZG8tcmFuZG9tIG51bWJlci4KICoKICogVGhpcyBpcyBiYXNlZCBvbiB0aGUgU3BsaXRNaXgzMiBhbGdvcml0aG0sIGNvdmVyZWQKICogb3ZlciBvbiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDc1OTMzMTYvNzQwNTUzCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDIwKTsKICogICAgICAgcmFuZ2UoMCwgaGVpZ2h0ICsgMjAsIDIwLCAodikgPT4gewogKiAgICAgICAgIHRleHQocmFuZG9tKCksIDUsIHYpOwogKiAgICAgICB9KQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqCiAqCiAqIEByZXR1cm5zIHtudW1iZXJ9IEEgcmFuZG9tIG51bWJlciBpbiB0aGUgaW50ZXJ2YWwgWzAsMSkKICoKICogQHBhcmFtIHtudW1iZXJ9IGEgVGhlIHVwcGVyIGJvdW5kIGZvciB0aGUgcmFuZG9tIG51bWJlcgogKiBAcmV0dXJucyB7bnVtYmVyfSBBIHJhbmRvbSBudW1iZXIgaW4gdGhlIGludGVydmFsIFswLGEpCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBhIFRoZSBsb3dlciBib3VuZCBmb3IgdGhlIHJhbmRvbSBudW1iZXIKICogQHBhcmFtIHtudW1iZXJ9IGIgVGhlIHVwcGVyIGJvdW5kIGZvciB0aGUgcmFuZG9tIG51bWJlcgogKiBAcmV0dXJucyB7bnVtYmVyfSBBIHJhbmRvbSBudW1iZXIgaW4gdGhlIGludGVydmFsIFthLCBiKQogKgogKiBAc2VlIHtAbGluayByYW5kb21TZWVkfQogKi8KZnVuY3Rpb24gcmFuZG9tKGEgPSAxLCBiKSB7CiAgY29uc3QgciA9IF9fcHJuZy5uZXh0KCk7CiAgaWYgKGIgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGEgKiByOwogIHJldHVybiBhICsgciAqIChiIC0gYSk7Cn0KCi8qKgogKiBTZXQgdGhlIHBzZXVkby1yYW5kb20gbnVtYmVyIGdlbmVyYXRvciBzZWVkLiBJZiBubyBzZWVkCiAqIHZhbHVlIGlzIHByb3ZpZGVkLCB0aGlzIGlzIGVxdWl2YWxlbnQgdG8gY2FsbGluZzoKICoKICogYGBgCiAqIHJhbmRvbVNlZWQoRGF0ZS5ub3coKSAqIE1hdGgucmFuZG9tKCkpCiAqIGBgYAogKgogKiBAcGFyYW0ge251bWJlcn0gc2VlZD8gVGhlIHJhbmRvbSBzZWVkIHZhbHVlLgogKgogKiBAc2VlIHtAbGluayByYW5kb219CiAqLwpmdW5jdGlvbiByYW5kb21TZWVkKHNlZWQgPSBEYXRlLm5vdygpICogTWF0aC5yYW5kb20oKSkgewogIF9fcHJuZy5yZXNlZWQoc2VlZCk7Cn0KCi8qKgogKiBUaGUgc2VjYW50IGZ1bmN0aW9uLCB3aGljaCBpczoKICoKICogYGBgCiAqIDEgLyBjb3ModikKICogYGBgCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgaW5wdXQgdmFsdWUsIGluIHJhZGlhbnMuCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBzZWNhbnQgb2Ygb3VyIHZhbHVlLgogKgogKiBAc2VlIHtAbGluayBjc2N9CiAqLwpmdW5jdGlvbiBzZWModikgewogIHJldHVybiAxIC8gY29zKHYpOwp9Ci8qKgogKiBJbnZlcnQgYSBtYXRyaXgsIG9yIHVuZGVmaW5lZCBpZiB0aGUgbWF0cml4IGlzIG5vdCBpbnZlcnRpYmxlLgogKgogKiBAcGFyYW0ge01hdHJpeH0gTSBUaGUgbWF0cml4IHRvIGludmVydAogKiBAcmV0dXJucyB7bnVtYmVyW11bXX0gVGhlIG1hdHJpeCBpbnZlcnNlIGFzIDJEIG51bWJlciBhcnJheQogKi8KZnVuY3Rpb24gaW52ZXJ0TWF0cml4KE0pIHsKICAvLyBDb3BpZWQgZnJvbSBodHRwOi8vYmxvZy5hY2lwby5jb20vbWF0cml4LWludmVyc2lvbi1pbi1qYXZhc2NyaXB0LwogIC8vIFdpdGggcGVybWlzc2lvbiwgaHR0cDovL2Jsb2cuYWNpcG8uY29tL21hdHJpeC1pbnZlcnNpb24taW4tamF2YXNjcmlwdC8jY29tbWVudC01MDU3Mjg5ODg5CgogIC8vICgxKSAnYXVnbWVudCcgdGhlIG1hdHJpeCAobGVmdCkgYnkgdGhlIGlkZW50aXR5IChvbiB0aGUgcmlnaHQpCiAgLy8gKDIpIFR1cm4gdGhlIG1hdHJpeCBvbiB0aGUgbGVmdCBpbnRvIHRoZSBpZGVudGl0eSBieSBlbGVtZXRyeSByb3cgb3BzCiAgLy8gKDMpIFRoZSBtYXRyaXggb24gdGhlIHJpZ2h0IGlzIHRoZSBpbnZlcnNlICh3YXMgdGhlIGlkZW50aXR5IG1hdHJpeCkKICAvLyBUaGVyZSBhcmUgMyBlbGVtdGFyeSByb3cgb3BzOgogIC8vIChhKSBTd2FwIDIgcm93cwogIC8vIChiKSBNdWx0aXBseSBhIHJvdyBieSBhIHNjYWxhcgogIC8vIChjKSBBZGQgMiByb3dzCgogIC8vIGlmIHRoZSBtYXRyaXggaXNuJ3Qgc3F1YXJlOiBleGl0IChlcnJvcikKICBpZiAoTS5sZW5ndGggIT09IE1bMF0ubGVuZ3RoKSB7CiAgICBjb25zb2xlLndhcm4oIkNhbm5vdCBpbnZlcnQgbm9uLXNxdWFyZSBtYXRyaWNlcyIpOwogICAgcmV0dXJuOwogIH0KCiAgLy8gY3JlYXRlIHRoZSBpZGVudGl0eSBtYXRyaXggKEkpLCBhbmQgYSBjb3B5IChDKSBvZiB0aGUgb3JpZ2luYWwKICB2YXIgaSA9IDAsCiAgICBpaSA9IDAsCiAgICBqID0gMCwKICAgIGRpbSA9IE0ubGVuZ3RoLAogICAgZSA9IDAsCiAgICB0ID0gMDsKICB2YXIgSSA9IFtdLAogICAgQyA9IFtdOwogIGZvciAoaSA9IDA7IGkgPCBkaW07IGkgKz0gMSkgewogICAgLy8gQ3JlYXRlIHRoZSByb3cKICAgIElbSS5sZW5ndGhdID0gW107CiAgICBDW0MubGVuZ3RoXSA9IFtdOwogICAgZm9yIChqID0gMDsgaiA8IGRpbTsgaiArPSAxKSB7CiAgICAgIC8vaWYgd2UncmUgb24gdGhlIGRpYWdvbmFsLCBwdXQgYSAxIChmb3IgaWRlbnRpdHkpCiAgICAgIGlmIChpID09IGopIHsKICAgICAgICBJW2ldW2pdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICBJW2ldW2pdID0gMDsKICAgICAgfQoKICAgICAgLy8gQWxzbywgbWFrZSB0aGUgY29weSBvZiB0aGUgb3JpZ2luYWwKICAgICAgQ1tpXVtqXSA9IE1baV1bal07CiAgICB9CiAgfQoKICAvLyBQZXJmb3JtIGVsZW1lbnRhcnkgcm93IG9wZXJhdGlvbnMKICBmb3IgKGkgPSAwOyBpIDwgZGltOyBpICs9IDEpIHsKICAgIC8vIGdldCB0aGUgZWxlbWVudCBlIG9uIHRoZSBkaWFnb25hbAogICAgZSA9IENbaV1baV07CgogICAgLy8gaWYgd2UgaGF2ZSBhIDAgb24gdGhlIGRpYWdvbmFsICh3ZSdsbCBuZWVkIHRvIHN3YXAgd2l0aCBhIGxvd2VyIHJvdykKICAgIGlmIChlID09IDApIHsKICAgICAgLy9sb29rIHRocm91Z2ggZXZlcnkgcm93IGJlbG93IHRoZSBpJ3RoIHJvdwogICAgICBmb3IgKGlpID0gaSArIDE7IGlpIDwgZGltOyBpaSArPSAxKSB7CiAgICAgICAgLy9pZiB0aGUgaWkndGggcm93IGhhcyBhIG5vbi0wIGluIHRoZSBpJ3RoIGNvbAogICAgICAgIGlmIChDW2lpXVtpXSAhPSAwKSB7CiAgICAgICAgICAvL2l0IHdvdWxkIG1ha2UgdGhlIGRpYWdvbmFsIGhhdmUgYSBub24tMCBzbyBzd2FwIGl0CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgZGltOyBqKyspIHsKICAgICAgICAgICAgZSA9IENbaV1bal07IC8vdGVtcCBzdG9yZSBpJ3RoIHJvdwogICAgICAgICAgICBDW2ldW2pdID0gQ1tpaV1bal07IC8vcmVwbGFjZSBpJ3RoIHJvdyBieSBpaSd0aAogICAgICAgICAgICBDW2lpXVtqXSA9IGU7IC8vcmVwYWNlIGlpJ3RoIGJ5IHRlbXAKICAgICAgICAgICAgZSA9IElbaV1bal07IC8vdGVtcCBzdG9yZSBpJ3RoIHJvdwogICAgICAgICAgICBJW2ldW2pdID0gSVtpaV1bal07IC8vcmVwbGFjZSBpJ3RoIHJvdyBieSBpaSd0aAogICAgICAgICAgICBJW2lpXVtqXSA9IGU7IC8vcmVwYWNlIGlpJ3RoIGJ5IHRlbXAKICAgICAgICAgIH0KICAgICAgICAgIC8vZG9uJ3QgYm90aGVyIGNoZWNraW5nIG90aGVyIHJvd3Mgc2luY2Ugd2UndmUgc3dhcHBlZAogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vZ2V0IHRoZSBuZXcgZGlhZ29uYWwKICAgICAgZSA9IENbaV1baV07CiAgICAgIC8vaWYgaXQncyBzdGlsbCAwLCBub3QgaW52ZXJ0aWJsZSAoZXJyb3IpCiAgICAgIGlmIChlID09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KCiAgICAvLyBTY2FsZSB0aGlzIHJvdyBkb3duIGJ5IGUgKHNvIHdlIGhhdmUgYSAxIG9uIHRoZSBkaWFnb25hbCkKICAgIGZvciAoaiA9IDA7IGogPCBkaW07IGorKykgewogICAgICBDW2ldW2pdID0gQ1tpXVtqXSAvIGU7IC8vYXBwbHkgdG8gb3JpZ2luYWwgbWF0cml4CiAgICAgIElbaV1bal0gPSBJW2ldW2pdIC8gZTsgLy9hcHBseSB0byBpZGVudGl0eQogICAgfQoKICAgIC8vIFN1YnRyYWN0IHRoaXMgcm93IChzY2FsZWQgYXBwcm9wcmlhdGVseSBmb3IgZWFjaCByb3cpIGZyb20gQUxMIG9mCiAgICAvLyB0aGUgb3RoZXIgcm93cyBzbyB0aGF0IHRoZXJlIHdpbGwgYmUgMCdzIGluIHRoaXMgY29sdW1uIGluIHRoZQogICAgLy8gcm93cyBhYm92ZSBhbmQgYmVsb3cgdGhpcyBvbmUKICAgIGZvciAoaWkgPSAwOyBpaSA8IGRpbTsgaWkrKykgewogICAgICAvLyBPbmx5IGFwcGx5IHRvIG90aGVyIHJvd3MgKHdlIHdhbnQgYSAxIG9uIHRoZSBkaWFnb25hbCkKICAgICAgaWYgKGlpID09IGkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgLy8gV2Ugd2FudCB0byBjaGFuZ2UgdGhpcyBlbGVtZW50IHRvIDAKICAgICAgZSA9IENbaWldW2ldOwoKICAgICAgLy8gU3VidHJhY3QgKHRoZSByb3cgYWJvdmUob3IgYmVsb3cpIHNjYWxlZCBieSBlKSBmcm9tICh0aGUKICAgICAgLy8gY3VycmVudCByb3cpIGJ1dCBzdGFydCBhdCB0aGUgaSd0aCBjb2x1bW4gYW5kIGFzc3VtZSBhbGwgdGhlCiAgICAgIC8vIHN0dWZmIGxlZnQgb2YgZGlhZ29uYWwgaXMgMCAod2hpY2ggaXQgc2hvdWxkIGJlIGlmIHdlIG1hZGUgdGhpcwogICAgICAvLyBhbGdvcml0aG0gY29ycmVjdGx5KQogICAgICBmb3IgKGogPSAwOyBqIDwgZGltOyBqKyspIHsKICAgICAgICBDW2lpXVtqXSAtPSBlICogQ1tpXVtqXTsgLy9hcHBseSB0byBvcmlnaW5hbCBtYXRyaXgKICAgICAgICBJW2lpXVtqXSAtPSBlICogSVtpXVtqXTsgLy9hcHBseSB0byBpZGVudGl0eQogICAgICB9CiAgICB9CiAgfQoKICAvL3dlJ3ZlIGRvbmUgYWxsIG9wZXJhdGlvbnMsIEMgc2hvdWxkIGJlIHRoZSBpZGVudGl0eQogIC8vbWF0cml4IEkgc2hvdWxkIGJlIHRoZSBpbnZlcnNlOgogIHJldHVybiBJOwp9CgovKioKICogTXVsdGlwbHkgdHdvIG1hdHJpY2VzCiAqCiAqIEBwYXJhbSB7TWF0cml4fSBtMQogKiBAcGFyYW0ge01hdHJpeH0gbTIKICogQHJldHVybnMge251bWJlcltdW119IFRoZSByZXN1bHQgb2YgbTEgKiBtMiAgYXMgMkQgbnVtYmVyIGFycmF5CiAqLwpmdW5jdGlvbiBtdWx0aXBseU1hdHJpeChtMSwgbTIpIHsKICB2YXIgTSA9IFtdOwogIHZhciBtMnQgPSB0cmFuc3Bvc2VNYXRyaXgobTIpOwogIG0xLmZvckVhY2goKHJvdywgcikgPT4gewogICAgTVtyXSA9IFtdOwogICAgbTJ0LmZvckVhY2goKGNvbCwgYykgPT4gewogICAgICBNW3JdW2NdID0gcm93Lm1hcCgodiwgaSkgPT4gY29sW2ldICogdikucmVkdWNlKChhLCB2KSA9PiBhICsgdiwgMCk7CiAgICB9KTsKICB9KTsKICByZXR1cm4gTTsKfQoKLyoqCiAqIFRyYW5zcG9zZSBhIG1hdHJpeAogKgogKiBAcGFyYW0ge01hdHJpeH0gTSBUaGUgbWF0cml4IHRvIHRyYW5zcG9zZQogKiBAcmV0dXJucyB7bnVtYmVyW11bXX0gVGhlIG1hdHJpeCB0cmFuc3Bvc2UgYXMgMkQgbnVtYmVyIGFycmF5CiAqLwpmdW5jdGlvbiB0cmFuc3Bvc2VNYXRyaXgoTSkgewogIHJldHVybiBNWzBdLm1hcCgoY29sLCBpKSA9PiBNLm1hcCgocm93KSA9PiByb3dbaV0pKTsKfQovKioKICogU2V0IHVwIGEgM0QgdG8gMkQgcHJvamVjdG9yLiBUaGlzIGNhbiBiZSBlaXRoZXIgYSBgQ0FCSU5FVGAKICogb3IgYEhPTU9HRU5FT1VTYCBwcm9qZWN0b3IsIHN1cHBvcnRpbmcgdGhlIGZvbGxvd2luZyBBUEk6CiAqCiAqIC0gYHByb2plY3Rvci5zZXRSb3RhdGlvbih4LCB5LCB6KWAKICogLSBgcHJvamVjdG9yLnNldFRyYW5zbGF0aW9uKHR4LCB0eSwgdHopYAogKiAtIGBwcm9qZWN0b3Iuc2V0U2NhbGUodHgsIHR5LCB0eilgCiAqCiAqIGZ1cnRoZXJtb3JlLCB0aGUgYENBQklORVRgIHByb2plY3RvciBzdXBwb3J0cyBzZXR0aW5nIHRoZQogKiBkZWZhdWx0IGNhYmluZXQgYW5nbGUgdXNpbmc6CiAqCiAqIC0gYHByb2plY3Rvci5zZXRQaGkocGhpKWAKICoKICogYW5kIHRoZSBgSE9NT0dFTkVPVVNgIHByb2plY3Rpb24gc3VwcG9ydHMgc2V0dGluZyB0aGUgZGlzdGFuY2UKICogb2YgdGhlIHBvaW50LWF0LWluZmluaXR5IGJ5IHVzaW5nOgogKgogKiAtIGBwcm9qZWN0b3Iuc2V0SW5maW5pdHkoZGlzdGFuY2UpYCAobm90ZSwgYGRpc3RhbmNlYCBjYW4gYmUgYEluZmluaXR5YCkKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IGNhYmluZXQgPSBjcmVhdGVQcm9qZWN0b3IoQ0FCSU5FVCk7CiAqICAgICBjb25zdCBob21vZ2VuZW91cyA9IGNyZWF0ZVByb2plY3RvcihIT01PR0VORU9VUyk7CiAqICAgICBjb25zdCBib3R0b20gPSBbCiAqICAgICAgIFstMSwgLTEsIC0xXSwKICogICAgICAgWyAxLCAtMSwgLTFdLAogKiAgICAgICBbIDEsICAxLCAtMV0sCiAqICAgICAgIFstMSwgIDEsIC0xXSwKICogICAgIF07CiAqICAgICBjb25zdCB0b3AgPSBib3R0b20ubWFwKHYgPT4gW3ZbMF0sIHZbMV0sIDFdKTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDQwMCwgMjAwKTsKICogICAgICAgY2FiaW5ldC5zZXRTY2FsZSg1MCk7CiAqICAgICAgIGhvbW9nZW5lb3VzLnNldFNjYWxlKDUwKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUoLXdpZHRoLzQsIGhlaWdodC8yKTsKICogICAgICAgW2NhYmluZXQsIGhvbW9nZW5lb3VzXS5mb3JFYWNoKHByb2plY3RvciA9PiB7CiAqICAgICAgICAgc2V0UHJvamVjdG9yKHByb2plY3Rvcik7CiAqICAgICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIDApOwogKiAgICAgICAgIGRyYXdBeGlzUG9pbnRzKCk7CiAqICAgICAgICAgZHJhd0N1YmUoKTsKICogICAgICAgfSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3QXhpc1BvaW50cygpIHsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBvaW50KC4uLmJvdHRvbVswXSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgcG9pbnQoLi4uYm90dG9tWzFdKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIHBvaW50KC4uLmJvdHRvbVszXSk7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIHBvaW50KC4uLnRvcFswXSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3Q3ViZSgpIHsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHNldFN0cm9rZShgcmVkYCk7CiAqICAgICAgIFtib3R0b20sIHRvcF0uZm9yRWFjaChyID0+IHsKICogICAgICAgICBsaW5lKC4uLnJbMF0sIC4uLnJbMV0pOwogKiAgICAgICAgIGxpbmUoLi4uclsyXSwgLi4uclszXSk7CiAqICAgICAgIH0pOwogKiAgICAgICBzZXRTdHJva2UoYGdyZWVuYCk7CiAqICAgICAgIFtib3R0b20sIHRvcF0uZm9yRWFjaChyID0+IHsKICogICAgICAgICBsaW5lKC4uLnJbMV0sIC4uLnJbMl0pOwogKiAgICAgICAgIGxpbmUoLi4uclszXSwgLi4uclswXSk7CiAqICAgICAgIH0pOwogKiAgICAgICBzZXRTdHJva2UoYGJsdWVgKTsKICogICAgICAgWzAsMSwyLDNdLmZvckVhY2goaSA9PiBsaW5lKC4uLmJvdHRvbVtpXSwgLi4udG9wW2ldKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtpbXBsaWVkfSBmYWxzZXkgd2hlbiBjYWxsZWQgd2l0aCBhIGZhbHNleSBhcmd1bWVudCAob3Igbm8gYXJndW1lbnQpLCBkaXNhYmxlcyBwcm9qZWN0b3IgcmVsYXRlZCBmdW5jdGlvbmFsaXR5LgogKiBAcmV0dXJucyB7ZmFsc2V9IGZhbHNlLgogKgogKiBAcGFyYW0ge1N5bWJvbH0gcHJvamVjdG9yVHlwZSBUaGlzIHNldHMgdXAgYSBuZXcgcHJvamVjdG9yLCBvZiB0eXBlIHtAbGluayBDQUJJTkVUfSBvciB7QGxpbmsgSE9NT0dFTk9VU30uCiAqIEBwYXJhbSB7Ym9vbGVhbn0gcHJvamVjdCBPcHRpb25hbC4gV2hlbiB0cnVlLCBpbW1lZGlhdGVseSBlbmFibGUgY29vcmRpbmF0ZSBwcm9qZWN0aW9uLiBEZWZhdWx0OiB0cnVlCiAqIEByZXR1cm5zIHtQcm9qZWN0b3J9IFRoZSBjdXJyZW50IHByb2plY3Rvci4KICoKICogQHBhcmFtIHtQcm9qZWN0b3J9IHByb2plY3RvciBUaGlzIHNldHMgdGhlIHByb2plY3RvciB0byB0aGUgb25lIHBhc3NlZCBhcyBhcmd1bWVudC4KICogQHBhcmFtIHtib29sZWFufSBwcm9qZWN0IE9wdGlvbmFsLiBXaGVuIHRydWUsIGltbWVkaWF0ZWx5IGVuYWJsZSBjb29yZGluYXRlIHByb2plY3Rpb24uIERlZmF1bHQ6IHRydWUKICogQHJldHVybnMge1Byb2plY3Rvcn0gVGhlIGN1cnJlbnQgcHJvamVjdG9yLgogKgogKiBAc2VlIHtAbGluayBjcmVhdGVQcm9qZWN0b3J9CiAqIEBzZWUge0BsaW5rIHVzZVByb2plY3Rpb259CiAqIEBzZWUge0BsaW5rIG5vUHJvamVjdGlvbn0KICogQHNlZSB7QGxpbmsgbm9Qcm9qZWN0b3J9CiAqIEBzZWUge0BsaW5rIHByb2plY3R9CiAqLwpmdW5jdGlvbiBzZXRQcm9qZWN0b3IodHlwZU9yUHJvamVjdG9yID0gZmFsc2UsIHByb2plY3QgPSB0cnVlKSB7CiAgaWYgKCF0eXBlT3JQcm9qZWN0b3IpIHsKICAgIG5vUHJvamVjdGlvbigpOwogICAgcmV0dXJuIChfX3Byb2plY3RvciA9IGZhbHNlKTsKICB9IGVsc2UgaWYgKHR5cGVPclByb2plY3RvciBpbnN0YW5jZW9mIFByb2plY3RvcikgewogICAgX19wcm9qZWN0b3IgPSB0eXBlT3JQcm9qZWN0b3I7CiAgfSBlbHNlIGlmICh0eXBlT3JQcm9qZWN0b3IgPT09IENBQklORVQpIHsKICAgIF9fcHJvamVjdG9yID0gbmV3IENhYmluZXRQcm9qZWN0b3IoKTsKICB9IGVsc2UgaWYgKHR5cGVPclByb2plY3RvciA9PT0gSE9NT0dFTkVPVVMpIHsKICAgIF9fcHJvamVjdG9yID0gbmV3IEhvbW9nZW5lb3VzUHJvamVjdG9yKDI1MCk7CiAgfQogIGlmIChwcm9qZWN0KSB1c2VQcm9qZWN0aW9uKCk7CiAgcmV0dXJuIF9fcHJvamVjdG9yOwp9CgovKioKICogQ3JlYXRlIGEgM0QgdG8gMkQgcHJvamVjdG9yLiBUaGlzIGNhbiBiZSBlaXRoZXIgYSBgQ0FCSU5FVGAKICogb3IgYEhPTU9HRU5FT1VTYCBwcm9qZWN0b3IsIHN1cHBvcnRpbmcgdGhlIGZvbGxvd2luZyBBUEk6CiAqCiAqIC0gYHByb2plY3Rvci5zZXRSb3RhdGlvbih4LCB5LCB6KWAKICogLSBgcHJvamVjdG9yLnNldFRyYW5zbGF0aW9uKHR4LCB0eSwgdHopYAogKiAtIGBwcm9qZWN0b3Iuc2V0U2NhbGUodHgsIHR5LCB0eilgCiAqCiAqIGZ1cnRoZXJtb3JlLCB0aGUgYENBQklORVRgIHByb2plY3RvciBzdXBwb3J0cyBzZXR0aW5nIHRoZQogKiBkZWZhdWx0IGNhYmluZXQgYW5nbGUgdXNpbmc6CiAqCiAqIC0gYHByb2plY3Rvci5zZXRQaGkocGhpKWAKICoKICogYW5kIHRoZSBgSE9NT0dFTkVPVVNgIHByb2plY3Rpb24gc3VwcG9ydHMgc2V0dGluZyB0aGUgZGlzdGFuY2UKICogb2YgdGhlIHBvaW50LWF0LWluZmluaXR5IGJ5IHVzaW5nOgogKgogKiAtIGBwcm9qZWN0b3Iuc2V0SW5maW5pdHkoZGlzdGFuY2UpYCAobm90ZSwgYGRpc3RhbmNlYCBjYW4gYmUgYEluZmluaXR5YCkKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IGNhYmluZXQgPSBjcmVhdGVQcm9qZWN0b3IoQ0FCSU5FVCk7CiAqICAgICBjb25zdCBob21vZ2VuZW91cyA9IGNyZWF0ZVByb2plY3RvcihIT01PR0VORU9VUyk7CiAqICAgICBjb25zdCBib3R0b20gPSBbCiAqICAgICAgIFstMSwgLTEsIC0xXSwKICogICAgICAgWyAxLCAtMSwgLTFdLAogKiAgICAgICBbIDEsICAxLCAtMV0sCiAqICAgICAgIFstMSwgIDEsIC0xXSwKICogICAgIF07CiAqICAgICBjb25zdCB0b3AgPSBib3R0b20ubWFwKHYgPT4gW3ZbMF0sIHZbMV0sIDFdKTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDQwMCwgMjAwKTsKICogICAgICAgY2FiaW5ldC5zZXRTY2FsZSg1MCk7CiAqICAgICAgIGhvbW9nZW5lb3VzLnNldFNjYWxlKDUwKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUoLXdpZHRoLzQsIGhlaWdodC8yKTsKICogICAgICAgW2NhYmluZXQsIGhvbW9nZW5lb3VzXS5mb3JFYWNoKHByb2plY3RvciA9PiB7CiAqICAgICAgICAgc2V0UHJvamVjdG9yKHByb2plY3Rvcik7CiAqICAgICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIDApOwogKiAgICAgICAgIGRyYXdBeGlzUG9pbnRzKCk7CiAqICAgICAgICAgZHJhd0N1YmUoKTsKICogICAgICAgfSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3QXhpc1BvaW50cygpIHsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBvaW50KC4uLmJvdHRvbVswXSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgcG9pbnQoLi4uYm90dG9tWzFdKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIHBvaW50KC4uLmJvdHRvbVszXSk7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIHBvaW50KC4uLnRvcFswXSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3Q3ViZSgpIHsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHNldFN0cm9rZShgcmVkYCk7CiAqICAgICAgIFtib3R0b20sIHRvcF0uZm9yRWFjaChyID0+IHsKICogICAgICAgICBsaW5lKC4uLnJbMF0sIC4uLnJbMV0pOwogKiAgICAgICAgIGxpbmUoLi4uclsyXSwgLi4uclszXSk7CiAqICAgICAgIH0pOwogKiAgICAgICBzZXRTdHJva2UoYGdyZWVuYCk7CiAqICAgICAgIFtib3R0b20sIHRvcF0uZm9yRWFjaChyID0+IHsKICogICAgICAgICBsaW5lKC4uLnJbMV0sIC4uLnJbMl0pOwogKiAgICAgICAgIGxpbmUoLi4uclszXSwgLi4uclswXSk7CiAqICAgICAgIH0pOwogKiAgICAgICBzZXRTdHJva2UoYGJsdWVgKTsKICogICAgICAgWzAsMSwyLDNdLmZvckVhY2goaSA9PiBsaW5lKC4uLmJvdHRvbVtpXSwgLi4udG9wW2ldKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtTeW1ib2x9IHByb2plY3RvclR5cGUgVGhpcyBzZXRzIHVwIGEgbmV3IHByb2plY3Rvciwgb2YgdHlwZSB7QGxpbmsgQ0FCSU5FVH0gb3Ige0BsaW5rIEhPTU9HRU5PVVN9LgogKiBAcmV0dXJucyB7UHJvamVjdG9yfSBBIG5ldyBwcm9qZWN0b3IgaW5zdGFuY2UuCiAqCiAqIEBzZWUge0BsaW5rIHNldFByb2plY3Rvcn0KICogQHNlZSB7QGxpbmsgdXNlUHJvamVjdGlvbn0KICogQHNlZSB7QGxpbmsgbm9Qcm9qZWN0aW9ufQogKiBAc2VlIHtAbGluayBub1Byb2plY3Rvcn0KICogQHNlZSB7QGxpbmsgcHJvamVjdH0KICovCmZ1bmN0aW9uIGNyZWF0ZVByb2plY3Rvcih0eXBlKSB7CiAgaWYgKHR5cGUgPT09IENBQklORVQpIHsKICAgIHJldHVybiBuZXcgQ2FiaW5ldFByb2plY3RvcigpOwogIH0KICBpZiAodHlwZSA9PT0gSE9NT0dFTkVPVVMpIHsKICAgIHJldHVybiBuZXcgSG9tb2dlbmVvdXNQcm9qZWN0b3IoMjUwKTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KCi8qKgogKiBVbnNldCB0aGUgM0QgcHJvamVjdG9yLCBpZiBvbmUgaXMgY3VycmVudGx5IGFjdGl2ZS4gVGhpcyBpcwogKiBlcXVpdmFsZW50IHRvIGNhbGxpbmcgYHNldFByb2plY3RvcihmYWxzZSlgLCBhbmQgd2lsbCB0dXJuCiAqIG9mZiBwcm9qZWN0aW9uICoqYW5kKiogdW5iaW5kIHRoZSBjdXJyZW50IHByb2plY3Rvci4gVGhpcwogKiBjYW4gYmUgdXNlZnVsLCBidXQgbW9zdCBvZiB0aGUgdGltZSB5b3UnbGwgd2FudCB0byB1c2UgdGhlCiAqIHtAbGluayB1c2VQcm9qZWN0aW9ufSBhbmQge0BsaW5rIG5vUHJvamVjdGlvbn0gZnVuY3Rpb25zIGluc3RlYWQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwbGFuZSA9IFsKICogICAgICAgWy0xLCAtMSwgLTFdLAogKiAgICAgICBbIDEsIC0xLCAtMV0sCiAqICAgICAgIFsgMSwgIDEsIC0xXSwKICogICAgICAgWy0xLCAgMSwgLTFdLAogKiAgICAgXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKEhPTU9HRU5FT1VTKTsKICogICAgICAgc2NhbGVQcm9qZWN0b3IoNTApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGNlbnRlcigpOwogKiAgICAgICBzZXRTdHJva2UoYCMzMzNgKTsKICogICAgICAgc2V0RmlsbChgI0ZGMDVgKTsKICogICAgICAgcG9seShwbGFuZSk7CiAqICAgICAgIG5vUHJvamVjdG9yKCk7CiAqICAgICAgIHNldEZpbGwoYCNGMEY1YCk7CiAqICAgICAgIHBvbHkocGxhbmUubWFwKHYgPT4gKFs1MCAqIHZbMF0sIDUwICogdlsxXV0pKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2V0UHJvamVjdG9yfQogKi8KZnVuY3Rpb24gbm9Qcm9qZWN0b3IoKSB7CiAgc2V0UHJvamVjdG9yKGZhbHNlKTsKfQoKLyoqCiAqIEVuYWJsZSBhIGN1cnJlbnRseSBkaXNhYmxlZCAzRCBwcm9qZWN0b3IsIGFsbG93aW5nICB5b3UgdG8KICogbWl4IHByb2plY3RpdmUgM0QgYW5kIHJlZ3VsYXIgMkQgd2l0aCByZWxhdGl2ZWx5IGxpdHRsZSBlZmZvcnQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwbGFuZSA9IFsKICogICAgICAgWy0xLCAtMSwgLTFdLAogKiAgICAgICBbIDEsIC0xLCAtMV0sCiAqICAgICAgIFsgMSwgIDEsIC0xXSwKICogICAgICAgWy0xLCAgMSwgLTFdLAogKiAgICAgXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKEhPTU9HRU5FT1VTKTsKICogICAgICAgc2NhbGVQcm9qZWN0b3IoNTApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGNlbnRlcigpOwogKgogKiAgICAgICBub1Byb2plY3Rpb24oKTsKICogICAgICAgc2V0RmlsbChgI0YwRjVgKTsKICogICAgICAgcG9seShwbGFuZS5tYXAodiA9PiAoWzUwICogdlswXSwgNTAgKiB2WzFdXSkpKTsKICoKICogICAgICAgdXNlUHJvamVjdGlvbigpOwogKiAgICAgICBzZXRTdHJva2UoYCMzMzNgKTsKICogICAgICAgc2V0RmlsbChgI0ZGMDVgKTsKICogICAgICAgcG9seShwbGFuZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgbm9Qcm9qZWN0aW9ufQogKi8KZnVuY3Rpb24gdXNlUHJvamVjdGlvbigpIHsKICBfX3VzZV9wcm9qZWN0aW9uID0gdHJ1ZTsKfQoKLyoqCiAqIChUZW1wb3JhcmlseSkgZGlzYWJsZSB0aGUgM0QgcHJvamVjdG9yIHdpdGhvdXQgdW5iaW5kaW5nIGl0LAogKiBhbGxvd2luZyAgeW91IHRvIG1peCBwcm9qZWN0aXZlIDNEIGFuZCByZWd1bGFyIDJEIHdpdGggcmVsYXRpdmVseQogKiBsaXR0bGUgZWZmb3J0LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcGxhbmUgPSBbCiAqICAgICAgIFstMSwgLTEsIC0xXSwKICogICAgICAgWyAxLCAtMSwgLTFdLAogKiAgICAgICBbIDEsICAxLCAtMV0sCiAqICAgICAgIFstMSwgIDEsIC0xXSwKICogICAgIF07CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldFByb2plY3RvcihIT01PR0VORU9VUyk7CiAqICAgICAgIHNjYWxlUHJvamVjdG9yKDUwKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBjZW50ZXIoKTsKICoKICogICAgICAgbm9Qcm9qZWN0aW9uKCk7CiAqICAgICAgIHNldEZpbGwoYCNGMEY1YCk7CiAqICAgICAgIHBvbHkocGxhbmUubWFwKHYgPT4gKFs1MCAqIHZbMF0sIDUwICogdlsxXV0pKSk7CiAqCiAqICAgICAgIHVzZVByb2plY3Rpb24oKTsKICogICAgICAgc2V0U3Ryb2tlKGAjMzMzYCk7CiAqICAgICAgIHNldEZpbGwoYCNGRjA1YCk7CiAqICAgICAgIHBvbHkocGxhbmUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHVzZVByb2plY3Rpb259CiAqLwpmdW5jdGlvbiBub1Byb2plY3Rpb24oKSB7CiAgX191c2VfcHJvamVjdGlvbiA9IGZhbHNlOwp9CgovKioKICogUHJvamVjdCBhIDNEICJ3b3JsZCIgY29vcmRpbmF0ZSB0byBhIDJEICJzY3JlZW4iIGNvb3JkaW5hdGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwbGFuZSA9IFsKICogICAgICAgWy0xLCAtMSwgLTFdLAogKiAgICAgICBbIDEsIC0xLCAtMV0sCiAqICAgICAgIFsgMSwgIDEsIC0xXSwKICogICAgICAgWy0xLCAgMSwgLTFdLAogKiAgICAgXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKEhPTU9HRU5FT1VTKQogKiAgICAgICBzY2FsZVByb2plY3Rvcig1MCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC80KTsKICogICAgICAgc2V0Q29sb3IoYG9yYW5nZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIC8vIE5vdGUgdGhhdCB0aGlzIGlzIG5vdCAidXNlZnVsIiBjb2RlLCBhcyB5b3Ugd2lsbAogKiAgICAgICAvLyByYXJlbHksIGlmIGV2ZXIsIG5lZWQgdG8gbWFudWFsbHkgcHJvamVjdCBjb29yZGluYXRlLgogKiAgICAgICAvLyBJbiB0aGlzIGNhc2UsIHlvdSBjb3VsZCBqdXN0IGNhbGwgYHBvbHkocGxhbmUpYCBpbnN0ZWFkLgogKiAgICAgICBzdGFydCgpOwogKiAgICAgICBwbGFuZS5mb3JFYWNoKHAgPT4gdmVydGV4KHByb2plY3QoLi4ucCkpKTsKICogICAgICAgdmVydGV4KHByb2plY3QoLi4ucGxhbmVbMF0pKTsKICogICAgICAgZW5kKCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIDNEIGNvb3JkaW5hdGUncyB4IHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSAzRCBjb29yZGluYXRlJ3MgeCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geiBUaGUgM0QgY29vcmRpbmF0ZSdzIHggdmFsdWUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCAgVGhlIHByb2plY3RlZCAyRCB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSAyRCBjb29yZGluYXRlIGFzIHt4LHksen0gY29vcmRpbmF0ZQogKiBAcmV0dXJucyB7UG9pbnRMaWtlfSBwICBUaGUgcHJvamVjdGVkIDJEIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgc2V0UHJvamVjdG9yfQogKi8KZnVuY3Rpb24gcHJvamVjdCh4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkICYmIHgueiAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIHJldHVybiBfX3Byb2plY3Rvci5wcm9qZWN0KHgsIHksIHopOwp9CgovKioKICogU2V0IHRoZSBwcm9qZWN0b3IncyB4LCB5LCBhbmQgeiBheGVzIG9mIHJvdGF0aW9uIGluIHJhZGlhbnMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBjYWJpbmV0ID0gc2V0UHJvamVjdG9yKENBQklORVQpOwogKiAgICAgY29uc3QgaG9tb2dlbmVvdXMgPSBzZXRQcm9qZWN0b3IoSE9NT0dFTkVPVVMpOwogKiAgICAgY29uc3QgYm90dG9tID0gWwogKiAgICAgICBbLTEsIC0xLCAtMV0sCiAqICAgICAgIFsgMSwgLTEsIC0xXSwKICogICAgICAgWyAxLCAgMSwgLTFdLAogKiAgICAgICBbLTEsICAxLCAtMV0sCiAqICAgICBdOwogKiAgICAgY29uc3QgdG9wID0gYm90dG9tLm1hcCh2ID0+IFt2WzBdLCB2WzFdLCAxXSk7CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSg0MDAsIDIwMCk7CiAqICAgICAgIGNhYmluZXQuc2V0U2NhbGUoNTApOwogKiAgICAgICBob21vZ2VuZW91cy5zZXRTY2FsZSg1MCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUoLXdpZHRoLzQsIGhlaWdodC8yKTsKICogICAgICAgY29uc3QgbSA9IG1pbGxpcygpIC8gNTAwMDsKICogICAgICAgW2NhYmluZXQsIGhvbW9nZW5lb3VzXS5mb3JFYWNoKHByb2plY3RvciA9PiB7CiAqICAgICAgICAgc2V0UHJvamVjdG9yKHByb2plY3Rvcik7CiAqICAgICAgICAgcHJvamVjdG9yLnNldFJvdGF0aW9uKG0sIDIgKiBtLCAzICogbSk7CiAqICAgICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIDApOwogKiAgICAgICAgIGRyYXdBeGlzUG9pbnRzKCk7CiAqICAgICAgICAgZHJhd0N1YmUoKTsKICogICAgICAgfSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3QXhpc1BvaW50cygpIHsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBvaW50KC4uLmJvdHRvbVswXSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgcG9pbnQoLi4uYm90dG9tWzFdKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIHBvaW50KC4uLmJvdHRvbVszXSk7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIHBvaW50KC4uLnRvcFswXSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3Q3ViZSgpIHsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHNldFN0cm9rZShgcmVkYCk7CiAqICAgICAgIFtib3R0b20sIHRvcF0uZm9yRWFjaChyID0+IHsKICogICAgICAgICBsaW5lKC4uLnJbMF0sIC4uLnJbMV0pOwogKiAgICAgICAgIGxpbmUoLi4uclsyXSwgLi4uclszXSk7CiAqICAgICAgIH0pOwogKiAgICAgICBzZXRTdHJva2UoYGdyZWVuYCk7CiAqICAgICAgIFtib3R0b20sIHRvcF0uZm9yRWFjaChyID0+IHsKICogICAgICAgICBsaW5lKC4uLnJbMV0sIC4uLnJbMl0pOwogKiAgICAgICAgIGxpbmUoLi4uclszXSwgLi4uclswXSk7CiAqICAgICAgIH0pOwogKiAgICAgICBzZXRTdHJva2UoYGJsdWVgKTsKICogICAgICAgWzAsMSwyLDNdLmZvckVhY2goaSA9PiBsaW5lKC4uLmJvdHRvbVtpXSwgLi4udG9wW2ldKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGFuZ2xlIG9mIHJvdGF0aW9uIG92ZXIgdGhlIHggYXhpcyBpbiByYWRpYW5zCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBhbmdsZSBvZiByb3RhdGlvbiBvdmVyIHRoZSB5IGF4aXMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0geiBUaGUgYW5nbGUgb2Ygcm90YXRpb24gb3ZlciB0aGUgeiBheGlzIGluIHJhZGlhbnMKICovCmZ1bmN0aW9uIHJvdGF0ZVByb2plY3Rvcih4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkICYmIHgueiAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIF9fcHJvamVjdG9yPy5zZXRSb3RhdGlvbih4LCB5LCB6KTsKfQoKLyoqCiAqIFNldCB0aGUgcHJvamVjdG9yJ3MgeCwgeSwgYW5kIHogY29vcmRpbmF0ZSBvZmZzZXRzLiBOb3RlIHRoYXQKICogdGhpcyB2YWx1ZSBkb2VzICpub3QqIHJlc2V0IGFjcm9zcyBzdWNjZXNzaXZlIGRyYXcgY2FsbHMuIFRvCiAqIHJlc2V0IHRoZSB0cmFuc2xhdGlvbiwgeW91IG11c3QgaXNzdWUgYHRyYW5zbGF0ZVByb2plY3RvcigwLDAsMClgLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcGxhbmUxID0gWwogKiAgICAgICBbLTEsIC0xLCAtMV0sCiAqICAgICAgIFsgMSwgLTEsIC0xXSwKICogICAgICAgWyAxLCAgMSwgLTFdLAogKiAgICAgICBbLTEsICAxLCAtMV0sCiAqICAgICBdOwogKiAgICAgY29uc3QgcGxhbmUyID0gWwogKiAgICAgICBbLTEsIC0xLCAxXSwKICogICAgICAgWyAxLCAtMSwgMV0sCiAqICAgICAgIFsgMSwgIDEsIDFdLAogKiAgICAgICBbLTEsICAxLCAxXSwKICogICAgIF07CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldFByb2plY3RvcihIT01PR0VORU9VUyk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBjZW50ZXIoKTsKICogICAgICAgc2NhbGVQcm9qZWN0b3IoMjUgKyAyMCAqIHNpbihmcmFtZS81MDApLCAyNSArIDIwICogc2luKGZyYW1lLzUwMCksIDUwICogc2luKGZyYW1lLzIwMCkpOwogKiAgICAgICBzZXRDb2xvcihgb3JhbmdlYCk7CiAqICAgICAgIHBvbHkocGxhbmUxKQogKiAgICAgICBzZXRDb2xvcihgcHVycGxlYCk7CiAqICAgICAgIHBvbHkocGxhbmUyKQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBzIFRoZSBzY2FsZSBmYWN0b3IgZm9yIGFsbCB0aHJlZSBheGVzCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBzY2FsZSBmYWN0b3IgZm9yIHRoZSB4IGF4aXMKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHNjYWxlIGZhY3RvciBmb3IgdGhlIHkgYXhpcwogKiBAcGFyYW0ge251bWJlcn0geiBUaGUgc2NhbGUgZmFjdG9yIGZvciB0aGUgeiBheGlzCiAqLwpmdW5jdGlvbiBzY2FsZVByb2plY3Rvcih4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkICYmIHgueiAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIF9fcHJvamVjdG9yPy5zZXRTY2FsZSh4LCB5LCB6KTsKfQoKLyoqCiAqIFNldCB0aGUgcHJvamVjdG9yJ3MgeCwgeSwgYW5kIHogY29vcmRpbmF0ZSBvZmZzZXRzLiBOb3RlIHRoYXQKICogdGhpcyB2YWx1ZSBkb2VzICpub3QqIHJlc2V0IGFjcm9zcyBzdWNjZXNzaXZlIGRyYXcgY2FsbHMuIFRvCiAqIHJlc2V0IHRoZSB0cmFuc2xhdGlvbiwgeW91IG11c3QgaXNzdWUgYHRyYW5zbGF0ZVByb2plY3RvcigwLDAsMClgLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcGxhbmUgPSBbCiAqICAgICAgIFstMSwgLTEsIDBdLAogKiAgICAgICBbIDEsIC0xLCAwXSwKICogICAgICAgWyAxLCAgMSwgMF0sCiAqICAgICAgIFstMSwgIDEsIDBdLAogKiAgICAgXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgY29uc3QgcCA9IHNldFByb2plY3RvcihIT01PR0VORU9VUyk7CiAqICAgICAgIHAuc2V0U2NhbGUoNTApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgY2VudGVyKCk7CiAqICAgICAgIHNldENvbG9yKGBvcmFuZ2VgKTsKICogICAgICAgdHJhbnNsYXRlUHJvamVjdG9yKDAsIDAsIHNpbihmcmFtZS8xMDApKTsKICogICAgICAgcG9seShwbGFuZSkKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgb2Zmc2V0IGFsb25nIHRoZSB4IGF4aXMKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIG9mZnNldCBhbG9uZyB0aGUgeSBheGlzCiAqIEBwYXJhbSB7bnVtYmVyfSB6IFRoZSBvZmZzZXQgYWxvbmcgdGhlIHogYXhpcwogKi8KZnVuY3Rpb24gdHJhbnNsYXRlUHJvamVjdG9yKHgsIHksIHopIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQgJiYgeC56ICE9PSB1bmRlZmluZWQpIHsKICAgIHogPSB4Lno7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgX19wcm9qZWN0b3I/LnNldFRyYW5zbGF0aW9uKHgsIHksIHopOwp9Ci8qKgogKiBTZXQgYSBib3JkZXIgYXJvdW5kIHRoZSBjYW52YXMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEJvcmRlcigxMCwgYHJlZGApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfGJvb2xlYW59IHdpZHRoPyBUaGUgd2lkdGggb2YgdGhlIGJvcmRlciBpbiBwaXhlbHMsIGRpc2FibGluZyB0aGUgYm9yZGVyIG9taXR0ZWQKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yPyBUaGUgQ1NTIGNvbG9yIHRvIHVzZSBmb3IgdGhlIGJvcmRlciAoZGVmYXVsdCA9IGJsYWNrKQogKgogKiBAc2VlIHtAbGluayBub0JvcmRlcn0KICovCmZ1bmN0aW9uIHNldEJvcmRlcih3aWR0aCA9IDEsIGNvbG9yID0gYGJsYWNrYCkgewogIGlmICghd2lkdGgpIHsKICAgIF9fY2FudmFzLnN0eWxlLmJvcmRlciA9IGBub25lYDsKICB9IGVsc2UgewogICAgX19jYW52YXMuc3R5bGUuYm9yZGVyID0gYCR7d2lkdGh9cHggc29saWQgJHtjb2xvcn1gOwogIH0KfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBzdHJva2UgYW5kIGZpbGwgY29sb3VyIGF0CiAqIHRoZSBzYW1lIHRpbWUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICByZWN0KDUwLCA1MCwgMTAwLCAxMDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvciBUaGUgQ1NTIGNvbG9yIHRvIHVzZSBmb3IgdGhlIGJvcmRlcgogKgogKiBAc2VlIHtAbGluayBzZXRTdHJva2V9CiAqIEBzZWUge0BsaW5rIHNldEZpbGx9CiAqIEBzZWUge0BsaW5rIG5vQ29sb3J9CiAqLwpmdW5jdGlvbiBzZXRDb2xvcihjb2xvcikgewogIHNldEZpbGwoY29sb3IpOwogIHNldFN0cm9rZShjb2xvcik7Cn0KCi8qKgogKiBDaGFuZ2UgdGhlIGN1cnNvciB0byBhIHNwZWNpZmljIGljb246CiAqCiAqIC0gQVVUTyAtIHVzZSB3aGF0ZXZlciB0aGUgYnJvd3NlciB3b3VsZCBvdGhlcndpc2UgdXNlCiAqIC0gQ1JPU1MgLSB1c2UgYSBjcm9zcy1oYWlyIGljb24KICogLSBQT0lOVEVSIC0gdXNlIHRoZSAicG9pbnRlciIgaWNvbiB0aGF0IGlzIGFsc28gdXNlZCBmb3IgY2xpY2thYmxlIGxpbmtzCiAqCiAqIFVzZSBhbnkgb3RoZXIgc3RyaW5nIGZvdW5kIG92ZXIgb24gdGhlIE1ETiBjdXJzb3IgYXJ0aWNsZSB0byBzZXQgYSBjdXJzb3Igbm90IGNvdmVyZWQgYnkgdGhlIGFib3ZlIGNvbnN0YW50cy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgI0ZGMDJgKTsKICogICAgICAgcmVjdCgwLCAwLCB3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgICBzZXRDb2xvcihgIzBGRjJgKTsKICogICAgICAgcmVjdCh3aWR0aC8yLCAwLCB3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlck1vdmUoeCwgeSkgewogKiAgICAgICBpZiAoeCA8IHdpZHRoLzIpIHsKICogICAgICAgICBzZXRDdXJzb3IoQVVUTyk7CiAqICAgICAgIH0gZWxzZSB7CiAqICAgICAgICAgbm9DdXJzb3IoKTsKICogICAgICAgfQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIFRoZSBDU1MgY3Vyc29yIHR5cGUKICoKICogQHNlZSB7QGxpbmsgbm9DdXJzb3J9CiAqLwpmdW5jdGlvbiBzZXRDdXJzb3IodHlwZSkgewogIF9fY3VycmVudF9jdXJzb3IgPSB0eXBlOwogIF9fY2FudmFzLnN0eWxlLmN1cnNvciA9IF9fY3VycmVudF9jdXJzb3I7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgZmlsbCBjb2xvdXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYHJlZGApOwogKiAgICAgICByZWN0KDUwLCA1MCwgMTAwLCAxMDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvciBUaGUgQ1NTIGNvbG9yIHRvIHVzZSBmb3IgdGhlIGJvcmRlciAoZGVmYXVsdCA9IGJsYWNrKQogKgogKiBAc2VlIHtAbGluayBub0ZpbGx9CiAqLwpmdW5jdGlvbiBzZXRGaWxsKGNvbG9yID0gYGJsYWNrYCkgewogIGlmIChDU1NfQ09MT1JfTUFQW2NvbG9yXSA9PT0gX19oaWdobGlnaHRfY29sb3IpIHsKICAgIGNvbG9yID0gX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvcjsKICB9CiAgX19jdHguZmlsbFN0eWxlID0gY29sb3I7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgZm9udCB1c2luZyBhIHNpbmdsZSBzdHJpbmcuIEZvciB0aGUgc3ludGF4LAogKiBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL2ZvbnQKICoKICogQHBhcmFtIHtzdHJpbmd9IGZvbnQgQSBDU1Mgc2hvcnRoYW5kIGZvbnQgcHJvcGVydHkKICoKICogQHNlZSB7QGxpbmsgc2V0Rm9udEZhbWlseX0KICogQHNlZSB7QGxpbmsgc2V0Rm9udFNpemV9CiAqIEBzZWUge0BsaW5rIHNldEZvbnRXZWlnaHR9CiAqLwpmdW5jdGlvbiBzZXRGb250KGZvbnQpIHsKICBfX2N0eC5mb250ID0gZm9udCB8fCBgJHtfX2ZvbnQud2VpZ2h0fSAke19fZm9udC5zaXplfXB4ICR7X19mb250LmZhbWlseX1gOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZvbnQgZmFtaWx5LgogKgogKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBUaGUgQ1NTIGZvbnQgZmFtaWx5IG5hbWUKICoKICogQHNlZSB7QGxpbmsgc2V0Rm9udFNpemV9CiAqIEBzZWUge0BsaW5rIHNldEZvbnRXZWlnaHR9CiAqLwpmdW5jdGlvbiBzZXRGb250RmFtaWx5KG5hbWUpIHsKICBfX2ZvbnQuZmFtaWx5ID0gbmFtZTsKICBzZXRGb250KCk7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgZm9udCBzaXplCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBweCBUaGUgZm9udCBzaXplIGluIHBpeGVscwogKgogKiBAc2VlIHtAbGluayBzZXRGb250RmFtaWx5fQogKiBAc2VlIHtAbGluayBzZXRGb250V2VpZ2h0fQogKi8KZnVuY3Rpb24gc2V0Rm9udFNpemUocHgpIHsKICBfX2ZvbnQuc2l6ZSA9IHB4OwogIHNldEZvbnQoKTsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBmb250IHdlaWdodAogKgogKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IHZhbCBUaGUgQ1NTIHdlaWdodCBudW1iZXIgb3Igb25lIG9mIHRoZSBzcGVjaWFsIHN0cmluZ3MgIm5vcm1hbCIsICJib2xkIiwgImJvbGRlciIsIG9yICJsaWdodGVyIi4KICoKICogQHNlZSB7QGxpbmsgc2V0Rm9udEZhbWlseX0KICogQHNlZSB7QGxpbmsgc2V0Rm9udFNpemV9CiAqLwpmdW5jdGlvbiBzZXRGb250V2VpZ2h0KHZhbCkgewogIF9fZm9udC53ZWlnaHQgPSB2YWw7CiAgc2V0Rm9udCgpOwp9CgovKioKICogU2V0IHRoZSBiYWNrZ3JvdW5kIGdyaWQgc3BhY2luZyBhbmQgY29sb3VyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0R3JpZCgyMCwgYGxhdmVuZGVyYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gc3BhY2luZz8gVGhlIHNwYWNpbmcgYmV0d2VlbiBncmlkIGxpbmVzIGluIHBpeGVscyAoZGVmYXVsdCA9IDIwKQogKiBAcGFyYW0ge3N0cmluZ30gY29sb3I/IFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyIChkZWZhdWx0ID0gbGlnaHRncmV5KQogKgogKiBAc2VlIHtAbGluayBub0dyaWR9CiAqLwpmdW5jdGlvbiBzZXRHcmlkKHNwYWNpbmcgPSAyMCwgY29sb3IgPSBgbGlnaHRncmV5YCkgewogIF9fZHJhd19ncmlkID0gdHJ1ZTsKICBfX2dyaWRfc3BhY2luZyA9IHNwYWNpbmc7CiAgX19ncmlkX2NvbG9yID0gY29sb3I7Cn0KCi8qKgogKiBTZXQgdGhlIGNvbG9yIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gcmVwbGFjZSB3aGF0ZXZlcgogKiBoaWdobGlnaHQoKSBtYXJrZWQgYXMgdGhlICJ0byBoaWdobGlnaHQiIGNvbG9yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRIaWdobGlnaHRDb2xvcihgbGltZWApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHRleHQoImxldCdzIGdvIiwgd2lkdGgvMiwgaGVpZ2h0LzIpCiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyQWN0aXZlKHN0YXRlKSB7CiAqICAgICAgIGlmIChzdGF0ZSkgaGlnaGxpZ2h0KGByZWRgKTsKICogICAgICAgZWxzZSBoaWdobGlnaHQoZmFsc2UpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvciBUaGUgQ1NTIGNvbG9yIHRvIHVzZSBmb3IgdGhlIGJvcmRlcgogKgogKiBAc2VlIHtAbGluayBoaWdobGlnaHR9CiAqLwpmdW5jdGlvbiBzZXRIaWdobGlnaHRDb2xvcihjb2xvcikgewogIF9fY3VycmVudF9oaWdobGlnaHRfY29sb3IgPSBjb2xvcjsKfQoKLyoqCiAqIFNldCB0aGUgbGluZSBkYXNoIHByb3BlcnR5LiBTZWUgdGhlIGZvbGxvd2luZyBNRE4gYXJ0aWNsZSBmb3IgdGhlIGRldGFpbHM6CiAqCiAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2RvY3MvV2ViL0FQSS9DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQvc2V0TGluZURhc2gKICoKICogQHBhcmFtICB7bnVtYmVyW119IC4uLnZhbHVlcyBUaGUgZGFzaCBpbnRlcnZhbHMgaW4gcGl4ZWwKICoKICogQHNlZSB7QGxpbmsgbm9MaW5lRGFzaH0KICovCmZ1bmN0aW9uIHNldExpbmVEYXNoKC4uLnZhbHVlcykgewogIF9fY3R4LnNldExpbmVEYXNoKHZhbHVlcyk7Cn0KCi8qKgogKiBTZXQgdGhlIGxpbmUgd2lkdGggaW4gcGl4ZWxzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICByYW5nZSgxLCAxMCwgKGkpID0+IHsKICogICAgICAgICBzZXRMaW5lV2lkdGgoaSk7CiAqICAgICAgICAgbGluZSgyMCwgaSAqIDIwLCAxODAsIGkgKiAyMCk7CiAqICAgICAgIH0pCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoPyBUaGUgbGluZSB3aWR0aCBpbiBwaXhlbHMgKGRlZmF1bHQgPSAxKQogKgogKiBAc2VlIHtAbGluayBzZXRUZXh0U3Ryb2tlfQogKi8KZnVuY3Rpb24gc2V0TGluZVdpZHRoKHdpZHRoID0gMSkgewogIF9fY3R4LmxpbmVXaWR0aCA9IHdpZHRoOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IHN0cm9rZSBjb2xvdXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYHJlZGApOwogKiAgICAgICByZWN0KDUwLCA1MCwgMTAwLCAxMDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvciBUaGUgQ1NTIGNvbG9yIHRvIHVzZSBmb3IgdGhlIGJvcmRlciAoZGVmYXVsdCA9IGJsYWNrKQogKgogKiBAc2VlIHtAbGluayBzZXRGaWxsfQogKiBAc2VlIHtAbGluayBzZXRDb2xvcn0KICovCmZ1bmN0aW9uIHNldFN0cm9rZShjb2xvciA9IGBibGFja2ApIHsKICBpZiAoQ1NTX0NPTE9SX01BUFtjb2xvcl0gPT09IF9faGlnaGxpZ2h0X2NvbG9yKSB7CiAgICBjb2xvciA9IF9fY3VycmVudF9oaWdobGlnaHRfY29sb3I7CiAgfQogIF9fY3R4LnN0cm9rZVN0eWxlID0gY29sb3I7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgdGV4dCBhbGlnbm1lbnQgdmFsdWVzLgogKgogKiBWYWxpZCBgeEFsaWduYCB2YWx1ZXMgYXJlOgogKgogKiAtIENFTlRFUiAtIHRoZSB0ZXh0IGFuY2hvciBpcyBpbiB0aGUgbWlkZGxlIG9mIHRoZSB0ZXh0LiBUZXh0IGlzIHBsYWNlZCBldmVubHkgb24gZWl0aGVyIHNpZGUuCiAqIC0gRU5EIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSByaWdodCBmb3IgTFRSIHRleHQsIGFuZCBvbiB0aGUgbGVmdCBmb3IgUlRMIHRleHQuCiAqIC0gTEVGVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgbGVmdCBzaWRlIG9mIHRoZSB0ZXh0LiBhbGwgdGV4dCBpcyB0byB0aGUgcmlnaHQuCiAqIC0gUklHSFQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIHJpZ2h0IHNpZGUgb2YgdGhlIHRleHQuIEFsbCB0ZXh0IGlzIHRvIHRoZSBsZWZ0LgogKiAtIFNUQVJUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSBsZWZ0IGZvciBMVFIgdGV4dCwgYW5kIG9uIHRoZSByaWdodCBmb3IgUlRMIHRleHQuCiAqCiAqIFZhbGlkIGB5QWxpZ25gIHZhbHVlcyBhcmU6CiAqCiAqIC0gQUxQSEFCRVRJQyAtIHN0YW5kYXJkIHRleHQgYWxpZ25tZW50IChkZWZhdWx0KQogKiAtIEJPVFRPTSAtIHRoZSB0ZXh0IGlzIGFsaWduZWQgdG8gdGhlIGJvdHRvbSBvZiB0aGUgYm91bmRpbmcgYm94CiAqIC0gSEFOR0lORyAtIHJlbGV2YW50IGZvciBUaWJldGFuIGFuZCBvdGhlciBJbmRpYyBzY3JpcHRzLgogKiAtIElERU9HUkFQSElDIC0gcmVsZXZhbnQgZm9yIGlkZW9ncmFwaGljIENKS1YgdGV4dC4KICogLSBNSURETEUgLSBUaGUgdmVydGljYWwgZXF1aXZhbGVudCBvZiAiY2VudGVyIi4KICogLSBUT1AgLSBUaGUgdGV4dCBpcyBhbGlnbmVkIHRvIHRoZSB0b3Agb2YgdGhlIHR5cG9ncmFwaGljICJlbSBzcXVhcmUiLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDIwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIGxpbmUod2lkdGggLyAyLCAwLCB3aWR0aCAvIDIsIGhlaWdodCk7CiAqICAgICAgIGxpbmUoMCwgaGVpZ2h0IC8gMiwgd2lkdGgsIGhlaWdodCAvIDIpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KCJjZW50ZXIgbWlkZGxlIiwgd2lkdGggLyAyLCBoZWlnaHQvMik7CiAqICAgICAgIGxpbmUoMCwgaGVpZ2h0IC8gMiAtIDUwLCB3aWR0aCwgaGVpZ2h0IC8gMiAtIDUwKTsKICogICAgICAgc2V0VGV4dEFsaWduKFJJR0hULCBUT1ApOwogKiAgICAgICB0ZXh0KCJyaWdodCB0b3AiLCB3aWR0aCAvIDIsIGhlaWdodC8yIC0gNTApOwogKiAgICAgICBsaW5lKDAsIGhlaWdodCAvIDIgKyA1MCwgd2lkdGgsIGhlaWdodCAvIDIgKyA1MCk7CiAqICAgICAgIHNldFRleHRBbGlnbihMRUZULCBCT1RUT00pOwogKiAgICAgICB0ZXh0KCJsZWZ0IGJvdHRvbSIsIHdpZHRoIC8gMiwgaGVpZ2h0LzIgKyA1MCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IHhBbGlnbiBUaGUgQ1NTIGhvcml6b250YWwgYWxpZ25tZW50CiAqIEBwYXJhbSB7c3RyaW5nfSB5QWxpZ24gVGhlIENTUyB2ZXJ0aWNhbCBhbGlnbm1lbnQKICovCmZ1bmN0aW9uIHNldFRleHRBbGlnbih4QWxpZ24sIHlBbGlnbikgewogIF9fY3R4LnRleHRBbGlnbiA9IHhBbGlnbjsKICBfX2N0eC50ZXh0QmFzZWxpbmUgPSB5QWxpZ247Cn0KCi8qKgogKiBTZXQgdGhlIHRleHQgb3V0bGluZSBzdHJva2luZyBwcm9wZXJ0aWVzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dFN0cm9rZShgcmVkYCwgMSk7CiAqICAgICAgIHNldEZpbGwoYHllbGxvd2ApOwogKiAgICAgICB0ZXh0KCJmYW5jeSB0ZXh0Iiwgd2lkdGgvMiwgODAsIENFTlRFUiwgQ0VOVEVSKTsKICogICAgICAgc2V0Rm9udFNpemUoNjUpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKGByZWRgLCAzKTsKICogICAgICAgc2V0RmlsbChgeWVsbG93YCk7CiAqICAgICAgIHRleHQoImZhbmN5IHRleHQiLCB3aWR0aC8yLCAxNDAsIENFTlRFUiwgQ0VOVEVSKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIKICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoPyBUaGUgdGV4dCBzdHJva2Ugd2lkdGggaW4gcGl4ZWxzIChkZWZhdWx0ID0gMSkKICoKICogQHNlZSB7QGxpbmsgc2V0U3Ryb2tlfQogKiBAc2VlIHtAbGluayBzZXRMaW5lV2lkdGh9CiAqLwpmdW5jdGlvbiBzZXRUZXh0U3Ryb2tlKGNvbG9yLCB3aWR0aCA9IDEpIHsKICBfX3RleHRTdHJva2UgPSBjb2xvcjsKICBzZXRMaW5lV2lkdGgod2lkdGgpOwp9Ci8qKgogKiBTdGFydCBhIG5ldyBzaGFwZS4gVGhpcyB5aWVsZHMgYSBgU2hhcGVgIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgQVBJOgogKgogKiAtIGBtYWtlTW92YWJsZShtb3ZhYmxlPzogYm9vbGVhbilgIC0gYWxsb3cgdGhpcyBzaGFwZSB0byBiZSBtb3ZlZCBhcm91bmQgd2l0aCB0aGUgcG9pbnRlciAoYG1vdmFibGVgIGlzIHRydWUgaWYgb21pdHRlZCkKICogLSBgYWxsb3dSZXNpemluZyhhbGxvd2VkPzogYm9vbGVhbilgIC0gYWxsb3cgdGhlIHBvaW50cyB0aGF0IG1ha2UgdXAgdGhpcyBzaGFwZSB0byBiZSBtb3ZlZCBhcm91bmQgKGBhbGxvd2VkYCBpcyB0cnVlIGlmIG9taXR0ZWQpCiAqIC0gYHNob3dQb2ludHMoc2hvd1BvaW50cz86IGJvb2xlYW4pYCAtIGRldGVybWluZXMgd2hldGhlciBvciBub3QgdG8gZHJhdyB0aGUgcGF0aGluZyBwb2ludHMgb24gdG9wIG9mIHRoZSBzaGFwZSBkdXJpbmcgZHJhdygpLgogKiAtIGBjbG9zZSgpYCAtIGNsb3NlIHRoZSBjdXJyZW50IHNlZ21lbnQgc28gbm8gbmV3IHBvaW50cyBjYW4gYmUgYWRkZWQuCiAqIC0gYG5ld1NlZ21lbnQoY2xvc2VFeGlzdGluZz86IGJvb2xlYW4pYCAtIHN0YXJ0IGEgbmV3IHNlZ21lbnQgaW4gdGhpcyBzaGFwZSwgY2xvc2luZyB0aGUgcHJldmlvdXMgc2VnbWVudCBpZiBgY2xvc2VFeGlzdGluZ2AgaXMgdHJ1ZSAoZGVmYXVsdD1mYWxzZSkKICoKICogQSBTaGFwZSBhbHNvIHN1cHBvcnRzIHRoZSBmb2xsb3dpbmcgdXRpbGl0eSBmdW5jdGlvbnM6CiAqCiAqIC0gYG9mZnNldCh4LCB5KWAgLSAodGVtcG9yYXJpbHkpIG1vdmUgdGhpcyBzaGFwZSBieSAoeCx5KQogKiAtIGBjb21taXQoKWAgLSBjb21taXQgdGhlIHRlbXBvcmFyeSBvZmZzZXQgYnkgcmV3cml0aW5nIGFsbCBjb29yZGluYXRlcy4KICogLSBgcmVzZXQoKWAgLSByZXNldCB0aGUgc2hhcGUgdG8gaGF2aW5nIG5vIG9mZnNldC4KICogLSBgZHJhdygpYCAtIGRyYXdzIHRoZSBzaGFwZSB1c2luZyBpdHMgY3VycmVudCBzdHJva2UsIGZpbGwsIGFuZCAic2hvdyBwb2ludHMiIHNldHRpbmdzLgogKiAtIGBpbnNpZGUoeCwgeSk6IGJvb2xlYW5gIC0gcmV0dXJucyB3aGV0aGVyIG9yIG5vdCBhIHBvaW50IGxpZXMgaW5zaWRlIHRoaXMgKGltcGxpY2l0bHkgY2xvc2VkKSBzaGFwZS4KICoKICogQW5kIGl0IHN1cHBvcnRzIHRoZSBmb2xsb3dpbmcgcGF0aGluZyBmdW5jdGlvbnMsIHdpdGggYXJndW1lbnRzIHRoYXQKICogY2FuIGVpdGhlciBjb25zaXN0IG9mICh0aGUgbmVjZXNzYXJ5IG51bWJlciBvZikgcGFpcnMgb2YgY29vcmRpbmF0ZQogKiB2YWx1ZXMsIG9yICh0aGUgbmVjZXNzYXJ5IG51bWJlciBvZikgcG9pbnQtbGlrZXMsIGJlaW5nIG9iamVjdHMgd2l0aAogKiBhbiBgeGAgYW5kIGB5YCBwcm9wZXJ0eS4KICoKICogLSBgbW92ZVRvKHgseSBPUiBwOnBvaW50TGlrZSlgIC0gc3RhcnQgYSBuZXcgc2VnbWVudCBhbmQgbWFyayBpdHMgcGF0aCBhcyBzdGFydGluZyBhdCAoeCx5KS4KICogLSBgbGluZVRvKHgseSwuLi4gT1IgcCwuLi4pYCAtIGFkZCBvbmUgb3IgbW9yZSBwb2ludHMgdGhhdCBjb25uZWN0IHRvIHRoZSBwcmV2aW91cyBwb2ludCB3aXRoIGEgc3RyYWlnaHQgbGluZS4KICogLSBgcXVhZFRvKGN4LGN5LHgseSwuLi4gT1IgY3AscCwuLi4pYCAtIGFkZCBvbmUgb3IgbW9yZSBxdWFkcmF0aWMgYmV6aWVyIGN1cnZlcywgd2hlcmUgKGN4LGN5KS9jcCBpcyB0aGUgY29udHJvbCBwb2ludCwgYW5kICh4LHkpL3AgdGhlIGVuZCBwb2ludC4KICogLSBgY3VydmVUbyhjeDEsY3kxLGN4MixjeTIseCx5LC4uLiBPUiBjMXAsYzJwLHAsLi4uKWAgLSBhZGQgb25lIG9yIG1vcmUgY3ViaWMgYmV6aWVyIGN1cnZlcywgd2hpY2ggaGF2ZSB0d28gY29udHJvbCBwb2ludHMuCiAqIC0gYHNwbGluZVRvKHgxLHkxLC4uLiBPUiBwMSwuLi4pYCAtIGFkZCBvbmUgb3IgbW9yZSBjYXJkaW5hbCBzcGxpbmUgcGF0aGluZyBjb29yZGluYXRlcy4KICoKICogQ2FyZGluYWwgc3BsaW5lIGNvb3JkaW5hdGVzIGFyZSByZW5kZXJlZCBieSB0cmVhdGluZyB0aGUgcGF0aCBhcyBjbG9zZWQKICogKGV2ZW4gaWYgaXQgaXMgbm90KSwgcGVyZm9ybWluZyB3cmFwLWFyb3VuZCBsb29rdXBzIGFzIG5lZWRlZCBpbiBvcmRlcgogKiB0byBkcmF3ICJzb21ldGhpbmcgc2Vuc2libGUiLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgbGV0IHNoYXBlOwogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzaGFwZSA9IHN0YXJ0U2hhcGUoKTsKICogICAgICAgc2hhcGUuYWxsb3dSZXNpemluZygpOwogKiAgICAgICBzaGFwZS5zaG93UG9pbnRzKCk7CiAqICAgICAgIHNoYXBlLm1ha2VNb3ZhYmxlKCk7CiAqICAgICAgIC8vIENyZWF0ZSBhIGRpYW1vbmQgc2hhcGUKICogICAgICAgc2hhcGUuYWRkKDEwLGhlaWdodC8yKTsKICogICAgICAgc2hhcGUuYWRkKHdpZHRoLzIsIDEwKTsKICogICAgICAgc2hhcGUuYWRkKHdpZHRoLTEwLCBoZWlnaHQvMik7CiAqICAgICAgIHNoYXBlLmFkZCh3aWR0aC8yLCBoZWlnaHQtMTApOwogKiAgICAgICAvLyBXaXRoIGEgcmVjdGFuZ3VsYXIgY3V0b3V0CiAqICAgICAgIHNoYXBlLm5ld1NlZ21lbnQodHJ1ZSk7CiAqICAgICAgIHNoYXBlLmFkZCg3NSw3NSk7CiAqICAgICAgIHNoYXBlLmFkZCgxMjUsNzUpOwogKiAgICAgICBzaGFwZS5hZGQoMTI1LDEyNSk7CiAqICAgICAgIHNoYXBlLmFkZCg3NSwxMjUpOwogKiAgICAgICBzaGFwZS5mbGlwU2VnbWVudCgpOwogKiAgICAgICBzaGFwZS5jbG9zZSgpOwogKiAgICAgICBzaGFwZS5zZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNoYXBlLnNldEZpbGwoYGdvbGRgKTsKICogICAgIH0KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzaGFwZS5kcmF3KHRydWUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEByZXR1cm5zIHtTaGFwZX0gdGhlIG5ld2x5IGNyZWF0ZWQgc2hhcGUgb2JqZWN0CiAqCiAqIEBzZWUge0BsaW5rIGVuZFNoYXBlfQogKi8KZnVuY3Rpb24gc3RhcnRTaGFwZSgpIHsKICByZXR1cm4gKF9fc2hhcGUgPSBuZXcgU2hhcGUoKSk7Cn0KCi8qKgogKiBDbGVhciB0aGUgY3VycmVudCBzaGFwZSwgb3B0aW9uYWxseSBjbG9zaW5nIGl0LgogKgogKiBAcGFyYW0ge2Jvb2xlYW59IGNsb3NlPyBXaGVuIHVzZWQsIGNsb3NlcyB0aGUgc2hhcGUncyBjdXJyZW50IHNlZ21lbnQuCiAqIEByZXR1cm5zIHtTaGFwZX0gVGhlIHNoYXBlIHRoYXQgZ290IGNsb3NlZAogKgogKiBAc2VlIHtAbGluayBzdGFydFNoYXBlfQogKi8KZnVuY3Rpb24gZW5kU2hhcGUoY2xvc2UgPSBmYWxzZSkgewogIGlmIChfX3NoYXBlICYmIGNsb3NlKSBfX3NoYXBlLmNsb3NlKCk7CiAgY29uc3Qgc2hhcGUgPSBfX3NoYXBlOwogIF9fc2hhcGUgPSB1bmRlZmluZWQ7CiAgcmV0dXJuIHNoYXBlOwp9CgovKioKICogU3RhcnQgYSBuZXcgc2VnbWVudCBpbiBhIHNoYXBlLgogKgogKiBAcGFyYW0ge2Jvb2xlYW59IGNsb3NlPyBDbG9zZXMgdGhlIGN1cnJlbnQgc2VnbWVudCBiZWZvcmUgb3BlbmluZyBhIG5ldyBvbmUgKGRlZmF1bHQgPSB0cnVlKQogKgogKiBAc2VlIHtAbGluayBzdGFydFNoYXBlfQogKiBAc2VlIHtAbGluayBlbmRTaGFwZX0KICovCmZ1bmN0aW9uIG5ld1NlZ21lbnQoY2xvc2UgPSB0cnVlKSB7CiAgX19zaGFwZT8ubmV3U2VnbWVudChjbG9zZSk7Cn0KLyoqCiAqIENlbnRlcnMgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIG9uIHlvdXIgZ3JhcGhpYy4KICogVGhpcyBpcyBlcXVpdmFsZW50IHRvIGNhbGxpbmc6CiAqCiAqIGBgYAogKiB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiBgYGAKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIGNlbnRlcigpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgbGluZSgwLCAtaHVnZSwgMCwgaHVnZSk7CiAqICAgICAgIGxpbmUoLWh1Z2UsIDAsIGh1Z2UsIDApOwogKiAgICAgICBzZXRDb2xvcihyYW5kb21Db2xvcigpKTsKICogICAgICAgcG9pbnQoIDEwLCAgMTApOwogKiAgICAgICBzZXRDb2xvcihyYW5kb21Db2xvcigpKTsKICogICAgICAgcG9pbnQoIDEwLCAtMTApOwogKiAgICAgICBzZXRDb2xvcihyYW5kb21Db2xvcigpKTsKICogICAgICAgcG9pbnQoLTEwLCAtMTApOwogKiAgICAgICBzZXRDb2xvcihyYW5kb21Db2xvcigpKTsKICogICAgICAgcG9pbnQoLTEwLCAgMTApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqLwpmdW5jdGlvbiBjZW50ZXIoKSB7CiAgdHJhbnNsYXRlKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7Cn0KCi8qKgogKiBSZXNldCB0aGUgY29vcmRpbmF0ZSB0cmFuc2Zvcm0gbWF0cml4LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBub0dyaWQoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBsaWdodGdyZXlgKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICB0cmFuc2xhdGUoNTAsNTApOwogKiAgICAgICBsaW5lKDAsMCwxMDAsMCk7CiAqICAgICAgIHBvaW50KDAsMCk7CiAqICAgICAgIHNldENvbG9yKGBkYXJrZ3JlZW5gKTsKICogICAgICAgcG9pbnQoMTAsMCk7CiAqICAgICAgIHJvdGF0ZShQSS80KTsKICogICAgICAgcG9pbnQoMTAsMCk7CiAqICAgICAgIGxpbmUoMCwwLDEwMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgcm90YXRlKC1QSS82KQogKiAgICAgICBwb2ludCgxMDAsMCk7CiAqICAgICAgIHNjYWxlKDAuNSwgMC41KTsKICogICAgICAgcG9pbnQoMTAwLDApOwogKiAgICAgICBsaW5lKDEwMCwwLDIwMCwwKTsKICogICAgICAgcmVzZXRUcmFuc2Zvcm0oKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIGxpbmUoMCwzLDEwMCwzKTsKICogICAgICAgcG9pbnQoMCwzKTsKICogICAgICAgcG9pbnQoMTAsMyk7CiAqICAgICAgIHBvaW50KDEwMCwzKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayB0cmFuc2Zvcm19CiAqLwpmdW5jdGlvbiByZXNldFRyYW5zZm9ybSgpIHsKICBfX2N0eC5yZXNldFRyYW5zZm9ybSgpOwp9CgovKioKICogUm90YXRlIHRoZSBjb29yZGluYXRlIHN5c3RlbSB3cnQgdGhlIGN1cnJlbnQgb3JpZ2luLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBub0dyaWQoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBsaWdodGdyZXlgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBvaW50KDAsMCk7CiAqICAgICAgIHNldENvbG9yKGBkYXJrZ3JlZW5gKTsKICogICAgICAgbGluZSgwLDAsMjAsMjApOwogKiAgICAgICBwb2ludCgyMCwyMCk7CiAqICAgICAgIHJvdGF0ZShQSS80KTsKICogICAgICAgbGluZSgwLDAsMjAsMjApOwogKiAgICAgICBwb2ludCgyMCwyMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIFRoZSBhbmdsZSBieSB3aGljaCB0byByb3RhdGUgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIGluIHJhZGlhbnMKICoKICogQHNlZSB7QGxpbmsgdHJhbnNmb3JtfQogKiBAc2VlIHtAbGluayByZXNldFRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHJvdGF0ZShhbmdsZSA9IDApIHsKICBfX2N0eC5yb3RhdGUoYW5nbGUpOwp9CgovKioKICogU2NhbGUgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIHdydCB0aGUgY3VycmVudCBvcmlnaW4uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIG5vR3JpZCgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYGxpZ2h0Z3JleWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBzY2FsZSgyKTsKICogICAgICAgbGluZSgwLDAsMjAsMjApOwogKiAgICAgICBwb2ludCgyMCwyMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGFtb3VudCBieSB3aGljaCB0byBzY2FsZSB0aGUgeCBjb29yZGluYXRlcy4KICogQHBhcmFtIHtudW1iZXJ9IHk/IFRoZSBhbW91bnQgYnkgd2hpY2ggdG8gc2NhbGUgdGhlIHggY29vcmRpbmF0ZXMgKGRlZmF1bHQgPSBzYW1lIGFzIHgpCiAqCiAqIEBzZWUge0BsaW5rIHRyYW5zZm9ybX0KICogQHNlZSB7QGxpbmsgcmVzZXRUcmFuc2Zvcm19CiAqLwpmdW5jdGlvbiBzY2FsZSh4ID0gMSwgeSA9IHgpIHsKICBfX2N0eC5zY2FsZSh4LCB5KTsKfQoKLyoqCiAqIENvbnZlcnQgYSBzY3JlZW4gKGUuZy4gYnJvd3NlcikgY29vcmRpbmF0ZSBpbnRvIGl0cwogKiBjb3JyZXNwb25kaW5nICJ0cmFuc2Zvcm1lZCIgY29vcmRpbmF0ZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgbGlnaHRncmV5YCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHJvdGF0ZShQSS80KTsKICogICAgICAgc2NhbGUoMC41KTsKICogICAgICAgaWYgKHBvaW50ZXIuYWN0aXZlKSB7CiAqICAgICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICAgIHBvaW50KHBvaW50ZXIueCwgcG9pbnRlci55KTsKICogICAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICAgIHBvaW50KHNjcmVlblRvV29ybGQocG9pbnRlci54LCBwb2ludGVyLnkpKTsKICogICAgICAgfQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlck1vdmUoKSB7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBzY3JlZW4gY29vcmRpbmF0ZSdzIHggdmFsdWUgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBzY3JlZW4gY29vcmRpbmF0ZSdzIHkgdmFsdWUgaW4gcGl4ZWxzCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgVGhlIHdvcmxkIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHNjcmVlbiB7eCx5fSBjb29yZGluYXRlCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgVGhlIHdvcmxkIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgcHJvamVjdH0KICogQHNlZSB7QGxpbmsgd29ybGRUb1NjcmVlbn0KICovCmZ1bmN0aW9uIHNjcmVlblRvV29ybGQoeCwgeSkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBsZXQgTSA9IF9fY3R4LmdldFRyYW5zZm9ybSgpLmludmVydFNlbGYoKTsKCiAgcmV0dXJuIG5ldyBQb2ludCh4ICogTS5hICsgeSAqIE0uYyArIE0uZSwgeCAqIE0uYiArIHkgKiBNLmQgKyBNLmYpOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IHRyYW5zZm9ybSBtYXRyaXgsIGJhc2VkIG9uIGFwcGx5aW5nOgogKgogKiBgYGAKICogICAgICAgfCBhIGIgYyB8CiAqICAgbSA9IHwgZCBlIGYgfAogKiAgICAgICB8IDAgMCAxIHwKICogYGBgCiAqCiAqIFdpdGggdGhlIHBhcmFtZXRlcnMgZGVmYXVsdGluZyB0byB0aGUgaWRlbnRpdHkgbWF0cml4LgogKgogKiBTZWUgdGhlIGZvbGxvd2luZyBNRE4gYXJ0aWNsZSBmb3IgbW9yZSBkZXRhaWxzIGFib3V0IHRoaXMgZnVuY3Rpb246CiAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2RvY3MvV2ViL0FQSS9DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQvdHJhbnNmb3JtCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBhIChkZWZhdWx0ID0gMSkKICogQHBhcmFtIHtudW1iZXJ9IGIgKGRlZmF1bHQgPSAwKQogKiBAcGFyYW0ge251bWJlcn0gYyAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSB7bnVtYmVyfSBkIChkZWZhdWx0ID0gMCkKICogQHBhcmFtIHtudW1iZXJ9IGUgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0ge251bWJlcn0gZiAoZGVmYXVsdCA9IDApCiAqCiAqIEBzZWUge0BsaW5rIHJlc2V0VHJhbnNmb3JtfQogKi8KZnVuY3Rpb24gdHJhbnNmb3JtKGEgPSAxLCBiID0gMCwgYyA9IDAsIGQgPSAwLCBlID0gMSwgZiA9IDApIHsKICBfX2N0eC50cmFuc2Zvcm0oYSwgYiwgYywgZCwgZSwgZik7Cn0KCi8qKgogKiBUcmFuc2xhdGUgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIGJ5IHNvbWUgYW1vdW50IG9mIHggYW5kIHkgdW5pdHMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBwb2ludCgwLDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSB4IHZhbHVlIGluIHBpeGVscyB0byBiZSB0cmVhdGVkIGFzIHRoZSBuZXcgInplcm8iCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSB5IHZhbHVlIGluIHBpeGVscyB0byBiZSB0cmVhdGVkIGFzIHRoZSBuZXcgInplcm8iCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSB7eCx5fSBjb29yZGluYXRlIHRvIGJlIHRyZWF0ZWQgYXMgdGhlIG5ldyAiemVybyIKICoKICogQHNlZSB7QGxpbmsgdHJhbnNmb3JtfQogKiBAc2VlIHtAbGluayByZXNldFRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHRyYW5zbGF0ZSh4ID0gMCwgeSA9IDApIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBfX2N0eC50cmFuc2xhdGUoeCwgeSk7Cn0KCi8qKgogKiBDb252ZXJ0IGFuIGluLWNhbnZhcyAidHJhbnNmb3JtZWQiIGNvb3JkaW5hdGUgaW50byBpdHMKICogY29ycmVzcG9uZGluZyAic2NyZWVuIiAoaS5lLiBicm93c2VyIGNhbnZhcyBvZmZzZXQpIGNvb3JkaW5hdGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwogKgogKiAgICAgICByb3RhdGUobWlsbGlzKCkgLyAyMDAwKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBjb25zdCBwID0gbmV3IFBvaW50KDMwLCAwKTsKICogICAgICAgcG9pbnQocCk7CiAqICAgICAgIHRleHQoYCR7cC54fSwke3AueX1gLCBwLnggKyAxMCwgcC55ICsgMTApOwogKgogKiAgICAgICBjb25zdCB7eCwgeX0gPSB3b3JsZFRvU2NyZWVuKHApOwogKiAgICAgICByZXNldFRyYW5zZm9ybSgpOwogKiAgICAgICBzZXRGb250U2l6ZSgxNik7CiAqICAgICAgIHRleHQoYCR7eC50b0ZpeGVkKCl9LCR7eS50b0ZpeGVkKCl9YCwgeCAtIDI1LCB5IC0gMTUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSB3b3JsZCBjb29yZGluYXRlJ3MgeCB2YWx1ZSBpbiBwaXhlbHMKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHdvcmxkIGNvb3JkaW5hdGUncyB5IHZhbHVlIGluIHBpeGVscwogKiBAcmV0dXJucyB7UG9pbnRMaWtlfSBwIFRoZSBzY3JlZW4ge3gseX0gY29vcmRpbmF0ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgd29ybGQge3gseX0gY29vcmRpbmF0ZQogKiBAcmV0dXJucyB7UG9pbnRMaWtlfSBwIFRoZSBzY3JlZW4ge3gseX0gY29vcmRpbmF0ZQogKgogKiBAc2VlIHtAbGluayBwcm9qZWN0fQogKiBAc2VlIHtAbGluayBzY3JlZW5Ub1dvcmxkfQogKi8KZnVuY3Rpb24gd29ybGRUb1NjcmVlbih4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIGxldCBNID0gX19jdHguZ2V0VHJhbnNmb3JtKCk7CgogIHJldHVybiBuZXcgUG9pbnQoeCAqIE0uYSArIHkgKiBNLmMgKyBNLmUsIHggKiBNLmIgKyB5ICogTS5kICsgTS5mKTsKfQpmdW5jdGlvbiBncmlkKCkgewogIHNhdmUoKTsKICBzZXRMaW5lV2lkdGgoMC41KTsKICBub0ZpbGwoKTsKICBzZXRTdHJva2UoX19ncmlkX2NvbG9yKTsKICBmb3IgKAogICAgbGV0IHggPSAoLTAuNSArIF9fZ3JpZF9zcGFjaW5nIC8gMikgfCAwOwogICAgeCA8IHdpZHRoOwogICAgeCArPSBfX2dyaWRfc3BhY2luZwogICkgewogICAgbGluZSh4LCAwLCB4LCBoZWlnaHQpOwogIH0KICBmb3IgKAogICAgbGV0IHkgPSAoLTAuNSArIF9fZ3JpZF9zcGFjaW5nIC8gMikgfCAwOwogICAgeSA8IGhlaWdodDsKICAgIHkgKz0gX19ncmlkX3NwYWNpbmcKICApIHsKICAgIGxpbmUoMCwgeSwgd2lkdGgsIHkpOwogIH0KICByZXN0b3JlKCk7Cn0KZnVuY3Rpb24gX19zYWZlbHlJbnRlcmNlcHRLZXkoZXZ0KSB7CiAgLy8gV2UgZG9uJ3Qgd2FudCB0byBpbnRlcmZlcmUgd2l0aCB0aGUgYnJvd3Nlciwgc28gd2UncmUgb25seQogIC8vIGdvaW5nIHRvIGFsbG93IHVubW9kaWZpZWQga2V5cywgb3Igc2hpZnQtbW9kaWZpZWQga2V5cywKICAvLyBhbmQgdGFiIGhhcyB0byBhbHdheXMgd29yay4gRm9yIG9idmlvdXMgcmVhc29ucy4KICBjb25zdCB0YWIgPSBldnQua2V5ICE9PSAiVGFiIjsKICBjb25zdCBmdW5jdGlvbktleSA9IGV2dC5rZXkubWF0Y2goL0ZcZCsvKSA9PT0gbnVsbDsKICBjb25zdCBzcGVjaWZpY0NoZWNrID0gdGFiICYmIGZ1bmN0aW9uS2V5OwogIGlmICghZXZ0LmFsdEtleSAmJiAhZXZ0LmN0cmxLZXkgJiYgIWV2dC5tZXRhS2V5ICYmIHNwZWNpZmljQ2hlY2spIHsKICAgIGlmIChldnQudGFyZ2V0ID09PSBfX2NhbnZhcykgewogICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOwogICAgfQogIH0KfQoKZnVuY3Rpb24gX19rZXlEb3duKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSkgewogIGtleWJvYXJkW2tleV0gPSBEYXRlLm5vdygpOwogIGlmICh0eXBlb2Yga2V5RG93biAhPT0gYHVuZGVmaW5lZGApCiAgICBrZXlEb3duKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn0KCl9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoYGtleWRvd25gLCAoZXZ0KSA9PiB7CiAgX19zYWZlbHlJbnRlcmNlcHRLZXkoZXZ0KTsKICBjb25zdCB7IGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSB9ID0gZXZ0OwogIGlmIChfX2ZpbmlzaGVkX3NldHVwKSBfX2tleURvd24oa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KTsKfSk7CgpmdW5jdGlvbiBfX2tleVVwKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSkgewogIGRlbGV0ZSBrZXlib2FyZFtrZXldOwogIGlmICh0eXBlb2Yga2V5VXAgIT09IGB1bmRlZmluZWRgKQogICAga2V5VXAoa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KTsKfQoKX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihga2V5dXBgLCAoZXZ0KSA9PiB7CiAgX19zYWZlbHlJbnRlcmNlcHRLZXkoZXZ0KTsKICBjb25zdCB7IGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSB9ID0gZXZ0OwogIGlmIChfX2ZpbmlzaGVkX3NldHVwKSBfX2tleVVwKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn0pOwpjb25zdCBfX2Jpbm9taWFsQ29lZmZpY2llbnRzID0gW1sxXSwgWzEsIDFdXTsKY2xhc3MgTWF0cml4IHsKICBjb25zdHJ1Y3RvcihuLCBtLCBkYXRhKSB7CiAgICBkYXRhID0gbiBpbnN0YW5jZW9mIEFycmF5ID8gbiA6IGRhdGE7CiAgICB0aGlzLmRhdGEgPQogICAgICBkYXRhID8/IFsuLi5uZXcgQXJyYXkobildLm1hcCgodikgPT4gWy4uLm5ldyBBcnJheShtKV0ubWFwKCh2KSA9PiAwKSk7CiAgICB0aGlzLnJvd3MgPSB0aGlzLmRhdGEubGVuZ3RoOwogICAgdGhpcy5jb2xzID0gdGhpcy5kYXRhWzBdLmxlbmd0aDsKICB9CiAgc2V0RGF0YShkYXRhKSB7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogIH0KICBnZXQoaSwgaikgewogICAgcmV0dXJuIHRoaXMuZGF0YVtpXVtqXTsKICB9CiAgc2V0KGksIGosIHZhbHVlKSB7CiAgICB0aGlzLmRhdGFbaV1bal0gPSB2YWx1ZTsKICB9CiAgcm93KGkpIHsKICAgIHJldHVybiB0aGlzLmRhdGFbaV07CiAgfQogIGNvbChqKSB7CiAgICB2YXIgZCA9IHRoaXMuZGF0YSwKICAgICAgY29sID0gW107CiAgICBmb3IgKGxldCByID0gMCwgbCA9IGQubGVuZ3RoOyByIDwgbDsgcisrKSB7CiAgICAgIGNvbC5wdXNoKGRbcl1bal0pOwogICAgfQogICAgcmV0dXJuIGNvbDsKICB9CiAgbXVsdGlwbHkob3RoZXIpIHsKICAgIHJldHVybiBuZXcgTWF0cml4KG11bHRpcGx5TWF0cml4KHRoaXMuZGF0YSwgb3RoZXIuZGF0YSkpOwogIH0KICBpbnZlcnQoKSB7CiAgICByZXR1cm4gbmV3IE1hdHJpeChpbnZlcnRNYXRyaXgodGhpcy5kYXRhKSk7CiAgfQogIHRyYW5zcG9zZSgpIHsKICAgIHJldHVybiBuZXcgTWF0cml4KHRyYW5zcG9zZU1hdHJpeCh0aGlzLmRhdGEpKTsKICB9Cn0KY2xhc3MgUG9pbnQgewogIGNvbnN0cnVjdG9yKHgsIHkpIHsKICAgIHRoaXMueCA9IHg7CiAgICB0aGlzLnkgPSB5OwogIH0KfQoKY2xhc3MgQ2lyY2xlIGV4dGVuZHMgUG9pbnQgewogIGNvbnN0cnVjdG9yKHgsIHksIHIpIHsKICAgIHN1cGVyKHgsIHkpOwogICAgdGhpcy5yID0gcjsKICB9Cn0KZnVuY3Rpb24gX19jaGVja0ZvckN1cnJlbnRNb3ZhYmxlKHgsIHksIHR5cGUpIHsKICBjdXJyZW50TW92YWJsZSA9IGZhbHNlOwoKICBpZiAoIV9fbW92YWJsZV9wb2ludHMubGVuZ3RoKSByZXR1cm47CgogIGxldCBmb3VuZFBvaW50ID0gZmFsc2U7CiAgbGV0IGZvdW5kU2hhcGUgPSBmYWxzZTsKICBsZXQgbWF0Y2hlcyA9IFtdOwogIGNvbnN0IG1hdGNoUGFkZGluZyA9IHR5cGUuaW5jbHVkZXMoYG1vdXNlYCkgPyAxMCA6IDMwOwoKICBfX21vdmFibGVfcG9pbnRzLmZvckVhY2goKHApID0+IHsKICAgIGlmIChwIGluc3RhbmNlb2YgU2hhcGUpIHsKICAgICAgaWYgKHAuaW5zaWRlKHgsIHkpKSB7CiAgICAgICAgZm91bmRTaGFwZSA9IHRydWU7CiAgICAgICAgbWF0Y2hlcy5wdXNoKHsgcCwgZDogcC5fX3Nob3dQb2ludHMgPyAtMSA6IDAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGxldCB4MiA9IHBbMF0gPT09IHVuZGVmaW5lZCA/IHAueCA6IHBbMF07CiAgICAgIGxldCB5MiA9IHBbMV0gPT09IHVuZGVmaW5lZCA/IHAueSA6IHBbMV07CiAgICAgIGNvbnN0IGQgPSBkaXN0KHgsIHksIHgyLCB5Mik7CiAgICAgIGlmIChkIDwgKHAuciA/IHAuciA6IDApICsgbWF0Y2hQYWRkaW5nKSB7CiAgICAgICAgZm91bmRQb2ludCA9IHRydWU7CiAgICAgICAgbWF0Y2hlcy5wdXNoKHsgcCwgZCB9KTsKICAgICAgfQogICAgfQogIH0pOwoKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgYXV0b2A7CgogIGlmIChmb3VuZFBvaW50ICYmIGZvdW5kU2hhcGUpIHsKICAgIC8vIGlmIHdlIGhhdmUgYSBtaXggb2YgbWF0Y2hlZCBwb2ludHMgYW5kIHNoYXBlcwogICAgLy8gcHJpb3JpdGl6ZSBhY3RpdmF0aW5nIHBvaW50cyBpbnN0ZWFkLgogICAgbWF0Y2hlcyA9IG1hdGNoZXMuZmlsdGVyKCh2KSA9PiB2LmQgPj0gMCk7CiAgfQoKICBjb25zdCBtbGVuID0gbWF0Y2hlcy5sZW5ndGg7CiAgaWYgKG1sZW4gPiAwKSB7CiAgICBpZiAobWxlbiA+IDEpIG1hdGNoZXMuc29ydCgoYSwgYikgPT4gYS5kIC0gYi5kKTsKICAgIGN1cnJlbnRNb3ZhYmxlID0gbWF0Y2hlc1swXS5wOwogICAgX19jYW52YXMuc3R5bGUuY3Vyc29yID0gYHBvaW50ZXJgOwogIH0KfQoKZnVuY3Rpb24gX190b1BvaW50ZXJFdmVudChldnQpIHsKICBsZXQgcG9pbnRlciA9IGV2dDsKICAvLyBDb252ZXJ0IG1vdXNlIG9yIHRvdWNoIGludG8gZ2VuZXJpYyBwb2ludGVyLiBXaGljaCB3ZSBuZWVkCiAgLy8gdG8gZG8gYmVjYXVzZSBDaHJvbWUgb24gTWFjT1MgaGFzIGRlY2lkZWQgdG8gbm90IGdlbmVyYXRlCiAgLy8gcG9pbnRlciBldmVudHMgd2hlbiB0aGVyZSdzIGEgbW91c2UuIFRoYW5rcyBHb29nbGUhCiAgaWYgKGV2dC50eXBlLmluY2x1ZGVzKGB0b3VjaGApKSB7CiAgICBjb25zdCB7IHRvdWNoZXMsIGNoYW5nZWRUb3VjaGVzIH0gPSBldnQub3JpZ2luYWxFdmVudCA/PyBldnQ7CiAgICBwb2ludGVyID0gdG91Y2hlc1swXSA/PyBjaGFuZ2VkVG91Y2hlc1swXTsKICB9CiAgY29uc3QgeyBjbGllbnRYLCBjbGllbnRZIH0gPSBwb2ludGVyOwogIGNvbnN0IHsgbGVmdCwgdG9wIH0gPSBfX2NhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICByZXR1cm4geyBvZmZzZXRYOiBjbGllbnRYIC0gbGVmdCwgb2Zmc2V0WTogY2xpZW50WSAtIHRvcCB9Owp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PQoKW2B0b3VjaHN0YXJ0YCwgYG1vdXNlZG93bmBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChldnQpID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGNvbnN0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gX190b1BvaW50ZXJFdmVudChldnQpOwogICAgICBjb25zdCB7IHgsIHkgfSA9IHNjcmVlblRvV29ybGQob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwgeyB4LCB5LCB0eXBlLCBkb3duOiB0cnVlLCBtYXJrOiB7IHgsIHkgfSB9KTsKICAgICAgX19jaGVja0ZvckN1cnJlbnRNb3ZhYmxlKHgsIHksIHR5cGUpOwogICAgICBfX3BvaW50ZXJEb3duKHgsIHkpOwogICAgfQogIH0pOwp9KTsKCmZ1bmN0aW9uIF9fcG9pbnRlckRvd24oeCwgeSkgewogIGlmIChjdXJyZW50TW92YWJsZSkgewogICAgaWYgKGN1cnJlbnRNb3ZhYmxlIGluc3RhbmNlb2YgU2hhcGUpIHsKICAgICAgLy8gZG9uJ3QgZG8gYW55dGhpbmcgc3BlY2lhbC4KICAgIH0gZWxzZSB7CiAgICAgIGN1cnJlbnRNb3ZhYmxlLl9keCA9IGN1cnJlbnRNb3ZhYmxlLnggLSB4OwogICAgICBjdXJyZW50TW92YWJsZS5fZHkgPSBjdXJyZW50TW92YWJsZS55IC0geTsKICAgIH0KICB9CiAgaWYgKHR5cGVvZiBwb2ludGVyRG93biAhPT0gYHVuZGVmaW5lZGApIHBvaW50ZXJEb3duKHgsIHkpOwp9CgpbYHRvdWNoZW5kYCwgYG1vdXNldXBgXS5mb3JFYWNoKCh0eXBlKSA9PiB7CiAgX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCAoZXZ0KSA9PiB7CiAgICBpZiAoX19maW5pc2hlZF9zZXR1cCkgewogICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICBjb25zdCB7IG9mZnNldFgsIG9mZnNldFkgfSA9IF9fdG9Qb2ludGVyRXZlbnQoZXZ0KTsKICAgICAgY29uc3QgeyB4LCB5IH0gPSBzY3JlZW5Ub1dvcmxkKG9mZnNldFgsIG9mZnNldFkpOwogICAgICBPYmplY3QuYXNzaWduKHBvaW50ZXIsIHsKICAgICAgICB4LAogICAgICAgIHksCiAgICAgICAgdHlwZSwKICAgICAgICBkb3duOiBmYWxzZSwKICAgICAgICBtYXJrOiBmYWxzZSwKICAgICAgICBkcmFnOiBmYWxzZSwKICAgICAgfSk7CiAgICAgIF9fcG9pbnRlclVwKHgsIHkpOwogICAgfQogIH0pOwp9KTsKCmZ1bmN0aW9uIF9fcG9pbnRlclVwKHgsIHkpIHsKICBpZiAodHlwZW9mIHBvaW50ZXJVcCAhPT0gYHVuZGVmaW5lZGApIHBvaW50ZXJVcCh4LCB5KTsKICBpZiAocG9pbnRlci5tYXJrPy54ID09PSB4ICYmIHBvaW50ZXIubWFyaz8ueSA9PT0geSkgewogICAgaWYgKHR5cGVvZiBwb2ludGVyQ2xpY2sgIT09IGB1bmRlZmluZWRgKSBwb2ludGVyQ2xpY2soeCwgeSk7CiAgfQogIGlmIChjdXJyZW50TW92YWJsZSAmJiBjdXJyZW50TW92YWJsZSBpbnN0YW5jZW9mIFNoYXBlKSB7CiAgICBjdXJyZW50TW92YWJsZS5jb21taXQoKTsKICB9Cn0KCltgdG91Y2htb3ZlYCwgYG1vdXNlbW92ZWBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChldnQpID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGNvbnN0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gX190b1BvaW50ZXJFdmVudChldnQpOwogICAgICBjb25zdCB7IHgsIHkgfSA9IHNjcmVlblRvV29ybGQob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwgeyB4LCB5LCB0eXBlIH0pOwogICAgICBpZiAoIXBvaW50ZXIuZG93bikgX19jaGVja0ZvckN1cnJlbnRNb3ZhYmxlKHgsIHksIHR5cGUpOwogICAgICBfX3BvaW50ZXJNb3ZlKHgsIHkpOwogICAgfQogIH0pOwp9KTsKCmZ1bmN0aW9uIF9fcG9pbnRlck1vdmUoeCwgeSkgewogIGxldCBoYWRNb3ZhYmxlID0gZmFsc2U7CiAgaWYgKHBvaW50ZXIuZG93biAmJiBjdXJyZW50TW92YWJsZSkgewogICAgaWYgKGN1cnJlbnRNb3ZhYmxlIGluc3RhbmNlb2YgU2hhcGUpIHsKICAgICAgY3VycmVudE1vdmFibGUub2Zmc2V0KHggLSBwb2ludGVyLm1hcmsueCwgeSAtIHBvaW50ZXIubWFyay55KTsKICAgIH0gZWxzZSBpZiAoY3VycmVudE1vdmFibGVbMF0pIHsKICAgICAgY3VycmVudE1vdmFibGVbMF0gPSB4ICsgY3VycmVudE1vdmFibGUuX2R4OwogICAgICBjdXJyZW50TW92YWJsZVsxXSA9IHkgKyBjdXJyZW50TW92YWJsZS5fZHk7CiAgICB9IGVsc2UgewogICAgICBjdXJyZW50TW92YWJsZS54ID0geCArIGN1cnJlbnRNb3ZhYmxlLl9keDsKICAgICAgY3VycmVudE1vdmFibGUueSA9IHkgKyBjdXJyZW50TW92YWJsZS5fZHk7CiAgICB9CiAgICBjdXJyZW50TW92YWJsZS5fX29uX21vdmU/LigpOwogICAgaGFkTW92YWJsZSA9IHRydWU7CiAgfQoKICBwb2ludGVyLmRyYWcgPSBwb2ludGVyLmRvd247CgogIGlmIChwb2ludGVyLmRyYWcgJiYgdHlwZW9mIHBvaW50ZXJEcmFnICE9PSBgdW5kZWZpbmVkYCkgewogICAgcG9pbnRlckRyYWcoeCwgeSk7CiAgfQoKICBpZiAodHlwZW9mIHBvaW50ZXJNb3ZlICE9PSBgdW5kZWZpbmVkYCkgewogICAgcG9pbnRlck1vdmUoeCwgeSk7CiAgfQoKICBpZiAoaGFkTW92YWJsZSAmJiAhcGxheWluZykgcmVkcmF3KCk7Cn0KCltgdG91Y2hzdGFydGAsIGBtb3VzZWVudGVyYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKCkgPT4gewogICAgcG9pbnRlci5hY3RpdmUgPSB0cnVlOwogICAgX19wb2ludGVyQWN0aXZlKHRydWUpOwogIH0pOwp9KTsKCltgdG91Y2hlbmRgLCBgbW91c2VsZWF2ZWBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsICgpID0+IHsKICAgIF9fcG9pbnRlckFjdGl2ZShmYWxzZSk7CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyQWN0aXZlKGFjdGl2ZSkgewogIGlmICh0eXBlb2YgcG9pbnRlckFjdGl2ZSAhPT0gYHVuZGVmaW5lZGApIHsKICAgIHBvaW50ZXJBY3RpdmUoYWN0aXZlKTsKICB9Cn0KY29uc3QgX19BQlNUUkFDVF9QUk9KRUNUT1IgPSBTeW1ib2woYGFic3RyYWN0IHByb2plY3RvciBzdXBlcmNsYXNzYCk7CgovLyBHZW5lcmljIHByb2plY3RvciBzdXBlcmNsYXNzCmNsYXNzIFByb2plY3RvciB7CiAgLy8gYXhpYWwgYW5nbGVzIG9mIHJvdGF0aW9uCiAgWCA9IDA7CiAgWSA9IDA7CiAgWiA9IDA7CgogIC8vICJpbmZpbml0eSBsaWVzIGF0IGRpc3RhbmNlOiAuLi4iCiAgaW5maW5pdHkgPSBJbmZpbml0eTsKCiAgdHlwZSA9IF9fQUJTVFJBQ1RfUFJPSkVDVE9SOwoKICBzZXRJbmZpbml0eSgpIHsKICAgIC8vIGRvZXMgbm90aGluZyBieSBkZWZhdWx0CiAgfQoKICBzZXRSb3RhdGlvbih4ID0gMCwgeSA9IDAsIHogPSAwKSB7CiAgICB0aGlzLlggPSB4OwogICAgdGhpcy5aID0gejsKICAgIHRoaXMuWSA9IHk7CiAgfQoKICBUeCA9IDA7CiAgVHkgPSAwOwogIFR6ID0gMDsKCiAgc2V0VHJhbnNsYXRpb24oeCA9IDAsIHkgPSAwLCB6ID0gMCkgewogICAgdGhpcy5UeCA9IHg7CiAgICB0aGlzLlR6ID0gejsKICAgIHRoaXMuVHkgPSB5OwogIH0KCiAgU3ggPSAxOwogIFN5ID0gMTsKICBTeiA9IDE7CgogIHNldFNjYWxlKHggPSAxLCB5LCB6KSB7CiAgICBpZiAoeCAmJiAheSAmJiAheikgewogICAgICB6ID0geSA9IHg7CiAgICB9CiAgICB0aGlzLlN4ID0geDsKICAgIHRoaXMuU3ogPSB6OwogICAgdGhpcy5TeSA9IHk7CiAgfQoKICBwcm9qZWN0KHgsIHksIHopIHsKICAgIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyBpbXBsZW1lbnRhdGlvbiBmb3IgcHJvamVjdCh4LHkseikhYCk7CiAgfQp9CgovKioKICogY29kZSB1c2VkIGJ5IHByb2plY3QuanMsIGJ1dCBuYW1lZCBzbyB0aGF0IGl0IGxvYWRzCiAqIGZpcnN0LCBhbmQgZG9lcyBub3QgZ2V0IGFkZGVkIHRvIHRoZSBkLnRzIGZpbGUuCiAqLwpjbGFzcyBDYWJpbmV0UHJvamVjdG9yIGV4dGVuZHMgUHJvamVjdG9yIHsKICB0eXBlID0gQ0FCSU5FVDsKICBwaGkgPSAtUEkgLyA2OwoKICBzZXRQaGkocGhpKSB7CiAgICB0aGlzLnBoaSA9IHBoaTsKICB9CgogIHByb2plY3QoeCwgeSwgeikgewogICAgY29uc3QgeyBYLCBZLCBaLCBUeCwgVHksIFN4LCBTeSwgU3osIHBoaSB9ID0gdGhpczsKICAgIFt4LCB5LCB6XSA9IHRoaXMucm90YXRlKFgsIFksIFosIHggKiBTeCwgeSAqIFN5LCB6ICogU3opOwogICAgY29uc3QgYSA9IHk7CiAgICBjb25zdCBiID0gLXo7CiAgICBjb25zdCBjID0gLXggLyAyOwogICAgcmV0dXJuIG5ldyBQb2ludChUeCArIGEgKyBjICogY29zKHBoaSksIFR5ICsgYiArIGMgKiBzaW4ocGhpKSk7CiAgfQoKICByb3RhdGUoWCwgWSwgWiwgeCwgeSwgeikgewogICAgbGV0IFtBLCBCLCBDXSA9IFstWCwgLVksIFpdOwogICAgbGV0IGEgPSB4OwogICAgbGV0IGIgPSB5ICogY29zKEEpIC0geiAqIHNpbihBKTsKICAgIGxldCBjID0geSAqIHNpbihBKSArIHogKiBjb3MoQSk7CiAgICB4ID0gYTsKICAgIHkgPSBiOwogICAgeiA9IGM7CiAgICBhID0geCAqIGNvcyhCKSArIHogKiBzaW4oQik7CiAgICBiID0geTsKICAgIGMgPSB4ICogLXNpbihCKSArIHogKiBjb3MoQik7CiAgICB4ID0gYTsKICAgIHkgPSBiOwogICAgeiA9IGM7CiAgICBhID0geCAqIGNvcyhDKSAtIHkgKiBzaW4oQyk7CiAgICBiID0geCAqIHNpbihDKSArIHkgKiBjb3MoQyk7CiAgICBjID0gejsKCiAgICByZXR1cm4gW2EsIGIsIGNdOwogIH0KfQoKLyoqCiAqIGNvZGUgdXNlZCBieSBwcm9qZWN0LmpzLCBidXQgbmFtZWQgc28gdGhhdCBpdCBsb2FkcwogKiBmaXJzdCwgYW5kIGRvZXMgbm90IGdldCBhZGRlZCB0byB0aGUgZC50cyBmaWxlLgogKi8KY2xhc3MgSG9tb2dlbmVvdXNQcm9qZWN0b3IgZXh0ZW5kcyBQcm9qZWN0b3IgewogIHR5cGUgPSBIT01PR0VORU9VUzsKCiAgLy8gZWZmZWN0IGEgZGVmYXVsdCBwcm9qZWN0aW9uIHNpbWlsYXIgKGVub3VnaCkgdG8KICAvLyB0aGUgZGVmYXVsdCBjYWJpbmV0IHByb2plY3Rpb24KICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLnNldEluZmluaXR5KDIwMCk7CiAgICB0aGlzLnNldFJvdGF0aW9uKDAsIDAsIC0wLjM1KTsKICB9CgogIHNldEluZmluaXR5KGQpIHsKICAgIHRoaXMuaW5maW5pdHkgPSBkOwogIH0KCiAgcHJvamVjdCh4LCB5LCB6KSB7CiAgICBjb25zdCB7IFgsIFksIFosIGluZmluaXR5OiBkLCBUeCwgVHksIFR6LCBTeCwgU3ksIFN6IH0gPSB0aGlzOwogICAgY29uc3QgW1Z4LCBWeSwgVnpdID0gWyh5IC0gVHkpICogU3ksICgteiAtIFR6KSAqIFN6LCAoeCAtIFR4KSAqIFN4XTsKICAgIGNvbnN0IFtBLCBCLCBDXSA9IFtYLCBaLCBZXTsKCiAgICBjb25zdCBjeSA9IGNvcyhBKTsKICAgIGNvbnN0IHN5ID0gc2luKEEpOwogICAgY29uc3QgY3AgPSBjb3MoQik7CiAgICBjb25zdCBzcCA9IHNpbihCKTsKICAgIGNvbnN0IGNyID0gY29zKEMpOwogICAgY29uc3Qgc3IgPSBzaW4oQyk7CgogICAgLy8gcHJldHRpZXItaWdub3JlCiAgICAvLyBob21vZ2Vub3VzIGFmZmluZSB0cmFuc2Zvcm0gbWF0cml4CiAgICBjb25zdCBNID0gWwogICAgICAgY3AgKiBjeSwgKGN5ICogc3AgKiBzciAtIGNyICogc3kpLCAoY3IgKiBjeSAqIHNwICsgc3IgKiBzeSksIDAsCiAgICAgICBjcCAqIHN5LCAoY3IgKiBjeSArIHNwICogc3IgKiBzeSksIChjciAqIHNwICogc3kgLSBjeSAqIHNyKSwgMCwKICAgICAgLXNwLCAgICAgIGNwICogc3IsICAgICAgICAgICAgICAgICAgY3AgKiBjciwgICAgICAgICAgICAgICAgICAwLAogICAgICAgc3AgLyBkLCAtY3AgKiBzciAvIGQsICAgICAgICAgICAgIC1jcCAqIGNyIC8gZCwgICAgICAgICAgICAgIDEsCiAgICBdOwoKICAgIC8vIHByZXR0aWVyLWlnbm9yZQogICAgLy8gaG9tb2dlbmVvdXMgdHJhbnNmb3JtZWQgaW5wdXQgdmVjdG9yCiAgICBjb25zdCBbcHgsIHB5LCBfcHosIHddID0gWwogICAgICBWeCAqIE1bIDBdICsgVnkgKiBNWyAxXSArIFZ6ICogTVsgMl0gKyBNWyAzXSwKICAgICAgVnggKiBNWyA0XSArIFZ5ICogTVsgNV0gKyBWeiAqIE1bIDZdICsgTVsgN10sCjAsIC8vIFZ4ICogTVsgOF0gKyBWeSAqIE1bIDldICsgVnogKiBNWzEwXSArIE1bMTFdLCAvLyB3ZSBkb24ndCBhY3R1YWxseSB1c2UgegogICAgICBWeCAqIE1bMTJdICsgVnkgKiBNWzEzXSArIFZ6ICogTVsxNF0gKyBNWzE1XSwKICAgIF0KCiAgICAvLyBzY3JlZW4gY29vcmRpbmF0ZQogICAgcmV0dXJuIG5ldyBQb2ludChweCAvIHcsIHB5IC8gdyk7CiAgfQp9Ci8qKgogKiAuLi5kb2NzIGdvIGhlcmUuLi4KICovCmNsYXNzIFNoYXBlIHsKICBzZWdtZW50cyA9IFtdOwogIHJlc2l6YWJsZSA9IGZhbHNlOwogIGRpcnR5ID0gdHJ1ZTsKICBveCA9IDA7CiAgb3kgPSAwOwoKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMucGF0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhgaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdgLCBgcGF0aGApOwogICAgdGhpcy5uZXdTZWdtZW50KCk7CiAgfQoKICBtYWtlTW92YWJsZShtb3ZhYmxlID0gdHJ1ZSkgewogICAgaWYgKG1vdmFibGUpIHsKICAgICAgc2V0TW92YWJsZSh0aGlzKTsKICAgIH0gZWxzZSB7CiAgICAgIHVuc2V0TW92YWJsZSh0aGlzKTsKICAgIH0KICB9CgogIGFsbG93UmVzaXppbmcoYWxsb3dlZCA9IHRydWUpIHsKICAgIHRoaXMucmVzaXphYmxlID0gYWxsb3dlZDsKICB9CgogIGNsb3NlKCkgewogICAgdGhpcy5uZXdTZWdtZW50KHRydWUpOwogIH0KCiAgbmV3U2VnbWVudChjbG9zZUN1cnJlbnQgPSBmYWxzZSkgewogICAgY29uc3QgeyBzZWdtZW50cyB9ID0gdGhpczsKICAgIGlmIChzZWdtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHNlZ21lbnRzLnB1c2gobmV3IFNlZ21lbnQoKSk7CiAgICB9CiAgICBjb25zdCBjdXJyZW50ID0gc2VnbWVudHMuYXQoLTEpOwogICAgaWYgKGN1cnJlbnQ/LnBvaW50cy5sZW5ndGggfHwgY3VycmVudD8uaW5zdHJ1Y3Rpb25zLmxlbmd0aCkgewogICAgICBpZiAoY2xvc2VDdXJyZW50KSBjdXJyZW50LmNsb3NlKCk7CiAgICAgIHNlZ21lbnRzLnB1c2gobmV3IFNlZ21lbnQoKSk7CiAgICB9CiAgfQoKICBhZGQoeCwgeSkgewogICAgY29uc3Qgc2VnbWVudCA9IHRoaXMuc2VnbWVudHMuYXQoLTEpOwogICAgbGV0IHB0czsKICAgIGlmIChzZWdtZW50Lmluc3RydWN0aW9ucy5sZW5ndGgpIHsKICAgICAgcHRzID0gc2VnbWVudC5saW5lVG8oeCwgeSk7CiAgICB9IGVsc2UgewogICAgICBwdHMgPSBzZWdtZW50Lm1vdmVUbyh4LCB5KTsKICAgIH0KICAgIHRoaXMucmVjb3JkUG9pbnRzKHB0cyk7CiAgfQoKICByZWNvcmRQb2ludHMocHRzKSB7CiAgICBjb25zdCBzZWdtZW50ID0gdGhpcy5zZWdtZW50cy5hdCgtMSk7CiAgICBpZiAodGhpcy5yZXNpemFibGUpIHsKICAgICAgcHRzLmZvckVhY2goKHApID0+IHsKICAgICAgICBwLl9fb25fbW92ZSA9ICgpID0+IHsKICAgICAgICAgIHNlZ21lbnQuaW52YWxpZGF0ZSgpOwogICAgICAgIH07CiAgICAgICAgc2V0TW92YWJsZShwKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICBtb3ZlVG8oeCwgeSkgewogICAgdGhpcy5uZXdTZWdtZW50KCk7CiAgICB0aGlzLnJlY29yZFBvaW50cyh0aGlzLnNlZ21lbnRzLmF0KC0xKS5tb3ZlVG8oeCwgeSkpOwogIH0KCiAgbGluZVRvKC4uLmFyZ3MpIHsKICAgIHRoaXMucmVjb3JkUG9pbnRzKHRoaXMuc2VnbWVudHMuYXQoLTEpPy5saW5lVG8oLi4uYXJncykpOwogIH0KCiAgY3VydmVUbyguLi5hcmdzKSB7CiAgICB0aGlzLnJlY29yZFBvaW50cyh0aGlzLnNlZ21lbnRzLmF0KC0xKT8uY3VydmVUbyguLi5hcmdzKSk7CiAgfQoKICBxdWFkVG8oLi4uYXJncykgewogICAgdGhpcy5yZWNvcmRQb2ludHModGhpcy5zZWdtZW50cy5hdCgtMSk/LnF1YWRUbyguLi5hcmdzKSk7CiAgfQoKICBzcGxpbmVUbyguLi5hcmdzKSB7CiAgICB0aGlzLnJlY29yZFBvaW50cyh0aGlzLnNlZ21lbnRzLmF0KC0xKT8uc3BsaW5lVG8oLi4uYXJncykpOwogIH0KCiAgb2Zmc2V0KHgsIHkpIHsKICAgIHRoaXMub3ggPSB4OwogICAgdGhpcy5veSA9IHk7CiAgfQoKICBjb21taXQoKSB7CiAgICBjb25zdCB7IG94LCBveSwgc2VnbWVudHMgfSA9IHRoaXM7CiAgICBzZWdtZW50cy5mb3JFYWNoKChzKSA9PiBzLmNvbW1pdChveCwgb3kpKTsKICAgIHRoaXMucmVzZXQoKTsKICB9CgogIHJlc2V0KCkgewogICAgdGhpcy5vZmZzZXQoMCwgMCk7CiAgfQoKICBmbGlwU2VnbWVudCgpIHsKICAgIHRoaXMuc2VnbWVudHMuYXQoLTEpLmZsaXAoKTsKICB9CgogIG5vRmlsbCgpIHsKICAgIHRoaXMuc2V0RmlsbChgbm9uZWApOwogIH0KCiAgc2V0RmlsbChmaWxsKSB7CiAgICBpZiAodGhpcy5maWxsU3R5bGUgIT09IGZpbGwpIHsKICAgICAgdGhpcy5maWxsU3R5bGUgPSBmaWxsOwogICAgfQogIH0KCiAgbm9TdHJva2UoKSB7CiAgICB0aGlzLnNldFN0cm9rZShgbm9uZWApOwogIH0KCiAgc2V0U3Ryb2tlKHN0cm9rZSkgewogICAgaWYgKHRoaXMuc3Ryb2tlU3R5bGUgIT09IHN0cm9rZSkgewogICAgICB0aGlzLnN0cm9rZVN0eWxlID0gc3Ryb2tlOwogICAgfQogIH0KCiAgc2hvd1BvaW50cyhzaG93UG9pbnRzID0gdHJ1ZSkgewogICAgaWYgKHRoaXMuX19zaG93UG9pbnRzICE9PSBzaG93UG9pbnRzKSB7CiAgICAgIHRoaXMuX19zaG93UG9pbnRzID0gc2hvd1BvaW50czsKICAgIH0KICB9CgogIGFzeW5jIGRyYXcoKSB7CiAgICBjb25zdCB7IG94LCBveSwgc2VnbWVudHMsIF9fc2hvd1BvaW50cyB9ID0gdGhpczsKICAgIHNhdmUoKTsKICAgIHRyYW5zbGF0ZShveCwgb3kpOwogICAgc2V0U3Ryb2tlKHRoaXMuc3Ryb2tlU3R5bGUpOwogICAgc2V0RmlsbCh0aGlzLmZpbGxTdHlsZSk7CiAgICBzdGFydCgpOwogICAgc2VnbWVudHMuZm9yRWFjaCgocykgPT4gcy5kcmF3KCkpOwogICAgZW5kKCk7CiAgICBpZiAoX19zaG93UG9pbnRzKSBzZWdtZW50cy5mb3JFYWNoKChzKSA9PiBzLmRyYXdQb2ludHMoKSk7CiAgICB0cmFuc2xhdGUoLW94LCAtb3kpOwogICAgcmVzdG9yZSgpOwogIH0KCiAgaW5zaWRlKHgsIHkpIHsKICAgIGNvbnN0IHsgb3gsIG95LCBwYXRoLCBzZWdtZW50cyB9ID0gdGhpczsKICAgIGNvbnN0IGQgPSBzZWdtZW50cy5tYXAoKHMpID0+IHMuZ2V0UGF0aCgpKS5qb2luKGAgYCk7CiAgICBwYXRoLnNldEF0dHJpYnV0ZShgZGAsIGQpOwogICAgLy8gT2ggZm9yIGZ1Y2sncyBzYWtlLCBDaHJvbWUsIGhvdyBoYXJkIGlzIGl0IHRvIGtlZXAgdXAgd2l0aCBhIHN0YW5kYXJkCiAgICAvLyB0aGF0IHlvdSdyZSBhbiBlZGl0b3IgZm9yPyBodHRwczovL2lzc3Vlcy5jaHJvbWl1bS5vcmcvaXNzdWVzLzQwNTcyODg3CiAgICAvLyBjb25zdCBwID0gbmV3IERPTVBvaW50KHggLSBveCwgeSAtIG95KTsKICAgIC8vIGlmIChwYXRoLmlzUG9pbnRJbkZpbGwocCkpIHJldHVybiB0cnVlOwogICAgLy8gaWYgKHBhdGguaXNQb2ludEluU3Ryb2tlKHApKSByZXR1cm4gdHJ1ZTsKICAgIGNvbnN0IHAgPSBuZXcgUGF0aDJEKHBhdGgpOwogICAgaWYgKF9fY3R4LmlzUG9pbnRJblBhdGgocCwgeCAtIG94LCB5IC0gb3kpKSByZXR1cm4gdHJ1ZTsKICAgIGlmIChfX2N0eC5pc1BvaW50SW5TdHJva2UocCwgeCAtIG94LCB5IC0gb3kpKSByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiBmYWxzZTsKICB9Cn0KCi8qKgogKiAuLi5kb2NzIGdvIGhlcmUuLi4KICovCmNsYXNzIFNlZ21lbnQgewogIHBvaW50cyA9IFtdOwogIGluc3RydWN0aW9ucyA9IFtdOwoKICBjbG9zZWQgPSBmYWxzZTsKICBzdmdfZCA9IGBgOwoKICBhZGQoeCwgeSkgewogICAgY29uc3QgeyBjbG9zZWQsIHBvaW50cyB9ID0gdGhpczsKICAgIGlmIChjbG9zZWQpIHJldHVybjsKICAgIGNvbnN0IHAgPSB7IHgsIHkgfTsKICAgIHBvaW50cy5wdXNoKHApOwogICAgcmV0dXJuIHA7CiAgfQoKICBjb21taXQoeCwgeSkgewogICAgdGhpcy5pbnN0cnVjdGlvbnMuZm9yRWFjaCgocCkgPT4gewogICAgICBwLnggKz0geDsKICAgICAgcC55ICs9IHk7CiAgICB9KTsKICAgIHRoaXMuaW52YWxpZGF0ZSgpOwogIH0KCiAgZmxpcCgpIHsKICAgIGNvbnN0IHsgaW5zdHJ1Y3Rpb25zIH0gPSB0aGlzOwogICAgaW5zdHJ1Y3Rpb25zLnJldmVyc2UoKTsKICAgIC8vIHJlbWVtYmVyIHRvIHJlbG9jYXRlIG91ciBtb3ZlVG8hCiAgICBpbnN0cnVjdGlvbnMudW5zaGlmdChpbnN0cnVjdGlvbnMucG9wKCkpOwogICAgdGhpcy5pbnZhbGlkYXRlKCk7CiAgfQoKICAjaW5zdHJ1Y3Rpb24odHlwZU5hbWUsIC4uLmFyZ3MpIHsKICAgIGxldCBwb2ludHMgPSBhcmdzOwoKICAgIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gYG51bWJlcmApIHsKICAgICAgcG9pbnRzID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkgKz0gMikgewogICAgICAgIHBvaW50cy5wdXNoKHsgeDogYXJnc1tpXSwgeTogYXJnc1tpICsgMV0gfSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBzZWUgZHJhdy5zcGxpbmUoLi4uYXJncykKICAgIGxldCBUID0gMTsKICAgIGlmICh0eXBlTmFtZSA9PT0gYHNwbGluZWApIHsKICAgICAgaWYgKGFyZ3MubGVuZ3RoICUgMiA9PT0gMSkgewogICAgICAgIFtUXSA9IGFyZ3Muc3BsaWNlKGFyZ3MubGVuZ3RoIC0gMSwgMSk7CiAgICAgICAgcG9pbnRzLnBvcCgpOwogICAgICB9CiAgICB9CgogICAgcG9pbnRzLmZvckVhY2goKHApID0+IHsKICAgICAgcFt0eXBlTmFtZV0gPSB0cnVlOwogICAgICBpZiAodHlwZU5hbWUgPT09IGBzcGxpbmVgKSBwLlQgPSBUOwogICAgICB0aGlzLmluc3RydWN0aW9ucy5wdXNoKHApOwogICAgfSk7CgogICAgdGhpcy5pbnZhbGlkYXRlKCk7CiAgICByZXR1cm4gcG9pbnRzOwogIH0KCiAgbW92ZVRvKHgsIHkpIHsKICAgIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgICB5ID0geC55OwogICAgICB4ID0geC54OwogICAgfQogICAgcmV0dXJuIHRoaXMuI2luc3RydWN0aW9uKGBtb3ZlYCwgeCwgeSk7CiAgfQoKICBsaW5lVG8oLi4uYXJncykgewogICAgcmV0dXJuIHRoaXMuI2luc3RydWN0aW9uKGBsaW5lYCwgLi4uYXJncyk7CiAgfQoKICBjdXJ2ZVRvKC4uLmFyZ3MpIHsKICAgIHJldHVybiB0aGlzLiNpbnN0cnVjdGlvbihgYmV6aWVyYCwgLi4uYXJncyk7CiAgfQoKICBxdWFkVG8oLi4uYXJncykgewogICAgcmV0dXJuIHRoaXMuI2luc3RydWN0aW9uKGBxdWFkYCwgLi4uYXJncyk7CiAgfQoKICBzcGxpbmVUbyguLi5hcmdzKSB7CiAgICByZXR1cm4gdGhpcy4jaW5zdHJ1Y3Rpb24oYHNwbGluZWAsIC4uLmFyZ3MpOwogIH0KCiAgY2xvc2UoKSB7CiAgICB0aGlzLmNsb3NlZCA9IHRydWU7CiAgICB0aGlzLmludmFsaWRhdGUoKTsKICB9CgogIGludmFsaWRhdGUoKSB7CiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICB9CgogIGNoZWNrRGlydHkoKSB7CiAgICBpZiAodGhpcy5kaXJ0eSB8fCAhdGhpcy53aXRob3V0U3BsaW5lcykgewogICAgICB0aGlzLnVwZGF0ZVNWRygpOwogICAgICB0aGlzLndpdGhvdXRTcGxpbmVzID0gdGhpcy5pbnN0cnVjdGlvbnMuc2xpY2UoKTsKICAgICAgdGhpcy5yZXBsYWNlU3BsaW5lV2l0aEJlemllcnModGhpcy53aXRob3V0U3BsaW5lcyk7CiAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgIH0KICB9CgogIGRyYXcoKSB7CiAgICB0aGlzLmNoZWNrRGlydHkoKTsKICAgIGNvbnN0IG9wcyA9IHRoaXMud2l0aG91dFNwbGluZXMuc2xpY2UoKTsKCiAgICBjb25zdCBiMiA9ICh0LCBhLCBiLCBjKSA9PiB7CiAgICAgIGNvbnN0IG10ID0gMSAtIHQ7CiAgICAgIHJldHVybiBhICogbXQgKiogMiArIDIgKiBiICogbXQgKiB0ICsgYyAqIHQgKiogMjsKICAgIH07CgogICAgY29uc3QgYjMgPSAodCwgYSwgYiwgYywgZCkgPT4gewogICAgICBjb25zdCBtdCA9IDEgLSB0OwogICAgICByZXR1cm4gKAogICAgICAgIGEgKiBtdCAqKiAzICsgMyAqIGIgKiBtdCAqKiAyICogdCArIDMgKiBjICogbXQgKiB0ICoqIDIgKyBkICogdCAqKiAzCiAgICAgICk7CiAgICB9OwoKICAgIGNvbnN0IHZ0eCA9IChwKSA9PiB7CiAgICAgIHZlcnRleChwLngsIHAueSk7CiAgICB9OwoKICAgIGNvbnN0IFtmaXJzdF0gPSB0aGlzLmluc3RydWN0aW9uczsKICAgIGxldCBsYXN0OwogICAgd2hpbGUgKG9wcy5sZW5ndGgpIHsKICAgICAgY29uc3QgcCA9IG9wcy5zaGlmdCgpOwogICAgICBpZiAocC5tb3ZlKSB7CiAgICAgICAgX19jdHgubW92ZVRvKHAueCwgcC55KTsKICAgICAgfQogICAgICBpZiAocC5tb3ZlIHx8IHAubGluZSkgewogICAgICAgIHZ0eChwKTsKICAgICAgICBsYXN0ID0gcDsKICAgICAgfQogICAgICBpZiAocC5xdWFkKSB7CiAgICAgICAgY29uc3QgbiA9IG9wcy5zaGlmdCgpOwogICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgMTsgdCArPSAwLjA1KSB7CiAgICAgICAgICB2dHgoeyB4OiBiMih0LCBsYXN0LngsIHAueCwgbi54KSwgeTogYjIodCwgbGFzdC55LCBwLnksIG4ueSkgfSk7CiAgICAgICAgfQogICAgICAgIHZ0eChuKTsKICAgICAgICBsYXN0ID0gbjsKICAgICAgfQogICAgICBpZiAocC5iZXppZXIpIHsKICAgICAgICBjb25zdCBuID0gb3BzLnNoaWZ0KCk7CiAgICAgICAgY29uc3QgbjIgPSBvcHMuc2hpZnQoKTsKICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IDE7IHQgKz0gMC4wMykgewogICAgICAgICAgdnR4KHsKICAgICAgICAgICAgeDogYjModCwgbGFzdC54LCBwLngsIG4ueCwgbjIueCksCiAgICAgICAgICAgIHk6IGIzKHQsIGxhc3QueSwgcC55LCBuLnksIG4yLnkpLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHZ0eChuMik7CiAgICAgICAgbGFzdCA9IG4yOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5jbG9zZWQpIHZ0eChmaXJzdCk7CiAgfQoKICBkcmF3UG9pbnRzKCkgewogICAgZm9yIChsZXQgcCBvZiB0aGlzLmluc3RydWN0aW9ucykgcG9pbnQocCk7CiAgfQoKICBnZXRQYXRoKCkgewogICAgdGhpcy5jaGVja0RpcnR5KCk7CiAgICByZXR1cm4gdGhpcy5zdmdfZDsKICB9CgogIHVwZGF0ZVNWRygpIHsKICAgIGxldCBkID0gYGA7CiAgICBjb25zdCBvcHMgPSB0aGlzLmluc3RydWN0aW9ucy5zbGljZSgpOwogICAgdGhpcy5yZXBsYWNlU3BsaW5lV2l0aEJlemllcnMob3BzKTsKICAgIHdoaWxlIChvcHMubGVuZ3RoKSB7CiAgICAgIGNvbnN0IHAgPSBvcHMuc2hpZnQoKTsKICAgICAgaWYgKHAubW92ZSkgZCA9IGBNICR7cC54fSAke3AueX1gOwogICAgICBpZiAocC5saW5lKSBkID0gYCR7ZH0gTCAke3AueH0gJHtwLnl9YDsKICAgICAgaWYgKHAucXVhZCkgewogICAgICAgIGNvbnN0IG9wID0gb3BzLnNoaWZ0KCk7CiAgICAgICAgZCA9IGAke2R9IFEgJHtwLnh9ICR7cC55fSAke29wLnh9ICR7b3AueX1gOwogICAgICB9CiAgICAgIGlmIChwLmJlemllcikgewogICAgICAgIGNvbnN0IG9wMiA9IG9wcy5zaGlmdCgpOwogICAgICAgIGNvbnN0IG9wMyA9IG9wcy5zaGlmdCgpOwogICAgICAgIGQgPSBgJHtkfSBDICR7cC54fSAke3AueX0gJHtvcDIueH0gJHtvcDIueX0gJHtvcDMueH0gJHtvcDMueX1gOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5jbG9zZWQpIGQgKz0gYCBaYDsKICAgIHRoaXMuc3ZnX2QgPSBkOwogIH0KCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIC8vIENvZGUgKmp1c3QqIGZvciBjb252ZXJ0aW5nIGNhcmRpbmFsIHNwbGluZXMgaW50byBwb2x5LUJlemllcnMKICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogIHJlcGxhY2VTcGxpbmVXaXRoQmV6aWVycyhvcHMpIHsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChvcHNbaV0uc3BsaW5lKSB7CiAgICAgICAgdGhpcy5jb252ZXJ0U3BsaW5lKG9wcywgaSk7CiAgICAgIH0KICAgIH0KICB9CgogIGNvbnZlcnRTcGxpbmUob3BzLCBpKSB7CiAgICBjb25zdCBzcGxpbmVzID0gW107CiAgICAvLyByZW1vdmUgdGhlIHNlcXVlbmNlIG9mIHNwbGluZSBwb2ludHMgc3RhcnRpbmcgYXQgb3BzW2ldCiAgICB3aGlsZSAob3BzW2ldICYmIG9wc1tpXS5zcGxpbmUpIHNwbGluZXMucHVzaChvcHMuc3BsaWNlKGksIDEpWzBdKTsKICAgIC8vIGluamVjdCB0aGUgZXF1aXZhbGVudCBiZXppZXIgc2VxdWVuY2UKICAgIG9wcy5zcGxpY2UoaSwgMCwgLi4udGhpcy5zcGxpbmVQb2ludHNUb0JlemllclBvaW50cyhzcGxpbmVzLCBvcHMsIGkpKTsKICB9CgogIHNwbGluZVBvaW50c1RvQmV6aWVyUG9pbnRzKHNwbGluZXMsIG9wcywgaSkgewogICAgbGV0IGJlemllcnMgPSBbXTsKICAgIGxldCBxMSA9IG9wcy5hdChpIC0gMik7CiAgICBsZXQgcTIgPSBvcHMuYXQoaSAtIDEpOwogICAgbGV0IHEzLCBxNDsKICAgIGxldCBwID0gc3BsaW5lc1swXTsKCiAgICAvLyBUaGUgZmlyc3QgIHNlZ21lbnQgbmVlZHMgc3BlY2lhbCBoYW5kbGluZyB0bwogICAgLy8gZW5zdXJlIHRoZSBkZXBhcnR1cmUgdGFuZ2VudCBpcyBjb3JyZWN0LgogICAgcTMgPSBzcGxpbmVzWzFdID8/IG9wc1tpXSA/PyBvcHNbMF07CiAgICBiZXppZXJzLnB1c2goLi4udGhpcy5maXJzdFNwbGluZVRvQmV6aWVyKHExLCBxMiwgcCwgcTMpKTsKCiAgICAvLyBJbnRlcm1lZGlhdGUgc2VnbWVudHMgYXJlICJub3JtYWwgY29udmVyc2lvbiBtYXRoIi4KICAgIGZvciAobGV0IGogPSAxOyBqIDwgc3BsaW5lcy5sZW5ndGg7IGorKykgewogICAgICBxMSA9IHEyOwogICAgICBxMiA9IHA7CiAgICAgIHAgPSBzcGxpbmVzW2pdOwogICAgICBxMyA9IHNwbGluZXNbaiArIDFdID8/IG9wc1tpXSA/PyBvcHNbMF07CiAgICAgIGJlemllcnMucHVzaCguLi50aGlzLmZ1bGxTcGxpbmVUb0JlemllcihxMSwgcTIsIHAsIHEzKSk7CiAgICB9CgogICAgLy8gVGhlIGxhc3Qgc2VnbWVudCBuZWVkcyBzcGVjaWFsIGhhbmRsaW5nIHRvCiAgICAvLyBlbnN1cmUgdGhlIGFycml2YWwgdGFuZ2VudCBpcyBjb3JyZWN0LgogICAgcTMgPSBvcHNbaV0gPz8gb3BzWzBdOwogICAgcTQgPSBvcHNbaSArIDFdID8/IG9wc1sxXTsKICAgIGJlemllcnMucHVzaCguLi50aGlzLmxhc3RTcGxpbmVUb0JlemllcihxMiwgcCwgcTMsIHE0KSk7CgogICAgcmV0dXJuIGJlemllcnM7CiAgfQoKICAvLyBwMyBpcyBvdXIgcHJpbmNpcGFsIHBvaW50CiAgZmlyc3RTcGxpbmVUb0JlemllcihwMSwgcDIsIHAzLCBwNCkgewogICAgLy8gUmVwb3NpdGlvbiBwMSBzbyB0aGF0IHRoZSB0YW5nZW50IGF0CiAgICAvLyBwMiB3aWxsIG1hdGNoIHRoZSBhY3R1YWwgdGFuZ2VudCBhdCBwMi4KICAgIHAxID0gdGhpcy51cGRhdGVGcm9tVGFuZ2VudChwMSwgcDIsIHAzKTsKICAgIHJldHVybiB0aGlzLmZ1bGxTcGxpbmVUb0JlemllcihwMSwgcDIsIHAzLCBwNCk7CiAgfQoKICAvLyBwMiBpcyBvdXIgcHJpbmNpcGFsIHBvaW50CiAgbGFzdFNwbGluZVRvQmV6aWVyKHAxLCBwMiwgcDMsIHA0KSB7CiAgICAvLyBSZXBvc2l0aW9uIHA0IHNvIHRoYXQgdGhlIHRhbmdlbnQgYXQKICAgIC8vIHAzIHdpbGwgbWF0Y2ggdGhlIGFjdHVhbCB0YW5nZW50IGF0IHAzLgogICAgcDQgPSB0aGlzLnVwZGF0ZUZyb21UYW5nZW50KHA0LCBwMywgcDIpOwogICAgcmV0dXJuIHRoaXMuZnVsbFNwbGluZVRvQmV6aWVyKHAxLCBwMiwgcDMsIHA0KTsKICB9CgogIC8vIGNyZWF0ZSB0aGUgQmV6aWVyIGVxdWl2YWxlbnQgb2YgcDItLXAzCiAgZnVsbFNwbGluZVRvQmV6aWVyKHAxLCBwMiwgcDMsIHA0KSB7CiAgICBjb25zdCBUID0gcDMuVCA/PyBwMi5UID8/IDE7CiAgICBjb25zdCB0ZW5zaW9uID0gNiAqIFQ7CiAgICByZXR1cm4gWwogICAgICB7CiAgICAgICAgYmV6aWVyOiB0cnVlLAogICAgICAgIHg6IHAyLnggKyAocDMueCAtIHAxLngpIC8gdGVuc2lvbiwKICAgICAgICB5OiBwMi55ICsgKHAzLnkgLSBwMS55KSAvIHRlbnNpb24sCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBiZXppZXI6IHRydWUsCiAgICAgICAgeDogcDMueCAtIChwNC54IC0gcDIueCkgLyB0ZW5zaW9uLAogICAgICAgIHk6IHAzLnkgLSAocDQueSAtIHAyLnkpIC8gdGVuc2lvbiwKICAgICAgfSwKICAgICAgeyBiZXppZXI6IHRydWUsIHg6IHAzLngsIHk6IHAzLnkgfSwKICAgIF07CiAgfQoKICB1cGRhdGVGcm9tVGFuZ2VudChxMSwgcTIsIHAzKSB7CiAgICAvLyBObyBtYXR0ZXIgd2hldGhlciBxMSBhbmQgcTIgYXJlIGxpbmUgb3IKICAgIC8vIGJlemllciBjb29yZGluYXRlcywgdGhlIGxvZ2ljIGlzIHRoZSBzYW1lLgogICAgcmV0dXJuIHsKICAgICAgdGFuZ2VudENvcnJlY3Rpb246IHRydWUsCiAgICAgIHg6IHAzLnggKyAocTEueCAtIHEyLngpLAogICAgICB5OiBwMy55ICsgKHExLnkgLSBxMi55KSwKICAgIH07CiAgfQp9CmNsYXNzIFZlY3RvciB7CiAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHsKICAgICAgeiA9IHguejsKICAgICAgeSA9IHgueTsKICAgICAgeCA9IHgueDsKICAgIH0KICAgIHRoaXMueCA9IHg7CiAgICB0aGlzLnkgPSB5OwogICAgaWYgKHogIT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLnogPSB6OwogICAgfQogIH0KCiAgZGlzdChvdGhlciwgeSwgeiA9IDApIHsKICAgIGlmICh5ICE9PSB1bmRlZmluZWQpIG90aGVyID0geyB4OiBvdGhlciwgeSwgeiB9OwogICAgbGV0IHN1bSA9IDA7CiAgICBzdW0gKz0gKHRoaXMueCAtIG90aGVyLngpICoqIDI7CiAgICBzdW0gKz0gKHRoaXMueSAtIG90aGVyLnkpICoqIDI7CiAgICBsZXQgejEgPSB0aGlzLnogPyB0aGlzLnogOiAwOwogICAgbGV0IHoyID0gb3RoZXIueiA/IG90aGVyLnogOiAwOwogICAgc3VtICs9ICh6MSAtIHoyKSAqKiAyOwogICAgcmV0dXJuIHN1bSAqKiAwLjU7CiAgfQoKICBub3JtYWxpemUoZikgewogICAgbGV0IG1hZyA9IHRoaXMuZGlzdCgwLCAwLCAwKTsKICAgIHJldHVybiBuZXcgVmVjdG9yKAogICAgICAoZiAqIHRoaXMueCkgLyBtYWcsCiAgICAgIChmICogdGhpcy55KSAvIG1hZywKICAgICAgKGYgKiB0aGlzLnopIC8gbWFnCiAgICApOwogIH0KCiAgZ2V0QW5nbGUoKSB7CiAgICByZXR1cm4gLU1hdGguYXRhbjIodGhpcy55LCB0aGlzLngpOwogIH0KCiAgcmVmbGVjdChvdGhlcikgewogICAgbGV0IHAgPSBuZXcgVmVjdG9yKG90aGVyLnggLSB0aGlzLngsIG90aGVyLnkgLSB0aGlzLnkpOwogICAgaWYgKG90aGVyLnogIT09IHVuZGVmaW5lZCkgewogICAgICBwLnogPSBvdGhlci56OwogICAgICBpZiAodGhpcy56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBwLnogLT0gdGhpcy56OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5zdWJ0cmFjdChwKTsKICB9CgogIGFkZChvdGhlcikgewogICAgbGV0IHAgPSBuZXcgVmVjdG9yKHRoaXMueCArIG90aGVyLngsIHRoaXMueSArIG90aGVyLnkpOwogICAgaWYgKHRoaXMueiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHAueiA9IHRoaXMuejsKICAgICAgaWYgKG90aGVyLnogIT09IHVuZGVmaW5lZCkgewogICAgICAgIHAueiArPSBvdGhlci56OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcDsKICB9CgogIHN1YnRyYWN0KG90aGVyKSB7CiAgICBsZXQgcCA9IG5ldyBWZWN0b3IodGhpcy54IC0gb3RoZXIueCwgdGhpcy55IC0gb3RoZXIueSk7CiAgICBpZiAodGhpcy56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcC56ID0gdGhpcy56OwogICAgICBpZiAob3RoZXIueiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcC56IC09IG90aGVyLno7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwOwogIH0KCiAgc2NhbGUoZiA9IDEpIHsKICAgIGlmIChmID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgVmVjdG9yKDAsIDAsIHRoaXMueiA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogMCk7CiAgICB9CiAgICBsZXQgcCA9IG5ldyBWZWN0b3IodGhpcy54ICogZiwgdGhpcy55ICogZik7CiAgICBpZiAodGhpcy56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcC56ID0gdGhpcy56ICogZjsKICAgIH0KICAgIHJldHVybiBwOwogIH0KfQo="),p=class extends h{static{l(this,"GraphicsElement")}set onload(e){this._onload=e}set onerror(e){this._onerror=e}handleAttributeChange(...e){}handleChildChanges(...e){}connectedCallback(){super.connectedCallback(),this.label=document.createElement("label"),this.title||(console.warn("<graphics-element> is missing a title attribute. Always caption your figures."),this.title=""),this.label.textContent=this.title,H(this)?this.loadSource():new IntersectionObserver((e,x)=>e.forEach(r=>{r.isIntersecting&&(this.loadSource(),x.disconnect())}),{threshold:.1,rootMargin:`${window.innerHeight}px`}).observe(this)}getStyle(){return`
:host([hidden]) { display: none; }
style { display: none; }
.top-title { display: flex; flex-direction: row; justify-content: space-between; }
canvas { touch-action: none; user-select: none; position: relative; z-index: 1; display: block; margin: auto; border-radius: 0; box-sizing: content-box !important; border: 1px solid lightgrey;
&.crisp { image-rendering: -moz-crisp-edges; image-rendering: -webkit-crisp-edges; image-rendering: pixelated; image-rendering: crisp-edges; }
&:focus { border: 1px solid red; }}
a { &.view-source { font-size: 60%; text-decoration: none;
&.plus { padding-left: 0.5em; }}}
button.reset { font-size: 0.5em; top: -0.35em; position: relative; }
label:not(:empty) { display: block; font-style: italic; font-size: 0.9em; text-align: right; padding-right: 1em; margin-top: 0.35em; }
`}async loadSource(e,x=this.width,r=this.height,$){if(!x&&!r&&(x=parseFloat(this.getAttribute("width")),r=parseFloat(this.getAttribute("height")),isNaN(x)&&(x=void 0),isNaN(r)&&(r=void 0)),e){if(typeof e=="function")return console.warn(".loadSource() called with a function rather than string data: use .loadFromFunction() instead."),this.loadFromFunction(e)}else if(this.userCode)e=this.userCode;else{let a=this.getAttribute("src");if(a)e=await(await fetch(a)).text();else{let s=this.querySelector("graphics-source");s?e=s.textContent:e=`function setup() {
}
function draw() {
}
`}}if(this.userCode=e,!$)if(this.additionalSources)$=this.additionalSources;else{let a=this.querySelectorAll("source");$=await Promise.all(Array.from(a).map(s=>fetch(s.src).then(b=>b.text())))}this.additionalSources=$;let t=this.userCode;this.additionalSources.length>0&&(t=this.loadAdditionalSources(this.userCode,this.additionalSources));let g=t.matchAll(/addSlider\(['"`](.*)['"`]/g),i=[];for(let a of g)i.push(a[1]),t=t.replace(a[0],a[0]+`, (v) => (${a[1]} = v)`);if(i.length&&(t="let "+i.join(", ")+`;
`+t),t=t.replaceAll(/ from ['"].([^'"]+)['"]/g,` from "${M(location.href)}/$1"`),t.includes("function setup()")||(t=`function setup() {
}
`+t),!t.includes("setSize(")){let a="setSize();";x&&r&&(a=`setSize(${x}, ${r});`),t=t.replace("function setup() {",`function setup() {
  ${a}`)}let o=Object.entries(this.dataset);if(o.length&&o.forEach(([a,s])=>{parseFloat(s)!=s&&s!=="true"&&s!=="false"&&(s=`"${s}"`),t=t.replace("function setup() {",`function setup() {
  ${a} = ${s};`)}),this.getAttribute("safemode")!==null){let a=parseFloat(this.getAttribute("safemode"));isNaN(a)&&(a=1e3),t=y(t,a)}import(`data:text/javascript;base64,${N(['"use strict";',`import { BSpline, CSS_COLOR_MAP } from "${q}";`,`const __randomId = "${Date.now()}";`,F,t,`export {
  __reset as start,
  __canvas as canvas,
  __halt as halt,
  highlight,
  __getDescription as getDescription
}`].join(`
`))}`).then(async a=>{let{start:s,canvas:b,halt:c,highlight:L,getDescription:R}=a;this.canvas=b,this.halt=()=>c(),this.highlight=v=>L(v),this.render();let{width:d,height:u}=await s(this),m="graphics-element-description";this.querySelector(`.${m}`)?.remove(),this.querySelector("p")||this.handleGraphicsDescription(m,R),d&&u&&(this.style.width="",this.style.height="",this.width=d,this.height=u,this.setAttribute("width",d),this.setAttribute("height",u));let w=new CustomEvent("load");this.dispatchEvent(w),this._onload&&this._onload(w)}).catch(a=>{let s=new CustomEvent("error",{detail:a});if(this.dispatchEvent(s),this._onerror)this._onerror(a);else throw a})}handleGraphicsDescription(e,x=()=>{}){try{let r=x();if(r){let $=new DocumentFragment,t=document.createElement("div");t.classList.add(e),$.append(t),t.innerHTML=r,this.append(t),this.crossLink(!0)}}catch(r){console.error(r)}}loadAdditionalSources(e,x){if(!x)return e;let r=new Array(x.length);return e+`
`+x.map(($,t)=>$.replace("function setup()",`function setup${t+1}()`).replace("function draw()",`function draw${t+1}()`)).join(`
`)+`
function __more_setup() { ${[...r].map(($,t)=>`if (typeof setup${t+1} !== \`undefined\`) setup${t+1}();`).join(`
`)} }
function __more_draw() { ${[...r].map(($,t)=>`if (typeof draw${t+1} !== \`undefined\`) draw${t+1}();`).join(`
`)} }
`}loadFromFunction(e){let x=e.toString();this.reset(x.substring(x.indexOf("{")+1,x.lastIndexOf("}")))}reset(e,x=[]){this.halt&&this.halt(),this.querySelector("button.remove-color")?.remove(),this.loadSource(e||this.userCode,this.width,this.height,x||this.additionalSources)}render(){super.render();let e=this._slot.parentNode;this.canvas&&e.insertBefore(this.canvas,this._slot),this.label&&e.insertBefore(this.label,this._slot);let x=document.createElement("div");x.classList.add("top-title");let r=document.createElement("span");r.classList.add("sources"),x.append(r);let $=document.createElement("button");$.classList.add("reset"),$.textContent=this.getAttribute("reset")||"reset",$.addEventListener("click",()=>this.reset()),x.append($);let t=this.getAttribute("src");if(t||(t=`data:text/plain;base64,${N(this.userCode)}`),t){let i=document.createElement("a");i.classList.add("view-source"),i.textContent=this.getAttribute("viewSource")||"view source",i.href=t,i.target="_blank",r.append(i),t.startsWith("data")&&(delete i.href,delete i.target,i.classList.add("fake-source-link"),i.addEventListener("click",()=>{let o=`<iframe width="100%" height="100%" src="${t}"></iframe>`,f=window.open(""),{document:a}=f;a.open(),a.write(o),a.write("<style>iframe { position: fixed; top: 0; right: 0; bottom: 0; left: 0; border:0; margin: 0; padding:0 }</style>"),a.close()}))}let g=this.querySelectorAll("source");g.length===0&&(g=(this.additionalSources??[]).map(i=>({src:`data:text/plain;base64,${N(i)}`}))),g.length&&g.forEach((i,o)=>{let{src:f}=i,a=document.createElement("a");a.classList.add("view-source","plus"),a.textContent=`[+${o+1}]`,a.href=f,a.target="_blank",r.append(a),f.startsWith("data")&&(delete a.href,delete a.target,a.classList.add("fake-source-link"),a.addEventListener("click",()=>{let s=`<iframe width="100%" height="100%" src="${f}"></iframe>`,b=window.open(""),{document:c}=b;c.open(),c.write(s),c.write("<style>iframe { position: fixed; top: 0; right: 0; bottom: 0; left: 0; border:0; margin: 0; padding:0 }</style>"),c.close()}))}),this.label&&e.insertBefore(x,this.canvas),this.crossLink()}crossLink(e){if(e&&(this.crossLinked=!1),this.crossLinked)return;this.crossLinked=!0;let x=!1;if(this.querySelectorAll("p").forEach(r=>{r.querySelectorAll("*").forEach($=>{if(!S.includes($.tagName))return;x=!0;let t;$.classList.remove("calm"),$.addEventListener("pointerenter",()=>{t??=getComputedStyle($)["-webkit-text-stroke-color"],this.highlight?.(t)}),$.addEventListener("pointerleave",()=>this.highlight?.(!1))})}),x){let r=document.createElement("button");r.textContent="remove colors",r.classList.add("remove-color"),r.addEventListener("click",()=>{this.querySelectorAll("p").forEach($=>{$.querySelectorAll("*").forEach(t=>{S.includes(t.tagName)&&t.classList.add("calm")})}),r.remove()}),this.append(r)}}},O=class extends h{static{l(this,"GraphicsSource")}constructor(){super(),this.style.display="none"}handleAttributeChange(){}handleChildChanges(){}};h.register(p),h.register(O),globalThis.GraphicsElement=p,await customElements.whenDefined("graphics-element"),await customElements.whenDefined("graphics-source");export{A as BSpline,C as CSS_COLOR_MAP,p as GraphicsElement,O as GraphicsSource};
