var _=Object.defineProperty;var l=(n,e)=>_(n,"name",{value:e,configurable:!0});var I="Potentially infinite loop detected.",B=/\b(for|while)[\r\n\s]*\([^\)]+\)[\r\n\s]*{/,K=/\bdo[\r\n\s]*{/,P=/}(\s*(\/\/)[^\n\r]*[\r\n])?[\r\n\s]*while[\r\n\s]*\([^\)]+\)([\r\n\s]*;)?/;function y(n,e=1e3,x=1e3){let r=0,$=0;for(;r<n.length;){if($++>x)throw new Error(I);let t=n.length,g="",i=r+n.substring(r).search(B),o=r+n.substring(r).search(K);if(i<r&&(i=t),o<r&&(o=t),i===t&&o===t)return n;let f=-1;if(i<t&&i<=o?(f=i,g=Y(n,i)):o<t&&(f=o,g=W(n,o)),g===""||f===-1)return n;let a=V(g,e);n=n.substring(0,r)+n.substring(r).replace(g,a),r=f+a.indexOf(I)+I.length+6}return n}l(y,"loopGuard");function Y(n,e=0){let x="",r=1,$=n.indexOf("{",e)+1;for(;r>0&&e<n.length;)x=n[$],x==="{"?r++:x==="}"&&r--,$++;if($>=n.length)throw new Error("Parse error: source code end prematurely.");return n.substring(e,$)}l(Y,"getLoopBlock");function W(n,e=0){let x=n.substring(e),r=x.match(P)[0],$=x.indexOf(r)+r.length;return x.substring(0,$)}l(W,"getDoLoopBlock");function V(n,e=1e3){return`((__break__counter=0) => {
${n.replace("{",`{
  if (__break__counter++ > ${e}) {
    throw new Error("${I}");
  }`)}
})();`}l(V,"wrap");var T="registered as custom element";function G(n,e){console.warn(`missing implementation for ${e}(...data) in ${n.__proto__.constructor.name}`)}l(G,"NotImplemented");function U(n){return n.prototype.constructor.name.replace(/([A-Z])([a-z])/g,(e,x,r,$)=>{let t=`${x.toLowerCase()}${r}`;return $>0?`-${t}`:t})}l(U,"getElementTagName");var h=class extends HTMLElement{static{l(this,"CustomElement")}static register(e){if(!e[T]){let x=e.tagName||U(e);return customElements.define(x,e),e[T]=!0,customElements.whenDefined(x)}return Promise.resolve()}static get tagName(){return U(this)}constructor(e={}){super(),customElements.resolveScope||(customElements.resolveScope=function($){try{return $.getRootNode().host}catch(t){console.warn(t)}return window}),this._options=e;let x={childList:$=>{this.handleChildChanges(Array.from($.addedNodes),Array.from($.removedNodes)),this.render()},attributes:$=>{this.handleAttributeChange($.attributeName,$.oldValue,this.getAttribute($.attributeName)),this.render()}};this._observer=new MutationObserver($=>{this.isConnected&&$.forEach(t=>{x[t.type](t)})}),this._observer.observe(this,{childList:!0,attributes:!0});let r={mode:"open"};this._shadow=this.attachShadow(r),this._style=document.createElement("style"),this._style.textContent=this.getStyle(),this._options.header!==!1&&(this._header=document.createElement("header")),this._options.slot!==!1&&this._options.void!==!0&&(this._slot=document.createElement("slot")),this._options.footer!==!1&&(this._footer=document.createElement("footer"))}connectedCallback(){this.render()}handleChildChanges(e,x){this._options.void||G(this,"handleChildChanges")}handleAttributeChange(e,x,r){G(this,"handleAttributeChange")}getStyle(){return""}render(){this._shadow.innerHTML="",this._shadow.append(this._style),this._options.header!==!1&&this._shadow.append(this._header),this._options.slot!==!1&&this._shadow.append(this._slot),this._options.footer!==!1&&this._shadow.append(this._footer)}};var S=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREEN","DARKGREY","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREEN","GREENYELLOW","GREY","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREEN","LIGHTGREY","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TRANSPARENT","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN"],C={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(128, 128, 128)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",transparent:"rgba(0,0,0,0)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",ALICEBLUE:"rgb(240, 248, 255)",ANTIQUEWHITE:"rgb(250, 235, 215)",AQUA:"rgb(0, 255, 255)",AQUAMARINE:"rgb(127, 255, 212)",AZURE:"rgb(240, 255, 255)",BEIGE:"rgb(245, 245, 220)",BISQUE:"rgb(255, 228, 196)",BLACK:"rgb(0, 0, 0)",BLANCHEDALMOND:"rgb(255, 235, 205)",BLUE:"rgb(0, 0, 255)",BLUEVIOLET:"rgb(138, 43, 226)",BROWN:"rgb(165, 42, 42)",BURLYWOOD:"rgb(222, 184, 135)",CADETBLUE:"rgb(95, 158, 160)",CHARTREUSE:"rgb(127, 255, 0)",CHOCOLATE:"rgb(210, 105, 30)",CORAL:"rgb(255, 127, 80)",CORNFLOWERBLUE:"rgb(100, 149, 237)",CORNSILK:"rgb(255, 248, 220)",CRIMSON:"rgb(220, 20, 60)",CYAN:"rgb(0, 255, 255)",DARKBLUE:"rgb(0, 0, 139)",DARKCYAN:"rgb(0, 139, 139)",DARKGOLDENROD:"rgb(184, 134, 11)",DARKGRAY:"rgb(169, 169, 169)",DARKGREEN:"rgb(0, 100, 0)",DARKGREY:"rgb(169, 169, 169)",DARKKHAKI:"rgb(189, 183, 107)",DARKMAGENTA:"rgb(139, 0, 139)",DARKOLIVEGREEN:"rgb(85, 107, 47)",DARKORANGE:"rgb(255, 140, 0)",DARKORCHID:"rgb(153, 50, 204)",DARKRED:"rgb(139, 0, 0)",DARKSALMON:"rgb(233, 150, 122)",DARKSEAGREEN:"rgb(143, 188, 143)",DARKSLATEBLUE:"rgb(72, 61, 139)",DARKSLATEGRAY:"rgb(47, 79, 79)",DARKSLATEGREY:"rgb(47, 79, 79)",DARKTURQUOISE:"rgb(0, 206, 209)",DARKVIOLET:"rgb(148, 0, 211)",DEEPPINK:"rgb(255, 20, 147)",DEEPSKYBLUE:"rgb(0, 191, 255)",DIMGRAY:"rgb(105, 105, 105)",DIMGREY:"rgb(105, 105, 105)",DODGERBLUE:"rgb(30, 144, 255)",FIREBRICK:"rgb(178, 34, 34)",FLORALWHITE:"rgb(255, 250, 240)",FORESTGREEN:"rgb(34, 139, 34)",FUCHSIA:"rgb(255, 0, 255)",GAINSBORO:"rgb(220, 220, 220)",GHOSTWHITE:"rgb(248, 248, 255)",GOLD:"rgb(255, 215, 0)",GOLDENROD:"rgb(218, 165, 32)",GRAY:"rgb(128, 128, 128)",GREEN:"rgb(0, 128, 0)",GREENYELLOW:"rgb(173, 255, 47)",GREY:"rgb(128, 128, 128)",HONEYDEW:"rgb(240, 255, 240)",HOTPINK:"rgb(255, 105, 180)",INDIANRED:"rgb(205, 92, 92)",INDIGO:"rgb(75, 0, 130)",IVORY:"rgb(255, 255, 240)",KHAKI:"rgb(240, 230, 140)",LAVENDER:"rgb(230, 230, 250)",LAVENDERBLUSH:"rgb(255, 240, 245)",LAWNGREEN:"rgb(124, 252, 0)",LEMONCHIFFON:"rgb(255, 250, 205)",LIGHTBLUE:"rgb(173, 216, 230)",LIGHTCORAL:"rgb(240, 128, 128)",LIGHTCYAN:"rgb(224, 255, 255)",LIGHTGOLDENRODYELLOW:"rgb(250, 250, 210)",LIGHTGRAY:"rgb(211, 211, 211)",LIGHTGREEN:"rgb(144, 238, 144)",LIGHTGREY:"rgb(211, 211, 211)",LIGHTPINK:"rgb(255, 182, 193)",LIGHTSALMON:"rgb(255, 160, 122)",LIGHTSEAGREEN:"rgb(32, 178, 170)",LIGHTSKYBLUE:"rgb(135, 206, 250)",LIGHTSLATEGRAY:"rgb(119, 136, 153)",LIGHTSLATEGREY:"rgb(119, 136, 153)",LIGHTSTEELBLUE:"rgb(176, 196, 222)",LIGHTYELLOW:"rgb(255, 255, 224)",LIME:"rgb(0, 255, 0)",LIMEGREEN:"rgb(50, 205, 50)",LINEN:"rgb(250, 240, 230)",MAGENTA:"rgb(255, 0, 255)",MAROON:"rgb(128, 0, 0)",MEDIUMAQUAMARINE:"rgb(102, 205, 170)",MEDIUMBLUE:"rgb(0, 0, 205)",MEDIUMORCHID:"rgb(186, 85, 211)",MEDIUMPURPLE:"rgb(147, 112, 219)",MEDIUMSEAGREEN:"rgb(60, 179, 113)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",MEDIUMSPRINGGREEN:"rgb(0, 250, 154)",MEDIUMTURQUOISE:"rgb(72, 209, 204)",MEDIUMVIOLETRED:"rgb(199, 21, 133)",MIDNIGHTBLUE:"rgb(25, 25, 112)",MINTCREAM:"rgb(245, 255, 250)",MISTYROSE:"rgb(255, 228, 225)",MOCCASIN:"rgb(255, 228, 181)",NAVAJOWHITE:"rgb(255, 222, 173)",NAVY:"rgb(0, 0, 128)",OLDLACE:"rgb(253, 245, 230)",OLIVE:"rgb(128, 128, 0)",OLIVEDRAB:"rgb(107, 142, 35)",ORANGE:"rgb(255, 165, 0)",ORANGERED:"rgb(255, 69, 0)",ORCHID:"rgb(218, 112, 214)",PALEGOLDENROD:"rgb(238, 232, 170)",PALEGREEN:"rgb(152, 251, 152)",PALETURQUOISE:"rgb(175, 238, 238)",PALEVIOLETRED:"rgb(219, 112, 147)",PAPAYAWHIP:"rgb(255, 239, 213)",PEACHPUFF:"rgb(255, 218, 185)",PERU:"rgb(205, 133, 63)",PINK:"rgb(255, 192, 203)",PLUM:"rgb(221, 160, 221)",POWDERBLUE:"rgb(176, 224, 230)",PURPLE:"rgb(128, 0, 128)",REBECCAPURPLE:"rgb(102, 51, 153)",RED:"rgb(255, 0, 0)",ROSYBROWN:"rgb(188, 143, 143)",ROYALBLUE:"rgb(65, 105, 225)",SADDLEBROWN:"rgb(139, 69, 19)",SALMON:"rgb(250, 128, 114)",SANDYBROWN:"rgb(244, 164, 96)",SEAGREEN:"rgb(46, 139, 87)",SEASHELL:"rgb(255, 245, 238)",SIENNA:"rgb(160, 82, 45)",SILVER:"rgb(192, 192, 192)",SKYBLUE:"rgb(135, 206, 235)",SLATEBLUE:"rgb(106, 90, 205)",SLATEGRAY:"rgb(112, 128, 144)",SLATEGREY:"rgb(112, 128, 144)",SNOW:"rgb(255, 250, 250)",SPRINGGREEN:"rgb(0, 255, 127)",STEELBLUE:"rgb(70, 130, 180)",TAN:"rgb(210, 180, 140)",TEAL:"rgb(0, 128, 128)",THISTLE:"rgb(216, 191, 216)",TOMATO:"rgb(255, 99, 71)",TRANSPARENT:"rgba(0,0,0,0)",TURQUOISE:"rgb(64, 224, 208)",VIOLET:"rgb(238, 130, 238)",WHEAT:"rgb(245, 222, 179)",WHITE:"rgb(255, 255, 255)",WHITESMOKE:"rgb(245, 245, 245)",YELLOW:"rgb(255, 255, 0)",YELLOWGREEN:"rgb(154, 205, 50)"};function D(n,e,x,r,$,m,g){var i,o,f,a,s=x.length,b=x[0].length;if(e<1)throw new Error("degree must be at least 1 (linear)");if(e>s-1)throw new Error("degree must be less than or equal to point count - 1");if(!$)for($=[],i=0;i<s;i++)$[i]=1;if($.length<x.length&&($=$.concat($.slice(0,e))),r){if(r.length!==s+e+1)throw new Error("bad knot vector length")}else{var r=[];for(i=0;i<s+e+1;i++)r[i]=i}r.length===x.length&&(r=r.concat(r.slice(0,e)));var c=[e,r.length-1-e],L=r[c[0]],R=r[c[1]];if(g||(n=n*(R-L)+L),n<L||n>R)throw new Error("out of bounds");for(f=c[0];f<c[1]&&!(n>=r[f]&&n<=r[f+1]);f++);var d=[];for(i=0;i<s;i++){for(d[i]=[],o=0;o<b;o++)d[i][o]=x[i][o]*$[i];d[i][b]=$[i]}var u;for(a=1;a<=e+1;a++)for(i=f;i>f-e-1+a;i--)for(u=(n-r[i])/(r[i+e+1-a]-r[i]),o=0;o<b+1;o++)d[i][o]=(1-u)*d[i-1][o]+u*d[i][o];var m=m||[];for(i=0;i<b;i++)m[i]=d[f][i]/d[f][b];return m}l(D,"interpolate");var E=3,A=class{static{l(this,"BSpline")}constructor(e,x=!0){this.points=e,this.points=e.map(r=>r instanceof Array?r:[r.x,r.y]),this.formKnots(x),this.formWeights()}getLUT(e=100){let x=e-1;return[...new Array(e)].map((r,$)=>{let t=D($/x,E,this.points,this.knots,this.weights);return{x:t[0],y:t[1]}})}formKnots(e=!1){if(!e)return this.formUniformKnots();let x=[],r=this.points.length,$=r-E;for(let t=1;t<r-E;t++)x.push(t+E);for(let t=0;t<=E;t++)x=[E].concat(x);for(let t=0;t<=E;t++)x.push($+E);return this.knots=x}formUniformKnots(){return this.knots=[...new Array(this.points.length+E+1)].map((e,x)=>x)}formWeights(){return this.weights=this.points.map(e=>1)}};function N(n,e=512){let x=new TextEncoder().encode(n),r="";for(let $=0;$<x.length;$+=e){let t=x.slice($,$+e);r+=String.fromCodePoint(...t)}return btoa(r)}l(N,"base64");function k(n){let e=atob(n),x=Uint8Array.from(e,r=>r.codePointAt(0));return new TextDecoder().decode(x)}l(k,"decode64");function M(n){let e=/^(.*)\/([^.]+(\.([^\/?#]+))+)(\?[^#]*)?(#.*)?$/,x=n.match(e);if(x!==null){let{[1]:r,[2]:$,[4]:t}=x;n=r}return n}l(M,"getURLbase");function H(n){if(typeof window>"u"||typeof document>"u")return!0;var e=n.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}l(H,"isInViewport");var q=String(import.meta.url),F=k("Y29uc3QgQUxQSEFCRVRJQyA9IGBhbHBoYWJldGljYDsKY29uc3QgQVVUTyA9IGBhdXRvYDsKY29uc3QgQk9UVE9NID0gYGJvdHRvbWA7CmNvbnN0IEJPVFRPTV9MRUZUID0gYGJvdHRvbi1sZWZ0YDsKY29uc3QgQk9UVE9NX1JJR0hUID0gYGJvdHRvbS1yaWdodGA7CmNvbnN0IENFTlRFUiA9IGBjZW50ZXJgOwpjb25zdCBDT05TVFJBSU4gPSB0cnVlOwpjb25zdCBDUk9TUyA9IGBjcm9zc2hhaXJgOwpjb25zdCBFTkQgPSBgZW5kYDsKY29uc3QgSEFORCA9IGBwb2ludGVyYDsKY29uc3QgSEFOR0lORyA9IGBoYW5naW5nYDsKY29uc3QgSURFT0dSQVBISUMgPSBgaWRlb2dyYXBoaWNgOwpjb25zdCBMRUZUID0gYGxlZnRgOwpjb25zdCBNSURETEUgPSBgbWlkZGxlYDsKY29uc3QgUE9JTlRFUiA9IGBkZWZhdWx0YDsKY29uc3QgUklHSFQgPSBgcmlnaHRgOwpjb25zdCBTVEFSVCA9IGBzdGFydGA7CmNvbnN0IFRPUCA9IGB0b3BgOwpjb25zdCBUT1BfTEVGVCA9IGB0b3AtbGVmdGA7CmNvbnN0IFRPUF9SSUdIVCA9IGB0b3AtcmlnaHRgOwoKLy8gImludGVybmFsIiB2YXJzCgpsZXQgX19jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBjYW52YXNgKTsKX19jYW52YXMudGFiSW5kZXggPSAwOwpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBwb2ludGVyZG93bmAsICgpID0+IF9fY2FudmFzLmZvY3VzKCkpOwpsZXQgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwoKbGV0IF9fY3VycmVudF9jdXJzb3I7CmxldCBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19jdXJyZW50X2h1ZTsKbGV0IF9fZHJhd19ncmlkOwpsZXQgX19kcmF3aW5nOwpsZXQgX19lbGVtZW50OwpsZXQgX19maW5pc2hlZF9zZXR1cDsKbGV0IF9fZmlyc3Q7CmxldCBfX2ZvbnQ7CmxldCBfX2dyaWRfY29sb3I7CmxldCBfX2dyaWRfc3BhY2luZzsKbGV0IF9faGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19sYXN0X2ZyYW1lOwpsZXQgX19tb3ZhYmxlX3BvaW50czsKbGV0IF9fcHJvamVjdG9yOwpsZXQgX19yZWRyYXdpbmc7CmxldCBfX3NoYXBlOwpsZXQgX19zdGFydF90aW1lOwpsZXQgX19zdHlsZV9zdGFjazsKbGV0IF9fdGV4dFN0cm9rZTsKbGV0IF9fdXNlX3Byb2plY3Rpb247Cgpjb25zdCBfX3BybmcgPSBuZXcgKGNsYXNzIHsKICBjb25zdHJ1Y3RvcihzZWVkID0gRGF0ZS5ub3coKSkgewogICAgdGhpcy5hID0gc2VlZDsKICB9CiAgcmVzZWVkKHNlZWQpIHsKICAgIHRoaXMuYSA9IHNlZWQ7CiAgfQogIG5leHQoKSB7CiAgICAvLyBTcGxpdE1peDMyLCBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDc1OTMzMTYvNzQwNTUzCiAgICBsZXQgeyBhIH0gPSB0aGlzOwogICAgYSB8PSAwOwogICAgYSA9IChhICsgMHg5ZTM3NzliOSkgfCAwOwogICAgbGV0IHQgPSBhIF4gKGEgPj4+IDE2KTsKICAgIHQgPSBNYXRoLmltdWwodCwgMHgyMWYwYWFhZCk7CiAgICB0ID0gdCBeICh0ID4+PiAxNSk7CiAgICB0ID0gTWF0aC5pbXVsKHQsIDB4NzM1YTJkOTcpOwogICAgdGhpcy5hID0gYTsKICAgIHJldHVybiAoKHQgPSB0IF4gKHQgPj4+IDE1KSkgPj4+IDApIC8gNDI5NDk2NzI5NjsKICB9Cn0pKCk7Cgphc3luYyBmdW5jdGlvbiBfX3Jlc2V0KGVsZW1lbnQgPSBfX2VsZW1lbnQpIHsKICBfX2VsZW1lbnQgPSBlbGVtZW50OwoKICAvLyBkZWZhdWx0IHZhcmlhYmxlIHZhbHVlcwogIF9fY3VycmVudF9jdXJzb3IgPSBgYXV0b2A7CiAgX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvciA9IGByZ2IoMCwyNTQsMTI0KWA7CiAgX19jdXJyZW50X2h1ZSA9IDA7CiAgX19kcmF3X2dyaWQgPSB0cnVlOwogIF9fZHJhd2luZyA9IGZhbHNlOwogIF9fZmluaXNoZWRfc2V0dXAgPSBmYWxzZTsKICBfX2ZvbnQgPSB7IGZhbWlseTogYHNhbnMtc2VyaWZgLCBzaXplOiAxNiwgd2VpZ2h0OiA0MDAgfTsKICBfX2dyaWRfY29sb3IgPSBgbGlnaHRncmV5YDsKICBfX2dyaWRfc3BhY2luZyA9IDIwOwogIF9faGlnaGxpZ2h0X2NvbG9yID0gZmFsc2U7CiAgX19tb3ZhYmxlX3BvaW50cyA9IFtdOwogIF9fcHJvamVjdG9yID0gZmFsc2U7CiAgX19yZWRyYXdpbmcgPSBmYWxzZTsKICBfX3NoYXBlID0gdW5kZWZpbmVkOwogIF9fc3RhcnRfdGltZSA9IERhdGUubm93KCk7CiAgX19zdHlsZV9zdGFjayA9IFtdOwogIF9fdGV4dFN0cm9rZSA9IGB0cmFuc3BhcmVudGA7CiAgX191c2VfcHJvamVjdGlvbiA9IGZhbHNlOwoKICBjdXJyZW50TW92YWJsZSA9IGZhbHNlOwogIHBsYXlpbmcgPSBmYWxzZTsKICBmcmFtZSA9IDA7CiAgcG9pbnRlci54ID0gMDsKICBwb2ludGVyLnkgPSAwOwogIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGtleWJvYXJkKS5mb3JFYWNoKChuKSA9PiBkZWxldGUga2V5Ym9hcmRbbl0pOwoKICAvLyBtYWtlIHN1cmUgd2UgZG9uJ3QgZG91YmxlLWdlbmVyYXRlIHRoZXNlOgogIGNsZWFyU2xpZGVycygpOwogIGNsZWFyQnV0dG9ucygpOwoKICAvLyBydW4gc2V0dXAKICBhd2FpdCBfX3NldHVwKCk7CiAgX19maW5pc2hlZF9zZXR1cCA9IHRydWU7CgogIC8vIHJ1biBmaXJzdCBkcmF3CiAgX19sYXN0X2ZyYW1lID0gRGF0ZS5ub3coKTsKICBhd2FpdCBfX2RyYXcoKTsKCiAgcmV0dXJuIHsgd2lkdGgsIGhlaWdodCB9Owp9CgpmdW5jdGlvbiBfX2hhbHQoKSB7CiAgcGxheWluZyA9IGZhbHNlOwogIF9fY2FudmFzID0gdW5kZWZpbmVkOwogIF9fY3R4ID0gdW5kZWZpbmVkOwogIF9fZmluaXNoZWRfc2V0dXAgPSBmYWxzZTsKICBfX2RyYXdpbmcgPSB0cnVlOwogIF9fcmVkcmF3aW5nID0gdHJ1ZTsKICBfX2ZpcnN0ID0gdW5kZWZpbmVkOwogIF9fbW92YWJsZV9wb2ludHMgPSB1bmRlZmluZWQ7CiAgX19jdXJyZW50X2N1cnNvciA9IHVuZGVmaW5lZDsKICBfX2N1cnJlbnRfaHVlID0gMDsKICBfX2ZvbnQgPSB1bmRlZmluZWQ7CiAgX19zdGFydF90aW1lID0gMDsKICBjbGVhclNsaWRlcnMoKTsKICBjbGVhckJ1dHRvbnMoKTsKfQoKZnVuY3Rpb24gX19nZXREZXNjcmlwdGlvbigpIHsKICBpZiAodHlwZW9mIGdldERlc2NyaXB0aW9uICE9PSBgdW5kZWZpbmVkYCkgcmV0dXJuIGdldERlc2NyaXB0aW9uKCk7Cn0KCmFzeW5jIGZ1bmN0aW9uIF9fc2V0dXAoKSB7CiAgaWYgKHR5cGVvZiBzZXR1cCAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IHNldHVwKCk7CiAgaWYgKHR5cGVvZiBfX21vcmVfc2V0dXAgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBfX21vcmVfc2V0dXAoKTsKICBpZiAoIXdpZHRoICYmICFoZWlnaHQpIHNldFNpemUoKTsKfQoKYXN5bmMgZnVuY3Rpb24gX19kcmF3KCkgewogIGlmICghX19maW5pc2hlZF9zZXR1cCkgcmV0dXJuOwogIGlmICghX19kcmF3aW5nKSB7CiAgICBfX2RyYXdpbmcgPSB0cnVlOwogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICAgIGZyYW1lRGVsdGEgPSBub3cgLSBfX2xhc3RfZnJhbWU7CiAgICBmcmFtZSsrOwogICAgcmVzZXRUcmFuc2Zvcm0oKTsKICAgIGlmICh0eXBlb2YgZHJhdyAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IGRyYXcoKTsKICAgIGlmICh0eXBlb2YgX19tb3JlX2RyYXcgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBfX21vcmVfZHJhdygpOwogICAgX19kcmF3aW5nID0gZmFsc2U7CiAgICBfX2xhc3RfZnJhbWUgPSBub3c7CiAgICBpZiAocGxheWluZykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IF9fZHJhdygpKTsKICB9Cn0KLyoqCiAqIFRoZSBjdXJyZW50IGZyYW1lIG51bWJlcgogKgogKiBAY29uc3RhbnQge251bWJlcn0KICovCmxldCBmcmFtZSA9IDA7CgovKioKICogVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgc2luY2UgdGhlIGxhc3QgZnJhbWUuCiAqCiAqIEBjb25zdGFudCB7bnVtYmVyfQogKi8KbGV0IGZyYW1lRGVsdGEgPSAwOwoKLyoqCiAqIFRoZSBoZWlnaHQgb2YgdGhlIGNhbnZhcyBpbiBwaXhlbHMKICoKICogQGNvbnN0YW50IHtudW1iZXJ9CiAqLwpsZXQgaGVpZ2h0ID0gMDsKCi8qKgogKiBUaGUgd2lkdGggb2YgdGhlIGNhbnZhcyBpbiBwaXhlbHMKICoKICogQGNvbnN0YW50IHtudW1iZXJ9CiAqLwpsZXQgd2lkdGggPSAwOwoKLyoqCiAqIFRoZSBjdXJyZW50IHBsYXkgc3RhdGUKICoKICogQGNvbnN0YW50IHtib29sZWFufQogKi8KbGV0IHBsYXlpbmcgPSBmYWxzZTsKCi8qKgogKiBUaGUgYHBvaW50ZXJgIG9iamVjdCByZXByZXNlbnRzIHRoZSBtb3VzZSBjdXJzb3IgKHdoZW4gdXNpbmcKICogYSBtb3VzZSkgb3IgZmluZ2VyIHBvc2l0aW9uIChmb3IgdG91Y2ggZGV2aWNlcyksIGFuZCBtb2RlbHMKICogc2V2ZXJhbCBhc3BlY3RzOgogKgogKiAtIGBhY3RpdmVgIChib29sZWFuKSBXaGV0aGVyIHRoZSBwb2ludGVyIGlzIGV2ZW4gb24gb3Igb3ZlciB0aGUgY2FudmFzLgogKiAtIGB4YCAobnVtYmVyKSBUaGUgcG9pbnRlcidzIHggb2Zmc2V0IGluIHBpeGVscyB3aXRoIHJlc3BlY3QgdG8gdGhlIGNhbnZhcwogKiAtIGB5YCAobnVtYmVyKSBUaGUgcG9pbnRlcidzIHkgb2Zmc2V0IGluIHBpeGVscyB3aXRoIHJlc3BlY3QgdG8gdGhlIGNhbnZhcwogKiAtIGBkb3duYCAoYm9vbGVhbikgV2hldGhlciB0aGUgcG9pbnRlciBpcyAiZW5nYWdlZCIgb3Igbm90CiAqIC0gYGRyYWdgIChib29sZWFuKSBXaGV0aGVyIGEgY2xpY2svdG91Y2gtZHJhZyBpcyBpbiBwcm9ncmVzcwogKiAtIGBtYXJrYCAoe3gseX0pIFdoZW4gZHJhZ2dpbmcsIHRoaXMgcmVwcmVzZW50cyB0aGUgb3JpZ2luYWwgY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnRlciAiZG93biIgZXZlbnQKICoKICogQGNvbnN0YW50IHtvYmplY3R9CiAqLwpjb25zdCBwb2ludGVyID0geyB4OiAwLCB5OiAwIH07CgovKioKICogSWYgYW55IHBvaW50cyB3ZXJlIHJlZ2lzdGVyZWQgYXMgbW92YWJsZSwgYW5kIHRoZSBwb2ludGVyIGlzCiAqIG5lYXIgZW5vdWdoIHRvIGEgbW92YWJsZSBwb2ludCwgdGhpcyB2YWx1ZSB3aWxsIHBvaW50IHRvCiAqIHRoYXQgbW92YWJsZSBwb2ludCwgb3IgYGZhbHNlYCBpZiB0aGUgcG9pbnRlciBpcyBub3QgbmVhcgogKiBhbnkgbW92YWJsZSBwb2ludCAob3IsIG9mIGNvdXJzZSwgdGhlcmUgYXJlIG5vIG1vdmFibGUgcG9pbnRzKQogKgogKiBAY29uc3RhbnQge1BvaW50TGlrZXxmYWxzZX0KICovCmxldCBjdXJyZW50TW92YWJsZSA9IGZhbHNlOwoKLyoqCiAqIFRoZSBga2V5Ym9hcmRgIG9iamVjdCBpcyBhIHRydXRoIHRhYmxlIHRoYXQgY2FuIGJlIGNoZWNrZWQgdG8KICogc2VlIGlmIGFueSBrZXkgaXMgY3VycmVudGx5IHByZXNzZWQsIGFuZCBpZiBzbywgd2hlbiB0aGF0CiAqIGtleXByZXNzIHdhcyBpbml0aWF0ZWQsIGJ5IHN0b3Jpbmc6CiAqCiAqIGBgYAogKiB7CiAqICAgW2tleTpzdHJpbmddOiBkYXRldGltZQogKiB9CiAqIGBgYAogKgogKiBXaGVuIGEga2V5IGlzIHJlbGVhc2VkLCBpdHMgbWFwcGluZyBpcyByZW1vdmVkIGVudGlyZWx5LAogKiByYXRoZXIgdGhhbiBpdCBiZWluZyBzZXQgdG8gYSBmYWxzZXkgdmFsdWUuCiAqCiAqIEBjb25zdGFudCB7b2JqZWN0fQogKi8KY29uc3Qga2V5Ym9hcmQgPSB7fTsKCi8vIGNvbnN0YW50cy4uLgpjb25zdCB7CiAgLyoqCiAgICogVGhlIHJhdGlvIG9mIGEgY2lyY2xlJ3MgY2lyY3VtZmVyZW5jZSB0byBpdHMgZGlhbWV0ZXIuCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUGkKICAgKgogICAqIEBjb25zdGFudCB7bnVtYmVyfQogICAqCiAgICogQHNlZSB7QGxpbmsgVEFVfQogICAqLwogIFBJLAoKICAvKioKICAgKiBUaGUgYmFzZSBmb3IgdGhlIG5hdHVyYWwgbG9nYXJpdGhtLgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0VfKG1hdGhlbWF0aWNhbF9jb25zdGFudCkKICAgKgogICAqIEBjb25zdGFudCB7bnVtYmVyfQogICAqLwogIEUsCn0gPSBNYXRoOwoKY29uc3QgewogIC8qKgogICAqIEEgdmVyeSBzbWFsbCB2YWx1ZSBmb3IgcGVyZm9ybWluZyBpbXByZWNpc2UgbWF0aCBvcGVyYXRpb25zCiAgICogc3VjaCBhcyBjaGVja2luZyB3aGV0aGVyIGEgdmFsdWUgaXMgYXBwcm94aW1hdGVseSB0aGUgc2FtZQogICAqIGFzIHNvbWUgb3RoZXIgdmFsdWUuCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKi8KICBlcHNpbG9uLAoKICAvKioKICAgKiBBIHZlcnkgbGFyZ2UgdmFsdWUgdGhhdCBjYW4gc3RpbGwgYmUgdXNlZCB0byBkcmF3IHRoaW5ncwogICAqIG9uIHRoZSBjYW52YXMgKHN1Y2ggYXMgbGluZXMgZnJvbSAtaHVnZSB0byAraHVnZSkuCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKi8KICBodWdlLAoKICAvKioKICAgKiBUaGUgcmF0aW8gb2YgYSBjaXJjbGUncyBjaXJjdW1mZXJlbmNlIHRvIGl0cyByYWRpdXMsIGkuZS4gMipQSQogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1R1cm5fKGFuZ2xlKSNUYXVfcHJvcG9zYWxzCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKgogICAqIEBzZWUge0BsaW5rIFBJfQogICAqLwogIFRBVSwKfSA9IHsgZXBzaWxvbjogMWUtMTAsIGh1Z2U6IDFfMDAwXzAwMCwgVEFVOiBQSSAqIDIgfTsKCgovKioKICogVGhlIGNvbnN0YW50IGZvciBpbmRpY2F0aW5nIGEgcHJvamVjdG9yIHNob3VsZCBiZSBhICJjYWJpbmV0IiBwcm9qZWN0b3IsCiAqIGkuZS4gYSBwcm9qZWN0b3Igd2l0aG91dCBwZXJzcGVjdGl2ZSwgd2hlcmUgY29vcmRpbmF0ZXMgZnVydGhlciBhd2F5CiAqIGFyZSBkcmF3IHByb2dyZXNzaXZlbHkgbW9yZSB1cCBhbmQgcmlnaHQsIHNpbWlsYXIgdG8gdGhlIGtpbmQgb2YgcGljdHVyZXMKICogb25lIG1pZ2h0IGZpbmQgaW4gYW4gaW5zdHJ1Y3Rpb24gbGVhZmxldCBmb3IgYnVpbGRpbmcgYSBjYWJpbmV0LgogKgogKiBAY29uc3RhbnQge1N5bWJvbH0KICovCmNvbnN0IENBQklORVQgPSBTeW1ib2woYGNhYmluZXQgcHJvamVjdGlvbmApOwoKLyoqCiAqIFRoZSBjb25zdGFudCBmb3IgaW5kaWNhdGluZyBhIHByb2plY3RvciBzaG91bGQgYmUgYSAibm9ybWFsIiBob21vZ2VuZW91cwogKiBwcm9qZWN0b3IsIGkuZS4gcHJvamVjdGlvbiB3aXRoIGEgInBvaW50IGF0IGluZmluaXR5IiBhbmQgbm9ybWFsIHBlcnNwZWN0aXZlCiAqIGFwcGxpZWQuCiAqCiAqIEBjb25zdGFudCB7U3ltYm9sfQogKi8KY29uc3QgSE9NT0dFTkVPVVMgPSBTeW1ib2woYGhvbW9nZW5lb3VzIHByb2plY3Rpb25gKTsKZnVuY3Rpb24gZ3JpZCgpIHsKICBzYXZlKCk7CiAgc2V0TGluZVdpZHRoKDAuNSk7CiAgbm9GaWxsKCk7CiAgc2V0U3Ryb2tlKF9fZ3JpZF9jb2xvcik7CiAgZm9yICgKICAgIGxldCB4ID0gKC0wLjUgKyBfX2dyaWRfc3BhY2luZyAvIDIpIHwgMDsKICAgIHggPCB3aWR0aDsKICAgIHggKz0gX19ncmlkX3NwYWNpbmcKICApIHsKICAgIGxpbmUoeCwgMCwgeCwgaGVpZ2h0KTsKICB9CiAgZm9yICgKICAgIGxldCB5ID0gKC0wLjUgKyBfX2dyaWRfc3BhY2luZyAvIDIpIHwgMDsKICAgIHkgPCBoZWlnaHQ7CiAgICB5ICs9IF9fZ3JpZF9zcGFjaW5nCiAgKSB7CiAgICBsaW5lKDAsIHksIHdpZHRoLCB5KTsKICB9CiAgcmVzdG9yZSgpOwp9CmZ1bmN0aW9uIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCkgewogIC8vIFdlIGRvbid0IHdhbnQgdG8gaW50ZXJmZXJlIHdpdGggdGhlIGJyb3dzZXIsIHNvIHdlJ3JlIG9ubHkKICAvLyBnb2luZyB0byBhbGxvdyB1bm1vZGlmaWVkIGtleXMsIG9yIHNoaWZ0LW1vZGlmaWVkIGtleXMsCiAgLy8gYW5kIHRhYiBoYXMgdG8gYWx3YXlzIHdvcmsuIEZvciBvYnZpb3VzIHJlYXNvbnMuCiAgY29uc3QgdGFiID0gZXZ0LmtleSAhPT0gIlRhYiI7CiAgY29uc3QgZnVuY3Rpb25LZXkgPSBldnQua2V5Lm1hdGNoKC9GXGQrLykgPT09IG51bGw7CiAgY29uc3Qgc3BlY2lmaWNDaGVjayA9IHRhYiAmJiBmdW5jdGlvbktleTsKICBpZiAoIWV2dC5hbHRLZXkgJiYgIWV2dC5jdHJsS2V5ICYmICFldnQubWV0YUtleSAmJiBzcGVjaWZpY0NoZWNrKSB7CiAgICBpZiAoZXZ0LnRhcmdldCA9PT0gX19jYW52YXMpIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIF9fa2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpIHsKICBrZXlib2FyZFtrZXldID0gRGF0ZS5ub3coKTsKICBpZiAodHlwZW9mIGtleURvd24gIT09IGB1bmRlZmluZWRgKQogICAga2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9CgpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBrZXlkb3duYCwgKGV2dCkgPT4gewogIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCk7CiAgY29uc3QgeyBrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkgfSA9IGV2dDsKICBpZiAoX19maW5pc2hlZF9zZXR1cCkgX19rZXlEb3duKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn0pOwoKZnVuY3Rpb24gX19rZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpIHsKICBkZWxldGUga2V5Ym9hcmRba2V5XTsKICBpZiAodHlwZW9mIGtleVVwICE9PSBgdW5kZWZpbmVkYCkKICAgIGtleVVwKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn0KCl9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoYGtleXVwYCwgKGV2dCkgPT4gewogIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCk7CiAgY29uc3QgeyBrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkgfSA9IGV2dDsKICBpZiAoX19maW5pc2hlZF9zZXR1cCkgX19rZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9KTsKY29uc3QgX19iaW5vbWlhbENvZWZmaWNpZW50cyA9IFtbMV0sIFsxLCAxXV07CmNsYXNzIE1hdHJpeCB7CiAgY29uc3RydWN0b3IobiwgbSwgZGF0YSkgewogICAgZGF0YSA9IG4gaW5zdGFuY2VvZiBBcnJheSA/IG4gOiBkYXRhOwogICAgdGhpcy5kYXRhID0KICAgICAgZGF0YSA/PyBbLi4ubmV3IEFycmF5KG4pXS5tYXAoKHYpID0+IFsuLi5uZXcgQXJyYXkobSldLm1hcCgodikgPT4gMCkpOwogICAgdGhpcy5yb3dzID0gdGhpcy5kYXRhLmxlbmd0aDsKICAgIHRoaXMuY29scyA9IHRoaXMuZGF0YVswXS5sZW5ndGg7CiAgfQogIHNldERhdGEoZGF0YSkgewogICAgdGhpcy5kYXRhID0gZGF0YTsKICB9CiAgZ2V0KGksIGopIHsKICAgIHJldHVybiB0aGlzLmRhdGFbaV1bal07CiAgfQogIHNldChpLCBqLCB2YWx1ZSkgewogICAgdGhpcy5kYXRhW2ldW2pdID0gdmFsdWU7CiAgfQogIHJvdyhpKSB7CiAgICByZXR1cm4gdGhpcy5kYXRhW2ldOwogIH0KICBjb2woaikgewogICAgdmFyIGQgPSB0aGlzLmRhdGEsCiAgICAgIGNvbCA9IFtdOwogICAgZm9yIChsZXQgciA9IDAsIGwgPSBkLmxlbmd0aDsgciA8IGw7IHIrKykgewogICAgICBjb2wucHVzaChkW3JdW2pdKTsKICAgIH0KICAgIHJldHVybiBjb2w7CiAgfQogIG11bHRpcGx5KG90aGVyKSB7CiAgICByZXR1cm4gbmV3IE1hdHJpeChtdWx0aXBseU1hdHJpeCh0aGlzLmRhdGEsIG90aGVyLmRhdGEpKTsKICB9CiAgaW52ZXJ0KCkgewogICAgcmV0dXJuIG5ldyBNYXRyaXgoaW52ZXJ0TWF0cml4KHRoaXMuZGF0YSkpOwogIH0KICB0cmFuc3Bvc2UoKSB7CiAgICByZXR1cm4gbmV3IE1hdHJpeCh0cmFuc3Bvc2VNYXRyaXgodGhpcy5kYXRhKSk7CiAgfQogIHRyYW5zZm9ybShpbnB1dCkgewogICAgY29uc3QgeyBkYXRhIH0gPSB0aGlzOwogICAgaWYgKGlucHV0Lmxlbmd0aCAhPT0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgIGBjYW5ub3QgYXBwbHkgJHtkYXRhLmxlbmd0aH14JHtkYXRhWzBdLmxlbmd0aH0gbWF0cml4IHRvICR7aW5wdXQubGVuZ3RofUQgdmVjdG9yYAogICAgICApOwogICAgfQogICAgcmV0dXJuIGRhdGEubWFwKCh3KSA9PiB3LnJlZHVjZSgodCwgZSwgaSkgPT4gdCArIGUgKiAoaW5wdXRbaV0gPz8gMCksIDApKTsKICB9Cn0KY2xhc3MgUG9pbnQgewogIGNvbnN0cnVjdG9yKHgsIHkpIHsKICAgIHRoaXMueCA9IHg7CiAgICB0aGlzLnkgPSB5OwogIH0KfQoKY2xhc3MgQ2lyY2xlIGV4dGVuZHMgUG9pbnQgewogIGNvbnN0cnVjdG9yKHgsIHksIHIpIHsKICAgIHN1cGVyKHgsIHkpOwogICAgdGhpcy5yID0gcjsKICB9Cn0KZnVuY3Rpb24gX19jaGVja0ZvckN1cnJlbnRNb3ZhYmxlKHgsIHksIHR5cGUpIHsKICBjdXJyZW50TW92YWJsZSA9IGZhbHNlOwoKICBpZiAoIV9fbW92YWJsZV9wb2ludHMubGVuZ3RoKSByZXR1cm47CgogIGxldCBmb3VuZFBvaW50ID0gZmFsc2U7CiAgbGV0IGZvdW5kU2hhcGUgPSBmYWxzZTsKICBsZXQgbWF0Y2hlcyA9IFtdOwogIGNvbnN0IG1hdGNoUGFkZGluZyA9IHR5cGUuaW5jbHVkZXMoYG1vdXNlYCkgPyAxMCA6IDMwOwoKICBfX21vdmFibGVfcG9pbnRzLmZvckVhY2goKHApID0+IHsKICAgIGlmIChwIGluc3RhbmNlb2YgU2hhcGUpIHsKICAgICAgaWYgKHAuaW5zaWRlKHgsIHkpKSB7CiAgICAgICAgZm91bmRTaGFwZSA9IHRydWU7CiAgICAgICAgbWF0Y2hlcy5wdXNoKHsgcCwgZDogcC5fX3Nob3dQb2ludHMgPyAtMSA6IDAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGxldCB4MiA9IHBbMF0gPT09IHVuZGVmaW5lZCA/IHAueCA6IHBbMF07CiAgICAgIGxldCB5MiA9IHBbMV0gPT09IHVuZGVmaW5lZCA/IHAueSA6IHBbMV07CiAgICAgIGNvbnN0IGQgPSBkaXN0KHgsIHksIHgyLCB5Mik7CiAgICAgIGlmIChkIDwgKHAuciA/IHAuciA6IDApICsgbWF0Y2hQYWRkaW5nKSB7CiAgICAgICAgZm91bmRQb2ludCA9IHRydWU7CiAgICAgICAgbWF0Y2hlcy5wdXNoKHsgcCwgZCB9KTsKICAgICAgfQogICAgfQogIH0pOwoKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgYXV0b2A7CgogIGlmIChmb3VuZFBvaW50ICYmIGZvdW5kU2hhcGUpIHsKICAgIC8vIGlmIHdlIGhhdmUgYSBtaXggb2YgbWF0Y2hlZCBwb2ludHMgYW5kIHNoYXBlcwogICAgLy8gcHJpb3JpdGl6ZSBhY3RpdmF0aW5nIHBvaW50cyBpbnN0ZWFkLgogICAgbWF0Y2hlcyA9IG1hdGNoZXMuZmlsdGVyKCh2KSA9PiB2LmQgPj0gMCk7CiAgfQoKICBjb25zdCBtbGVuID0gbWF0Y2hlcy5sZW5ndGg7CiAgaWYgKG1sZW4gPiAwKSB7CiAgICBpZiAobWxlbiA+IDEpIG1hdGNoZXMuc29ydCgoYSwgYikgPT4gYS5kIC0gYi5kKTsKICAgIGN1cnJlbnRNb3ZhYmxlID0gbWF0Y2hlc1swXS5wOwogICAgX19jYW52YXMuc3R5bGUuY3Vyc29yID0gYHBvaW50ZXJgOwogIH0KfQoKZnVuY3Rpb24gX190b1BvaW50ZXJFdmVudChldnQpIHsKICBsZXQgcG9pbnRlciA9IGV2dDsKICAvLyBDb252ZXJ0IG1vdXNlIG9yIHRvdWNoIGludG8gZ2VuZXJpYyBwb2ludGVyLiBXaGljaCB3ZSBuZWVkCiAgLy8gdG8gZG8gYmVjYXVzZSBDaHJvbWUgb24gTWFjT1MgaGFzIGRlY2lkZWQgdG8gbm90IGdlbmVyYXRlCiAgLy8gcG9pbnRlciBldmVudHMgd2hlbiB0aGVyZSdzIGEgbW91c2UuIFRoYW5rcyBHb29nbGUhCiAgaWYgKGV2dC50eXBlLmluY2x1ZGVzKGB0b3VjaGApKSB7CiAgICBjb25zdCB7IHRvdWNoZXMsIGNoYW5nZWRUb3VjaGVzIH0gPSBldnQub3JpZ2luYWxFdmVudCA/PyBldnQ7CiAgICBwb2ludGVyID0gdG91Y2hlc1swXSA/PyBjaGFuZ2VkVG91Y2hlc1swXTsKICB9CiAgY29uc3QgeyBjbGllbnRYLCBjbGllbnRZIH0gPSBwb2ludGVyOwogIGNvbnN0IHsgbGVmdCwgdG9wIH0gPSBfX2NhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICByZXR1cm4geyBvZmZzZXRYOiBjbGllbnRYIC0gbGVmdCwgb2Zmc2V0WTogY2xpZW50WSAtIHRvcCB9Owp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PQoKW2B0b3VjaHN0YXJ0YCwgYG1vdXNlZG93bmBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChldnQpID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGNvbnN0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gX190b1BvaW50ZXJFdmVudChldnQpOwogICAgICBjb25zdCB7IHgsIHkgfSA9IHNjcmVlblRvV29ybGQob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwgeyB4LCB5LCB0eXBlLCBkb3duOiB0cnVlLCBtYXJrOiB7IHgsIHkgfSB9KTsKICAgICAgX19jaGVja0ZvckN1cnJlbnRNb3ZhYmxlKHgsIHksIHR5cGUpOwogICAgICBfX3BvaW50ZXJEb3duKHgsIHkpOwogICAgfQogIH0pOwp9KTsKCmZ1bmN0aW9uIF9fcG9pbnRlckRvd24oeCwgeSkgewogIGlmIChjdXJyZW50TW92YWJsZSkgewogICAgaWYgKGN1cnJlbnRNb3ZhYmxlIGluc3RhbmNlb2YgU2hhcGUpIHsKICAgICAgLy8gZG9uJ3QgZG8gYW55dGhpbmcgc3BlY2lhbC4KICAgIH0gZWxzZSB7CiAgICAgIGN1cnJlbnRNb3ZhYmxlLl9keCA9IGN1cnJlbnRNb3ZhYmxlLnggLSB4OwogICAgICBjdXJyZW50TW92YWJsZS5fZHkgPSBjdXJyZW50TW92YWJsZS55IC0geTsKICAgIH0KICB9CiAgaWYgKHR5cGVvZiBwb2ludGVyRG93biAhPT0gYHVuZGVmaW5lZGApIHBvaW50ZXJEb3duKHgsIHkpOwp9CgpbYHRvdWNoZW5kYCwgYG1vdXNldXBgXS5mb3JFYWNoKCh0eXBlKSA9PiB7CiAgX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCAoZXZ0KSA9PiB7CiAgICBpZiAoX19maW5pc2hlZF9zZXR1cCkgewogICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICBjb25zdCB7IG9mZnNldFgsIG9mZnNldFkgfSA9IF9fdG9Qb2ludGVyRXZlbnQoZXZ0KTsKICAgICAgY29uc3QgeyB4LCB5IH0gPSBzY3JlZW5Ub1dvcmxkKG9mZnNldFgsIG9mZnNldFkpOwogICAgICBPYmplY3QuYXNzaWduKHBvaW50ZXIsIHsKICAgICAgICB4LAogICAgICAgIHksCiAgICAgICAgdHlwZSwKICAgICAgICBkb3duOiBmYWxzZSwKICAgICAgICBtYXJrOiBmYWxzZSwKICAgICAgICBkcmFnOiBmYWxzZSwKICAgICAgfSk7CiAgICAgIF9fcG9pbnRlclVwKHgsIHkpOwogICAgfQogIH0pOwp9KTsKCmZ1bmN0aW9uIF9fcG9pbnRlclVwKHgsIHkpIHsKICBpZiAodHlwZW9mIHBvaW50ZXJVcCAhPT0gYHVuZGVmaW5lZGApIHBvaW50ZXJVcCh4LCB5KTsKICBpZiAocG9pbnRlci5tYXJrPy54ID09PSB4ICYmIHBvaW50ZXIubWFyaz8ueSA9PT0geSkgewogICAgaWYgKHR5cGVvZiBwb2ludGVyQ2xpY2sgIT09IGB1bmRlZmluZWRgKSBwb2ludGVyQ2xpY2soeCwgeSk7CiAgfQogIGlmIChjdXJyZW50TW92YWJsZSAmJiBjdXJyZW50TW92YWJsZSBpbnN0YW5jZW9mIFNoYXBlKSB7CiAgICBjdXJyZW50TW92YWJsZS5jb21taXQoKTsKICB9Cn0KCltgdG91Y2htb3ZlYCwgYG1vdXNlbW92ZWBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChldnQpID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGNvbnN0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gX190b1BvaW50ZXJFdmVudChldnQpOwogICAgICBjb25zdCB7IHgsIHkgfSA9IHNjcmVlblRvV29ybGQob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwgeyB4LCB5LCB0eXBlIH0pOwogICAgICBpZiAoIXBvaW50ZXIuZG93bikgX19jaGVja0ZvckN1cnJlbnRNb3ZhYmxlKHgsIHksIHR5cGUpOwogICAgICBfX3BvaW50ZXJNb3ZlKHgsIHkpOwogICAgfQogIH0pOwp9KTsKCmZ1bmN0aW9uIF9fcG9pbnRlck1vdmUoeCwgeSkgewogIGxldCBoYWRNb3ZhYmxlID0gZmFsc2U7CiAgaWYgKHBvaW50ZXIuZG93biAmJiBjdXJyZW50TW92YWJsZSkgewogICAgaWYgKGN1cnJlbnRNb3ZhYmxlIGluc3RhbmNlb2YgU2hhcGUpIHsKICAgICAgY3VycmVudE1vdmFibGUub2Zmc2V0KHggLSBwb2ludGVyLm1hcmsueCwgeSAtIHBvaW50ZXIubWFyay55KTsKICAgIH0gZWxzZSBpZiAoY3VycmVudE1vdmFibGVbMF0pIHsKICAgICAgY3VycmVudE1vdmFibGVbMF0gPSB4ICsgY3VycmVudE1vdmFibGUuX2R4OwogICAgICBjdXJyZW50TW92YWJsZVsxXSA9IHkgKyBjdXJyZW50TW92YWJsZS5fZHk7CiAgICB9IGVsc2UgewogICAgICBjdXJyZW50TW92YWJsZS54ID0geCArIGN1cnJlbnRNb3ZhYmxlLl9keDsKICAgICAgY3VycmVudE1vdmFibGUueSA9IHkgKyBjdXJyZW50TW92YWJsZS5fZHk7CiAgICB9CiAgICBjdXJyZW50TW92YWJsZS5fX29uX21vdmU/LigpOwogICAgaGFkTW92YWJsZSA9IHRydWU7CiAgfQoKICBwb2ludGVyLmRyYWcgPSBwb2ludGVyLmRvd247CgogIGlmIChwb2ludGVyLmRyYWcgJiYgdHlwZW9mIHBvaW50ZXJEcmFnICE9PSBgdW5kZWZpbmVkYCkgewogICAgcG9pbnRlckRyYWcoeCwgeSk7CiAgfQoKICBpZiAodHlwZW9mIHBvaW50ZXJNb3ZlICE9PSBgdW5kZWZpbmVkYCkgewogICAgcG9pbnRlck1vdmUoeCwgeSk7CiAgfQoKICBpZiAoaGFkTW92YWJsZSAmJiAhcGxheWluZykgcmVkcmF3KCk7Cn0KCltgdG91Y2hzdGFydGAsIGBtb3VzZWVudGVyYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKCkgPT4gewogICAgcG9pbnRlci5hY3RpdmUgPSB0cnVlOwogICAgX19wb2ludGVyQWN0aXZlKHRydWUpOwogIH0pOwp9KTsKCltgdG91Y2hlbmRgLCBgbW91c2VsZWF2ZWBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsICgpID0+IHsKICAgIF9fcG9pbnRlckFjdGl2ZShmYWxzZSk7CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyQWN0aXZlKGFjdGl2ZSkgewogIGlmICh0eXBlb2YgcG9pbnRlckFjdGl2ZSAhPT0gYHVuZGVmaW5lZGApIHsKICAgIHBvaW50ZXJBY3RpdmUoYWN0aXZlKTsKICB9Cn0KY29uc3QgX19BQlNUUkFDVF9QUk9KRUNUT1IgPSBTeW1ib2woYGFic3RyYWN0IHByb2plY3RvciBzdXBlcmNsYXNzYCk7CgovLyBHZW5lcmljIHByb2plY3RvciBzdXBlcmNsYXNzCmNsYXNzIFByb2plY3RvciB7CiAgLy8gYXhpYWwgYW5nbGVzIG9mIHJvdGF0aW9uCiAgWCA9IDA7CiAgWSA9IDA7CiAgWiA9IDA7CgogIC8vICJpbmZpbml0eSBsaWVzIGF0IGRpc3RhbmNlOiAuLi4iCiAgaW5maW5pdHkgPSBJbmZpbml0eTsKCiAgdHlwZSA9IF9fQUJTVFJBQ1RfUFJPSkVDVE9SOwoKICBzZXRJbmZpbml0eSgpIHsKICAgIC8vIGRvZXMgbm90aGluZyBieSBkZWZhdWx0CiAgfQoKICBzZXRSb3RhdGlvbih4ID0gMCwgeSA9IDAsIHogPSAwKSB7CiAgICB0aGlzLlggPSB4OwogICAgdGhpcy5aID0gejsKICAgIHRoaXMuWSA9IHk7CiAgfQoKICBUeCA9IDA7CiAgVHkgPSAwOwogIFR6ID0gMDsKCiAgc2V0VHJhbnNsYXRpb24oeCA9IDAsIHkgPSAwLCB6ID0gMCkgewogICAgdGhpcy5UeCA9IHg7CiAgICB0aGlzLlR6ID0gejsKICAgIHRoaXMuVHkgPSB5OwogIH0KCiAgU3ggPSAxOwogIFN5ID0gMTsKICBTeiA9IDE7CgogIHNldFNjYWxlKHggPSAxLCB5LCB6KSB7CiAgICBpZiAoeCAmJiAheSAmJiAheikgewogICAgICB6ID0geSA9IHg7CiAgICB9CiAgICB0aGlzLlN4ID0geDsKICAgIHRoaXMuU3ogPSB6OwogICAgdGhpcy5TeSA9IHk7CiAgfQoKICBwcm9qZWN0KHgsIHksIHopIHsKICAgIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyBpbXBsZW1lbnRhdGlvbiBmb3IgcHJvamVjdCh4LHkseikhYCk7CiAgfQp9CgovKioKICogY29kZSB1c2VkIGJ5IHByb2plY3QuanMsIGJ1dCBuYW1lZCBzbyB0aGF0IGl0IGxvYWRzCiAqIGZpcnN0LCBhbmQgZG9lcyBub3QgZ2V0IGFkZGVkIHRvIHRoZSBkLnRzIGZpbGUuCiAqLwpjbGFzcyBDYWJpbmV0UHJvamVjdG9yIGV4dGVuZHMgUHJvamVjdG9yIHsKICB0eXBlID0gQ0FCSU5FVDsKICBwaGkgPSAtUEkgLyA2OwoKICBzZXRQaGkocGhpKSB7CiAgICB0aGlzLnBoaSA9IHBoaTsKICB9CgogIHByb2plY3QoeCwgeSwgeikgewogICAgY29uc3QgeyBYLCBZLCBaLCBUeCwgVHksIFN4LCBTeSwgU3osIHBoaSB9ID0gdGhpczsKICAgIFt4LCB5LCB6XSA9IHRoaXMucm90YXRlKFgsIFksIFosIHggKiBTeCwgeSAqIFN5LCB6ICogU3opOwogICAgY29uc3QgYSA9IHk7CiAgICBjb25zdCBiID0gLXo7CiAgICBjb25zdCBjID0gLXggLyAyOwogICAgcmV0dXJuIG5ldyBQb2ludChUeCArIGEgKyBjICogY29zKHBoaSksIFR5ICsgYiArIGMgKiBzaW4ocGhpKSk7CiAgfQoKICByb3RhdGUoWCwgWSwgWiwgeCwgeSwgeikgewogICAgbGV0IFtBLCBCLCBDXSA9IFstWCwgLVksIFpdOwogICAgbGV0IGEgPSB4OwogICAgbGV0IGIgPSB5ICogY29zKEEpIC0geiAqIHNpbihBKTsKICAgIGxldCBjID0geSAqIHNpbihBKSArIHogKiBjb3MoQSk7CiAgICB4ID0gYTsKICAgIHkgPSBiOwogICAgeiA9IGM7CiAgICBhID0geCAqIGNvcyhCKSArIHogKiBzaW4oQik7CiAgICBiID0geTsKICAgIGMgPSB4ICogLXNpbihCKSArIHogKiBjb3MoQik7CiAgICB4ID0gYTsKICAgIHkgPSBiOwogICAgeiA9IGM7CiAgICBhID0geCAqIGNvcyhDKSAtIHkgKiBzaW4oQyk7CiAgICBiID0geCAqIHNpbihDKSArIHkgKiBjb3MoQyk7CiAgICBjID0gejsKCiAgICByZXR1cm4gW2EsIGIsIGNdOwogIH0KfQoKLyoqCiAqIGNvZGUgdXNlZCBieSBwcm9qZWN0LmpzLCBidXQgbmFtZWQgc28gdGhhdCBpdCBsb2FkcwogKiBmaXJzdCwgYW5kIGRvZXMgbm90IGdldCBhZGRlZCB0byB0aGUgZC50cyBmaWxlLgogKi8KY2xhc3MgSG9tb2dlbmVvdXNQcm9qZWN0b3IgZXh0ZW5kcyBQcm9qZWN0b3IgewogIHR5cGUgPSBIT01PR0VORU9VUzsKCiAgLy8gZWZmZWN0IGEgZGVmYXVsdCBwcm9qZWN0aW9uIHNpbWlsYXIgKGVub3VnaCkgdG8KICAvLyB0aGUgZGVmYXVsdCBjYWJpbmV0IHByb2plY3Rpb24KICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLnNldEluZmluaXR5KDIwMCk7CiAgICB0aGlzLnNldFJvdGF0aW9uKDAsIDAsIC0wLjM1KTsKICB9CgogIHNldEluZmluaXR5KGQpIHsKICAgIHRoaXMuaW5maW5pdHkgPSBkOwogIH0KCiAgcHJvamVjdCh4LCB5LCB6KSB7CiAgICBjb25zdCB7IFgsIFksIFosIGluZmluaXR5OiBkLCBUeCwgVHksIFR6LCBTeCwgU3ksIFN6IH0gPSB0aGlzOwogICAgY29uc3QgW1Z4LCBWeSwgVnpdID0gWyh5IC0gVHkpICogU3ksICgteiAtIFR6KSAqIFN6LCAoeCAtIFR4KSAqIFN4XTsKICAgIGNvbnN0IFtBLCBCLCBDXSA9IFtYLCBaLCBZXTsKCiAgICBjb25zdCBjeSA9IGNvcyhBKTsKICAgIGNvbnN0IHN5ID0gc2luKEEpOwogICAgY29uc3QgY3AgPSBjb3MoQik7CiAgICBjb25zdCBzcCA9IHNpbihCKTsKICAgIGNvbnN0IGNyID0gY29zKEMpOwogICAgY29uc3Qgc3IgPSBzaW4oQyk7CgogICAgLy8gcHJldHRpZXItaWdub3JlCiAgICAvLyBob21vZ2Vub3VzIGFmZmluZSB0cmFuc2Zvcm0gbWF0cml4CiAgICBjb25zdCBNID0gWwogICAgICAgY3AgKiBjeSwgKGN5ICogc3AgKiBzciAtIGNyICogc3kpLCAoY3IgKiBjeSAqIHNwICsgc3IgKiBzeSksIDAsCiAgICAgICBjcCAqIHN5LCAoY3IgKiBjeSArIHNwICogc3IgKiBzeSksIChjciAqIHNwICogc3kgLSBjeSAqIHNyKSwgMCwKICAgICAgLXNwLCAgICAgIGNwICogc3IsICAgICAgICAgICAgICAgICAgY3AgKiBjciwgICAgICAgICAgICAgICAgICAwLAogICAgICAgc3AgLyBkLCAtY3AgKiBzciAvIGQsICAgICAgICAgICAgIC1jcCAqIGNyIC8gZCwgICAgICAgICAgICAgIDEsCiAgICBdOwoKICAgIC8vIHByZXR0aWVyLWlnbm9yZQogICAgLy8gaG9tb2dlbmVvdXMgdHJhbnNmb3JtZWQgaW5wdXQgdmVjdG9yCiAgICBjb25zdCBbcHgsIHB5LCBfcHosIHddID0gWwogICAgICBWeCAqIE1bIDBdICsgVnkgKiBNWyAxXSArIFZ6ICogTVsgMl0gKyBNWyAzXSwKICAgICAgVnggKiBNWyA0XSArIFZ5ICogTVsgNV0gKyBWeiAqIE1bIDZdICsgTVsgN10sCjAsIC8vIFZ4ICogTVsgOF0gKyBWeSAqIE1bIDldICsgVnogKiBNWzEwXSArIE1bMTFdLCAvLyB3ZSBkb24ndCBhY3R1YWxseSB1c2UgegogICAgICBWeCAqIE1bMTJdICsgVnkgKiBNWzEzXSArIFZ6ICogTVsxNF0gKyBNWzE1XSwKICAgIF0KCiAgICAvLyBzY3JlZW4gY29vcmRpbmF0ZQogICAgcmV0dXJuIG5ldyBQb2ludChweCAvIHcsIHB5IC8gdyk7CiAgfQp9Ci8qKgogKiAuLi5kb2NzIGdvIGhlcmUuLi4KICovCmNsYXNzIFNoYXBlIHsKICBzZWdtZW50cyA9IFtdOwogIHJlc2l6YWJsZSA9IGZhbHNlOwogIGRpcnR5ID0gdHJ1ZTsKICBveCA9IDA7CiAgb3kgPSAwOwoKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMucGF0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhgaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdgLCBgcGF0aGApOwogICAgdGhpcy5uZXdTZWdtZW50KCk7CiAgfQoKICBtYWtlTW92YWJsZShtb3ZhYmxlID0gdHJ1ZSkgewogICAgaWYgKG1vdmFibGUpIHsKICAgICAgc2V0TW92YWJsZSh0aGlzKTsKICAgIH0gZWxzZSB7CiAgICAgIHVuc2V0TW92YWJsZSh0aGlzKTsKICAgIH0KICB9CgogIGFsbG93UmVzaXppbmcoYWxsb3dlZCA9IHRydWUpIHsKICAgIHRoaXMucmVzaXphYmxlID0gYWxsb3dlZDsKICB9CgogIGNsb3NlKCkgewogICAgdGhpcy5uZXdTZWdtZW50KHRydWUpOwogIH0KCiAgbmV3U2VnbWVudChjbG9zZUN1cnJlbnQgPSBmYWxzZSkgewogICAgY29uc3QgeyBzZWdtZW50cyB9ID0gdGhpczsKICAgIGlmIChzZWdtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHNlZ21lbnRzLnB1c2gobmV3IFNlZ21lbnQoKSk7CiAgICB9CiAgICBjb25zdCBjdXJyZW50ID0gc2VnbWVudHMuYXQoLTEpOwogICAgaWYgKGN1cnJlbnQ/LnBvaW50cy5sZW5ndGggfHwgY3VycmVudD8uaW5zdHJ1Y3Rpb25zLmxlbmd0aCkgewogICAgICBpZiAoY2xvc2VDdXJyZW50KSBjdXJyZW50LmNsb3NlKCk7CiAgICAgIHNlZ21lbnRzLnB1c2gobmV3IFNlZ21lbnQoKSk7CiAgICB9CiAgfQoKICBhZGQoeCwgeSkgewogICAgY29uc3Qgc2VnbWVudCA9IHRoaXMuc2VnbWVudHMuYXQoLTEpOwogICAgbGV0IHB0czsKICAgIGlmIChzZWdtZW50Lmluc3RydWN0aW9ucy5sZW5ndGgpIHsKICAgICAgcHRzID0gc2VnbWVudC5saW5lVG8oeCwgeSk7CiAgICB9IGVsc2UgewogICAgICBwdHMgPSBzZWdtZW50Lm1vdmVUbyh4LCB5KTsKICAgIH0KICAgIHRoaXMucmVjb3JkUG9pbnRzKHB0cyk7CiAgfQoKICByZWNvcmRQb2ludHMocHRzKSB7CiAgICBjb25zdCBzZWdtZW50ID0gdGhpcy5zZWdtZW50cy5hdCgtMSk7CiAgICBpZiAodGhpcy5yZXNpemFibGUpIHsKICAgICAgcHRzLmZvckVhY2goKHApID0+IHsKICAgICAgICBwLl9fb25fbW92ZSA9ICgpID0+IHsKICAgICAgICAgIHNlZ21lbnQuaW52YWxpZGF0ZSgpOwogICAgICAgIH07CiAgICAgICAgc2V0TW92YWJsZShwKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICBtb3ZlVG8oeCwgeSkgewogICAgdGhpcy5uZXdTZWdtZW50KCk7CiAgICB0aGlzLnJlY29yZFBvaW50cyh0aGlzLnNlZ21lbnRzLmF0KC0xKS5tb3ZlVG8oeCwgeSkpOwogIH0KCiAgbGluZVRvKC4uLmFyZ3MpIHsKICAgIHRoaXMucmVjb3JkUG9pbnRzKHRoaXMuc2VnbWVudHMuYXQoLTEpPy5saW5lVG8oLi4uYXJncykpOwogIH0KCiAgY3VydmVUbyguLi5hcmdzKSB7CiAgICB0aGlzLnJlY29yZFBvaW50cyh0aGlzLnNlZ21lbnRzLmF0KC0xKT8uY3VydmVUbyguLi5hcmdzKSk7CiAgfQoKICBxdWFkVG8oLi4uYXJncykgewogICAgdGhpcy5yZWNvcmRQb2ludHModGhpcy5zZWdtZW50cy5hdCgtMSk/LnF1YWRUbyguLi5hcmdzKSk7CiAgfQoKICBzcGxpbmVUbyguLi5hcmdzKSB7CiAgICB0aGlzLnJlY29yZFBvaW50cyh0aGlzLnNlZ21lbnRzLmF0KC0xKT8uc3BsaW5lVG8oLi4uYXJncykpOwogIH0KCiAgb2Zmc2V0KHgsIHkpIHsKICAgIHRoaXMub3ggPSB4OwogICAgdGhpcy5veSA9IHk7CiAgfQoKICBjb21taXQoKSB7CiAgICBjb25zdCB7IG94LCBveSwgc2VnbWVudHMgfSA9IHRoaXM7CiAgICBzZWdtZW50cy5mb3JFYWNoKChzKSA9PiBzLmNvbW1pdChveCwgb3kpKTsKICAgIHRoaXMucmVzZXQoKTsKICB9CgogIHJlc2V0KCkgewogICAgdGhpcy5vZmZzZXQoMCwgMCk7CiAgfQoKICBmbGlwU2VnbWVudCgpIHsKICAgIHRoaXMuc2VnbWVudHMuYXQoLTEpLmZsaXAoKTsKICB9CgogIG5vRmlsbCgpIHsKICAgIHRoaXMuc2V0RmlsbChgbm9uZWApOwogIH0KCiAgc2V0RmlsbChmaWxsKSB7CiAgICBpZiAodGhpcy5maWxsU3R5bGUgIT09IGZpbGwpIHsKICAgICAgdGhpcy5maWxsU3R5bGUgPSBmaWxsOwogICAgfQogIH0KCiAgbm9TdHJva2UoKSB7CiAgICB0aGlzLnNldFN0cm9rZShgbm9uZWApOwogIH0KCiAgc2V0U3Ryb2tlKHN0cm9rZSkgewogICAgaWYgKHRoaXMuc3Ryb2tlU3R5bGUgIT09IHN0cm9rZSkgewogICAgICB0aGlzLnN0cm9rZVN0eWxlID0gc3Ryb2tlOwogICAgfQogIH0KCiAgc2hvd1BvaW50cyhzaG93UG9pbnRzID0gdHJ1ZSkgewogICAgaWYgKHRoaXMuX19zaG93UG9pbnRzICE9PSBzaG93UG9pbnRzKSB7CiAgICAgIHRoaXMuX19zaG93UG9pbnRzID0gc2hvd1BvaW50czsKICAgIH0KICB9CgogIGFzeW5jIGRyYXcoKSB7CiAgICBjb25zdCB7IG94LCBveSwgc2VnbWVudHMsIF9fc2hvd1BvaW50cyB9ID0gdGhpczsKICAgIHNhdmUoKTsKICAgIHRyYW5zbGF0ZShveCwgb3kpOwogICAgc2V0U3Ryb2tlKHRoaXMuc3Ryb2tlU3R5bGUpOwogICAgc2V0RmlsbCh0aGlzLmZpbGxTdHlsZSk7CiAgICBzdGFydCgpOwogICAgc2VnbWVudHMuZm9yRWFjaCgocykgPT4gcy5kcmF3KCkpOwogICAgZW5kKCk7CiAgICBpZiAoX19zaG93UG9pbnRzKSBzZWdtZW50cy5mb3JFYWNoKChzKSA9PiBzLmRyYXdQb2ludHMoKSk7CiAgICB0cmFuc2xhdGUoLW94LCAtb3kpOwogICAgcmVzdG9yZSgpOwogIH0KCiAgaW5zaWRlKHgsIHkpIHsKICAgIGNvbnN0IHsgb3gsIG95LCBwYXRoLCBzZWdtZW50cyB9ID0gdGhpczsKICAgIGNvbnN0IGQgPSBzZWdtZW50cy5tYXAoKHMpID0+IHMuZ2V0UGF0aCgpKS5qb2luKGAgYCk7CiAgICBwYXRoLnNldEF0dHJpYnV0ZShgZGAsIGQpOwogICAgLy8gT2ggZm9yIGZ1Y2sncyBzYWtlLCBDaHJvbWUsIGhvdyBoYXJkIGlzIGl0IHRvIGtlZXAgdXAgd2l0aCBhIHN0YW5kYXJkCiAgICAvLyB0aGF0IHlvdSdyZSBhbiBlZGl0b3IgZm9yPyBodHRwczovL2lzc3Vlcy5jaHJvbWl1bS5vcmcvaXNzdWVzLzQwNTcyODg3CiAgICAvLyBjb25zdCBwID0gbmV3IERPTVBvaW50KHggLSBveCwgeSAtIG95KTsKICAgIC8vIGlmIChwYXRoLmlzUG9pbnRJbkZpbGwocCkpIHJldHVybiB0cnVlOwogICAgLy8gaWYgKHBhdGguaXNQb2ludEluU3Ryb2tlKHApKSByZXR1cm4gdHJ1ZTsKICAgIGNvbnN0IHAgPSBuZXcgUGF0aDJEKHBhdGgpOwogICAgaWYgKF9fY3R4LmlzUG9pbnRJblBhdGgocCwgeCAtIG94LCB5IC0gb3kpKSByZXR1cm4gdHJ1ZTsKICAgIGlmIChfX2N0eC5pc1BvaW50SW5TdHJva2UocCwgeCAtIG94LCB5IC0gb3kpKSByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiBmYWxzZTsKICB9Cn0KCi8qKgogKiAuLi5kb2NzIGdvIGhlcmUuLi4KICovCmNsYXNzIFNlZ21lbnQgewogIHBvaW50cyA9IFtdOwogIGluc3RydWN0aW9ucyA9IFtdOwoKICBjbG9zZWQgPSBmYWxzZTsKICBzdmdfZCA9IGBgOwoKICBhZGQoeCwgeSkgewogICAgY29uc3QgeyBjbG9zZWQsIHBvaW50cyB9ID0gdGhpczsKICAgIGlmIChjbG9zZWQpIHJldHVybjsKICAgIGNvbnN0IHAgPSB7IHgsIHkgfTsKICAgIHBvaW50cy5wdXNoKHApOwogICAgcmV0dXJuIHA7CiAgfQoKICBjb21taXQoeCwgeSkgewogICAgdGhpcy5pbnN0cnVjdGlvbnMuZm9yRWFjaCgocCkgPT4gewogICAgICBwLnggKz0geDsKICAgICAgcC55ICs9IHk7CiAgICB9KTsKICAgIHRoaXMuaW52YWxpZGF0ZSgpOwogIH0KCiAgZmxpcCgpIHsKICAgIGNvbnN0IHsgaW5zdHJ1Y3Rpb25zIH0gPSB0aGlzOwogICAgaW5zdHJ1Y3Rpb25zLnJldmVyc2UoKTsKICAgIC8vIHJlbWVtYmVyIHRvIHJlbG9jYXRlIG91ciBtb3ZlVG8hCiAgICBpbnN0cnVjdGlvbnMudW5zaGlmdChpbnN0cnVjdGlvbnMucG9wKCkpOwogICAgdGhpcy5pbnZhbGlkYXRlKCk7CiAgfQoKICAjaW5zdHJ1Y3Rpb24odHlwZU5hbWUsIC4uLmFyZ3MpIHsKICAgIGxldCBwb2ludHMgPSBhcmdzOwoKICAgIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gYG51bWJlcmApIHsKICAgICAgcG9pbnRzID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkgKz0gMikgewogICAgICAgIHBvaW50cy5wdXNoKHsgeDogYXJnc1tpXSwgeTogYXJnc1tpICsgMV0gfSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBzZWUgZHJhdy5zcGxpbmUoLi4uYXJncykKICAgIGxldCBUID0gMTsKICAgIGlmICh0eXBlTmFtZSA9PT0gYHNwbGluZWApIHsKICAgICAgaWYgKGFyZ3MubGVuZ3RoICUgMiA9PT0gMSkgewogICAgICAgIFtUXSA9IGFyZ3Muc3BsaWNlKGFyZ3MubGVuZ3RoIC0gMSwgMSk7CiAgICAgICAgcG9pbnRzLnBvcCgpOwogICAgICB9CiAgICB9CgogICAgcG9pbnRzLmZvckVhY2goKHApID0+IHsKICAgICAgcFt0eXBlTmFtZV0gPSB0cnVlOwogICAgICBpZiAodHlwZU5hbWUgPT09IGBzcGxpbmVgKSBwLlQgPSBUOwogICAgICB0aGlzLmluc3RydWN0aW9ucy5wdXNoKHApOwogICAgfSk7CgogICAgdGhpcy5pbnZhbGlkYXRlKCk7CiAgICByZXR1cm4gcG9pbnRzOwogIH0KCiAgbW92ZVRvKHgsIHkpIHsKICAgIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgICB5ID0geC55OwogICAgICB4ID0geC54OwogICAgfQogICAgcmV0dXJuIHRoaXMuI2luc3RydWN0aW9uKGBtb3ZlYCwgeCwgeSk7CiAgfQoKICBsaW5lVG8oLi4uYXJncykgewogICAgcmV0dXJuIHRoaXMuI2luc3RydWN0aW9uKGBsaW5lYCwgLi4uYXJncyk7CiAgfQoKICBjdXJ2ZVRvKC4uLmFyZ3MpIHsKICAgIHJldHVybiB0aGlzLiNpbnN0cnVjdGlvbihgYmV6aWVyYCwgLi4uYXJncyk7CiAgfQoKICBxdWFkVG8oLi4uYXJncykgewogICAgcmV0dXJuIHRoaXMuI2luc3RydWN0aW9uKGBxdWFkYCwgLi4uYXJncyk7CiAgfQoKICBzcGxpbmVUbyguLi5hcmdzKSB7CiAgICByZXR1cm4gdGhpcy4jaW5zdHJ1Y3Rpb24oYHNwbGluZWAsIC4uLmFyZ3MpOwogIH0KCiAgY2xvc2UoKSB7CiAgICB0aGlzLmNsb3NlZCA9IHRydWU7CiAgICB0aGlzLmludmFsaWRhdGUoKTsKICB9CgogIGludmFsaWRhdGUoKSB7CiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICB9CgogIGNoZWNrRGlydHkoKSB7CiAgICBpZiAodGhpcy5kaXJ0eSB8fCAhdGhpcy53aXRob3V0U3BsaW5lcykgewogICAgICB0aGlzLnVwZGF0ZVNWRygpOwogICAgICB0aGlzLndpdGhvdXRTcGxpbmVzID0gdGhpcy5pbnN0cnVjdGlvbnMuc2xpY2UoKTsKICAgICAgdGhpcy5yZXBsYWNlU3BsaW5lV2l0aEJlemllcnModGhpcy53aXRob3V0U3BsaW5lcyk7CiAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgIH0KICB9CgogIGRyYXcoKSB7CiAgICB0aGlzLmNoZWNrRGlydHkoKTsKICAgIGNvbnN0IG9wcyA9IHRoaXMud2l0aG91dFNwbGluZXMuc2xpY2UoKTsKCiAgICBjb25zdCBiMiA9ICh0LCBhLCBiLCBjKSA9PiB7CiAgICAgIGNvbnN0IG10ID0gMSAtIHQ7CiAgICAgIHJldHVybiBhICogbXQgKiogMiArIDIgKiBiICogbXQgKiB0ICsgYyAqIHQgKiogMjsKICAgIH07CgogICAgY29uc3QgYjMgPSAodCwgYSwgYiwgYywgZCkgPT4gewogICAgICBjb25zdCBtdCA9IDEgLSB0OwogICAgICByZXR1cm4gKAogICAgICAgIGEgKiBtdCAqKiAzICsgMyAqIGIgKiBtdCAqKiAyICogdCArIDMgKiBjICogbXQgKiB0ICoqIDIgKyBkICogdCAqKiAzCiAgICAgICk7CiAgICB9OwoKICAgIGNvbnN0IHZ0eCA9IChwKSA9PiB7CiAgICAgIHZlcnRleChwLngsIHAueSk7CiAgICB9OwoKICAgIGNvbnN0IFtmaXJzdF0gPSB0aGlzLmluc3RydWN0aW9uczsKICAgIGxldCBsYXN0OwogICAgd2hpbGUgKG9wcy5sZW5ndGgpIHsKICAgICAgY29uc3QgcCA9IG9wcy5zaGlmdCgpOwogICAgICBpZiAocC5tb3ZlKSB7CiAgICAgICAgX19jdHgubW92ZVRvKHAueCwgcC55KTsKICAgICAgfQogICAgICBpZiAocC5tb3ZlIHx8IHAubGluZSkgewogICAgICAgIHZ0eChwKTsKICAgICAgICBsYXN0ID0gcDsKICAgICAgfQogICAgICBpZiAocC5xdWFkKSB7CiAgICAgICAgY29uc3QgbiA9IG9wcy5zaGlmdCgpOwogICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgMTsgdCArPSAwLjA1KSB7CiAgICAgICAgICB2dHgoeyB4OiBiMih0LCBsYXN0LngsIHAueCwgbi54KSwgeTogYjIodCwgbGFzdC55LCBwLnksIG4ueSkgfSk7CiAgICAgICAgfQogICAgICAgIHZ0eChuKTsKICAgICAgICBsYXN0ID0gbjsKICAgICAgfQogICAgICBpZiAocC5iZXppZXIpIHsKICAgICAgICBjb25zdCBuID0gb3BzLnNoaWZ0KCk7CiAgICAgICAgY29uc3QgbjIgPSBvcHMuc2hpZnQoKTsKICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IDE7IHQgKz0gMC4wMykgewogICAgICAgICAgdnR4KHsKICAgICAgICAgICAgeDogYjModCwgbGFzdC54LCBwLngsIG4ueCwgbjIueCksCiAgICAgICAgICAgIHk6IGIzKHQsIGxhc3QueSwgcC55LCBuLnksIG4yLnkpLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHZ0eChuMik7CiAgICAgICAgbGFzdCA9IG4yOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5jbG9zZWQpIHZ0eChmaXJzdCk7CiAgfQoKICBkcmF3UG9pbnRzKCkgewogICAgZm9yIChsZXQgcCBvZiB0aGlzLmluc3RydWN0aW9ucykgcG9pbnQocCk7CiAgfQoKICBnZXRQYXRoKCkgewogICAgdGhpcy5jaGVja0RpcnR5KCk7CiAgICByZXR1cm4gdGhpcy5zdmdfZDsKICB9CgogIHVwZGF0ZVNWRygpIHsKICAgIGxldCBkID0gYGA7CiAgICBjb25zdCBvcHMgPSB0aGlzLmluc3RydWN0aW9ucy5zbGljZSgpOwogICAgdGhpcy5yZXBsYWNlU3BsaW5lV2l0aEJlemllcnMob3BzKTsKICAgIHdoaWxlIChvcHMubGVuZ3RoKSB7CiAgICAgIGNvbnN0IHAgPSBvcHMuc2hpZnQoKTsKICAgICAgaWYgKHAubW92ZSkgZCA9IGBNICR7cC54fSAke3AueX1gOwogICAgICBpZiAocC5saW5lKSBkID0gYCR7ZH0gTCAke3AueH0gJHtwLnl9YDsKICAgICAgaWYgKHAucXVhZCkgewogICAgICAgIGNvbnN0IG9wID0gb3BzLnNoaWZ0KCk7CiAgICAgICAgZCA9IGAke2R9IFEgJHtwLnh9ICR7cC55fSAke29wLnh9ICR7b3AueX1gOwogICAgICB9CiAgICAgIGlmIChwLmJlemllcikgewogICAgICAgIGNvbnN0IG9wMiA9IG9wcy5zaGlmdCgpOwogICAgICAgIGNvbnN0IG9wMyA9IG9wcy5zaGlmdCgpOwogICAgICAgIGQgPSBgJHtkfSBDICR7cC54fSAke3AueX0gJHtvcDIueH0gJHtvcDIueX0gJHtvcDMueH0gJHtvcDMueX1gOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5jbG9zZWQpIGQgKz0gYCBaYDsKICAgIHRoaXMuc3ZnX2QgPSBkOwogIH0KCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIC8vIENvZGUgKmp1c3QqIGZvciBjb252ZXJ0aW5nIGNhcmRpbmFsIHNwbGluZXMgaW50byBwb2x5LUJlemllcnMKICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogIHJlcGxhY2VTcGxpbmVXaXRoQmV6aWVycyhvcHMpIHsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChvcHNbaV0uc3BsaW5lKSB7CiAgICAgICAgdGhpcy5jb252ZXJ0U3BsaW5lKG9wcywgaSk7CiAgICAgIH0KICAgIH0KICB9CgogIGNvbnZlcnRTcGxpbmUob3BzLCBpKSB7CiAgICBjb25zdCBzcGxpbmVzID0gW107CiAgICAvLyByZW1vdmUgdGhlIHNlcXVlbmNlIG9mIHNwbGluZSBwb2ludHMgc3RhcnRpbmcgYXQgb3BzW2ldCiAgICB3aGlsZSAob3BzW2ldICYmIG9wc1tpXS5zcGxpbmUpIHNwbGluZXMucHVzaChvcHMuc3BsaWNlKGksIDEpWzBdKTsKICAgIC8vIGluamVjdCB0aGUgZXF1aXZhbGVudCBiZXppZXIgc2VxdWVuY2UKICAgIG9wcy5zcGxpY2UoaSwgMCwgLi4udGhpcy5zcGxpbmVQb2ludHNUb0JlemllclBvaW50cyhzcGxpbmVzLCBvcHMsIGkpKTsKICB9CgogIHNwbGluZVBvaW50c1RvQmV6aWVyUG9pbnRzKHNwbGluZXMsIG9wcywgaSkgewogICAgbGV0IGJlemllcnMgPSBbXTsKICAgIGxldCBxMSA9IG9wcy5hdChpIC0gMik7CiAgICBsZXQgcTIgPSBvcHMuYXQoaSAtIDEpOwogICAgbGV0IHEzLCBxNDsKICAgIGxldCBwID0gc3BsaW5lc1swXTsKCiAgICAvLyBUaGUgZmlyc3QgIHNlZ21lbnQgbmVlZHMgc3BlY2lhbCBoYW5kbGluZyB0bwogICAgLy8gZW5zdXJlIHRoZSBkZXBhcnR1cmUgdGFuZ2VudCBpcyBjb3JyZWN0LgogICAgcTMgPSBzcGxpbmVzWzFdID8/IG9wc1tpXSA/PyBvcHNbMF07CiAgICBiZXppZXJzLnB1c2goLi4udGhpcy5maXJzdFNwbGluZVRvQmV6aWVyKHExLCBxMiwgcCwgcTMpKTsKCiAgICAvLyBJbnRlcm1lZGlhdGUgc2VnbWVudHMgYXJlICJub3JtYWwgY29udmVyc2lvbiBtYXRoIi4KICAgIGZvciAobGV0IGogPSAxOyBqIDwgc3BsaW5lcy5sZW5ndGg7IGorKykgewogICAgICBxMSA9IHEyOwogICAgICBxMiA9IHA7CiAgICAgIHAgPSBzcGxpbmVzW2pdOwogICAgICBxMyA9IHNwbGluZXNbaiArIDFdID8/IG9wc1tpXSA/PyBvcHNbMF07CiAgICAgIGJlemllcnMucHVzaCguLi50aGlzLmZ1bGxTcGxpbmVUb0JlemllcihxMSwgcTIsIHAsIHEzKSk7CiAgICB9CgogICAgLy8gVGhlIGxhc3Qgc2VnbWVudCBuZWVkcyBzcGVjaWFsIGhhbmRsaW5nIHRvCiAgICAvLyBlbnN1cmUgdGhlIGFycml2YWwgdGFuZ2VudCBpcyBjb3JyZWN0LgogICAgcTMgPSBvcHNbaV0gPz8gb3BzWzBdOwogICAgcTQgPSBvcHNbaSArIDFdID8/IG9wc1sxXTsKICAgIGJlemllcnMucHVzaCguLi50aGlzLmxhc3RTcGxpbmVUb0JlemllcihxMiwgcCwgcTMsIHE0KSk7CgogICAgcmV0dXJuIGJlemllcnM7CiAgfQoKICAvLyBwMyBpcyBvdXIgcHJpbmNpcGFsIHBvaW50CiAgZmlyc3RTcGxpbmVUb0JlemllcihwMSwgcDIsIHAzLCBwNCkgewogICAgLy8gUmVwb3NpdGlvbiBwMSBzbyB0aGF0IHRoZSB0YW5nZW50IGF0CiAgICAvLyBwMiB3aWxsIG1hdGNoIHRoZSBhY3R1YWwgdGFuZ2VudCBhdCBwMi4KICAgIHAxID0gdGhpcy51cGRhdGVGcm9tVGFuZ2VudChwMSwgcDIsIHAzKTsKICAgIHJldHVybiB0aGlzLmZ1bGxTcGxpbmVUb0JlemllcihwMSwgcDIsIHAzLCBwNCk7CiAgfQoKICAvLyBwMiBpcyBvdXIgcHJpbmNpcGFsIHBvaW50CiAgbGFzdFNwbGluZVRvQmV6aWVyKHAxLCBwMiwgcDMsIHA0KSB7CiAgICAvLyBSZXBvc2l0aW9uIHA0IHNvIHRoYXQgdGhlIHRhbmdlbnQgYXQKICAgIC8vIHAzIHdpbGwgbWF0Y2ggdGhlIGFjdHVhbCB0YW5nZW50IGF0IHAzLgogICAgcDQgPSB0aGlzLnVwZGF0ZUZyb21UYW5nZW50KHA0LCBwMywgcDIpOwogICAgcmV0dXJuIHRoaXMuZnVsbFNwbGluZVRvQmV6aWVyKHAxLCBwMiwgcDMsIHA0KTsKICB9CgogIC8vIGNyZWF0ZSB0aGUgQmV6aWVyIGVxdWl2YWxlbnQgb2YgcDItLXAzCiAgZnVsbFNwbGluZVRvQmV6aWVyKHAxLCBwMiwgcDMsIHA0KSB7CiAgICBjb25zdCBUID0gcDMuVCA/PyBwMi5UID8/IDE7CiAgICBjb25zdCB0ZW5zaW9uID0gNiAqIFQ7CiAgICByZXR1cm4gWwogICAgICB7CiAgICAgICAgYmV6aWVyOiB0cnVlLAogICAgICAgIHg6IHAyLnggKyAocDMueCAtIHAxLngpIC8gdGVuc2lvbiwKICAgICAgICB5OiBwMi55ICsgKHAzLnkgLSBwMS55KSAvIHRlbnNpb24sCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBiZXppZXI6IHRydWUsCiAgICAgICAgeDogcDMueCAtIChwNC54IC0gcDIueCkgLyB0ZW5zaW9uLAogICAgICAgIHk6IHAzLnkgLSAocDQueSAtIHAyLnkpIC8gdGVuc2lvbiwKICAgICAgfSwKICAgICAgeyBiZXppZXI6IHRydWUsIHg6IHAzLngsIHk6IHAzLnkgfSwKICAgIF07CiAgfQoKICB1cGRhdGVGcm9tVGFuZ2VudChxMSwgcTIsIHAzKSB7CiAgICAvLyBObyBtYXR0ZXIgd2hldGhlciBxMSBhbmQgcTIgYXJlIGxpbmUgb3IKICAgIC8vIGJlemllciBjb29yZGluYXRlcywgdGhlIGxvZ2ljIGlzIHRoZSBzYW1lLgogICAgcmV0dXJuIHsKICAgICAgdGFuZ2VudENvcnJlY3Rpb246IHRydWUsCiAgICAgIHg6IHAzLnggKyAocTEueCAtIHEyLngpLAogICAgICB5OiBwMy55ICsgKHExLnkgLSBxMi55KSwKICAgIH07CiAgfQp9CmNsYXNzIFZlY3RvciB7CiAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHsKICAgICAgeiA9IHguejsKICAgICAgeSA9IHgueTsKICAgICAgeCA9IHgueDsKICAgIH0KICAgIHRoaXMueCA9IHg7CiAgICB0aGlzLnkgPSB5OwogICAgaWYgKHogIT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLnogPSB6OwogICAgfQogIH0KCiAgZGlzdChvdGhlciwgeSwgeiA9IDApIHsKICAgIGlmICh5ICE9PSB1bmRlZmluZWQpIG90aGVyID0geyB4OiBvdGhlciwgeSwgeiB9OwogICAgbGV0IHN1bSA9IDA7CiAgICBzdW0gKz0gKHRoaXMueCAtIG90aGVyLngpICoqIDI7CiAgICBzdW0gKz0gKHRoaXMueSAtIG90aGVyLnkpICoqIDI7CiAgICBsZXQgejEgPSB0aGlzLnogPyB0aGlzLnogOiAwOwogICAgbGV0IHoyID0gb3RoZXIueiA/IG90aGVyLnogOiAwOwogICAgc3VtICs9ICh6MSAtIHoyKSAqKiAyOwogICAgcmV0dXJuIHN1bSAqKiAwLjU7CiAgfQoKICBub3JtYWxpemUoZikgewogICAgbGV0IG1hZyA9IHRoaXMuZGlzdCgwLCAwLCAwKTsKICAgIHJldHVybiBuZXcgVmVjdG9yKAogICAgICAoZiAqIHRoaXMueCkgLyBtYWcsCiAgICAgIChmICogdGhpcy55KSAvIG1hZywKICAgICAgKGYgKiB0aGlzLnopIC8gbWFnCiAgICApOwogIH0KCiAgZ2V0QW5nbGUoKSB7CiAgICByZXR1cm4gLU1hdGguYXRhbjIodGhpcy55LCB0aGlzLngpOwogIH0KCiAgcmVmbGVjdChvdGhlcikgewogICAgbGV0IHAgPSBuZXcgVmVjdG9yKG90aGVyLnggLSB0aGlzLngsIG90aGVyLnkgLSB0aGlzLnkpOwogICAgaWYgKG90aGVyLnogIT09IHVuZGVmaW5lZCkgewogICAgICBwLnogPSBvdGhlci56OwogICAgICBpZiAodGhpcy56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBwLnogLT0gdGhpcy56OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5zdWJ0cmFjdChwKTsKICB9CgogIGFkZChvdGhlcikgewogICAgbGV0IHAgPSBuZXcgVmVjdG9yKHRoaXMueCArIG90aGVyLngsIHRoaXMueSArIG90aGVyLnkpOwogICAgaWYgKHRoaXMueiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHAueiA9IHRoaXMuejsKICAgICAgaWYgKG90aGVyLnogIT09IHVuZGVmaW5lZCkgewogICAgICAgIHAueiArPSBvdGhlci56OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcDsKICB9CgogIHN1YnRyYWN0KG90aGVyKSB7CiAgICBsZXQgcCA9IG5ldyBWZWN0b3IodGhpcy54IC0gb3RoZXIueCwgdGhpcy55IC0gb3RoZXIueSk7CiAgICBpZiAodGhpcy56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcC56ID0gdGhpcy56OwogICAgICBpZiAob3RoZXIueiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcC56IC09IG90aGVyLno7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwOwogIH0KCiAgc2NhbGUoZiA9IDEpIHsKICAgIGlmIChmID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgVmVjdG9yKDAsIDAsIHRoaXMueiA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogMCk7CiAgICB9CiAgICBsZXQgcCA9IG5ldyBWZWN0b3IodGhpcy54ICogZiwgdGhpcy55ICogZik7CiAgICBpZiAodGhpcy56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcC56ID0gdGhpcy56ICogZjsKICAgIH0KICAgIHJldHVybiBwOwogIH0KfQovKioKICogRW5zdXJlIHRoYXQgdGhlcmUgaXMgbm8gYm9yZGVyIGFyb3VuZCB0aGUgY2FudmFzIGVsZW1lbnQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEJvcmRlcig1LCBgcmVkYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgdGV4dChgY2xpY2sgbWVgLCB3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyVXAoeCwgeSkgewogKiAgICAgICBzZXRCb3JkZXIoNSwgYHJlZGApOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCwgeSkgewogKiAgICAgICBub0JvcmRlcigpOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldEJvcmRlcn0KICovCmZ1bmN0aW9uIG5vQm9yZGVyKCkgewogIHNldEJvcmRlcihmYWxzZSk7Cn0KCi8qKgogKiBEaXNhYmxlIGJvdGggc3Ryb2tlIGFuZCBmaWxsIGNvbG9yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoYE5vdyB5b3Ugc2VlIG1lYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vQ29sb3IoKTsKICogICAgICAgdGV4dChgTm93IHlvdSBkb24ndGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldENvbG9yfQogKiBAc2VlIHtAbGluayBub1N0cm9rZX0KICogQHNlZSB7QGxpbmsgbm9GaWxsfQogKi8KZnVuY3Rpb24gbm9Db2xvcigpIHsKICBub0ZpbGwoKTsKICBub1N0cm9rZSgpOwp9CgovKioKICogSGlkZSB0aGUgY3Vyc29yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGAjRkYwMmApOwogKiAgICAgICByZWN0KDAsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIHNldENvbG9yKGAjMEZGMmApOwogKiAgICAgICByZWN0KHdpZHRoLzIsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSh4LCB5KSB7CiAqICAgICAgIGlmICh4IDwgd2lkdGgvMikgewogKiAgICAgICAgIHNldEN1cnNvcihBVVRPKTsKICogICAgICAgfSBlbHNlIHsKICogICAgICAgICBub0N1cnNvcigpOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2V0Q3Vyc29yfQogKi8KZnVuY3Rpb24gbm9DdXJzb3IoKSB7CiAgX19jYW52YXMuc3R5bGUuY3Vyc29yID0gYG5vbmVgOwp9CgovKioKICogRGlzYWJsZSB0aGUgZmlsbCBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICByZWN0KDIwLCA3MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgZmlsbGVkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICByZWN0KDMwLCA4MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgbm90IGZpbGxlZGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldEZpbGx9CiAqLwpmdW5jdGlvbiBub0ZpbGwoKSB7CiAgc2V0RmlsbChgdHJhbnNwYXJlbnRgKTsKfQoKLyoqCiAqIERpc2FibGUgdGhlIGRlZmF1bHQgZ3JpZCBiYWNrZ3JvdW5kLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoYGNsaWNrIG1lYCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlclVwKHgsIHkpIHsKICogICAgICAgc2V0R3JpZCgyMCwgYGxpZ2h0Z3JleWApOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCwgeSkgewogKiAgICAgICBub0dyaWQoKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRHcmlkfQogKi8KZnVuY3Rpb24gbm9HcmlkKCkgewogIF9fZHJhd19ncmlkID0gZmFsc2U7Cn0KCi8qKgogKiBTZXQgdGhlIGxpbmUgc3Ryb2tlIHRvICJzb2xpZCIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldExpbmVEYXNoKDEpOwogKiAgICAgICBsaW5lKDAsMjAsd2lkdGgsNTApOwogKiAgICAgICBzZXRMaW5lRGFzaCg1KTsKICogICAgICAgbGluZSgwLDMwLHdpZHRoLDkwKTsKICogICAgICAgc2V0TGluZURhc2goMSwyLDMsNCk7CiAqICAgICAgIGxpbmUoMCw0MCx3aWR0aCwxMzApOwogKiAgICAgICBub0xpbmVEYXNoKCk7CiAqICAgICAgIGxpbmUoMCw1MCx3aWR0aCwxODApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldExpbmVEYXNofQogKi8KCmZ1bmN0aW9uIG5vTGluZURhc2goKSB7CiAgX19jdHguc2V0TGluZURhc2goW10pOwp9CgovKioKICogRGlzYWJsZSB0aGUgc3Ryb2tlIGNvbG9yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dFN0cm9rZSgxKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHJlY3QoMjAsIDcwLCAyMCwgMjApOwogKiAgICAgICB0ZXh0KGBzdHJva2VkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vU3Ryb2tlKCk7CiAqICAgICAgIHJlY3QoNDIsIDgyLCAyMCwgMjApOwogKiAgICAgICB0ZXh0KGBub3Qgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldFN0cm9rZX0KICovCgpmdW5jdGlvbiBub1N0cm9rZSgpIHsKICBzZXRTdHJva2UoYHRyYW5zcGFyZW50YCk7Cn0KCi8qKgogKiBEaXNhYmxlIHRleHQgc3Ryb2tpbmcsIGJ1dCBub3QgcmVndWxhciBzaGFwZSBzdHJva2luZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICByZWN0KDIwLCA3MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub1RleHRTdHJva2UoKTsKICogICAgICAgcmVjdCg0MiwgODIsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYG5vdCBzdHJva2VkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgKyAyNSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2V0VGV4dFN0cm9rZX0KICovCgpmdW5jdGlvbiBub1RleHRTdHJva2UoKSB7CiAgc2V0VGV4dFN0cm9rZShmYWxzZSwgdW5kZWZpbmVkKTsKfQovKioKICogQWRkIGEgc2xpZGVyIHRvIHlvdXIgZmlndXJlLCBhbGxvd2luZyB1c2VycyB0byBjb250cm9sCiAqIGEgdmFyaWFibGUgaW4geW91ciBncmFwaGljcyBjb2RlIGRpcmVjdGx5IGJ5IGludGVyYWN0aW5nCiAqIHdpdGggdGhhdCBvbi1wYWdlIHNsaWRlciwgd2hpY2ggaXMgZXNwZWNpYWxseSBpbXBvcnRhbnQgaWYKICogeW91IHdhbnQgeW91ciBncmFwaGljcyB0byBiZSB1c2VhYmxlIGJ5IHVzZXJzIHdobyBkb24ndAogKiBoYXZlLCBvciBjYW5ub3QgdXNlLCBhIG1vdXNlLgogKgogKiBUaGUgYHByb3BMYWJlbGAgdmFsdWUgc2hvdWxkIGJlIHRoZSBuYW1lIG9mIHRoZSB2YXJpYWJsZQogKiB0aGF0IHlvdXIgZ3JhcGhpY3MgY29kZSB1c2VzLCBhbmQgc2hvdWxkIF9ub3RfIGJlICJwcmVhbGxvY2F0ZWQiCiAqIGluIHlvdXIgY29kZSB3aXRoIGEgY29uc3QsIGxldCwgb3IgdmFyOiBpdCB3aWxsIGF1dG9tYXRpY2FsbHkKICogZ2V0IGFkZGVkIGFzIHBhcnQgb2YgdGhlIHNvdXJjZSBsb2FkaW5nIHByb2Nlc3MuCiAqCiAqIFRoZSBvcHRpb25zIG9iamVjdCBhY2NlcHRzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllcyBhbmQgdmFsdWVzOgogKgogKiAtIG1pbiAtIHRoZSBzbGlkZXIncyBtaW5pbXVtIHZhbHVlLCBkZWZhdWx0cyB0byAwCiAqIC0gbWF4IC0gdGhlIHNsaWRlcidzIG1heGltdW0gdmFsdWUsIGRlZmF1bHRzIHRvIDEKICogLSBzdGVwIC0gdGhlIHN0ZXAgc2l6ZSwgZGVmYXVsdHMgdG8gKG1heCAtIG1pbikvMTAKICogLSB2YWx1ZSAtIHRoZSBpbml0aWFsIHZhbHVlLCBkZWZhdWx0cyB0byAobWF4ICsgbWluKS8yCiAqIC0gY2xhc3NlcyAtIHRoZSBDU1MgY2xhc3NlcyB0aGF0IHdpbGwgYmUgdXNlZCwgZGVmYXVsdHMgdG8gYCJzbGlkZXIiYAogKiAtIHRyYW5zZm9ybSAtIGEgdmFsdWUgcHJlcHJvY2Vzc29yICBkZWZhdWx0cyB0byAodikgPT4gdgogKgogKiBUaGUgYHRyYW5zZm9ybWAgcHJlLXByb2Nlc3NvciBydW5zIGFmdGVyIHRoZSB1c2VyIHVwZGF0ZXMKICogdGhlIHNsaWRlciwgYnV0IGJlZm9yZSBpdHMgdmFsdWUgZ2V0cyBhc3NpZ25lZCB0byB5b3VyIHZhcmlhYmxlLAogKiBzbyB0aGF0IHlvdSBjYW4gbWFwIGl0IHRvIHNvbWV0aGluZyBlbHNlIChmb3IgaW5zdGFuY2UsIG51bWJlcnMKICogaW4gb25lIHJhbmdlIHRvIG51bWJlcnMgaW4gYSBjb21wbGV0ZWx5IGRpZmZlcmVudCByYW5nZSwgb3IgZXZlbgogKiBudW1iZXJzIHRvIHN0cmluZ3Mgb3IgZW50aXJlIG9iamVjdHMpCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSg0MDAsIDIwMCk7CiAqICAgICAgIGFkZFNsaWRlcihgYmdDb2xvcmAsIHsKICogICAgICAgICBtaW46IDAsCiAqICAgICAgICAgbWF4OiAyNTUsCiAqICAgICAgICAgc3RlcDogMSwKICogICAgICAgICB2YWx1ZTogMjAwLAogKiAgICAgICAgIHRyYW5zZm9ybTogKHYpID0+IHsKICogICAgICAgICAgIC8vIGNvbnZlcnQgdiBpbnRvIGEgaGV4IGNvbG9yIGNvZGUKICogICAgICAgICAgIHYgPSAodikudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsIGAwYCk7CiAqICAgICAgICAgICByZXR1cm4gYCMke3Z9JHt2fSR7dn1gOwogKiAgICAgICAgIH0KICogICAgICAgfSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihiZ0NvbG9yKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gdmFyTmFtZSBUaGUgbmFtZSBmb3IgdGhlIHZhcmlhYmxlIHRoaXMgc2xpZGVyIGdldHMgdGllZCB0by4KICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgU2VlIGRlc2NyaXB0aW9uCiAqIEByZXR1cm5zIHtIVE1MSW5wdXRFbGVtZW50fSB0aGUgSFRNTCBpbnB1dCBlbGVtZW50IGZvciB0aGlzIHNsaWRlcgogKgogKiBAc2VlIHtAbGluayBjbGVhclNsaWRlcnN9CiAqLwpmdW5jdGlvbiBhZGRTbGlkZXIocHJvcExhYmVsLCBhc3NpZ24sIG9wdGlvbnMgPSB7fSkgewogIGxldCB7CiAgICBtaW4sCiAgICBtYXgsCiAgICBzdGVwLAogICAgdmFsdWUsCiAgICBjbGFzc2VzID0gYHNsaWRlcmAsCiAgICB0cmFuc2Zvcm0gPSAodikgPT4gdiwKICB9ID0gb3B0aW9uczsKCiAgbWluID0gbWluID09PSB1bmRlZmluZWQgPyAwIDogbWluOwogIG1heCA9IG1heCA9PT0gdW5kZWZpbmVkID8gMSA6IG1heDsKICBzdGVwID0gc3RlcCA9PT0gdW5kZWZpbmVkID8gKG1heCAtIG1pbikgLyAxMCA6IHN0ZXA7CiAgdmFsdWUgPSB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gKG1heCArIG1pbikgLyAyIDogdmFsdWU7CgogIC8vIGN1c3RvbSAicm91bmRpbmciLCBwdXJlbHkgZm9yIHN0cmluZ3MKICBjb25zdCByb3VuZCA9ICh2LCBkID0gNCkgPT4gewogICAgdiA9IGAke3Z9YDsKICAgIGNvbnN0IGZzID0gdi5pbmRleE9mKGAuYCk7CiAgICBpZiAoZnMgIT09IC0xKSB7CiAgICAgIGxldCBwcmVjID0gZCAtIGZzID4gMCA/IGQgLSBmcyA6IDA7CiAgICAgIHYgPSB2LnN1YnN0cmluZygwLCBmcyArIHByZWMpOwogICAgfQogICAgcmV0dXJuIHY7CiAgfTsKCiAgY29uc3QgY3JlYXRlID0gKHRhZykgPT4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOwoKICBsZXQgc2xpZGVyID0gY3JlYXRlKGBpbnB1dGApOwogIHNsaWRlci50eXBlID0gYHJhbmdlYDsKICBzbGlkZXIubWluID0gbWluOwogIHNsaWRlci5tYXggPSBtYXg7CiAgc2xpZGVyLnN0ZXAgPSBzdGVwOwogIHNsaWRlci5zZXRBdHRyaWJ1dGUoYHZhbHVlYCwgdmFsdWUpOwogIHNsaWRlci5zZXRBdHRyaWJ1dGUoYGNsYXNzYCwgY2xhc3Nlcyk7CgogIGNvbnN0IHVwZGF0ZSA9ICh7IHZhbHVlIH0pID0+IHsKICAgIHZhbHVlRmllbGQudGV4dENvbnRlbnQgPSByb3VuZCh2YWx1ZSk7CiAgICBhc3NpZ24odHJhbnNmb3JtKHBhcnNlRmxvYXQodmFsdWUpKSk7CiAgICBpZiAoIXBsYXlpbmcpIHJlZHJhdygpOwogIH07CgogIHNsaWRlci5hZGRFdmVudExpc3RlbmVyKGBpbnB1dGAsICh7IHRhcmdldCB9KSA9PiB1cGRhdGUodGFyZ2V0KSk7CgogIGxldCB0YWJsZSA9IF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKGB0YWJsZS5zbGlkZXItd3JhcHBlcmApOwogIGlmICghdGFibGUpIHsKICAgIHRhYmxlID0gY3JlYXRlKGB0YWJsZWApOwogICAgdGFibGUuY2xhc3NMaXN0LmFkZChgc2xpZGVyLXdyYXBwZXJgKTsKICAgIF9fZWxlbWVudC5wcmVwZW5kKHRhYmxlKTsKICB9CiAgbGV0IHRyID0gY3JlYXRlKGB0cmApOwoKICBsZXQgdGQgPSBjcmVhdGUoYHRkYCk7CiAgbGV0IGxhYmVsID0gY3JlYXRlKGBsYWJlbGApOwogIGxhYmVsLmNsYXNzTGlzdC5hZGQoYHNsaWRlci1sYWJlbGApOwogIGxhYmVsLmlubmVySFRNTCA9IHByb3BMYWJlbAogICAgLnJlcGxhY2UoL18oLispJC8sIGA8c3ViPiQxPC9zdWI+YCkKICAgIC5yZXBsYWNlKC8oXGQrKS8sIGA8c3ViPiQxPC9zdWI+YCk7CiAgdGQuYXBwZW5kKGxhYmVsKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbWluYCk7CiAgdGQudGV4dENvbnRlbnQgPSByb3VuZChzbGlkZXIubWluKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC53aWR0aCA9IGAqYDsKICB0ZC5hcHBlbmQoc2xpZGVyKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbWF4YCk7CiAgdGQudGV4dENvbnRlbnQgPSByb3VuZChzbGlkZXIubWF4KTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB2YXIgdmFsdWVGaWVsZCA9IGNyZWF0ZShgbGFiZWxgKTsgLy8gZnVuY3Rpb24gc2NvcGVkCiAgdmFsdWVGaWVsZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItdmFsdWVgKTsKICB0ZC5hcHBlbmQodmFsdWVGaWVsZCk7CiAgdHIuYXBwZW5kKHRkKTsKICB0ZC5hZGRFdmVudExpc3RlbmVyKGBwb2ludGVyZG93bmAsICgpID0+IHsKICAgIGNvbnN0IHZhbHVlID0gcHJvbXB0KGBuZXcgdmFsdWU/YCwgc2xpZGVyLnZhbHVlKTsKICAgIGlmICh2YWx1ZSAhPT0gbnVsbCkgewogICAgICBzbGlkZXIudmFsdWUgPSB2YWx1ZTsKICAgICAgdXBkYXRlKHsgdmFsdWUgfSk7CiAgICB9CiAgfSk7CgogIHRhYmxlLmFwcGVuZCh0cik7CgogIHVwZGF0ZShzbGlkZXIpOwogIHJldHVybiBzbGlkZXI7Cn0KCi8qKgogKiBSZW1vdmUgYWxsIHNsaWRlcnMgZm9yIHlvdXIgZmlndXJlIGZyb20gdGhlIHBhZ2UuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGFkZFNsaWRlcihgeGApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHRleHQoYGNsaWNrIHRvIGNsZWFyYCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oKSB7CiAqICAgICAgIGNsZWFyU2xpZGVycygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIGFkZFNsaWRlcn0KICovCgpmdW5jdGlvbiBjbGVhclNsaWRlcnMoKSB7CiAgY29uc3QgdGFibGUgPSBfX2VsZW1lbnQucXVlcnlTZWxlY3RvcihgdGFibGUuc2xpZGVyLXdyYXBwZXJgKTsKICBpZiAodGFibGUpIHRhYmxlLmlubmVySFRNTCA9IGBgOwp9CgovKioKICogQWRkIGEgYnV0dG9uIGJlbG93IHlvdXIgZmlndXJlIHRoYXQgY2FuIHRyaWdnZXIgZXZlbnQtYmFzZWQKICogY29kZSwgd2hpY2ggaXMgZXNwZWNpYWxseSBpbXBvcnRhbnQgaWYgeW91IHdhbnQgeW91ciBncmFwaGljcwogKiB0byBiZSB1c2VhYmxlIGJ5IHVzZXJzIHdobyBkb24ndCBoYXZlLCBvciBjYW5ub3QgdXNlLCBhIG1vdXNlLgogKgogKiBvbkNsaWNrIGlzIHNpbWlsYXIgdG8gdGhlIHN0YW5kYXJkIEpTIGV2ZW50IGhhbmRsZXIsIGV4Y2VwdAogKiB0aGF0IHRoZSBjYWxsIGFyZ3VtZW50IGlzIGEgcmVmZXJlbmNlIHRvIHlvdXIgYnV0dG9uLCBub3QKICogdGhlIGNsaWNrIGV2ZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgY29sb3JzID0gW2B3aGl0ZWAsIGBibGFja2BdOwogKiAgICAgbGV0IGJnQ29sb3IgPSAwOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRCdXR0b24oYGZsaXAgYmFja2dyb3VuZGAsIChidXR0b24pID0+IHsKICogICAgICAgICBiZ0NvbG9yID0gLShiZ0NvbG9yIC0gMSk7CiAqICAgICAgICAgcmVkcmF3KCk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoY29sb3JzW2JnQ29sb3JdKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gbGFiZWwgVGhlIHRleHQgbGFiZWwgZm9yIHlvdXIgYnV0dG9uCiAqIEBwYXJhbSB7RnVuY3Rpb259IG9uQ2xpY2sgVGhlIGNsaWNrIGhhbmRsaW5nIGZ1bmN0aW9uLCBzZWUgZGVzY3JpcHRpb24uCiAqIEByZXR1cm5zIHtIVE1MQnV0dG9uRWxlbWVudH0gVGhlIGJ1dHRvbiBlbGVtZW50IHRoaXMgYWRkZWQgdG8gdGhlIHBhZ2UKICoKICogQHNlZSB7QGxpbmsgY2xlYXJCdXR0b25zfQogKi8KZnVuY3Rpb24gYWRkQnV0dG9uKGxhYmVsLCBvbkNsaWNrKSB7CiAgaWYgKCFvbkNsaWNrKSB0aHJvdyBuZXcgRXJyb3IoYGEgYnV0dG9uIG11c3QgaGF2ZSBhbiBvbkNsaWNrIGhhbmRsZXJgKTsKICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBidXR0b25gKTsKICBidG4uY2xhc3NMaXN0LmFkZChgZ3JhcGhpY3MtZWxlbWVudC1idXR0b25gKTsKICBidG4udGV4dENvbnRlbnQgPSBsYWJlbDsKICBidG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCAoKSA9PiBvbkNsaWNrKGJ0bikpOwogIF9fZWxlbWVudC5wcmVwZW5kKGJ0bik7CiAgcmV0dXJuIGJ0bjsKfQoKLyoqCiAqIFJlbW92ZSBhbGwgYnV0dG9ucyBmb3IgeW91ciBmaWd1cmUgZnJvbSB0aGUgcGFnZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGB0aGlzIGRvZXMgbm90aGluZ2AsICgpID0+IHt9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KGBjbGljayB0byBjbGVhcmAsIHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKCkgewogKiAgICAgICBjbGVhckJ1dHRvbnMoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBhZGRCdXR0b259CiAqLwpmdW5jdGlvbiBjbGVhckJ1dHRvbnMoKSB7CiAgX19lbGVtZW50CiAgICAucXVlcnlTZWxlY3RvckFsbChgYnV0dG9uLmdyYXBoaWNzLWVsZW1lbnQtYnV0dG9uYCkKICAgIC5mb3JFYWNoKChlKSA9PiBlLnJlbW92ZSgpKTsKfQovKioKICogRHJhdyBhIGNpcmN1bGFyIGFyYyB3aXRoIHJhZGl1cyBgcmAgYXQgKHgseSksCiAqIHN0YXJ0aW5nIGF0IGFuZ2xlIGBzYCBhbmQgZW5kaW5nIGF0IGFuZ2xlIGBlYC4KICogSWYgYHdlZGdlYCBpcyB0cnVlLCB0aGlzIHdpbGwgZHJhdyBhIGNsb3NlZAogKiBzaGFwZSB0aGF0IGlzIGFuY2hvcmVkIGF0ICh4LHkpLiBJZiBvbWl0dGVkCiAqIG9yIGV4cGxpY2l0bHkgc2V0IHRvIGZhbHNlLCB0aGlzIHdpbGwgZHJhdwogKiBhbiBvcGVuIHNoYXBlIHdpdGggYSBmaWxsIHRoYXQgY29ubmVjdHMgdGhlCiAqIGZpcnN0IGFuZCBsYXN0IHBvaW50IG9uIHRoZSBhcmMsIGJ1dCBubyBjbG9zaW5nCiAqIHN0cm9rZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYCNGMDAyYCk7CiAqICAgICAgIGFyYyh3aWR0aC8yICsgMzAsIGhlaWdodC8yIC0gNDAsIDQwLCAwLCAwLjY2KlRBVSk7CiAqICAgICAgIGFyYyh3aWR0aC8yIC0gMzAsIGhlaWdodC8yICsgMjAsIDQwLCAwLCAwLjY2KlRBVSwgdHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGNpcmN1bGFyIGNlbnRlciB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBjaXJjdWxhciBjZW50ZXIgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhpcyBhcmMgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydEFuZ2xlIFRoZSBzdGFydCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0gZW5kQW5nbGUgVGhlIGVuZCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge2Jvb2xlYW59IGRyYXdXZWRnZSBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRvIGRyYXcgYSB3ZWRnZSBvciBjYXBwZWQgY2lyY2xlIChkZWZhdWx0PWNpcmNsZSkKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHBvaW50IFRoZSBjaXJjdWxhciBjZW50ZXIge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhpcyBhcmMgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydEFuZ2xlIFRoZSBzdGFydCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0gZW5kQW5nbGUgVGhlIGVuZCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge2Jvb2xlYW59IGRyYXdXZWRnZSBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRvIGRyYXcgYSB3ZWRnZSBvciBjYXBwZWQgY2lyY2xlIChkZWZhdWx0PWNpcmNsZSkKICoKICogQHNlZSB7QGxpbmsgY2lyY2xlfQogKi8KZnVuY3Rpb24gYXJjKHgsIHksIHIsIHMgPSAwLCBlID0gVEFVLCB3ZWRnZSA9IGZhbHNlKSB7CiAgLy8gRklYTUU6IFRPRE86IG5lZWRzIF9fYXJjM2QgYW5kIF9fYXJjMmQKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHdlZGdlID0gZTsKICAgIGUgPSBzOwogICAgcyA9IHI7CiAgICByID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBjb25zdCBzdGVwID0gMC4xOwogIHN0YXJ0KCk7CiAgaWYgKHdlZGdlKSB2ZXJ0ZXgoeCwgeSk7CiAgbGV0IGEgPSBzOwogIHZlcnRleCh4ICsgciAqIGNvcyhzKSwgeSArIHIgKiBzaW4ocykpOwogIGZvciAoYSA9IHMgKyBzdGVwOyBhIDwgZTsgYSArPSBzdGVwKSB7CiAgICB2ZXJ0ZXgoeCArIHIgKiBjb3MoYSksIHkgKyByICogc2luKGEpKTsKICB9CiAgdmVydGV4KHggKyByICogY29zKGUpLCB5ICsgciAqIHNpbihlKSk7CiAgaWYgKHdlZGdlKSB2ZXJ0ZXgoeCwgeSk7CiAgZW5kKCk7Cn0KCi8qKgogKiBEcmF3IGEgcGFpciBvZiBob3Jpem9udGFsIGFuZCB2ZXJ0aWNhbCBheGVzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRCb3JkZXIoMSwgYGJsYWNrYCk7CiAqICAgICAgIHNldEdyaWQoNTAsIGBsaWdodGdyZXlgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIHNldEN1cnNvcihgbm9uZWApOwogKiAgICAgICBjbGVhcihgI2ZmZmVmN2ApOwogKiAgICAgICBzZXRDb2xvcihgIzMzM2ApOwogKiAgICAgICB0cmFuc2xhdGUoMjUsMjUpOwogKiAgICAgICBheGVzKAogKiAgICAgICAgIGB0aW1lIChzKWAsIDAsIHdpZHRoLTUwLAogKiAgICAgICAgIGBkaXN0YW5jZSAoa20pYCwgMCwgaGVpZ2h0LTUwLAogKiAgICAgICAgICIwIiwgIjYwIiwKICogICAgICAgICAiMCIsICI1MDAiKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gaExhYmVsIHRoZSBob3Jpem9udGFsIGF4aXMgbGFiZWwKICogQHBhcmFtIHtudW1iZXJ9IGhzIHRoZSBzdGFydCAobGVmdCkgcGl4ZWwgdmFsdWUgZm9yIHRoZSBob3Jpem9udGFsIGF4aXMKICogQHBhcmFtIHtudW1iZXJ9IGhlIHRoZSBlbmQgKHJpZ2h0KSBwaXhlbCB2YWx1ZSBmb3IgdGhlIGhvcml6b250YWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gdkxhYmVsIHRoZSB2ZXJ0aWNhbCBheGlzIGxhYmVsCiAqIEBwYXJhbSB7bnVtYmVyfSB2cyB0aGUgc3RhcnQgKHRvcCkgcGl4ZWwgdmFsdWUgZm9yIHRoZSB2ZXJ0aWNhbCBheGlzCiAqIEBwYXJhbSB7bnVtYmVyfSB2ZSB0aGUgZW5kIChib3R0b20pIHBpeGVsIHZhbHVlIGZvciB0aGUgdmVydGljYWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gaHNMYWJlbD8gYW4gb3B0aW9uYWwgbGFiZWwgZm9yIHRoZSBzdGFydCAobGVmdCkgb2YgdGhlIGhvcml6b250YWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gaGVMYWJlbD8gYW4gb3B0aW9uYWwgbGFiZWwgZm9yIHRoZSBlbmQgKHJpZ2h0KSBvZiB0aGUgaG9yaXpvbnRhbCBheGlzCiAqIEBwYXJhbSB7c3RyaW5nfSB2c0xhYmVsPyBhbiBvcHRpb25hbCBsYWJlbCBmb3IgdGhlIHN0YXJ0ICh0b3ApIG9mIHRoZSB2ZXJ0aWNhbCBheGlzCiAqIEBwYXJhbSB7c3RyaW5nfSB2ZUxhYmVsPyBhbiBvcHRpb25hbCBsYWJlbCBmb3IgdGhlIGVuZCAoYm90dG9tKSBvZiB0aGUgdmVydGljYWwgYXhpcwogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIGF4ZXMoCiAgaExhYmVsLAogIGhzLAogIGhlLAogIHZMYWJlbCwKICB2cywKICB2ZSwKICBoc0xhYmVsID0gZmFsc2UsCiAgaGVMYWJlbCA9IGZhbHNlLAogIHZzTGFiZWwgPSBmYWxzZSwKICB2ZUxhYmVsID0gZmFsc2UKKSB7CiAgbGluZShocywgMCwgaGUsIDApOwogIGxpbmUoMCwgdnMsIDAsIHZlKTsKCiAgY29uc3QgaHBvcyA9IDAgLSA1OwogIHRleHQoYCR7aExhYmVsfSDihpJgLCB3aWR0aCAvIDIgKyA1LCBocG9zLCBSSUdIVCk7CiAgdGV4dChoc0xhYmVsID8gaHNMYWJlbCA6IGhzLCBocywgaHBvcywgUklHSFQpOwogIHRleHQoaGVMYWJlbCA/IGhlTGFiZWwgOiBoZSwgaGUsIGhwb3MsIFJJR0hUKTsKCiAgY29uc3QgdnBvcyA9IC01OwogIHNhdmUoKTsKICB0cmFuc2xhdGUodnBvcywgaGVpZ2h0IC8gMik7CiAgcm90YXRlKC1QSSAvIDIpOwogIHRleHQoYCR7dkxhYmVsfWAsIDAsIDAsIExFRlQpOwogIHJlc3RvcmUoKTsKICB0ZXh0KGDihpNgLCB2cG9zLCBoZWlnaHQgLyAyICsgMTYsIFJJR0hUKTsKICB0ZXh0KHZzTGFiZWwgPyB2c0xhYmVsIDogdnMsIHZwb3MsIHZzICsgNSwgUklHSFQpOwogIHRleHQodmVMYWJlbCA/IHZlTGFiZWwgOiB2ZSwgdnBvcywgdmUsIFJJR0hUKTsKfQoKLyoqCiAqIERyYXcgb25lIG9yIG1vcmUgQmV6aWVyIGN1cnZlcyBmcm9tIGFuIGFycmF5CiAqIG9mIFBvaW50IG9yIFBvaW50LWxpa2VzIHRoYXQgaW1wbGVtZW50OgogKgogKiBgYGAKICogewogKiAgIHg6IG51bWJlcgogKiAgIHk6IG51bWJlcgogKiB9CiAqIGBgYAogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgI0YwMDJgKTsKICogICAgICAgYmV6aWVyKAogKiAgICAgICAgIG5ldyBQb2ludCgyMCwgaGVpZ2h0IC0gNTUpLAogKiAgICAgICAgIG5ldyBQb2ludCgyMCwgMjUpLAogKiAgICAgICAgIHsgeDogd2lkdGggLSAyMCwgeTogMjV9LAogKiAgICAgICAgIHsgeDogd2lkdGggLSAyMCwgeTogaGVpZ2h0IC0gNTV9CiAqICAgICAgICk7CiAqICAgICAgIG5vRmlsbCgpCiAqICAgICAgIGJlemllcigKICogICAgICAgICBuZXcgUG9pbnQoMCwgaGVpZ2h0IC0gMjApLAogKiAgICAgICAgIG5ldyBQb2ludCh3aWR0aCAtIDIwLCBoZWlnaHQgLSAyMCksCiAqICAgICAgICAgeyB4OiAyMCwgeTogMjB9LAogKiAgICAgICAgIHsgeDogd2lkdGgsIHk6IDIwfQogKiAgICAgICApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyWzhdfSAuLi5jb29yZGluYXRlcyBFaWdodCB4LCB5IHZhbHVlcy4KICogQHBhcmFtIHtudW1iZXJbNm5dfSAuLi5hZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IE11bHRpcGxlcyBvZiBzaXggeCwgeSB2YWx1ZXMuCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlWzRdfSAuLi5jb29yZGluYXRlcyBGb3VyIHt4LHl9IGNvb3JkaW5hdGVzLgogKiBAcGFyYW0ge1BvaW50TGlrZVszbl19IC4uLmFkZGl0aW9uYWxDb29yZGluYXRlcz8gTXVsdGlwbGVzIG9mIHRocmVlIHt4LHl9IGNvb3JkaW5hdGVzLgogKgogKiBAc2VlIHtAbGluayBic3BsaW5lfQogKiBAc2VlIHtAbGluayBzcGxpbmV9CiAqLwpmdW5jdGlvbiBiZXppZXIoLi4uYXJncykgewogIC8vIEZJWE1FOiBUT0RPOiBuZWVkcyBfX2JlemllcjNkIGFuZCBfX2JlemllcjJkCiAgbGV0IHBvaW50cyA9IGFyZ3M7CgogIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gYG51bWJlcmApIHsKICAgIHBvaW50cyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHBvaW50cy5wdXNoKHsgeDogYXJnc1tpXSwgeTogYXJnc1tpICsgMV0gfSk7CiAgICB9CiAgfQoKICBjb25zdCBiID0gKHQsIGEsIGIsIGMsIGQpID0+IHsKICAgIGNvbnN0IG10ID0gMSAtIHQ7CiAgICByZXR1cm4gYSAqIG10ICoqIDMgKyAzICogYiAqIG10ICoqIDIgKiB0ICsgMyAqIGMgKiBtdCAqIHQgKiogMiArIGQgKiB0ICoqIDM7CiAgfTsKCiAgbGV0IFtwMCwgLi4ucmVzdF0gPSBwb2ludHM7CiAgc3RhcnQoKTsKICBmb3IgKGxldCBpID0gMCwgZSA9IHJlc3QubGVuZ3RoOyBpIDwgZTsgaSArPSAzKSB7CiAgICBsZXQgW3AxLCBwMiwgcDNdID0gcmVzdC5zbGljZShpLCBpICsgMyk7CiAgICBpZiAocDEgJiYgcDIgJiYgcDMpIHsKICAgICAgZm9yIChsZXQgdCA9IDA7IHQgPCAxOyB0ICs9IDAuMDEpIHsKICAgICAgICB2ZXJ0ZXgoYih0LCBwMC54LCBwMS54LCBwMi54LCBwMy54KSwgYih0LCBwMC55LCBwMS55LCBwMi55LCBwMy55KSk7CiAgICAgIH0KICAgICAgdmVydGV4KHAzLngsIHAzLnkpOwogICAgICBwMCA9IHAzOwogICAgfQogIH0KICBlbmQoKTsKfQoKLyoqCiAqIERyYXcgYSBCLXNwbGluZSB1c2luZyBmb3VyIG9yIG1vcmUgUG9pbnQgb3IKICogUG9pbnQtbGlrZXMgdGhhdCBpbXBsZW1lbnQ6CiAqCiAqIGBgYAogKiB7CiAqICAgeDogbnVtYmVyCiAqICAgeTogbnVtYmVyCiAqIH0KICogYGBgCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgcmFuZ2UoMCwgVEFVLCBQSSAvIDUsIChhKSA9PiBwb2ludHMucHVzaCgKICogICAgICAgICBuZXcgUG9pbnQoCiAqICAgICAgICAgICByYW5kb20oMzApICsgNTAgKiBjb3MoYSksCiAqICAgICAgICAgICByYW5kb20oMzApICsgNTAgKiBzaW4oYSkKICogICAgICAgICApCiAqICAgICAgICkpOwogKiAgICAgICBzZXRNb3ZhYmxlKC4uLnBvaW50cyk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7CiAqICAgICAgIG5vU3Ryb2tlKCk7CiAqICAgICAgIHNldEZpbGwoYCMwMDAyYCk7CiAqICAgICAgIGJzcGxpbmUoLi4ucG9pbnRzKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBwb2ludHMuZm9yRWFjaChwID0+IHBvaW50KHApKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcls4XX0gLi4uY29vcmRpbmF0ZXMgRWlnaHQgeCwgeSB2YWx1ZXMuCiAqIEBwYXJhbSB7bnVtYmVyWzJuXX0gLi4uYWRkaXRpb25hbENvb3JkaW5hdGVzPyBNdWx0aXBsZXMgb2YgeCwgeSB2YWx1ZXMuCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlWzRdfSAuLi5jb29yZGluYXRlcyBGb3VyIHt4LHl9IGNvb3JkaW5hdGVzLgogKiBAcGFyYW0ge1BvaW50TGlrZVtuXX0gLi4uYWRkaXRpb25hbENvb3JkaW5hdGVzPyBaZXJvIG9yIG1vcmUge3gseX0gY29vcmRpbmF0ZXMuCiAqCiAqIEBzZWUge0BsaW5rIGJlemllcn0KICogQHNlZSB7QGxpbmsgc3BsaW5lfQogKi8KCmZ1bmN0aW9uIGJzcGxpbmUoLi4uYXJncykgewogIC8vIEZJWE1FOiBUT0RPOiBuZWVkcyBfX3NwbGluZTNkIGFuZCBfX3NwbGluZTJkCgogIGxldCBvcGVuID0gdHJ1ZTsKICBpZiAodHlwZW9mIGFyZ3NbYXJncy5sZW5ndGggLSAxXSA9PT0gYGJvb2xlYW5gKSB7CiAgICBvcGVuID0gYXJncy5zcGxpY2UoYXJncy5sZW5ndGggLSAxLCAxKVswXTsKICB9CgogIGxldCBwb2ludHMgPSBhcmdzOwoKICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09IGBudW1iZXJgKSB7CiAgICBwb2ludHMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkgKz0gMikgewogICAgICBwb2ludHMucHVzaCh7IHg6IGFyZ3NbaV0sIHk6IGFyZ3NbaSArIDFdIH0pOwogICAgfQogIH0KCiAgc3RhcnQoKTsKICBuZXcgQlNwbGluZShwb2ludHMsIG9wZW4pLmdldExVVCgpLmZvckVhY2goKHApID0+IHZlcnRleChwLngsIHAueSkpOwogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIGNpcmNsZSB3aXRoIHJhZGl1cyBgcmAgYXQgYHgseWAuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGAjRjAwMmApOwogKiAgICAgICBjaXJjbGUod2lkdGgvMiwgaGVpZ2h0LzIsIDgwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgY2lyY2xlJ3MgY2VudGVyIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIGNpcmNsZSdzIGNlbnRlciB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSByIFRoZSBjaXJjbGUncyByYWRpdXMgaW4gcGl4ZWxzCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSBjaXJjbGUncyBjZW50ZXIge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0gciBUaGUgY2lyY2xlJ3MgcmFkaXVzIGluIHBpeGVscwogKgogKiBAc2VlIHtAbGluayBhcmN9CiAqLwpmdW5jdGlvbiBjaXJjbGUoLi4uYXJncykgewogIGlmIChfX3VzZV9wcm9qZWN0aW9uKSB7CiAgICBfX2NpcmNsZTNkKC4uLmFyZ3MpOwogIH0gZWxzZSB7CiAgICBfX2NpcmNsZTJkKC4uLmFyZ3MpOwogIH0KfQoKZnVuY3Rpb24gX19jaXJjbGUzZCh4LCB5LCB6LCByKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICByID0geTsKICAgIHogPSB4Lno7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgKHsgeCwgeSB9ID0gcHJvamVjdCh4LCB5LCB6KSk7CiAgX19jaXJjbGUyZCh4LCB5LCByKTsKfQoKZnVuY3Rpb24gX19jaXJjbGUyZCh4LCB5LCByKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICByID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBhcmMoeCwgeSwgciwgMCwgVEFVLCBmYWxzZSk7Cn0KCi8qKgogKiBDbGVhciB0aGUgY2FudmFzLCBhbmQgc2V0IGl0IHRvIGEgc3BlY2lmaWMgKENTUykgY29sb3VyLgogKiBJZiBubyBgbm9HcmlkKClgIGNhbGwgd2FzIG1hZGUsIHRoaXMgd2lsbCB0aGVuIGFsc28gZHJhdwogKiB0aGUgYmFja2dyb3VuZCBncmlkLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHBpbmtgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge2NvbG9yfSBjb2xvcj8gVGhlIChDU1MpIGJhY2tncm91bmQgY29sb3IgdG8gdXNlIChkZWZhdWx0ID0gYHdoaXRlYCkKICovCmZ1bmN0aW9uIGNsZWFyKGNvbG9yID0gYHdoaXRlYCkgewogIHNhdmUoKTsKICBfX2NhbnZhcy5zdHlsZS5iYWNrZ3JvdW5kID0gY29sb3I7CiAgX19jYW52YXMud2lkdGggPSB3aWR0aDsKICBfX2N0eCA9IF9fY2FudmFzLmdldENvbnRleHQoYDJkYCk7CiAgaWYgKF9fZHJhd19ncmlkKSBncmlkKCk7CiAgcmVzdG9yZSgpOwp9CgovKioKICogQ291bnRlcnBhcnQgdG8gc3RhcnQoKSwgZmluYWxpemVzIHRoZSBjdXJyZW50IHNoYXBlIGFuZAogKiBjb2xvdXJzIGl0LiBJZiBgY2xvc2VgIGlzIHRydWUsIGl0IHdpbGwgY2xvc2UgdGhlIHBhdGgKICogYmVmb3JlIGNvbG91cmluZy4KICoKICogSWYgYG5vRmlsbCgpYCBpcyBpbiBlZmZlY3QsIHRoZSBzaGFwZSB3aWxsIG5vdCBiZSBmaWxsZWQuCiAqIGlmIGBub1N0cm9rZSgpYCBpcyBpbiBlZmZlY3QsIHRoZSBzaGFwZSBvdXRsaW5lIHdpbGwgbm90IGJlIGNvbG91cmVkLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgZ29sZGApOwogKiAgICAgICBzdGFydCgpOwogKiAgICAgICB2ZXJ0ZXgoMCxoZWlnaHQvMik7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCAwKTsKICogICAgICAgdmVydGV4KHdpZHRoLCBoZWlnaHQvMik7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgICBlbmQodHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtib29sZWFufSBjbG9zZT8gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IHRvIGNsb3NlIHRoZSBwYXRoIChkZWZhdWx0ID0gZmFsc2UpCiAqCiAqIEBzZWUge0BsaW5rIHN0YXJ0fQogKiBAc2VlIHtAbGluayB2ZXJ0ZXh9CiAqIEBzZWUge0BsaW5rIGVuZFNoYXBlfQogKi8KZnVuY3Rpb24gZW5kKGNsb3NlID0gZmFsc2UpIHsKICBpZiAoY2xvc2UpIF9fY3R4LmNsb3NlUGF0aCgpOwogIF9fY3R4LmZpbGwoKTsKICBfX2N0eC5zdHJva2UoKTsKICBpZiAoX19jdHgubGluZVdpZHRoICUgMiA9PT0gMSkgewogICAgX19jdHgudHJhbnNsYXRlKC0wLjUsIC0wLjUpOwogIH0KfQoKLyoqCiAqIERyYXcgYW4gaW1hZ2UgaW4gYSBnaXZlbiBsb2NhdGlvbiB3aXRoIGFuIG9wdGlvbmFsCiAqIHdpZHRoIGFuZCBoZWlnaHQuIElmIG9taXR0ZWQsIHRoZSB3aWR0aCBhbmQgaGVpZ2h0CiAqIHdpbGwgYmUgdGhlIGltYWdlJ3Mgb3duIGRpbWVuc2lvbnMuIE5vdGUgdGhhdCB0aGUKICogaW1hZ2UgbWF5IGJlIGVpdGhlciBhIFVSTCwgb3IgYW4gPGltZz4gZWxlbWVudC4KICoKICogTm90ZSB0aGF0IHRoaXMgaXMgYW4gYXN5bmMgZnVuY3Rpb246IGlmIGl0IGlzIGltcG9ydGFudAogKiB0aGF0IG5vdGhpbmcgZ2V0cyBkcmF3biB1bnRpbCB0aGUgaW1hZ2UgaGFzIGJlZW4gZHJhd24sCiAqIHJlbWVtYmVyIHRvIGBhd2FpdGAgaXRzIGNhbGwuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBhc3luYyBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgYXdhaXQgaW1hZ2UoYGh0dHBzOi8vZHVtbXlpbWFnZS5jb20vMTAweDEwMGAsIDUwLCA1MCwgMTAwLCAxMDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7SW1hZ2V8c3RyaW5nfSBpbWdPclVSTCBUaGUgaW1hZ2UgdG8gZHJhdyBlaXRoZXIgYXMgSW1hZ2Ugb2JqZWN0LCBvciBpbWFnZSBVUkwuCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBkcmF3IHBvc2l0aW9uJ3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgZHJhdyBwb3NpdGlvbidzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHcgVGhlIHdpZHRoIG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHBhcmFtIHtudW1iZXJ9IGggVGhlIGhlaWdodCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEByZXR1cm5zIHtJbWFnZX0gVGhlIGRyYXduIGltYWdlCiAqCiAqIEBwYXJhbSB7SW1hZ2V8c3RyaW5nfSBpbWdPclVSTCBUaGUgaW1hZ2UgdG8gZHJhdyBlaXRoZXIgYXMgSW1hZ2Ugb2JqZWN0LCBvciBpbWFnZSBVUkwuCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSBkcmF3IHBvc2l0aW9uIGFzIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHcgVGhlIHdpZHRoIG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHBhcmFtIHtudW1iZXJ9IGggVGhlIGhlaWdodCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEByZXR1cm5zIHtJbWFnZX0gVGhlIGRyYXduIGltYWdlCiAqLwphc3luYyBmdW5jdGlvbiBpbWFnZShpbWcsIHggPSAwLCB5ID0gMCwgdywgaCkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgaCA9IHc7CiAgICB3ID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgaWYgKHR5cGVvZiBpbWcgPT09IGBzdHJpbmdgKSB7CiAgICBpbWcgPSBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIGNvbnN0IHRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGltZ2ApOwogICAgICB0YWcub25sb2FkID0gKCkgPT4gcmVzb2x2ZSh0YWcpOwogICAgICB0YWcub25lcnJvciA9ICgpID0+IHJlamVjdCgpOwogICAgICB0YWcuc3JjID0gaW1nOwogICAgfSk7CiAgfQogIF9fY3R4LmRyYXdJbWFnZShpbWcsIHgsIHksIHcgfHwgaW1nLndpZHRoLCBoIHx8IGltZy5oZWlnaHQpOwogIHJldHVybiBpbWc7Cn0KCi8qKgogKiBEcmF3IGEgbGluZSBmcm9tIG9uZSBjb29yZGluYXRlIHRvIGFub3RoZXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICByYW5nZSgwLGhlaWdodCwyMCwgKGkpID0+IGxpbmUoMCwgMCwgd2lkdGgsIGkpKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geDEgVGhlIGZpcnN0IHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTEgVGhlIGZpcnN0IHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geDIgVGhlIHNlY29uZCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkyIFRoZSBzZWNvbmQgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMSBUaGUgZmlyc3QgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMiBUaGUgc2Vjb25kIHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKi8KZnVuY3Rpb24gbGluZSguLi5hcmdzKSB7CiAgaWYgKF9fdXNlX3Byb2plY3Rpb24pIHsKICAgIF9fbGluZTNkKC4uLmFyZ3MpOwogIH0gZWxzZSB7CiAgICBfX2xpbmUyZCguLi5hcmdzKTsKICB9Cn0KCmZ1bmN0aW9uIF9fbGluZTNkKHgxLCB5MSwgejEsIHgyLCB5MiwgejIpIHsKICBpZiAoeDEueCAhPT0gdW5kZWZpbmVkICYmIHgxLnkgIT09IHVuZGVmaW5lZCkgewogICAgejIgPSB5MS56OwogICAgeTIgPSB5MS55OwogICAgeDIgPSB5MS54OwogICAgejEgPSB4MS56OwogICAgeTEgPSB4MS55OwogICAgeDEgPSB4MS54OwogIH0KICAoeyB4OiB4MSwgeTogeTEgfSA9IHByb2plY3QoeDEsIHkxLCB6MSkpOwogICh7IHg6IHgyLCB5OiB5MiB9ID0gcHJvamVjdCh4MiwgeTIsIHoyKSk7CiAgX19saW5lMmQoeDEsIHkxLCB4MiwgeTIpOwp9CgpmdW5jdGlvbiBfX2xpbmUyZCh4MSwgeTEsIHgyLCB5MikgewogIGlmICh4MS54ICE9PSB1bmRlZmluZWQgJiYgeDEueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5MiA9IHkxLnk7CiAgICB4MiA9IHkxLng7CiAgICB5MSA9IHgxLnk7CiAgICB4MSA9IHgxLng7CiAgfQogIHN0YXJ0KCk7CiAgdmVydGV4KHgxLCB5MSk7CiAgdmVydGV4KHgyLCB5Mik7CiAgZW5kKCk7Cn0KCi8qKgogKiBQbG90IGEgeT1mKHgpIGZ1bmN0aW9uLiBUaGUgaW5wdXQgdG8gdGhlIGZ1bmN0aW9uCiAqIHdpbGwgc3BhbiB0aGUgaW50ZXJ2YWwgW2EsYl0gdXNpbmcgdGhlIGluZGljYXRlZAogKiBudW1iZXIgb2Ygc3RlcHMsIGFuZCB0aGUgcmUgc3VsdCBtYXkgYmUgc2NhbGVkIGJvdGgKICogaW4gdGhlIHggYW5kIHkgZGlyZWN0aW9uIGluIG9yZGVyIHRvIGRyYXcgc29tZXRoaW5nCiAqIHRoYXQgeW91IGNhbiBhY3R1YWxseSBzZWUgKGUuZy4gaWYgeW91J3JlIHBsb3R0aW5nCiAqIHRvIHRoZSBkb21haW4gWzAsMV0geW91IHdvdWxkbid0IGJlIGFibGUgdG8gc2VlIHRoZQogKiByZXN1bHQgd2l0aG91dCBzY2FsaW5nKS4KICoKICogVGhpcyBmdW5jdGlvbiBpcyBhd2FyZSBvZiwgYW5kIHdpbGwgcGxvdCwgZGlzY29udGludWl0aWVzCiAqIHVzaW5nIHRoZSBzdGFuZGFyZCBvcGVuIGNpcmNsZSBub3RhdGlvbiwgdW5sZXNzIGluc3RydWN0ZWQKICogbm90IHRvIGRvIHNvIHVzaW5nIHRoZSBgaWdub3JlRGlzY29udGludWl0eWAgYm9vbGVhbiBmbGFnLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHRyYW5zbGF0ZSgwLCBoZWlnaHQgLyAyKTsKICogICAgICAgY29uc3QgZm4gPSAoeCkgPT4gY29zKHgpICoqIDYgLyBzaW4oeCkgLSBzaW4oeCkvMjsKICogICAgICAgcGxvdChmbiwgMCwgMipUQVUsIDEyMCwgd2lkdGggLyBUQVUsIGhlaWdodCAvIDIpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IGYgdGhlIGB5ID0gZih4KWAgZnVuY3Rpb24gdG8gcGxvdAogKiBAcGFyYW0ge251bWJlcn0gYT8gVGhlIGxvd2VyIGJvdW5kIGZvciB0aGUgaW5wdXQgdmFsdWUgKGRlZmF1bHQgPSAwKQogKiBAcGFyYW0ge251bWJlcn0gYj8gVGhlIHVwcGVyIGJvdW5kIGZvciB0aGUgaW5wdXQgdmFsdWUgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0ge251bWJlcn0gc3RlcHM/IFRoZSBudW1iZXIgb2YgcGxvdCBwb2ludHMgdG8gcGxvdCBvdmVyIHRoZSBpbnRlcnZhbCBbYSxiXSAoZGVmYXVsdCA9IDEwMCkKICogQHBhcmFtIHtudW1iZXJ9IHhzY2FsZT8gQW4gb3B0aW9uYWwgc2NhbGluZyBmYWN0b3IgdG8gYXBwbHkgdG8gZWFjaCBwbG90IHBvaW50J3MgeCB2YWx1ZSAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSB7bnVtYmVyfSB5c2NhbGU/IEFuIG9wdGlvbmFsIHNjYWxpbmcgZmFjdG9yIHRvIGFwcGx5IHRvIGVhY2ggcGxvdCBwb2ludCdzIHkgdmFsdWUgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0ge2Jvb2xlYW59IGlnbm9yZURpc2NvbnRpbnVpdHk/IERvIG5vdCBkcmF3IHNwZWNpYWwgZWxlbWVudHMgZm9yIGRpc2NvbnRpbnVpdGllcyAoZGVmYXVsdCA9IGZhbHNlKQogKgogKiBAc2VlIHtAbGluayBwbG90RGF0YX0KICovCmZ1bmN0aW9uIHBsb3QoCiAgZiwKICBhID0gMCwKICBiID0gMSwKICBzdGVwcyA9IDEwMCwKICB4c2NhbGUgPSAxLAogIHlzY2FsZSA9IDEsCiAgaWdub3JlRGlzY29udGludWl0eSA9IGZhbHNlCikgewogIGNvbnN0IGludGVydmFsID0gYiAtIGE7CiAgc3RhcnQoKTsKICBsZXQgW3B5LCBkeSwgcGR5XSA9IFswLCAwLCAwXTsKICBjb25zdCBzdGVwID0gaW50ZXJ2YWwgLyAoc3RlcHMgLSAxKTsKICBjb25zdCBkaXNjb250aW51aXR5ID0gKGksIHgsIHkpID0+IHsKICAgIGVuZCgpOwogICAgc2F2ZSgpOwogICAgbm9GaWxsKCk7CiAgICBwb2ludCh4ICogeHNjYWxlLCBweSAqIHlzY2FsZSk7CiAgICBwb2ludCh4ICogeHNjYWxlLCB5ICogeXNjYWxlKTsKICAgIHJlc3RvcmUoKTsKICAgIHN0YXJ0KCk7CiAgfTsKICBmb3IgKGxldCBpID0gMCwgeCwgeTsgaSA8IHN0ZXBzOyBpKyspIHsKICAgIHggPSBhICsgaSAqIHN0ZXA7CiAgICB5ID0gZih4KTsKICAgIC8vIElmIGYoeCkgY2hhbmdlcyBpbiB2aW9sYXRpb24gb2Ygd2hhdCBpdHMgZicoeCkgc3VnZ2VzdGVkLAogICAgLy8gdGhhdCdzIGEgZGlzY29udGludWl0eSBhbmQgd2UgZHJhdyBhbiBhc3ltcHRvdGUuCiAgICBkeSA9ICh5IC0gcHkpICogc3RlcDsKICAgIGlmICghaWdub3JlRGlzY29udGludWl0eSkgewogICAgICBpZiAocGR5ICE9PSBudWxsICYmIHNpZ24oeSAtIHB5KSAhPT0gc2lnbihwZHkpICYmIGFicyhwZHkpID4gMC4wMSkgewogICAgICAgIGRpc2NvbnRpbnVpdHkoaSwgeCwgeSk7CiAgICAgICAgcGR5ID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICBwZHkgPSBkeTsKICAgICAgfQogICAgfQogICAgdmVydGV4KHggKiB4c2NhbGUsIHkgKiB5c2NhbGUpOwogICAgcHkgPSB5OwogIH0KICBlbmQoKTsKfQoKLyoqCiAqIFBsb3QgYSAyRCBncmFwaCB1c2luZyBhIGNvbGxlY3Rpb24gb2YgYW55LWRpbWVuc2lvbmFsIGRhdGEsCiAqIGJ5IGluZGljYXRpbmcgd2hpY2ggZGltZW5zaW9uIHNob3VsZCBiZSB0cmVhdGVkIGFzIHRoZSBgeGAKICogYW5kIHdoaWNoIGRpbWVuc2lvbiBzaG91bGQgYmUgdHJlYXRlZCBhcyB0aGUgYHlgLiBJZiBubyBgeGAKICogYW5kIGB5YCBhcmUgcHJvdmlkZWQsIGBkYXRhYCB3aWxsIGJlIHRyZWF0ZWQgYSAxRCBhcnJheSBhbmQKICogd2lsbCBwbG90IHdpdGggdGhlIGFycmF5IGluZGV4IGFzIGB4YCBhbmQgZWxlbWVudCBhdCB0aGF0CiAqIGluZGV4IGFzIGB5YC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgdHJhbnNsYXRlKDAsIGhlaWdodC8yKTsKICoKICogICAgICAgc2V0U3Ryb2tlKGBkYXJrZ3JlZW5gKTsKICogICAgICAgbGV0IGRhdGEgPSBhcnJheSh3aWR0aCwgKGkpID0+IFtpLCBoZWlnaHQvMiAqIHNpbihpLzI1KV0pOwogKiAgICAgICBwbG90RGF0YShkYXRhLCAwLCAxKTsKICoKICogICAgICAgc2V0U3Ryb2tlKGBwdXJwbGVgKTsKICogICAgICAgZGF0YSA9IGFycmF5KHdpZHRoLCAoaSkgPT4gKHsKICogICAgICAgICBtZWVwOiBpLAogKiAgICAgICAgIG1vb3A6IGhlaWdodC8yICogY29zKGkvMjUpCiAqICAgICAgIH0pKTsKICogICAgICAgcGxvdERhdGEoZGF0YSwgYG1lZXBgLCBgbW9vcGApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7b2JqZWN0W119IGRhdGEgVGhlIGFueS1kaW1lbnNpb25hbCBkYXRhIGZyb20gd2hpY2ggdG8gcGxvdCBvbmUgZGltZW5zaW9uIGFnYWluIGFub3RoZXIKICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSB4PyBUaGUgcHJvcGVydHkgbmFtZSBvciBpbmRpdmlkdWFsIGVsZW1lbnQgYXJyYXkgaW5kZXggdG8gdXNlIGFzIHggZGltZW5zaW9uCiAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30geT8gVGhlIHByb3BlcnR5IG5hbWUgb3IgaW5kaXZpZHVhbCBlbGVtZW50IGFycmF5IGluZGV4IHRvIHVzZSBhcyB5IGRpbWVuc2lvbgogKgogKiBAc2VlIHtAbGluayBwbG90fQogKi8KZnVuY3Rpb24gcGxvdERhdGEoZGF0YSwgeCwgeSkgewogIHN0YXJ0KCk7CiAgaWYgKHggIT09IHVuZGVmaW5lZCAmJiB5ICE9PSB1bmRlZmluZWQpIHsKICAgIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgICB5ID0geC55OwogICAgICB4ID0geC54OwogICAgfQogICAgZGF0YS5mb3JFYWNoKChwKSA9PiB2ZXJ0ZXgocFt4XSwgcFt5XSkpOwogIH0gZWxzZSB7CiAgICBkYXRhLmZvckVhY2goKHksIHgpID0+IHZlcnRleCh4LCB5KSk7CiAgfQogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIHBvaW50IChlaXRoZXIgZnJvbSB4L3kgb3IgcG9pbnQtbGlrZSkuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcmFuZ2UoMCwgVEFVLCAoYSkgPT4gewogKiAgICAgICAgIHBvaW50KDQwICogY29zKGEpLCA0MCAqIHNpbihhKSk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBwb2ludCdzIGNlbnRlciB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBwb2ludCdzIGNlbnRlciB5IHBpeGVsIHZhbHVlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSBwb2ludCdzIGNlbnRlciB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBzZWUge0BsaW5rIGNpcmNsZX0KICovCmZ1bmN0aW9uIHBvaW50KC4uLmFyZ3MpIHsKICBhcmdzLnB1c2goMyk7CiAgaWYgKF9fdXNlX3Byb2plY3Rpb24pIHsKICAgIF9fY2lyY2xlM2QoLi4uYXJncyk7CiAgfSBlbHNlIHsKICAgIF9fY2lyY2xlMmQoLi4uYXJncyk7CiAgfQp9CgovKioKICogRHJhdyBhIGNsb3NlZCBwb2x5Z29uIGZyb20gYW4gYXJyYXkgb2YgcG9pbnQgbGlrZXMgb3IgbnVtYmVyIGFycmF5cy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBjZW50ZXIoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGBvcmFuZ2VgKTsKICogICAgICAgcG9seShbCiAqICAgICAgICAgWy01MCwgLTUwXSwKICogICAgICAgICBbLTUwLCA1MF0sCiAqICAgICAgICAge3g6IDUwLCB5OiA1MH0sCiAqICAgICAgICAgbmV3IFBvaW50KDUwLCAtNTApLAogKiAgICAgICBdKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcltdfSBjb29yZGluYXRlcyBUaGUgYXJyYXkgb2YgcG9seWdvbiB2ZXJ0aWNlcyBhcyBwb2ludC1saWtlcyBvciBudW1iZXIgYXJyYXlzLgogKi8KZnVuY3Rpb24gcG9seShjb29yZHMpIHsKICBzdGFydCgpOwogIGNvb3Jkcy5jb25jYXQoW2Nvb3Jkc1swXV0pLmZvckVhY2goKHYpID0+IHsKICAgIGlmICh2IGluc3RhbmNlb2YgQXJyYXkpIHZlcnRleCguLi52KTsKICAgIGVsc2UgdmVydGV4KHYpOwogIH0pOwogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIHJlY3RhbmdsZSBhdCB0aGUgc3BlY2lmaWVkIGNvb3JkaW5hdGUsIHdpdGgKICogdGhlIHNwZWNpZmljIHdpZHRoIGFuZCBoZWlnaHQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg0MCwgNDAsIHdpZHRoIC0gODAsIGhlaWdodCAtIDgwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgcmVjdCdzIGNvcm5lciAgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgcmVjdCdzIGNvcm5lciAgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gdyBUaGUgd2lkdGggb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcGFyYW0ge251bWJlcn0gaCBUaGUgaGVpZ2h0IG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHJlY3Q7cyBjb3JkZXIge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0gdyBUaGUgd2lkdGggb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcGFyYW0ge251bWJlcn0gaCBUaGUgaGVpZ2h0IG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICovCmZ1bmN0aW9uIHJlY3QoeCwgeSwgdywgaCkgewogIC8vIEZJWE1FOiBUT0RPOiBkbyB3ZSBuZWVkIF9fcmVjdDNkIGFuZCBfX3JlY3QyZD8KICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIGggPSB3OwogICAgdyA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIHN0YXJ0KCk7CiAgdmVydGV4KHgsIHkpOwogIHZlcnRleCh4ICsgdywgeSk7CiAgdmVydGV4KHggKyB3LCB5ICsgaCk7CiAgdmVydGV4KHgsIHkgKyBoKTsKICB2ZXJ0ZXgoeCwgeSk7CiAgZW5kKCk7Cn0KCi8qKgogKiBEcmF3IGEgY2FyZGluYWwgKGhlcm1pdGUpIHNwbGluZSB0aGF0IHBhc3NlcyB0aHJvdWdoIGVhY2gKICogcG9pbnQgcHJvdmlkZWQsIHVzaW5nIGEgbWF0aGVtYXRpY2FsbHkgdmlydHVhbCBzdGFydCBhbmQKICogZW5kIHRvIGVuc3VyZSB0aGUgY3VydmUgc3RhcnRzIGFuZCBlbmRzIGF0IHRoZSBwcm92aWRlZAogKiBzdGFydCBhbmQgZW5kIHBvaW50LiBUaGlzIGNhbiBiZSBieXBhc3NlZCBieSBzZXR0aW5nCiAqIHRoZSBgdmlydHVhbGAgYXJndW1lbnQgdG8gYGZhbHNlYC4KICoKICogQWRkaXRpb25hbGx5LCB0aGUgc3BsaW5lJ3MgdGlnaHRuZXNzLCB3aGljaCBjb250cm9scwogKiBob3cgImJlbmR5IiB0aGUgc3BsaW5lIGlzICh0aGUgdGlnaHRlciB0aGUgc3BsaW5lLAogKiB0aGUgc2hhcnBlciBiZW5kcyBiZWNvbWUpIGNhbiBiZSBjb250cm9sbGVkIGJ5IHNldHRpbmcKICogdGhlIGB0aWdodG5lc3NgIHZhbHVlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHJhbmdlKDAsIFRBVSwgUEkgLyA1LCAoYSkgPT4gcG9pbnRzLnB1c2goCiAqICAgICAgICAgbmV3IFBvaW50KAogKiAgICAgICAgICAgcmFuZG9tKDMwKSArIDUwICogY29zKGEpLAogKiAgICAgICAgICAgcmFuZG9tKDMwKSArIDUwICogc2luKGEpCiAqICAgICAgICAgKQogKiAgICAgICApKTsKICogICAgICAgc2V0TW92YWJsZSguLi5wb2ludHMpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwogKiAgICAgICBzZXRGaWxsKGAjMDAwMmApOwogKiAgICAgICBzcGxpbmUoLi4ucG9pbnRzKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBwb2ludHMuZm9yRWFjaChwID0+IHBvaW50KHApKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKgogKiBAcGFyYW0ge1BvaW50TGlrZVtdfSAuLi5wb2ludHMgVGhlIHBvaW50cyBhY3Jvc3Mgd2hpY2ggdG8gZml0IGEgc3BsaW5lCiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmlydHVhbD8gV2hldGhlciBvciBub3QgdG8gaW52ZW50IG5ldyBtYXRoZW1hdGljYWwgcG9pbnRzIHRoYXQgZW5zdXJlIHRoZSBjdXJ2ZSBzdGFydHMgYW5kIGVuZHMgYXQgdGhlIHByb3ZpZGVkIHN0YXJ0IGFuZCBlbmQgcG9pbnRzLiAoZGVmYXVsdCA9IHRydWUpCiAqIEBwYXJhbSB7bnVtYmVyfSB0aWdodG5lc3M/IEhvdyB0aWdodCB0aGlzIHNwbGluZSBzaG91bGQgYmUgZml0IHRocm91Z2ggdGhlIHBvaW50cyBwcm92aWRlZC4gVGhlIGhpZ2hlciB0aGUgdGlnaHRuZXNzLCB0aGUgbW9yZSBwb2x5Z29uYWwgdGhlIGN1cnZlIGJlY29tZXMgKGRlZmF1bHQgPSAxKQogKgogKiBAc2VlIHtAbGluayBiZXppZXJ9CiAqIEBzZWUge0BsaW5rIGJzcGxpbmV9CiAqLwpmdW5jdGlvbiBzcGxpbmUoLi4uYXJncykgewogIC8vIEZJWE1FOiBUT0RPOiBuZWVkcyBfX3NwbGluZTNkIGFuZCBfX3NwbGluZTJkCgogIGxldCBwb2ludHMgPSBhcmdzOwogIGxldCB2aXJ0dWFsID0gdHJ1ZTsKICBsZXQgVCA9IDE7CgogIC8vIGlmIHRoZSBsYXN0IG9yIHNpbmdsZS10by1sYXN0IGlzIGEgYm9vbCwgdGhhdCdzIGB2aXJ0dWFsYDoKICBpZiAodHlwZW9mIGFyZ3NbYXJncy5sZW5ndGggLSAxXSA9PT0gYGJvb2xlYW5gKSB7CiAgICBbdmlydHVhbF0gPSBhcmdzLnNwbGljZShhcmdzLmxlbmd0aCAtIDEsIDEpOwogIH0gZWxzZSBpZiAodHlwZW9mIGFyZ3NbYXJncy5sZW5ndGggLSAyXSA9PT0gYGJvb2xlYW5gKSB7CiAgICBbdmlydHVhbF0gPSBhcmdzLnNwbGljZShhcmdzLmxlbmd0aCAtIDIsIDEpOwogIH0KCiAgLy8gSWYgdGhpcyBtYWtlcyB0aGUgbnVtYmVyIG9mIGFyZ3Mgb2RkLCB0aGUgbGFzdCBhcmcgaXMgVAogIGlmIChhcmdzLmxlbmd0aCAlIDIgPT09IDEpIHsKICAgIFtUXSA9IGFyZ3Muc3BsaWNlKGFyZ3MubGVuZ3RoIC0gMSwgMSk7CiAgfQoKICAvLyB0aGVuLCB3ZSBjYW4gY29udmVydAogIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gYG51bWJlcmApIHsKICAgIHBvaW50cyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHBvaW50cy5wdXNoKHsgeDogYXJnc1tpXSwgeTogYXJnc1tpICsgMV0gfSk7CiAgICB9CiAgfQoKICBsZXQgY3BvaW50cyA9IHBvaW50czsKICBpZiAodmlydHVhbCkgewogICAgY29uc3QgZjAgPSBwb2ludHNbMF0sCiAgICAgIGYxID0gcG9pbnRzWzFdLAogICAgICBmMiA9IHBvaW50c1syXSwKICAgICAgZnNtID0gbmV3IFZlY3RvcihmMC54IC8gMiArIGYyLnggLyAyLCBmMC55IC8gMiArIGYyLnkgLyAyKSwKICAgICAgZjByID0gbmV3IFZlY3RvcihmMCkucmVmbGVjdChmMSksCiAgICAgIGZzciA9IGZzbS5yZWZsZWN0KGYxKSwKICAgICAgZm4gPSBuZXcgVmVjdG9yKGYwci54IC8gMiArIGZzci54IC8gMiwgZjByLnkgLyAyICsgZnNyLnkgLyAyKSwKICAgICAgbDIgPSBwb2ludHMuYXQoLTMpLAogICAgICBsMSA9IHBvaW50cy5hdCgtMiksCiAgICAgIGwwID0gcG9pbnRzLmF0KC0xKSwKICAgICAgbHNtID0gbmV3IFZlY3RvcihsMC54IC8gMiArIGwyLnggLyAyLCBsMC55IC8gMiArIGwyLnkgLyAyKSwKICAgICAgbDByID0gbmV3IFZlY3RvcihsMCkucmVmbGVjdChsMSksCiAgICAgIGxuID0gbmV3IFZlY3RvcihsMHIueCAvIDIgKyBsc20ueCAvIDIsIGwwci55IC8gMiArIGxzbS55IC8gMik7CiAgICBjcG9pbnRzID0gW2ZuLCAuLi5wb2ludHMsIGxuXTsKICB9CgogIC8vIGZvdXIgcG9pbnQgc2xpZGluZyB3aW5kb3cgb3ZlciB0aGUgc2VnbWVudAogIGNvbnN0IGJlemllclBvaW50cyA9IFtdOwogIGZvciAobGV0IGkgPSAwLCBlID0gY3BvaW50cy5sZW5ndGggLSAzOyBpIDwgZTsgaSsrKSB7CiAgICBsZXQgW2MxLCBjMiwgYzMsIGM0XSA9IGNwb2ludHMuc2xpY2UoaSwgaSArIDQpOwogICAgbGV0IHAyID0gewogICAgICB4OiBjMi54ICsgKGMzLnggLSBjMS54KSAvICg2ICogVCksCiAgICAgIHk6IGMyLnkgKyAoYzMueSAtIGMxLnkpIC8gKDYgKiBUKSwKICAgIH07CiAgICBsZXQgcDMgPSB7CiAgICAgIHg6IGMzLnggLSAoYzQueCAtIGMyLngpIC8gKDYgKiBUKSwKICAgICAgeTogYzMueSAtIChjNC55IC0gYzIueSkgLyAoNiAqIFQpLAogICAgfTsKICAgIGlmIChpID09PSAwKSBiZXppZXJQb2ludHMucHVzaChjMik7CiAgICBiZXppZXJQb2ludHMucHVzaChwMiwgcDMsIGMzKTsKICB9CgogIGJlemllciguLi5iZXppZXJQb2ludHMpOwp9CgovKioKICogU3RhcnRzIGEgKG5ldykgc2hhcGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGBnb2xkYCk7CiAqICAgICAgIHN0YXJ0KCk7CiAqICAgICAgIHZlcnRleCgwLGhlaWdodC8yKTsKICogICAgICAgdmVydGV4KHdpZHRoLzIsIDApOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgsIGhlaWdodC8yKTsKICogICAgICAgdmVydGV4KHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIGVuZCh0cnVlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBlbmR9CiAqIEBzZWUge0BsaW5rIHZlcnRleH0KICogQHNlZSB7QGxpbmsgc3RhcnRTaGFwZX0KICovCmZ1bmN0aW9uIHN0YXJ0KCkgewogIGlmIChfX2N0eC5saW5lV2lkdGggJSAyID09PSAxKSB7CiAgICBfX2N0eC50cmFuc2xhdGUoMC41LCAwLjUpOwogIH0KICBfX2N0eC5iZWdpblBhdGgoKTsKICBfX2ZpcnN0ID0gZmFsc2U7Cn0KCi8qKgogKiBEcmF3IHNvbWUgdGV4dCB0byB0aGUgc2NyZWVuLiBJdHMgcGxhY2VtZW50IGlzCiAqIGRldGVybWluZWQgYnkgYm90aCB0aGUgY29vcmRpbmF0ZSBwcm92aWRlZCwgYW5kCiAqIHRoZSB4L3kgYWxpZ25tZW50IHByb3ZpZGVkLiBWYWxpZCBgeEFsaWduYCB2YWx1ZXMKICogYXJlOgogKgogKiAtIENFTlRFUiAtIHRoZSB0ZXh0IGFuY2hvciBpcyBpbiB0aGUgbWlkZGxlIG9mIHRoZSB0ZXh0LiBUZXh0IGlzIHBsYWNlZCBldmVubHkgb24gZWl0aGVyIHNpZGUuCiAqIC0gRU5EIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSByaWdodCBmb3IgTFRSIHRleHQsIGFuZCBvbiB0aGUgbGVmdCBmb3IgUlRMIHRleHQuCiAqIC0gTEVGVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgbGVmdCBzaWRlIG9mIHRoZSB0ZXh0LiBhbGwgdGV4dCBpcyB0byB0aGUgcmlnaHQuCiAqIC0gUklHSFQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIHJpZ2h0IHNpZGUgb2YgdGhlIHRleHQuIEFsbCB0ZXh0IGlzIHRvIHRoZSBsZWZ0LgogKiAtIFNUQVJUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSBsZWZ0IGZvciBMVFIgdGV4dCwgYW5kIG9uIHRoZSByaWdodCBmb3IgUlRMIHRleHQuCiAqCiAqIFZhbGlkIGB5QWxpZ25gIHZhbHVlcyBhcmU6CiAqCiAqIC0gQUxQSEFCRVRJQyAtIHN0YW5kYXJkIHRleHQgYWxpZ25tZW50CiAqIC0gQk9UVE9NIC0gdGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgYm90dG9tIG9mIHRoZSBib3VuZGluZyBib3gKICogLSBIQU5HSU5HIC0gcmVsZXZhbnQgZm9yIFRpYmV0YW4gYW5kIG90aGVyIEluZGljIHNjcmlwdHMuCiAqIC0gSURFT0dSQVBISUMgLSByZWxldmFudCBmb3IgaWRlb2dyYXBoaWMgQ0pLViB0ZXh0LgogKiAtIE1JRERMRSAtIFRoZSB2ZXJ0aWNhbCBlcXVpdmFsZW50IG9mICJjZW50ZXIiLgogKiAtIFRPUCAtIFRoZSB0ZXh0IGlzIGFsaWduZWQgdG8gdGhlIHRvcCBvZiB0aGUgdHlwb2dyYXBoaWMgImVtIHNxdWFyZSIuCiAqCiAqIE5vdGUgdGhhdCB0aGUgcHJpbWFyeSB0ZXh0IGNvbG91ciB1c2VzIHRoZSBmaWxsIGNvbG91ci4gSWYgdGV4dAogKiBzdHJva2luZyBpcyBlbmFibGVkLCB0aGUgdGhlIHRleHQgb3V0bGluZSB3aWxsIGJlIGNvbG91cmVkIHVzaW5nCiAqIHRoZSBjdXJyZW50IHN0cm9rZSBjb2xvdXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgdGV4dCgibm9ybWFsIHRleHQiLCB3aWR0aC8yLCA2MCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgc2V0VGV4dFN0cm9rZSgxKTsKICogICAgICAgdGV4dCgidW5maWxsZWQgdGV4dCIsIHdpZHRoLzIsIDEwMCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgICBzZXRTdHJva2UoYHJlZGApOwogKiAgICAgICBzZXRGaWxsKGB5ZWxsb3dgKTsKICogICAgICAgdGV4dCgiZmFuY3kgdGV4dCIsIHdpZHRoLzIsIDE0MCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHRleHQgd2Ugd2FudCB0byBzaG93CiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSB0ZXh0IGxvY2F0aW9uJ3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgdGV4dCBsb2NhdGlvbidzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtzdHJpbmd9IHhBbGlnbj8gQW4gb3B0aW9uYWwgaG9yaXpvbnRhbCBhbGlnbm1lbnQgc3RyaW5nCiAqIEBwYXJhbSB7c3RyaW5nfSB5QWxpZ24/IEFuIG9wdGlvbmFsIHZlcnRpY2FsICBhbGlnbm1lbnQgc3RyaW5nCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHRleHQgd2Ugd2FudCB0byBzaG93CiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSB0ZXh0IGxvY2F0aW9uJ3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge3N0cmluZ30geEFsaWduPyBBbiBvcHRpb25hbCBob3Jpem9udGFsIGFsaWdubWVudCBzdHJpbmcKICogQHBhcmFtIHtzdHJpbmd9IHlBbGlnbj8gQW4gb3B0aW9uYWwgdmVydGljYWwgIGFsaWdubWVudCBzdHJpbmcKICoKICogQHNlZSB7QGxpbmsgc2V0VGV4dFN0cm9rZX0KICovCmZ1bmN0aW9uIHRleHQoc3RyLCB4LCB5LCB4QWxpZ24sIHlBbGlnbikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeUFsaWduID0geEFsaWduOwogICAgeEFsaWduID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgc2F2ZSgpOwogIGlmICh4QWxpZ24pIHsKICAgIHNldFRleHRBbGlnbih4QWxpZ24sIHlBbGlnbik7CiAgfQogIF9fY3R4LmZpbGxUZXh0KHN0ciwgeCwgeSk7CiAgaWYgKF9fdGV4dFN0cm9rZSkgewogICAgc2V0U3Ryb2tlKF9fdGV4dFN0cm9rZSk7CiAgICBfX2N0eC5zdHJva2VUZXh0KHN0ciwgeCwgeSk7CiAgfQogIHJlc3RvcmUoKTsKfQoKLyoqCiAqIERyYXcgYSB0cmlhbmdsZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYHJlZGApOwogKiAgICAgICB0cmlhbmdsZSh3aWR0aC8yLCAzMCwgMS80ICogd2lkdGgsIDE2MCwgMy80ICogd2lkdGgsIDExMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHgxIFRoZSBmaXJzdCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkxIFRoZSBmaXJzdCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHgyIFRoZSBzZWNvbmQgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MiBUaGUgc2Vjb25kIHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geDMgVGhlIHRoaXJkIHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTMgVGhlIHRoaXJkIHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDEgVGhlIGZpcnN0IHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDIgVGhlIHNlY29uZCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtQb2ludExpa2V9IHAzIFRoZSB0aGlyZCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICovCmZ1bmN0aW9uIHRyaWFuZ2xlKHgxLCB5MSwgeDIsIHkyLCB4MywgeTMpIHsKICAvLyBGSVhNRTogVE9ETzogZG8gd2UgbmVlZCBfX3RyaWFuZ2xlM2QgYW5kIF9fdHJpYW5nbGUyZD8KCiAgaWYgKHgxLnggIT09IHVuZGVmaW5lZCAmJiB4MS55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkzID0geDIueTsKICAgIHgzID0geDIueDsKICAgIHkyID0geTEueTsKICAgIHgyID0geTEueDsKICAgIHkxID0geDEueTsKICAgIHgxID0geDEueDsKICB9CgogIHN0YXJ0KCk7CiAgdmVydGV4KHgxLCB5MSk7CiAgdmVydGV4KHgyLCB5Mik7CiAgdmVydGV4KHgzLCB5Myk7CiAgdmVydGV4KHgxLCB5MSk7CiAgZW5kKCk7Cn0KCi8qKgogKiBBZGQgYSB2ZXJ0ZXggdG8gdGhlIGN1cnJlbnRseSBhY3RpdmUgc2hhcGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgc3RhcnQoKTsKICogICAgICAgdmVydGV4KHdpZHRoLzIsIDMwKTsKICogICAgICAgdmVydGV4KDEvNCAqIHdpZHRoLCAxNjApOwogKiAgICAgICB2ZXJ0ZXgoMy80ICogd2lkdGgsIDExMCk7CiAqICAgICAgIGVuZCgpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSB2ZXJ0ZXgncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSB2ZXJ0ZXgncyB5IHBpeGVsIHZhbHVlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSB2ZXJ0ZXgge3gseX0gY29vcmRpbmF0ZQogKgogKiBAc2VlIHtAbGluayBlbmR9CiAqIEBzZWUge0BsaW5rIHN0YXJ0fQogKi8KZnVuY3Rpb24gdmVydGV4KHgsIHksIHopIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHogPSB4Lno7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgaWYgKF9fdXNlX3Byb2plY3Rpb24gJiYgeiAhPT0gdW5kZWZpbmVkKSB7CiAgICAoeyB4LCB5IH0gPSBfX3Byb2plY3Rvci5wcm9qZWN0KHgsIHksIHopKTsKICB9CiAgaWYgKF9fZmlyc3QpIHsKICAgIF9fY3R4LmxpbmVUbyh4LCB5KTsKICB9IGVsc2UgewogICAgX19maXJzdCA9IHsgeCwgeSB9OwogICAgX19jdHgubW92ZVRvKHgsIHkpOwogIH0KfQovKioKICogQ3JlYXRlIGFuIGFycmF5IG9mIHNwZWNpZmllZCBsZW5ndGgsIG9wdGlvbmFsbHkgZmlsbGVkIHVzaW5nIGEKICogZnVuY3Rpb24gdGhhdCB0YWtlcyB0aGUgZWxlbWVudCBpbmRleCBhcyBzaW5nbGUgaW5wdXQgYXJndW1lbnQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHRyYW5zbGF0ZSgwLCBoZWlnaHQvMik7CiAqICAgICAgIGxldCBkYXRhID0gYXJyYXkod2lkdGgsIChpKSA9PiBbaSwgaGVpZ2h0LzIgKiBzaW4oaS8yNSldKTsKICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAqICAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggVGhlIHNpemUgb2YgdGhlIGFycmF5IHlvdSB3YW50CiAqIEBwYXJhbSB7RnVuY3Rpb259IGZpbGxGdW5jdGlvbj8gVGhlIG9wdGlvbmFsIGZ1bmN0aW9uIHRoYXQgZ2V0cyB1c2VkIHRvIGZpbGwgdGhlIGFycmF5CiAqLwpmdW5jdGlvbiBhcnJheShsZW4sIGZpbGxGdW5jdGlvbikgewogIGNvbnN0IGFyciA9IG5ldyBBcnJheShsZW4pLmZpbGwoKTsKICBpZiAoZmlsbEZ1bmN0aW9uKSB7CiAgICByZXR1cm4gYXJyLm1hcCgoXywgaSkgPT4gZmlsbEZ1bmN0aW9uKGkpKTsKICB9CiAgcmV0dXJuIGFycjsKfQoKLyoqCiAqIEVtcHR5IHRoZSBsaXN0IG9mIG1vdmFibGUgcG9pbnRzIGluIHlvdXIgZ3JhcGhpYy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRCdXR0b24oYGxvY2tgLCAoKSA9PiB7CiAqICAgICAgICAgY2xlYXJNb3ZhYmxlKCk7CiAqICAgICAgICAgcmVkcmF3KCk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGZvcihsZXQgcCBvZiBwb2ludHMpIHsKICogICAgICAgICBzZXRDb2xvcihpc01vdmFibGUocCkgPyBgcmVkYCA6IGBncmV5YCk7CiAqICAgICAgICAgcG9pbnQocCk7CiAqICAgICAgIH0KICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgseSkgewogKiAgICAgICBpZiAoY3VycmVudE1vdmFibGUpIHJldHVybjsKICogICAgICAgY29uc3QgcCA9IG5ldyBQb2ludCh4LHkpOwogKiAgICAgICBwb2ludHMucHVzaChwKTsKICogICAgICAgc2V0TW92YWJsZShwKTsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgaXNNb3ZhYmxlfQogKiBAc2VlIHtAbGluayBzZXRNb3ZhYmxlfQogKi8KZnVuY3Rpb24gY2xlYXJNb3ZhYmxlKCkgewogIF9fbW92YWJsZV9wb2ludHMuc3BsaWNlKDAsIF9fbW92YWJsZV9wb2ludHMubGVuZ3RoKTsKfQoKLyoqCiAqIENyZWF0ZSBhIGNvcHkgb2YgdGhlIGN1cnJlbnQgY2FudmFzIGVsZW1lbnQKICogZm9yIHVzZSBzb21ld2hlcmUgZWxzZSBpbiB5b3VyIG93biBjb2RlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHBpbmtgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgseSkgewogKiAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KAogKiAgICAgICAgIG5ldyBDdXN0b21FdmVudChgZ3JhcGhpY3M6dXBkYXRlYCwgewogKiAgICAgICAgICAgZGV0YWlsOiB7CiAqICAgICAgICAgICAgIGNhbnZhczogY29weSgpCiAqICAgICAgICAgICB9CiAqICAgICAgICAgfSkKICogICAgICAgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcmV0dXJucyB7SFRNTENhbnZhc0VsZW1lbnR9IEEgY29weSBvZiB0aGUgY3VycmVudCBjYW52YXMKICovCmZ1bmN0aW9uIGNvcHkoKSB7CiAgY29uc3QgY29weSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGNhbnZhc2ApOwogIGNvcHkud2lkdGggPSB3aWR0aDsKICBjb3B5LmhlaWdodCA9IGhlaWdodDsKICBjb25zdCBjdHggPSBjb3B5LmdldENvbnRleHQoYDJkYCk7CiAgY3R4LmRyYXdJbWFnZShfX2NhbnZhcywgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgcmV0dXJuIGNvcHk7Cn0KCi8qKgogKiBHZW5lcmF0ZXMgYSBjb2xvciBiYXNlZCBvbiB0aGUgSFNMIGNvbG9yIHNwYWNlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoY29sb3IoNDUsIDgwLCA5MCkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBodWUgaW4gdGhlIHJhbmdlIFswLCAzNjBdCiAqIEBwYXJhbSB7bnVtYmVyfSBzYXR1cmF0aW9uIGluIHRoZSByYW5nZSBbMCwgMTAwXQogKiBAcGFyYW0ge251bWJlcn0gbGlnaHRuZXNzIGluIHRoZSByYW5nZSBbMCwgMTAwXQogKiBAcGFyYW0ge251bWJlcn0gb3BhY2l0eSBpbiB0aGUgcmFuZ2UgWzAsIDFdCiAqIEByZXR1cm5zIHtzdHJpbmd9IEEgQ1NTIGhzbGEgY29sb3Igc3RyaW5nCiAqCiAqIEBzZWUge0BsaW5rIHJhbmRvbUNvbG9yfQogKi8KZnVuY3Rpb24gY29sb3IoaCA9IF9fY3VycmVudF9odWUsIHMgPSA1MCwgbCA9IDUwLCBhID0gMSkgewogIHJldHVybiBgaHNsYSgke2h9LCR7c30lLCR7bH0lLCR7YX0pYDsKfQoKLyoqCiAqIEZpbmQgYW4gSFRNTCBlbGVtZW50IGluc2lkZSB5b3VyIGdyYXBoaWNzLWVsZW1lbnQKICogYnkgcXVlcnkgc2VsZWN0b3IuIFRoaXMgaXMgZXF1aXZhbGVudCB0bzoKICoKICogYGBgCiAqIHlvdXJFbGVtZW50LnF1ZXJ5U2VsZWN0b3IocXMpCiAqIGBgYAogKgogKiBAcGFyYW0ge3N0cmluZ30gcXVlcnlTZWxlY3RvciBBIHF1ZXJ5IHNlbGVjdG9yCiAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxudWxsfSBUaGUgbWF0Y2hlZCBlbGVtZW50LCBvciBudWxsIGlmIHRoZXJlIHdhcyBubyBtYXRjaC4KICovCmZ1bmN0aW9uIGZpbmQocXMpIHsKICByZXR1cm4gX19lbGVtZW50LnF1ZXJ5U2VsZWN0b3IocXMpOwp9CgovKioKICogRmluZCBhbGwgSFRNTCBlbGVtZW50cyBpbnNpZGUgeW91ciBncmFwaGljcy1lbGVtZW50CiAqIHRoYXQgbWF0Y2ggYSBnaXZlbiBxdWVyeSBzZWxlY3Rvci4gVGhpcyBpcyBlcXVpdmFsZW50IHRvOgogKgogKiBgYGAKICogQXJyYXkuZnJvbSh5b3VyRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHFzKSkKICogYGBgCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBxdWVyeVNlbGVjdG9yIEEgcXVlcnkgc2VsZWN0b3IKICogQHJldHVybnMge0hUTUxFbGVtZW50W119IEFuIGFycmF5IHdpdGggYWxsIG1hdGNoaW5nIGVsZW1lbnRzLCBbXSBpZiB0aGVyZSB3ZXJlIG5vIG1hdGNoZXMuCiAqLwpmdW5jdGlvbiBmaW5kQWxsKHFzKSB7CiAgcmV0dXJuIFsuLi5fX2VsZW1lbnQucXVlcnlTZWxlY3RvckFsbChxcyldOwp9CgovKioKICogTWFyayBhIHNwZWNpZmljIGNvbG9yIGFzIHRoZSBoaWdobGlnaHQgY29sb3IsCiAqIHdoaWNoIGNhdXNlcyB0aGUgZ3JhcGhpYyB0byByZWRyYXcgd2l0aCB0aGF0CiAqIGNvbG9yIHJlcGxhY2VkIGJ5IHdoaWNoZXZlciBjb2xvciB5b3UgcGlja2VkCiAqIGFzIGhpZ2hsaWdodCBjb2xvci4KICoKICogTm90ZSB0aGF0IHlvdSBjYW4gb25seSB1c2UgbmFtZWQgKENTUykgY29sb3JzCiAqIHdpdGggdGhpcyBmdW5jdGlvbi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0SGlnaGxpZ2h0Q29sb3IoYGxpbWVgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KCJsZXQncyBnbyIsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICBpZiAoc3RhdGUpIGhpZ2hsaWdodChgcmVkYCk7CiAqICAgICAgIGVsc2UgaGlnaGxpZ2h0KGZhbHNlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge2NvbG9yfGJvb2xlYW59IGNvbG9yIFNldCB0aGUgY29sb3IgdGhhdCBzaG91bGQgZ2V0IHJlcGxhY2VkIHdpdGggdGhlIGhpZ2hsaWdodCBjb2xvciwgb3IgZGlzYWJsZSBoaWdobGlnaHQgd2hlbiBjb2xvciBpcyBgZmFsc2VgCiAqCiAqIEBzZWUge0BsaW5rIHNldEhpZ2hsaWdodENvbG9yfQogKi8KZnVuY3Rpb24gaGlnaGxpZ2h0KGNvbG9yKSB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdKSB7CiAgICBfX2hpZ2hsaWdodF9jb2xvciA9IENTU19DT0xPUl9NQVBbY29sb3JdOwogIH0gZWxzZSB7CiAgICBfX2hpZ2hsaWdodF9jb2xvciA9IGNvbG9yOwogIH0KICByZWRyYXcoKTsKfQoKLyoqCiAqIENoZWNrIHdoZXRoZXIgYSBwb2ludCBpcyByZWdpc3RlcmVkIGFzIG1vdmFibGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGBsb2NrYCwgKCkgPT4gewogKiAgICAgICAgIGNsZWFyTW92YWJsZSgpOwogKiAgICAgICAgIHJlZHJhdygpOwogKiAgICAgICB9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBmb3IobGV0IHAgb2YgcG9pbnRzKSB7CiAqICAgICAgICAgc2V0Q29sb3IoaXNNb3ZhYmxlKHApID8gYHJlZGAgOiBgZ3JleWApOwogKiAgICAgICAgIHBvaW50KHApOwogKiAgICAgICB9CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bih4LHkpIHsKICogICAgICAgaWYgKGN1cnJlbnRNb3ZhYmxlKSByZXR1cm47CiAqICAgICAgIGNvbnN0IHAgPSBuZXcgUG9pbnQoeCx5KTsKICogICAgICAgcG9pbnRzLnB1c2gocCk7CiAqICAgICAgIHNldE1vdmFibGUocCk7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBUaGUgcG9pbnQgdGhhdCB3ZSB3YW50IHRvIGNoZWNrICJtb3ZhYmlsaXR5IiBmb3IKICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgb3VyIHBvaW50IGlzIGluIHRoZSBsaXN0IG9mIG1vdmFibGUgcG9pbnRzLCBvdGhlcndpc2UgZmFsc2UKICoKICogQHNlZSB7QGxpbmsgY2xlYXJNb3ZhYmxlfQogKiBAc2VlIHtAbGluayBzZXRNb3ZhYmxlfQogKi8KZnVuY3Rpb24gaXNNb3ZhYmxlKHBvaW50KSB7CiAgcmV0dXJuIF9fbW92YWJsZV9wb2ludHMuaW5jbHVkZXMocG9pbnQpOwp9CgovKioKICogR2V0IHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRoYXQgdGhpcwogKiBncmFwaGljIGhhcyBiZWVuIHJ1bm5pbmcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIGNvbnN0IHNlY29uZHMgPSAobWlsbGlzKCkvMTAwMCl8MDsKICogICAgICAgdGV4dChgJHtzZWNvbmRzfXNgLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcmV0dXJucyB7bnVtYmVyfSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHNpbmNlIHRoZSBncmFwaGljIGxvYWRlZCBpbgogKi8KZnVuY3Rpb24gbWlsbGlzKCkgewogIHJldHVybiBEYXRlLm5vdygpIC0gX19zdGFydF90aW1lOwp9CgovKioKICogUGF1c2UgdGhlIGdyYXBoaWMgaWYgaXRzIGN1cnJlbnRseSBwbGF5aW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBjb25zdCBzZWNvbmRzID0gKG1pbGxpcygpLzEwMDApLnRvRml4ZWQoMSk7CiAqICAgICAgIHRleHQoYCR7c2Vjb25kc31zYCwgd2lkdGgvMiwgaGVpZ2h0LzIpCiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyQWN0aXZlKHN0YXRlKSB7CiAqICAgICAgIGlmKHN0YXRlKSB7CiAqICAgICAgICAgcGF1c2UoKTsKICogICAgICAgfSBlbHNlIHsKICogICAgICAgICBwbGF5KCk7CiAqICAgICAgIH0KICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBwbGF5fQogKiBAc2VlIHtAbGluayB0b2dnbGVQbGF5fQogKi8KZnVuY3Rpb24gcGF1c2UoKSB7CiAgcGxheWluZyA9IGZhbHNlOwp9CgovKioKICogU3RhcnQgcGxheWluZyB5b3VyIGdyYXBoaWMsIG1lYW5pbmcgaXQgd2lsbCBjYWxsIGRyYXcoKQogKiBhdCB3aGF0ZXZlciByYXRlIHRoZSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgbG9vcCBpcwogKiBhbGxvd2VkIHRvIHJ1biBvbiB5b3VyIGNvbXB1dGVyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgbGV0IGZwcyA9IDA7CiAqICAgICBsZXQgY2hlY2tlZCA9IGZhbHNlOwogKiAgICAgbGV0IGxhc3RGcmFtZUNoZWNrID0gMDsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKS50b0ZpeGVkKDEpOwogKiAgICAgICB0ZXh0KGBmcHM6ICR7ZnBzfWAsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgICBpZiAoc2Vjb25kcy5lbmRzV2l0aChgLjBgKSkgewogKiAgICAgICAgIGlmICghY2hlY2tlZCkgewogKiAgICAgICAgICAgY2hlY2tlZCA9IHRydWU7CiAqICAgICAgICAgICBmcHMgPSBmcmFtZSAtIGxhc3RGcmFtZUNoZWNrOwogKiAgICAgICAgICAgbGFzdEZyYW1lQ2hlY2sgPSBmcmFtZTsKICogICAgICAgICB9CiAqICAgICAgIH0gZWxzZSB7CiAqICAgICAgICAgY2hlY2tlZCA9IGZhbHNlOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgcGF1c2V9CiAqIEBzZWUge0BsaW5rIHRvZ2dsZVBsYXl9CiAqLwpmdW5jdGlvbiBwbGF5KCkgewogIHBsYXlpbmcgPSB0cnVlOwogIF9fZHJhdygpOwp9CgovKioKICogR2VuZXJhdGUgYSByYW5kb20gY29sb3VyLiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbgogKiBhbGxvd3MgeW91IHRvIGdldCAidGhlIGN1cnJlbnRseSBnZW5lcmF0ZWQgcmFuZG9tCiAqIGNvbG91ciIgaW4gZGlmZmVyZW50IG9wYWNpdGllcyBieSBjYWxsaW5nIHRoZSBmdW5jdGlvbgogKiB3aXRoIGFuIG9wYWNpdHkgdmFsdWUsIGFuZCBgZmFsc2VgIGFzIGN5Y2xlIGFyZ3VtZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIocmFuZG9tQ29sb3IoKSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bigpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICoKICogQHBhcmFtIHtudW1iZXJ9IG9wYWNpdHkgVGhlIG9wYWNpdHkgdmFsdWUgaW4gdGhlIHJhbmdlIFswLDFdCiAqIEBwYXJhbSB7bnVtYmVyfSBjeWNsZT8gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IHRvIG1vdmUgb24gdG8gdGhlIG5leHQgY29sb3VyIChkZWZhdWx0ID0gdHJ1ZSkKICoKICogQHNlZSB7QGxpbmsgY29sb3J9CiAqLwpmdW5jdGlvbiByYW5kb21Db2xvcihhID0gMS4wLCBjeWNsZSA9IHRydWUpIHsKICBpZiAoY3ljbGUpIF9fY3VycmVudF9odWUgPSByYW5kb20oMCwgMzYwKTsKICByZXR1cm4gYGhzbGEoJHtfX2N1cnJlbnRfaHVlfSw1MCUsNTAlLCR7YX0pYDsKfQoKLyoqCiAqIEFuIGFsdGVybmF0aXZlIHRvIHdyaXRpbmcgZm9yIGxvb3BzLCBiZWNhdXNlCiAqIG5vIG9uZSB3YW50cyB0byBjb25zdGFudGx5IHdyaXRlIHZhciBhbGxvY2F0aW9ucwogKiB0aGF0IG9ubHkgbGl2ZSBmb3IgdGhlIGR1cmF0aW9uIG9mIGEgbG9vcC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICByYW5nZSgwLCBUQVUsIChhKSA9PiBwb2ludCg0MCAqIGNvcyhhKSwgNDAgKiBzaW4oYSkpKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgVGhlIGVxdWl2YWxlbnQgb2YgYSBmb3IgbG9vcCdzIGluaXRpYWwgYGxldCBpID0gLi4uYAogKiBAcGFyYW0ge251bWJlcn0gZW5kIFRoZSBlcXVpdmFsZW50IG9mIGEgZm9yIGxvb3AncyBgaSA8IGVuZGAKICogQHBhcmFtIHtudW1iZXJ9IHN0ZXA/IFRoZSBzdGVwIHNpemUgYnkgd2hpY2ggdG8gaW5jcmVtZW50IGF0IGVhY2ggaXRlcmF0aW9uIChkZWZhdWx0cyA9IGAoc3RhcnQtZW5kKS8xMGApCiAqIEBwYXJhbSB7RnVuY3Rpb259IHJ1bkZ1bmN0aW9uIFRoZSBmdW5jdGlvbiB0byBydW4gYXQgZWFjaCBpdGVyYXRpb24KICovCmZ1bmN0aW9uIHJhbmdlKHN0YXJ0LCBlbmQsIHN0ZXAsIHJ1bkZ1bmN0aW9uKSB7CiAgaWYgKHR5cGVvZiBzdGVwID09PSBgZnVuY3Rpb25gKSB7CiAgICBydW5GdW5jdGlvbiA9IHN0ZXA7CiAgICBzdGVwID0gKGVuZCAtIHN0YXJ0KSAvIDEwOwogIH0KICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkgKz0gc3RlcCkgewogICAgcnVuRnVuY3Rpb24oaSk7CiAgfQp9CgovKioKICogU2FmZWx5IHRyaWdnZXIgYSBuZXcgZHJhdyBwYXNzLiBJZiB0aGUgZ3JhcGhpYyBpcyBydW5uaW5nCiAqIGluIGFuaW1hdGVkIG1vZGUsIG9yIGEgcmVkcmF3KCkgaXMgdHJpZ2dlcmVkIF9kdXJpbmdfIGEKICogcmVkcmF3KCksIHRoaXMgY2FsbCB3aWxsIGRvIG5vdGhpbmcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjb25zdCBoID0gbWFwKHBvaW50ZXIueCwgMCwgd2lkdGgsIDAsIDM2MCk7CiAqICAgICAgIGNvbnN0IGwgPSBtYXAocG9pbnRlci55LCAwLCBoZWlnaHQsIDUwLCAwKTsKICogICAgICAgY2xlYXIoY29sb3IoaCwgMTAwLCBsKSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSgpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIHJlZHJhdygpIHsKICBpZiAoX19yZWRyYXdpbmcpIHJldHVybjsKICBpZiAocGxheWluZykgcmV0dXJuOwogIF9fcmVkcmF3aW5nID0gdHJ1ZTsKICBfX2RyYXcoKTsKICBfX3JlZHJhd2luZyA9IGZhbHNlOwp9CgovKioKICogUmVzdG9yZSB0aGUgZ3JhcGhpY3MgY29udGV4dCAodHJhbnNmb3JtcywKICogY3VycmVudCBjb2xvcnMsIGV0YykgdG8gd2hhdCB0aGV5IHdlcmUKICogd2hlbiBzYXZlKCkgd2FzIGNhbGxlZC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZSgwLDAsODAsMCk7CiAqICAgICAgIHNhdmUoKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApCiAqICAgICAgIHJhbmdlKDAsIDUsIDEsIChhKSA9PiB7CiAqICAgICAgICAgcm90YXRlKFBJLzgpOwogKiAgICAgICAgIGxpbmUoMCwwLDgwLDApOwogKiAgICAgICB9KTsKICogICAgICAgcmVzdG9yZSgpOwogKiAgICAgICBsaW5lKC0yMCwwLC04MCwwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzYXZlfQogKi8KZnVuY3Rpb24gcmVzdG9yZSgpIHsKICBfX2N0eC5yZXN0b3JlKCk7Cn0KCi8qKgogKiBNYXJrIG9uZSBvciBtb3JlIHBvaW50cyBhcyBtb3ZhYmxlLCBtZWFuaW5nCiAqIHRoYXQgdGhlIHVzZXIgY2FuIHJlcG9zaXRpb24gdGhlIHBvaW50IGFyb3VuZCBvbgogKiB0aGUgY2FudmFzIGJ5IHRvdWNoL2NsaWNrLWRyYWdnaW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGZvciAobGV0IGkgPSA0MDsgaSA8IDIwMDsgaSArPSAyMCkgewogKiAgICAgICAgIHBvaW50cy5wdXNoKG5ldyBQb2ludChpIC0gMjAsIDEyMCkpOwogKiAgICAgICB9CiAqICAgICAgIHNldE1vdmFibGUoLi4ucG9pbnRzKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICBzZXRTdHJva2UoYHB1cnBsZWApOwogKiAgICAgICBic3BsaW5lKC4uLnBvaW50cyk7CiAqICAgICAgIGZvcihsZXQgcCBvZiBwb2ludHMpIHBvaW50KHApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlW25dfSBwb2ludHMgT25lIG9yIG1vcmUgcG9pbnRzIHRvIG1hcmsgYXMgbW92YWJsZS4KICoKICogQHNlZSB7QGxpbmsgaXNNb3ZhYmxlfQogKiBAc2VlIHtAbGluayBjbGVhck1vdmFibGV9CiAqLwpmdW5jdGlvbiBzZXRNb3ZhYmxlKC4uLnBvaW50cykgewogIHBvaW50cy5mb3JFYWNoKChwKSA9PiB7CiAgICBpZiAoX19tb3ZhYmxlX3BvaW50cy5pbmRleE9mKHApID09PSAtMSkgewogICAgICBfX21vdmFibGVfcG9pbnRzLnB1c2gocCk7CiAgICB9CiAgfSk7Cn0KCi8qKgogKiBTZXQgKG9yIGNoYW5nZSkgdGhlIGdyYXBoaWMncyBzaXplLiBOb3RlIHRoYXQgeW91ciB3aWR0aAogKiBhbmQgaGVpZ2h0IHZhbHVlcyB3aWxsIGdldCByb3VuZGVkIHRvIGludGVnZXIgdmFsdWVzLgogKgogKiBOb3RlIHRoYXQgYHNldFNpemVgIHdpbGwgaW1tZWRpYXRlbHkgdHJpZ2dlciBhIHJlZHJhdywKICogd2hldGhlciB5b3Ugd2FudCBpdCB0byBvciBub3QsIGJlY2F1c2UgY2hhbmdpbmcgY2FudmFzCiAqIGRpbWVuc2lvbnMgY2xlYXJzIHRoZSBjYW52YXMsIG5lY2Vzc2l0YXRpbmcgYSByZWRyYXcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSg0MDAsIDIwMCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBjZW50ZXIoKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCkKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KGAke3dpZHRofS8ke2hlaWdodH1gLCAwLCAwLCBDRU5URVIsIE1JRERMRSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyVXAoKSB7CiAqICAgICAgIHNldFNpemUocmFuZG9tKDEwMCw0MDApLCAyMDApOwogKiAgICAgICAvLyBOb3RlIHRoYXQgdGhlcmUgaXMgbm8gcmVkcmF3KCkgaGVyZSEKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gd2lkdGggVGhlIGdyYXBoaWNzIHdpZHRoIGluIHBpeGVscwogKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IFRoZSBncmFwaGljcyBoZWlnaHQgaW4gcGl4ZWxzCiAqLwpmdW5jdGlvbiBzZXRTaXplKHcgPSA0MDAsIGggPSAyMDApIHsKICB3aWR0aCA9IF9fY2FudmFzLndpZHRoID0gdyB8IDA7CiAgaGVpZ2h0ID0gX19jYW52YXMuaGVpZ2h0ID0gaCB8IDA7CiAgX19lbGVtZW50LnN0eWxlLm1heFdpZHRoID0gYGNhbGMoMmVtICsgJHt3aWR0aH1weGA7CiAgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwogIF9fZHJhdygpOwp9CgovKioKICogU2F2ZSB0aGUgY3VycmVudCBncmFwaGljcyBjb250ZXh0ICh0cmFuc2Zvcm1zLAogKiBjdXJyZW50IGNvbG9ycywgZXRjKSBzbyB0aGF0IHRob3NlIGNhbiBiZSByZXN0b3JlZAogKiBhZnRlciBjaGFuZ2luZyB0aGVtLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICBsaW5lKDAsMCw4MCwwKTsKICogICAgICAgc2F2ZSgpOwogKiAgICAgICBzZXRDb2xvcihgZGFya2dyZWVuYCkKICogICAgICAgcmFuZ2UoMCwgNSwgMSwgKGEpID0+IHsKICogICAgICAgICByb3RhdGUoUEkvOCk7CiAqICAgICAgICAgbGluZSgwLDAsODAsMCk7CiAqICAgICAgIH0pOwogKiAgICAgICByZXN0b3JlKCk7CiAqICAgICAgIGxpbmUoLTIwLDAsLTgwLDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqICogQHNlZSB7QGxpbmsgcmVzdG9yZX0KICovCmZ1bmN0aW9uIHNhdmUoKSB7CiAgX19jdHguc2F2ZSgpOwp9CgovKioKICogQ29udmVydCB0aGUgY3VycmVudCBjYW52YXMgaW50byBhbiBkYXRhIFVSTAogKiB0aGF0IHJlcHJlc2VudHMgYSBQTkcgaW1hZ2UuCiAqCiAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBjdXJyZW50IGNhbnZhcyBhcyBQTkcgZGF0YSBVUkwKICovCmZ1bmN0aW9uIHRvRGF0YVVSTCgpIHsKICByZXR1cm4gX19jYW52YXMudG9EYXRhVVJMKCk7Cn0KCi8qKgogKiBJZiB0aGUgZ3JhcGhpYyBpcyBjdXJyZW50bHkgcGxheWluZywgcGF1c2UgaXQsCiAqIGFuZCBpZiBpdCdzIHBhdXNlZCwgcGxheSBpdC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKS50b0ZpeGVkKDEpOwogKiAgICAgICB0ZXh0KGAke3NlY29uZHN9c2AsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICB0b2dnbGVQbGF5KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge2Jvb2xlYW59IFRoZSBuZXcgcGxheSBzdGF0ZQogKgogKiBAc2VlIHtAbGluayBwYXVzZX0KICogQHNlZSB7QGxpbmsgcGxheX0KICovCmZ1bmN0aW9uIHRvZ2dsZVBsYXkoKSB7CiAgcGxheWluZyA/IHBhdXNlKCkgOiBwbGF5KCk7CiAgcmV0dXJuIHBsYXlpbmc7Cn0KY29uc3QgewogIC8qKgogICAqIEdldCB0aGUgYWJzb2x1dGUgdmFsdWUgZm9yIHNvbWUgaW5wdXQKICAgKgogICAqIEV4YW1wbGU6CiAgICoKICAgKiA8Z3JhcGhpY3MtZWxlbWVudD4KICAgKiAgIDxncmFwaGljcy1zb3VyY2U+CiAgICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAgICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAgICogICAgICAgdHJhbnNsYXRlKDAsIGhlaWdodC8yKTsKICAgKiAgICAgICBub0ZpbGwoKTsKICAgKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAgICogICAgICAgbGluZSgtaHVnZSwgMCwgaHVnZSwgMCk7CiAgICoKICAgKiAgICAgICBjb25zdCB3MiA9IHdpZHRoLzI7CiAgICogICAgICAgY29uc3QgZGF0YSA9IGFycmF5KHdpZHRoLCAoeCkgPT4gW3gsIHggLSB3MiwgYWJzKHggLSB3MildKTsKICAgKgogICAqICAgICAgIHNldFN0cm9rZShgcmVkYCk7CiAgICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAgICoKICAgKiAgICAgICBzZXRTdHJva2UoYGJsdWVgKTsKICAgKiAgICAgICBwbG90RGF0YShkYXRhLCAwLCAyKTsKICAgKiAgICAgfQogICAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAgICogPC9ncmFwaGljcy1lbGVtZW50PgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IHYgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnB1dCB2YWx1ZSB3aXRoIGl0cyBzaWduIHNldCB0byBwb3NpdGl2ZQogICAqLwogIGFicywKCiAgLyoqCiAgICogVGhlIGludmVyc2UgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gdiBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludmVyc2UgY29zaW5lIG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBhc2lufQogICAqIEBzZWUge0BsaW5rIGFjb3NofQogICAqLwogIGFjb3MsCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGludmVyc2UgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBoeXBlcmJvbGljIGludmVyc2UgY29zaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBhc2luaH0KICAgKiBAc2VlIHtAbGluayBhY29zfQogICAqLwogIGFjb3NoLAoKICAvKioKICAgKiBUaGUgaW52ZXJzZSBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnZlcnNlIHNpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGFjb3N9CiAgICogQHNlZSB7QGxpbmsgYXNpbmh9CiAgICovCiAgYXNpbiwKCiAgLyoqCiAgICogVGhlIGh5cGVyYm9saWMgaW52ZXJzZSBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBoeXBlcmJvbGljIGludmVyc2Ugc2luZQogICAqCiAgICogQHNlZSB7QGxpbmsgYWNvc2h9CiAgICogQHNlZSB7QGxpbmsgYXNpbn0KICAgKi8KICBhc2luaCwKCiAgLyoqCiAgICogVGhlIGludmVyc2UgdGFuZ2VudCBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaW52ZXJzZSB0YW5nZW50CiAgICoKICAgKiBAc2VlIHtAbGluayB0YW59CiAgICovCiAgYXRhbiwKCiAgLyoqCiAgICogVGhlICJhdGFuMiIgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9BdGFuMgogICAqCiAgICogQHBhcmFtIHt5fSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHBhcmFtIHt4fSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGF0YW4yIGFuZ2xlIGZvciB0aGlzIG51bWJlciBwYWlyCiAgICovCiAgYXRhbjIsCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGludmVyc2UgdGFuZ2VudCBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIHRhbmdlbnQKICAgKgogICAqIEBzZWUge0BsaW5rIHRhbn0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKiBAc2VlIHtAbGluayBhc2luaH0KICAgKi8KICBhdGFuaCwKCiAgLyoqCiAgICogVGhlIGN1YmUgcm9vdCBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgKHJlYWwpIGN1YmUgcm9vdCBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgc3FydH0KICAgKi8KICBjYnJ0LAoKICAvKioKICAgKiBUaGUgInJvdW5kIHVwIHRvIHRoZSBuZWFyZXN0IGludGVnZXIiIGZ1bmN0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaW50ZWdlciByZXN1bHQgYWZ0ZXIgcm91bmRpbmcgdXAuCiAgICoKICAgKiBAc2VlIHtAbGluayBmbG9vcn0KICAgKiBAc2VlIHtAbGluayByb3VuZH0KICAgKi8KICBjZWlsLAoKICAvKioKICAgKiBHZXQgdGhlIG51bWJlciBvZiBsZWFkaW5nIHplcm8gYml0cyBpbiB0aGUgMzItYml0IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiBhIG51bWJlcgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIGxlYWRpbmcgemVybyBiaXRzIGluIHRoZSAzMi1iaXQgYmluYXJ5IHJlcHJlc2VudGF0aW9uIG9mIHRoYXQgbnVtYmVyLgogICAqLwogIGNsejMyLAoKICAvKioKICAgKiBUaGUgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBjb3NpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIHNpbn0KICAgKi8KICBjb3MsCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwZXJib2xpYyBjb3NpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGNvc30KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICBjb3NoLAoKICAvKioKICAgKiBUaGUgZXhwb25lbnQgZnVuY3Rpb24sIHRoYXQgaXM6IGVeeAogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgdmFsdWUgb2YgRSByYWlzZWQgdG8gdGhhdCBudW1iZXIncyBwb3dlcgogICAqCiAgICogQHNlZSB7QGxpbmsgRX0KICAgKi8KICBleHAsCgogIC8qKgogICAqIFRoZSAicm91bmQgZG93biB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIiBmdW5jdGlvbi4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludGVnZXIgcmVzdWx0IGFmdGVyIHJvdW5kaW5nIGRvd24uCiAgICoKICAgKiBAc2VlIHtAbGluayBjZWlsfQogICAqIEBzZWUge0BsaW5rIHJvdW5kfQogICAqLwogIGZsb29yLAoKICAvKioKICAgKiBSb3VuZCBhIG51bWJlciB0byB0aGUgbmVhcmVzdCAzMiBiaXQsIHJhdGhlciB0aGFuIHRoZQogICAqIHN0YW5kYXJkIEpTIDY0IGJpdCwgZmxvYXRpbmcgcG9pbnQgcmVwcmVzZW50YXRpb24uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBudW1iZXIgYWZ0ZXIgcm91bmRpbmcgdG8gdGhlIG5lYXJlc3QgMzIgYml0IGZsb2F0aW5nIHBvaW50IHJlcHJlc2VudGF0aW9uLgogICAqCiAgICogQHNlZSB7QGxpbmsgcm91bmR9CiAgICovCiAgZnJvdW5kLAoKICAvKioKICAgKiBUaGUgRXVjbGlkZWFuIGh5cG90ZW51c2UgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyW119IC4uLmlucHV0IFR3byBvciBtb3JlIG51bWJlcnMKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwb3RlbnVzZSBnaXZlbiB0aG9zZSBudW1iZXJzLgogICAqLwogIGh5cG90LAoKICAvKioKICAgKiBUaGUgMzIgYml0IGludGVnZXIgbXVsdGlwbGljYXRpb24gZnVuY3Rpb24uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gYSBBbnkgMzIgYml0IGludGVnZXIKICAgKiBAcGFyYW0ge251bWJlcn0gYiBBbnkgMzIgYml0IGludGVnZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgMzIgYml0IGludGVnZXIgcmVzdWx0IG9mIGEgKiBiCiAgICovCiAgaW11bCwKCiAgLyoqCiAgICogVGhlIG5hdHVyYWwgbG9nYXJpdGhtIGZ1bmN0aW9uLCBpLmUuIHRoZSBiYXNlLUUgbG9nYXJpdGhtCiAgICoKICAgKiAoTm90ZSB0aGF0IGluIEpTIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkICJsb2ciIHJhdGhlciB0aGFuICJsbiIpCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBuYXR1cmFsIGxvZ2FyaXRobSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgRX0KICAgKiBAc2VlIHtAbGluayBsb2d9CiAgICovCiAgbG9nOiBsbiwKCiAgLyoqCiAgICogVGhlICJjb21tb24gbG9nYXJpdGhtIiBmdW5jdGlvbiwgaS5lLiB0aGUgYmFzZS0xMCBsb2dhcml0aG0uCiAgICoKICAgKiAoTm90ZSB0aGF0IGluIEpTIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkICJsb2cxMCIgcmF0aGVyIHRoYW4gImxvZyIpCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBjb21tb24gbG9nYXJpdGhtIG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBsbn0KICAgKi8KICBsb2cxMDogbG9nLAoKICAvKioKICAgKiBUaGUgYmluYXJ5IGxvZ2FyaXRobSBmdW5jdGlvbiwgaS5lLiB0aGUgYmFzZS0yIGxvZ2FyaXRobS4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGJhc2UgMiBsb2dhcml0aG0gb2YgdGhhdCBudW1iZXIKICAgKgogICAqIEBzZWUge0BsaW5rIGxufQogICAqIEBzZWUge0BsaW5rIGxvZ30KICAgKi8KICBsb2cyLAoKICAvKioKICAgKiBGaW5kIHRoZSBtYXhpbXVtIHZhbHVlIGluIGEgc2V0IG9mIG51bWJlcnMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSAuLi5pbnB1dCBBbnkgdHdvIG9yICBtb3JlIG51bWJlcnMKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaGlnaGVzdCB2YWx1ZWQgbnVtYmVyIGZyb20gYW1vbmcgdGhlIGlucHV0LgogICAqCiAgICogQHNlZSB7QGxpbmsgbWlufQogICAqLwogIG1heCwKCiAgLyoqCiAgICogRmluZCB0aGUgbWluaW11bSB2YWx1ZSBpbiBhIHNldCBvZiBudW1iZXJzCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gLi4uaW5wdXQgQW55IHR3byBvciAgbW9yZSBudW1iZXJzCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGxvd2VzdCB2YWx1ZWQgbnVtYmVyIGZyb20gYW1vbmcgdGhlIGlucHV0LgogICAqCiAgICogQHNlZSB7QGxpbmsgbWF4fQogICAqLwogIG1pbiwKCiAgLyoqCiAgICogVGhlIHBvd2VyIGZ1bmN0aW9uLgogICAqCiAgICogTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gaXMgYSBob2xkb3ZlciBmcm9tIGJlZm9yZSBKUwogICAqIGhhZCB0aGUgYCoqYCBvcGVyYXRvciBmb3IgcGVyZm9ybWluZyB0aGlzIGNhbGN1bGF0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGEgQW55IG51bWJlcgogICAqIEBwYXJhbSB7bnVtYmVyfSBiIEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfE5hTn0gb3V0cHV0IGEgKiogYiBvciBOYU4gaWYgdGhhdCBpcyB1bmRlZmluZWQKICAgKi8KICBwb3csCgogIC8qKgogICAqIFRoZSAicm91bmQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciIgZnVuY3Rpb24sIHJvdW5kaW5nIGFueQogICAqIHZhbHVlIFt4LjAsIHguNDk5OS4uLl0gdG8geCwgYW5kIGFueSB2YWx1ZSBbeC41LCB4Ljk5OS4uLl0KICAgKiB0byB4ICsgMS4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludGVnZXIgcmVzdWx0IGFmdGVyIHJvdW5kaW5nLgogICAqCiAgICogQHNlZSB7QGxpbmsgY2VpbH0KICAgKiBAc2VlIHtAbGluayBmbG9vcn0KICAgKi8KICByb3VuZCwKCiAgLyoqCiAgICogR2V0IHRoZSBzaWduIG9mIGEgbnVtYmVyCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9ICsxIGlmIHRoZSBudW1iZXIgd2FzIHBvc2l0aXZlLCAtMSBpZiBpdCB3YXMgbmVnYXRpdmUsIG9yIDAgaWYgdGhlIGlucHV0IHdhcyB6ZXJvLgogICAqLwogIHNpZ24sCgogIC8qKgogICAqIFRoZSBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBzaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBjb3N9CiAgICovCiAgc2luLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBoeXBlcmJvbGljIHNpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIHNpbn0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICBzaW5oLAoKICAvKioKICAgKiBUaGUgc3F1YXJlIHJvb3QgZnVuY3Rpb24uCiAgICoKICAgKgogICAqIE5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIGEgaG9sZG92ZXIgZnJvbSBiZWZvcmUgSlMKICAgKiBoYWQgdGhlIGAqKmAgb3BlcmF0b3IgZm9yIHBlcmZvcm1pbmcgdGhpcyBjYWxjdWxhdGlvbgogICAqIGJ5IHVzaW5nIGB4ICoqIDAuNWAuCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBzcXVhcmUgcm9vdCBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgY2JydH0KICAgKiBAc2VlIHtAbGluayBwb3d9CiAgICovCiAgc3FydCwKCiAgLyoqCiAgICogVGhlIHRhbmdlbnQgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIHRhbmdlbnQKICAgKi8KICB0YW4sCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIHRhbmdlbnQgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnNlX2h5cGVyYm9saWNfZnVuY3Rpb25zI0RlZmluaXRpb25zX2luX3Rlcm1zX29mX2xvZ2FyaXRobXMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGh5cGVyYm9saWMgdGFuZ2VudAogICAqCiAgICogQHNlZSB7QGxpbmsgdGFufQogICAqIEBzZWUge0BsaW5rIGFzaW5ofQogICAqIEBzZWUge0BsaW5rIGFjb3NofQogICAqLwogIHRhbmgsCgogIC8qKgogICAqIFRydW5jYXRlIGEgZnJhY3Rpb24gdG8gYW4gaW50ZWdlciBieSBzaW1wbHkgZHJvcHBpbmcgdGhlIGZyYWN0aW9uYWwgcGFydC4KICAgKiBOb3RlIHRoYXQgdGhpcyBkaWZmZXJzIGZyb20gdGhlIGBmbG9vcmAgZnVuY3Rpb246CiAgICoKICAgKiBgYGAKICAgKiBmbG9vcig0LjIpOyAgLy8gNAogICAqIGZsb29yKC00LjIpOyAvLyAtNQogICAqCiAgICogdHJ1bmMoNC4yKTsgIC8vIDQKICAgKiB0cnVuYygtNC4yKTsgLy8gLTQKICAgKiBgYGAKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludGVnZXIgcGFydCBvbmx5IG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBmbG9vcn0KICAgKi8KICB0cnVuYywKfSA9IE1hdGg7CgovKioKICogR2V0IHRoZSBiaW5vbWlhbCBjb2VmZmljaWVudCAobiBjaG9vc2UgaykuCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBuIEEgcG9zaXRpdmUgaW50ZWdlcgogKiBAcGFyYW0ge251bWJlcn0gayBBIHBvc2l0aXZlIGludGVnZXIgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIGBuYAogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgdmFsdWUgKG4gY2hvb3NlIGspCiAqLwpmdW5jdGlvbiBiaW5vbWlhbChuLCBrKSB7CiAgaWYgKG4gPT09IDApIHJldHVybiAxOwogIHZhciBsdXQgPSBfX2Jpbm9taWFsQ29lZmZpY2llbnRzOwogIHdoaWxlIChuID49IGx1dC5sZW5ndGgpIHsKICAgIHZhciBzID0gbHV0Lmxlbmd0aDsKICAgIHZhciBuZXh0Um93ID0gWzFdOwogICAgZm9yICh2YXIgaSA9IDEsIHByZXYgPSBzIC0gMTsgaSA8IHM7IGkrKykgewogICAgICBuZXh0Um93W2ldID0gbHV0W3ByZXZdW2kgLSAxXSArIGx1dFtwcmV2XVtpXTsKICAgIH0KICAgIG5leHRSb3dbc10gPSAxOwogICAgbHV0LnB1c2gobmV4dFJvdyk7CiAgfQogIHJldHVybiBsdXRbbl1ba107Cn0KCi8qKgogKiBDb25zdHJhaW4gYSBudW1iZXIgdG8gd2l0aGluIGEgZ2l2ZW4gcmFuZ2UuCiAqIFRoaXMgaXMgcmVhbGx5IG5vdGhpbmcgbW9yZSB0aGFuIGEgY29udmVuaWVudAogKiBmdW5jdGlvbiB3cmFwcGVyIGFyb3VuZCB0aGUgc3RhdGVtZW50OgogKgogKiBgYGAKICogdiA8IHMgPyBzIDogdiA+IGUgPyBlIDogdgogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb25zdHJhaW4KICogQHBhcmFtIHtudW1iZXJ9IGxvd2VyQm91bmQgVGhlIGxvd2VyIGJvdW5kIG9uIG91ciB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gdXBwZXJCb3VuZCBUaGUgdXBwZXIgYm91bmQgb24gb3VyIHZhbHVlCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSB2YWx1ZSwgaWYgaXQgZmFsbHMgd2l0aGluZyBbbG93ZXJCb3VuZCx1cHBlckJvdW5kXSwgb3RoZXJ3aXNlIG9uZSBvZiB0aG9zZSBib3VuZHMuCiAqCiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbk1hcH0KICovCmZ1bmN0aW9uIGNvbnN0cmFpbih2LCBzLCBlKSB7CiAgcmV0dXJuIHYgPCBzID8gcyA6IHYgPiBlID8gZSA6IHY7Cn0KCi8qKgogKiBUaGUgY290YW5nZW50IGZ1bmN0aW9uCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBjb3RhbmdlbnQKICoKICogQHNlZSB7QGxpbmsgdGFufQogKi8KZnVuY3Rpb24gY290KHYpIHsKICByZXR1cm4gMSAvIHRhbih2KTsKfQoKLyoqCiAqIFRoZSBjb3NlY2FudCBmdW5jdGlvbiwgd2hpY2ggaXM6CiAqCiAqIGBgYAogKiAxIC8gc2luKHYpCiAqIGBgYAogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIGlucHV0IHZhbHVlLCBpbiByYWRpYW5zLgogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY29zZWNhbnQgb2Ygb3VyIHZhbHVlLgogKgogKiBAc2VlIHtAbGluayBzZWN9CiAqLwpmdW5jdGlvbiBjc2ModikgewogIHJldHVybiAxIC8gc2luKHYpOwp9CgovKioKICogVGhlIGNvdGFuZ2VudCBmdW5jdGlvbiwgd2hpY2ggaXM6CiAqCiAqIGBgYAogKiBjb3ModikgLyBzaW4odikKICogYGBgCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgaW5wdXQgdmFsdWUsIGluIHJhZGlhbnMuCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBjb3RhbmdlbnQgb2Ygb3VyIHZhbHVlLgogKgogKiBAc2VlIHtAbGluayB0YW59CiAqLwpmdW5jdGlvbiBjdG4odikgewogIHJldHVybiBjb3ModikgLyBzaW4odik7Cn0KCi8qKgogKiBDb252ZXJ0IGEgbnVtYmVyIGluIHJhZGlhbnMgdG8gYSBudW1iZXIgaW4gZGVncmVlcy4KICogVGhpcyBpcyByZWFsbHkgbm90aGluZyBtb3JlIHRoYW4gYSBjb252ZW5pZW50CiAqIGZ1bmN0aW9uIHdyYXBwZXIgYXJvdW5kIHRoZSBzdGF0ZW1lbnQ6CiAqCiAqIGBgYAogKiB2L1BJICogMTgwCiAqIGBgYAogKgogKiBXaXRoIG9uZSB0cmljaywgaW4gdGhhdCBpdCBhbGxvd3MgeW91IHRvIGNvbnN0cmFpbiB0aGUKICogcmVzdWx0YW50IHZhbHVlIHRvIHRoZSBzdGFuZGFyZCBbMCwgMzYwXSBpbnRlcnZhbC4KICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb25zdHJhaW4KICogQHBhcmFtIHtib29sZWFufSBjb25zdHJhaW4/IEEgYm9vbGVhbiB0aGF0IGRldGVybWluZXMgd2hldGhlciBvciBub3QgdG8gY29uc3RyYWluIHRoZSByZXN1bHRhbnQgdmFsdWUgdG8gWzAsIDM2MF0gKGRlZmF1bHQgPSBmYWxzZSkKICogQHJldHVybnMge251bWJlcn0gVGhlIGRlZ3JlZSB2YWx1ZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBpbnB1dCB2YWx1ZSBpbiByYWRpYW5zLCBvcHRpb25hbGx5IGNvbnN0cmFpbmVkIHRvIFswLCAzNjBdCiAqCiAqIEBzZWUge0BsaW5rIHJhZGlhbnN9CiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbn0KICovCmZ1bmN0aW9uIGRlZ3JlZXModiwgY29uc3RyYWluID0gZmFsc2UpIHsKICBsZXQgZCA9ICh2IC8gUEkpICogMTgwOwogIGlmICghY29uc3RyYWluKSByZXR1cm4gZDsKICB3aGlsZSAoZCA8IDApIGQgKz0gMzYwOwogIHJldHVybiBkICUgMzYwOwp9CgovKioKICogQ2FsY3VsYXRlIHRoZSAyRCBFdWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiB0d28gcG9pbnRzLgogKgogKiBAcGFyYW0ge251bWJlcn0geDEgVGhlIGZpcnN0IHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTEgVGhlIGZpcnN0IHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geDIgVGhlIHNlY29uZCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkyIFRoZSBzZWNvbmQgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBldWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiB0aGUgdHdvIGNvb3JkaW5hdGVzCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMSBUaGUgZmlyc3QgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMiBUaGUgc2Vjb25kIHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgZXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gdGhlIHR3byBjb29yZGluYXRlcwogKi8KZnVuY3Rpb24gZGlzdCh4MSwgeTEsIHgyLCB5MikgewogIGlmICh4MS54ICE9PSB1bmRlZmluZWQgJiYgeDEueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5MiA9IHkxLnk7CiAgICB4MiA9IHkxLng7CiAgICB5MSA9IHgxLnk7CiAgICB4MSA9IHgxLng7CiAgfQogIGNvbnN0IGR4ID0geDIgLSB4MTsKICBjb25zdCBkeSA9IHkyIC0geTE7CiAgcmV0dXJuIGh5cG90KGR4LCBkeSk7Cn0KCi8qKgogKiBQZXJmb3JtcyBhIGxpbmUvbGluZSBpbnRlcnNlY3Rpb24gdGVzdCBnaXZlIGVpdGhlciBmb3VyIHBvaW50cwogKiBkZWZpbmluZyB0aGUgbGluZXMgKHAxLS1wMikgYW5kIChwMy0tcDQpLCBvciBlaWdodCBjb29yZGluYXRlcwogKiBzcGFubmluZyBsaW5lcyAoeDEseTEpLS0oeDIseTIpIGFuZCAoeDMseTMpLS0oeDQseTQpLgogKgogKiBUaGlzIGZ1bmN0aW9uIGNvdmVycyBib3RoICJsaW5lL2xpbmUiIGFuZCAic2VnbWVudCIvInNlZ21lbnQiCiAqIHRlc3RpbmcgYnkgc2V0dGluZyBhIGJvb2xlYW4gdmFsdWUgYGluQm91bmRzYCBvbiB0aGUgcmVzdWx0OgogKiB3aGVuIGZhbHNlLCB0aGVyZSBpcyBvbmx5IGEgbGluZS9saW5lIGludGVyc2VjdGlvbiwgYnV0IHdoZW4KICogdHJ1ZSwgdGhlIGFjdHVhbCBsaW5lIHNlZ21lbnRzIGludGVyc2VjdC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIGNlbnRlcigpOwogKiAgICAgICAvLyAuLi5jb2RlIGdvZXMgaGVyZS4uLgogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4MSBUaGUgZmlyc3QgcG9pbnQncyB4IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHkxIFRoZSBmaXJzdCBwb2ludCdzIHkgY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0geDIgVGhlIHNlY29uZCBwb2ludCdzIHggY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0geTIgVGhlIHNlY29uZCBwb2ludCdzIHkgY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0geDMgVGhlIHRoaXJkIHBvaW50J3MgeCBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MyBUaGUgdGhpcmQgcG9pbnQncyB5IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHg0IFRoZSBmb3VydGggcG9pbnQncyB4IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHk0IFRoZSBmb3VydGggcG9pbnQncyB5IGNvb3JkaW5hdGUKICogQHJldHVybnMge1BvaW50TGlrZXxmYWxzZX0gRWl0aGVyIHRoZSBpbnRlcnNlY3Rpb24gcG9pbnQsIG9yIGZhbHNlIGlmIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbgogKgogKiBAcGFyYW0ge1BvaW50TGluZX0gcDEgVGhlIGZpcnN0IGNvb3JkaW5hdGUKICogQHBhcmFtIHtQb2ludExpbmV9IHAyIFRoZSBzZWNvbmQgY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGluZX0gcDMgVGhlIHRoaXJkIGNvb3JkaW5hdGUKICogQHBhcmFtIHtQb2ludExpbmV9IHA0IFRoZSBmb3VydGggY29vcmRpbmF0ZQogKiBAcmV0dXJucyB7UG9pbnRMaWtlfGZhbHNlfSBFaXRoZXIgdGhlIGludGVyc2VjdGlvbiBwb2ludCwgb3IgZmFsc2UgaWYgdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uCiAqLwpmdW5jdGlvbiBsbGkoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MywgeDQsIHk0KSB7CiAgaWYgKHgxLnggIT09IHVuZGVmaW5lZCAmJiB4MS55ICE9PSB1bmRlZmluZWQpIHsKICAgIHk0ID0geTIueTsKICAgIHg0ID0geTIueDsKICAgIHkzID0geDIueTsKICAgIHgzID0geDIueDsKICAgIHkyID0geTEueTsKICAgIHgyID0geTEueDsKICAgIHkxID0geDEueTsKICAgIHgxID0geDEueDsKICB9CiAgY29uc3QgbnggPSAoeDEgKiB5MiAtIHkxICogeDIpICogKHgzIC0geDQpIC0gKHgxIC0geDIpICogKHgzICogeTQgLSB5MyAqIHg0KTsKICBjb25zdCBueSA9ICh4MSAqIHkyIC0geTEgKiB4MikgKiAoeTMgLSB5NCkgLSAoeTEgLSB5MikgKiAoeDMgKiB5NCAtIHkzICogeDQpOwogIGNvbnN0IGQgPSAoeDEgLSB4MikgKiAoeTMgLSB5NCkgLSAoeTEgLSB5MikgKiAoeDMgLSB4NCk7CgogIGlmIChkID09PSAwKSByZXR1cm4gZmFsc2U7CgogIGNvbnN0IHIgPSB7IHg6IG54IC8gZCwgeTogbnkgLyBkLCBpbkJvdW5kczogdHJ1ZSB9OwogIGxldCBhID0geDE7CiAgbGV0IGIgPSB4MjsKICBpZiAoeDEgPiB4MikgewogICAgYSA9IHgyOwogICAgYiA9IHgxOwogIH0KICBpZiAoci54IDwgYSB8fCByLnggPiBiKSByLmluQm91bmRzID0gZmFsc2U7CiAgZWxzZSB7CiAgICBhID0geTE7CiAgICBiID0geTI7CiAgICBpZiAoeTEgPiB5MikgewogICAgICBhID0geTI7CiAgICAgIGIgPSB5MTsKICAgIH0KICAgIGlmIChyLnkgPCBhIHx8IHIueSA+IGIpIHIuaW5Cb3VuZHMgPSBmYWxzZTsKICAgIGVsc2UgewogICAgICBhID0geDM7CiAgICAgIGIgPSB4NDsKICAgICAgaWYgKHgzID4geDQpIHsKICAgICAgICBhID0geDQ7CiAgICAgICAgYiA9IHgzOwogICAgICB9CiAgICAgIGlmIChyLnggPCBhIHx8IHIueCA+IGIpIHIuaW5Cb3VuZHMgPSBmYWxzZTsKICAgICAgZWxzZSB7CiAgICAgICAgYSA9IHkzOwogICAgICAgIGIgPSB5NDsKICAgICAgICBpZiAoeTMgPiB5NCkgewogICAgICAgICAgYSA9IHk0OwogICAgICAgICAgYiA9IHkzOwogICAgICAgIH0KICAgICAgICBpZiAoci55IDwgYSB8fCByLnkgPiBiKSByLmluQm91bmRzID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIHI7Cn0KCi8qKgogKiBNYXAgYSB2YWx1ZSBmcm9tIG9uZSBpbnRlcnZhbCB0byBhbm90aGVyLCBvcHRpb25hbGx5CiAqIGNvbnN0cmFpbmVkIHRvIHRoZSB0YXJnZXQgaW50ZXJ2YWwuCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBPdXIgaW5wdXQgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IG9yaWdpbmFsU3RhcnQgVGhlIGxvd2VyIGJvdW5kIG9mIG91ciBkb21haW4KICogQHBhcmFtIHtudW1iZXJ9IG9yaWdpbmFsRW5kIFRoZSB1cHBlciBib3VuZCBvZiBvdXIgZG9tYWluCiAqIEBwYXJhbSB7bnVtYmVyfSBuZXdTdGFydCBUaGUgbG93ZXIgYm91bmQgb2Ygb3VyIHRhcmdldCBpbnRlcnZhbAogKiBAcGFyYW0ge251bWJlcn0gbmV3RW5kIFRoZSB1cHBlciBib3VuZCBvbiBvdXIgdGFyZ2V0IGludGVydmFsCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY29uc3RyYWluPyAgQSBib29sZWFuIHRoYXQgZGV0ZXJtaW5lcyB3aGV0aGVyIG9yIG5vdCB0byBjb25zdHJhaW4gdGhlIHJlc3VsdGFudCB2YWx1ZSB0byBbbmV3U3RhcnQsbmV3RW5kXSAoZGVmYXVsdCA9IGZhbHNlKQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgcmVzdWx0IG9mIG1hcHBpbmcgb3VyIHZhbHVlIGZyb20gb3VyIGRvbWFpbiBpbnRlcnZhbCB0byBvdXIgdGFyZ2V0IGludGVydmFsLCBvcHRpb25hbGx5IGNvbnN0cmFpbmVkIHRvIHRoZSB0YXJnZXQgaW50ZXJ2YWwuCiAqCiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbn0KICogQHNlZSB7QGxpbmsgY29uc3RyYWluTWFwfQogKi8KZnVuY3Rpb24gbWFwKHYsIHMsIGUsIG5zLCBuZSwgY29uc3RyYWluZWQgPSBmYWxzZSkgewogIGNvbnN0IGkxID0gZSAtIHMsCiAgICBpMiA9IG5lIC0gbnMsCiAgICBwID0gdiAtIHM7CiAgbGV0IHIgPSBucyArIChwICogaTIpIC8gaTE7CiAgaWYgKGNvbnN0cmFpbmVkKSByZXR1cm4gY29uc3RyYWluKHIsIG5zLCBuZSk7CiAgcmV0dXJuIHI7Cn0KCi8qKgogKiBDb252ZXJ0IGEgbnVtYmVyIGluIGRlZ3JlZXMgdG8gYSBudW1iZXIgaW4gcmFkaWFucy4KICogVGhpcyBpcyByZWFsbHkgbm90aGluZyBtb3JlIHRoYW4gYSBjb252ZW5pZW50CiAqIGZ1bmN0aW9uIHdyYXBwZXIgYXJvdW5kIHRoZSBzdGF0ZW1lbnQ6CiAqCiAqIGBgYAogKiB2LzE4MCAqIFBJCiAqIGBgYAogKgogKiBXaXRoIG9uZSB0cmljaywgaW4gdGhhdCBpdCBhbGxvd3MgeW91IHRvIGNvbnN0cmFpbiB0aGUKICogcmVzdWx0YW50IHZhbHVlIHRvIHRoZSBzdGFuZGFyZCBbMCwgVEFVXSBpbnRlcnZhbC4KICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb25zdHJhaW4KICogQHBhcmFtIHtib29sZWFufSBjb25zdHJhaW4/IEEgYm9vbGVhbiB0aGF0IGRldGVybWluZXMgd2hldGhlciBvciBub3QgdG8gY29uc3RyYWluIHRoZSByZXN1bHRhbnQgdmFsdWUgdG8gWzAsIFRBVV0gKGRlZmF1bHQgPSBmYWxzZSkKICogQHJldHVybnMge251bWJlcn0gVGhlIHJhZGlhbnMgdmFsdWUgY29ycmVzcG9uZGluZyB0byB0aGUgaW5wdXQgdmFsdWUgaW4gZGVncmVlcywgb3B0aW9uYWxseSBjb25zdHJhaW5lZCB0byBbMCwgVEFVXQogKgogKiBAc2VlIHtAbGluayBkZWdyZWVzfQogKiBAc2VlIHtAbGluayBjb25zdHJhaW59CiAqLwpmdW5jdGlvbiByYWRpYW5zKHYsIGNvbnN0cmFpbiA9IGZhbHNlKSB7CiAgbGV0IHIgPSAodiAvIDE4MCkgKiBQSTsKICBpZiAoIWNvbnN0cmFpbikgcmV0dXJuIHI7CiAgd2hpbGUgKHIgPCAwKSByICs9IFRBVTsKICByZXR1cm4gciAlIFRBVTsKfQoKLyoqCiAqIEdlbmVyYXRlIGEgcHNldWRvLXJhbmRvbSBudW1iZXIuCiAqCiAqIFRoaXMgaXMgYmFzZWQgb24gdGhlIFNwbGl0TWl4MzIgYWxnb3JpdGhtLCBjb3ZlcmVkCiAqIG92ZXIgb24gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzQ3NTkzMzE2Lzc0MDU1MwogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRGb250U2l6ZSgyMCk7CiAqICAgICAgIHJhbmdlKDAsIGhlaWdodCArIDIwLCAyMCwgKHYpID0+IHsKICogICAgICAgICB0ZXh0KHJhbmRvbSgpLCA1LCB2KTsKICogICAgICAgfSkKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKgogKgogKiBAcmV0dXJucyB7bnVtYmVyfSBBIHJhbmRvbSBudW1iZXIgaW4gdGhlIGludGVydmFsIFswLDEpCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBhIFRoZSB1cHBlciBib3VuZCBmb3IgdGhlIHJhbmRvbSBudW1iZXIKICogQHJldHVybnMge251bWJlcn0gQSByYW5kb20gbnVtYmVyIGluIHRoZSBpbnRlcnZhbCBbMCxhKQogKgogKiBAcGFyYW0ge251bWJlcn0gYSBUaGUgbG93ZXIgYm91bmQgZm9yIHRoZSByYW5kb20gbnVtYmVyCiAqIEBwYXJhbSB7bnVtYmVyfSBiIFRoZSB1cHBlciBib3VuZCBmb3IgdGhlIHJhbmRvbSBudW1iZXIKICogQHJldHVybnMge251bWJlcn0gQSByYW5kb20gbnVtYmVyIGluIHRoZSBpbnRlcnZhbCBbYSwgYikKICoKICogQHNlZSB7QGxpbmsgcmFuZG9tU2VlZH0KICovCmZ1bmN0aW9uIHJhbmRvbShhID0gMSwgYikgewogIGNvbnN0IHIgPSBfX3BybmcubmV4dCgpOwogIGlmIChiID09PSB1bmRlZmluZWQpIHJldHVybiBhICogcjsKICByZXR1cm4gYSArIHIgKiAoYiAtIGEpOwp9CgovKioKICogU2V0IHRoZSBwc2V1ZG8tcmFuZG9tIG51bWJlciBnZW5lcmF0b3Igc2VlZC4gSWYgbm8gc2VlZAogKiB2YWx1ZSBpcyBwcm92aWRlZCwgdGhpcyBpcyBlcXVpdmFsZW50IHRvIGNhbGxpbmc6CiAqCiAqIGBgYAogKiByYW5kb21TZWVkKERhdGUubm93KCkgKiBNYXRoLnJhbmRvbSgpKQogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHNlZWQ/IFRoZSByYW5kb20gc2VlZCB2YWx1ZS4KICoKICogQHNlZSB7QGxpbmsgcmFuZG9tfQogKi8KZnVuY3Rpb24gcmFuZG9tU2VlZChzZWVkID0gRGF0ZS5ub3coKSAqIE1hdGgucmFuZG9tKCkpIHsKICBfX3BybmcucmVzZWVkKHNlZWQpOwp9CgovKioKICogVGhlIHNlY2FudCBmdW5jdGlvbiwgd2hpY2ggaXM6CiAqCiAqIGBgYAogKiAxIC8gY29zKHYpCiAqIGBgYAogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIGlucHV0IHZhbHVlLCBpbiByYWRpYW5zLgogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgc2VjYW50IG9mIG91ciB2YWx1ZS4KICoKICogQHNlZSB7QGxpbmsgY3NjfQogKi8KZnVuY3Rpb24gc2VjKHYpIHsKICByZXR1cm4gMSAvIGNvcyh2KTsKfQovKioKICogSW52ZXJ0IGEgbWF0cml4LCBvciB1bmRlZmluZWQgaWYgdGhlIG1hdHJpeCBpcyBub3QgaW52ZXJ0aWJsZS4KICoKICogQHBhcmFtIHtNYXRyaXh9IE0gVGhlIG1hdHJpeCB0byBpbnZlcnQKICogQHJldHVybnMge251bWJlcltdW119IFRoZSBtYXRyaXggaW52ZXJzZSBhcyAyRCBudW1iZXIgYXJyYXkKICovCmZ1bmN0aW9uIGludmVydE1hdHJpeChNKSB7CiAgLy8gQ29waWVkIGZyb20gaHR0cDovL2Jsb2cuYWNpcG8uY29tL21hdHJpeC1pbnZlcnNpb24taW4tamF2YXNjcmlwdC8KICAvLyBXaXRoIHBlcm1pc3Npb24sIGh0dHA6Ly9ibG9nLmFjaXBvLmNvbS9tYXRyaXgtaW52ZXJzaW9uLWluLWphdmFzY3JpcHQvI2NvbW1lbnQtNTA1NzI4OTg4OQoKICAvLyAoMSkgJ2F1Z21lbnQnIHRoZSBtYXRyaXggKGxlZnQpIGJ5IHRoZSBpZGVudGl0eSAob24gdGhlIHJpZ2h0KQogIC8vICgyKSBUdXJuIHRoZSBtYXRyaXggb24gdGhlIGxlZnQgaW50byB0aGUgaWRlbnRpdHkgYnkgZWxlbWV0cnkgcm93IG9wcwogIC8vICgzKSBUaGUgbWF0cml4IG9uIHRoZSByaWdodCBpcyB0aGUgaW52ZXJzZSAod2FzIHRoZSBpZGVudGl0eSBtYXRyaXgpCiAgLy8gVGhlcmUgYXJlIDMgZWxlbXRhcnkgcm93IG9wczoKICAvLyAoYSkgU3dhcCAyIHJvd3MKICAvLyAoYikgTXVsdGlwbHkgYSByb3cgYnkgYSBzY2FsYXIKICAvLyAoYykgQWRkIDIgcm93cwoKICAvLyBpZiB0aGUgbWF0cml4IGlzbid0IHNxdWFyZTogZXhpdCAoZXJyb3IpCiAgaWYgKE0ubGVuZ3RoICE9PSBNWzBdLmxlbmd0aCkgewogICAgY29uc29sZS53YXJuKCJDYW5ub3QgaW52ZXJ0IG5vbi1zcXVhcmUgbWF0cmljZXMiKTsKICAgIHJldHVybjsKICB9CgogIC8vIGNyZWF0ZSB0aGUgaWRlbnRpdHkgbWF0cml4IChJKSwgYW5kIGEgY29weSAoQykgb2YgdGhlIG9yaWdpbmFsCiAgdmFyIGkgPSAwLAogICAgaWkgPSAwLAogICAgaiA9IDAsCiAgICBkaW0gPSBNLmxlbmd0aCwKICAgIGUgPSAwLAogICAgdCA9IDA7CiAgdmFyIEkgPSBbXSwKICAgIEMgPSBbXTsKICBmb3IgKGkgPSAwOyBpIDwgZGltOyBpICs9IDEpIHsKICAgIC8vIENyZWF0ZSB0aGUgcm93CiAgICBJW0kubGVuZ3RoXSA9IFtdOwogICAgQ1tDLmxlbmd0aF0gPSBbXTsKICAgIGZvciAoaiA9IDA7IGogPCBkaW07IGogKz0gMSkgewogICAgICAvL2lmIHdlJ3JlIG9uIHRoZSBkaWFnb25hbCwgcHV0IGEgMSAoZm9yIGlkZW50aXR5KQogICAgICBpZiAoaSA9PSBqKSB7CiAgICAgICAgSVtpXVtqXSA9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgSVtpXVtqXSA9IDA7CiAgICAgIH0KCiAgICAgIC8vIEFsc28sIG1ha2UgdGhlIGNvcHkgb2YgdGhlIG9yaWdpbmFsCiAgICAgIENbaV1bal0gPSBNW2ldW2pdOwogICAgfQogIH0KCiAgLy8gUGVyZm9ybSBlbGVtZW50YXJ5IHJvdyBvcGVyYXRpb25zCiAgZm9yIChpID0gMDsgaSA8IGRpbTsgaSArPSAxKSB7CiAgICAvLyBnZXQgdGhlIGVsZW1lbnQgZSBvbiB0aGUgZGlhZ29uYWwKICAgIGUgPSBDW2ldW2ldOwoKICAgIC8vIGlmIHdlIGhhdmUgYSAwIG9uIHRoZSBkaWFnb25hbCAod2UnbGwgbmVlZCB0byBzd2FwIHdpdGggYSBsb3dlciByb3cpCiAgICBpZiAoZSA9PSAwKSB7CiAgICAgIC8vbG9vayB0aHJvdWdoIGV2ZXJ5IHJvdyBiZWxvdyB0aGUgaSd0aCByb3cKICAgICAgZm9yIChpaSA9IGkgKyAxOyBpaSA8IGRpbTsgaWkgKz0gMSkgewogICAgICAgIC8vaWYgdGhlIGlpJ3RoIHJvdyBoYXMgYSBub24tMCBpbiB0aGUgaSd0aCBjb2wKICAgICAgICBpZiAoQ1tpaV1baV0gIT0gMCkgewogICAgICAgICAgLy9pdCB3b3VsZCBtYWtlIHRoZSBkaWFnb25hbCBoYXZlIGEgbm9uLTAgc28gc3dhcCBpdAogICAgICAgICAgZm9yIChqID0gMDsgaiA8IGRpbTsgaisrKSB7CiAgICAgICAgICAgIGUgPSBDW2ldW2pdOyAvL3RlbXAgc3RvcmUgaSd0aCByb3cKICAgICAgICAgICAgQ1tpXVtqXSA9IENbaWldW2pdOyAvL3JlcGxhY2UgaSd0aCByb3cgYnkgaWkndGgKICAgICAgICAgICAgQ1tpaV1bal0gPSBlOyAvL3JlcGFjZSBpaSd0aCBieSB0ZW1wCiAgICAgICAgICAgIGUgPSBJW2ldW2pdOyAvL3RlbXAgc3RvcmUgaSd0aCByb3cKICAgICAgICAgICAgSVtpXVtqXSA9IElbaWldW2pdOyAvL3JlcGxhY2UgaSd0aCByb3cgYnkgaWkndGgKICAgICAgICAgICAgSVtpaV1bal0gPSBlOyAvL3JlcGFjZSBpaSd0aCBieSB0ZW1wCiAgICAgICAgICB9CiAgICAgICAgICAvL2Rvbid0IGJvdGhlciBjaGVja2luZyBvdGhlciByb3dzIHNpbmNlIHdlJ3ZlIHN3YXBwZWQKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICAvL2dldCB0aGUgbmV3IGRpYWdvbmFsCiAgICAgIGUgPSBDW2ldW2ldOwogICAgICAvL2lmIGl0J3Mgc3RpbGwgMCwgbm90IGludmVydGlibGUgKGVycm9yKQogICAgICBpZiAoZSA9PSAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CgogICAgLy8gU2NhbGUgdGhpcyByb3cgZG93biBieSBlIChzbyB3ZSBoYXZlIGEgMSBvbiB0aGUgZGlhZ29uYWwpCiAgICBmb3IgKGogPSAwOyBqIDwgZGltOyBqKyspIHsKICAgICAgQ1tpXVtqXSA9IENbaV1bal0gLyBlOyAvL2FwcGx5IHRvIG9yaWdpbmFsIG1hdHJpeAogICAgICBJW2ldW2pdID0gSVtpXVtqXSAvIGU7IC8vYXBwbHkgdG8gaWRlbnRpdHkKICAgIH0KCiAgICAvLyBTdWJ0cmFjdCB0aGlzIHJvdyAoc2NhbGVkIGFwcHJvcHJpYXRlbHkgZm9yIGVhY2ggcm93KSBmcm9tIEFMTCBvZgogICAgLy8gdGhlIG90aGVyIHJvd3Mgc28gdGhhdCB0aGVyZSB3aWxsIGJlIDAncyBpbiB0aGlzIGNvbHVtbiBpbiB0aGUKICAgIC8vIHJvd3MgYWJvdmUgYW5kIGJlbG93IHRoaXMgb25lCiAgICBmb3IgKGlpID0gMDsgaWkgPCBkaW07IGlpKyspIHsKICAgICAgLy8gT25seSBhcHBseSB0byBvdGhlciByb3dzICh3ZSB3YW50IGEgMSBvbiB0aGUgZGlhZ29uYWwpCiAgICAgIGlmIChpaSA9PSBpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIC8vIFdlIHdhbnQgdG8gY2hhbmdlIHRoaXMgZWxlbWVudCB0byAwCiAgICAgIGUgPSBDW2lpXVtpXTsKCiAgICAgIC8vIFN1YnRyYWN0ICh0aGUgcm93IGFib3ZlKG9yIGJlbG93KSBzY2FsZWQgYnkgZSkgZnJvbSAodGhlCiAgICAgIC8vIGN1cnJlbnQgcm93KSBidXQgc3RhcnQgYXQgdGhlIGkndGggY29sdW1uIGFuZCBhc3N1bWUgYWxsIHRoZQogICAgICAvLyBzdHVmZiBsZWZ0IG9mIGRpYWdvbmFsIGlzIDAgKHdoaWNoIGl0IHNob3VsZCBiZSBpZiB3ZSBtYWRlIHRoaXMKICAgICAgLy8gYWxnb3JpdGhtIGNvcnJlY3RseSkKICAgICAgZm9yIChqID0gMDsgaiA8IGRpbTsgaisrKSB7CiAgICAgICAgQ1tpaV1bal0gLT0gZSAqIENbaV1bal07IC8vYXBwbHkgdG8gb3JpZ2luYWwgbWF0cml4CiAgICAgICAgSVtpaV1bal0gLT0gZSAqIElbaV1bal07IC8vYXBwbHkgdG8gaWRlbnRpdHkKICAgICAgfQogICAgfQogIH0KCiAgLy93ZSd2ZSBkb25lIGFsbCBvcGVyYXRpb25zLCBDIHNob3VsZCBiZSB0aGUgaWRlbnRpdHkKICAvL21hdHJpeCBJIHNob3VsZCBiZSB0aGUgaW52ZXJzZToKICByZXR1cm4gSTsKfQoKLyoqCiAqIE11bHRpcGx5IHR3byBtYXRyaWNlcwogKgogKiBAcGFyYW0ge01hdHJpeH0gbTEKICogQHBhcmFtIHtNYXRyaXh9IG0yCiAqIEByZXR1cm5zIHtudW1iZXJbXVtdfSBUaGUgcmVzdWx0IG9mIG0xICogbTIgIGFzIDJEIG51bWJlciBhcnJheQogKi8KZnVuY3Rpb24gbXVsdGlwbHlNYXRyaXgobTEsIG0yKSB7CiAgdmFyIE0gPSBbXTsKICB2YXIgbTJ0ID0gdHJhbnNwb3NlTWF0cml4KG0yKTsKICBtMS5mb3JFYWNoKChyb3csIHIpID0+IHsKICAgIE1bcl0gPSBbXTsKICAgIG0ydC5mb3JFYWNoKChjb2wsIGMpID0+IHsKICAgICAgTVtyXVtjXSA9IHJvdy5tYXAoKHYsIGkpID0+IGNvbFtpXSAqIHYpLnJlZHVjZSgoYSwgdikgPT4gYSArIHYsIDApOwogICAgfSk7CiAgfSk7CiAgcmV0dXJuIE07Cn0KCi8qKgogKiBUcmFuc3Bvc2UgYSBtYXRyaXgKICoKICogQHBhcmFtIHtNYXRyaXh9IE0gVGhlIG1hdHJpeCB0byB0cmFuc3Bvc2UKICogQHJldHVybnMge251bWJlcltdW119IFRoZSBtYXRyaXggdHJhbnNwb3NlIGFzIDJEIG51bWJlciBhcnJheQogKi8KZnVuY3Rpb24gdHJhbnNwb3NlTWF0cml4KE0pIHsKICByZXR1cm4gTVswXS5tYXAoKGNvbCwgaSkgPT4gTS5tYXAoKHJvdykgPT4gcm93W2ldKSk7Cn0KLyoqCiAqIFNldCB1cCBhIDNEIHRvIDJEIHByb2plY3Rvci4gVGhpcyBjYW4gYmUgZWl0aGVyIGEgYENBQklORVRgCiAqIG9yIGBIT01PR0VORU9VU2AgcHJvamVjdG9yLCBzdXBwb3J0aW5nIHRoZSBmb2xsb3dpbmcgQVBJOgogKgogKiAtIGBwcm9qZWN0b3Iuc2V0Um90YXRpb24oeCwgeSwgeilgCiAqIC0gYHByb2plY3Rvci5zZXRUcmFuc2xhdGlvbih0eCwgdHksIHR6KWAKICogLSBgcHJvamVjdG9yLnNldFNjYWxlKHR4LCB0eSwgdHopYAogKgogKiBmdXJ0aGVybW9yZSwgdGhlIGBDQUJJTkVUYCBwcm9qZWN0b3Igc3VwcG9ydHMgc2V0dGluZyB0aGUKICogZGVmYXVsdCBjYWJpbmV0IGFuZ2xlIHVzaW5nOgogKgogKiAtIGBwcm9qZWN0b3Iuc2V0UGhpKHBoaSlgCiAqCiAqIGFuZCB0aGUgYEhPTU9HRU5FT1VTYCBwcm9qZWN0aW9uIHN1cHBvcnRzIHNldHRpbmcgdGhlIGRpc3RhbmNlCiAqIG9mIHRoZSBwb2ludC1hdC1pbmZpbml0eSBieSB1c2luZzoKICoKICogLSBgcHJvamVjdG9yLnNldEluZmluaXR5KGRpc3RhbmNlKWAgKG5vdGUsIGBkaXN0YW5jZWAgY2FuIGJlIGBJbmZpbml0eWApCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBjYWJpbmV0ID0gY3JlYXRlUHJvamVjdG9yKENBQklORVQpOwogKiAgICAgY29uc3QgaG9tb2dlbmVvdXMgPSBjcmVhdGVQcm9qZWN0b3IoSE9NT0dFTkVPVVMpOwogKiAgICAgY29uc3QgYm90dG9tID0gWwogKiAgICAgICBbLTEsIC0xLCAtMV0sCiAqICAgICAgIFsgMSwgLTEsIC0xXSwKICogICAgICAgWyAxLCAgMSwgLTFdLAogKiAgICAgICBbLTEsICAxLCAtMV0sCiAqICAgICBdOwogKiAgICAgY29uc3QgdG9wID0gYm90dG9tLm1hcCh2ID0+IFt2WzBdLCB2WzFdLCAxXSk7CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSg0MDAsIDIwMCk7CiAqICAgICAgIGNhYmluZXQuc2V0U2NhbGUoNTApOwogKiAgICAgICBob21vZ2VuZW91cy5zZXRTY2FsZSg1MCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKC13aWR0aC80LCBoZWlnaHQvMik7CiAqICAgICAgIFtjYWJpbmV0LCBob21vZ2VuZW91c10uZm9yRWFjaChwcm9qZWN0b3IgPT4gewogKiAgICAgICAgIHNldFByb2plY3Rvcihwcm9qZWN0b3IpOwogKiAgICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCAwKTsKICogICAgICAgICBkcmF3QXhpc1BvaW50cygpOwogKiAgICAgICAgIGRyYXdDdWJlKCk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhd0F4aXNQb2ludHMoKSB7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwb2ludCguLi5ib3R0b21bMF0pOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHBvaW50KC4uLmJvdHRvbVsxXSk7CiAqICAgICAgIHNldENvbG9yKGBncmVlbmApOwogKiAgICAgICBwb2ludCguLi5ib3R0b21bM10pOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICBwb2ludCguLi50b3BbMF0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhd0N1YmUoKSB7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICBzZXRTdHJva2UoYHJlZGApOwogKiAgICAgICBbYm90dG9tLCB0b3BdLmZvckVhY2gociA9PiB7CiAqICAgICAgICAgbGluZSguLi5yWzBdLCAuLi5yWzFdKTsKICogICAgICAgICBsaW5lKC4uLnJbMl0sIC4uLnJbM10pOwogKiAgICAgICB9KTsKICogICAgICAgc2V0U3Ryb2tlKGBncmVlbmApOwogKiAgICAgICBbYm90dG9tLCB0b3BdLmZvckVhY2gociA9PiB7CiAqICAgICAgICAgbGluZSguLi5yWzFdLCAuLi5yWzJdKTsKICogICAgICAgICBsaW5lKC4uLnJbM10sIC4uLnJbMF0pOwogKiAgICAgICB9KTsKICogICAgICAgc2V0U3Ryb2tlKGBibHVlYCk7CiAqICAgICAgIFswLDEsMiwzXS5mb3JFYWNoKGkgPT4gbGluZSguLi5ib3R0b21baV0sIC4uLnRvcFtpXSkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7aW1wbGllZH0gZmFsc2V5IHdoZW4gY2FsbGVkIHdpdGggYSBmYWxzZXkgYXJndW1lbnQgKG9yIG5vIGFyZ3VtZW50KSwgZGlzYWJsZXMgcHJvamVjdG9yIHJlbGF0ZWQgZnVuY3Rpb25hbGl0eS4KICogQHJldHVybnMge2ZhbHNlfSBmYWxzZS4KICoKICogQHBhcmFtIHtTeW1ib2x9IHByb2plY3RvclR5cGUgVGhpcyBzZXRzIHVwIGEgbmV3IHByb2plY3Rvciwgb2YgdHlwZSB7QGxpbmsgQ0FCSU5FVH0gb3Ige0BsaW5rIEhPTU9HRU5PVVN9LgogKiBAcGFyYW0ge2Jvb2xlYW59IHByb2plY3QgT3B0aW9uYWwuIFdoZW4gdHJ1ZSwgaW1tZWRpYXRlbHkgZW5hYmxlIGNvb3JkaW5hdGUgcHJvamVjdGlvbi4gRGVmYXVsdDogdHJ1ZQogKiBAcmV0dXJucyB7UHJvamVjdG9yfSBUaGUgY3VycmVudCBwcm9qZWN0b3IuCiAqCiAqIEBwYXJhbSB7UHJvamVjdG9yfSBwcm9qZWN0b3IgVGhpcyBzZXRzIHRoZSBwcm9qZWN0b3IgdG8gdGhlIG9uZSBwYXNzZWQgYXMgYXJndW1lbnQuCiAqIEBwYXJhbSB7Ym9vbGVhbn0gcHJvamVjdCBPcHRpb25hbC4gV2hlbiB0cnVlLCBpbW1lZGlhdGVseSBlbmFibGUgY29vcmRpbmF0ZSBwcm9qZWN0aW9uLiBEZWZhdWx0OiB0cnVlCiAqIEByZXR1cm5zIHtQcm9qZWN0b3J9IFRoZSBjdXJyZW50IHByb2plY3Rvci4KICoKICogQHNlZSB7QGxpbmsgY3JlYXRlUHJvamVjdG9yfQogKiBAc2VlIHtAbGluayB1c2VQcm9qZWN0aW9ufQogKiBAc2VlIHtAbGluayBub1Byb2plY3Rpb259CiAqIEBzZWUge0BsaW5rIG5vUHJvamVjdG9yfQogKiBAc2VlIHtAbGluayBwcm9qZWN0fQogKi8KZnVuY3Rpb24gc2V0UHJvamVjdG9yKHR5cGVPclByb2plY3RvciA9IGZhbHNlLCBwcm9qZWN0ID0gdHJ1ZSkgewogIGlmICghdHlwZU9yUHJvamVjdG9yKSB7CiAgICBub1Byb2plY3Rpb24oKTsKICAgIHJldHVybiAoX19wcm9qZWN0b3IgPSBmYWxzZSk7CiAgfSBlbHNlIGlmICh0eXBlT3JQcm9qZWN0b3IgaW5zdGFuY2VvZiBQcm9qZWN0b3IpIHsKICAgIF9fcHJvamVjdG9yID0gdHlwZU9yUHJvamVjdG9yOwogIH0gZWxzZSBpZiAodHlwZU9yUHJvamVjdG9yID09PSBDQUJJTkVUKSB7CiAgICBfX3Byb2plY3RvciA9IG5ldyBDYWJpbmV0UHJvamVjdG9yKCk7CiAgfSBlbHNlIGlmICh0eXBlT3JQcm9qZWN0b3IgPT09IEhPTU9HRU5FT1VTKSB7CiAgICBfX3Byb2plY3RvciA9IG5ldyBIb21vZ2VuZW91c1Byb2plY3RvcigyNTApOwogIH0KICBpZiAocHJvamVjdCkgdXNlUHJvamVjdGlvbigpOwogIHJldHVybiBfX3Byb2plY3RvcjsKfQoKLyoqCiAqIENyZWF0ZSBhIDNEIHRvIDJEIHByb2plY3Rvci4gVGhpcyBjYW4gYmUgZWl0aGVyIGEgYENBQklORVRgCiAqIG9yIGBIT01PR0VORU9VU2AgcHJvamVjdG9yLCBzdXBwb3J0aW5nIHRoZSBmb2xsb3dpbmcgQVBJOgogKgogKiAtIGBwcm9qZWN0b3Iuc2V0Um90YXRpb24oeCwgeSwgeilgCiAqIC0gYHByb2plY3Rvci5zZXRUcmFuc2xhdGlvbih0eCwgdHksIHR6KWAKICogLSBgcHJvamVjdG9yLnNldFNjYWxlKHR4LCB0eSwgdHopYAogKgogKiBmdXJ0aGVybW9yZSwgdGhlIGBDQUJJTkVUYCBwcm9qZWN0b3Igc3VwcG9ydHMgc2V0dGluZyB0aGUKICogZGVmYXVsdCBjYWJpbmV0IGFuZ2xlIHVzaW5nOgogKgogKiAtIGBwcm9qZWN0b3Iuc2V0UGhpKHBoaSlgCiAqCiAqIGFuZCB0aGUgYEhPTU9HRU5FT1VTYCBwcm9qZWN0aW9uIHN1cHBvcnRzIHNldHRpbmcgdGhlIGRpc3RhbmNlCiAqIG9mIHRoZSBwb2ludC1hdC1pbmZpbml0eSBieSB1c2luZzoKICoKICogLSBgcHJvamVjdG9yLnNldEluZmluaXR5KGRpc3RhbmNlKWAgKG5vdGUsIGBkaXN0YW5jZWAgY2FuIGJlIGBJbmZpbml0eWApCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBjYWJpbmV0ID0gY3JlYXRlUHJvamVjdG9yKENBQklORVQpOwogKiAgICAgY29uc3QgaG9tb2dlbmVvdXMgPSBjcmVhdGVQcm9qZWN0b3IoSE9NT0dFTkVPVVMpOwogKiAgICAgY29uc3QgYm90dG9tID0gWwogKiAgICAgICBbLTEsIC0xLCAtMV0sCiAqICAgICAgIFsgMSwgLTEsIC0xXSwKICogICAgICAgWyAxLCAgMSwgLTFdLAogKiAgICAgICBbLTEsICAxLCAtMV0sCiAqICAgICBdOwogKiAgICAgY29uc3QgdG9wID0gYm90dG9tLm1hcCh2ID0+IFt2WzBdLCB2WzFdLCAxXSk7CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSg0MDAsIDIwMCk7CiAqICAgICAgIGNhYmluZXQuc2V0U2NhbGUoNTApOwogKiAgICAgICBob21vZ2VuZW91cy5zZXRTY2FsZSg1MCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKC13aWR0aC80LCBoZWlnaHQvMik7CiAqICAgICAgIFtjYWJpbmV0LCBob21vZ2VuZW91c10uZm9yRWFjaChwcm9qZWN0b3IgPT4gewogKiAgICAgICAgIHNldFByb2plY3Rvcihwcm9qZWN0b3IpOwogKiAgICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCAwKTsKICogICAgICAgICBkcmF3QXhpc1BvaW50cygpOwogKiAgICAgICAgIGRyYXdDdWJlKCk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhd0F4aXNQb2ludHMoKSB7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwb2ludCguLi5ib3R0b21bMF0pOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHBvaW50KC4uLmJvdHRvbVsxXSk7CiAqICAgICAgIHNldENvbG9yKGBncmVlbmApOwogKiAgICAgICBwb2ludCguLi5ib3R0b21bM10pOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICBwb2ludCguLi50b3BbMF0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhd0N1YmUoKSB7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICBzZXRTdHJva2UoYHJlZGApOwogKiAgICAgICBbYm90dG9tLCB0b3BdLmZvckVhY2gociA9PiB7CiAqICAgICAgICAgbGluZSguLi5yWzBdLCAuLi5yWzFdKTsKICogICAgICAgICBsaW5lKC4uLnJbMl0sIC4uLnJbM10pOwogKiAgICAgICB9KTsKICogICAgICAgc2V0U3Ryb2tlKGBncmVlbmApOwogKiAgICAgICBbYm90dG9tLCB0b3BdLmZvckVhY2gociA9PiB7CiAqICAgICAgICAgbGluZSguLi5yWzFdLCAuLi5yWzJdKTsKICogICAgICAgICBsaW5lKC4uLnJbM10sIC4uLnJbMF0pOwogKiAgICAgICB9KTsKICogICAgICAgc2V0U3Ryb2tlKGBibHVlYCk7CiAqICAgICAgIFswLDEsMiwzXS5mb3JFYWNoKGkgPT4gbGluZSguLi5ib3R0b21baV0sIC4uLnRvcFtpXSkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7U3ltYm9sfSBwcm9qZWN0b3JUeXBlIFRoaXMgc2V0cyB1cCBhIG5ldyBwcm9qZWN0b3IsIG9mIHR5cGUge0BsaW5rIENBQklORVR9IG9yIHtAbGluayBIT01PR0VOT1VTfS4KICogQHJldHVybnMge1Byb2plY3Rvcn0gQSBuZXcgcHJvamVjdG9yIGluc3RhbmNlLgogKgogKiBAc2VlIHtAbGluayBzZXRQcm9qZWN0b3J9CiAqIEBzZWUge0BsaW5rIHVzZVByb2plY3Rpb259CiAqIEBzZWUge0BsaW5rIG5vUHJvamVjdGlvbn0KICogQHNlZSB7QGxpbmsgbm9Qcm9qZWN0b3J9CiAqIEBzZWUge0BsaW5rIHByb2plY3R9CiAqLwpmdW5jdGlvbiBjcmVhdGVQcm9qZWN0b3IodHlwZSkgewogIGlmICh0eXBlID09PSBDQUJJTkVUKSB7CiAgICByZXR1cm4gbmV3IENhYmluZXRQcm9qZWN0b3IoKTsKICB9CiAgaWYgKHR5cGUgPT09IEhPTU9HRU5FT1VTKSB7CiAgICByZXR1cm4gbmV3IEhvbW9nZW5lb3VzUHJvamVjdG9yKDI1MCk7CiAgfQogIHJldHVybiBudWxsOwp9CgovKioKICogVW5zZXQgdGhlIDNEIHByb2plY3RvciwgaWYgb25lIGlzIGN1cnJlbnRseSBhY3RpdmUuIFRoaXMgaXMKICogZXF1aXZhbGVudCB0byBjYWxsaW5nIGBzZXRQcm9qZWN0b3IoZmFsc2UpYCwgYW5kIHdpbGwgdHVybgogKiBvZmYgcHJvamVjdGlvbiAqKmFuZCoqIHVuYmluZCB0aGUgY3VycmVudCBwcm9qZWN0b3IuIFRoaXMKICogY2FuIGJlIHVzZWZ1bCwgYnV0IG1vc3Qgb2YgdGhlIHRpbWUgeW91J2xsIHdhbnQgdG8gdXNlIHRoZQogKiB7QGxpbmsgdXNlUHJvamVjdGlvbn0gYW5kIHtAbGluayBub1Byb2plY3Rpb259IGZ1bmN0aW9ucyBpbnN0ZWFkLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcGxhbmUgPSBbCiAqICAgICAgIFstMSwgLTEsIC0xXSwKICogICAgICAgWyAxLCAtMSwgLTFdLAogKiAgICAgICBbIDEsICAxLCAtMV0sCiAqICAgICAgIFstMSwgIDEsIC0xXSwKICogICAgIF07CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldFByb2plY3RvcihIT01PR0VORU9VUyk7CiAqICAgICAgIHNjYWxlUHJvamVjdG9yKDUwKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBjZW50ZXIoKTsKICogICAgICAgc2V0U3Ryb2tlKGAjMzMzYCk7CiAqICAgICAgIHNldEZpbGwoYCNGRjA1YCk7CiAqICAgICAgIHBvbHkocGxhbmUpOwogKiAgICAgICBub1Byb2plY3RvcigpOwogKiAgICAgICBzZXRGaWxsKGAjRjBGNWApOwogKiAgICAgICBwb2x5KHBsYW5lLm1hcCh2ID0+IChbNTAgKiB2WzBdLCA1MCAqIHZbMV1dKSkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldFByb2plY3Rvcn0KICovCmZ1bmN0aW9uIG5vUHJvamVjdG9yKCkgewogIHNldFByb2plY3RvcihmYWxzZSk7Cn0KCi8qKgogKiBFbmFibGUgYSBjdXJyZW50bHkgZGlzYWJsZWQgM0QgcHJvamVjdG9yLCBhbGxvd2luZyAgeW91IHRvCiAqIG1peCBwcm9qZWN0aXZlIDNEIGFuZCByZWd1bGFyIDJEIHdpdGggcmVsYXRpdmVseSBsaXR0bGUgZWZmb3J0LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcGxhbmUgPSBbCiAqICAgICAgIFstMSwgLTEsIC0xXSwKICogICAgICAgWyAxLCAtMSwgLTFdLAogKiAgICAgICBbIDEsICAxLCAtMV0sCiAqICAgICAgIFstMSwgIDEsIC0xXSwKICogICAgIF07CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldFByb2plY3RvcihIT01PR0VORU9VUyk7CiAqICAgICAgIHNjYWxlUHJvamVjdG9yKDUwKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBjZW50ZXIoKTsKICoKICogICAgICAgbm9Qcm9qZWN0aW9uKCk7CiAqICAgICAgIHNldEZpbGwoYCNGMEY1YCk7CiAqICAgICAgIHBvbHkocGxhbmUubWFwKHYgPT4gKFs1MCAqIHZbMF0sIDUwICogdlsxXV0pKSk7CiAqCiAqICAgICAgIHVzZVByb2plY3Rpb24oKTsKICogICAgICAgc2V0U3Ryb2tlKGAjMzMzYCk7CiAqICAgICAgIHNldEZpbGwoYCNGRjA1YCk7CiAqICAgICAgIHBvbHkocGxhbmUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIG5vUHJvamVjdGlvbn0KICovCmZ1bmN0aW9uIHVzZVByb2plY3Rpb24oKSB7CiAgX191c2VfcHJvamVjdGlvbiA9IHRydWU7Cn0KCi8qKgogKiAoVGVtcG9yYXJpbHkpIGRpc2FibGUgdGhlIDNEIHByb2plY3RvciB3aXRob3V0IHVuYmluZGluZyBpdCwKICogYWxsb3dpbmcgIHlvdSB0byBtaXggcHJvamVjdGl2ZSAzRCBhbmQgcmVndWxhciAyRCB3aXRoIHJlbGF0aXZlbHkKICogbGl0dGxlIGVmZm9ydC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBsYW5lID0gWwogKiAgICAgICBbLTEsIC0xLCAtMV0sCiAqICAgICAgIFsgMSwgLTEsIC0xXSwKICogICAgICAgWyAxLCAgMSwgLTFdLAogKiAgICAgICBbLTEsICAxLCAtMV0sCiAqICAgICBdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRQcm9qZWN0b3IoSE9NT0dFTkVPVVMpOwogKiAgICAgICBzY2FsZVByb2plY3Rvcig1MCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgY2VudGVyKCk7CiAqCiAqICAgICAgIG5vUHJvamVjdGlvbigpOwogKiAgICAgICBzZXRGaWxsKGAjRjBGNWApOwogKiAgICAgICBwb2x5KHBsYW5lLm1hcCh2ID0+IChbNTAgKiB2WzBdLCA1MCAqIHZbMV1dKSkpOwogKgogKiAgICAgICB1c2VQcm9qZWN0aW9uKCk7CiAqICAgICAgIHNldFN0cm9rZShgIzMzM2ApOwogKiAgICAgICBzZXRGaWxsKGAjRkYwNWApOwogKiAgICAgICBwb2x5KHBsYW5lKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayB1c2VQcm9qZWN0aW9ufQogKi8KZnVuY3Rpb24gbm9Qcm9qZWN0aW9uKCkgewogIF9fdXNlX3Byb2plY3Rpb24gPSBmYWxzZTsKfQoKLyoqCiAqIFByb2plY3QgYSAzRCAid29ybGQiIGNvb3JkaW5hdGUgdG8gYSAyRCAic2NyZWVuIiBjb29yZGluYXRlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcGxhbmUgPSBbCiAqICAgICAgIFstMSwgLTEsIC0xXSwKICogICAgICAgWyAxLCAtMSwgLTFdLAogKiAgICAgICBbIDEsICAxLCAtMV0sCiAqICAgICAgIFstMSwgIDEsIC0xXSwKICogICAgIF07CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldFByb2plY3RvcihIT01PR0VORU9VUykKICogICAgICAgc2NhbGVQcm9qZWN0b3IoNTApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvNCk7CiAqICAgICAgIHNldENvbG9yKGBvcmFuZ2VgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICAvLyBOb3RlIHRoYXQgdGhpcyBpcyBub3QgInVzZWZ1bCIgY29kZSwgYXMgeW91IHdpbGwKICogICAgICAgLy8gcmFyZWx5LCBpZiBldmVyLCBuZWVkIHRvIG1hbnVhbGx5IHByb2plY3QgY29vcmRpbmF0ZS4KICogICAgICAgLy8gSW4gdGhpcyBjYXNlLCB5b3UgY291bGQganVzdCBjYWxsIGBwb2x5KHBsYW5lKWAgaW5zdGVhZC4KICogICAgICAgc3RhcnQoKTsKICogICAgICAgcGxhbmUuZm9yRWFjaChwID0+IHZlcnRleChwcm9qZWN0KC4uLnApKSk7CiAqICAgICAgIHZlcnRleChwcm9qZWN0KC4uLnBsYW5lWzBdKSk7CiAqICAgICAgIGVuZCgpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSAzRCBjb29yZGluYXRlJ3MgeCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgM0QgY29vcmRpbmF0ZSdzIHggdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHogVGhlIDNEIGNvb3JkaW5hdGUncyB4IHZhbHVlCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgIFRoZSBwcm9qZWN0ZWQgMkQge3gseX0gY29vcmRpbmF0ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgMkQgY29vcmRpbmF0ZSBhcyB7eCx5LHp9IGNvb3JkaW5hdGUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCAgVGhlIHByb2plY3RlZCAyRCB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBzZWUge0BsaW5rIHNldFByb2plY3Rvcn0KICovCmZ1bmN0aW9uIHByb2plY3QoeCwgeSwgeikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCAmJiB4LnogIT09IHVuZGVmaW5lZCkgewogICAgeiA9IHguejsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICByZXR1cm4gX19wcm9qZWN0b3IucHJvamVjdCh4LCB5LCB6KTsKfQoKLyoqCiAqIFNldCB0aGUgcHJvamVjdG9yJ3MgeCwgeSwgYW5kIHogYXhlcyBvZiByb3RhdGlvbiBpbiByYWRpYW5zLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgY2FiaW5ldCA9IHNldFByb2plY3RvcihDQUJJTkVUKTsKICogICAgIGNvbnN0IGhvbW9nZW5lb3VzID0gc2V0UHJvamVjdG9yKEhPTU9HRU5FT1VTKTsKICogICAgIGNvbnN0IGJvdHRvbSA9IFsKICogICAgICAgWy0xLCAtMSwgLTFdLAogKiAgICAgICBbIDEsIC0xLCAtMV0sCiAqICAgICAgIFsgMSwgIDEsIC0xXSwKICogICAgICAgWy0xLCAgMSwgLTFdLAogKiAgICAgXTsKICogICAgIGNvbnN0IHRvcCA9IGJvdHRvbS5tYXAodiA9PiBbdlswXSwgdlsxXSwgMV0pOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoNDAwLCAyMDApOwogKiAgICAgICBjYWJpbmV0LnNldFNjYWxlKDUwKTsKICogICAgICAgaG9tb2dlbmVvdXMuc2V0U2NhbGUoNTApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKC13aWR0aC80LCBoZWlnaHQvMik7CiAqICAgICAgIGNvbnN0IG0gPSBtaWxsaXMoKSAvIDUwMDA7CiAqICAgICAgIFtjYWJpbmV0LCBob21vZ2VuZW91c10uZm9yRWFjaChwcm9qZWN0b3IgPT4gewogKiAgICAgICAgIHNldFByb2plY3Rvcihwcm9qZWN0b3IpOwogKiAgICAgICAgIHByb2plY3Rvci5zZXRSb3RhdGlvbihtLCAyICogbSwgMyAqIG0pOwogKiAgICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCAwKTsKICogICAgICAgICBkcmF3QXhpc1BvaW50cygpOwogKiAgICAgICAgIGRyYXdDdWJlKCk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhd0F4aXNQb2ludHMoKSB7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwb2ludCguLi5ib3R0b21bMF0pOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHBvaW50KC4uLmJvdHRvbVsxXSk7CiAqICAgICAgIHNldENvbG9yKGBncmVlbmApOwogKiAgICAgICBwb2ludCguLi5ib3R0b21bM10pOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICBwb2ludCguLi50b3BbMF0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhd0N1YmUoKSB7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICBzZXRTdHJva2UoYHJlZGApOwogKiAgICAgICBbYm90dG9tLCB0b3BdLmZvckVhY2gociA9PiB7CiAqICAgICAgICAgbGluZSguLi5yWzBdLCAuLi5yWzFdKTsKICogICAgICAgICBsaW5lKC4uLnJbMl0sIC4uLnJbM10pOwogKiAgICAgICB9KTsKICogICAgICAgc2V0U3Ryb2tlKGBncmVlbmApOwogKiAgICAgICBbYm90dG9tLCB0b3BdLmZvckVhY2gociA9PiB7CiAqICAgICAgICAgbGluZSguLi5yWzFdLCAuLi5yWzJdKTsKICogICAgICAgICBsaW5lKC4uLnJbM10sIC4uLnJbMF0pOwogKiAgICAgICB9KTsKICogICAgICAgc2V0U3Ryb2tlKGBibHVlYCk7CiAqICAgICAgIFswLDEsMiwzXS5mb3JFYWNoKGkgPT4gbGluZSguLi5ib3R0b21baV0sIC4uLnRvcFtpXSkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBhbmdsZSBvZiByb3RhdGlvbiBvdmVyIHRoZSB4IGF4aXMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgYW5nbGUgb2Ygcm90YXRpb24gb3ZlciB0aGUgeSBheGlzIGluIHJhZGlhbnMKICogQHBhcmFtIHtudW1iZXJ9IHogVGhlIGFuZ2xlIG9mIHJvdGF0aW9uIG92ZXIgdGhlIHogYXhpcyBpbiByYWRpYW5zCiAqLwpmdW5jdGlvbiByb3RhdGVQcm9qZWN0b3IoeCwgeSwgeikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCAmJiB4LnogIT09IHVuZGVmaW5lZCkgewogICAgeiA9IHguejsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBfX3Byb2plY3Rvcj8uc2V0Um90YXRpb24oeCwgeSwgeik7Cn0KCi8qKgogKiBTZXQgdGhlIHByb2plY3RvcidzIHgsIHksIGFuZCB6IGNvb3JkaW5hdGUgb2Zmc2V0cy4gTm90ZSB0aGF0CiAqIHRoaXMgdmFsdWUgZG9lcyAqbm90KiByZXNldCBhY3Jvc3Mgc3VjY2Vzc2l2ZSBkcmF3IGNhbGxzLiBUbwogKiByZXNldCB0aGUgdHJhbnNsYXRpb24sIHlvdSBtdXN0IGlzc3VlIGB0cmFuc2xhdGVQcm9qZWN0b3IoMCwwLDApYC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBsYW5lMSA9IFsKICogICAgICAgWy0xLCAtMSwgLTFdLAogKiAgICAgICBbIDEsIC0xLCAtMV0sCiAqICAgICAgIFsgMSwgIDEsIC0xXSwKICogICAgICAgWy0xLCAgMSwgLTFdLAogKiAgICAgXTsKICogICAgIGNvbnN0IHBsYW5lMiA9IFsKICogICAgICAgWy0xLCAtMSwgMV0sCiAqICAgICAgIFsgMSwgLTEsIDFdLAogKiAgICAgICBbIDEsICAxLCAxXSwKICogICAgICAgWy0xLCAgMSwgMV0sCiAqICAgICBdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRQcm9qZWN0b3IoSE9NT0dFTkVPVVMpOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgY2VudGVyKCk7CiAqICAgICAgIHNjYWxlUHJvamVjdG9yKDI1ICsgMjAgKiBzaW4oZnJhbWUvNTAwKSwgMjUgKyAyMCAqIHNpbihmcmFtZS81MDApLCA1MCAqIHNpbihmcmFtZS8yMDApKTsKICogICAgICAgc2V0Q29sb3IoYG9yYW5nZWApOwogKiAgICAgICBwb2x5KHBsYW5lMSkKICogICAgICAgc2V0Q29sb3IoYHB1cnBsZWApOwogKiAgICAgICBwb2x5KHBsYW5lMikKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKgogKiBAcGFyYW0ge251bWJlcn0gcyBUaGUgc2NhbGUgZmFjdG9yIGZvciBhbGwgdGhyZWUgYXhlcwogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgc2NhbGUgZmFjdG9yIGZvciB0aGUgeCBheGlzCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBzY2FsZSBmYWN0b3IgZm9yIHRoZSB5IGF4aXMKICogQHBhcmFtIHtudW1iZXJ9IHogVGhlIHNjYWxlIGZhY3RvciBmb3IgdGhlIHogYXhpcwogKi8KZnVuY3Rpb24gc2NhbGVQcm9qZWN0b3IoeCwgeSwgeikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCAmJiB4LnogIT09IHVuZGVmaW5lZCkgewogICAgeiA9IHguejsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBfX3Byb2plY3Rvcj8uc2V0U2NhbGUoeCwgeSwgeik7Cn0KCi8qKgogKiBTZXQgdGhlIHByb2plY3RvcidzIHgsIHksIGFuZCB6IGNvb3JkaW5hdGUgb2Zmc2V0cy4gTm90ZSB0aGF0CiAqIHRoaXMgdmFsdWUgZG9lcyAqbm90KiByZXNldCBhY3Jvc3Mgc3VjY2Vzc2l2ZSBkcmF3IGNhbGxzLiBUbwogKiByZXNldCB0aGUgdHJhbnNsYXRpb24sIHlvdSBtdXN0IGlzc3VlIGB0cmFuc2xhdGVQcm9qZWN0b3IoMCwwLDApYC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBsYW5lID0gWwogKiAgICAgICBbLTEsIC0xLCAwXSwKICogICAgICAgWyAxLCAtMSwgMF0sCiAqICAgICAgIFsgMSwgIDEsIDBdLAogKiAgICAgICBbLTEsICAxLCAwXSwKICogICAgIF07CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGNvbnN0IHAgPSBzZXRQcm9qZWN0b3IoSE9NT0dFTkVPVVMpOwogKiAgICAgICBwLnNldFNjYWxlKDUwKTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGNlbnRlcigpOwogKiAgICAgICBzZXRDb2xvcihgb3JhbmdlYCk7CiAqICAgICAgIHRyYW5zbGF0ZVByb2plY3RvcigwLCAwLCBzaW4oZnJhbWUvMTAwKSk7CiAqICAgICAgIHBvbHkocGxhbmUpCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIG9mZnNldCBhbG9uZyB0aGUgeCBheGlzCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBvZmZzZXQgYWxvbmcgdGhlIHkgYXhpcwogKiBAcGFyYW0ge251bWJlcn0geiBUaGUgb2Zmc2V0IGFsb25nIHRoZSB6IGF4aXMKICovCmZ1bmN0aW9uIHRyYW5zbGF0ZVByb2plY3Rvcih4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkICYmIHgueiAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIF9fcHJvamVjdG9yPy5zZXRUcmFuc2xhdGlvbih4LCB5LCB6KTsKfQovKioKICogU2V0IGEgYm9yZGVyIGFyb3VuZCB0aGUgY2FudmFzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRCb3JkZXIoMTAsIGByZWRgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcnxib29sZWFufSB3aWR0aD8gVGhlIHdpZHRoIG9mIHRoZSBib3JkZXIgaW4gcGl4ZWxzLCBkaXNhYmxpbmcgdGhlIGJvcmRlciBvbWl0dGVkCiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvcj8gVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBibGFjaykKICoKICogQHNlZSB7QGxpbmsgbm9Cb3JkZXJ9CiAqLwpmdW5jdGlvbiBzZXRCb3JkZXIod2lkdGggPSAxLCBjb2xvciA9IGBibGFja2ApIHsKICBpZiAoIXdpZHRoKSB7CiAgICBfX2NhbnZhcy5zdHlsZS5ib3JkZXIgPSBgbm9uZWA7CiAgfSBlbHNlIHsKICAgIF9fY2FudmFzLnN0eWxlLmJvcmRlciA9IGAke3dpZHRofXB4IHNvbGlkICR7Y29sb3J9YDsKICB9Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgc3Ryb2tlIGFuZCBmaWxsIGNvbG91ciBhdAogKiB0aGUgc2FtZSB0aW1lLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIKICoKICogQHNlZSB7QGxpbmsgc2V0U3Ryb2tlfQogKiBAc2VlIHtAbGluayBzZXRGaWxsfQogKiBAc2VlIHtAbGluayBub0NvbG9yfQogKi8KZnVuY3Rpb24gc2V0Q29sb3IoY29sb3IpIHsKICBzZXRGaWxsKGNvbG9yKTsKICBzZXRTdHJva2UoY29sb3IpOwp9CgovKioKICogQ2hhbmdlIHRoZSBjdXJzb3IgdG8gYSBzcGVjaWZpYyBpY29uOgogKgogKiAtIEFVVE8gLSB1c2Ugd2hhdGV2ZXIgdGhlIGJyb3dzZXIgd291bGQgb3RoZXJ3aXNlIHVzZQogKiAtIENST1NTIC0gdXNlIGEgY3Jvc3MtaGFpciBpY29uCiAqIC0gUE9JTlRFUiAtIHVzZSB0aGUgInBvaW50ZXIiIGljb24gdGhhdCBpcyBhbHNvIHVzZWQgZm9yIGNsaWNrYWJsZSBsaW5rcwogKgogKiBVc2UgYW55IG90aGVyIHN0cmluZyBmb3VuZCBvdmVyIG9uIHRoZSBNRE4gY3Vyc29yIGFydGljbGUgdG8gc2V0IGEgY3Vyc29yIG5vdCBjb3ZlcmVkIGJ5IHRoZSBhYm92ZSBjb25zdGFudHMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYCNGRjAyYCk7CiAqICAgICAgIHJlY3QoMCwgMCwgd2lkdGgvMiwgaGVpZ2h0KTsKICogICAgICAgc2V0Q29sb3IoYCMwRkYyYCk7CiAqICAgICAgIHJlY3Qod2lkdGgvMiwgMCwgd2lkdGgvMiwgaGVpZ2h0KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJNb3ZlKHgsIHkpIHsKICogICAgICAgaWYgKHggPCB3aWR0aC8yKSB7CiAqICAgICAgICAgc2V0Q3Vyc29yKEFVVE8pOwogKiAgICAgICB9IGVsc2UgewogKiAgICAgICAgIG5vQ3Vyc29yKCk7CiAqICAgICAgIH0KICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBUaGUgQ1NTIGN1cnNvciB0eXBlCiAqCiAqIEBzZWUge0BsaW5rIG5vQ3Vyc29yfQogKi8KZnVuY3Rpb24gc2V0Q3Vyc29yKHR5cGUpIHsKICBfX2N1cnJlbnRfY3Vyc29yID0gdHlwZTsKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBfX2N1cnJlbnRfY3Vyc29yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZpbGwgY29sb3VyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBibGFjaykKICoKICogQHNlZSB7QGxpbmsgbm9GaWxsfQogKi8KZnVuY3Rpb24gc2V0RmlsbChjb2xvciA9IGBibGFja2ApIHsKICBpZiAoQ1NTX0NPTE9SX01BUFtjb2xvcl0gPT09IF9faGlnaGxpZ2h0X2NvbG9yKSB7CiAgICBjb2xvciA9IF9fY3VycmVudF9oaWdobGlnaHRfY29sb3I7CiAgfQogIF9fY3R4LmZpbGxTdHlsZSA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZvbnQgdXNpbmcgYSBzaW5nbGUgc3RyaW5nLiBGb3IgdGhlIHN5bnRheCwKICogc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0NTUy9mb250CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBmb250IEEgQ1NTIHNob3J0aGFuZCBmb250IHByb3BlcnR5CiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRGYW1pbHl9CiAqIEBzZWUge0BsaW5rIHNldEZvbnRTaXplfQogKiBAc2VlIHtAbGluayBzZXRGb250V2VpZ2h0fQogKi8KZnVuY3Rpb24gc2V0Rm9udChmb250KSB7CiAgX19jdHguZm9udCA9IGZvbnQgfHwgYCR7X19mb250LndlaWdodH0gJHtfX2ZvbnQuc2l6ZX1weCAke19fZm9udC5mYW1pbHl9YDsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBmb250IGZhbWlseS4KICoKICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgVGhlIENTUyBmb250IGZhbWlseSBuYW1lCiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRTaXplfQogKiBAc2VlIHtAbGluayBzZXRGb250V2VpZ2h0fQogKi8KZnVuY3Rpb24gc2V0Rm9udEZhbWlseShuYW1lKSB7CiAgX19mb250LmZhbWlseSA9IG5hbWU7CiAgc2V0Rm9udCgpOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZvbnQgc2l6ZQogKgogKiBAcGFyYW0ge251bWJlcn0gcHggVGhlIGZvbnQgc2l6ZSBpbiBwaXhlbHMKICoKICogQHNlZSB7QGxpbmsgc2V0Rm9udEZhbWlseX0KICogQHNlZSB7QGxpbmsgc2V0Rm9udFdlaWdodH0KICovCmZ1bmN0aW9uIHNldEZvbnRTaXplKHB4KSB7CiAgX19mb250LnNpemUgPSBweDsKICBzZXRGb250KCk7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgZm9udCB3ZWlnaHQKICoKICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSB2YWwgVGhlIENTUyB3ZWlnaHQgbnVtYmVyIG9yIG9uZSBvZiB0aGUgc3BlY2lhbCBzdHJpbmdzICJub3JtYWwiLCAiYm9sZCIsICJib2xkZXIiLCBvciAibGlnaHRlciIuCiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRGYW1pbHl9CiAqIEBzZWUge0BsaW5rIHNldEZvbnRTaXplfQogKi8KZnVuY3Rpb24gc2V0Rm9udFdlaWdodCh2YWwpIHsKICBfX2ZvbnQud2VpZ2h0ID0gdmFsOwogIHNldEZvbnQoKTsKfQoKLyoqCiAqIFNldCB0aGUgYmFja2dyb3VuZCBncmlkIHNwYWNpbmcgYW5kIGNvbG91ci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEdyaWQoMjAsIGBsYXZlbmRlcmApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHNwYWNpbmc/IFRoZSBzcGFjaW5nIGJldHdlZW4gZ3JpZCBsaW5lcyBpbiBwaXhlbHMgKGRlZmF1bHQgPSAyMCkKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yPyBUaGUgQ1NTIGNvbG9yIHRvIHVzZSBmb3IgdGhlIGJvcmRlciAoZGVmYXVsdCA9IGxpZ2h0Z3JleSkKICoKICogQHNlZSB7QGxpbmsgbm9HcmlkfQogKi8KZnVuY3Rpb24gc2V0R3JpZChzcGFjaW5nID0gMjAsIGNvbG9yID0gYGxpZ2h0Z3JleWApIHsKICBfX2RyYXdfZ3JpZCA9IHRydWU7CiAgX19ncmlkX3NwYWNpbmcgPSBzcGFjaW5nOwogIF9fZ3JpZF9jb2xvciA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjb2xvciB0aGF0IHNob3VsZCBiZSB1c2VkIHRvIHJlcGxhY2Ugd2hhdGV2ZXIKICogaGlnaGxpZ2h0KCkgbWFya2VkIGFzIHRoZSAidG8gaGlnaGxpZ2h0IiBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0SGlnaGxpZ2h0Q29sb3IoYGxpbWVgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KCJsZXQncyBnbyIsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICBpZiAoc3RhdGUpIGhpZ2hsaWdodChgcmVkYCk7CiAqICAgICAgIGVsc2UgaGlnaGxpZ2h0KGZhbHNlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIKICoKICogQHNlZSB7QGxpbmsgaGlnaGxpZ2h0fQogKi8KZnVuY3Rpb24gc2V0SGlnaGxpZ2h0Q29sb3IoY29sb3IpIHsKICBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yID0gY29sb3I7Cn0KCi8qKgogKiBTZXQgdGhlIGxpbmUgZGFzaCBwcm9wZXJ0eS4gU2VlIHRoZSBmb2xsb3dpbmcgTUROIGFydGljbGUgZm9yIHRoZSBkZXRhaWxzOgogKgogKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9kb2NzL1dlYi9BUEkvQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEL3NldExpbmVEYXNoCiAqCiAqIEBwYXJhbSAge251bWJlcltdfSAuLi52YWx1ZXMgVGhlIGRhc2ggaW50ZXJ2YWxzIGluIHBpeGVsCiAqCiAqIEBzZWUge0BsaW5rIG5vTGluZURhc2h9CiAqLwpmdW5jdGlvbiBzZXRMaW5lRGFzaCguLi52YWx1ZXMpIHsKICBfX2N0eC5zZXRMaW5lRGFzaCh2YWx1ZXMpOwp9CgovKioKICogU2V0IHRoZSBsaW5lIHdpZHRoIGluIHBpeGVscy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcmFuZ2UoMSwgMTAsIChpKSA9PiB7CiAqICAgICAgICAgc2V0TGluZVdpZHRoKGkpOwogKiAgICAgICAgIGxpbmUoMjAsIGkgKiAyMCwgMTgwLCBpICogMjApOwogKiAgICAgICB9KQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aD8gVGhlIGxpbmUgd2lkdGggaW4gcGl4ZWxzIChkZWZhdWx0ID0gMSkKICoKICogQHNlZSB7QGxpbmsgc2V0VGV4dFN0cm9rZX0KICovCmZ1bmN0aW9uIHNldExpbmVXaWR0aCh3aWR0aCA9IDEpIHsKICBfX2N0eC5saW5lV2lkdGggPSB3aWR0aDsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBzdHJva2UgY29sb3VyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBibGFjaykKICoKICogQHNlZSB7QGxpbmsgc2V0RmlsbH0KICogQHNlZSB7QGxpbmsgc2V0Q29sb3J9CiAqLwpmdW5jdGlvbiBzZXRTdHJva2UoY29sb3IgPSBgYmxhY2tgKSB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdID09PSBfX2hpZ2hsaWdodF9jb2xvcikgewogICAgY29sb3IgPSBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwogIH0KICBfX2N0eC5zdHJva2VTdHlsZSA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IHRleHQgYWxpZ25tZW50IHZhbHVlcy4KICoKICogVmFsaWQgYHhBbGlnbmAgdmFsdWVzIGFyZToKICoKICogLSBDRU5URVIgLSB0aGUgdGV4dCBhbmNob3IgaXMgaW4gdGhlIG1pZGRsZSBvZiB0aGUgdGV4dC4gVGV4dCBpcyBwbGFjZWQgZXZlbmx5IG9uIGVpdGhlciBzaWRlLgogKiAtIEVORCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgcmlnaHQgZm9yIExUUiB0ZXh0LCBhbmQgb24gdGhlIGxlZnQgZm9yIFJUTCB0ZXh0LgogKiAtIExFRlQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIGxlZnQgc2lkZSBvZiB0aGUgdGV4dC4gYWxsIHRleHQgaXMgdG8gdGhlIHJpZ2h0LgogKiAtIFJJR0hUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSByaWdodCBzaWRlIG9mIHRoZSB0ZXh0LiBBbGwgdGV4dCBpcyB0byB0aGUgbGVmdC4KICogLSBTVEFSVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgbGVmdCBmb3IgTFRSIHRleHQsIGFuZCBvbiB0aGUgcmlnaHQgZm9yIFJUTCB0ZXh0LgogKgogKiBWYWxpZCBgeUFsaWduYCB2YWx1ZXMgYXJlOgogKgogKiAtIEFMUEhBQkVUSUMgLSBzdGFuZGFyZCB0ZXh0IGFsaWdubWVudCAoZGVmYXVsdCkKICogLSBCT1RUT00gLSB0aGUgdGV4dCBpcyBhbGlnbmVkIHRvIHRoZSBib3R0b20gb2YgdGhlIGJvdW5kaW5nIGJveAogKiAtIEhBTkdJTkcgLSByZWxldmFudCBmb3IgVGliZXRhbiBhbmQgb3RoZXIgSW5kaWMgc2NyaXB0cy4KICogLSBJREVPR1JBUEhJQyAtIHJlbGV2YW50IGZvciBpZGVvZ3JhcGhpYyBDSktWIHRleHQuCiAqIC0gTUlERExFIC0gVGhlIHZlcnRpY2FsIGVxdWl2YWxlbnQgb2YgImNlbnRlciIuCiAqIC0gVE9QIC0gVGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgdG9wIG9mIHRoZSB0eXBvZ3JhcGhpYyAiZW0gc3F1YXJlIi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRGb250U2l6ZSgyMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBsaW5lKHdpZHRoIC8gMiwgMCwgd2lkdGggLyAyLCBoZWlnaHQpOwogKiAgICAgICBsaW5lKDAsIGhlaWdodCAvIDIsIHdpZHRoLCBoZWlnaHQgLyAyKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dCgiY2VudGVyIG1pZGRsZSIsIHdpZHRoIC8gMiwgaGVpZ2h0LzIpOwogKiAgICAgICBsaW5lKDAsIGhlaWdodCAvIDIgLSA1MCwgd2lkdGgsIGhlaWdodCAvIDIgLSA1MCk7CiAqICAgICAgIHNldFRleHRBbGlnbihSSUdIVCwgVE9QKTsKICogICAgICAgdGV4dCgicmlnaHQgdG9wIiwgd2lkdGggLyAyLCBoZWlnaHQvMiAtIDUwKTsKICogICAgICAgbGluZSgwLCBoZWlnaHQgLyAyICsgNTAsIHdpZHRoLCBoZWlnaHQgLyAyICsgNTApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oTEVGVCwgQk9UVE9NKTsKICogICAgICAgdGV4dCgibGVmdCBib3R0b20iLCB3aWR0aCAvIDIsIGhlaWdodC8yICsgNTApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSB4QWxpZ24gVGhlIENTUyBob3Jpem9udGFsIGFsaWdubWVudAogKiBAcGFyYW0ge3N0cmluZ30geUFsaWduIFRoZSBDU1MgdmVydGljYWwgYWxpZ25tZW50CiAqLwpmdW5jdGlvbiBzZXRUZXh0QWxpZ24oeEFsaWduLCB5QWxpZ24pIHsKICBfX2N0eC50ZXh0QWxpZ24gPSB4QWxpZ247CiAgX19jdHgudGV4dEJhc2VsaW5lID0geUFsaWduOwp9CgovKioKICogU2V0IHRoZSB0ZXh0IG91dGxpbmUgc3Ryb2tpbmcgcHJvcGVydGllcy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoYHJlZGAsIDEpOwogKiAgICAgICBzZXRGaWxsKGB5ZWxsb3dgKTsKICogICAgICAgdGV4dCgiZmFuY3kgdGV4dCIsIHdpZHRoLzIsIDgwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICAgIHNldEZvbnRTaXplKDY1KTsKICogICAgICAgc2V0VGV4dFN0cm9rZShgcmVkYCwgMyk7CiAqICAgICAgIHNldEZpbGwoYHllbGxvd2ApOwogKiAgICAgICB0ZXh0KCJmYW5jeSB0ZXh0Iiwgd2lkdGgvMiwgMTQwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yIFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyCiAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aD8gVGhlIHRleHQgc3Ryb2tlIHdpZHRoIGluIHBpeGVscyAoZGVmYXVsdCA9IDEpCiAqCiAqIEBzZWUge0BsaW5rIHNldFN0cm9rZX0KICogQHNlZSB7QGxpbmsgc2V0TGluZVdpZHRofQogKi8KZnVuY3Rpb24gc2V0VGV4dFN0cm9rZShjb2xvciwgd2lkdGggPSAxKSB7CiAgX190ZXh0U3Ryb2tlID0gY29sb3I7CiAgc2V0TGluZVdpZHRoKHdpZHRoKTsKfQovKioKICogU3RhcnQgYSBuZXcgc2hhcGUuIFRoaXMgeWllbGRzIGEgYFNoYXBlYCBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIEFQSToKICoKICogLSBgbWFrZU1vdmFibGUobW92YWJsZT86IGJvb2xlYW4pYCAtIGFsbG93IHRoaXMgc2hhcGUgdG8gYmUgbW92ZWQgYXJvdW5kIHdpdGggdGhlIHBvaW50ZXIgKGBtb3ZhYmxlYCBpcyB0cnVlIGlmIG9taXR0ZWQpCiAqIC0gYGFsbG93UmVzaXppbmcoYWxsb3dlZD86IGJvb2xlYW4pYCAtIGFsbG93IHRoZSBwb2ludHMgdGhhdCBtYWtlIHVwIHRoaXMgc2hhcGUgdG8gYmUgbW92ZWQgYXJvdW5kIChgYWxsb3dlZGAgaXMgdHJ1ZSBpZiBvbWl0dGVkKQogKiAtIGBzaG93UG9pbnRzKHNob3dQb2ludHM/OiBib29sZWFuKWAgLSBkZXRlcm1pbmVzIHdoZXRoZXIgb3Igbm90IHRvIGRyYXcgdGhlIHBhdGhpbmcgcG9pbnRzIG9uIHRvcCBvZiB0aGUgc2hhcGUgZHVyaW5nIGRyYXcoKS4KICogLSBgY2xvc2UoKWAgLSBjbG9zZSB0aGUgY3VycmVudCBzZWdtZW50IHNvIG5vIG5ldyBwb2ludHMgY2FuIGJlIGFkZGVkLgogKiAtIGBuZXdTZWdtZW50KGNsb3NlRXhpc3Rpbmc/OiBib29sZWFuKWAgLSBzdGFydCBhIG5ldyBzZWdtZW50IGluIHRoaXMgc2hhcGUsIGNsb3NpbmcgdGhlIHByZXZpb3VzIHNlZ21lbnQgaWYgYGNsb3NlRXhpc3RpbmdgIGlzIHRydWUgKGRlZmF1bHQ9ZmFsc2UpCiAqCiAqIEEgU2hhcGUgYWxzbyBzdXBwb3J0cyB0aGUgZm9sbG93aW5nIHV0aWxpdHkgZnVuY3Rpb25zOgogKgogKiAtIGBvZmZzZXQoeCwgeSlgIC0gKHRlbXBvcmFyaWx5KSBtb3ZlIHRoaXMgc2hhcGUgYnkgKHgseSkKICogLSBgY29tbWl0KClgIC0gY29tbWl0IHRoZSB0ZW1wb3Jhcnkgb2Zmc2V0IGJ5IHJld3JpdGluZyBhbGwgY29vcmRpbmF0ZXMuCiAqIC0gYHJlc2V0KClgIC0gcmVzZXQgdGhlIHNoYXBlIHRvIGhhdmluZyBubyBvZmZzZXQuCiAqIC0gYGRyYXcoKWAgLSBkcmF3cyB0aGUgc2hhcGUgdXNpbmcgaXRzIGN1cnJlbnQgc3Ryb2tlLCBmaWxsLCBhbmQgInNob3cgcG9pbnRzIiBzZXR0aW5ncy4KICogLSBgaW5zaWRlKHgsIHkpOiBib29sZWFuYCAtIHJldHVybnMgd2hldGhlciBvciBub3QgYSBwb2ludCBsaWVzIGluc2lkZSB0aGlzIChpbXBsaWNpdGx5IGNsb3NlZCkgc2hhcGUuCiAqCiAqIEFuZCBpdCBzdXBwb3J0cyB0aGUgZm9sbG93aW5nIHBhdGhpbmcgZnVuY3Rpb25zLCB3aXRoIGFyZ3VtZW50cyB0aGF0CiAqIGNhbiBlaXRoZXIgY29uc2lzdCBvZiAodGhlIG5lY2Vzc2FyeSBudW1iZXIgb2YpIHBhaXJzIG9mIGNvb3JkaW5hdGUKICogdmFsdWVzLCBvciAodGhlIG5lY2Vzc2FyeSBudW1iZXIgb2YpIHBvaW50LWxpa2VzLCBiZWluZyBvYmplY3RzIHdpdGgKICogYW4gYHhgIGFuZCBgeWAgcHJvcGVydHkuCiAqCiAqIC0gYG1vdmVUbyh4LHkgT1IgcDpwb2ludExpa2UpYCAtIHN0YXJ0IGEgbmV3IHNlZ21lbnQgYW5kIG1hcmsgaXRzIHBhdGggYXMgc3RhcnRpbmcgYXQgKHgseSkuCiAqIC0gYGxpbmVUbyh4LHksLi4uIE9SIHAsLi4uKWAgLSBhZGQgb25lIG9yIG1vcmUgcG9pbnRzIHRoYXQgY29ubmVjdCB0byB0aGUgcHJldmlvdXMgcG9pbnQgd2l0aCBhIHN0cmFpZ2h0IGxpbmUuCiAqIC0gYHF1YWRUbyhjeCxjeSx4LHksLi4uIE9SIGNwLHAsLi4uKWAgLSBhZGQgb25lIG9yIG1vcmUgcXVhZHJhdGljIGJlemllciBjdXJ2ZXMsIHdoZXJlIChjeCxjeSkvY3AgaXMgdGhlIGNvbnRyb2wgcG9pbnQsIGFuZCAoeCx5KS9wIHRoZSBlbmQgcG9pbnQuCiAqIC0gYGN1cnZlVG8oY3gxLGN5MSxjeDIsY3kyLHgseSwuLi4gT1IgYzFwLGMycCxwLC4uLilgIC0gYWRkIG9uZSBvciBtb3JlIGN1YmljIGJlemllciBjdXJ2ZXMsIHdoaWNoIGhhdmUgdHdvIGNvbnRyb2wgcG9pbnRzLgogKiAtIGBzcGxpbmVUbyh4MSx5MSwuLi4gT1IgcDEsLi4uKWAgLSBhZGQgb25lIG9yIG1vcmUgY2FyZGluYWwgc3BsaW5lIHBhdGhpbmcgY29vcmRpbmF0ZXMuCiAqCiAqIENhcmRpbmFsIHNwbGluZSBjb29yZGluYXRlcyBhcmUgcmVuZGVyZWQgYnkgdHJlYXRpbmcgdGhlIHBhdGggYXMgY2xvc2VkCiAqIChldmVuIGlmIGl0IGlzIG5vdCksIHBlcmZvcm1pbmcgd3JhcC1hcm91bmQgbG9va3VwcyBhcyBuZWVkZWQgaW4gb3JkZXIKICogdG8gZHJhdyAic29tZXRoaW5nIHNlbnNpYmxlIi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGxldCBzaGFwZTsKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2hhcGUgPSBzdGFydFNoYXBlKCk7CiAqICAgICAgIHNoYXBlLmFsbG93UmVzaXppbmcoKTsKICogICAgICAgc2hhcGUuc2hvd1BvaW50cygpOwogKiAgICAgICBzaGFwZS5tYWtlTW92YWJsZSgpOwogKiAgICAgICAvLyBDcmVhdGUgYSBkaWFtb25kIHNoYXBlCiAqICAgICAgIHNoYXBlLmFkZCgxMCxoZWlnaHQvMik7CiAqICAgICAgIHNoYXBlLmFkZCh3aWR0aC8yLCAxMCk7CiAqICAgICAgIHNoYXBlLmFkZCh3aWR0aC0xMCwgaGVpZ2h0LzIpOwogKiAgICAgICBzaGFwZS5hZGQod2lkdGgvMiwgaGVpZ2h0LTEwKTsKICogICAgICAgLy8gV2l0aCBhIHJlY3Rhbmd1bGFyIGN1dG91dAogKiAgICAgICBzaGFwZS5uZXdTZWdtZW50KHRydWUpOwogKiAgICAgICBzaGFwZS5hZGQoNzUsNzUpOwogKiAgICAgICBzaGFwZS5hZGQoMTI1LDc1KTsKICogICAgICAgc2hhcGUuYWRkKDEyNSwxMjUpOwogKiAgICAgICBzaGFwZS5hZGQoNzUsMTI1KTsKICogICAgICAgc2hhcGUuZmxpcFNlZ21lbnQoKTsKICogICAgICAgc2hhcGUuY2xvc2UoKTsKICogICAgICAgc2hhcGUuc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzaGFwZS5zZXRGaWxsKGBnb2xkYCk7CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2hhcGUuZHJhdyh0cnVlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcmV0dXJucyB7U2hhcGV9IHRoZSBuZXdseSBjcmVhdGVkIHNoYXBlIG9iamVjdAogKgogKiBAc2VlIHtAbGluayBlbmRTaGFwZX0KICovCmZ1bmN0aW9uIHN0YXJ0U2hhcGUoKSB7CiAgcmV0dXJuIChfX3NoYXBlID0gbmV3IFNoYXBlKCkpOwp9CgovKioKICogQ2xlYXIgdGhlIGN1cnJlbnQgc2hhcGUsIG9wdGlvbmFsbHkgY2xvc2luZyBpdC4KICoKICogQHBhcmFtIHtib29sZWFufSBjbG9zZT8gV2hlbiB1c2VkLCBjbG9zZXMgdGhlIHNoYXBlJ3MgY3VycmVudCBzZWdtZW50LgogKiBAcmV0dXJucyB7U2hhcGV9IFRoZSBzaGFwZSB0aGF0IGdvdCBjbG9zZWQKICoKICogQHNlZSB7QGxpbmsgc3RhcnRTaGFwZX0KICovCmZ1bmN0aW9uIGVuZFNoYXBlKGNsb3NlID0gZmFsc2UpIHsKICBpZiAoX19zaGFwZSAmJiBjbG9zZSkgX19zaGFwZS5jbG9zZSgpOwogIGNvbnN0IHNoYXBlID0gX19zaGFwZTsKICBfX3NoYXBlID0gdW5kZWZpbmVkOwogIHJldHVybiBzaGFwZTsKfQoKLyoqCiAqIFN0YXJ0IGEgbmV3IHNlZ21lbnQgaW4gYSBzaGFwZS4KICoKICogQHBhcmFtIHtib29sZWFufSBjbG9zZT8gQ2xvc2VzIHRoZSBjdXJyZW50IHNlZ21lbnQgYmVmb3JlIG9wZW5pbmcgYSBuZXcgb25lIChkZWZhdWx0ID0gdHJ1ZSkKICoKICogQHNlZSB7QGxpbmsgc3RhcnRTaGFwZX0KICogQHNlZSB7QGxpbmsgZW5kU2hhcGV9CiAqLwpmdW5jdGlvbiBuZXdTZWdtZW50KGNsb3NlID0gdHJ1ZSkgewogIF9fc2hhcGU/Lm5ld1NlZ21lbnQoY2xvc2UpOwp9Ci8qKgogKiBDZW50ZXJzIHRoZSBjb29yZGluYXRlIHN5c3RlbSBvbiB5b3VyIGdyYXBoaWMuCiAqIFRoaXMgaXMgZXF1aXZhbGVudCB0byBjYWxsaW5nOgogKgogKiBgYGAKICogdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogYGBgCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBjZW50ZXIoKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIGxpbmUoMCwgLWh1Z2UsIDAsIGh1Z2UpOwogKiAgICAgICBsaW5lKC1odWdlLCAwLCBodWdlLCAwKTsKICogICAgICAgc2V0Q29sb3IocmFuZG9tQ29sb3IoKSk7CiAqICAgICAgIHBvaW50KCAxMCwgIDEwKTsKICogICAgICAgc2V0Q29sb3IocmFuZG9tQ29sb3IoKSk7CiAqICAgICAgIHBvaW50KCAxMCwgLTEwKTsKICogICAgICAgc2V0Q29sb3IocmFuZG9tQ29sb3IoKSk7CiAqICAgICAgIHBvaW50KC0xMCwgLTEwKTsKICogICAgICAgc2V0Q29sb3IocmFuZG9tQ29sb3IoKSk7CiAqICAgICAgIHBvaW50KC0xMCwgIDEwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKi8KZnVuY3Rpb24gY2VudGVyKCkgewogIHRyYW5zbGF0ZSh3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwp9CgovKioKICogUmVzZXQgdGhlIGNvb3JkaW5hdGUgdHJhbnNmb3JtIG1hdHJpeC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgbGlnaHRncmV5YCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgdHJhbnNsYXRlKDUwLDUwKTsKICogICAgICAgbGluZSgwLDAsMTAwLDApOwogKiAgICAgICBwb2ludCgwLDApOwogKiAgICAgICBzZXRDb2xvcihgZGFya2dyZWVuYCk7CiAqICAgICAgIHBvaW50KDEwLDApOwogKiAgICAgICByb3RhdGUoUEkvNCk7CiAqICAgICAgIHBvaW50KDEwLDApOwogKiAgICAgICBsaW5lKDAsMCwxMDAsMCk7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIHJvdGF0ZSgtUEkvNikKICogICAgICAgcG9pbnQoMTAwLDApOwogKiAgICAgICBzY2FsZSgwLjUsIDAuNSk7CiAqICAgICAgIHBvaW50KDEwMCwwKTsKICogICAgICAgbGluZSgxMDAsMCwyMDAsMCk7CiAqICAgICAgIHJlc2V0VHJhbnNmb3JtKCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBsaW5lKDAsMywxMDAsMyk7CiAqICAgICAgIHBvaW50KDAsMyk7CiAqICAgICAgIHBvaW50KDEwLDMpOwogKiAgICAgICBwb2ludCgxMDAsMyk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgdHJhbnNmb3JtfQogKi8KZnVuY3Rpb24gcmVzZXRUcmFuc2Zvcm0oKSB7CiAgX19jdHgucmVzZXRUcmFuc2Zvcm0oKTsKfQoKLyoqCiAqIFJvdGF0ZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gd3J0IHRoZSBjdXJyZW50IG9yaWdpbi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgbGlnaHRncmV5YCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwb2ludCgwLDApOwogKiAgICAgICBzZXRDb2xvcihgZGFya2dyZWVuYCk7CiAqICAgICAgIGxpbmUoMCwwLDIwLDIwKTsKICogICAgICAgcG9pbnQoMjAsMjApOwogKiAgICAgICByb3RhdGUoUEkvNCk7CiAqICAgICAgIGxpbmUoMCwwLDIwLDIwKTsKICogICAgICAgcG9pbnQoMjAsMjApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSBUaGUgYW5nbGUgYnkgd2hpY2ggdG8gcm90YXRlIHRoZSBjb29yZGluYXRlIHN5c3RlbSBpbiByYWRpYW5zCiAqCiAqIEBzZWUge0BsaW5rIHRyYW5zZm9ybX0KICogQHNlZSB7QGxpbmsgcmVzZXRUcmFuc2Zvcm19CiAqLwpmdW5jdGlvbiByb3RhdGUoYW5nbGUgPSAwKSB7CiAgX19jdHgucm90YXRlKGFuZ2xlKTsKfQoKLyoqCiAqIFNjYWxlIHRoZSBjb29yZGluYXRlIHN5c3RlbSB3cnQgdGhlIGN1cnJlbnQgb3JpZ2luLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBub0dyaWQoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBsaWdodGdyZXlgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBvaW50KDAsMCk7CiAqICAgICAgIHNldENvbG9yKGBkYXJrZ3JlZW5gKTsKICogICAgICAgbGluZSgwLDAsMjAsMjApOwogKiAgICAgICBwb2ludCgyMCwyMCk7CiAqICAgICAgIHJvdGF0ZShQSS80KTsKICogICAgICAgc2NhbGUoMik7CiAqICAgICAgIGxpbmUoMCwwLDIwLDIwKTsKICogICAgICAgcG9pbnQoMjAsMjApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBhbW91bnQgYnkgd2hpY2ggdG8gc2NhbGUgdGhlIHggY29vcmRpbmF0ZXMuCiAqIEBwYXJhbSB7bnVtYmVyfSB5PyBUaGUgYW1vdW50IGJ5IHdoaWNoIHRvIHNjYWxlIHRoZSB4IGNvb3JkaW5hdGVzIChkZWZhdWx0ID0gc2FtZSBhcyB4KQogKgogKiBAc2VlIHtAbGluayB0cmFuc2Zvcm19CiAqIEBzZWUge0BsaW5rIHJlc2V0VHJhbnNmb3JtfQogKi8KZnVuY3Rpb24gc2NhbGUoeCA9IDEsIHkgPSB4KSB7CiAgX19jdHguc2NhbGUoeCwgeSk7Cn0KCi8qKgogKiBDb252ZXJ0IGEgc2NyZWVuIChlLmcuIGJyb3dzZXIpIGNvb3JkaW5hdGUgaW50byBpdHMKICogY29ycmVzcG9uZGluZyAidHJhbnNmb3JtZWQiIGNvb3JkaW5hdGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIG5vR3JpZCgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYGxpZ2h0Z3JleWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICByb3RhdGUoUEkvNCk7CiAqICAgICAgIHNjYWxlKDAuNSk7CiAqICAgICAgIGlmIChwb2ludGVyLmFjdGl2ZSkgewogKiAgICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgICBwb2ludChwb2ludGVyLngsIHBvaW50ZXIueSk7CiAqICAgICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgICBwb2ludChzY3JlZW5Ub1dvcmxkKHBvaW50ZXIueCwgcG9pbnRlci55KSk7CiAqICAgICAgIH0KICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJNb3ZlKCkgewogKiAgICAgICByZWRyYXcoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgc2NyZWVuIGNvb3JkaW5hdGUncyB4IHZhbHVlIGluIHBpeGVscwogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgc2NyZWVuIGNvb3JkaW5hdGUncyB5IHZhbHVlIGluIHBpeGVscwogKiBAcmV0dXJucyB7UG9pbnRMaWtlfSBwIFRoZSB3b3JsZCB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSBzY3JlZW4ge3gseX0gY29vcmRpbmF0ZQogKiBAcmV0dXJucyB7UG9pbnRMaWtlfSBwIFRoZSB3b3JsZCB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBzZWUge0BsaW5rIHByb2plY3R9CiAqIEBzZWUge0BsaW5rIHdvcmxkVG9TY3JlZW59CiAqLwpmdW5jdGlvbiBzY3JlZW5Ub1dvcmxkKHgsIHkpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgbGV0IE0gPSBfX2N0eC5nZXRUcmFuc2Zvcm0oKS5pbnZlcnRTZWxmKCk7CgogIHJldHVybiBuZXcgUG9pbnQoeCAqIE0uYSArIHkgKiBNLmMgKyBNLmUsIHggKiBNLmIgKyB5ICogTS5kICsgTS5mKTsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCB0cmFuc2Zvcm0gbWF0cml4LCBiYXNlZCBvbiBhcHBseWluZzoKICoKICogYGBgCiAqICAgICAgIHwgYSBiIGMgfAogKiAgIG0gPSB8IGQgZSBmIHwKICogICAgICAgfCAwIDAgMSB8CiAqIGBgYAogKgogKiBXaXRoIHRoZSBwYXJhbWV0ZXJzIGRlZmF1bHRpbmcgdG8gdGhlIGlkZW50aXR5IG1hdHJpeC4KICoKICogU2VlIHRoZSBmb2xsb3dpbmcgTUROIGFydGljbGUgZm9yIG1vcmUgZGV0YWlscyBhYm91dCB0aGlzIGZ1bmN0aW9uOgogKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9kb2NzL1dlYi9BUEkvQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEL3RyYW5zZm9ybQogKgogKiBAcGFyYW0ge251bWJlcn0gYSAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSB7bnVtYmVyfSBiIChkZWZhdWx0ID0gMCkKICogQHBhcmFtIHtudW1iZXJ9IGMgKGRlZmF1bHQgPSAwKQogKiBAcGFyYW0ge251bWJlcn0gZCAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSB7bnVtYmVyfSBlIChkZWZhdWx0ID0gMSkKICogQHBhcmFtIHtudW1iZXJ9IGYgKGRlZmF1bHQgPSAwKQogKgogKiBAc2VlIHtAbGluayByZXNldFRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHRyYW5zZm9ybShhID0gMSwgYiA9IDAsIGMgPSAwLCBkID0gMCwgZSA9IDEsIGYgPSAwKSB7CiAgX19jdHgudHJhbnNmb3JtKGEsIGIsIGMsIGQsIGUsIGYpOwp9CgovKioKICogVHJhbnNsYXRlIHRoZSBjb29yZGluYXRlIHN5c3RlbSBieSBzb21lIGFtb3VudCBvZiB4IGFuZCB5IHVuaXRzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgeCB2YWx1ZSBpbiBwaXhlbHMgdG8gYmUgdHJlYXRlZCBhcyB0aGUgbmV3ICJ6ZXJvIgogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgeSB2YWx1ZSBpbiBwaXhlbHMgdG8gYmUgdHJlYXRlZCBhcyB0aGUgbmV3ICJ6ZXJvIgogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUge3gseX0gY29vcmRpbmF0ZSB0byBiZSB0cmVhdGVkIGFzIHRoZSBuZXcgInplcm8iCiAqCiAqIEBzZWUge0BsaW5rIHRyYW5zZm9ybX0KICogQHNlZSB7QGxpbmsgcmVzZXRUcmFuc2Zvcm19CiAqLwpmdW5jdGlvbiB0cmFuc2xhdGUoeCA9IDAsIHkgPSAwKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgX19jdHgudHJhbnNsYXRlKHgsIHkpOwp9CgovKioKICogQ29udmVydCBhbiBpbi1jYW52YXMgInRyYW5zZm9ybWVkIiBjb29yZGluYXRlIGludG8gaXRzCiAqIGNvcnJlc3BvbmRpbmcgInNjcmVlbiIgKGkuZS4gYnJvd3NlciBjYW52YXMgb2Zmc2V0KSBjb29yZGluYXRlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGggLyAyLCBoZWlnaHQgLyAyKTsKICoKICogICAgICAgcm90YXRlKG1pbGxpcygpIC8gMjAwMCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgY29uc3QgcCA9IG5ldyBQb2ludCgzMCwgMCk7CiAqICAgICAgIHBvaW50KHApOwogKiAgICAgICB0ZXh0KGAke3AueH0sJHtwLnl9YCwgcC54ICsgMTAsIHAueSArIDEwKTsKICoKICogICAgICAgY29uc3Qge3gsIHl9ID0gd29ybGRUb1NjcmVlbihwKTsKICogICAgICAgcmVzZXRUcmFuc2Zvcm0oKTsKICogICAgICAgc2V0Rm9udFNpemUoMTYpOwogKiAgICAgICB0ZXh0KGAke3gudG9GaXhlZCgpfSwke3kudG9GaXhlZCgpfWAsIHggLSAyNSwgeSAtIDE1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgd29ybGQgY29vcmRpbmF0ZSdzIHggdmFsdWUgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSB3b3JsZCBjb29yZGluYXRlJ3MgeSB2YWx1ZSBpbiBwaXhlbHMKICogQHJldHVybnMge1BvaW50TGlrZX0gcCBUaGUgc2NyZWVuIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHdvcmxkIHt4LHl9IGNvb3JkaW5hdGUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCBUaGUgc2NyZWVuIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgcHJvamVjdH0KICogQHNlZSB7QGxpbmsgc2NyZWVuVG9Xb3JsZH0KICovCmZ1bmN0aW9uIHdvcmxkVG9TY3JlZW4oeCwgeSkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBsZXQgTSA9IF9fY3R4LmdldFRyYW5zZm9ybSgpOwoKICByZXR1cm4gbmV3IFBvaW50KHggKiBNLmEgKyB5ICogTS5jICsgTS5lLCB4ICogTS5iICsgeSAqIE0uZCArIE0uZik7Cn0K"),p=class extends h{static{l(this,"GraphicsElement")}set onload(e){this._onload=e}set onerror(e){this._onerror=e}handleAttributeChange(...e){}handleChildChanges(...e){}connectedCallback(){super.connectedCallback(),this.label=document.createElement("label"),this.title||(console.warn("<graphics-element> is missing a title attribute. Always caption your figures."),this.title=""),this.label.textContent=this.title,H(this)?this.loadSource():new IntersectionObserver((e,x)=>e.forEach(r=>{r.isIntersecting&&(this.loadSource(),x.disconnect())}),{threshold:.1,rootMargin:`${window.innerHeight}px`}).observe(this)}getStyle(){return`
:host([hidden]) { display: none; }
style { display: none; }
.top-title { display: flex; flex-direction: row; justify-content: space-between; }
canvas { touch-action: none; user-select: none; position: relative; z-index: 1; display: block; margin: auto; border-radius: 0; box-sizing: content-box !important; border: 1px solid lightgrey;
&.crisp { image-rendering: -moz-crisp-edges; image-rendering: -webkit-crisp-edges; image-rendering: pixelated; image-rendering: crisp-edges; }
&:focus { border: 1px solid red; }}
a { &.view-source { font-size: 60%; text-decoration: none;
&.plus { padding-left: 0.5em; }}}
button.reset { font-size: 0.5em; top: -0.35em; position: relative; }
label:not(:empty) { display: block; font-style: italic; font-size: 0.9em; text-align: right; padding-right: 1em; margin-top: 0.35em; }
`}async loadSource(e,x=this.width,r=this.height,$){if(!x&&!r&&(x=parseFloat(this.getAttribute("width")),r=parseFloat(this.getAttribute("height")),isNaN(x)&&(x=void 0),isNaN(r)&&(r=void 0)),e){if(typeof e=="function")return console.warn(".loadSource() called with a function rather than string data: use .loadFromFunction() instead."),this.loadFromFunction(e)}else if(this.userCode)e=this.userCode;else{let a=this.getAttribute("src");if(a)e=await(await fetch(a)).text();else{let s=this.querySelector("graphics-source");s?e=s.textContent:e=`function setup() {
}
function draw() {
}
`}}if(this.userCode=e,!$)if(this.additionalSources)$=this.additionalSources;else{let a=this.querySelectorAll("source");$=await Promise.all(Array.from(a).map(s=>fetch(s.src).then(b=>b.text())))}this.additionalSources=$;let t=this.userCode;this.additionalSources.length>0&&(t=this.loadAdditionalSources(this.userCode,this.additionalSources));let g=t.matchAll(/addSlider\(['"`](.*)['"`]/g),i=[];for(let a of g)i.push(a[1]),t=t.replace(a[0],a[0]+`, (v) => (${a[1]} = v)`);if(i.length&&(t="let "+i.join(", ")+`;
`+t),t=t.replaceAll(/ from ['"].([^'"]+)['"]/g,` from "${M(location.href)}/$1"`),t.includes("function setup()")||(t=`function setup() {
}
`+t),!t.includes("setSize(")){let a="setSize();";x&&r&&(a=`setSize(${x}, ${r});`),t=t.replace("function setup() {",`function setup() {
  ${a}`)}let o=Object.entries(this.dataset);if(o.length&&o.forEach(([a,s])=>{parseFloat(s)!=s&&s!=="true"&&s!=="false"&&(s=`"${s}"`),t=t.replace("function setup() {",`function setup() {
  ${a} = ${s};`)}),this.getAttribute("safemode")!==null){let a=parseFloat(this.getAttribute("safemode"));isNaN(a)&&(a=1e3),t=y(t,a)}import(`data:text/javascript;base64,${N(['"use strict";',`import { BSpline, CSS_COLOR_MAP } from "${q}";`,`const __randomId = "${Date.now()}";`,F,t,`export {
  __reset as start,
  __canvas as canvas,
  __halt as halt,
  highlight,
  __getDescription as getDescription
}`].join(`
`))}`).then(async a=>{let{start:s,canvas:b,halt:c,highlight:L,getDescription:R}=a;this.canvas=b,this.halt=()=>c(),this.highlight=v=>L(v),this.render();let{width:d,height:u}=await s(this),m="graphics-element-description";this.querySelector(`.${m}`)?.remove(),this.querySelector("p")||this.handleGraphicsDescription(m,R),d&&u&&(this.style.width="",this.style.height="",this.width=d,this.height=u,this.setAttribute("width",d),this.setAttribute("height",u));let w=new CustomEvent("load");this.dispatchEvent(w),this._onload&&this._onload(w)}).catch(a=>{let s=new CustomEvent("error",{detail:a});if(this.dispatchEvent(s),this._onerror)this._onerror(a);else throw a})}handleGraphicsDescription(e,x=()=>{}){try{let r=x();if(r){let $=new DocumentFragment,t=document.createElement("div");t.classList.add(e),$.append(t),t.innerHTML=r,this.append(t),this.crossLink(!0)}}catch(r){console.error(r)}}loadAdditionalSources(e,x){if(!x)return e;let r=new Array(x.length);return e+`
`+x.map(($,t)=>$.replace("function setup()",`function setup${t+1}()`).replace("function draw()",`function draw${t+1}()`)).join(`
`)+`
function __more_setup() { ${[...r].map(($,t)=>`if (typeof setup${t+1} !== \`undefined\`) setup${t+1}();`).join(`
`)} }
function __more_draw() { ${[...r].map(($,t)=>`if (typeof draw${t+1} !== \`undefined\`) draw${t+1}();`).join(`
`)} }
`}loadFromFunction(e){let x=e.toString();this.reset(x.substring(x.indexOf("{")+1,x.lastIndexOf("}")))}reset(e,x=[]){this.halt&&this.halt(),this.querySelector("button.remove-color")?.remove(),this.loadSource(e||this.userCode,this.width,this.height,x||this.additionalSources)}render(){super.render();let e=this._slot.parentNode;this.canvas&&e.insertBefore(this.canvas,this._slot),this.label&&e.insertBefore(this.label,this._slot);let x=document.createElement("div");x.classList.add("top-title");let r=document.createElement("span");r.classList.add("sources"),x.append(r);let $=document.createElement("button");$.classList.add("reset"),$.textContent=this.getAttribute("reset")||"reset",$.addEventListener("click",()=>this.reset()),x.append($);let t=this.getAttribute("src");if(t||(t=`data:text/plain;base64,${N(this.userCode)}`),t){let i=document.createElement("a");i.classList.add("view-source"),i.textContent=this.getAttribute("viewSource")||"view source",i.href=t,i.target="_blank",r.append(i),t.startsWith("data")&&(delete i.href,delete i.target,i.classList.add("fake-source-link"),i.addEventListener("click",()=>{let o=`<iframe width="100%" height="100%" src="${t}"></iframe>`,f=window.open(""),{document:a}=f;a.open(),a.write(o),a.write("<style>iframe { position: fixed; top: 0; right: 0; bottom: 0; left: 0; border:0; margin: 0; padding:0 }</style>"),a.close()}))}let g=this.querySelectorAll("source");g.length===0&&(g=(this.additionalSources??[]).map(i=>({src:`data:text/plain;base64,${N(i)}`}))),g.length&&g.forEach((i,o)=>{let{src:f}=i,a=document.createElement("a");a.classList.add("view-source","plus"),a.textContent=`[+${o+1}]`,a.href=f,a.target="_blank",r.append(a),f.startsWith("data")&&(delete a.href,delete a.target,a.classList.add("fake-source-link"),a.addEventListener("click",()=>{let s=`<iframe width="100%" height="100%" src="${f}"></iframe>`,b=window.open(""),{document:c}=b;c.open(),c.write(s),c.write("<style>iframe { position: fixed; top: 0; right: 0; bottom: 0; left: 0; border:0; margin: 0; padding:0 }</style>"),c.close()}))}),this.label&&e.insertBefore(x,this.canvas),this.crossLink()}crossLink(e){if(e&&(this.crossLinked=!1),this.crossLinked)return;this.crossLinked=!0;let x=!1;if(this.querySelectorAll("p").forEach(r=>{r.querySelectorAll("*").forEach($=>{if(!S.includes($.tagName))return;x=!0;let t;$.classList.remove("calm"),$.addEventListener("pointerenter",()=>{t??=getComputedStyle($)["-webkit-text-stroke-color"],this.highlight?.(t)}),$.addEventListener("pointerleave",()=>this.highlight?.(!1))})}),x){let r=document.createElement("button");r.textContent="remove colors",r.classList.add("remove-color"),r.addEventListener("click",()=>{this.querySelectorAll("p").forEach($=>{$.querySelectorAll("*").forEach(t=>{S.includes(t.tagName)&&t.classList.add("calm")})}),r.remove()}),this.append(r)}}},O=class extends h{static{l(this,"GraphicsSource")}constructor(){super(),this.style.display="none"}handleAttributeChange(){}handleChildChanges(){}};h.register(p),h.register(O),globalThis.GraphicsElement=p,await customElements.whenDefined("graphics-element"),await customElements.whenDefined("graphics-source");export{A as BSpline,C as CSS_COLOR_MAP,p as GraphicsElement,O as GraphicsSource};
