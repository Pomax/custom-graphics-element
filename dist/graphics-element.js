var W=Object.defineProperty;var f=(s,e)=>W(s,"name",{value:e,configurable:!0});var C="registered as custom element";function v(s,e){console.warn(`missing implementation for ${e}(...data) in ${s.__proto__.constructor.name}`)}f(v,"NotImplemented");function M(s){return s.prototype.constructor.name.replace(/([A-Z])([a-z])/g,(e,t,r,i)=>{let $=`${t.toLowerCase()}${r}`;return i>0?`-${$}`:$})}f(M,"getElementTagName");var h=class extends HTMLElement{static{f(this,"CustomElement")}static register(e){if(!e[C]){let t=e.tagName||M(e);return customElements.define(t,e),e[C]=!0,customElements.whenDefined(t)}return Promise.resolve()}static get tagName(){return M(this)}constructor(e={}){super(),customElements.resolveScope||(customElements.resolveScope=function(i){try{return i.getRootNode().host}catch($){console.warn($)}return window}),this._options=e;let t={childList:i=>{this.handleChildChanges(Array.from(i.addedNodes),Array.from(i.removedNodes)),this.render()},attributes:i=>{this.handleAttributeChange(i.attributeName,i.oldValue,this.getAttribute(i.attributeName)),this.render()}};this._observer=new MutationObserver(i=>{this.isConnected&&i.forEach($=>{t[$.type]($)})}),this._observer.observe(this,{childList:!0,attributes:!0});let r={mode:"open"};this._shadow=this.attachShadow(r),this._style=document.createElement("style"),this._style.textContent=this.getStyle(),this._options.header!==!1&&(this._header=document.createElement("header")),this._options.slot!==!1&&this._options.void!==!0&&(this._slot=document.createElement("slot")),this._options.footer!==!1&&(this._footer=document.createElement("footer"))}connectedCallback(){this.render()}handleChildChanges(e,t){this._options.void||v(this,"handleChildChanges")}handleAttributeChange(e,t,r){v(this,"handleAttributeChange")}getStyle(){return""}render(){this._shadow.innerHTML="",this._shadow.append(this._style),this._options.header!==!1&&this._shadow.append(this._header),this._options.slot!==!1&&this._shadow.append(this._slot),this._options.footer!==!1&&this._shadow.append(this._footer)}};var w=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREEN","DARKGREY","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREEN","GREENYELLOW","GREY","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREEN","LIGHTGREY","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TRANSPARENT","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN"],H={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(128, 128, 128)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",transparent:"rgba(0,0,0,0)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",ALICEBLUE:"rgb(240, 248, 255)",ANTIQUEWHITE:"rgb(250, 235, 215)",AQUA:"rgb(0, 255, 255)",AQUAMARINE:"rgb(127, 255, 212)",AZURE:"rgb(240, 255, 255)",BEIGE:"rgb(245, 245, 220)",BISQUE:"rgb(255, 228, 196)",BLACK:"rgb(0, 0, 0)",BLANCHEDALMOND:"rgb(255, 235, 205)",BLUE:"rgb(0, 0, 255)",BLUEVIOLET:"rgb(138, 43, 226)",BROWN:"rgb(165, 42, 42)",BURLYWOOD:"rgb(222, 184, 135)",CADETBLUE:"rgb(95, 158, 160)",CHARTREUSE:"rgb(127, 255, 0)",CHOCOLATE:"rgb(210, 105, 30)",CORAL:"rgb(255, 127, 80)",CORNFLOWERBLUE:"rgb(100, 149, 237)",CORNSILK:"rgb(255, 248, 220)",CRIMSON:"rgb(220, 20, 60)",CYAN:"rgb(0, 255, 255)",DARKBLUE:"rgb(0, 0, 139)",DARKCYAN:"rgb(0, 139, 139)",DARKGOLDENROD:"rgb(184, 134, 11)",DARKGRAY:"rgb(169, 169, 169)",DARKGREEN:"rgb(0, 100, 0)",DARKGREY:"rgb(169, 169, 169)",DARKKHAKI:"rgb(189, 183, 107)",DARKMAGENTA:"rgb(139, 0, 139)",DARKOLIVEGREEN:"rgb(85, 107, 47)",DARKORANGE:"rgb(255, 140, 0)",DARKORCHID:"rgb(153, 50, 204)",DARKRED:"rgb(139, 0, 0)",DARKSALMON:"rgb(233, 150, 122)",DARKSEAGREEN:"rgb(143, 188, 143)",DARKSLATEBLUE:"rgb(72, 61, 139)",DARKSLATEGRAY:"rgb(47, 79, 79)",DARKSLATEGREY:"rgb(47, 79, 79)",DARKTURQUOISE:"rgb(0, 206, 209)",DARKVIOLET:"rgb(148, 0, 211)",DEEPPINK:"rgb(255, 20, 147)",DEEPSKYBLUE:"rgb(0, 191, 255)",DIMGRAY:"rgb(105, 105, 105)",DIMGREY:"rgb(105, 105, 105)",DODGERBLUE:"rgb(30, 144, 255)",FIREBRICK:"rgb(178, 34, 34)",FLORALWHITE:"rgb(255, 250, 240)",FORESTGREEN:"rgb(34, 139, 34)",FUCHSIA:"rgb(255, 0, 255)",GAINSBORO:"rgb(220, 220, 220)",GHOSTWHITE:"rgb(248, 248, 255)",GOLD:"rgb(255, 215, 0)",GOLDENROD:"rgb(218, 165, 32)",GRAY:"rgb(128, 128, 128)",GREEN:"rgb(0, 128, 0)",GREENYELLOW:"rgb(173, 255, 47)",GREY:"rgb(128, 128, 128)",HONEYDEW:"rgb(240, 255, 240)",HOTPINK:"rgb(255, 105, 180)",INDIANRED:"rgb(205, 92, 92)",INDIGO:"rgb(75, 0, 130)",IVORY:"rgb(255, 255, 240)",KHAKI:"rgb(240, 230, 140)",LAVENDER:"rgb(230, 230, 250)",LAVENDERBLUSH:"rgb(255, 240, 245)",LAWNGREEN:"rgb(124, 252, 0)",LEMONCHIFFON:"rgb(255, 250, 205)",LIGHTBLUE:"rgb(173, 216, 230)",LIGHTCORAL:"rgb(240, 128, 128)",LIGHTCYAN:"rgb(224, 255, 255)",LIGHTGOLDENRODYELLOW:"rgb(250, 250, 210)",LIGHTGRAY:"rgb(211, 211, 211)",LIGHTGREEN:"rgb(144, 238, 144)",LIGHTGREY:"rgb(211, 211, 211)",LIGHTPINK:"rgb(255, 182, 193)",LIGHTSALMON:"rgb(255, 160, 122)",LIGHTSEAGREEN:"rgb(32, 178, 170)",LIGHTSKYBLUE:"rgb(135, 206, 250)",LIGHTSLATEGRAY:"rgb(119, 136, 153)",LIGHTSLATEGREY:"rgb(119, 136, 153)",LIGHTSTEELBLUE:"rgb(176, 196, 222)",LIGHTYELLOW:"rgb(255, 255, 224)",LIME:"rgb(0, 255, 0)",LIMEGREEN:"rgb(50, 205, 50)",LINEN:"rgb(250, 240, 230)",MAGENTA:"rgb(255, 0, 255)",MAROON:"rgb(128, 0, 0)",MEDIUMAQUAMARINE:"rgb(102, 205, 170)",MEDIUMBLUE:"rgb(0, 0, 205)",MEDIUMORCHID:"rgb(186, 85, 211)",MEDIUMPURPLE:"rgb(147, 112, 219)",MEDIUMSEAGREEN:"rgb(60, 179, 113)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",MEDIUMSPRINGGREEN:"rgb(0, 250, 154)",MEDIUMTURQUOISE:"rgb(72, 209, 204)",MEDIUMVIOLETRED:"rgb(199, 21, 133)",MIDNIGHTBLUE:"rgb(25, 25, 112)",MINTCREAM:"rgb(245, 255, 250)",MISTYROSE:"rgb(255, 228, 225)",MOCCASIN:"rgb(255, 228, 181)",NAVAJOWHITE:"rgb(255, 222, 173)",NAVY:"rgb(0, 0, 128)",OLDLACE:"rgb(253, 245, 230)",OLIVE:"rgb(128, 128, 0)",OLIVEDRAB:"rgb(107, 142, 35)",ORANGE:"rgb(255, 165, 0)",ORANGERED:"rgb(255, 69, 0)",ORCHID:"rgb(218, 112, 214)",PALEGOLDENROD:"rgb(238, 232, 170)",PALEGREEN:"rgb(152, 251, 152)",PALETURQUOISE:"rgb(175, 238, 238)",PALEVIOLETRED:"rgb(219, 112, 147)",PAPAYAWHIP:"rgb(255, 239, 213)",PEACHPUFF:"rgb(255, 218, 185)",PERU:"rgb(205, 133, 63)",PINK:"rgb(255, 192, 203)",PLUM:"rgb(221, 160, 221)",POWDERBLUE:"rgb(176, 224, 230)",PURPLE:"rgb(128, 0, 128)",REBECCAPURPLE:"rgb(102, 51, 153)",RED:"rgb(255, 0, 0)",ROSYBROWN:"rgb(188, 143, 143)",ROYALBLUE:"rgb(65, 105, 225)",SADDLEBROWN:"rgb(139, 69, 19)",SALMON:"rgb(250, 128, 114)",SANDYBROWN:"rgb(244, 164, 96)",SEAGREEN:"rgb(46, 139, 87)",SEASHELL:"rgb(255, 245, 238)",SIENNA:"rgb(160, 82, 45)",SILVER:"rgb(192, 192, 192)",SKYBLUE:"rgb(135, 206, 235)",SLATEBLUE:"rgb(106, 90, 205)",SLATEGRAY:"rgb(112, 128, 144)",SLATEGREY:"rgb(112, 128, 144)",SNOW:"rgb(255, 250, 250)",SPRINGGREEN:"rgb(0, 255, 127)",STEELBLUE:"rgb(70, 130, 180)",TAN:"rgb(210, 180, 140)",TEAL:"rgb(0, 128, 128)",THISTLE:"rgb(216, 191, 216)",TOMATO:"rgb(255, 99, 71)",TRANSPARENT:"rgba(0,0,0,0)",TURQUOISE:"rgb(64, 224, 208)",VIOLET:"rgb(238, 130, 238)",WHEAT:"rgb(245, 222, 179)",WHITE:"rgb(255, 255, 255)",WHITESMOKE:"rgb(245, 245, 245)",YELLOW:"rgb(255, 255, 0)",YELLOWGREEN:"rgb(154, 205, 50)"};function T(s,e,t,r,i,L,d){var n,a,o,l,b=t.length,E=t[0].length;if(e<1)throw new Error("degree must be at least 1 (linear)");if(e>b-1)throw new Error("degree must be less than or equal to point count - 1");if(!i)for(i=[],n=0;n<b;n++)i[n]=1;if(i.length<t.length&&(i=i.concat(i.slice(0,e))),r){if(r.length!==b+e+1)throw new Error("bad knot vector length")}else{var r=[];for(n=0;n<b+e+1;n++)r[n]=n}r.length===t.length&&(r=r.concat(r.slice(0,e)));var u=[e,r.length-1-e],R=r[u[0]],m=r[u[1]];if(d||(s=s*(m-R)+R),s<R||s>m)throw new Error("out of bounds");for(o=u[0];o<u[1]&&!(s>=r[o]&&s<=r[o+1]);o++);var g=[];for(n=0;n<b;n++){for(g[n]=[],a=0;a<E;a++)g[n][a]=t[n][a]*i[n];g[n][E]=i[n]}var A;for(l=1;l<=e+1;l++)for(n=o;n>o-e-1+l;n--)for(A=(s-r[n])/(r[n+e+1-l]-r[n]),a=0;a<E+1;a++)g[n][a]=(1-A)*g[n-1][a]+A*g[n][a];var L=L||[];for(n=0;n<E;n++)L[n]=g[o][n]/g[o][E];return L}f(T,"interpolate");var c=3,I=class{static{f(this,"BSpline")}constructor(e,t=!0){this.points=e,this.points=e.map(r=>r instanceof Array?r:[r.x,r.y]),this.formKnots(t),this.formWeights()}getLUT(e=100){let t=e-1;return[...new Array(e)].map((r,i)=>{let $=T(i/t,c,this.points,this.knots,this.weights);return{x:$[0],y:$[1]}})}formKnots(e=!1){if(!e)return this.formUniformKnots();let t=[],r=this.points.length,i=r-c;for(let $=1;$<r-c;$++)t.push($+c);for(let $=0;$<=c;$++)t=[c].concat(t);for(let $=0;$<=c;$++)t.push(i+c);return this.knots=t}formUniformKnots(){return this.knots=[...new Array(this.points.length+c+1)].map((e,t)=>t)}formWeights(){return this.weights=this.points.map(e=>1)}};var p=class{static{f(this,"Point")}constructor(e,t){this.x=e,this.y=t}},D=class extends p{static{f(this,"Circle")}constructor(e,t,r){super(e,t),this.r=r}},S=class s extends p{static{f(this,"Vec2")}constructor(e,t){super(e,t)}set(e,t){return this.x=e,this.y=t,this}add(e,t){return this.x+=e,this.y+=t,this}plus(e,t){return new s(this.x+e,this.y+t)}sub(e,t){return this.x-=e,this.y-=t,this}minus(e,t){return new s(this.x-e,this.y-t)}times(e,t=e){return new s(this.x*e,this.y*t)}scale(e,t=e){return this.x*=e,this.y*=t,this}mul(e){return new s(this.x*e,this.y*e)}div(e){return new s(this.x/e,this.y/e)}flip(){return this.x=-x,this.y=-y,this}opposite(){return new s(-this.x,-this.y)}normalize(){let e=this.mag();return this.div(e)}rotate(e,t=0,r=0){let i=this.x-t,$=this.y-r;return this.x=t+i*cos(e)-$*sin(e),this.y=r+i*sin(e)+$*cos(e),this}sweep(e,t,r){return new s(this).rotate(e,t,r)}to(e,t){return this.lerp(e,t)}lerp(e,t){let r=1-t;return new s(r*this.x+t*e.x,r*this.y+t*e.y)}cross(e){return this.x*e.y-this.y*e.x}dot(e){return this.x*e.x+this.y*e.y}mag(){let{x:e,y:t}=this;return(e*e+t*t)**.5}};var N=class s{static{f(this,"Vector")}constructor(e,t,r){arguments.length===1&&(r=e.z,t=e.y,e=e.x),this.x=e,this.y=t,r!==void 0&&(this.z=r)}dist(e,t,r=0){t!==void 0&&(e={x:e,y:t,z:r});let i=0;i+=(this.x-e.x)**2,i+=(this.y-e.y)**2;let $=this.z?this.z:0,d=e.z?e.z:0;return i+=($-d)**2,i**.5}normalize(e){let t=this.dist(0,0,0);return new s(e*this.x/t,e*this.y/t,e*this.z/t)}getAngle(){return-Math.atan2(this.y,this.x)}reflect(e){let t=new s(e.x-this.x,e.y-this.y);return e.z!==void 0&&(t.z=e.z,this.z!==void 0&&(t.z-=this.z)),this.subtract(t)}add(e){let t=new s(this.x+e.x,this.y+e.y);return this.z!==void 0&&(t.z=this.z,e.z!==void 0&&(t.z+=e.z)),t}subtract(e){let t=new s(this.x-e.x,this.y-e.y);return this.z!==void 0&&(t.z=this.z,e.z!==void 0&&(t.z-=e.z)),t}scale(e=1){if(e===0)return new s(0,0,this.z===void 0?void 0:0);let t=new s(this.x*e,this.y*e);return this.z!==void 0&&(t.z=this.z*e),t}};function _(s){if(s.length!==s[0].length){console.warn("Cannot invert non-square matrices");return}var e=0,t=0,r=0,i=s.length,$=0,d=0,n=[],a=[];for(e=0;e<i;e+=1)for(n[n.length]=[],a[a.length]=[],r=0;r<i;r+=1)e==r?n[e][r]=1:n[e][r]=0,a[e][r]=s[e][r];for(e=0;e<i;e+=1){if($=a[e][e],$==0){for(t=e+1;t<i;t+=1)if(a[t][e]!=0){for(r=0;r<i;r++)$=a[e][r],a[e][r]=a[t][r],a[t][r]=$,$=n[e][r],n[e][r]=n[t][r],n[t][r]=$;break}if($=a[e][e],$==0)return}for(r=0;r<i;r++)a[e][r]=a[e][r]/$,n[e][r]=n[e][r]/$;for(t=0;t<i;t++)if(t!=e)for($=a[t][e],r=0;r<i;r++)a[t][r]-=$*a[e][r],n[t][r]-=$*n[e][r]}return n}f(_,"invert");function z(s,e){var t=[],r=k(e);return s.forEach((i,$)=>{t[$]=[],r.forEach((d,n)=>{t[$][n]=i.map((a,o)=>d[o]*a).reduce((a,o)=>a+o,0)})}),t}f(z,"multiply");function k(s){return s[0].map((e,t)=>s.map(r=>r[t]))}f(k,"transpose");var O=class s{static{f(this,"Matrix")}constructor(e,t,r){r=e instanceof Array?e:r,this.data=r??[...new Array(e)].map(i=>[...new Array(t)].map($=>0)),this.rows=this.data.length,this.cols=this.data[0].length}setData(e){this.data=e}get(e,t){return this.data[e][t]}set(e,t,r){this.data[e][t]=r}row(e){return this.data[e]}col(e){var t=this.data,r=[];for(let i=0,$=t.length;i<$;i++)r.push(t[i][e]);return r}multiply(e){return new s(z(this.data,e.data))}invert(){return new s(_(this.data))}transpose(){return new s(k(this.data))}};function B(s){let e=new TextEncoder().encode(s),t=String.fromCodePoint(...e);return btoa(t)}f(B,"base64");function K(s){let e=atob(s),t=Uint8Array.from(e,r=>r.codePointAt(0));return new TextDecoder().decode(t)}f(K,"decode64");function Y(s){let e=/^(.*)\/([^.]+(\.([^\/?#]+))+)(\?[^#]*)?(#.*)?$/,t=s.match(e);if(t!==null){let{[1]:r,[2]:i,[4]:$}=t;s=r}return s}f(Y,"getURLbase");function P(s){if(typeof window>"u"||typeof document>"u")return!0;var e=s.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}f(P,"isInViewport");var V=String(import.meta.url),q=K("Y29uc3QgQUxQSEFCRVRJQyA9IGBhbHBoYWJldGljYDsKY29uc3QgQVVUTyA9IGBhdXRvYDsKY29uc3QgQk9UVE9NID0gYGJvdHRvbWA7CmNvbnN0IEJPVFRPTV9MRUZUID0gYGJvdHRvbi1sZWZ0YDsKY29uc3QgQk9UVE9NX1JJR0hUID0gYGJvdHRvbS1yaWdodGA7CmNvbnN0IENFTlRFUiA9IGBjZW50ZXJgOwpjb25zdCBDT05TVFJBSU4gPSB0cnVlOwpjb25zdCBDUk9TUyA9IGBjcm9zc2hhaXJgOwpjb25zdCBFTkQgPSBgZW5kYDsKY29uc3QgSEFORCA9IGBwb2ludGVyYDsKY29uc3QgSEFOR0lORyA9IGBoYW5naW5nYDsKY29uc3QgSURFT0dSQVBISUMgPSBgaWRlb2dyYXBoaWNgOwpjb25zdCBMRUZUID0gYGxlZnRgOwpjb25zdCBMVFIgPSBgbHRyYDsKY29uc3QgTUlERExFID0gYG1pZGRsZWA7CmNvbnN0IFBPSU5URVIgPSBgZGVmYXVsdGA7CmNvbnN0IFJJR0hUID0gYHJpZ2h0YDsKY29uc3QgUlRMID0gYHJ0bGA7CmNvbnN0IFNUQVJUID0gYHN0YXJ0YDsKY29uc3QgVE9QID0gYHRvcGA7CmNvbnN0IFRPUF9MRUZUID0gYHRvcC1sZWZ0YDsKY29uc3QgVE9QX1JJR0hUID0gYHRvcC1yaWdodGA7Cgpjb25zdCBwb2ludGVyID0geyB4OiAwLCB5OiAwIH07CmNvbnN0IGtleWJvYXJkID0ge307CgovLyBtYXRoIGZ1bmN0aW9ucyBhbmQgY29uc3RhbnRzCmNvbnN0IHsKICBhYnMsCiAgYWNvcywKICBhY29zaCwKICBhc2luLAogIGFzaW5oLAogIGF0YW4sCiAgYXRhbjIsCiAgYXRhbmgsCiAgY2JydCwKICBjZWlsLAogIGNsejMyLAogIGNvcywKICBjb3NoLAogIGV4cCwKICBleHBtMSwKICBmbG9vciwKICBmcm91bmQsCiAgaHlwb3QsCiAgaW11bCwKICBsb2c6IGxuLAogIGxvZzEwOiBsb2csCiAgbG9nMiwKICBtYXgsCiAgbWluLAogIHBvdywKICByb3VuZCwKICBzaWduLAogIHNpbiwKICBzaW5oLAogIHNxcnQsCiAgdGFuLAogIHRhbmgsCiAgdHJ1bmMsCn0gPSBNYXRoOwoKY29uc3QgeyBQSSwgRSB9ID0gTWF0aDsKCmZ1bmN0aW9uIGNvbnN0cmFpbih2LCBzLCBlKSB7CiAgcmV0dXJuIHYgPCBzID8gcyA6IHYgPiBlID8gZSA6IHY7Cn0KCmZ1bmN0aW9uIGNzYyh2KSB7CiAgcmV0dXJuIDEgLyBzaW4odik7Cn0KCmZ1bmN0aW9uIGN0bih2KSB7CiAgcmV0dXJuIGNvcyh2KSAvIHNpbih2KTsKfQoKZnVuY3Rpb24gZGVncmVlcyh2LCBjb25zdHJhaW4pIHsKICBsZXQgZCA9ICh2IC8gUEkpICogMTgwOwogIGlmICghY29uc3RyYWluKSByZXR1cm4gZDsKICB3aGlsZSAoZCA8IDApIGQgKz0gMzYwOwogIHJldHVybiBkICUgMzYwOwp9CgpmdW5jdGlvbiBkaXN0KHgxLCB5MSwgeDIsIHkyKSB7CiAgcmV0dXJuICgoeDIgLSB4MSkgKiogMiArICh5MiAtIHkxKSAqKiAyKSAqKiAwLjU7Cn0KCmNvbnN0IGVwc2lsb24gPSAxZS0xMDsKCmNvbnN0IGh1Z2UgPSAxXzAwMF8wMDA7CgpmdW5jdGlvbiBtYXAodiwgcywgZSwgbnMsIG5lLCBjb25zdHJhaW5lZCA9IGZhbHNlKSB7CiAgY29uc3QgaTEgPSBlIC0gcywKICAgIGkyID0gbmUgLSBucywKICAgIHAgPSB2IC0gczsKICBsZXQgciA9IG5zICsgKHAgKiBpMikgLyBpMTsKICBpZiAoY29uc3RyYWluZWQpIHJldHVybiBjb25zdHJhaW4ociwgbnMsIG5lKTsKICByZXR1cm4gcjsKfQoKZnVuY3Rpb24gcmFkaWFucyh2KSB7CiAgbGV0IHIgPSAodiAvIDE4MCkgKiBQSTsKICBpZiAoIWNvbnN0cmFpbikgcmV0dXJuIHI7CiAgd2hpbGUgKHIgPCAwKSByICs9IFRBVTsKICByZXR1cm4gciAlIFRBVTsKfQoKZnVuY3Rpb24gcmFuZG9tKGEgPSAxLCBiKSB7CiAgaWYgKGIgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGEgKiBNYXRoLnJhbmRvbSgpOwogIHJldHVybiBhICsgTWF0aC5yYW5kb20oKSAqIChiIC0gYSk7Cn0KCmNvbnN0IHNlYyA9ICh2KSA9PiAxIC8gY29zKHYpOwoKY29uc3QgVEFVID0gUEkgKiAyOwoKLy8gInB1YmxpYyIgdmFycwpsZXQgY3VycmVudFBvaW50OwpsZXQgZnJhbWU7CmxldCBmcmFtZURlbHRhOwpsZXQgaGVpZ2h0OwpsZXQgd2lkdGg7CmxldCBwbGF5aW5nOwoKLy8gImludGVybmFsIiB2YXJzCgpsZXQgX19jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBjYW52YXNgKTsKX19jYW52YXMudGFiSW5kZXggPSAwOwpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBwb2ludGVyZG93bmAsICgpID0+IF9fY2FudmFzLmZvY3VzKCkpOwpsZXQgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwoKbGV0IF9fY3VycmVudF9jdXJzb3I7CmxldCBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19jdXJyZW50X2h1ZTsKbGV0IF9fZHJhd19ncmlkOwpsZXQgX19kcmF3aW5nOwpsZXQgX19lbGVtZW50OwpsZXQgX19maW5pc2hlZF9zZXR1cDsKbGV0IF9fZmlyc3Q7CmxldCBfX2ZvbnQ7CmxldCBfX2dyaWRfY29sb3I7CmxldCBfX2dyaWRfc3BhY2luZzsKbGV0IF9faGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19tb3ZhYmxlX3BvaW50czsKbGV0IF9fcmVkcmF3aW5nOwpsZXQgX19zdGFydF90aW1lOwpsZXQgX19zdHlsZV9zdGFjazsKbGV0IF9fdGV4dFN0cm9rZTsKbGV0IF9fbGFzdF9mcmFtZTsKCmZ1bmN0aW9uIGZpbmQocXMpIHsKICByZXR1cm4gX19lbGVtZW50LnF1ZXJ5U2VsZWN0b3IocXMpOwp9CgpmdW5jdGlvbiBmaW5kQWxsKHFzKSB7CiAgcmV0dXJuIF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHFzKTsKfQoKYXN5bmMgZnVuY3Rpb24gcmVzZXQoZWxlbWVudCA9IF9fZWxlbWVudCkgewogIF9fZWxlbWVudCA9IGVsZW1lbnQ7CgogIC8vIGRlZmF1bHQgdmFyaWFibGUgdmFsdWVzCiAgX19jdXJyZW50X2N1cnNvciA9IGBhdXRvYDsKICBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yID0gYHJnYigwLDI1NCwxMjQpYDsKICBfX2N1cnJlbnRfaHVlID0gMDsKICBfX2RyYXdfZ3JpZCA9IHRydWU7CiAgX19kcmF3aW5nID0gZmFsc2U7CiAgX19maW5pc2hlZF9zZXR1cCA9IGZhbHNlOwogIF9fZm9udCA9IHsgZmFtaWx5OiBgc2Fucy1zZXJpZmAsIHNpemU6IDE2LCB3ZWlnaHQ6IDQwMCB9OwogIF9fZ3JpZF9jb2xvciA9IGBsaWdodGdyZXlgOwogIF9fZ3JpZF9zcGFjaW5nID0gMjA7CiAgX19oaWdobGlnaHRfY29sb3IgPSBmYWxzZTsKICBfX21vdmFibGVfcG9pbnRzID0gW107CiAgX19yZWRyYXdpbmcgPSBmYWxzZTsKICBfX3N0YXJ0X3RpbWUgPSBEYXRlLm5vdygpOwogIF9fc3R5bGVfc3RhY2sgPSBbXTsKICBfX3RleHRTdHJva2UgPSBgdHJhbnNwYXJlbnRgOwoKICBjdXJyZW50UG9pbnQgPSBmYWxzZTsKICBwbGF5aW5nID0gZmFsc2U7CiAgZnJhbWUgPSAwOwogIHBvaW50ZXIueCA9IDA7CiAgcG9pbnRlci55ID0gMDsKICBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhrZXlib2FyZCkuZm9yRWFjaCgobikgPT4gZGVsZXRlIGtleWJvYXJkW25dKTsKCiAgLy8gbWFrZSBzdXJlIHdlIGRvbid0IGRvdWJsZS1nZW5lcmF0ZSB0aGVzZToKICBjbGVhclNsaWRlcnMoKTsKICBjbGVhckJ1dHRvbnMoKTsKCiAgLy8gcnVuIHNldHVwCiAgYXdhaXQgX19zZXR1cCgpOwogIF9fZmluaXNoZWRfc2V0dXAgPSB0cnVlOwoKICAvLyBydW4gZmlyc3QgZHJhdwogIF9fbGFzdF9mcmFtZSA9IERhdGUubm93KCk7CiAgYXdhaXQgX19kcmF3KCk7CgogIHJldHVybiB7IHdpZHRoLCBoZWlnaHQgfTsKfQoKZnVuY3Rpb24gaGFsdCgpIHsKICBwbGF5aW5nID0gZmFsc2U7CiAgX19jYW52YXMgPSB1bmRlZmluZWQ7CiAgX19jdHggPSB1bmRlZmluZWQ7CiAgX19maW5pc2hlZF9zZXR1cCA9IGZhbHNlOwogIF9fZHJhd2luZyA9IHRydWU7CiAgX19yZWRyYXdpbmcgPSB0cnVlOwogIF9fZmlyc3QgPSB1bmRlZmluZWQ7CiAgX19tb3ZhYmxlX3BvaW50cyA9IHVuZGVmaW5lZDsKICBfX2N1cnJlbnRfY3Vyc29yID0gdW5kZWZpbmVkOwogIF9fY3VycmVudF9odWUgPSAwOwogIF9fZm9udCA9IHVuZGVmaW5lZDsKICBfX3N0YXJ0X3RpbWUgPSAwOwogIGNsZWFyU2xpZGVycygpOwogIGNsZWFyQnV0dG9ucygpOwp9CgpmdW5jdGlvbiBfX2dldERlc2NyaXB0aW9uKCkgewogIGlmICh0eXBlb2YgZ2V0RGVzY3JpcHRpb24gIT09IGB1bmRlZmluZWRgKSByZXR1cm4gZ2V0RGVzY3JpcHRpb24oKTsKfQoKYXN5bmMgZnVuY3Rpb24gX19zZXR1cCgpIHsKICBpZiAodHlwZW9mIHNldHVwICE9PSBgdW5kZWZpbmVkYCkgYXdhaXQgc2V0dXAoKTsKICBpZiAodHlwZW9mIF9fbW9yZV9zZXR1cCAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IF9fbW9yZV9zZXR1cCgpOwogIGlmICghd2lkdGggJiYgIWhlaWdodCkgc2V0U2l6ZSgpOwp9CgpmdW5jdGlvbiBzZXRTaXplKHcgPSA0MDAsIGggPSAyMDApIHsKICB3aWR0aCA9IF9fY2FudmFzLndpZHRoID0gdzsKICBoZWlnaHQgPSBfX2NhbnZhcy5oZWlnaHQgPSBoOwogIF9fZWxlbWVudC5zdHlsZS5tYXhXaWR0aCA9IGBjYWxjKDJlbSArICR7d2lkdGh9cHhgOwogIF9fY3R4ID0gX19jYW52YXMuZ2V0Q29udGV4dChgMmRgKTsKICBfX2RyYXcoKTsKfQoKYXN5bmMgZnVuY3Rpb24gX19kcmF3KCkgewogIGlmICghX19maW5pc2hlZF9zZXR1cCkgcmV0dXJuOwogIGlmICghX19kcmF3aW5nKSB7CiAgICBfX2RyYXdpbmcgPSB0cnVlOwogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICAgIGZyYW1lRGVsdGEgPSBub3cgLSBfX2xhc3RfZnJhbWU7CiAgICBmcmFtZSsrOwogICAgcmVzZXRUcmFuc2Zvcm0oKTsKICAgIGlmICh0eXBlb2YgZHJhdyAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IGRyYXcoKTsKICAgIGlmICh0eXBlb2YgX19tb3JlX2RyYXcgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBfX21vcmVfZHJhdygpOwogICAgX19kcmF3aW5nID0gZmFsc2U7CiAgICBfX2xhc3RfZnJhbWUgPSBub3c7CiAgICBpZiAocGxheWluZykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IF9fZHJhdygpKTsKICB9Cn0KCmZ1bmN0aW9uIHJlZHJhdygpIHsKICBpZiAoX19yZWRyYXdpbmcpIHJldHVybjsKICBpZiAocGxheWluZykgcmV0dXJuOwogIF9fcmVkcmF3aW5nID0gdHJ1ZTsKICBfX2RyYXcoKTsKICBfX3JlZHJhd2luZyA9IGZhbHNlOwp9Ci8qKgogKiBFbnN1cmUgdGhhdCB0aGVyZSBpcyBubyBib3JkZXIgYXJvdW5kIHRoZSBjYW52YXMgZWxlbWVudAogKi8KZnVuY3Rpb24gbm9Cb3JkZXIoKSB7CiAgc2V0Qm9yZGVyKGZhbHNlKTsKfQoKLyoqCiAqIERpc2FibGUgYm90aCBzdHJva2UgYW5kIGZpbGwgY29sb3IuCiAqLwpmdW5jdGlvbiBub0NvbG9yKCkgewogIG5vRmlsbCgpOwogIG5vU3Ryb2tlKCk7Cn0KCi8qKgogKiBIaWRlIHRoZSBjdXJzb3IuCiAqLwpmdW5jdGlvbiBub0N1cnNvcigpIHsKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgbm9uZWA7Cn0KCi8qKgogKiBEaXNhYmxlIHRoZSBmaWxsIGNvbG9yLgogKi8KZnVuY3Rpb24gbm9GaWxsKCkgewogIHNldEZpbGwoYHRyYW5zcGFyZW50YCk7Cn0KCi8qKgogKiBEaXNhYmxlIHRoZSBkZWZhdWx0IGdyaWQgYmFja2dyb3VuZC4KICovCmZ1bmN0aW9uIG5vR3JpZCgpIHsKICBfX2RyYXdfZ3JpZCA9IGZhbHNlOwp9CgovKioKICogU2V0IHRoZSBsaW5lIHN0cm9rZSB0byAic29saWQiLgogKi8KZnVuY3Rpb24gbm9MaW5lRGFzaCgpIHsKICBfX2N0eC5zZXRMaW5lRGFzaChbXSk7Cn0KCi8qKgogKiBEaXNhYmxlIHRoZSBib3ggc2hhZG93LgogKi8KZnVuY3Rpb24gbm9TaGFkb3coKSB7CiAgc2V0U2hhZG93KGB0cmFuc3BhcmVudGAsIDApOwp9CgovKioKICogRGlzYWJsZSB0aGUgc3Ryb2tlIGNvbG9yLgogKi8KZnVuY3Rpb24gbm9TdHJva2UoKSB7CiAgc2V0U3Ryb2tlKGB0cmFuc3BhcmVudGApOwp9CgovKioKICogRGlzYWJsZSB0ZXh0IHN0cm9raW5nLgogKi8KZnVuY3Rpb24gbm9UZXh0U3Ryb2tlKCkgewogIHNldFRleHRTdHJva2UoZmFsc2UsIHVuZGVmaW5lZCk7Cn0KLyoqCiAqCiAqIEBwYXJhbSB7Kn0gcHJvcExhYmVsCiAqIEBwYXJhbSB7Kn0gYXNzaWduCiAqIEBwYXJhbSB7Kn0gb3B0aW9ucwogKiBAcmV0dXJucwogKi8KZnVuY3Rpb24gYWRkU2xpZGVyKHByb3BMYWJlbCwgYXNzaWduLCBvcHRpb25zID0ge30pIHsKICBsZXQgewogICAgbWluLAogICAgbWF4LAogICAgc3RlcCwKICAgIHZhbHVlLAogICAgY2xhc3NlcyA9IGBzbGlkZXJgLAogICAgdHJhbnNmb3JtID0gKHYpID0+IHYsCiAgfSA9IG9wdGlvbnM7CgogIG1pbiA9IG1pbiA9PT0gdW5kZWZpbmVkID8gMCA6IG1pbjsKICBtYXggPSBtYXggPT09IHVuZGVmaW5lZCA/IDEgOiBtYXg7CiAgc3RlcCA9IHN0ZXAgPT09IHVuZGVmaW5lZCA/IChtYXggLSBtaW4pIC8gMTAgOiBzdGVwOwogIHZhbHVlID0gdmFsdWUgPT09IHVuZGVmaW5lZCA/IChtYXggLSBtaW4pIC8gMiA6IHZhbHVlOwoKICAvLyBjdXN0b20gInJvdW5kaW5nIiwgcHVyZWx5IGZvciBzdHJpbmdzCiAgY29uc3Qgcm91bmQgPSAodiwgZCA9IDQpID0+IHsKICAgIHYgPSBgJHt2fWA7CiAgICBjb25zdCBmcyA9IHYuaW5kZXhPZihgLmApOwogICAgaWYgKGZzICE9PSAtMSkgewogICAgICBsZXQgcHJlYyA9IGQgLSBmcyA+IDAgPyBkIC0gZnMgOiAwOwogICAgICB2ID0gdi5zdWJzdHJpbmcoMCwgZnMgKyBwcmVjKTsKICAgIH0KICAgIHJldHVybiB2OwogIH07CgogIGNvbnN0IGNyZWF0ZSA9ICh0YWcpID0+IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTsKCiAgbGV0IHNsaWRlciA9IGNyZWF0ZShgaW5wdXRgKTsKICBzbGlkZXIudHlwZSA9IGByYW5nZWA7CiAgc2xpZGVyLm1pbiA9IG1pbjsKICBzbGlkZXIubWF4ID0gbWF4OwogIHNsaWRlci5zdGVwID0gc3RlcDsKICBzbGlkZXIuc2V0QXR0cmlidXRlKGB2YWx1ZWAsIHZhbHVlKTsKICBzbGlkZXIuc2V0QXR0cmlidXRlKGBjbGFzc2AsIGNsYXNzZXMpOwoKICBjb25zdCB1cGRhdGUgPSAoeyB2YWx1ZSB9KSA9PiB7CiAgICB2YWx1ZUZpZWxkLnRleHRDb250ZW50ID0gcm91bmQodmFsdWUpOwogICAgYXNzaWduKHRyYW5zZm9ybShwYXJzZUZsb2F0KHZhbHVlKSkpOwogICAgaWYgKCFwbGF5aW5nKSByZWRyYXcoKTsKICB9OwoKICBzbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcihgaW5wdXRgLCAoeyB0YXJnZXQgfSkgPT4gdXBkYXRlKHRhcmdldCkpOwoKICBsZXQgdGFibGUgPSBfX2VsZW1lbnQucXVlcnlTZWxlY3RvcihgdGFibGUuc2xpZGVyLXdyYXBwZXJgKTsKICBpZiAoIXRhYmxlKSB7CiAgICB0YWJsZSA9IGNyZWF0ZShgdGFibGVgKTsKICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoYHNsaWRlci13cmFwcGVyYCk7CiAgICBfX2VsZW1lbnQucHJlcGVuZCh0YWJsZSk7CiAgfQogIGxldCB0ciA9IGNyZWF0ZShgdHJgKTsKCiAgbGV0IHRkID0gY3JlYXRlKGB0ZGApOwogIGxldCBsYWJlbCA9IGNyZWF0ZShgbGFiZWxgKTsKICBsYWJlbC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbGFiZWxgKTsKICBsYWJlbC5pbm5lckhUTUwgPSBwcm9wTGFiZWwKICAgIC5yZXBsYWNlKC9fKC4rKSQvLCBgPHN1Yj4kMTwvc3ViPmApCiAgICAucmVwbGFjZSgvKFxkKykvLCBgPHN1Yj4kMTwvc3ViPmApOwogIHRkLmFwcGVuZChsYWJlbCk7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLW1pbmApOwogIHRkLnRleHRDb250ZW50ID0gcm91bmQoc2xpZGVyLm1pbik7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdGQud2lkdGggPSBgKmA7CiAgdGQuYXBwZW5kKHNsaWRlcik7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLW1heGApOwogIHRkLnRleHRDb250ZW50ID0gcm91bmQoc2xpZGVyLm1heCk7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdmFyIHZhbHVlRmllbGQgPSBjcmVhdGUoYGxhYmVsYCk7IC8vIGZ1bmN0aW9uIHNjb3BlZAogIHZhbHVlRmllbGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLXZhbHVlYCk7CiAgdGQuYXBwZW5kKHZhbHVlRmllbGQpOwogIHRyLmFwcGVuZCh0ZCk7CiAgdGQuYWRkRXZlbnRMaXN0ZW5lcihgcG9pbnRlcmRvd25gLCAoKSA9PiB7CiAgICBjb25zdCB2YWx1ZSA9IHByb21wdChgbmV3IHZhbHVlP2AsIHNsaWRlci52YWx1ZSk7CiAgICBpZiAodmFsdWUgIT09IG51bGwpIHsKICAgICAgc2xpZGVyLnZhbHVlID0gdmFsdWU7CiAgICAgIHVwZGF0ZSh7IHZhbHVlIH0pOwogICAgfQogIH0pOwoKICB0YWJsZS5hcHBlbmQodHIpOwoKICB1cGRhdGUoc2xpZGVyKTsKICByZXR1cm4gc2xpZGVyOwp9CgovKioKICoKICovCmZ1bmN0aW9uIGNsZWFyU2xpZGVycygpIHsKICBjb25zdCB0YWJsZSA9IF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKGB0YWJsZS5zbGlkZXItd3JhcHBlcmApOwogIGlmICh0YWJsZSkgdGFibGUuaW5uZXJIVE1MID0gYGA7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IGxhYmVsCiAqIEBwYXJhbSB7Kn0gb25DbGljawogKiBAcmV0dXJucwogKi8KZnVuY3Rpb24gYWRkQnV0dG9uKGxhYmVsLCBvbkNsaWNrKSB7CiAgY29uc3QgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgYnV0dG9uYCk7CiAgYnRuLmNsYXNzTGlzdC5hZGQoYGdyYXBoaWNzLWVsZW1lbnQtYnV0dG9uYCk7CiAgYnRuLnRleHRDb250ZW50ID0gbGFiZWw7CiAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoYGNsaWNrYCwgKCkgPT4gb25DbGljayhidG4pKTsKICBfX2VsZW1lbnQucHJlcGVuZChidG4pOwogIHJldHVybiBidG47Cn0KCi8qKgogKgogKi8KZnVuY3Rpb24gY2xlYXJCdXR0b25zKCkgewogIF9fZWxlbWVudAogICAgLnF1ZXJ5U2VsZWN0b3JBbGwoYGJ1dHRvbi5ncmFwaGljcy1lbGVtZW50LWJ1dHRvbmApCiAgICAuZm9yRWFjaCgoZSkgPT4gZS5yZW1vdmUoKSk7Cn0KLyoqCiAqCiAqIEBwYXJhbSB7Kn0geAogKiBAcGFyYW0geyp9IHkKICogQHBhcmFtIHsqfSByCiAqIEBwYXJhbSB7Kn0gcwogKiBAcGFyYW0geyp9IGUKICogQHBhcmFtIHsqfSB3ZWRnZQogKi8KZnVuY3Rpb24gYXJjKHgsIHksIHIsIHMgPSAwLCBlID0gVEFVLCB3ZWRnZSA9IGZhbHNlKSB7CiAgc3RhcnQoKTsKICBpZiAod2VkZ2UpIF9fY3R4Lm1vdmVUbyh4LCB5KTsKICBfX2N0eC5hcmMoeCwgeSwgciwgcywgZSk7CiAgaWYgKHdlZGdlKSBfX2N0eC5saW5lVG8oeCwgeSk7CiAgZW5kKCk7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IGhMYWJlbAogKiBAcGFyYW0geyp9IGhzCiAqIEBwYXJhbSB7Kn0gaGUKICogQHBhcmFtIHsqfSB2TGFiZWwKICogQHBhcmFtIHsqfSB2cwogKiBAcGFyYW0geyp9IHZlCiAqIEBwYXJhbSB7Kn0gaHNMYWJlbAogKiBAcGFyYW0geyp9IGhlTGFiZWwKICogQHBhcmFtIHsqfSB2c0xhYmVsCiAqIEBwYXJhbSB7Kn0gdmVMYWJlbAogKi8KZnVuY3Rpb24gYXhlcygKICBoTGFiZWwsCiAgaHMsCiAgaGUsCiAgdkxhYmVsLAogIHZzLAogIHZlLAogIGhzTGFiZWwgPSBmYWxzZSwKICBoZUxhYmVsID0gZmFsc2UsCiAgdnNMYWJlbCA9IGZhbHNlLAogIHZlTGFiZWwgPSBmYWxzZQopIHsKICBsaW5lKGhzLCAwLCBoZSwgMCk7CiAgbGluZSgwLCB2cywgMCwgdmUpOwoKICBjb25zdCBocG9zID0gMCAtIDU7CiAgdGV4dChgJHtoTGFiZWx9IOKGkmAsIHdpZHRoIC8gMiwgaHBvcywgQ0VOVEVSKTsKICB0ZXh0KGhzTGFiZWwgPyBoc0xhYmVsIDogaHMsIGhzLCBocG9zLCBDRU5URVIpOwogIHRleHQoaGVMYWJlbCA/IGhlTGFiZWwgOiBoZSwgaGUsIGhwb3MsIENFTlRFUik7CgogIGNvbnN0IHZwb3MgPSAtNTsKICB0ZXh0KGAke3ZMYWJlbH1gLCB2cG9zLCBoZWlnaHQgLyAyLCBSSUdIVCk7CiAgdGV4dChg4oaTYCwgdnBvcywgaGVpZ2h0IC8gMiArIDE2LCBSSUdIVCk7CiAgdGV4dCh2c0xhYmVsID8gdnNMYWJlbCA6IHZzLCB2cG9zLCB2cyArIDUsIFJJR0hUKTsKICB0ZXh0KHZlTGFiZWwgPyB2ZUxhYmVsIDogdmUsIHZwb3MsIHZlLCBSSUdIVCk7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IHBvaW50cwogKi8KZnVuY3Rpb24gYmV6aWVyKHBvaW50cykgewogIGNvbnN0IFtmaXJzdCwgLi4ucmVzdF0gPSBwb2ludHM7CiAgc3RhcnQoKTsKICB2ZXJ0ZXgoZmlyc3QueCwgZmlyc3QueSk7CiAgZm9yIChsZXQgaSA9IDAsIGUgPSByZXN0Lmxlbmd0aDsgaSA8IGU7IGkgKz0gMykgewogICAgbGV0IFtwMSwgcDIsIHAzXSA9IHJlc3Quc2xpY2UoaSwgaSArIDMpOwogICAgaWYgKHAxICYmIHAyICYmIHAzKSBfX2N0eC5iZXppZXJDdXJ2ZVRvKHAxLngsIHAxLnksIHAyLngsIHAyLnksIHAzLngsIHAzLnkpOwogIH0KICBlbmQoKTsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7Kn0gcG9pbnRzCiAqIEBwYXJhbSB7Kn0gb3BlbgogKi8KZnVuY3Rpb24gYnNwbGluZShwb2ludHMsIG9wZW4gPSB0cnVlKSB7CiAgc3RhcnQoKTsKICBuZXcgQlNwbGluZShwb2ludHMsIG9wZW4pLmdldExVVCgpLmZvckVhY2goKHApID0+IHZlcnRleChwLngsIHAueSkpOwogIGVuZCgpOwp9CgovKioKICoKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKiBAcGFyYW0geyp9IHIKICovCmZ1bmN0aW9uIGNpcmNsZSh4LCB5LCByKSB7CiAgYXJjKHgsIHksIHIpOwp9CgovKioKICoKICogQHBhcmFtIHsqfSBjb2xvcgogKi8KZnVuY3Rpb24gY2xlYXIoY29sb3IgPSBgd2hpdGVgKSB7CiAgc2F2ZSgpOwogIF9fY2FudmFzLnN0eWxlLmJhY2tncm91bmQgPSBjb2xvcjsKICBfX2NhbnZhcy53aWR0aCA9IHdpZHRoOwogIF9fY3R4ID0gX19jYW52YXMuZ2V0Q29udGV4dChgMmRgKTsKICBpZiAoX19kcmF3X2dyaWQpIGdyaWQoKTsKICByZXN0b3JlKCk7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IGNsb3NlCiAqLwpmdW5jdGlvbiBlbmQoY2xvc2UgPSBmYWxzZSkgewogIGlmIChjbG9zZSkgX19jdHguY2xvc2VQYXRoKCk7CiAgX19jdHguZmlsbCgpOwogIF9fY3R4LnN0cm9rZSgpOwogIGlmIChfX2N0eC5saW5lV2lkdGggJSAyID09PSAxKSB7CiAgICBfX2N0eC50cmFuc2xhdGUoLTAuNSwgLTAuNSk7CiAgfQp9CgovKioKICoKICovCmZ1bmN0aW9uIGdyaWQoKSB7CiAgc2F2ZSgpOwogIHNldExpbmVXaWR0aCgwLjUpOwogIG5vRmlsbCgpOwogIHNldFN0cm9rZShfX2dyaWRfY29sb3IpOwogIGZvciAoCiAgICBsZXQgeCA9ICgtMC41ICsgX19ncmlkX3NwYWNpbmcgLyAyKSB8IDA7CiAgICB4IDwgd2lkdGg7CiAgICB4ICs9IF9fZ3JpZF9zcGFjaW5nCiAgKSB7CiAgICBsaW5lKHgsIDAsIHgsIGhlaWdodCk7CiAgfQogIGZvciAoCiAgICBsZXQgeSA9ICgtMC41ICsgX19ncmlkX3NwYWNpbmcgLyAyKSB8IDA7CiAgICB5IDwgaGVpZ2h0OwogICAgeSArPSBfX2dyaWRfc3BhY2luZwogICkgewogICAgbGluZSgwLCB5LCB3aWR0aCwgeSk7CiAgfQogIHJlc3RvcmUoKTsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7Kn0gaW1nCiAqIEBwYXJhbSB7Kn0geAogKiBAcGFyYW0geyp9IHkKICogQHBhcmFtIHsqfSB3CiAqIEBwYXJhbSB7Kn0gaAogKi8KYXN5bmMgZnVuY3Rpb24gaW1hZ2UoaW1nLCB4ID0gMCwgeSA9IDAsIHcsIGgpIHsKICBpZiAodHlwZW9mIGltZyA9PT0gYHN0cmluZ2ApIHsKICAgIGltZyA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgY29uc3QgdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgaW1nYCk7CiAgICAgIHRhZy5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKHRhZyk7CiAgICAgIHRhZy5vbmVycm9yID0gKCkgPT4gcmVqZWN0KCk7CiAgICAgIHRhZy5zcmMgPSBpbWc7CiAgICB9KTsKICB9CiAgX19jdHguZHJhd0ltYWdlKGltZywgeCwgeSwgdyB8fCBpbWcud2lkdGgsIGggfHwgaW1nLmhlaWdodCk7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IHgxCiAqIEBwYXJhbSB7Kn0geTEKICogQHBhcmFtIHsqfSB4MgogKiBAcGFyYW0geyp9IHkyCiAqLwpmdW5jdGlvbiBsaW5lKHgxLCB5MSwgeDIsIHkyKSB7CiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICB2ZXJ0ZXgoeDIsIHkyKTsKICBlbmQoKTsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7Kn0gZgogKiBAcGFyYW0geyp9IGEKICogQHBhcmFtIHsqfSBiCiAqIEBwYXJhbSB7Kn0gc3RlcHMKICogQHBhcmFtIHsqfSB4c2NhbGUKICogQHBhcmFtIHsqfSB5c2NhbGUKICovCmZ1bmN0aW9uIHBsb3QoZiwgYSA9IDAsIGIgPSAxLCBzdGVwcyA9IDI0LCB4c2NhbGUgPSAxLCB5c2NhbGUgPSAxKSB7CiAgY29uc3QgaW50ZXJ2YWwgPSBiIC0gYTsKICBzdGFydCgpOwogIGZvciAobGV0IGkgPSAwLCBlID0gc3RlcHMgLSAxLCB4LCB5LCB2OyBpIDwgc3RlcHM7IGkrKykgewogICAgeCA9IGEgKyBpbnRlcnZhbCAqIChpIC8gZSk7CiAgICB5ID0gZih4KTsKICAgIHZlcnRleCh4ICogeHNjYWxlLCB5ICogeXNjYWxlKTsKICB9CiAgZW5kKCk7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IGRhdGEKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKi8KZnVuY3Rpb24gcGxvdERhdGEoZGF0YSwgeCwgeSkgewogIHN0YXJ0KCk7CiAgZGF0YS5mb3JFYWNoKChwKSA9PiB2ZXJ0ZXgocFt4XSwgcFt5XSkpOwogIGVuZCgpOwp9CgovKioKICoKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKi8KZnVuY3Rpb24gcG9pbnQoeCwgeSkgewogIGNpcmNsZSh4LCB5LCAzKTsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7Kn0geAogKiBAcGFyYW0geyp9IHkKICogQHBhcmFtIHsqfSB3CiAqIEBwYXJhbSB7Kn0gaAogKi8KZnVuY3Rpb24gcmVjdCh4LCB5LCB3LCBoKSB7CiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeCwgeSk7CiAgdmVydGV4KHggKyB3LCB5KTsKICB2ZXJ0ZXgoeCArIHcsIHkgKyBoKTsKICB2ZXJ0ZXgoeCwgeSArIGgpOwogIHZlcnRleCh4LCB5KTsKICBlbmQoKTsKfQoKLyoqCiAqIGRyYXcgYSBjYXJkaW5hbCBzcGxpbmUgd2l0aCB2aXJ0dWFsIHN0YXJ0IGFuZCBlbmQgcG9pbnQKICoKICogQHBhcmFtIHsqfSBwb2ludHMKICogQHBhcmFtIHsqfSB2aXJ0dWFsCiAqIEBwYXJhbSB7Kn0gdGlnaHRuZXNzCiAqIEBwYXJhbSB7Kn0gVAogKi8KZnVuY3Rpb24gc3BsaW5lKHBvaW50cywgdmlydHVhbCA9IHRydWUsIHRpZ2h0bmVzcyA9IDEsIFQgPSB0aWdodG5lc3MpIHsKICBsZXQgY3BvaW50cyA9IHBvaW50czsKICBpZiAodmlydHVhbCkgewogICAgY29uc3QgZjAgPSBwb2ludHNbMF0sCiAgICAgIGYxID0gcG9pbnRzWzFdLAogICAgICBmMiA9IHBvaW50c1syXSwKICAgICAgZnNtID0gbmV3IFZlY3RvcihmMC54IC8gMiArIGYyLnggLyAyLCBmMC55IC8gMiArIGYyLnkgLyAyKSwKICAgICAgZjByID0gbmV3IFZlY3RvcihmMCkucmVmbGVjdChmMSksCiAgICAgIGZzciA9IGZzbS5yZWZsZWN0KGYxKSwKICAgICAgZm4gPSBuZXcgVmVjdG9yKGYwci54IC8gMiArIGZzci54IC8gMiwgZjByLnkgLyAyICsgZnNyLnkgLyAyKSwKICAgICAgbDIgPSBwb2ludHMuYXQoLTMpLAogICAgICBsMSA9IHBvaW50cy5hdCgtMiksCiAgICAgIGwwID0gcG9pbnRzLmF0KC0xKSwKICAgICAgbHNtID0gbmV3IFZlY3RvcihsMC54IC8gMiArIGwyLnggLyAyLCBsMC55IC8gMiArIGwyLnkgLyAyKSwKICAgICAgbDByID0gbmV3IFZlY3RvcihsMCkucmVmbGVjdChsMSksCiAgICAgIGxuID0gbmV3IFZlY3RvcihsMHIueCAvIDIgKyBsc20ueCAvIDIsIGwwci55IC8gMiArIGxzbS55IC8gMik7CiAgICBjcG9pbnRzID0gW2ZuLCAuLi5wb2ludHMsIGxuXTsKICB9CgogIC8vIGZvdXIgcG9pbnQgc2xpZGluZyB3aW5kb3cgb3ZlciB0aGUgc2VnbWVudAogIHN0YXJ0KCk7CiAgX19jdHgubW92ZVRvKGNwb2ludHNbMV0ueCwgY3BvaW50c1sxXS55KTsKICBmb3IgKGxldCBpID0gMCwgZSA9IGNwb2ludHMubGVuZ3RoIC0gMzsgaSA8IGU7IGkrKykgewogICAgbGV0IFtjMSwgYzIsIGMzLCBjNF0gPSBjcG9pbnRzLnNsaWNlKGksIGkgKyA0KTsKICAgIGxldCBwMiA9IHsKICAgICAgeDogYzIueCArIChjMy54IC0gYzEueCkgLyAoNiAqIFQpLAogICAgICB5OiBjMi55ICsgKGMzLnkgLSBjMS55KSAvICg2ICogVCksCiAgICB9OwogICAgbGV0IHAzID0gewogICAgICB4OiBjMy54IC0gKGM0LnggLSBjMi54KSAvICg2ICogVCksCiAgICAgIHk6IGMzLnkgLSAoYzQueSAtIGMyLnkpIC8gKDYgKiBUKSwKICAgIH07CiAgICBfX2N0eC5iZXppZXJDdXJ2ZVRvKHAyLngsIHAyLnksIHAzLngsIHAzLnksIGMzLngsIGMzLnkpOwogIH0KICBlbmQoKTsKfQoKLyoqCiAqCiAqLwpmdW5jdGlvbiBzdGFydCgpIHsKICBpZiAoX19jdHgubGluZVdpZHRoICUgMiA9PT0gMSkgewogICAgX19jdHgudHJhbnNsYXRlKDAuNSwgMC41KTsKICB9CiAgX19jdHguYmVnaW5QYXRoKCk7CiAgX19maXJzdCA9IGZhbHNlOwp9CgovKioKICoKICogQHBhcmFtIHsqfSBzdHIKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKiBAcGFyYW0geyp9IHhhbGlnbgogKiBAcGFyYW0geyp9IHlhbGlnbgogKi8KZnVuY3Rpb24gdGV4dChzdHIsIHgsIHksIHhhbGlnbiwgeWFsaWduID0gYGluaGVyaXRgKSB7CiAgc2F2ZSgpOwogIGlmICh4YWxpZ24pIHsKICAgIHNldFRleHRBbGlnbih4YWxpZ24sIHlhbGlnbik7CiAgfQogIF9fY3R4LmZpbGxUZXh0KHN0ciwgeCwgeSk7CiAgaWYgKF9fdGV4dFN0cm9rZSkgewogICAgc2V0U3Ryb2tlKF9fdGV4dFN0cm9rZSk7CiAgICBfX2N0eC5zdHJva2VUZXh0KHN0ciwgeCwgeSk7CiAgfQogIHJlc3RvcmUoKTsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7Kn0geDEKICogQHBhcmFtIHsqfSB5MQogKiBAcGFyYW0geyp9IHgyCiAqIEBwYXJhbSB7Kn0geTIKICogQHBhcmFtIHsqfSB4MwogKiBAcGFyYW0geyp9IHkzCiAqLwpmdW5jdGlvbiB0cmlhbmdsZSh4MSwgeTEsIHgyLCB5MiwgeDMsIHkzKSB7CiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICB2ZXJ0ZXgoeDIsIHkyKTsKICB2ZXJ0ZXgoeDMsIHkzKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICBlbmQoKTsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7Kn0geAogKiBAcGFyYW0geyp9IHkKICovCmZ1bmN0aW9uIHZlcnRleCh4LCB5KSB7CiAgaWYgKF9fZmlyc3QpIHsKICAgIF9fY3R4LmxpbmVUbyh4LCB5KTsKICB9IGVsc2UgewogICAgX19maXJzdCA9IHsgeCwgeSB9OwogICAgX19jdHgubW92ZVRvKHgsIHkpOwogIH0KfQovKioKICoKICovCmZ1bmN0aW9uIGNsZWFyTW92YWJsZSgpIHsKICBfX21vdmFibGVfcG9pbnRzLnNwbGljZSgwLCBfX21vdmFibGVfcG9pbnRzLmxlbmd0aCk7Cn0KCi8qKgogKgogKiBAcmV0dXJucwogKi8KZnVuY3Rpb24gY29weSgpIHsKICBjb25zdCBjb3B5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgY2FudmFzYCk7CiAgY29weS53aWR0aCA9IHdpZHRoOwogIGNvcHkuaGVpZ2h0ID0gaGVpZ2h0OwogIGNvbnN0IGN0eCA9IGNvcHkuZ2V0Q29udGV4dChgMmRgKTsKICBjdHguZHJhd0ltYWdlKF9fY2FudmFzLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICByZXR1cm4gY29weTsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7Kn0gaAogKiBAcGFyYW0geyp9IHMKICogQHBhcmFtIHsqfSBsCiAqIEBwYXJhbSB7Kn0gYQogKiBAcmV0dXJucwogKi8KZnVuY3Rpb24gY29sb3IoaCA9IF9fY3VycmVudF9odWUsIHMgPSA1MCwgbCA9IDUwLCBhID0gMSkgewogIHJldHVybiBgaHNsYSgke2h9LCR7c30lLCR7bH0lLCR7YX0pYDsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7Kn0gY29sb3IKICovCmZ1bmN0aW9uIGhpZ2hsaWdodChjb2xvcikgewogIF9faGlnaGxpZ2h0X2NvbG9yID0gY29sb3I7CiAgcmVkcmF3KCk7Cn0KCi8qKgogKgogKiBAcmV0dXJucwogKi8KZnVuY3Rpb24gbWlsbGlzKCkgewogIHJldHVybiBEYXRlLm5vdygpIC0gX19zdGFydF90aW1lOwp9CgovKioKICoKICovCmZ1bmN0aW9uIHBhdXNlKCkgewogIHBsYXlpbmcgPSBmYWxzZTsKfQoKLyoqCiAqCiAqLwpmdW5jdGlvbiBwbGF5KCkgewogIHBsYXlpbmcgPSB0cnVlOwogIF9fZHJhdygpOwp9CgovKioKICoKICogQHBhcmFtIHsqfSBhCiAqIEBwYXJhbSB7Kn0gY3ljbGUKICogQHJldHVybnMKICovCmZ1bmN0aW9uIHJhbmRvbUNvbG9yKGEgPSAxLjAsIGN5Y2xlID0gdHJ1ZSkgewogIGlmIChjeWNsZSkgX19jdXJyZW50X2h1ZSA9IChfX2N1cnJlbnRfaHVlICsgNzMpICUgMzYwOwogIHJldHVybiBgaHNsYSgke19fY3VycmVudF9odWV9LDUwJSw1MCUsJHthfSlgOwp9CgovKioKICoKICogQHBhcmFtIHsqfSBwb2ludHMKICovCmZ1bmN0aW9uIHNldE1vdmFibGUocG9pbnRzKSB7CiAgLy8gVE9ETzogc2hhcGVzCiAgaWYgKCFwb2ludHMuZm9yRWFjaCkgewogICAgcG9pbnRzID0gW3BvaW50c107CiAgfQogIHBvaW50cy5mb3JFYWNoKChwKSA9PiB7CiAgICBpZiAoX19tb3ZhYmxlX3BvaW50cy5pbmRleE9mKHApID09PSAtMSkgewogICAgICBfX21vdmFibGVfcG9pbnRzLnB1c2gocCk7CiAgICB9CiAgfSk7Cn0KCi8qKgogKgogKi8KZnVuY3Rpb24gcmVzdG9yZSgpIHsKICBfX2N0eC5yZXN0b3JlKCk7Cn0KCi8qKgogKiBTYXZlIHRoZSBjYW52YXMgY29udGV4dC4KICovCmZ1bmN0aW9uIHNhdmUoKSB7CiAgX19jdHguc2F2ZSgpOwp9CgovKioKICoKICogQHJldHVybnMKICovCmZ1bmN0aW9uIHRvRGF0YVVSTCgpIHsKICByZXR1cm4gX19jYW52YXMudG9EYXRhVVJMKCk7Cn0KCi8qKgogKgogKiBAcmV0dXJucwogKi8KZnVuY3Rpb24gdG9nZ2xlUGxheSgpIHsKICBwbGF5aW5nID8gcGF1c2UoKSA6IHBsYXkoKTsKICByZXR1cm4gcGxheWluZzsKfQovKioKICoKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKiBAcGFyYW0geyp9IHoKICogQHJldHVybnMKICovCmZ1bmN0aW9uIHByb2plY3QoeCwgeSwgeikgewogIHJldHVybiBfX3Byb2plY3Rvci5wcm9qZWN0KHgsIHksIHopOwp9CgovKioKICoKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKiBAcGFyYW0geyp9IHoKICogQHJldHVybnMKICovCmZ1bmN0aW9uIHJvdGF0ZVByb2plY3Rvcih4LCB5LCB6KSB7CiAgcmV0dXJuIF9fcHJvamVjdG9yLnNldFJvdGF0aW9uKHgsIHksIHopOwp9CgovKioKICoKICogQHBhcmFtICB7Li4uYW55fSBhcmdzCiAqLwpmdW5jdGlvbiBzZXRQcm9qZWN0b3IoLi4uYXJncykgewogIF9fcHJvamVjdG9yLnVwZGF0ZSguLi5hcmdzKTsKfQovKioKICoKICogQHBhcmFtIHsqfSB3aWR0aAogKiBAcGFyYW0geyp9IGNvbG9yCiAqLwpmdW5jdGlvbiBzZXRCb3JkZXIod2lkdGggPSAxLCBjb2xvciA9IGBibGFja2ApIHsKICBpZiAoIXdpZHRoKSB7CiAgICBfX2NhbnZhcy5zdHlsZS5ib3JkZXIgPSBgbm9uZWA7CiAgfSBlbHNlIHsKICAgIF9fY2FudmFzLnN0eWxlLmJvcmRlciA9IGAke3dpZHRofXB4IHNvbGlkICR7Y29sb3J9YDsKICB9Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IGNvbG9yCiAqLwpmdW5jdGlvbiBzZXRDb2xvcihjb2xvcikgewogIHNldEZpbGwoY29sb3IpOwogIHNldFN0cm9rZShjb2xvcik7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IGVuYWJsZWQKICovCmZ1bmN0aW9uIHNldENyaXNwKGVuYWJsZWQgPSB0cnVlKSB7CiAgX19jYW52YXMuY2xhc3NMaXN0LnRvZ2dsZShgY3Jpc3BgLCBlbmFibGVkKTsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7Kn0gdHlwZQogKi8KZnVuY3Rpb24gc2V0Q3Vyc29yKHR5cGUpIHsKICBfX2N1cnJlbnRfY3Vyc29yID0gdHlwZTsKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBfX2N1cnJlbnRfY3Vyc29yOwp9CgovKioKICoKICogQHBhcmFtIHsqfSBjb2xvcgogKi8KZnVuY3Rpb24gc2V0RmlsbChjb2xvciA9IGBibGFja2ApIHsKICBpZiAoQ1NTX0NPTE9SX01BUFtjb2xvcl0gPT09IF9faGlnaGxpZ2h0X2NvbG9yKSB7CiAgICBjb2xvciA9IF9fY3VycmVudF9oaWdobGlnaHRfY29sb3I7CiAgfQogIF9fY3R4LmZpbGxTdHlsZSA9IGNvbG9yOwp9CgovKioKICoKICogQHBhcmFtIHsqfSBmb250CiAqLwpmdW5jdGlvbiBzZXRGb250KGZvbnQpIHsKICBfX2N0eC5mb250ID0gZm9udCB8fCBgJHtfX2ZvbnQud2VpZ2h0fSAke19fZm9udC5zaXplfXB4ICR7X19mb250LmZhbWlseX1gOwp9CgovKioKICoKICogQHBhcmFtIHsqfSBuYW1lCiAqLwpmdW5jdGlvbiBzZXRGb250RmFtaWx5KG5hbWUpIHsKICBfX2ZvbnQuZmFtaWx5ID0gbmFtZTsKICBzZXRGb250KCk7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IHB4CiAqLwpmdW5jdGlvbiBzZXRGb250U2l6ZShweCkgewogIF9fZm9udC5zaXplID0gcHg7CiAgc2V0Rm9udCgpOwp9CgovKioKICoKICogQHBhcmFtIHsqfSB2YWwKICovCmZ1bmN0aW9uIHNldEZvbnRXZWlnaHQodmFsKSB7CiAgX19mb250LndlaWdodCA9IHZhbDsKICBzZXRGb250KCk7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IHNwYWNpbmcKICogQHBhcmFtIHsqfSBjb2xvcgogKi8KZnVuY3Rpb24gc2V0R3JpZChzcGFjaW5nID0gMjAsIGNvbG9yID0gYGxpZ2h0Z3JleWApIHsKICBfX2RyYXdfZ3JpZCA9IHRydWU7CiAgX19ncmlkX3NwYWNpbmcgPSBzcGFjaW5nOwogIF9fZ3JpZF9jb2xvciA9IGNvbG9yOwp9CgovKioKICoKICogQHBhcmFtIHsqfSBjb2xvcgogKi8KZnVuY3Rpb24gc2V0SGlnaGxpZ2h0Q29sb3IoY29sb3IpIHsKICBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yID0gY29sb3I7Cn0KCi8qKgogKgogKiBAcGFyYW0gIHsuLi5hbnl9IHZhbHVlcwogKi8KZnVuY3Rpb24gc2V0TGluZURhc2goLi4udmFsdWVzKSB7CiAgX19jdHguc2V0TGluZURhc2godmFsdWVzKTsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7Kn0gd2lkdGgKICovCmZ1bmN0aW9uIHNldExpbmVXaWR0aCh3aWR0aCA9IDEpIHsKICBfX2N0eC5saW5lV2lkdGggPSB3aWR0aDsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7Kn0gY29sb3IKICovCmZ1bmN0aW9uIHNldFN0cm9rZShjb2xvciA9IGBibGFja2ApIHsKICBpZiAoQ1NTX0NPTE9SX01BUFtjb2xvcl0gPT09IF9faGlnaGxpZ2h0X2NvbG9yKSB7CiAgICBjb2xvciA9IF9fY3VycmVudF9oaWdobGlnaHRfY29sb3I7CiAgfQogIF9fY3R4LnN0cm9rZVN0eWxlID0gY29sb3I7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IHhBbGlnbgogKiBAcGFyYW0geyp9IHlBbGlnbgogKi8KZnVuY3Rpb24gc2V0VGV4dEFsaWduKHhBbGlnbiwgeUFsaWduID0gQUxQSEFCRVRJQykgewogIF9fY3R4LnRleHRBbGlnbiA9IHhBbGlnbjsKICBfX2N0eC50ZXh0QmFzZUxpbmUgPSB5QWxpZ247Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IGRpcgogKi8KZnVuY3Rpb24gc2V0VGV4dERpcmVjdGlvbihkaXIgPSBgaW5oZXJpdGApIHsKICBfX2N0eC5kaXJlY3Rpb24gPSBkaXI7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IGNvbG9yCiAqIEBwYXJhbSB7Kn0gd2lkdGgKICovCmZ1bmN0aW9uIHNldFRleHRTdHJva2UoY29sb3IsIHdpZHRoKSB7CiAgX190ZXh0U3Ryb2tlID0gY29sb3I7CiAgc2V0TGluZVdpZHRoKHdpZHRoKTsKfQovKioKICoKICovCmZ1bmN0aW9uIHJlc2V0VHJhbnNmb3JtKCkgewogIF9fY3R4LnJlc2V0VHJhbnNmb3JtKCk7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IGFuZ2xlCiAqLwpmdW5jdGlvbiByb3RhdGUoYW5nbGUgPSAwKSB7CiAgX19jdHgucm90YXRlKGFuZ2xlKTsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7Kn0geAogKiBAcGFyYW0geyp9IHkKICovCmZ1bmN0aW9uIHNjYWxlKHggPSAxLCB5ID0geCkgewogIF9fY3R4LnNjYWxlKHgsIHkpOwp9CgovKioKICoKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKiBAcmV0dXJucwogKi8KZnVuY3Rpb24gc2NyZWVuVG9Xb3JsZCh4LCB5KSB7CiAgaWYgKHkgPT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBsZXQgTSA9IF9fY3R4LmdldFRyYW5zZm9ybSgpLmludmVydFNlbGYoKTsKCiAgbGV0IHJldCA9IHsKICAgIHg6IHggKiBNLmEgKyB5ICogTS5jICsgTS5lLAogICAgeTogeCAqIE0uYiArIHkgKiBNLmQgKyBNLmYsCiAgfTsKCiAgcmV0dXJuIHJldDsKfQoKLyoqCiAqIHRyYW5zZm9ybXM6IHVuaXZlcnNhbCBmcmVlIHRyYW5zZm9ybSBiYXNlZCBvbiBhcHBseWluZwogKgogKiAgICAgICB8IGEgYiBjIHwKICogICBtID0gfCBkIGUgZiB8CiAqICAgICAgIHwgMCAwIDEgfAogKi8KZnVuY3Rpb24gdHJhbnNmb3JtKGEgPSAxLCBiID0gMCwgYyA9IDAsIGQgPSAwLCBlID0gMSwgZiA9IDApIHsKICBfX2N0eC50cmFuc2Zvcm0oYSwgYiwgYywgZCwgZSwgZik7Cn0KCi8qKgogKgogKiBAcGFyYW0geyp9IHgKICogQHBhcmFtIHsqfSB5CiAqLwpmdW5jdGlvbiB0cmFuc2xhdGUoeCA9IDAsIHkgPSAwKSB7CiAgX19jdHgudHJhbnNsYXRlKHgsIHkpOwp9CgovKioKICoKICogQHBhcmFtIHsqfSB4CiAqIEBwYXJhbSB7Kn0geQogKiBAcmV0dXJucwogKi8KZnVuY3Rpb24gd29ybGRUb1NjcmVlbih4LCB5KSB7CiAgaWYgKHkgPT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBsZXQgTSA9IF9fY3R4LmdldFRyYW5zZm9ybSgpOwoKICBsZXQgcmV0ID0gewogICAgeDogeCAqIE0uYSArIHkgKiBNLmMgKyBNLmUsCiAgICB5OiB4ICogTS5iICsgeSAqIE0uZCArIE0uZiwKICB9OwoKICByZXR1cm4gcmV0Owp9CmZ1bmN0aW9uIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCkgewogIC8vIFdlIGRvbid0IHdhbnQgdG8gaW50ZXJmZXJlIHdpdGggdGhlIGJyb3dzZXIsIHNvIHdlJ3JlIG9ubHkKICAvLyBnb2luZyB0byBhbGxvdyB1bm1vZGlmaWVkIGtleXMsIG9yIHNoaWZ0LW1vZGlmaWVkIGtleXMsCiAgLy8gYW5kIHRhYiBoYXMgdG8gYWx3YXlzIHdvcmsuIEZvciBvYnZpb3VzIHJlYXNvbnMuCiAgY29uc3QgdGFiID0gZXZ0LmtleSAhPT0gIlRhYiI7CiAgY29uc3QgZnVuY3Rpb25LZXkgPSBldnQua2V5Lm1hdGNoKC9GXGQrLykgPT09IG51bGw7CiAgY29uc3Qgc3BlY2lmaWNDaGVjayA9IHRhYiAmJiBmdW5jdGlvbktleTsKICBpZiAoIWV2dC5hbHRLZXkgJiYgIWV2dC5jdHJsS2V5ICYmICFldnQubWV0YUtleSAmJiBzcGVjaWZpY0NoZWNrKSB7CiAgICBpZiAoZXZ0LnRhcmdldCA9PT0gX19jYW52YXMpIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIF9fa2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpIHsKICBrZXlib2FyZFtrZXldID0gRGF0ZS5ub3coKTsKICBpZiAodHlwZW9mIGtleURvd24gIT09IGB1bmRlZmluZWRgKQogICAga2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9CgpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBrZXlkb3duYCwgKGV2dCkgPT4gewogIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCk7CiAgY29uc3QgeyBrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkgfSA9IGV2dDsKICBpZiAoX19maW5pc2hlZF9zZXR1cCkgX19rZXlEb3duKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn0pOwoKZnVuY3Rpb24gX19rZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpIHsKICBkZWxldGUga2V5Ym9hcmRba2V5XTsKICBpZiAodHlwZW9mIGtleVVwICE9PSBgdW5kZWZpbmVkYCkKICAgIGtleVVwKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn0KCl9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoYGtleXVwYCwgKGV2dCkgPT4gewogIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCk7CiAgY29uc3QgeyBrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkgfSA9IGV2dDsKICBpZiAoX19maW5pc2hlZF9zZXR1cCkgX19rZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9KTsKZnVuY3Rpb24gX19jaGVja0ZvckN1cnJlbnRQb2ludCh4LCB5LCB0eXBlKSB7CiAgY29uc3QgbWF0Y2hlcyA9IFtdOwogIGNvbnN0IG1hdGNoUGFkZGluZyA9IHR5cGUuaW5jbHVkZXMoYG1vdXNlYCkgPyAxMCA6IDMwOwogIF9fbW92YWJsZV9wb2ludHMuZm9yRWFjaCgocCwgcG9zKSA9PiB7CiAgICBsZXQgeDIgPSBwWzBdID09PSB1bmRlZmluZWQgPyBwLnggOiBwWzBdOwogICAgbGV0IHkyID0gcFsxXSA9PT0gdW5kZWZpbmVkID8gcC55IDogcFsxXTsKICAgIGNvbnN0IGQgPSBkaXN0KHgsIHksIHgyLCB5Mik7CiAgICBpZiAoZCA8IChwLnIgPyBwLnIgOiAwKSArIG1hdGNoUGFkZGluZykgewogICAgICBtYXRjaGVzLnB1c2goeyBwLCBkIH0pOwogICAgfQogIH0pOwogIGN1cnJlbnRQb2ludCA9IGZhbHNlOwogIF9fY2FudmFzLnN0eWxlLmN1cnNvciA9IGBhdXRvYDsKICBpZiAobWF0Y2hlcy5sZW5ndGgpIHsKICAgIG1hdGNoZXMuc29ydCgoYSwgYikgPT4gYS5kIC0gYi5kKTsKICAgIGN1cnJlbnRQb2ludCA9IG1hdGNoZXNbMF0ucDsKICAgIF9fY2FudmFzLnN0eWxlLmN1cnNvciA9IGBwb2ludGVyYDsKICB9Cn0KCmZ1bmN0aW9uIF9fdG9Qb2ludGVyRXZlbnQoZXZ0KSB7CiAgbGV0IHBvaW50ZXIgPSBldnQ7CiAgLy8gQ29udmVydCBtb3VzZSBvciB0b3VjaCBpbnRvIGdlbmVyaWMgcG9pbnRlci4gV2hpY2ggd2UgbmVlZAogIC8vIHRvIGRvIGJlY2F1c2UgQ2hyb21lIG9uIE1hY09TIGhhcyBkZWNpZGVkIHRvIG5vdCBnZW5lcmF0ZQogIC8vIHBvaW50ZXIgZXZlbnRzIHdoZW4gdGhlcmUncyBhIG1vdXNlLiBUaGFua3MgR29vZ2xlIQogIGlmIChldnQudHlwZS5pbmNsdWRlcyhgdG91Y2hgKSkgewogICAgY29uc3QgeyB0b3VjaGVzLCBjaGFuZ2VkVG91Y2hlcyB9ID0gZXZ0Lm9yaWdpbmFsRXZlbnQgPz8gZXZ0OwogICAgcG9pbnRlciA9IHRvdWNoZXNbMF0gPz8gY2hhbmdlZFRvdWNoZXNbMF07CiAgfQogIGNvbnN0IHsgY2xpZW50WCwgY2xpZW50WSB9ID0gcG9pbnRlcjsKICBjb25zdCB7IGxlZnQsIHRvcCB9ID0gX19jYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgcmV0dXJuIHsgb2Zmc2V0WDogY2xpZW50WCAtIGxlZnQsIG9mZnNldFk6IGNsaWVudFkgLSB0b3AgfTsKfQoKZnVuY3Rpb24gX19wb2ludGVyRG93bih4LCB5KSB7CiAgaWYgKGN1cnJlbnRQb2ludCkgewogICAgY3VycmVudFBvaW50Ll9keCA9IGN1cnJlbnRQb2ludC54IC0geDsKICAgIGN1cnJlbnRQb2ludC5fZHkgPSBjdXJyZW50UG9pbnQueSAtIHk7CiAgfQogIGlmICh0eXBlb2YgcG9pbnRlckRvd24gIT09IGB1bmRlZmluZWRgKSBwb2ludGVyRG93bih4LCB5KTsKfQoKW2B0b3VjaHN0YXJ0YCwgYG1vdXNlZG93bmBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChldnQpID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGNvbnN0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gX190b1BvaW50ZXJFdmVudChldnQpOwogICAgICBjb25zdCB7IHgsIHkgfSA9IHNjcmVlblRvV29ybGQob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwgeyB4LCB5LCB0eXBlLCBkb3duOiB0cnVlLCBtYXJrOiB7IHgsIHkgfSB9KTsKICAgICAgX19jaGVja0ZvckN1cnJlbnRQb2ludCh4LCB5LCB0eXBlKTsKICAgICAgX19wb2ludGVyRG93bih4LCB5KTsKICAgIH0KICB9KTsKfSk7CgpmdW5jdGlvbiBfX3BvaW50ZXJVcCh4LCB5KSB7CiAgaWYgKHR5cGVvZiBwb2ludGVyVXAgIT09IGB1bmRlZmluZWRgKSBwb2ludGVyVXAoeCwgeSk7CiAgaWYgKHBvaW50ZXIubWFyaz8ueCA9PT0geCAmJiBwb2ludGVyLm1hcms/LnkgPT09IHkpIHsKICAgIGlmICh0eXBlb2YgcG9pbnRlckNsaWNrICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlckNsaWNrKHgsIHkpOwogIH0KfQoKW2B0b3VjaGVuZGAsIGBtb3VzZXVwYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2dCkgPT4gewogICAgaWYgKF9fZmluaXNoZWRfc2V0dXApIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgY29uc3QgeyBvZmZzZXRYLCBvZmZzZXRZIH0gPSBfX3RvUG9pbnRlckV2ZW50KGV2dCk7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUsIGRvd246IGZhbHNlLCBtYXJrOiBmYWxzZSB9KTsKICAgICAgX19wb2ludGVyVXAoeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyTW92ZSh4LCB5KSB7CiAgbGV0IHBvaW50TW92ZWQgPSBmYWxzZTsKICBpZiAocG9pbnRlci5kb3duICYmIGN1cnJlbnRQb2ludCkgewogICAgaWYgKGN1cnJlbnRQb2ludFswXSkgewogICAgICBjdXJyZW50UG9pbnRbMF0gPSB4ICsgY3VycmVudFBvaW50Ll9keDsKICAgICAgY3VycmVudFBvaW50WzFdID0geSArIGN1cnJlbnRQb2ludC5fZHk7CiAgICB9IGVsc2UgewogICAgICBjdXJyZW50UG9pbnQueCA9IHggKyBjdXJyZW50UG9pbnQuX2R4OwogICAgICBjdXJyZW50UG9pbnQueSA9IHkgKyBjdXJyZW50UG9pbnQuX2R5OwogICAgfQogICAgcG9pbnRNb3ZlZCA9IHRydWU7CiAgfQoKICBpZiAodHlwZW9mIHBvaW50ZXJNb3ZlICE9PSBgdW5kZWZpbmVkYCkgewogICAgcG9pbnRlck1vdmUoeCwgeSk7CiAgICBwb2ludGVyLmRyYWcgPSBmYWxzZTsKICAgIGlmIChwb2ludGVyLmRvd24gJiYgdHlwZW9mIHBvaW50ZXJEcmFnICE9PSBgdW5kZWZpbmVkYCkgewogICAgICBwb2ludGVyLmRyYWcgPSB0cnVlOwogICAgICBwb2ludGVyRHJhZyh4LCB5KTsKICAgIH0KICB9CiAgaWYgKHBvaW50TW92ZWQgJiYgIXBsYXlpbmcpIHJlZHJhdygpOwp9CgpbYHRvdWNobW92ZWAsIGBtb3VzZW1vdmVgXS5mb3JFYWNoKCh0eXBlKSA9PiB7CiAgX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCAoZXZ0KSA9PiB7CiAgICBpZiAoX19maW5pc2hlZF9zZXR1cCkgewogICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICBjb25zdCB7IG9mZnNldFgsIG9mZnNldFkgfSA9IF9fdG9Qb2ludGVyRXZlbnQoZXZ0KTsKICAgICAgY29uc3QgeyB4LCB5IH0gPSBzY3JlZW5Ub1dvcmxkKG9mZnNldFgsIG9mZnNldFkpOwogICAgICBPYmplY3QuYXNzaWduKHBvaW50ZXIsIHsgeCwgeSwgdHlwZSB9KTsKICAgICAgaWYgKCFwb2ludGVyLmRvd24pIF9fY2hlY2tGb3JDdXJyZW50UG9pbnQoeCwgeSwgdHlwZSk7CiAgICAgIF9fcG9pbnRlck1vdmUoeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyQWN0aXZlKGFjdGl2ZSkgewogIGlmICh0eXBlb2YgcG9pbnRlckFjdGl2ZSAhPT0gYHVuZGVmaW5lZGApIHsKICAgIHBvaW50ZXJBY3RpdmUoYWN0aXZlKTsKICB9Cn0KCltgdG91Y2hzdGFydGAsIGBtb3VzZWVudGVyYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKCkgPT4gewogICAgcG9pbnRlci5hY3RpdmUgPSB0cnVlOwogICAgX19wb2ludGVyQWN0aXZlKHRydWUpOwogIH0pOwp9KTsKCltgdG91Y2hlbmRgLCBgbW91c2VsZWF2ZWBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsICgpID0+IHsKICAgIHBvaW50ZXIuYWN0aXZlID0gZmFsc2U7CiAgICBfX3BvaW50ZXJBY3RpdmUoZmFsc2UpOwogIH0pOwp9KTsKLyoqCiAqIGNvZGUgdXNlZCBieSBwcm9qZWN0LmpzLCBidXQgbmFtZWQgc28gdGhhdCBpdCBsb2FkcwogKiBmaXJzdCwgYW5kIGRvZXMgbm90IGdldCBhZGRlZCB0byB0aGUgZC50cyBmaWxlLgogKi8KY2xhc3MgQ2FiaW5ldFByb2plY3RvciB7CiAgzrEgPSAwOwogIM6yID0gMDsKICDOsyA9IDA7CgogIGNvbnN0cnVjdG9yKG94LCBveSwgc2NhbGUsIHBoaSkgewogICAgdGhpcy51cGRhdGUob3gsIG95LCBzY2FsZSwgcGhpKTsKICB9CgogIHNldFJvdGF0aW9uKHggPSAwLCB5ID0gMCwgeiA9IDApIHsKICAgIHRoaXMuzrEgPSB4OwogICAgdGhpcy7OsiA9IHo7CiAgICB0aGlzLs6zID0geTsKICB9CgogIHJvdGF0ZSh4LCB5LCB6KSB7CiAgICBsZXQgeyDOsSwgzrIsIM6zIH0gPSB0aGlzOwogICAgbGV0IGEgPSB4OwogICAgbGV0IGIgPSB5ICogY29zKM6xKSAtIHogKiBzaW4ozrEpOwogICAgbGV0IGMgPSB5ICogc2luKM6xKSArIHogKiBjb3MozrEpOwogICAgeCA9IGE7CiAgICB5ID0gYjsKICAgIHogPSBjOwogICAgYSA9IHggKiBjb3MozrIpICsgeiAqIHNpbijOsik7CiAgICBiID0geTsKICAgIGMgPSB4ICogLXNpbijOsikgKyB6ICogY29zKM6yKTsKICAgIHggPSBhOwogICAgeSA9IGI7CiAgICB6ID0gYzsKICAgIGEgPSB4ICogY29zKM6zKSAtIHkgKiBzaW4ozrMpOwogICAgYiA9IHggKiBzaW4ozrMpICsgeSAqIGNvcyjOsyk7CiAgICBjID0gejsKCiAgICByZXR1cm4gW2EsIGIsIGNdOwogIH0KCiAgdXBkYXRlKG94ID0gMCwgb3kgPSAwLCBzY2FsZSA9IDEsIHBoaSA9IC1QSSAvIDYpIHsKICAgIHRoaXMub2Zmc2V0ID0gbmV3IFBvaW50KG94LCBveSk7CiAgICB0aGlzLnNjYWxlID0gc2NhbGU7CiAgICB0aGlzLnBoaSA9IHBoaTsKICB9CgogIHByb2plY3QoeCwgeSwgeikgewogICAgY29uc3QgeyBvZmZzZXQsIHNjYWxlLCBwaGkgfSA9IHRoaXM7CiAgICB4ICo9IHNjYWxlOwogICAgeSAqPSBzY2FsZTsKICAgIHogKj0gc2NhbGU7CiAgICBbeCwgeSwgel0gPSB0aGlzLnJvdGF0ZSh4LCB5LCB6KTsKICAgIGNvbnN0IGEgPSB5LAogICAgICBiID0gLXosCiAgICAgIGMgPSAteCAvIDI7CgogICAgcmV0dXJuIFtvZmZzZXQueCArIGEgKyBjICogY29zKHBoaSksIG9mZnNldC55ICsgYiArIGMgKiBzaW4ocGhpKV07CiAgfQp9CgpsZXQgX19wcm9qZWN0b3IgPSBuZXcgQ2FiaW5ldFByb2plY3RvcigpOwo="),G=class extends h{static{f(this,"GraphicsElement")}handleAttributeChange(...e){}handleChildChanges(...e){}connectedCallback(){super.connectedCallback(),this.observer=new MutationObserver(e=>this.childNodeChange(e)),this.observer.observe(this,{childList:!0}),this.label=document.createElement("label"),this.title||(console.warn("<graphics-element> is missing a title attribute. Always caption your figures."),this.title=""),this.label.textContent=this.title,this.contentCache=[],P(this)?this.loadSource():new IntersectionObserver((e,t)=>e.forEach(r=>{r.isIntersecting&&(this.loadSource(),t.disconnect())}),{threshold:.1,rootMargin:`${window.innerHeight}px`}).observe(this)}childNodeChange(e){for(let t of e)this.contentCache.push(...t.addedNodes)}getStyle(){return`
:host([hidden]) { display: none; }
style { display: none; }
.top-title { display: flex; flex-direction: row; justify-content: space-between; }
canvas { touch-action: none; user-select: none; position: relative; z-index: 1; display: block; margin: auto; border-radius: 0; box-sizing: content-box !important; border: 1px solid lightgrey;
&.crisp { image-rendering: -moz-crisp-edges; image-rendering: -webkit-crisp-edges; image-rendering: pixelated; image-rendering: crisp-edges; }
&:focus { border: 1px solid red; }}
a { &.view-source { font-size: 60%; text-decoration: none;
&.plus { padding-left: 0.5em; }}}
button.reset { font-size: 0.5em; top: -0.35em; position: relative; }
label:not(:empty) { display: block; font-style: italic; font-size: 0.9em; text-align: right; padding-right: 1em; margin-top: 0.35em; }
`}async loadSource(e,t=this.width,r=this.height,i){if(!t&&!r&&(t=parseFloat(this.getAttribute("width")),r=parseFloat(this.getAttribute("height")),isNaN(t)&&(t=void 0),isNaN(r)&&(r=void 0)),!e)if(this.userCode)e=this.userCode;else{let o=this.getAttribute("src");if(o)e=await(await fetch(o)).text();else{let l=this.querySelector("graphics-source");l?e=l.textContent:e=`function setup() {
}
function draw() {
}
`}}if(this.userCode=e,!i)if(this.additionalSources)i=this.additionalSources;else{let o=this.querySelectorAll("source");i=await Promise.all(Array.from(o).map(l=>fetch(l.src).then(b=>b.text())))}this.additionalSources=i;let $=this.userCode;this.additionalSources.length>0&&($=this.loadAdditionalSources(this.userCode,this.additionalSources));let d=$.matchAll(/addSlider\(['"`](.*)['"`]/g),n=[];for(let o of d)n.push(o[1]),$=$.replace(o[0],o[0]+`, (v) => (${o[1]} = v)`);if(n.length&&($="let "+n.join(", ")+`;
`+$),$=$.replaceAll(/ from ['"].([^'"]+)['"]/g,` from "${Y(location.href)}/$1"`),$.includes("function setup()")||($=`function setup() {
}
`+$),!$.includes("setSize(")){let o="setSize();";t&&r&&(o=`setSize(${t}, ${r});`),$=$.replace("function setup() {",`function setup() {
  ${o}`)}import(`data:text/javascript;base64,${B(['"use strict";',`import { BSpline, Point, Circle, Vec2, Vector, Matrix, CSS_COLOR_MAP } from "${V}";`,`const __randomId = "${Date.now()}";`,q,$,"export { reset as start, __canvas as canvas, halt, highlight, __getDescription as getDescription }"].join(`
`))}`).then(async o=>{let{start:l,canvas:b,halt:E,highlight:u,getDescription:R}=o;this.canvas=b,this.halt=()=>E(),this.highlight=L=>u(L),this.render();let{width:m,height:g}=await l(this);console.log("removing desc div...");let A="graphics-element-description";this.querySelector(`.${A}`)?.remove(),this.querySelector("p")||this.handleGraphicsDescription(A,R),m&&g&&(this.style.width="",this.style.height="",this.width=m,this.height=g,this.setAttribute("width",m),this.setAttribute("height",g)),this.dispatchEvent(new CustomEvent("load")),this.onload&&this.onload()})}handleGraphicsDescription(e,t=()=>{}){try{let r=t();if(r){let i=new DocumentFragment,$=document.createElement("div");$.classList.add(e),i.append($),$.innerHTML=r,this.append($)}}catch(r){console.error(r)}}loadAdditionalSources(e,t){if(!t)return e;let r=new Array(t.length);return e+`
`+t.map((i,$)=>i.replace("function setup()",`function setup${$+1}()`).replace("function draw()",`function draw${$+1}()`)).join(`
`)+`
function __more_setup() { ${[...r].map((i,$)=>`if (typeof setup${$+1} !== \`undefined\`) setup${$+1}();`).join(`
`)} }
function __more_draw() { ${[...r].map((i,$)=>`if (typeof draw${$+1} !== \`undefined\`) draw${$+1}();`).join(`
`)} }
`}loadFromFunction(e){let t=e.toString();this.reset(t.substring(t.indexOf("{")+1,t.lastIndexOf("}")))}reset(e,t){this.halt&&this.halt(),this.crosslinked=!1,this.querySelector("button.remove-color")?.remove(),this.loadSource(e||this.userCode,this.width,this.height,t||this.additionalSources)}render(){super.render();let e=this._slot.parentNode;this.canvas&&e.insertBefore(this.canvas,this._slot),this.label&&e.insertBefore(this.label,this._slot);let t=document.createElement("div");t.classList.add("top-title");let r=document.createElement("span");r.classList.add("sources"),t.append(r);let i=document.createElement("button");i.classList.add("reset"),i.textContent=this.getAttribute("reset")||"reset",i.addEventListener("click",()=>this.reset()),t.append(i);let $=this.getAttribute("src");if($){let n=document.createElement("a");n.classList.add("view-source"),n.textContent=this.getAttribute("viewSource")||"view source",n.href=$,n.target="_blank",r.append(n)}let d=this.querySelectorAll("source");d.length&&d.forEach((n,a)=>{let{src:o}=n,l=document.createElement("a");l.classList.add("view-source","plus"),l.textContent=`[+${a+1}]`,l.href=o,l.target="_blank",r.append(l)}),this.label&&e.insertBefore(t,this.canvas),this.crossLink()}crossLink(){if(this.crossLinked)return;this.crossLinked=!0;let e=!1;if(this.querySelectorAll("p").forEach(t=>{t.querySelectorAll("*").forEach(r=>{if(!w.includes(r.tagName))return;e=!0;let i;r.classList.remove("calm"),r.addEventListener("pointerenter",()=>{i??=getComputedStyle(r)["-webkit-text-stroke-color"],this.highlight(i)}),r.addEventListener("pointerleave",()=>this.highlight(!1))})}),e){let t=document.createElement("button");t.textContent="remove colors",t.classList.add("remove-color"),t.addEventListener("click",()=>{this.querySelectorAll("p").forEach(r=>{r.querySelectorAll("*").forEach(i=>{w.includes(i.tagName)&&i.classList.add("calm")})}),t.remove()}),this.append(t)}}},U=class extends h{static{f(this,"GraphicsSource")}constructor(){super(),this.style.display="none"}};await h.register(G),await h.register(U);export{I as BSpline,H as CSS_COLOR_MAP,D as Circle,O as Matrix,p as Point,S as Vec2,N as Vector};
