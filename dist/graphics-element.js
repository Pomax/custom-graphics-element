<<<<<<< HEAD
<<<<<<< HEAD
var v=Object.defineProperty;var l=(n,e)=>v(n,"name",{value:e,configurable:!0});var T="registered as custom element";function y(n,e){console.warn(`missing implementation for ${e}(...data) in ${n.__proto__.constructor.name}`)}l(y,"NotImplemented");function G(n){return n.prototype.constructor.name.replace(/([A-Z])([a-z])/g,(e,x,t,$)=>{let r=`${x.toLowerCase()}${t}`;return $>0?`-${r}`:r})}l(G,"getElementTagName");var h=class extends HTMLElement{static{l(this,"CustomElement")}static register(e){if(!e[T]){let x=e.tagName||G(e);return customElements.define(x,e),e[T]=!0,customElements.whenDefined(x)}return Promise.resolve()}static get tagName(){return G(this)}constructor(e={}){super(),customElements.resolveScope||(customElements.resolveScope=function($){try{return $.getRootNode().host}catch(r){console.warn(r)}return window}),this._options=e;let x={childList:$=>{this.handleChildChanges(Array.from($.addedNodes),Array.from($.removedNodes)),this.render()},attributes:$=>{this.handleAttributeChange($.attributeName,$.oldValue,this.getAttribute($.attributeName)),this.render()}};this._observer=new MutationObserver($=>{this.isConnected&&$.forEach(r=>{x[r.type](r)})}),this._observer.observe(this,{childList:!0,attributes:!0});let t={mode:"open"};this._shadow=this.attachShadow(t),this._style=document.createElement("style"),this._style.textContent=this.getStyle(),this._options.header!==!1&&(this._header=document.createElement("header")),this._options.slot!==!1&&this._options.void!==!0&&(this._slot=document.createElement("slot")),this._options.footer!==!1&&(this._footer=document.createElement("footer"))}connectedCallback(){this.render()}handleChildChanges(e,x){this._options.void||y(this,"handleChildChanges")}handleAttributeChange(e,x,t){y(this,"handleAttributeChange")}getStyle(){return""}render(){this._shadow.innerHTML="",this._shadow.append(this._style),this._options.header!==!1&&this._shadow.append(this._header),this._options.slot!==!1&&this._shadow.append(this._slot),this._options.footer!==!1&&this._shadow.append(this._footer)}};var O=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREEN","DARKGREY","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREEN","GREENYELLOW","GREY","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREEN","LIGHTGREY","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TRANSPARENT","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN"],w={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(128, 128, 128)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",transparent:"rgba(0,0,0,0)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",ALICEBLUE:"rgb(240, 248, 255)",ANTIQUEWHITE:"rgb(250, 235, 215)",AQUA:"rgb(0, 255, 255)",AQUAMARINE:"rgb(127, 255, 212)",AZURE:"rgb(240, 255, 255)",BEIGE:"rgb(245, 245, 220)",BISQUE:"rgb(255, 228, 196)",BLACK:"rgb(0, 0, 0)",BLANCHEDALMOND:"rgb(255, 235, 205)",BLUE:"rgb(0, 0, 255)",BLUEVIOLET:"rgb(138, 43, 226)",BROWN:"rgb(165, 42, 42)",BURLYWOOD:"rgb(222, 184, 135)",CADETBLUE:"rgb(95, 158, 160)",CHARTREUSE:"rgb(127, 255, 0)",CHOCOLATE:"rgb(210, 105, 30)",CORAL:"rgb(255, 127, 80)",CORNFLOWERBLUE:"rgb(100, 149, 237)",CORNSILK:"rgb(255, 248, 220)",CRIMSON:"rgb(220, 20, 60)",CYAN:"rgb(0, 255, 255)",DARKBLUE:"rgb(0, 0, 139)",DARKCYAN:"rgb(0, 139, 139)",DARKGOLDENROD:"rgb(184, 134, 11)",DARKGRAY:"rgb(169, 169, 169)",DARKGREEN:"rgb(0, 100, 0)",DARKGREY:"rgb(169, 169, 169)",DARKKHAKI:"rgb(189, 183, 107)",DARKMAGENTA:"rgb(139, 0, 139)",DARKOLIVEGREEN:"rgb(85, 107, 47)",DARKORANGE:"rgb(255, 140, 0)",DARKORCHID:"rgb(153, 50, 204)",DARKRED:"rgb(139, 0, 0)",DARKSALMON:"rgb(233, 150, 122)",DARKSEAGREEN:"rgb(143, 188, 143)",DARKSLATEBLUE:"rgb(72, 61, 139)",DARKSLATEGRAY:"rgb(47, 79, 79)",DARKSLATEGREY:"rgb(47, 79, 79)",DARKTURQUOISE:"rgb(0, 206, 209)",DARKVIOLET:"rgb(148, 0, 211)",DEEPPINK:"rgb(255, 20, 147)",DEEPSKYBLUE:"rgb(0, 191, 255)",DIMGRAY:"rgb(105, 105, 105)",DIMGREY:"rgb(105, 105, 105)",DODGERBLUE:"rgb(30, 144, 255)",FIREBRICK:"rgb(178, 34, 34)",FLORALWHITE:"rgb(255, 250, 240)",FORESTGREEN:"rgb(34, 139, 34)",FUCHSIA:"rgb(255, 0, 255)",GAINSBORO:"rgb(220, 220, 220)",GHOSTWHITE:"rgb(248, 248, 255)",GOLD:"rgb(255, 215, 0)",GOLDENROD:"rgb(218, 165, 32)",GRAY:"rgb(128, 128, 128)",GREEN:"rgb(0, 128, 0)",GREENYELLOW:"rgb(173, 255, 47)",GREY:"rgb(128, 128, 128)",HONEYDEW:"rgb(240, 255, 240)",HOTPINK:"rgb(255, 105, 180)",INDIANRED:"rgb(205, 92, 92)",INDIGO:"rgb(75, 0, 130)",IVORY:"rgb(255, 255, 240)",KHAKI:"rgb(240, 230, 140)",LAVENDER:"rgb(230, 230, 250)",LAVENDERBLUSH:"rgb(255, 240, 245)",LAWNGREEN:"rgb(124, 252, 0)",LEMONCHIFFON:"rgb(255, 250, 205)",LIGHTBLUE:"rgb(173, 216, 230)",LIGHTCORAL:"rgb(240, 128, 128)",LIGHTCYAN:"rgb(224, 255, 255)",LIGHTGOLDENRODYELLOW:"rgb(250, 250, 210)",LIGHTGRAY:"rgb(211, 211, 211)",LIGHTGREEN:"rgb(144, 238, 144)",LIGHTGREY:"rgb(211, 211, 211)",LIGHTPINK:"rgb(255, 182, 193)",LIGHTSALMON:"rgb(255, 160, 122)",LIGHTSEAGREEN:"rgb(32, 178, 170)",LIGHTSKYBLUE:"rgb(135, 206, 250)",LIGHTSLATEGRAY:"rgb(119, 136, 153)",LIGHTSLATEGREY:"rgb(119, 136, 153)",LIGHTSTEELBLUE:"rgb(176, 196, 222)",LIGHTYELLOW:"rgb(255, 255, 224)",LIME:"rgb(0, 255, 0)",LIMEGREEN:"rgb(50, 205, 50)",LINEN:"rgb(250, 240, 230)",MAGENTA:"rgb(255, 0, 255)",MAROON:"rgb(128, 0, 0)",MEDIUMAQUAMARINE:"rgb(102, 205, 170)",MEDIUMBLUE:"rgb(0, 0, 205)",MEDIUMORCHID:"rgb(186, 85, 211)",MEDIUMPURPLE:"rgb(147, 112, 219)",MEDIUMSEAGREEN:"rgb(60, 179, 113)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",MEDIUMSPRINGGREEN:"rgb(0, 250, 154)",MEDIUMTURQUOISE:"rgb(72, 209, 204)",MEDIUMVIOLETRED:"rgb(199, 21, 133)",MIDNIGHTBLUE:"rgb(25, 25, 112)",MINTCREAM:"rgb(245, 255, 250)",MISTYROSE:"rgb(255, 228, 225)",MOCCASIN:"rgb(255, 228, 181)",NAVAJOWHITE:"rgb(255, 222, 173)",NAVY:"rgb(0, 0, 128)",OLDLACE:"rgb(253, 245, 230)",OLIVE:"rgb(128, 128, 0)",OLIVEDRAB:"rgb(107, 142, 35)",ORANGE:"rgb(255, 165, 0)",ORANGERED:"rgb(255, 69, 0)",ORCHID:"rgb(218, 112, 214)",PALEGOLDENROD:"rgb(238, 232, 170)",PALEGREEN:"rgb(152, 251, 152)",PALETURQUOISE:"rgb(175, 238, 238)",PALEVIOLETRED:"rgb(219, 112, 147)",PAPAYAWHIP:"rgb(255, 239, 213)",PEACHPUFF:"rgb(255, 218, 185)",PERU:"rgb(205, 133, 63)",PINK:"rgb(255, 192, 203)",PLUM:"rgb(221, 160, 221)",POWDERBLUE:"rgb(176, 224, 230)",PURPLE:"rgb(128, 0, 128)",REBECCAPURPLE:"rgb(102, 51, 153)",RED:"rgb(255, 0, 0)",ROSYBROWN:"rgb(188, 143, 143)",ROYALBLUE:"rgb(65, 105, 225)",SADDLEBROWN:"rgb(139, 69, 19)",SALMON:"rgb(250, 128, 114)",SANDYBROWN:"rgb(244, 164, 96)",SEAGREEN:"rgb(46, 139, 87)",SEASHELL:"rgb(255, 245, 238)",SIENNA:"rgb(160, 82, 45)",SILVER:"rgb(192, 192, 192)",SKYBLUE:"rgb(135, 206, 235)",SLATEBLUE:"rgb(106, 90, 205)",SLATEGRAY:"rgb(112, 128, 144)",SLATEGREY:"rgb(112, 128, 144)",SNOW:"rgb(255, 250, 250)",SPRINGGREEN:"rgb(0, 255, 127)",STEELBLUE:"rgb(70, 130, 180)",TAN:"rgb(210, 180, 140)",TEAL:"rgb(0, 128, 128)",THISTLE:"rgb(216, 191, 216)",TOMATO:"rgb(255, 99, 71)",TRANSPARENT:"rgba(0,0,0,0)",TURQUOISE:"rgb(64, 224, 208)",VIOLET:"rgb(238, 130, 238)",WHEAT:"rgb(245, 222, 179)",WHITE:"rgb(255, 255, 255)",WHITESMOKE:"rgb(245, 245, 245)",YELLOW:"rgb(255, 255, 0)",YELLOWGREEN:"rgb(154, 205, 50)"};function S(n,e,x,t,$,m,E){var i,s,f,a,o=x.length,g=x[0].length;if(e<1)throw new Error("degree must be at least 1 (linear)");if(e>o-1)throw new Error("degree must be less than or equal to point count - 1");if(!$)for($=[],i=0;i<o;i++)$[i]=1;if($.length<x.length&&($=$.concat($.slice(0,e))),t){if(t.length!==o+e+1)throw new Error("bad knot vector length")}else{var t=[];for(i=0;i<o+e+1;i++)t[i]=i}t.length===x.length&&(t=t.concat(t.slice(0,e)));var d=[e,t.length-1-e],A=t[d[0]],p=t[d[1]];if(E||(n=n*(p-A)+A),n<A||n>p)throw new Error("out of bounds");for(f=d[0];f<d[1]&&!(n>=t[f]&&n<=t[f+1]);f++);var b=[];for(i=0;i<o;i++){for(b[i]=[],s=0;s<g;s++)b[i][s]=x[i][s]*$[i];b[i][g]=$[i]}var u;for(a=1;a<=e+1;a++)for(i=f;i>f-e-1+a;i--)for(u=(n-t[i])/(t[i+e+1-a]-t[i]),s=0;s<g+1;s++)b[i][s]=(1-u)*b[i-1][s]+u*b[i][s];var m=m||[];for(i=0;i<g;i++)m[i]=b[f][i]/b[f][g];return m}l(S,"interpolate");var c=3,L=class{static{l(this,"BSpline")}constructor(e,x=!0){this.points=e,this.points=e.map(t=>t instanceof Array?t:[t.x,t.y]),this.formKnots(x),this.formWeights()}getLUT(e=100){let x=e-1;return[...new Array(e)].map((t,$)=>{let r=S($/x,c,this.points,this.knots,this.weights);return{x:r[0],y:r[1]}})}formKnots(e=!1){if(!e)return this.formUniformKnots();let x=[],t=this.points.length,$=t-c;for(let r=1;r<t-c;r++)x.push(r+c);for(let r=0;r<=c;r++)x=[c].concat(x);for(let r=0;r<=c;r++)x.push($+c);return this.knots=x}formUniformKnots(){return this.knots=[...new Array(this.points.length+c+1)].map((e,x)=>x)}formWeights(){return this.weights=this.points.map(e=>1)}};function I(n){let e=new TextEncoder().encode(n),x=String.fromCodePoint(...e);return btoa(x)}l(I,"base64");function U(n){let e=atob(n),x=Uint8Array.from(e,t=>t.codePointAt(0));return new TextDecoder().decode(x)}l(U,"decode64");function C(n){let e=/^(.*)\/([^.]+(\.([^\/?#]+))+)(\?[^#]*)?(#.*)?$/,x=n.match(e);if(x!==null){let{[1]:t,[2]:$,[4]:r}=x;n=t}return n}l(C,"getURLbase");function M(n){if(typeof window>"u"||typeof document>"u")return!0;var e=n.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}l(M,"isInViewport");var k=String(import.meta.url),B=U("Y29uc3QgQUxQSEFCRVRJQyA9IGBhbHBoYWJldGljYDsKY29uc3QgQVVUTyA9IGBhdXRvYDsKY29uc3QgQk9UVE9NID0gYGJvdHRvbWA7CmNvbnN0IEJPVFRPTV9MRUZUID0gYGJvdHRvbi1sZWZ0YDsKY29uc3QgQk9UVE9NX1JJR0hUID0gYGJvdHRvbS1yaWdodGA7CmNvbnN0IENFTlRFUiA9IGBjZW50ZXJgOwpjb25zdCBDT05TVFJBSU4gPSB0cnVlOwpjb25zdCBDUk9TUyA9IGBjcm9zc2hhaXJgOwpjb25zdCBFTkQgPSBgZW5kYDsKY29uc3QgSEFORCA9IGBwb2ludGVyYDsKY29uc3QgSEFOR0lORyA9IGBoYW5naW5nYDsKY29uc3QgSURFT0dSQVBISUMgPSBgaWRlb2dyYXBoaWNgOwpjb25zdCBMRUZUID0gYGxlZnRgOwpjb25zdCBNSURETEUgPSBgbWlkZGxlYDsKY29uc3QgUE9JTlRFUiA9IGBkZWZhdWx0YDsKY29uc3QgUklHSFQgPSBgcmlnaHRgOwpjb25zdCBTVEFSVCA9IGBzdGFydGA7CmNvbnN0IFRPUCA9IGB0b3BgOwpjb25zdCBUT1BfTEVGVCA9IGB0b3AtbGVmdGA7CmNvbnN0IFRPUF9SSUdIVCA9IGB0b3AtcmlnaHRgOwoKLy8gImludGVybmFsIiB2YXJzCgpsZXQgX19jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBjYW52YXNgKTsKX19jYW52YXMudGFiSW5kZXggPSAwOwpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBwb2ludGVyZG93bmAsICgpID0+IF9fY2FudmFzLmZvY3VzKCkpOwpsZXQgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwoKbGV0IF9fY3VycmVudF9jdXJzb3I7CmxldCBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19jdXJyZW50X2h1ZTsKbGV0IF9fZHJhd19ncmlkOwpsZXQgX19kcmF3aW5nOwpsZXQgX19lbGVtZW50OwpsZXQgX19maW5pc2hlZF9zZXR1cDsKbGV0IF9fZmlyc3Q7CmxldCBfX2ZvbnQ7CmxldCBfX2dyaWRfY29sb3I7CmxldCBfX2dyaWRfc3BhY2luZzsKbGV0IF9faGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19sYXN0X2ZyYW1lOwpsZXQgX19tb3ZhYmxlX3BvaW50czsKbGV0IF9fcmVkcmF3aW5nOwpsZXQgX19zaGFwZTsKbGV0IF9fc3RhcnRfdGltZTsKbGV0IF9fc3R5bGVfc3RhY2s7CmxldCBfX3RleHRTdHJva2U7Cgpjb25zdCBfX3BybmcgPSBuZXcgKGNsYXNzIHsKICBjb25zdHJ1Y3RvcihzZWVkID0gRGF0ZS5ub3coKSkgewogICAgdGhpcy5hID0gc2VlZDsKICB9CiAgcmVzZWVkKHNlZWQpIHsKICAgIHRoaXMuYSA9IHNlZWQ7CiAgfQogIG5leHQoKSB7CiAgICAvLyBTcGxpdE1peDMyLCBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDc1OTMzMTYvNzQwNTUzCiAgICBsZXQgeyBhIH0gPSB0aGlzOwogICAgYSB8PSAwOwogICAgYSA9IChhICsgMHg5ZTM3NzliOSkgfCAwOwogICAgbGV0IHQgPSBhIF4gKGEgPj4+IDE2KTsKICAgIHQgPSBNYXRoLmltdWwodCwgMHgyMWYwYWFhZCk7CiAgICB0ID0gdCBeICh0ID4+PiAxNSk7CiAgICB0ID0gTWF0aC5pbXVsKHQsIDB4NzM1YTJkOTcpOwogICAgdGhpcy5hID0gYTsKICAgIHJldHVybiAoKHQgPSB0IF4gKHQgPj4+IDE1KSkgPj4+IDApIC8gNDI5NDk2NzI5NjsKICB9Cn0pKCk7Cgphc3luYyBmdW5jdGlvbiByZXNldChlbGVtZW50ID0gX19lbGVtZW50KSB7CiAgX19lbGVtZW50ID0gZWxlbWVudDsKCiAgLy8gZGVmYXVsdCB2YXJpYWJsZSB2YWx1ZXMKICBfX2N1cnJlbnRfY3Vyc29yID0gYGF1dG9gOwogIF9fY3VycmVudF9oaWdobGlnaHRfY29sb3IgPSBgcmdiKDAsMjU0LDEyNClgOwogIF9fY3VycmVudF9odWUgPSAwOwogIF9fZHJhd19ncmlkID0gdHJ1ZTsKICBfX2RyYXdpbmcgPSBmYWxzZTsKICBfX2ZpbmlzaGVkX3NldHVwID0gZmFsc2U7CiAgX19mb250ID0geyBmYW1pbHk6IGBzYW5zLXNlcmlmYCwgc2l6ZTogMTYsIHdlaWdodDogNDAwIH07CiAgX19ncmlkX2NvbG9yID0gYGxpZ2h0Z3JleWA7CiAgX19ncmlkX3NwYWNpbmcgPSAyMDsKICBfX2hpZ2hsaWdodF9jb2xvciA9IGZhbHNlOwogIF9fbW92YWJsZV9wb2ludHMgPSBbXTsKICBfX3JlZHJhd2luZyA9IGZhbHNlOwogIF9fc2hhcGUgPSB1bmRlZmluZWQ7CiAgX19zdGFydF90aW1lID0gRGF0ZS5ub3coKTsKICBfX3N0eWxlX3N0YWNrID0gW107CiAgX190ZXh0U3Ryb2tlID0gYHRyYW5zcGFyZW50YDsKCiAgY3VycmVudE1vdmFibGUgPSBmYWxzZTsKICBwbGF5aW5nID0gZmFsc2U7CiAgZnJhbWUgPSAwOwogIHBvaW50ZXIueCA9IDA7CiAgcG9pbnRlci55ID0gMDsKICBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhrZXlib2FyZCkuZm9yRWFjaCgobikgPT4gZGVsZXRlIGtleWJvYXJkW25dKTsKCiAgLy8gbWFrZSBzdXJlIHdlIGRvbid0IGRvdWJsZS1nZW5lcmF0ZSB0aGVzZToKICBjbGVhclNsaWRlcnMoKTsKICBjbGVhckJ1dHRvbnMoKTsKCiAgLy8gcnVuIHNldHVwCiAgYXdhaXQgX19zZXR1cCgpOwogIF9fZmluaXNoZWRfc2V0dXAgPSB0cnVlOwoKICAvLyBydW4gZmlyc3QgZHJhdwogIF9fbGFzdF9mcmFtZSA9IERhdGUubm93KCk7CiAgYXdhaXQgX19kcmF3KCk7CgogIHJldHVybiB7IHdpZHRoLCBoZWlnaHQgfTsKfQoKZnVuY3Rpb24gaGFsdCgpIHsKICBwbGF5aW5nID0gZmFsc2U7CiAgX19jYW52YXMgPSB1bmRlZmluZWQ7CiAgX19jdHggPSB1bmRlZmluZWQ7CiAgX19maW5pc2hlZF9zZXR1cCA9IGZhbHNlOwogIF9fZHJhd2luZyA9IHRydWU7CiAgX19yZWRyYXdpbmcgPSB0cnVlOwogIF9fZmlyc3QgPSB1bmRlZmluZWQ7CiAgX19tb3ZhYmxlX3BvaW50cyA9IHVuZGVmaW5lZDsKICBfX2N1cnJlbnRfY3Vyc29yID0gdW5kZWZpbmVkOwogIF9fY3VycmVudF9odWUgPSAwOwogIF9fZm9udCA9IHVuZGVmaW5lZDsKICBfX3N0YXJ0X3RpbWUgPSAwOwogIGNsZWFyU2xpZGVycygpOwogIGNsZWFyQnV0dG9ucygpOwp9CgpmdW5jdGlvbiBfX2dldERlc2NyaXB0aW9uKCkgewogIGlmICh0eXBlb2YgZ2V0RGVzY3JpcHRpb24gIT09IGB1bmRlZmluZWRgKSByZXR1cm4gZ2V0RGVzY3JpcHRpb24oKTsKfQoKYXN5bmMgZnVuY3Rpb24gX19zZXR1cCgpIHsKICBpZiAodHlwZW9mIHNldHVwICE9PSBgdW5kZWZpbmVkYCkgYXdhaXQgc2V0dXAoKTsKICBpZiAodHlwZW9mIF9fbW9yZV9zZXR1cCAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IF9fbW9yZV9zZXR1cCgpOwogIGlmICghd2lkdGggJiYgIWhlaWdodCkgc2V0U2l6ZSgpOwp9Cgphc3luYyBmdW5jdGlvbiBfX2RyYXcoKSB7CiAgaWYgKCFfX2ZpbmlzaGVkX3NldHVwKSByZXR1cm47CiAgaWYgKCFfX2RyYXdpbmcpIHsKICAgIF9fZHJhd2luZyA9IHRydWU7CiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogICAgZnJhbWVEZWx0YSA9IG5vdyAtIF9fbGFzdF9mcmFtZTsKICAgIGZyYW1lKys7CiAgICByZXNldFRyYW5zZm9ybSgpOwogICAgaWYgKHR5cGVvZiBkcmF3ICE9PSBgdW5kZWZpbmVkYCkgYXdhaXQgZHJhdygpOwogICAgaWYgKHR5cGVvZiBfX21vcmVfZHJhdyAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IF9fbW9yZV9kcmF3KCk7CiAgICBfX2RyYXdpbmcgPSBmYWxzZTsKICAgIF9fbGFzdF9mcmFtZSA9IG5vdzsKICAgIGlmIChwbGF5aW5nKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gX19kcmF3KCkpOwogIH0KfQovKioKICogVGhlIGN1cnJlbnQgZnJhbWUgbnVtYmVyCiAqCiAqIEBjb25zdGFudCB7bnVtYmVyfQogKi8KbGV0IGZyYW1lID0gMDsKCi8qKgogKiBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZSB0aGUgbGFzdCBmcmFtZS4KICoKICogQGNvbnN0YW50IHtudW1iZXJ9CiAqLwpsZXQgZnJhbWVEZWx0YSA9IDA7CgovKioKICogVGhlIGhlaWdodCBvZiB0aGUgY2FudmFzIGluIHBpeGVscwogKgogKiBAY29uc3RhbnQge251bWJlcn0KICovCmxldCBoZWlnaHQgPSAwOwoKLyoqCiAqIFRoZSB3aWR0aCBvZiB0aGUgY2FudmFzIGluIHBpeGVscwogKgogKiBAY29uc3RhbnQge251bWJlcn0KICovCmxldCB3aWR0aCA9IDA7CgovKioKICogVGhlIGN1cnJlbnQgcGxheSBzdGF0ZQogKgogKiBAY29uc3RhbnQge2Jvb2xlYW59CiAqLwpsZXQgcGxheWluZyA9IGZhbHNlOwoKLyoqCiAqIFRoZSBgcG9pbnRlcmAgb2JqZWN0IHJlcHJlc2VudHMgdGhlIG1vdXNlIGN1cnNvciAod2hlbiB1c2luZwogKiBhIG1vdXNlKSBvciBmaW5nZXIgcG9zaXRpb24gKGZvciB0b3VjaCBkZXZpY2VzKSwgYW5kIG1vZGVscwogKiBzZXZlcmFsIGFzcGVjdHM6CiAqCiAqIC0gYGFjdGl2ZWAgKGJvb2xlYW4pIFdoZXRoZXIgdGhlIHBvaW50ZXIgaXMgZXZlbiBvbiBvciBvdmVyIHRoZSBjYW52YXMuCiAqIC0gYHhgIChudW1iZXIpIFRoZSBwb2ludGVyJ3MgeCBvZmZzZXQgaW4gcGl4ZWxzIHdpdGggcmVzcGVjdCB0byB0aGUgY2FudmFzCiAqIC0gYHlgIChudW1iZXIpIFRoZSBwb2ludGVyJ3MgeSBvZmZzZXQgaW4gcGl4ZWxzIHdpdGggcmVzcGVjdCB0byB0aGUgY2FudmFzCiAqIC0gYGRvd25gIChib29sZWFuKSBXaGV0aGVyIHRoZSBwb2ludGVyIGlzICJlbmdhZ2VkIiBvciBub3QKICogLSBgZHJhZ2AgKGJvb2xlYW4pIFdoZXRoZXIgYSBjbGljay90b3VjaC1kcmFnIGlzIGluIHByb2dyZXNzCiAqIC0gYG1hcmtgICh7eCx5fSkgV2hlbiBkcmFnZ2luZywgdGhpcyByZXByZXNlbnRzIHRoZSBvcmlnaW5hbCBjb29yZGluYXRlIG9mIHRoZSBwb2ludGVyICJkb3duIiBldmVudAogKgogKiBAY29uc3RhbnQge29iamVjdH0KICovCmNvbnN0IHBvaW50ZXIgPSB7IHg6IDAsIHk6IDAgfTsKCi8qKgogKiBJZiBhbnkgcG9pbnRzIHdlcmUgcmVnaXN0ZXJlZCBhcyBtb3ZhYmxlLCBhbmQgdGhlIHBvaW50ZXIgaXMKICogbmVhciBlbm91Z2ggdG8gYSBtb3ZhYmxlIHBvaW50LCB0aGlzIHZhbHVlIHdpbGwgcG9pbnQgdG8KICogdGhhdCBtb3ZhYmxlIHBvaW50LCBvciBgZmFsc2VgIGlmIHRoZSBwb2ludGVyIGlzIG5vdCBuZWFyCiAqIGFueSBtb3ZhYmxlIHBvaW50IChvciwgb2YgY291cnNlLCB0aGVyZSBhcmUgbm8gbW92YWJsZSBwb2ludHMpCiAqCiAqIEBjb25zdGFudCB7UG9pbnRMaWtlfGZhbHNlfQogKi8KbGV0IGN1cnJlbnRNb3ZhYmxlID0gZmFsc2U7CgovKioKICogVGhlIGBrZXlib2FyZGAgb2JqZWN0IGlzIGEgdHJ1dGggdGFibGUgdGhhdCBjYW4gYmUgY2hlY2tlZCB0bwogKiBzZWUgaWYgYW55IGtleSBpcyBjdXJyZW50bHkgcHJlc3NlZCwgYW5kIGlmIHNvLCB3aGVuIHRoYXQKICoga2V5cHJlc3Mgd2FzIGluaXRpYXRlZCwgYnkgc3RvcmluZzoKICoKICogYGBgCiAqIHsKICogICBba2V5OnN0cmluZ106IGRhdGV0aW1lCiAqIH0KICogYGBgCiAqCiAqIFdoZW4gYSBrZXkgaXMgcmVsZWFzZWQsIGl0cyBtYXBwaW5nIGlzIHJlbW92ZWQgZW50aXJlbHksCiAqIHJhdGhlciB0aGFuIGl0IGJlaW5nIHNldCB0byBhIGZhbHNleSB2YWx1ZS4KICoKICogQGNvbnN0YW50IHtvYmplY3R9CiAqLwpjb25zdCBrZXlib2FyZCA9IHt9OwoKLy8gY29uc3RhbnRzLi4uCmNvbnN0IHsKICAvKioKICAgKiBUaGUgcmF0aW8gb2YgYSBjaXJjbGUncyBjaXJjdW1mZXJlbmNlIHRvIGl0cyBkaWFtZXRlci4KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9QaQogICAqCiAgICogQGNvbnN0YW50IHtudW1iZXJ9CiAgICoKICAgKiBAc2VlIHtAbGluayBUQVV9CiAgICovCiAgUEksCgogIC8qKgogICAqIFRoZSBiYXNlIGZvciB0aGUgbmF0dXJhbCBsb2dhcml0aG0uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRV8obWF0aGVtYXRpY2FsX2NvbnN0YW50KQogICAqCiAgICogQGNvbnN0YW50IHtudW1iZXJ9CiAgICovCiAgRSwKfSA9IE1hdGg7Cgpjb25zdCB7CiAgLyoqCiAgICogQSB2ZXJ5IHNtYWxsIHZhbHVlIGZvciBwZXJmb3JtaW5nIGltcHJlY2lzZSBtYXRoIG9wZXJhdGlvbnMKICAgKiBzdWNoIGFzIGNoZWNraW5nIHdoZXRoZXIgYSB2YWx1ZSBpcyBhcHByb3hpbWF0ZWx5IHRoZSBzYW1lCiAgICogYXMgc29tZSBvdGhlciB2YWx1ZS4KICAgKgogICAqIEBjb25zdGFudCB7bnVtYmVyfQogICAqLwogIGVwc2lsb24sCgogIC8qKgogICAqIEEgdmVyeSBsYXJnZSB2YWx1ZSB0aGF0IGNhbiBzdGlsbCBiZSB1c2VkIHRvIGRyYXcgdGhpbmdzCiAgICogb24gdGhlIGNhbnZhcyAoc3VjaCBhcyBsaW5lcyBmcm9tIC1odWdlIHRvICtodWdlKS4KICAgKgogICAqIEBjb25zdGFudCB7bnVtYmVyfQogICAqLwogIGh1Z2UsCgogIC8qKgogICAqIFRoZSByYXRpbyBvZiBhIGNpcmNsZSdzIGNpcmN1bWZlcmVuY2UgdG8gaXRzIHJhZGl1cywgaS5lLiAyKlBJCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVHVybl8oYW5nbGUpI1RhdV9wcm9wb3NhbHMKICAgKgogICAqIEBjb25zdGFudCB7bnVtYmVyfQogICAqCiAgICogQHNlZSB7QGxpbmsgUEl9CiAgICovCiAgVEFVLAp9ID0geyBlcHNpbG9uOiAxZS0xMCwgaHVnZTogMV8wMDBfMDAwLCBUQVU6IFBJICogMiB9OwovKioKICogRW5zdXJlIHRoYXQgdGhlcmUgaXMgbm8gYm9yZGVyIGFyb3VuZCB0aGUgY2FudmFzIGVsZW1lbnQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEJvcmRlcig1LCBgcmVkYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgdGV4dChgY2xpY2sgbWVgLCB3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyVXAoeCwgeSkgewogKiAgICAgICBzZXRCb3JkZXIoNSwgYHJlZGApOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCwgeSkgewogKiAgICAgICBub0JvcmRlcigpOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldEJvcmRlcn0KICovCmZ1bmN0aW9uIG5vQm9yZGVyKCkgewogIHNldEJvcmRlcihmYWxzZSk7Cn0KCi8qKgogKiBEaXNhYmxlIGJvdGggc3Ryb2tlIGFuZCBmaWxsIGNvbG9yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoYE5vdyB5b3Ugc2VlIG1lYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vQ29sb3IoKTsKICogICAgICAgdGV4dChgTm93IHlvdSBkb24ndGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldENvbG9yfQogKiBAc2VlIHtAbGluayBub1N0cm9rZX0KICogQHNlZSB7QGxpbmsgbm9GaWxsfQogKi8KZnVuY3Rpb24gbm9Db2xvcigpIHsKICBub0ZpbGwoKTsKICBub1N0cm9rZSgpOwp9CgovKioKICogSGlkZSB0aGUgY3Vyc29yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGAjRkYwMmApOwogKiAgICAgICByZWN0KDAsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIHNldENvbG9yKGAjMEZGMmApOwogKiAgICAgICByZWN0KHdpZHRoLzIsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSh4LCB5KSB7CiAqICAgICAgIGlmICh4IDwgd2lkdGgvMikgewogKiAgICAgICAgIHNldEN1cnNvcihBVVRPKTsKICogICAgICAgfSBlbHNlIHsKICogICAgICAgICBub0N1cnNvcigpOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2V0Q3Vyc29yfQogKi8KZnVuY3Rpb24gbm9DdXJzb3IoKSB7CiAgX19jYW52YXMuc3R5bGUuY3Vyc29yID0gYG5vbmVgOwp9CgovKioKICogRGlzYWJsZSB0aGUgZmlsbCBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICByZWN0KDIwLCA3MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgZmlsbGVkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICByZWN0KDMwLCA4MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgbm90IGZpbGxlZGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldEZpbGx9CiAqLwpmdW5jdGlvbiBub0ZpbGwoKSB7CiAgc2V0RmlsbChgdHJhbnNwYXJlbnRgKTsKfQoKLyoqCiAqIERpc2FibGUgdGhlIGRlZmF1bHQgZ3JpZCBiYWNrZ3JvdW5kLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoYGNsaWNrIG1lYCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlclVwKHgsIHkpIHsKICogICAgICAgc2V0R3JpZCgyMCwgYGxpZ2h0Z3JleWApOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCwgeSkgewogKiAgICAgICBub0dyaWQoKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRHcmlkfQogKi8KZnVuY3Rpb24gbm9HcmlkKCkgewogIF9fZHJhd19ncmlkID0gZmFsc2U7Cn0KCi8qKgogKiBTZXQgdGhlIGxpbmUgc3Ryb2tlIHRvICJzb2xpZCIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldExpbmVEYXNoKDEpOwogKiAgICAgICBsaW5lKDAsMjAsd2lkdGgsNTApOwogKiAgICAgICBzZXRMaW5lRGFzaCg1KTsKICogICAgICAgbGluZSgwLDMwLHdpZHRoLDkwKTsKICogICAgICAgc2V0TGluZURhc2goMSwyLDMsNCk7CiAqICAgICAgIGxpbmUoMCw0MCx3aWR0aCwxMzApOwogKiAgICAgICBub0xpbmVEYXNoKCk7CiAqICAgICAgIGxpbmUoMCw1MCx3aWR0aCwxODApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldExpbmVEYXNofQogKi8KCmZ1bmN0aW9uIG5vTGluZURhc2goKSB7CiAgX19jdHguc2V0TGluZURhc2goW10pOwp9CgovKioKICogRGlzYWJsZSB0aGUgc3Ryb2tlIGNvbG9yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dFN0cm9rZSgxKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHJlY3QoMjAsIDcwLCAyMCwgMjApOwogKiAgICAgICB0ZXh0KGBzdHJva2VkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vU3Ryb2tlKCk7CiAqICAgICAgIHJlY3QoNDIsIDgyLCAyMCwgMjApOwogKiAgICAgICB0ZXh0KGBub3Qgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldFN0cm9rZX0KICovCgpmdW5jdGlvbiBub1N0cm9rZSgpIHsKICBzZXRTdHJva2UoYHRyYW5zcGFyZW50YCk7Cn0KCi8qKgogKiBEaXNhYmxlIHRleHQgc3Ryb2tpbmcsIGJ1dCBub3QgcmVndWxhciBzaGFwZSBzdHJva2luZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICByZWN0KDIwLCA3MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub1RleHRTdHJva2UoKTsKICogICAgICAgcmVjdCg0MiwgODIsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYG5vdCBzdHJva2VkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgKyAyNSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2V0VGV4dFN0cm9rZX0KICovCgpmdW5jdGlvbiBub1RleHRTdHJva2UoKSB7CiAgc2V0VGV4dFN0cm9rZShmYWxzZSwgdW5kZWZpbmVkKTsKfQovKioKICogQWRkIGEgc2xpZGVyIHRvIHlvdXIgZmlndXJlLCBhbGxvd2luZyB1c2VycyB0byBjb250cm9sCiAqIGEgdmFyaWFibGUgaW4geW91ciBncmFwaGljcyBjb2RlIGRpcmVjdGx5IGJ5IGludGVyYWN0aW5nCiAqIHdpdGggdGhhdCBvbi1wYWdlIHNsaWRlciwgd2hpY2ggaXMgZXNwZWNpYWxseSBpbXBvcnRhbnQgaWYKICogeW91IHdhbnQgeW91ciBncmFwaGljcyB0byBiZSB1c2VhYmxlIGJ5IHVzZXJzIHdobyBkb24ndAogKiBoYXZlLCBvciBjYW5ub3QgdXNlLCBhIG1vdXNlLgogKgogKiBUaGUgYHByb3BMYWJlbGAgdmFsdWUgc2hvdWxkIGJlIHRoZSBuYW1lIG9mIHRoZSB2YXJpYWJsZQogKiB0aGF0IHlvdXIgZ3JhcGhpY3MgY29kZSB1c2VzLCBhbmQgc2hvdWxkIF9ub3RfIGJlICJwcmVhbGxvY2F0ZWQiCiAqIGluIHlvdXIgY29kZSB3aXRoIGEgY29uc3QsIGxldCwgb3IgdmFyOiBpdCB3aWxsIGF1dG9tYXRpY2FsbHkKICogZ2V0IGFkZGVkIGFzIHBhcnQgb2YgdGhlIHNvdXJjZSBsb2FkaW5nIHByb2Nlc3MuCiAqCiAqIFRoZSBvcHRpb25zIG9iamVjdCBhY2NlcHRzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllcyBhbmQgdmFsdWVzOgogKgogKiAtIG1pbiAtIHRoZSBzbGlkZXIncyBtaW5pbXVtIHZhbHVlLCBkZWZhdWx0cyB0byAwCiAqIC0gbWF4IC0gdGhlIHNsaWRlcidzIG1heGltdW0gdmFsdWUsIGRlZmF1bHRzIHRvIDEKICogLSBzdGVwIC0gdGhlIHN0ZXAgc2l6ZSwgZGVmYXVsdHMgdG8gKG1heCAtIG1pbikvMTAKICogLSB2YWx1ZSAtIHRoZSBpbml0aWFsIHZhbHVlLCBkZWZhdWx0cyB0byAobWF4ICsgbWluKS8yCiAqIC0gY2xhc3NlcyAtIHRoZSBDU1MgY2xhc3NlcyB0aGF0IHdpbGwgYmUgdXNlZCwgZGVmYXVsdHMgdG8gYCJzbGlkZXIiYAogKiAtIHRyYW5zZm9ybSAtIGEgdmFsdWUgcHJlcHJvY2Vzc29yICBkZWZhdWx0cyB0byAodikgPT4gdgogKgogKiBUaGUgYHRyYW5zZm9ybWAgcHJlLXByb2Nlc3NvciBydW5zIGFmdGVyIHRoZSB1c2VyIHVwZGF0ZXMKICogdGhlIHNsaWRlciwgYnV0IGJlZm9yZSBpdHMgdmFsdWUgZ2V0cyBhc3NpZ25lZCB0byB5b3VyIHZhcmlhYmxlLAogKiBzbyB0aGF0IHlvdSBjYW4gbWFwIGl0IHRvIHNvbWV0aGluZyBlbHNlIChmb3IgaW5zdGFuY2UsIG51bWJlcnMKICogaW4gb25lIHJhbmdlIHRvIG51bWJlcnMgaW4gYSBjb21wbGV0ZWx5IGRpZmZlcmVudCByYW5nZSwgb3IgZXZlbgogKiBudW1iZXJzIHRvIHN0cmluZ3Mgb3IgZW50aXJlIG9iamVjdHMpCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSg0MDAsIDIwMCk7CiAqICAgICAgIGFkZFNsaWRlcihgYmdDb2xvcmAsIHsKICogICAgICAgICBtaW46IDAsCiAqICAgICAgICAgbWF4OiAyNTUsCiAqICAgICAgICAgc3RlcDogMSwKICogICAgICAgICB2YWx1ZTogMjAwLAogKiAgICAgICAgIHRyYW5zZm9ybTogKHYpID0+IHsKICogICAgICAgICAgIC8vIGNvbnZlcnQgdiBpbnRvIGEgaGV4IGNvbG9yIGNvZGUKICogICAgICAgICAgIHYgPSAodikudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsIGAwYCk7CiAqICAgICAgICAgICByZXR1cm4gYCMke3Z9JHt2fSR7dn1gOwogKiAgICAgICAgIH0KICogICAgICAgfSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihiZ0NvbG9yKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gdmFyTmFtZSBUaGUgbmFtZSBmb3IgdGhlIHZhcmlhYmxlIHRoaXMgc2xpZGVyIGdldHMgdGllZCB0by4KICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgU2VlIGRlc2NyaXB0aW9uCiAqIEByZXR1cm5zIHtIVE1MSW5wdXRFbGVtZW50fSB0aGUgSFRNTCBpbnB1dCBlbGVtZW50IGZvciB0aGlzIHNsaWRlcgogKgogKiBAc2VlIHtAbGluayBjbGVhclNsaWRlcnN9CiAqLwpmdW5jdGlvbiBhZGRTbGlkZXIocHJvcExhYmVsLCBhc3NpZ24sIG9wdGlvbnMgPSB7fSkgewogIGxldCB7CiAgICBtaW4sCiAgICBtYXgsCiAgICBzdGVwLAogICAgdmFsdWUsCiAgICBjbGFzc2VzID0gYHNsaWRlcmAsCiAgICB0cmFuc2Zvcm0gPSAodikgPT4gdiwKICB9ID0gb3B0aW9uczsKCiAgbWluID0gbWluID09PSB1bmRlZmluZWQgPyAwIDogbWluOwogIG1heCA9IG1heCA9PT0gdW5kZWZpbmVkID8gMSA6IG1heDsKICBzdGVwID0gc3RlcCA9PT0gdW5kZWZpbmVkID8gKG1heCAtIG1pbikgLyAxMCA6IHN0ZXA7CiAgdmFsdWUgPSB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gKG1heCArIG1pbikgLyAyIDogdmFsdWU7CgogIC8vIGN1c3RvbSAicm91bmRpbmciLCBwdXJlbHkgZm9yIHN0cmluZ3MKICBjb25zdCByb3VuZCA9ICh2LCBkID0gNCkgPT4gewogICAgdiA9IGAke3Z9YDsKICAgIGNvbnN0IGZzID0gdi5pbmRleE9mKGAuYCk7CiAgICBpZiAoZnMgIT09IC0xKSB7CiAgICAgIGxldCBwcmVjID0gZCAtIGZzID4gMCA/IGQgLSBmcyA6IDA7CiAgICAgIHYgPSB2LnN1YnN0cmluZygwLCBmcyArIHByZWMpOwogICAgfQogICAgcmV0dXJuIHY7CiAgfTsKCiAgY29uc3QgY3JlYXRlID0gKHRhZykgPT4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOwoKICBsZXQgc2xpZGVyID0gY3JlYXRlKGBpbnB1dGApOwogIHNsaWRlci50eXBlID0gYHJhbmdlYDsKICBzbGlkZXIubWluID0gbWluOwogIHNsaWRlci5tYXggPSBtYXg7CiAgc2xpZGVyLnN0ZXAgPSBzdGVwOwogIHNsaWRlci5zZXRBdHRyaWJ1dGUoYHZhbHVlYCwgdmFsdWUpOwogIHNsaWRlci5zZXRBdHRyaWJ1dGUoYGNsYXNzYCwgY2xhc3Nlcyk7CgogIGNvbnN0IHVwZGF0ZSA9ICh7IHZhbHVlIH0pID0+IHsKICAgIHZhbHVlRmllbGQudGV4dENvbnRlbnQgPSByb3VuZCh2YWx1ZSk7CiAgICBhc3NpZ24odHJhbnNmb3JtKHBhcnNlRmxvYXQodmFsdWUpKSk7CiAgICBpZiAoIXBsYXlpbmcpIHJlZHJhdygpOwogIH07CgogIHNsaWRlci5hZGRFdmVudExpc3RlbmVyKGBpbnB1dGAsICh7IHRhcmdldCB9KSA9PiB1cGRhdGUodGFyZ2V0KSk7CgogIGxldCB0YWJsZSA9IF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKGB0YWJsZS5zbGlkZXItd3JhcHBlcmApOwogIGlmICghdGFibGUpIHsKICAgIHRhYmxlID0gY3JlYXRlKGB0YWJsZWApOwogICAgdGFibGUuY2xhc3NMaXN0LmFkZChgc2xpZGVyLXdyYXBwZXJgKTsKICAgIF9fZWxlbWVudC5wcmVwZW5kKHRhYmxlKTsKICB9CiAgbGV0IHRyID0gY3JlYXRlKGB0cmApOwoKICBsZXQgdGQgPSBjcmVhdGUoYHRkYCk7CiAgbGV0IGxhYmVsID0gY3JlYXRlKGBsYWJlbGApOwogIGxhYmVsLmNsYXNzTGlzdC5hZGQoYHNsaWRlci1sYWJlbGApOwogIGxhYmVsLmlubmVySFRNTCA9IHByb3BMYWJlbAogICAgLnJlcGxhY2UoL18oLispJC8sIGA8c3ViPiQxPC9zdWI+YCkKICAgIC5yZXBsYWNlKC8oXGQrKS8sIGA8c3ViPiQxPC9zdWI+YCk7CiAgdGQuYXBwZW5kKGxhYmVsKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbWluYCk7CiAgdGQudGV4dENvbnRlbnQgPSByb3VuZChzbGlkZXIubWluKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC53aWR0aCA9IGAqYDsKICB0ZC5hcHBlbmQoc2xpZGVyKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbWF4YCk7CiAgdGQudGV4dENvbnRlbnQgPSByb3VuZChzbGlkZXIubWF4KTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB2YXIgdmFsdWVGaWVsZCA9IGNyZWF0ZShgbGFiZWxgKTsgLy8gZnVuY3Rpb24gc2NvcGVkCiAgdmFsdWVGaWVsZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItdmFsdWVgKTsKICB0ZC5hcHBlbmQodmFsdWVGaWVsZCk7CiAgdHIuYXBwZW5kKHRkKTsKICB0ZC5hZGRFdmVudExpc3RlbmVyKGBwb2ludGVyZG93bmAsICgpID0+IHsKICAgIGNvbnN0IHZhbHVlID0gcHJvbXB0KGBuZXcgdmFsdWU/YCwgc2xpZGVyLnZhbHVlKTsKICAgIGlmICh2YWx1ZSAhPT0gbnVsbCkgewogICAgICBzbGlkZXIudmFsdWUgPSB2YWx1ZTsKICAgICAgdXBkYXRlKHsgdmFsdWUgfSk7CiAgICB9CiAgfSk7CgogIHRhYmxlLmFwcGVuZCh0cik7CgogIHVwZGF0ZShzbGlkZXIpOwogIHJldHVybiBzbGlkZXI7Cn0KCi8qKgogKiBSZW1vdmUgYWxsIHNsaWRlcnMgZm9yIHlvdXIgZmlndXJlIGZyb20gdGhlIHBhZ2UuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGFkZFNsaWRlcihgeGApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHRleHQoYGNsaWNrIHRvIGNsZWFyYCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oKSB7CiAqICAgICAgIGNsZWFyU2xpZGVycygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIGFkZFNsaWRlcn0KICovCgpmdW5jdGlvbiBjbGVhclNsaWRlcnMoKSB7CiAgY29uc3QgdGFibGUgPSBfX2VsZW1lbnQucXVlcnlTZWxlY3RvcihgdGFibGUuc2xpZGVyLXdyYXBwZXJgKTsKICBpZiAodGFibGUpIHRhYmxlLmlubmVySFRNTCA9IGBgOwp9CgovKioKICogQWRkIGEgYnV0dG9uIGJlbG93IHlvdXIgZmlndXJlIHRoYXQgY2FuIHRyaWdnZXIgZXZlbnQtYmFzZWQKICogY29kZSwgd2hpY2ggaXMgZXNwZWNpYWxseSBpbXBvcnRhbnQgaWYgeW91IHdhbnQgeW91ciBncmFwaGljcwogKiB0byBiZSB1c2VhYmxlIGJ5IHVzZXJzIHdobyBkb24ndCBoYXZlLCBvciBjYW5ub3QgdXNlLCBhIG1vdXNlLgogKgogKiBvbkNsaWNrIGlzIHNpbWlsYXIgdG8gdGhlIHN0YW5kYXJkIEpTIGV2ZW50IGhhbmRsZXIsIGV4Y2VwdAogKiB0aGF0IHRoZSBjYWxsIGFyZ3VtZW50IGlzIGEgcmVmZXJlbmNlIHRvIHlvdXIgYnV0dG9uLCBub3QKICogdGhlIGNsaWNrIGV2ZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgY29sb3JzID0gW2B3aGl0ZWAsIGBibGFja2BdOwogKiAgICAgbGV0IGJnQ29sb3IgPSAwOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRCdXR0b24oYGZsaXAgYmFja2dyb3VuZGAsIChidXR0b24pID0+IHsKICogICAgICAgICBiZ0NvbG9yID0gLShiZ0NvbG9yIC0gMSk7CiAqICAgICAgICAgcmVkcmF3KCk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoY29sb3JzW2JnQ29sb3JdKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gbGFiZWwgVGhlIHRleHQgbGFiZWwgZm9yIHlvdXIgYnV0dG9uCiAqIEBwYXJhbSB7RnVuY3Rpb259IG9uQ2xpY2sgVGhlIGNsaWNrIGhhbmRsaW5nIGZ1bmN0aW9uLCBzZWUgZGVzY3JpcHRpb24uCiAqIEByZXR1cm5zIHtIVE1MQnV0dG9uRWxlbWVudH0gVGhlIGJ1dHRvbiBlbGVtZW50IHRoaXMgYWRkZWQgdG8gdGhlIHBhZ2UKICoKICogQHNlZSB7QGxpbmsgY2xlYXJCdXR0b25zfQogKi8KZnVuY3Rpb24gYWRkQnV0dG9uKGxhYmVsLCBvbkNsaWNrKSB7CiAgaWYgKCFvbkNsaWNrKSB0aHJvdyBuZXcgRXJyb3IoYGEgYnV0dG9uIG11c3QgaGF2ZSBhbiBvbkNsaWNrIGhhbmRsZXJgKTsKICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBidXR0b25gKTsKICBidG4uY2xhc3NMaXN0LmFkZChgZ3JhcGhpY3MtZWxlbWVudC1idXR0b25gKTsKICBidG4udGV4dENvbnRlbnQgPSBsYWJlbDsKICBidG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCAoKSA9PiBvbkNsaWNrKGJ0bikpOwogIF9fZWxlbWVudC5wcmVwZW5kKGJ0bik7CiAgcmV0dXJuIGJ0bjsKfQoKLyoqCiAqIFJlbW92ZSBhbGwgYnV0dG9ucyBmb3IgeW91ciBmaWd1cmUgZnJvbSB0aGUgcGFnZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGB0aGlzIGRvZXMgbm90aGluZ2AsICgpID0+IHt9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KGBjbGljayB0byBjbGVhcmAsIHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKCkgewogKiAgICAgICBjbGVhckJ1dHRvbnMoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBhZGRCdXR0b259CiAqLwpmdW5jdGlvbiBjbGVhckJ1dHRvbnMoKSB7CiAgX19lbGVtZW50CiAgICAucXVlcnlTZWxlY3RvckFsbChgYnV0dG9uLmdyYXBoaWNzLWVsZW1lbnQtYnV0dG9uYCkKICAgIC5mb3JFYWNoKChlKSA9PiBlLnJlbW92ZSgpKTsKfQovKioKICogRHJhdyBhIGNpcmN1bGFyIGFyYyB3aXRoIHJhZGl1cyBgcmAgYXQgKHgseSksCiAqIHN0YXJ0aW5nIGF0IGFuZ2xlIGBzYCBhbmQgZW5kaW5nIGF0IGFuZ2xlIGBlYC4KICogSWYgYHdlZGdlYCBpcyB0cnVlLCB0aGlzIHdpbGwgZHJhdyBhIGNsb3NlZAogKiBzaGFwZSB0aGF0IGlzIGFuY2hvcmVkIGF0ICh4LHkpLiBJZiBvbWl0dGVkCiAqIG9yIGV4cGxpY2l0bHkgc2V0IHRvIGZhbHNlLCB0aGlzIHdpbGwgZHJhdwogKiBhbiBvcGVuIHNoYXBlIHdpdGggYSBmaWxsIHRoYXQgY29ubmVjdHMgdGhlCiAqIGZpcnN0IGFuZCBsYXN0IHBvaW50IG9uIHRoZSBhcmMsIGJ1dCBubyBjbG9zaW5nCiAqIHN0cm9rZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYCNGMDAyYCk7CiAqICAgICAgIGFyYyh3aWR0aC8yICsgMzAsIGhlaWdodC8yIC0gNDAsIDQwLCAwLCAwLjY2KlRBVSk7CiAqICAgICAgIGFyYyh3aWR0aC8yIC0gMzAsIGhlaWdodC8yICsgMjAsIDQwLCAwLCAwLjY2KlRBVSwgdHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGNpcmN1bGFyIGNlbnRlciB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBjaXJjdWxhciBjZW50ZXIgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhpcyBhcmMgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydEFuZ2xlIFRoZSBzdGFydCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0gZW5kQW5nbGUgVGhlIGVuZCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge2Jvb2xlYW59IGRyYXdXZWRnZSBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRvIGRyYXcgYSB3ZWRnZSBvciBjYXBwZWQgY2lyY2xlIChkZWZhdWx0PWNpcmNsZSkKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHBvaW50IFRoZSBjaXJjdWxhciBjZW50ZXIge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhpcyBhcmMgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydEFuZ2xlIFRoZSBzdGFydCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0gZW5kQW5nbGUgVGhlIGVuZCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge2Jvb2xlYW59IGRyYXdXZWRnZSBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRvIGRyYXcgYSB3ZWRnZSBvciBjYXBwZWQgY2lyY2xlIChkZWZhdWx0PWNpcmNsZSkKICoKICogQHNlZSB7QGxpbmsgY2lyY2xlfQogKi8KZnVuY3Rpb24gYXJjKHgsIHksIHIsIHMgPSAwLCBlID0gVEFVLCB3ZWRnZSA9IGZhbHNlKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB3ZWRnZSA9IGU7CiAgICBlID0gczsKICAgIHMgPSByOwogICAgciA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgY29uc3Qgc3RlcCA9IDAuMTsKICBzdGFydCgpOwogIGlmICh3ZWRnZSkgdmVydGV4KHgsIHkpOwogIGxldCBhID0gczsKICB2ZXJ0ZXgoeCArIHIgKiBjb3MocyksIHkgKyByICogc2luKHMpKTsKICBmb3IgKGEgPSBzICsgc3RlcDsgYSA8IGU7IGEgKz0gc3RlcCkgewogICAgdmVydGV4KHggKyByICogY29zKGEpLCB5ICsgciAqIHNpbihhKSk7CiAgfQogIHZlcnRleCh4ICsgciAqIGNvcyhlKSwgeSArIHIgKiBzaW4oZSkpOwogIGlmICh3ZWRnZSkgdmVydGV4KHgsIHkpOwogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIHBhaXIgb2YgaG9yaXpvbnRhbCBhbmQgdmVydGljYWwgYXhlcy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Qm9yZGVyKDEsIGBibGFja2ApOwogKiAgICAgICBzZXRHcmlkKDUwLCBgbGlnaHRncmV5YCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBzZXRDdXJzb3IoYG5vbmVgKTsKICogICAgICAgY2xlYXIoYCNmZmZlZjdgKTsKICogICAgICAgc2V0Q29sb3IoYCMzMzNgKTsKICogICAgICAgdHJhbnNsYXRlKDI1LDI1KTsKICogICAgICAgYXhlcygKICogICAgICAgICBgdGltZSAocylgLCAwLCB3aWR0aC01MCwKICogICAgICAgICBgZGlzdGFuY2UgKGttKWAsIDAsIGhlaWdodC01MCwKICogICAgICAgICAiMCIsICI2MCIsCiAqICAgICAgICAgIjAiLCAiNTAwIik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGhMYWJlbCB0aGUgaG9yaXpvbnRhbCBheGlzIGxhYmVsCiAqIEBwYXJhbSB7bnVtYmVyfSBocyB0aGUgc3RhcnQgKGxlZnQpIHBpeGVsIHZhbHVlIGZvciB0aGUgaG9yaXpvbnRhbCBheGlzCiAqIEBwYXJhbSB7bnVtYmVyfSBoZSB0aGUgZW5kIChyaWdodCkgcGl4ZWwgdmFsdWUgZm9yIHRoZSBob3Jpem9udGFsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IHZMYWJlbCB0aGUgdmVydGljYWwgYXhpcyBsYWJlbAogKiBAcGFyYW0ge251bWJlcn0gdnMgdGhlIHN0YXJ0ICh0b3ApIHBpeGVsIHZhbHVlIGZvciB0aGUgdmVydGljYWwgYXhpcwogKiBAcGFyYW0ge251bWJlcn0gdmUgdGhlIGVuZCAoYm90dG9tKSBwaXhlbCB2YWx1ZSBmb3IgdGhlIHZlcnRpY2FsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IGhzTGFiZWw/IGFuIG9wdGlvbmFsIGxhYmVsIGZvciB0aGUgc3RhcnQgKGxlZnQpIG9mIHRoZSBob3Jpem9udGFsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IGhlTGFiZWw/IGFuIG9wdGlvbmFsIGxhYmVsIGZvciB0aGUgZW5kIChyaWdodCkgb2YgdGhlIGhvcml6b250YWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gdnNMYWJlbD8gYW4gb3B0aW9uYWwgbGFiZWwgZm9yIHRoZSBzdGFydCAodG9wKSBvZiB0aGUgdmVydGljYWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gdmVMYWJlbD8gYW4gb3B0aW9uYWwgbGFiZWwgZm9yIHRoZSBlbmQgKGJvdHRvbSkgb2YgdGhlIHZlcnRpY2FsIGF4aXMKICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiBheGVzKAogIGhMYWJlbCwKICBocywKICBoZSwKICB2TGFiZWwsCiAgdnMsCiAgdmUsCiAgaHNMYWJlbCA9IGZhbHNlLAogIGhlTGFiZWwgPSBmYWxzZSwKICB2c0xhYmVsID0gZmFsc2UsCiAgdmVMYWJlbCA9IGZhbHNlCikgewogIGxpbmUoaHMsIDAsIGhlLCAwKTsKICBsaW5lKDAsIHZzLCAwLCB2ZSk7CgogIGNvbnN0IGhwb3MgPSAwIC0gNTsKICB0ZXh0KGAke2hMYWJlbH0g4oaSYCwgd2lkdGggLyAyICsgNSwgaHBvcywgUklHSFQpOwogIHRleHQoaHNMYWJlbCA/IGhzTGFiZWwgOiBocywgaHMsIGhwb3MsIFJJR0hUKTsKICB0ZXh0KGhlTGFiZWwgPyBoZUxhYmVsIDogaGUsIGhlLCBocG9zLCBSSUdIVCk7CgogIGNvbnN0IHZwb3MgPSAtNTsKICBzYXZlKCk7CiAgdHJhbnNsYXRlKHZwb3MsIGhlaWdodCAvIDIpOwogIHJvdGF0ZSgtUEkgLyAyKTsKICB0ZXh0KGAke3ZMYWJlbH1gLCAwLCAwLCBMRUZUKTsKICByZXN0b3JlKCk7CiAgdGV4dChg4oaTYCwgdnBvcywgaGVpZ2h0IC8gMiArIDE2LCBSSUdIVCk7CiAgdGV4dCh2c0xhYmVsID8gdnNMYWJlbCA6IHZzLCB2cG9zLCB2cyArIDUsIFJJR0hUKTsKICB0ZXh0KHZlTGFiZWwgPyB2ZUxhYmVsIDogdmUsIHZwb3MsIHZlLCBSSUdIVCk7Cn0KCi8qKgogKiBEcmF3IG9uZSBvciBtb3JlIEJlemllciBjdXJ2ZXMgZnJvbSBhbiBhcnJheQogKiBvZiBQb2ludCBvciBQb2ludC1saWtlcyB0aGF0IGltcGxlbWVudDoKICoKICogYGBgCiAqIHsKICogICB4OiBudW1iZXIKICogICB5OiBudW1iZXIKICogfQogKiBgYGAKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYCNGMDAyYCk7CiAqICAgICAgIGJlemllcigKICogICAgICAgICBuZXcgUG9pbnQoMjAsIGhlaWdodCAtIDU1KSwKICogICAgICAgICBuZXcgUG9pbnQoMjAsIDI1KSwKICogICAgICAgICB7IHg6IHdpZHRoIC0gMjAsIHk6IDI1fSwKICogICAgICAgICB7IHg6IHdpZHRoIC0gMjAsIHk6IGhlaWdodCAtIDU1fQogKiAgICAgICApOwogKiAgICAgICBub0ZpbGwoKQogKiAgICAgICBiZXppZXIoCiAqICAgICAgICAgbmV3IFBvaW50KDAsIGhlaWdodCAtIDIwKSwKICogICAgICAgICBuZXcgUG9pbnQod2lkdGggLSAyMCwgaGVpZ2h0IC0gMjApLAogKiAgICAgICAgIHsgeDogMjAsIHk6IDIwfSwKICogICAgICAgICB7IHg6IHdpZHRoLCB5OiAyMH0KICogICAgICAgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcls4XX0gLi4uY29vcmRpbmF0ZXMgRWlnaHQgeCwgeSB2YWx1ZXMuCiAqIEBwYXJhbSB7bnVtYmVyWzZuXX0gLi4uYWRkaXRpb25hbENvb3JkaW5hdGVzPyBNdWx0aXBsZXMgb2Ygc2l4IHgsIHkgdmFsdWVzLgogKgogKiBAcGFyYW0ge1BvaW50TGlrZVs0XX0gLi4uY29vcmRpbmF0ZXMgRm91ciB7eCx5fSBjb29yZGluYXRlcy4KICogQHBhcmFtIHtQb2ludExpa2VbM25dfSAuLi5hZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IE11bHRpcGxlcyBvZiB0aHJlZSB7eCx5fSBjb29yZGluYXRlcy4KICoKICogQHNlZSB7QGxpbmsgYnNwbGluZX0KICogQHNlZSB7QGxpbmsgc3BsaW5lfQogKi8KZnVuY3Rpb24gYmV6aWVyKC4uLmFyZ3MpIHsKICBsZXQgcG9pbnRzID0gYXJnczsKCiAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBgbnVtYmVyYCkgewogICAgcG9pbnRzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgcG9pbnRzLnB1c2goeyB4OiBhcmdzW2ldLCB5OiBhcmdzW2kgKyAxXSB9KTsKICAgIH0KICB9CgogIGNvbnN0IGIgPSAodCwgYSwgYiwgYywgZCkgPT4gewogICAgY29uc3QgbXQgPSAxIC0gdDsKICAgIHJldHVybiBhICogbXQgKiogMyArIDMgKiBiICogbXQgKiogMiAqIHQgKyAzICogYyAqIG10ICogdCAqKiAyICsgZCAqIHQgKiogMzsKICB9OwoKICBsZXQgW3AwLCAuLi5yZXN0XSA9IHBvaW50czsKICBzdGFydCgpOwogIGZvciAobGV0IGkgPSAwLCBlID0gcmVzdC5sZW5ndGg7IGkgPCBlOyBpICs9IDMpIHsKICAgIGxldCBbcDEsIHAyLCBwM10gPSByZXN0LnNsaWNlKGksIGkgKyAzKTsKICAgIGlmIChwMSAmJiBwMiAmJiBwMykgewogICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IDE7IHQgKz0gMC4wMSkgewogICAgICAgIHZlcnRleChiKHQsIHAwLngsIHAxLngsIHAyLngsIHAzLngpLCBiKHQsIHAwLnksIHAxLnksIHAyLnksIHAzLnkpKTsKICAgICAgfQogICAgICB2ZXJ0ZXgocDMueCwgcDMueSk7CiAgICAgIHAwID0gcDM7CiAgICB9CiAgfQogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIEItc3BsaW5lIHVzaW5nIGZvdXIgb3IgbW9yZSBQb2ludCBvcgogKiBQb2ludC1saWtlcyB0aGF0IGltcGxlbWVudDoKICoKICogYGBgCiAqIHsKICogICB4OiBudW1iZXIKICogICB5OiBudW1iZXIKICogfQogKiBgYGAKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICByYW5nZSgwLCBUQVUsIFBJIC8gNSwgKGEpID0+IHBvaW50cy5wdXNoKAogKiAgICAgICAgIG5ldyBQb2ludCgKICogICAgICAgICAgIHJhbmRvbSgzMCkgKyA1MCAqIGNvcyhhKSwKICogICAgICAgICAgIHJhbmRvbSgzMCkgKyA1MCAqIHNpbihhKQogKiAgICAgICAgICkKICogICAgICAgKSk7CiAqICAgICAgIHNldE1vdmFibGUoLi4ucG9pbnRzKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGggLyAyLCBoZWlnaHQgLyAyKTsKICogICAgICAgbm9TdHJva2UoKTsKICogICAgICAgc2V0RmlsbChgIzAwMDJgKTsKICogICAgICAgYnNwbGluZSguLi5wb2ludHMpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHBvaW50cy5mb3JFYWNoKHAgPT4gcG9pbnQocCkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyWzhdfSAuLi5jb29yZGluYXRlcyBFaWdodCB4LCB5IHZhbHVlcy4KICogQHBhcmFtIHtudW1iZXJbMm5dfSAuLi5hZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IE11bHRpcGxlcyBvZiB4LCB5IHZhbHVlcy4KICoKICogQHBhcmFtIHtQb2ludExpa2VbNF19IC4uLmNvb3JkaW5hdGVzIEZvdXIge3gseX0gY29vcmRpbmF0ZXMuCiAqIEBwYXJhbSB7UG9pbnRMaWtlW25dfSAuLi5hZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IFplcm8gb3IgbW9yZSB7eCx5fSBjb29yZGluYXRlcy4KICoKICogQHNlZSB7QGxpbmsgYmV6aWVyfQogKiBAc2VlIHtAbGluayBzcGxpbmV9CiAqLwoKZnVuY3Rpb24gYnNwbGluZSguLi5hcmdzKSB7CiAgbGV0IG9wZW4gPSB0cnVlOwogIGlmICh0eXBlb2YgYXJnc1thcmdzLmxlbmd0aCAtIDFdID09PSBgYm9vbGVhbmApIHsKICAgIG9wZW4gPSBhcmdzLnNwbGljZShhcmdzLmxlbmd0aCAtIDEsIDEpWzBdOwogIH0KCiAgbGV0IHBvaW50cyA9IGFyZ3M7CgogIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gYG51bWJlcmApIHsKICAgIHBvaW50cyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHBvaW50cy5wdXNoKHsgeDogYXJnc1tpXSwgeTogYXJnc1tpICsgMV0gfSk7CiAgICB9CiAgfQoKICBzdGFydCgpOwogIG5ldyBCU3BsaW5lKHBvaW50cywgb3BlbikuZ2V0TFVUKCkuZm9yRWFjaCgocCkgPT4gdmVydGV4KHAueCwgcC55KSk7CiAgZW5kKCk7Cn0KCi8qKgogKiBEcmF3IGEgY2lyY2xlIHdpdGggcmFkaXVzIGByYCBhdCBgeCx5YC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYCNGMDAyYCk7CiAqICAgICAgIGNpcmNsZSh3aWR0aC8yLCBoZWlnaHQvMiwgODApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBjaXJjbGUncyBjZW50ZXIgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgY2lyY2xlJ3MgY2VudGVyIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHIgVGhlIGNpcmNsZSdzIHJhZGl1cyBpbiBwaXhlbHMKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIGNpcmNsZSdzIGNlbnRlciB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSByIFRoZSBjaXJjbGUncyByYWRpdXMgaW4gcGl4ZWxzCiAqCiAqIEBzZWUge0BsaW5rIGFyY30KICovCmZ1bmN0aW9uIGNpcmNsZSh4LCB5LCByKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICByID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBhcmMoeCwgeSwgciwgMCwgVEFVLCBmYWxzZSk7Cn0KCi8qKgogKiBDbGVhciB0aGUgY2FudmFzLCBhbmQgc2V0IGl0IHRvIGEgc3BlY2lmaWMgKENTUykgY29sb3VyLgogKiBJZiBubyBgbm9HcmlkKClgIGNhbGwgd2FzIG1hZGUsIHRoaXMgd2lsbCB0aGVuIGFsc28gZHJhdwogKiB0aGUgYmFja2dyb3VuZCBncmlkLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHBpbmtgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge2NvbG9yfSBjb2xvcj8gVGhlIChDU1MpIGJhY2tncm91bmQgY29sb3IgdG8gdXNlIChkZWZhdWx0ID0gYHdoaXRlYCkKICovCmZ1bmN0aW9uIGNsZWFyKGNvbG9yID0gYHdoaXRlYCkgewogIHNhdmUoKTsKICBfX2NhbnZhcy5zdHlsZS5iYWNrZ3JvdW5kID0gY29sb3I7CiAgX19jYW52YXMud2lkdGggPSB3aWR0aDsKICBfX2N0eCA9IF9fY2FudmFzLmdldENvbnRleHQoYDJkYCk7CiAgaWYgKF9fZHJhd19ncmlkKSBncmlkKCk7CiAgcmVzdG9yZSgpOwp9CgovKioKICogQ291bnRlcnBhcnQgdG8gc3RhcnQoKSwgZmluYWxpemVzIHRoZSBjdXJyZW50IHNoYXBlIGFuZAogKiBjb2xvdXJzIGl0LiBJZiBgY2xvc2VgIGlzIHRydWUsIGl0IHdpbGwgY2xvc2UgdGhlIHBhdGgKICogYmVmb3JlIGNvbG91cmluZy4KICoKICogSWYgYG5vRmlsbCgpYCBpcyBpbiBlZmZlY3QsIHRoZSBzaGFwZSB3aWxsIG5vdCBiZSBmaWxsZWQuCiAqIGlmIGBub1N0cm9rZSgpYCBpcyBpbiBlZmZlY3QsIHRoZSBzaGFwZSBvdXRsaW5lIHdpbGwgbm90IGJlIGNvbG91cmVkLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgZ29sZGApOwogKiAgICAgICBzdGFydCgpOwogKiAgICAgICB2ZXJ0ZXgoMCxoZWlnaHQvMik7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCAwKTsKICogICAgICAgdmVydGV4KHdpZHRoLCBoZWlnaHQvMik7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgICBlbmQodHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtib29sZWFufSBjbG9zZT8gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IHRvIGNsb3NlIHRoZSBwYXRoIChkZWZhdWx0ID0gZmFsc2UpCiAqCiAqIEBzZWUge0BsaW5rIHN0YXJ0fQogKiBAc2VlIHtAbGluayB2ZXJ0ZXh9CiAqIEBzZWUge0BsaW5rIGVuZFNoYXBlfQogKi8KZnVuY3Rpb24gZW5kKGNsb3NlID0gZmFsc2UpIHsKICBpZiAoY2xvc2UpIF9fY3R4LmNsb3NlUGF0aCgpOwogIF9fY3R4LmZpbGwoKTsKICBfX2N0eC5zdHJva2UoKTsKICBpZiAoX19jdHgubGluZVdpZHRoICUgMiA9PT0gMSkgewogICAgX19jdHgudHJhbnNsYXRlKC0wLjUsIC0wLjUpOwogIH0KfQoKLyoqCiAqIERyYXcgYW4gaW1hZ2UgaW4gYSBnaXZlbiBsb2NhdGlvbiB3aXRoIGFuIG9wdGlvbmFsCiAqIHdpZHRoIGFuZCBoZWlnaHQuIElmIG9taXR0ZWQsIHRoZSB3aWR0aCBhbmQgaGVpZ2h0CiAqIHdpbGwgYmUgdGhlIGltYWdlJ3Mgb3duIGRpbWVuc2lvbnMuIE5vdGUgdGhhdCB0aGUKICogaW1hZ2UgbWF5IGJlIGVpdGhlciBhIFVSTCwgb3IgYW4gPGltZz4gZWxlbWVudC4KICoKICogTm90ZSB0aGF0IHRoaXMgaXMgYW4gYXN5bmMgZnVuY3Rpb246IGlmIGl0IGlzIGltcG9ydGFudAogKiB0aGF0IG5vdGhpbmcgZ2V0cyBkcmF3biB1bnRpbCB0aGUgaW1hZ2UgaGFzIGJlZW4gZHJhd24sCiAqIHJlbWVtYmVyIHRvIGBhd2FpdGAgaXRzIGNhbGwuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBhc3luYyBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgYXdhaXQgaW1hZ2UoYGh0dHBzOi8vZHVtbXlpbWFnZS5jb20vMTAweDEwMGAsIDUwLCA1MCwgMTAwLCAxMDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7SW1hZ2V8c3RyaW5nfSBpbWdPclVSTCBUaGUgaW1hZ2UgdG8gZHJhdyBlaXRoZXIgYXMgSW1hZ2Ugb2JqZWN0LCBvciBpbWFnZSBVUkwuCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBkcmF3IHBvc2l0aW9uJ3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgZHJhdyBwb3NpdGlvbidzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHcgVGhlIHdpZHRoIG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHBhcmFtIHtudW1iZXJ9IGggVGhlIGhlaWdodCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEByZXR1cm5zIHtJbWFnZX0gVGhlIGRyYXduIGltYWdlCiAqCiAqIEBwYXJhbSB7SW1hZ2V8c3RyaW5nfSBpbWdPclVSTCBUaGUgaW1hZ2UgdG8gZHJhdyBlaXRoZXIgYXMgSW1hZ2Ugb2JqZWN0LCBvciBpbWFnZSBVUkwuCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSBkcmF3IHBvc2l0aW9uIGFzIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHcgVGhlIHdpZHRoIG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHBhcmFtIHtudW1iZXJ9IGggVGhlIGhlaWdodCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEByZXR1cm5zIHtJbWFnZX0gVGhlIGRyYXduIGltYWdlCiAqLwphc3luYyBmdW5jdGlvbiBpbWFnZShpbWcsIHggPSAwLCB5ID0gMCwgdywgaCkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgaCA9IHc7CiAgICB3ID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgaWYgKHR5cGVvZiBpbWcgPT09IGBzdHJpbmdgKSB7CiAgICBpbWcgPSBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIGNvbnN0IHRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGltZ2ApOwogICAgICB0YWcub25sb2FkID0gKCkgPT4gcmVzb2x2ZSh0YWcpOwogICAgICB0YWcub25lcnJvciA9ICgpID0+IHJlamVjdCgpOwogICAgICB0YWcuc3JjID0gaW1nOwogICAgfSk7CiAgfQogIF9fY3R4LmRyYXdJbWFnZShpbWcsIHgsIHksIHcgfHwgaW1nLndpZHRoLCBoIHx8IGltZy5oZWlnaHQpOwogIHJldHVybiBpbWc7Cn0KCi8qKgogKiBEcmF3IGEgbGluZSBmcm9tIG9uZSBjb29yZGluYXRlIHRvIGFub3RoZXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICByYW5nZSgwLGhlaWdodCwyMCwgKGkpID0+IGxpbmUoMCwgMCwgd2lkdGgsIGkpKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geDEgVGhlIGZpcnN0IHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTEgVGhlIGZpcnN0IHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geDIgVGhlIHNlY29uZCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkyIFRoZSBzZWNvbmQgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMSBUaGUgZmlyc3QgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMiBUaGUgc2Vjb25kIHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKi8KZnVuY3Rpb24gbGluZSh4MSwgeTEsIHgyLCB5MikgewogIGlmICh4MS54ICE9PSB1bmRlZmluZWQgJiYgeDEueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5MiA9IHkxLnk7CiAgICB4MiA9IHkxLng7CiAgICB5MSA9IHgxLnk7CiAgICB4MSA9IHgxLng7CiAgfQoKICBzdGFydCgpOwogIHZlcnRleCh4MSwgeTEpOwogIHZlcnRleCh4MiwgeTIpOwogIGVuZCgpOwp9CgovKioKICogUGxvdCBhIHk9Zih4KSBmdW5jdGlvbi4gVGhlIGlucHV0IHRvIHRoZSBmdW5jdGlvbgogKiB3aWxsIHNwYW4gdGhlIGludGVydmFsIFthLGJdIHVzaW5nIHRoZSBpbmRpY2F0ZWQKICogbnVtYmVyIG9mIHN0ZXBzLCBhbmQgdGhlIHJlIHN1bHQgbWF5IGJlIHNjYWxlZCBib3RoCiAqIGluIHRoZSB4IGFuZCB5IGRpcmVjdGlvbiBpbiBvcmRlciB0byBkcmF3IHNvbWV0aGluZwogKiB0aGF0IHlvdSBjYW4gYWN0dWFsbHkgc2VlIChlLmcuIGlmIHlvdSdyZSBwbG90dGluZwogKiB0byB0aGUgZG9tYWluIFswLDFdIHlvdSB3b3VsZG4ndCBiZSBhYmxlIHRvIHNlZSB0aGUKICogcmVzdWx0IHdpdGhvdXQgc2NhbGluZykuCiAqCiAqIFRoaXMgZnVuY3Rpb24gaXMgYXdhcmUgb2YsIGFuZCB3aWxsIHBsb3QsIGRpc2NvbnRpbnVpdGllcwogKiB1c2luZyB0aGUgc3RhbmRhcmQgb3BlbiBjaXJjbGUgbm90YXRpb24sIHVubGVzcyBpbnN0cnVjdGVkCiAqIG5vdCB0byBkbyBzbyB1c2luZyB0aGUgYGlnbm9yZURpc2NvbnRpbnVpdHlgIGJvb2xlYW4gZmxhZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICB0cmFuc2xhdGUoMCwgaGVpZ2h0IC8gMik7CiAqICAgICAgIGNvbnN0IGZuID0gKHgpID0+IGNvcyh4KSAqKiA2IC8gc2luKHgpIC0gc2luKHgpLzI7CiAqICAgICAgIHBsb3QoZm4sIDAsIDIqVEFVLCAxMjAsIHdpZHRoIC8gVEFVLCBoZWlnaHQgLyAyKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmIHRoZSBgeSA9IGYoeClgIGZ1bmN0aW9uIHRvIHBsb3QKICogQHBhcmFtIHtudW1iZXJ9IGE/IFRoZSBsb3dlciBib3VuZCBmb3IgdGhlIGlucHV0IHZhbHVlIChkZWZhdWx0ID0gMCkKICogQHBhcmFtIHtudW1iZXJ9IGI/IFRoZSB1cHBlciBib3VuZCBmb3IgdGhlIGlucHV0IHZhbHVlIChkZWZhdWx0ID0gMSkKICogQHBhcmFtIHtudW1iZXJ9IHN0ZXBzPyBUaGUgbnVtYmVyIG9mIHBsb3QgcG9pbnRzIHRvIHBsb3Qgb3ZlciB0aGUgaW50ZXJ2YWwgW2EsYl0gKGRlZmF1bHQgPSAxMDApCiAqIEBwYXJhbSB7bnVtYmVyfSB4c2NhbGU/IEFuIG9wdGlvbmFsIHNjYWxpbmcgZmFjdG9yIHRvIGFwcGx5IHRvIGVhY2ggcGxvdCBwb2ludCdzIHggdmFsdWUgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0ge251bWJlcn0geXNjYWxlPyBBbiBvcHRpb25hbCBzY2FsaW5nIGZhY3RvciB0byBhcHBseSB0byBlYWNoIHBsb3QgcG9pbnQncyB5IHZhbHVlIChkZWZhdWx0ID0gMSkKICogQHBhcmFtIHtib29sZWFufSBpZ25vcmVEaXNjb250aW51aXR5PyBEbyBub3QgZHJhdyBzcGVjaWFsIGVsZW1lbnRzIGZvciBkaXNjb250aW51aXRpZXMgKGRlZmF1bHQgPSBmYWxzZSkKICoKICogQHNlZSB7QGxpbmsgcGxvdERhdGF9CiAqLwpmdW5jdGlvbiBwbG90KAogIGYsCiAgYSA9IDAsCiAgYiA9IDEsCiAgc3RlcHMgPSAxMDAsCiAgeHNjYWxlID0gMSwKICB5c2NhbGUgPSAxLAogIGlnbm9yZURpc2NvbnRpbnVpdHkgPSBmYWxzZQopIHsKICBjb25zdCBpbnRlcnZhbCA9IGIgLSBhOwogIHN0YXJ0KCk7CiAgbGV0IFtweSwgZHksIHBkeV0gPSBbMCwgMCwgMF07CiAgY29uc3Qgc3RlcCA9IGludGVydmFsIC8gKHN0ZXBzIC0gMSk7CiAgY29uc3QgZGlzY29udGludWl0eSA9IChpLCB4LCB5KSA9PiB7CiAgICBlbmQoKTsKICAgIHNhdmUoKTsKICAgIG5vRmlsbCgpOwogICAgcG9pbnQoeCAqIHhzY2FsZSwgcHkgKiB5c2NhbGUpOwogICAgcG9pbnQoeCAqIHhzY2FsZSwgeSAqIHlzY2FsZSk7CiAgICByZXN0b3JlKCk7CiAgICBzdGFydCgpOwogIH07CiAgZm9yIChsZXQgaSA9IDAsIHgsIHk7IGkgPCBzdGVwczsgaSsrKSB7CiAgICB4ID0gYSArIGkgKiBzdGVwOwogICAgeSA9IGYoeCk7CiAgICAvLyBJZiBmKHgpIGNoYW5nZXMgaW4gdmlvbGF0aW9uIG9mIHdoYXQgaXRzIGYnKHgpIHN1Z2dlc3RlZCwKICAgIC8vIHRoYXQncyBhIGRpc2NvbnRpbnVpdHkgYW5kIHdlIGRyYXcgYW4gYXN5bXB0b3RlLgogICAgZHkgPSAoeSAtIHB5KSAqIHN0ZXA7CiAgICBpZiAoIWlnbm9yZURpc2NvbnRpbnVpdHkpIHsKICAgICAgaWYgKHBkeSAhPT0gbnVsbCAmJiBzaWduKHkgLSBweSkgIT09IHNpZ24ocGR5KSAmJiBhYnMocGR5KSA+IDAuMDEpIHsKICAgICAgICBkaXNjb250aW51aXR5KGksIHgsIHkpOwogICAgICAgIHBkeSA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcGR5ID0gZHk7CiAgICAgIH0KICAgIH0KICAgIHZlcnRleCh4ICogeHNjYWxlLCB5ICogeXNjYWxlKTsKICAgIHB5ID0geTsKICB9CiAgZW5kKCk7Cn0KCi8qKgogKiBQbG90IGEgMkQgZ3JhcGggdXNpbmcgYSBjb2xsZWN0aW9uIG9mIGFueS1kaW1lbnNpb25hbCBkYXRhLAogKiBieSBpbmRpY2F0aW5nIHdoaWNoIGRpbWVuc2lvbiBzaG91bGQgYmUgdHJlYXRlZCBhcyB0aGUgYHhgCiAqIGFuZCB3aGljaCBkaW1lbnNpb24gc2hvdWxkIGJlIHRyZWF0ZWQgYXMgdGhlIGB5YC4gSWYgbm8gYHhgCiAqIGFuZCBgeWAgYXJlIHByb3ZpZGVkLCBgZGF0YWAgd2lsbCBiZSB0cmVhdGVkIGEgMUQgYXJyYXkgYW5kCiAqIHdpbGwgcGxvdCB3aXRoIHRoZSBhcnJheSBpbmRleCBhcyBgeGAgYW5kIGVsZW1lbnQgYXQgdGhhdAogKiBpbmRleCBhcyBgeWAuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHRyYW5zbGF0ZSgwLCBoZWlnaHQvMik7CiAqCiAqICAgICAgIHNldFN0cm9rZShgZGFya2dyZWVuYCk7CiAqICAgICAgIGxldCBkYXRhID0gYXJyYXkod2lkdGgsIChpKSA9PiBbaSwgaGVpZ2h0LzIgKiBzaW4oaS8yNSldKTsKICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAqCiAqICAgICAgIHNldFN0cm9rZShgcHVycGxlYCk7CiAqICAgICAgIGRhdGEgPSBhcnJheSh3aWR0aCwgKGkpID0+ICh7CiAqICAgICAgICAgbWVlcDogaSwKICogICAgICAgICBtb29wOiBoZWlnaHQvMiAqIGNvcyhpLzI1KQogKiAgICAgICB9KSk7CiAqICAgICAgIHBsb3REYXRhKGRhdGEsIGBtZWVwYCwgYG1vb3BgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge29iamVjdFtdfSBkYXRhIFRoZSBhbnktZGltZW5zaW9uYWwgZGF0YSBmcm9tIHdoaWNoIHRvIHBsb3Qgb25lIGRpbWVuc2lvbiBhZ2FpbiBhbm90aGVyCiAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30geD8gVGhlIHByb3BlcnR5IG5hbWUgb3IgaW5kaXZpZHVhbCBlbGVtZW50IGFycmF5IGluZGV4IHRvIHVzZSBhcyB4IGRpbWVuc2lvbgogKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IHk/IFRoZSBwcm9wZXJ0eSBuYW1lIG9yIGluZGl2aWR1YWwgZWxlbWVudCBhcnJheSBpbmRleCB0byB1c2UgYXMgeSBkaW1lbnNpb24KICoKICogQHNlZSB7QGxpbmsgcGxvdH0KICovCmZ1bmN0aW9uIHBsb3REYXRhKGRhdGEsIHgsIHkpIHsKICBzdGFydCgpOwogIGlmICh4ICE9PSB1bmRlZmluZWQgJiYgeSAhPT0gdW5kZWZpbmVkKSB7CiAgICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgICAgeSA9IHgueTsKICAgICAgeCA9IHgueDsKICAgIH0KICAgIGRhdGEuZm9yRWFjaCgocCkgPT4gdmVydGV4KHBbeF0sIHBbeV0pKTsKICB9IGVsc2UgewogICAgZGF0YS5mb3JFYWNoKCh5LCB4KSA9PiB2ZXJ0ZXgoeCwgeSkpOwogIH0KICBlbmQoKTsKfQoKLyoqCiAqIERyYXcgYSBwb2ludCAoZWl0aGVyIGZyb20geC95IG9yIHBvaW50LWxpa2UpLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHJhbmdlKDAsIFRBVSwgKGEpID0+IHsKICogICAgICAgICBwb2ludCg0MCAqIGNvcyhhKSwgNDAgKiBzaW4oYSkpOwogKiAgICAgICB9KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgcG9pbnQncyBjZW50ZXIgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgcG9pbnQncyBjZW50ZXIgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgcG9pbnQncyBjZW50ZXIge3gseX0gY29vcmRpbmF0ZQogKgogKiBAc2VlIHtAbGluayBjaXJjbGV9CiAqLwpmdW5jdGlvbiBwb2ludCh4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgY2lyY2xlKHgsIHksIDMpOwp9CgovKioKICogRHJhdyBhIHJlY3RhbmdsZSBhdCB0aGUgc3BlY2lmaWVkIGNvb3JkaW5hdGUsIHdpdGgKICogdGhlIHNwZWNpZmljIHdpZHRoIGFuZCBoZWlnaHQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg0MCwgNDAsIHdpZHRoIC0gODAsIGhlaWdodCAtIDgwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgcmVjdCdzIGNvcm5lciAgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgcmVjdCdzIGNvcm5lciAgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gdyBUaGUgd2lkdGggb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcGFyYW0ge251bWJlcn0gaCBUaGUgaGVpZ2h0IG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHJlY3Q7cyBjb3JkZXIge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0gdyBUaGUgd2lkdGggb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcGFyYW0ge251bWJlcn0gaCBUaGUgaGVpZ2h0IG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICovCmZ1bmN0aW9uIHJlY3QoeCwgeSwgdywgaCkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgaCA9IHc7CiAgICB3ID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeCwgeSk7CiAgdmVydGV4KHggKyB3LCB5KTsKICB2ZXJ0ZXgoeCArIHcsIHkgKyBoKTsKICB2ZXJ0ZXgoeCwgeSArIGgpOwogIHZlcnRleCh4LCB5KTsKICBlbmQoKTsKfQoKLyoqCiAqIERyYXcgYSBjYXJkaW5hbCAoaGVybWl0ZSkgc3BsaW5lIHRoYXQgcGFzc2VzIHRocm91Z2ggZWFjaAogKiBwb2ludCBwcm92aWRlZCwgdXNpbmcgYSBtYXRoZW1hdGljYWxseSB2aXJ0dWFsIHN0YXJ0IGFuZAogKiBlbmQgdG8gZW5zdXJlIHRoZSBjdXJ2ZSBzdGFydHMgYW5kIGVuZHMgYXQgdGhlIHByb3ZpZGVkCiAqIHN0YXJ0IGFuZCBlbmQgcG9pbnQuIFRoaXMgY2FuIGJlIGJ5cGFzc2VkIGJ5IHNldHRpbmcKICogdGhlIGB2aXJ0dWFsYCBhcmd1bWVudCB0byBgZmFsc2VgLgogKgogKiBBZGRpdGlvbmFsbHksIHRoZSBzcGxpbmUncyB0aWdodG5lc3MsIHdoaWNoIGNvbnRyb2xzCiAqIGhvdyAiYmVuZHkiIHRoZSBzcGxpbmUgaXMgKHRoZSB0aWdodGVyIHRoZSBzcGxpbmUsCiAqIHRoZSBzaGFycGVyIGJlbmRzIGJlY29tZSkgY2FuIGJlIGNvbnRyb2xsZWQgYnkgc2V0dGluZwogKiB0aGUgYHRpZ2h0bmVzc2AgdmFsdWUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgcmFuZ2UoMCwgVEFVLCBQSSAvIDUsIChhKSA9PiBwb2ludHMucHVzaCgKICogICAgICAgICBuZXcgUG9pbnQoCiAqICAgICAgICAgICByYW5kb20oMzApICsgNTAgKiBjb3MoYSksCiAqICAgICAgICAgICByYW5kb20oMzApICsgNTAgKiBzaW4oYSkKICogICAgICAgICApCiAqICAgICAgICkpOwogKiAgICAgICBzZXRNb3ZhYmxlKC4uLnBvaW50cyk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7CiAqICAgICAgIHNldEZpbGwoYCMwMDAyYCk7CiAqICAgICAgIHNwbGluZSguLi5wb2ludHMpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHBvaW50cy5mb3JFYWNoKHAgPT4gcG9pbnQocCkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlW119IC4uLnBvaW50cyBUaGUgcG9pbnRzIGFjcm9zcyB3aGljaCB0byBmaXQgYSBzcGxpbmUKICogQHBhcmFtIHtib29sZWFufSB2aXJ0dWFsPyBXaGV0aGVyIG9yIG5vdCB0byBpbnZlbnQgbmV3IG1hdGhlbWF0aWNhbCBwb2ludHMgdGhhdCBlbnN1cmUgdGhlIGN1cnZlIHN0YXJ0cyBhbmQgZW5kcyBhdCB0aGUgcHJvdmlkZWQgc3RhcnQgYW5kIGVuZCBwb2ludHMuIChkZWZhdWx0ID0gdHJ1ZSkKICogQHBhcmFtIHtudW1iZXJ9IHRpZ2h0bmVzcz8gSG93IHRpZ2h0IHRoaXMgc3BsaW5lIHNob3VsZCBiZSBmaXQgdGhyb3VnaCB0aGUgcG9pbnRzIHByb3ZpZGVkLiBUaGUgaGlnaGVyIHRoZSB0aWdodG5lc3MsIHRoZSBtb3JlIHBvbHlnb25hbCB0aGUgY3VydmUgYmVjb21lcyAoZGVmYXVsdCA9IDEpCiAqCiAqIEBzZWUge0BsaW5rIGJlemllcn0KICogQHNlZSB7QGxpbmsgYnNwbGluZX0KICovCmZ1bmN0aW9uIHNwbGluZSguLi5hcmdzKSB7CiAgbGV0IHBvaW50cyA9IGFyZ3M7CiAgbGV0IHZpcnR1YWwgPSB0cnVlOwogIGxldCBUID0gMTsKCiAgLy8gaWYgdGhlIGxhc3Qgb3Igc2luZ2xlLXRvLWxhc3QgaXMgYSBib29sLCB0aGF0J3MgYHZpcnR1YWxgOgogIGlmICh0eXBlb2YgYXJnc1thcmdzLmxlbmd0aCAtIDFdID09PSBgYm9vbGVhbmApIHsKICAgIFt2aXJ0dWFsXSA9IGFyZ3Muc3BsaWNlKGFyZ3MubGVuZ3RoIC0gMSwgMSk7CiAgfSBlbHNlIGlmICh0eXBlb2YgYXJnc1thcmdzLmxlbmd0aCAtIDJdID09PSBgYm9vbGVhbmApIHsKICAgIFt2aXJ0dWFsXSA9IGFyZ3Muc3BsaWNlKGFyZ3MubGVuZ3RoIC0gMiwgMSk7CiAgfQoKICAvLyBJZiB0aGlzIG1ha2VzIHRoZSBudW1iZXIgb2YgYXJncyBvZGQsIHRoZSBsYXN0IGFyZyBpcyBUCiAgaWYgKGFyZ3MubGVuZ3RoICUgMiA9PT0gMSkgewogICAgW1RdID0gYXJncy5zcGxpY2UoYXJncy5sZW5ndGggLSAxLCAxKTsKICB9CgogIC8vIHRoZW4sIHdlIGNhbiBjb252ZXJ0CiAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBgbnVtYmVyYCkgewogICAgcG9pbnRzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgcG9pbnRzLnB1c2goeyB4OiBhcmdzW2ldLCB5OiBhcmdzW2kgKyAxXSB9KTsKICAgIH0KICB9CgogIGxldCBjcG9pbnRzID0gcG9pbnRzOwogIGlmICh2aXJ0dWFsKSB7CiAgICBjb25zdCBmMCA9IHBvaW50c1swXSwKICAgICAgZjEgPSBwb2ludHNbMV0sCiAgICAgIGYyID0gcG9pbnRzWzJdLAogICAgICBmc20gPSBuZXcgVmVjdG9yKGYwLnggLyAyICsgZjIueCAvIDIsIGYwLnkgLyAyICsgZjIueSAvIDIpLAogICAgICBmMHIgPSBuZXcgVmVjdG9yKGYwKS5yZWZsZWN0KGYxKSwKICAgICAgZnNyID0gZnNtLnJlZmxlY3QoZjEpLAogICAgICBmbiA9IG5ldyBWZWN0b3IoZjByLnggLyAyICsgZnNyLnggLyAyLCBmMHIueSAvIDIgKyBmc3IueSAvIDIpLAogICAgICBsMiA9IHBvaW50cy5hdCgtMyksCiAgICAgIGwxID0gcG9pbnRzLmF0KC0yKSwKICAgICAgbDAgPSBwb2ludHMuYXQoLTEpLAogICAgICBsc20gPSBuZXcgVmVjdG9yKGwwLnggLyAyICsgbDIueCAvIDIsIGwwLnkgLyAyICsgbDIueSAvIDIpLAogICAgICBsMHIgPSBuZXcgVmVjdG9yKGwwKS5yZWZsZWN0KGwxKSwKICAgICAgbG4gPSBuZXcgVmVjdG9yKGwwci54IC8gMiArIGxzbS54IC8gMiwgbDByLnkgLyAyICsgbHNtLnkgLyAyKTsKICAgIGNwb2ludHMgPSBbZm4sIC4uLnBvaW50cywgbG5dOwogIH0KCiAgLy8gZm91ciBwb2ludCBzbGlkaW5nIHdpbmRvdyBvdmVyIHRoZSBzZWdtZW50CiAgY29uc3QgYmV6aWVyUG9pbnRzID0gW107CiAgZm9yIChsZXQgaSA9IDAsIGUgPSBjcG9pbnRzLmxlbmd0aCAtIDM7IGkgPCBlOyBpKyspIHsKICAgIGxldCBbYzEsIGMyLCBjMywgYzRdID0gY3BvaW50cy5zbGljZShpLCBpICsgNCk7CiAgICBsZXQgcDIgPSB7CiAgICAgIHg6IGMyLnggKyAoYzMueCAtIGMxLngpIC8gKDYgKiBUKSwKICAgICAgeTogYzIueSArIChjMy55IC0gYzEueSkgLyAoNiAqIFQpLAogICAgfTsKICAgIGxldCBwMyA9IHsKICAgICAgeDogYzMueCAtIChjNC54IC0gYzIueCkgLyAoNiAqIFQpLAogICAgICB5OiBjMy55IC0gKGM0LnkgLSBjMi55KSAvICg2ICogVCksCiAgICB9OwogICAgaWYgKGkgPT09IDApIGJlemllclBvaW50cy5wdXNoKGMyKTsKICAgIGJlemllclBvaW50cy5wdXNoKHAyLCBwMywgYzMpOwogIH0KCiAgYmV6aWVyKC4uLmJlemllclBvaW50cyk7Cn0KCi8qKgogKiBTdGFydHMgYSAobmV3KSBzaGFwZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYGdvbGRgKTsKICogICAgICAgc3RhcnQoKTsKICogICAgICAgdmVydGV4KDAsaGVpZ2h0LzIpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgMCk7CiAqICAgICAgIHZlcnRleCh3aWR0aCwgaGVpZ2h0LzIpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgaGVpZ2h0KTsKICogICAgICAgZW5kKHRydWUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIGVuZH0KICogQHNlZSB7QGxpbmsgdmVydGV4fQogKiBAc2VlIHtAbGluayBzdGFydFNoYXBlfQogKi8KZnVuY3Rpb24gc3RhcnQoKSB7CiAgaWYgKF9fY3R4LmxpbmVXaWR0aCAlIDIgPT09IDEpIHsKICAgIF9fY3R4LnRyYW5zbGF0ZSgwLjUsIDAuNSk7CiAgfQogIF9fY3R4LmJlZ2luUGF0aCgpOwogIF9fZmlyc3QgPSBmYWxzZTsKfQoKLyoqCiAqIERyYXcgc29tZSB0ZXh0IHRvIHRoZSBzY3JlZW4uIEl0cyBwbGFjZW1lbnQgaXMKICogZGV0ZXJtaW5lZCBieSBib3RoIHRoZSBjb29yZGluYXRlIHByb3ZpZGVkLCBhbmQKICogdGhlIHgveSBhbGlnbm1lbnQgcHJvdmlkZWQuIFZhbGlkIGB4QWxpZ25gIHZhbHVlcwogKiBhcmU6CiAqCiAqIC0gQ0VOVEVSIC0gdGhlIHRleHQgYW5jaG9yIGlzIGluIHRoZSBtaWRkbGUgb2YgdGhlIHRleHQuIFRleHQgaXMgcGxhY2VkIGV2ZW5seSBvbiBlaXRoZXIgc2lkZS4KICogLSBFTkQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIHJpZ2h0IGZvciBMVFIgdGV4dCwgYW5kIG9uIHRoZSBsZWZ0IGZvciBSVEwgdGV4dC4KICogLSBMRUZUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIHRleHQuIGFsbCB0ZXh0IGlzIHRvIHRoZSByaWdodC4KICogLSBSSUdIVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgdGV4dC4gQWxsIHRleHQgaXMgdG8gdGhlIGxlZnQuCiAqIC0gU1RBUlQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIGxlZnQgZm9yIExUUiB0ZXh0LCBhbmQgb24gdGhlIHJpZ2h0IGZvciBSVEwgdGV4dC4KICoKICogVmFsaWQgYHlBbGlnbmAgdmFsdWVzIGFyZToKICoKICogLSBBTFBIQUJFVElDIC0gc3RhbmRhcmQgdGV4dCBhbGlnbm1lbnQKICogLSBCT1RUT00gLSB0aGUgdGV4dCBpcyBhbGlnbmVkIHRvIHRoZSBib3R0b20gb2YgdGhlIGJvdW5kaW5nIGJveAogKiAtIEhBTkdJTkcgLSByZWxldmFudCBmb3IgVGliZXRhbiBhbmQgb3RoZXIgSW5kaWMgc2NyaXB0cy4KICogLSBJREVPR1JBUEhJQyAtIHJlbGV2YW50IGZvciBpZGVvZ3JhcGhpYyBDSktWIHRleHQuCiAqIC0gTUlERExFIC0gVGhlIHZlcnRpY2FsIGVxdWl2YWxlbnQgb2YgImNlbnRlciIuCiAqIC0gVE9QIC0gVGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgdG9wIG9mIHRoZSB0eXBvZ3JhcGhpYyAiZW0gc3F1YXJlIi4KICoKICogTm90ZSB0aGF0IHRoZSBwcmltYXJ5IHRleHQgY29sb3VyIHVzZXMgdGhlIGZpbGwgY29sb3VyLiBJZiB0ZXh0CiAqIHN0cm9raW5nIGlzIGVuYWJsZWQsIHRoZSB0aGUgdGV4dCBvdXRsaW5lIHdpbGwgYmUgY29sb3VyZWQgdXNpbmcKICogdGhlIGN1cnJlbnQgc3Ryb2tlIGNvbG91ci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KCJub3JtYWwgdGV4dCIsIHdpZHRoLzIsIDYwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKDEpOwogKiAgICAgICB0ZXh0KCJ1bmZpbGxlZCB0ZXh0Iiwgd2lkdGgvMiwgMTAwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICAgIHNldFN0cm9rZShgcmVkYCk7CiAqICAgICAgIHNldEZpbGwoYHllbGxvd2ApOwogKiAgICAgICB0ZXh0KCJmYW5jeSB0ZXh0Iiwgd2lkdGgvMiwgMTQwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgdGV4dCB3ZSB3YW50IHRvIHNob3cKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHRleHQgbG9jYXRpb24ncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSB0ZXh0IGxvY2F0aW9uJ3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge3N0cmluZ30geEFsaWduPyBBbiBvcHRpb25hbCBob3Jpem9udGFsIGFsaWdubWVudCBzdHJpbmcKICogQHBhcmFtIHtzdHJpbmd9IHlBbGlnbj8gQW4gb3B0aW9uYWwgdmVydGljYWwgIGFsaWdubWVudCBzdHJpbmcKICoKICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgdGV4dCB3ZSB3YW50IHRvIHNob3cKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHRleHQgbG9jYXRpb24ncyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7c3RyaW5nfSB4QWxpZ24/IEFuIG9wdGlvbmFsIGhvcml6b250YWwgYWxpZ25tZW50IHN0cmluZwogKiBAcGFyYW0ge3N0cmluZ30geUFsaWduPyBBbiBvcHRpb25hbCB2ZXJ0aWNhbCAgYWxpZ25tZW50IHN0cmluZwogKgogKiBAc2VlIHtAbGluayBzZXRUZXh0U3Ryb2tlfQogKi8KZnVuY3Rpb24gdGV4dChzdHIsIHgsIHksIHhBbGlnbiwgeUFsaWduKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5QWxpZ24gPSB4QWxpZ247CiAgICB4QWxpZ24gPSB5OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBzYXZlKCk7CiAgaWYgKHhBbGlnbikgewogICAgc2V0VGV4dEFsaWduKHhBbGlnbiwgeUFsaWduKTsKICB9CiAgX19jdHguZmlsbFRleHQoc3RyLCB4LCB5KTsKICBpZiAoX190ZXh0U3Ryb2tlKSB7CiAgICBzZXRTdHJva2UoX190ZXh0U3Ryb2tlKTsKICAgIF9fY3R4LnN0cm9rZVRleHQoc3RyLCB4LCB5KTsKICB9CiAgcmVzdG9yZSgpOwp9CgovKioKICogRHJhdyBhIHRyaWFuZ2xlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHRyaWFuZ2xlKHdpZHRoLzIsIDMwLCAxLzQgKiB3aWR0aCwgMTYwLCAzLzQgKiB3aWR0aCwgMTEwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geDEgVGhlIGZpcnN0IHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTEgVGhlIGZpcnN0IHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geDIgVGhlIHNlY29uZCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkyIFRoZSBzZWNvbmQgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB4MyBUaGUgdGhpcmQgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MyBUaGUgdGhpcmQgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMSBUaGUgZmlyc3QgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMiBUaGUgc2Vjb25kIHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDMgVGhlIHRoaXJkIHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKi8KZnVuY3Rpb24gdHJpYW5nbGUoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykgewogIGlmICh4MS54ICE9PSB1bmRlZmluZWQgJiYgeDEueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5MyA9IHgyLnk7CiAgICB4MyA9IHgyLng7CiAgICB5MiA9IHkxLnk7CiAgICB4MiA9IHkxLng7CiAgICB5MSA9IHgxLnk7CiAgICB4MSA9IHgxLng7CiAgfQoKICBzdGFydCgpOwogIHZlcnRleCh4MSwgeTEpOwogIHZlcnRleCh4MiwgeTIpOwogIHZlcnRleCh4MywgeTMpOwogIHZlcnRleCh4MSwgeTEpOwogIGVuZCgpOwp9CgovKioKICogQWRkIGEgdmVydGV4IHRvIHRoZSBjdXJyZW50bHkgYWN0aXZlIHNoYXBlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHN0YXJ0KCk7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCAzMCk7CiAqICAgICAgIHZlcnRleCgxLzQgKiB3aWR0aCwgMTYwKTsKICogICAgICAgdmVydGV4KDMvNCAqIHdpZHRoLCAxMTApOwogKiAgICAgICBlbmQoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgdmVydGV4J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgdmVydGV4J3MgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgdmVydGV4IHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgZW5kfQogKiBAc2VlIHtAbGluayBzdGFydH0KICovCmZ1bmN0aW9uIHZlcnRleCh4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgaWYgKF9fZmlyc3QpIHsKICAgIF9fY3R4LmxpbmVUbyh4LCB5KTsKICB9IGVsc2UgewogICAgX19maXJzdCA9IHsgeCwgeSB9OwogICAgX19jdHgubW92ZVRvKHgsIHkpOwogIH0KfQovKioKICogQ3JlYXRlIGFuIGFycmF5IG9mIHNwZWNpZmllZCBsZW5ndGgsIG9wdGlvbmFsbHkgZmlsbGVkIHVzaW5nIGEKICogZnVuY3Rpb24gdGhhdCB0YWtlcyB0aGUgZWxlbWVudCBpbmRleCBhcyBzaW5nbGUgaW5wdXQgYXJndW1lbnQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHRyYW5zbGF0ZSgwLCBoZWlnaHQvMik7CiAqICAgICAgIGxldCBkYXRhID0gYXJyYXkod2lkdGgsIChpKSA9PiBbaSwgaGVpZ2h0LzIgKiBzaW4oaS8yNSldKTsKICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAqICAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggVGhlIHNpemUgb2YgdGhlIGFycmF5IHlvdSB3YW50CiAqIEBwYXJhbSB7RnVuY3Rpb259IGZpbGxGdW5jdGlvbj8gVGhlIG9wdGlvbmFsIGZ1bmN0aW9uIHRoYXQgZ2V0cyB1c2VkIHRvIGZpbGwgdGhlIGFycmF5CiAqLwpmdW5jdGlvbiBhcnJheShsZW4sIGZpbGxGdW5jdGlvbikgewogIGNvbnN0IGFyciA9IG5ldyBBcnJheShsZW4pLmZpbGwoKTsKICBpZiAoZmlsbEZ1bmN0aW9uKSB7CiAgICByZXR1cm4gYXJyLm1hcCgoXywgaSkgPT4gZmlsbEZ1bmN0aW9uKGkpKTsKICB9CiAgcmV0dXJuIGFycjsKfQoKLyoqCiAqIEVtcHR5IHRoZSBsaXN0IG9mIG1vdmFibGUgcG9pbnRzIGluIHlvdXIgZ3JhcGhpYy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRCdXR0b24oYGxvY2tgLCAoKSA9PiB7CiAqICAgICAgICAgY2xlYXJNb3ZhYmxlKCk7CiAqICAgICAgICAgcmVkcmF3KCk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGZvcihsZXQgcCBvZiBwb2ludHMpIHsKICogICAgICAgICBzZXRDb2xvcihpc01vdmFibGUocCkgPyBgcmVkYCA6IGBncmV5YCk7CiAqICAgICAgICAgcG9pbnQocCk7CiAqICAgICAgIH0KICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgseSkgewogKiAgICAgICBpZiAoY3VycmVudE1vdmFibGUpIHJldHVybjsKICogICAgICAgY29uc3QgcCA9IG5ldyBQb2ludCh4LHkpOwogKiAgICAgICBwb2ludHMucHVzaChwKTsKICogICAgICAgc2V0TW92YWJsZShwKTsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgaXNNb3ZhYmxlfQogKiBAc2VlIHtAbGluayBzZXRNb3ZhYmxlfQogKi8KZnVuY3Rpb24gY2xlYXJNb3ZhYmxlKCkgewogIF9fbW92YWJsZV9wb2ludHMuc3BsaWNlKDAsIF9fbW92YWJsZV9wb2ludHMubGVuZ3RoKTsKfQoKLyoqCiAqIENyZWF0ZSBhIGNvcHkgb2YgdGhlIGN1cnJlbnQgY2FudmFzIGVsZW1lbnQKICogZm9yIHVzZSBzb21ld2hlcmUgZWxzZSBpbiB5b3VyIG93biBjb2RlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHBpbmtgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgseSkgewogKiAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KAogKiAgICAgICAgIG5ldyBDdXN0b21FdmVudChgZ3JhcGhpY3M6dXBkYXRlYCwgewogKiAgICAgICAgICAgZGV0YWlsOiB7CiAqICAgICAgICAgICAgIGNhbnZhczogY29weSgpCiAqICAgICAgICAgICB9CiAqICAgICAgICAgfSkKICogICAgICAgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcmV0dXJucyB7SFRNTENhbnZhc0VsZW1lbnR9IEEgY29weSBvZiB0aGUgY3VycmVudCBjYW52YXMKICovCmZ1bmN0aW9uIGNvcHkoKSB7CiAgY29uc3QgY29weSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGNhbnZhc2ApOwogIGNvcHkud2lkdGggPSB3aWR0aDsKICBjb3B5LmhlaWdodCA9IGhlaWdodDsKICBjb25zdCBjdHggPSBjb3B5LmdldENvbnRleHQoYDJkYCk7CiAgY3R4LmRyYXdJbWFnZShfX2NhbnZhcywgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgcmV0dXJuIGNvcHk7Cn0KCi8qKgogKiBHZW5lcmF0ZXMgYSBjb2xvciBiYXNlZCBvbiB0aGUgSFNMIGNvbG9yIHNwYWNlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoY29sb3IoNDUsIDgwLCA5MCkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBodWUgaW4gdGhlIHJhbmdlIFswLCAzNjBdCiAqIEBwYXJhbSB7bnVtYmVyfSBzYXR1cmF0aW9uIGluIHRoZSByYW5nZSBbMCwgMTAwXQogKiBAcGFyYW0ge251bWJlcn0gbGlnaHRuZXNzIGluIHRoZSByYW5nZSBbMCwgMTAwXQogKiBAcGFyYW0ge251bWJlcn0gb3BhY2l0eSBpbiB0aGUgcmFuZ2UgWzAsIDFdCiAqIEByZXR1cm5zIHtzdHJpbmd9IEEgQ1NTIGhzbGEgY29sb3Igc3RyaW5nCiAqCiAqIEBzZWUge0BsaW5rIHJhbmRvbUNvbG9yfQogKi8KZnVuY3Rpb24gY29sb3IoaCA9IF9fY3VycmVudF9odWUsIHMgPSA1MCwgbCA9IDUwLCBhID0gMSkgewogIHJldHVybiBgaHNsYSgke2h9LCR7c30lLCR7bH0lLCR7YX0pYDsKfQoKLyoqCiAqIEZpbmQgYW4gSFRNTCBlbGVtZW50IGluc2lkZSB5b3VyIGdyYXBoaWNzLWVsZW1lbnQKICogYnkgcXVlcnkgc2VsZWN0b3IuIFRoaXMgaXMgZXF1aXZhbGVudCB0bzoKICoKICogYGBgCiAqIHlvdXJFbGVtZW50LnF1ZXJ5U2VsZWN0b3IocXMpCiAqIGBgYAogKgogKiBAcGFyYW0ge3N0cmluZ30gcXVlcnlTZWxlY3RvciBBIHF1ZXJ5IHNlbGVjdG9yCiAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxudWxsfSBUaGUgbWF0Y2hlZCBlbGVtZW50LCBvciBudWxsIGlmIHRoZXJlIHdhcyBubyBtYXRjaC4KICovCmZ1bmN0aW9uIGZpbmQocXMpIHsKICByZXR1cm4gX19lbGVtZW50LnF1ZXJ5U2VsZWN0b3IocXMpOwp9CgovKioKICogRmluZCBhbGwgSFRNTCBlbGVtZW50cyBpbnNpZGUgeW91ciBncmFwaGljcy1lbGVtZW50CiAqIHRoYXQgbWF0Y2ggYSBnaXZlbiBxdWVyeSBzZWxlY3Rvci4gVGhpcyBpcyBlcXVpdmFsZW50IHRvOgogKgogKiBgYGAKICogQXJyYXkuZnJvbSh5b3VyRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHFzKSkKICogYGBgCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBxdWVyeVNlbGVjdG9yIEEgcXVlcnkgc2VsZWN0b3IKICogQHJldHVybnMge0hUTUxFbGVtZW50W119IEFuIGFycmF5IHdpdGggYWxsIG1hdGNoaW5nIGVsZW1lbnRzLCBbXSBpZiB0aGVyZSB3ZXJlIG5vIG1hdGNoZXMuCiAqLwpmdW5jdGlvbiBmaW5kQWxsKHFzKSB7CiAgcmV0dXJuIFsuLi5fX2VsZW1lbnQucXVlcnlTZWxlY3RvckFsbChxcyldOwp9CgovKioKICogTWFyayBhIHNwZWNpZmljIGNvbG9yIGFzIHRoZSBoaWdobGlnaHQgY29sb3IsCiAqIHdoaWNoIGNhdXNlcyB0aGUgZ3JhcGhpYyB0byByZWRyYXcgd2l0aCB0aGF0CiAqIGNvbG9yIHJlcGxhY2VkIGJ5IHdoaWNoZXZlciBjb2xvciB5b3UgcGlja2VkCiAqIGFzIGhpZ2hsaWdodCBjb2xvci4KICoKICogTm90ZSB0aGF0IHlvdSBjYW4gb25seSB1c2UgbmFtZWQgKENTUykgY29sb3JzCiAqIHdpdGggdGhpcyBmdW5jdGlvbi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0SGlnaGxpZ2h0Q29sb3IoYGxpbWVgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KCJsZXQncyBnbyIsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICBpZiAoc3RhdGUpIGhpZ2hsaWdodChgcmVkYCk7CiAqICAgICAgIGVsc2UgaGlnaGxpZ2h0KGZhbHNlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge2NvbG9yfGJvb2xlYW59IGNvbG9yIFNldCB0aGUgY29sb3IgdGhhdCBzaG91bGQgZ2V0IHJlcGxhY2VkIHdpdGggdGhlIGhpZ2hsaWdodCBjb2xvciwgb3IgZGlzYWJsZSBoaWdobGlnaHQgd2hlbiBjb2xvciBpcyBgZmFsc2VgCiAqCiAqIEBzZWUge0BsaW5rIHNldEhpZ2hsaWdodENvbG9yfQogKi8KZnVuY3Rpb24gaGlnaGxpZ2h0KGNvbG9yKSB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdKSB7CiAgICBfX2hpZ2hsaWdodF9jb2xvciA9IENTU19DT0xPUl9NQVBbY29sb3JdOwogIH0gZWxzZSB7CiAgICBfX2hpZ2hsaWdodF9jb2xvciA9IGNvbG9yOwogIH0KICByZWRyYXcoKTsKfQoKLyoqCiAqIENoZWNrIHdoZXRoZXIgYSBwb2ludCBpcyByZWdpc3RlcmVkIGFzIG1vdmFibGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGBsb2NrYCwgKCkgPT4gewogKiAgICAgICAgIGNsZWFyTW92YWJsZSgpOwogKiAgICAgICAgIHJlZHJhdygpOwogKiAgICAgICB9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBmb3IobGV0IHAgb2YgcG9pbnRzKSB7CiAqICAgICAgICAgc2V0Q29sb3IoaXNNb3ZhYmxlKHApID8gYHJlZGAgOiBgZ3JleWApOwogKiAgICAgICAgIHBvaW50KHApOwogKiAgICAgICB9CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bih4LHkpIHsKICogICAgICAgaWYgKGN1cnJlbnRNb3ZhYmxlKSByZXR1cm47CiAqICAgICAgIGNvbnN0IHAgPSBuZXcgUG9pbnQoeCx5KTsKICogICAgICAgcG9pbnRzLnB1c2gocCk7CiAqICAgICAgIHNldE1vdmFibGUocCk7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBUaGUgcG9pbnQgdGhhdCB3ZSB3YW50IHRvIGNoZWNrICJtb3ZhYmlsaXR5IiBmb3IKICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgb3VyIHBvaW50IGlzIGluIHRoZSBsaXN0IG9mIG1vdmFibGUgcG9pbnRzLCBvdGhlcndpc2UgZmFsc2UKICoKICogQHNlZSB7QGxpbmsgY2xlYXJNb3ZhYmxlfQogKiBAc2VlIHtAbGluayBzZXRNb3ZhYmxlfQogKi8KZnVuY3Rpb24gaXNNb3ZhYmxlKHBvaW50KSB7CiAgcmV0dXJuIF9fbW92YWJsZV9wb2ludHMuaW5jbHVkZXMocG9pbnQpOwp9CgovKioKICogR2V0IHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRoYXQgdGhpcwogKiBncmFwaGljIGhhcyBiZWVuIHJ1bm5pbmcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIGNvbnN0IHNlY29uZHMgPSAobWlsbGlzKCkvMTAwMCl8MDsKICogICAgICAgdGV4dChgJHtzZWNvbmRzfXNgLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcmV0dXJucyB7bnVtYmVyfSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHNpbmNlIHRoZSBncmFwaGljIGxvYWRlZCBpbgogKi8KZnVuY3Rpb24gbWlsbGlzKCkgewogIHJldHVybiBEYXRlLm5vdygpIC0gX19zdGFydF90aW1lOwp9CgovKioKICogUGF1c2UgdGhlIGdyYXBoaWMgaWYgaXRzIGN1cnJlbnRseSBwbGF5aW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBjb25zdCBzZWNvbmRzID0gKG1pbGxpcygpLzEwMDApLnRvRml4ZWQoMSk7CiAqICAgICAgIHRleHQoYCR7c2Vjb25kc31zYCwgd2lkdGgvMiwgaGVpZ2h0LzIpCiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyQWN0aXZlKHN0YXRlKSB7CiAqICAgICAgIGlmKHN0YXRlKSB7CiAqICAgICAgICAgcGF1c2UoKTsKICogICAgICAgfSBlbHNlIHsKICogICAgICAgICBwbGF5KCk7CiAqICAgICAgIH0KICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBwbGF5fQogKiBAc2VlIHtAbGluayB0b2dnbGVQbGF5fQogKi8KZnVuY3Rpb24gcGF1c2UoKSB7CiAgcGxheWluZyA9IGZhbHNlOwp9CgovKioKICogU3RhcnQgcGxheWluZyB5b3VyIGdyYXBoaWMsIG1lYW5pbmcgaXQgd2lsbCBjYWxsIGRyYXcoKQogKiBhdCB3aGF0ZXZlciByYXRlIHRoZSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgbG9vcCBpcwogKiBhbGxvd2VkIHRvIHJ1biBvbiB5b3VyIGNvbXB1dGVyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgbGV0IGZwcyA9IDA7CiAqICAgICBsZXQgY2hlY2tlZCA9IGZhbHNlOwogKiAgICAgbGV0IGxhc3RGcmFtZUNoZWNrID0gMDsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKS50b0ZpeGVkKDEpOwogKiAgICAgICB0ZXh0KGBmcHM6ICR7ZnBzfWAsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgICBpZiAoc2Vjb25kcy5lbmRzV2l0aChgLjBgKSkgewogKiAgICAgICAgIGlmICghY2hlY2tlZCkgewogKiAgICAgICAgICAgY2hlY2tlZCA9IHRydWU7CiAqICAgICAgICAgICBmcHMgPSBmcmFtZSAtIGxhc3RGcmFtZUNoZWNrOwogKiAgICAgICAgICAgbGFzdEZyYW1lQ2hlY2sgPSBmcmFtZTsKICogICAgICAgICB9CiAqICAgICAgIH0gZWxzZSB7CiAqICAgICAgICAgY2hlY2tlZCA9IGZhbHNlOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgcGF1c2V9CiAqIEBzZWUge0BsaW5rIHRvZ2dsZVBsYXl9CiAqLwpmdW5jdGlvbiBwbGF5KCkgewogIHBsYXlpbmcgPSB0cnVlOwogIF9fZHJhdygpOwp9CgovKioKICogR2VuZXJhdGUgYSByYW5kb20gY29sb3VyLiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbgogKiBhbGxvd3MgeW91IHRvIGdldCAidGhlIGN1cnJlbnRseSBnZW5lcmF0ZWQgcmFuZG9tCiAqIGNvbG91ciIgaW4gZGlmZmVyZW50IG9wYWNpdGllcyBieSBjYWxsaW5nIHRoZSBmdW5jdGlvbgogKiB3aXRoIGFuIG9wYWNpdHkgdmFsdWUsIGFuZCBgZmFsc2VgIGFzIGN5Y2xlIGFyZ3VtZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIocmFuZG9tQ29sb3IoKSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bigpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICoKICogQHBhcmFtIHtudW1iZXJ9IG9wYWNpdHkgVGhlIG9wYWNpdHkgdmFsdWUgaW4gdGhlIHJhbmdlIFswLDFdCiAqIEBwYXJhbSB7bnVtYmVyfSBjeWNsZT8gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IHRvIG1vdmUgb24gdG8gdGhlIG5leHQgY29sb3VyIChkZWZhdWx0ID0gdHJ1ZSkKICoKICogQHNlZSB7QGxpbmsgY29sb3J9CiAqLwpmdW5jdGlvbiByYW5kb21Db2xvcihhID0gMS4wLCBjeWNsZSA9IHRydWUpIHsKICBpZiAoY3ljbGUpIF9fY3VycmVudF9odWUgPSByYW5kb20oMCwgMzYwKTsKICByZXR1cm4gYGhzbGEoJHtfX2N1cnJlbnRfaHVlfSw1MCUsNTAlLCR7YX0pYDsKfQoKLyoqCiAqIEFuIGFsdGVybmF0aXZlIHRvIHdyaXRpbmcgZm9yIGxvb3BzLCBiZWNhdXNlCiAqIG5vIG9uZSB3YW50cyB0byBjb25zdGFudGx5IHdyaXRlIHZhciBhbGxvY2F0aW9ucwogKiB0aGF0IG9ubHkgbGl2ZSBmb3IgdGhlIGR1cmF0aW9uIG9mIGEgbG9vcC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICByYW5nZSgwLCBUQVUsIChhKSA9PiBwb2ludCg0MCAqIGNvcyhhKSwgNDAgKiBzaW4oYSkpKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgVGhlIGVxdWl2YWxlbnQgb2YgYSBmb3IgbG9vcCdzIGluaXRpYWwgYGxldCBpID0gLi4uYAogKiBAcGFyYW0ge251bWJlcn0gZW5kIFRoZSBlcXVpdmFsZW50IG9mIGEgZm9yIGxvb3AncyBgaSA8IGVuZGAKICogQHBhcmFtIHtudW1iZXJ9IHN0ZXA/IFRoZSBzdGVwIHNpemUgYnkgd2hpY2ggdG8gaW5jcmVtZW50IGF0IGVhY2ggaXRlcmF0aW9uIChkZWZhdWx0cyA9IGAoc3RhcnQtZW5kKS8xMGApCiAqIEBwYXJhbSB7RnVuY3Rpb259IHJ1bkZ1bmN0aW9uIFRoZSBmdW5jdGlvbiB0byBydW4gYXQgZWFjaCBpdGVyYXRpb24KICovCmZ1bmN0aW9uIHJhbmdlKHN0YXJ0LCBlbmQsIHN0ZXAsIHJ1bkZ1bmN0aW9uKSB7CiAgaWYgKHR5cGVvZiBzdGVwID09PSBgZnVuY3Rpb25gKSB7CiAgICBydW5GdW5jdGlvbiA9IHN0ZXA7CiAgICBzdGVwID0gKGVuZCAtIHN0YXJ0KSAvIDEwOwogIH0KICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkgKz0gc3RlcCkgewogICAgcnVuRnVuY3Rpb24oaSk7CiAgfQp9CgovKioKICogU2FmZWx5IHRyaWdnZXIgYSBuZXcgZHJhdyBwYXNzLiBJZiB0aGUgZ3JhcGhpYyBpcyBydW5uaW5nCiAqIGluIGFuaW1hdGVkIG1vZGUsIG9yIGEgcmVkcmF3KCkgaXMgdHJpZ2dlcmVkIF9kdXJpbmdfIGEKICogcmVkcmF3KCksIHRoaXMgY2FsbCB3aWxsIGRvIG5vdGhpbmcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjb25zdCBoID0gbWFwKHBvaW50ZXIueCwgMCwgd2lkdGgsIDAsIDM2MCk7CiAqICAgICAgIGNvbnN0IGwgPSBtYXAocG9pbnRlci55LCAwLCBoZWlnaHQsIDUwLCAwKTsKICogICAgICAgY2xlYXIoY29sb3IoaCwgMTAwLCBsKSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSgpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIHJlZHJhdygpIHsKICBpZiAoX19yZWRyYXdpbmcpIHJldHVybjsKICBpZiAocGxheWluZykgcmV0dXJuOwogIF9fcmVkcmF3aW5nID0gdHJ1ZTsKICBfX2RyYXcoKTsKICBfX3JlZHJhd2luZyA9IGZhbHNlOwp9CgovKioKICogUmVzdG9yZSB0aGUgZ3JhcGhpY3MgY29udGV4dCAodHJhbnNmb3JtcywKICogY3VycmVudCBjb2xvcnMsIGV0YykgdG8gd2hhdCB0aGV5IHdlcmUKICogd2hlbiBzYXZlKCkgd2FzIGNhbGxlZC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZSgwLDAsODAsMCk7CiAqICAgICAgIHNhdmUoKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApCiAqICAgICAgIHJhbmdlKDAsIDUsIDEsIChhKSA9PiB7CiAqICAgICAgICAgcm90YXRlKFBJLzgpOwogKiAgICAgICAgIGxpbmUoMCwwLDgwLDApOwogKiAgICAgICB9KTsKICogICAgICAgcmVzdG9yZSgpOwogKiAgICAgICBsaW5lKC0yMCwwLC04MCwwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzYXZlfQogKi8KZnVuY3Rpb24gcmVzdG9yZSgpIHsKICBfX2N0eC5yZXN0b3JlKCk7Cn0KCi8qKgogKiBNYXJrIG9uZSBvciBtb3JlIHBvaW50cyBhcyBtb3ZhYmxlLCBtZWFuaW5nCiAqIHRoYXQgdGhlIHVzZXIgY2FuIHJlcG9zaXRpb24gdGhlIHBvaW50IGFyb3VuZCBvbgogKiB0aGUgY2FudmFzIGJ5IHRvdWNoL2NsaWNrLWRyYWdnaW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGZvciAobGV0IGkgPSA0MDsgaSA8IDIwMDsgaSArPSAyMCkgewogKiAgICAgICAgIHBvaW50cy5wdXNoKG5ldyBQb2ludChpIC0gMjAsIDEyMCkpOwogKiAgICAgICB9CiAqICAgICAgIHNldE1vdmFibGUoLi4ucG9pbnRzKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICBzZXRTdHJva2UoYHB1cnBsZWApOwogKiAgICAgICBic3BsaW5lKC4uLnBvaW50cyk7CiAqICAgICAgIGZvcihsZXQgcCBvZiBwb2ludHMpIHBvaW50KHApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlW25dfSBwb2ludHMgT25lIG9yIG1vcmUgcG9pbnRzIHRvIG1hcmsgYXMgbW92YWJsZS4KICoKICogQHNlZSB7QGxpbmsgaXNNb3ZhYmxlfQogKiBAc2VlIHtAbGluayBjbGVhck1vdmFibGV9CiAqLwpmdW5jdGlvbiBzZXRNb3ZhYmxlKC4uLnBvaW50cykgewogIHBvaW50cy5mb3JFYWNoKChwKSA9PiB7CiAgICBpZiAoX19tb3ZhYmxlX3BvaW50cy5pbmRleE9mKHApID09PSAtMSkgewogICAgICBfX21vdmFibGVfcG9pbnRzLnB1c2gocCk7CiAgICB9CiAgfSk7Cn0KCi8qKgogKiBTZXQgKG9yIGNoYW5nZSkgdGhlIGdyYXBoaWMncyBzaXplLiBOb3RlIHRoYXQgeW91ciB3aWR0aAogKiBhbmQgaGVpZ2h0IHZhbHVlcyB3aWxsIGdldCByb3VuZGVkIHRvIGludGVnZXIgdmFsdWVzLgogKgogKiBOb3RlIHRoYXQgYHNldFNpemVgIHdpbGwgaW1tZWRpYXRlbHkgdHJpZ2dlciBhIHJlZHJhdywKICogd2hldGhlciB5b3Ugd2FudCBpdCB0byBvciBub3QsIGJlY2F1c2UgY2hhbmdpbmcgY2FudmFzCiAqIGRpbWVuc2lvbnMgY2xlYXJzIHRoZSBjYW52YXMsIG5lY2Vzc2l0YXRpbmcgYSByZWRyYXcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSg0MDAsIDIwMCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBjZW50ZXIoKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCkKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KGAke3dpZHRofS8ke2hlaWdodH1gLCAwLCAwLCBDRU5URVIsIE1JRERMRSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyVXAoKSB7CiAqICAgICAgIHNldFNpemUocmFuZG9tKDEwMCw0MDApLCAyMDApOwogKiAgICAgICAvLyBOb3RlIHRoYXQgdGhlcmUgaXMgbm8gcmVkcmF3KCkgaGVyZSEKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gd2lkdGggVGhlIGdyYXBoaWNzIHdpZHRoIGluIHBpeGVscwogKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IFRoZSBncmFwaGljcyBoZWlnaHQgaW4gcGl4ZWxzCiAqLwpmdW5jdGlvbiBzZXRTaXplKHcgPSA0MDAsIGggPSAyMDApIHsKICB3aWR0aCA9IF9fY2FudmFzLndpZHRoID0gdyB8IDA7CiAgaGVpZ2h0ID0gX19jYW52YXMuaGVpZ2h0ID0gaCB8IDA7CiAgX19lbGVtZW50LnN0eWxlLm1heFdpZHRoID0gYGNhbGMoMmVtICsgJHt3aWR0aH1weGA7CiAgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwogIF9fZHJhdygpOwp9CgovKioKICogU2F2ZSB0aGUgY3VycmVudCBncmFwaGljcyBjb250ZXh0ICh0cmFuc2Zvcm1zLAogKiBjdXJyZW50IGNvbG9ycywgZXRjKSBzbyB0aGF0IHRob3NlIGNhbiBiZSByZXN0b3JlZAogKiBhZnRlciBjaGFuZ2luZyB0aGVtLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICBsaW5lKDAsMCw4MCwwKTsKICogICAgICAgc2F2ZSgpOwogKiAgICAgICBzZXRDb2xvcihgZGFya2dyZWVuYCkKICogICAgICAgcmFuZ2UoMCwgNSwgMSwgKGEpID0+IHsKICogICAgICAgICByb3RhdGUoUEkvOCk7CiAqICAgICAgICAgbGluZSgwLDAsODAsMCk7CiAqICAgICAgIH0pOwogKiAgICAgICByZXN0b3JlKCk7CiAqICAgICAgIGxpbmUoLTIwLDAsLTgwLDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqICogQHNlZSB7QGxpbmsgcmVzdG9yZX0KICovCmZ1bmN0aW9uIHNhdmUoKSB7CiAgX19jdHguc2F2ZSgpOwp9CgovKioKICogQ29udmVydCB0aGUgY3VycmVudCBjYW52YXMgaW50byBhbiBkYXRhIFVSTAogKiB0aGF0IHJlcHJlc2VudHMgYSBQTkcgaW1hZ2UuCiAqCiAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBjdXJyZW50IGNhbnZhcyBhcyBQTkcgZGF0YSBVUkwKICovCmZ1bmN0aW9uIHRvRGF0YVVSTCgpIHsKICByZXR1cm4gX19jYW52YXMudG9EYXRhVVJMKCk7Cn0KCi8qKgogKiBJZiB0aGUgZ3JhcGhpYyBpcyBjdXJyZW50bHkgcGxheWluZywgcGF1c2UgaXQsCiAqIGFuZCBpZiBpdCdzIHBhdXNlZCwgcGxheSBpdC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKS50b0ZpeGVkKDEpOwogKiAgICAgICB0ZXh0KGAke3NlY29uZHN9c2AsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICB0b2dnbGVQbGF5KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge2Jvb2xlYW59IFRoZSBuZXcgcGxheSBzdGF0ZQogKgogKiBAc2VlIHtAbGluayBwYXVzZX0KICogQHNlZSB7QGxpbmsgcGxheX0KICovCmZ1bmN0aW9uIHRvZ2dsZVBsYXkoKSB7CiAgcGxheWluZyA/IHBhdXNlKCkgOiBwbGF5KCk7CiAgcmV0dXJuIHBsYXlpbmc7Cn0KY29uc3QgewogIC8qKgogICAqIEdldCB0aGUgYWJzb2x1dGUgdmFsdWUgZm9yIHNvbWUgaW5wdXQKICAgKgogICAqIEV4YW1wbGU6CiAgICoKICAgKiA8Z3JhcGhpY3MtZWxlbWVudD4KICAgKiAgIDxncmFwaGljcy1zb3VyY2U+CiAgICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAgICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAgICogICAgICAgdHJhbnNsYXRlKDAsIGhlaWdodC8yKTsKICAgKiAgICAgICBub0ZpbGwoKTsKICAgKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAgICogICAgICAgbGluZSgtaHVnZSwgMCwgaHVnZSwgMCk7CiAgICoKICAgKiAgICAgICBjb25zdCB3MiA9IHdpZHRoLzI7CiAgICogICAgICAgY29uc3QgZGF0YSA9IGFycmF5KHdpZHRoLCAoeCkgPT4gW3gsIHggLSB3MiwgYWJzKHggLSB3MildKTsKICAgKgogICAqICAgICAgIHNldFN0cm9rZShgcmVkYCk7CiAgICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAgICoKICAgKiAgICAgICBzZXRTdHJva2UoYGJsdWVgKTsKICAgKiAgICAgICBwbG90RGF0YShkYXRhLCAwLCAyKTsKICAgKiAgICAgfQogICAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAgICogPC9ncmFwaGljcy1lbGVtZW50PgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IHYgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnB1dCB2YWx1ZSB3aXRoIGl0cyBzaWduIHNldCB0byBwb3NpdGl2ZQogICAqLwogIGFicywKCiAgLyoqCiAgICogVGhlIGludmVyc2UgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gdiBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludmVyc2UgY29zaW5lIG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBhc2lufQogICAqIEBzZWUge0BsaW5rIGFjb3NofQogICAqLwogIGFjb3MsCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGludmVyc2UgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBoeXBlcmJvbGljIGludmVyc2UgY29zaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBhc2luaH0KICAgKiBAc2VlIHtAbGluayBhY29zfQogICAqLwogIGFjb3NoLAoKICAvKioKICAgKiBUaGUgaW52ZXJzZSBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnZlcnNlIHNpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGFjb3N9CiAgICogQHNlZSB7QGxpbmsgYXNpbmh9CiAgICovCiAgYXNpbiwKCiAgLyoqCiAgICogVGhlIGh5cGVyYm9saWMgaW52ZXJzZSBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBoeXBlcmJvbGljIGludmVyc2Ugc2luZQogICAqCiAgICogQHNlZSB7QGxpbmsgYWNvc2h9CiAgICogQHNlZSB7QGxpbmsgYXNpbn0KICAgKi8KICBhc2luaCwKCiAgLyoqCiAgICogVGhlIGludmVyc2UgdGFuZ2VudCBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaW52ZXJzZSB0YW5nZW50CiAgICoKICAgKiBAc2VlIHtAbGluayB0YW59CiAgICovCiAgYXRhbiwKCiAgLyoqCiAgICogVGhlICJhdGFuMiIgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9BdGFuMgogICAqCiAgICogQHBhcmFtIHt5fSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHBhcmFtIHt4fSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGF0YW4yIGFuZ2xlIGZvciB0aGlzIG51bWJlciBwYWlyCiAgICovCiAgYXRhbjIsCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGludmVyc2UgdGFuZ2VudCBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIHRhbmdlbnQKICAgKgogICAqIEBzZWUge0BsaW5rIHRhbn0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKiBAc2VlIHtAbGluayBhc2luaH0KICAgKi8KICBhdGFuaCwKCiAgLyoqCiAgICogVGhlIGN1YmUgcm9vdCBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgKHJlYWwpIGN1YmUgcm9vdCBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgc3FydH0KICAgKi8KICBjYnJ0LAoKICAvKioKICAgKiBUaGUgInJvdW5kIHVwIHRvIHRoZSBuZWFyZXN0IGludGVnZXIiIGZ1bmN0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaW50ZWdlciByZXN1bHQgYWZ0ZXIgcm91bmRpbmcgdXAuCiAgICoKICAgKiBAc2VlIHtAbGluayBmbG9vcn0KICAgKiBAc2VlIHtAbGluayByb3VuZH0KICAgKi8KICBjZWlsLAoKICAvKioKICAgKiBHZXQgdGhlIG51bWJlciBvZiBsZWFkaW5nIHplcm8gYml0cyBpbiB0aGUgMzItYml0IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiBhIG51bWJlcgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIGxlYWRpbmcgemVybyBiaXRzIGluIHRoZSAzMi1iaXQgYmluYXJ5IHJlcHJlc2VudGF0aW9uIG9mIHRoYXQgbnVtYmVyLgogICAqLwogIGNsejMyLAoKICAvKioKICAgKiBUaGUgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBjb3NpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIHNpbn0KICAgKi8KICBjb3MsCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwZXJib2xpYyBjb3NpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGNvc30KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICBjb3NoLAoKICAvKioKICAgKiBUaGUgZXhwb25lbnQgZnVuY3Rpb24sIHRoYXQgaXM6IGVeeAogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgdmFsdWUgb2YgRSByYWlzZWQgdG8gdGhhdCBudW1iZXIncyBwb3dlcgogICAqCiAgICogQHNlZSB7QGxpbmsgRX0KICAgKi8KICBleHAsCgogIC8qKgogICAqIFRoZSAicm91bmQgZG93biB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIiBmdW5jdGlvbi4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludGVnZXIgcmVzdWx0IGFmdGVyIHJvdW5kaW5nIGRvd24uCiAgICoKICAgKiBAc2VlIHtAbGluayBjZWlsfQogICAqIEBzZWUge0BsaW5rIHJvdW5kfQogICAqLwogIGZsb29yLAoKICAvKioKICAgKiBSb3VuZCBhIG51bWJlciB0byB0aGUgbmVhcmVzdCAzMiBiaXQsIHJhdGhlciB0aGFuIHRoZQogICAqIHN0YW5kYXJkIEpTIDY0IGJpdCwgZmxvYXRpbmcgcG9pbnQgcmVwcmVzZW50YXRpb24uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBudW1iZXIgYWZ0ZXIgcm91bmRpbmcgdG8gdGhlIG5lYXJlc3QgMzIgYml0IGZsb2F0aW5nIHBvaW50IHJlcHJlc2VudGF0aW9uLgogICAqCiAgICogQHNlZSB7QGxpbmsgcm91bmR9CiAgICovCiAgZnJvdW5kLAoKICAvKioKICAgKiBUaGUgRXVjbGlkZWFuIGh5cG90ZW51c2UgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyW119IC4uLmlucHV0IFR3byBvciBtb3JlIG51bWJlcnMKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwb3RlbnVzZSBnaXZlbiB0aG9zZSBudW1iZXJzLgogICAqLwogIGh5cG90LAoKICAvKioKICAgKiBUaGUgMzIgYml0IGludGVnZXIgbXVsdGlwbGljYXRpb24gZnVuY3Rpb24uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gYSBBbnkgMzIgYml0IGludGVnZXIKICAgKiBAcGFyYW0ge251bWJlcn0gYiBBbnkgMzIgYml0IGludGVnZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgMzIgYml0IGludGVnZXIgcmVzdWx0IG9mIGEgKiBiCiAgICovCiAgaW11bCwKCiAgLyoqCiAgICogVGhlIG5hdHVyYWwgbG9nYXJpdGhtIGZ1bmN0aW9uLCBpLmUuIHRoZSBiYXNlLUUgbG9nYXJpdGhtCiAgICoKICAgKiAoTm90ZSB0aGF0IGluIEpTIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkICJsb2ciIHJhdGhlciB0aGFuICJsbiIpCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBuYXR1cmFsIGxvZ2FyaXRobSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgRX0KICAgKiBAc2VlIHtAbGluayBsb2d9CiAgICovCiAgbG9nOiBsbiwKCiAgLyoqCiAgICogVGhlICJjb21tb24gbG9nYXJpdGhtIiBmdW5jdGlvbiwgaS5lLiB0aGUgYmFzZS0xMCBsb2dhcml0aG0uCiAgICoKICAgKiAoTm90ZSB0aGF0IGluIEpTIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkICJsb2cxMCIgcmF0aGVyIHRoYW4gImxvZyIpCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBjb21tb24gbG9nYXJpdGhtIG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBsbn0KICAgKi8KICBsb2cxMDogbG9nLAoKICAvKioKICAgKiBUaGUgYmluYXJ5IGxvZ2FyaXRobSBmdW5jdGlvbiwgaS5lLiB0aGUgYmFzZS0yIGxvZ2FyaXRobS4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGJhc2UgMiBsb2dhcml0aG0gb2YgdGhhdCBudW1iZXIKICAgKgogICAqIEBzZWUge0BsaW5rIGxufQogICAqIEBzZWUge0BsaW5rIGxvZ30KICAgKi8KICBsb2cyLAoKICAvKioKICAgKiBGaW5kIHRoZSBtYXhpbXVtIHZhbHVlIGluIGEgc2V0IG9mIG51bWJlcnMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSAuLi5pbnB1dCBBbnkgdHdvIG9yICBtb3JlIG51bWJlcnMKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaGlnaGVzdCB2YWx1ZWQgbnVtYmVyIGZyb20gYW1vbmcgdGhlIGlucHV0LgogICAqCiAgICogQHNlZSB7QGxpbmsgbWlufQogICAqLwogIG1heCwKCiAgLyoqCiAgICogRmluZCB0aGUgbWluaW11bSB2YWx1ZSBpbiBhIHNldCBvZiBudW1iZXJzCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gLi4uaW5wdXQgQW55IHR3byBvciAgbW9yZSBudW1iZXJzCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGxvd2VzdCB2YWx1ZWQgbnVtYmVyIGZyb20gYW1vbmcgdGhlIGlucHV0LgogICAqCiAgICogQHNlZSB7QGxpbmsgbWF4fQogICAqLwogIG1pbiwKCiAgLyoqCiAgICogVGhlIHBvd2VyIGZ1bmN0aW9uLgogICAqCiAgICogTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gaXMgYSBob2xkb3ZlciBmcm9tIGJlZm9yZSBKUwogICAqIGhhZCB0aGUgYCoqYCBvcGVyYXRvciBmb3IgcGVyZm9ybWluZyB0aGlzIGNhbGN1bGF0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGEgQW55IG51bWJlcgogICAqIEBwYXJhbSB7bnVtYmVyfSBiIEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfE5hTn0gb3V0cHV0IGEgKiogYiBvciBOYU4gaWYgdGhhdCBpcyB1bmRlZmluZWQKICAgKi8KICBwb3csCgogIC8qKgogICAqIFRoZSAicm91bmQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciIgZnVuY3Rpb24sIHJvdW5kaW5nIGFueQogICAqIHZhbHVlIFt4LjAsIHguNDk5OS4uLl0gdG8geCwgYW5kIGFueSB2YWx1ZSBbeC41LCB4Ljk5OS4uLl0KICAgKiB0byB4ICsgMS4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludGVnZXIgcmVzdWx0IGFmdGVyIHJvdW5kaW5nLgogICAqCiAgICogQHNlZSB7QGxpbmsgY2VpbH0KICAgKiBAc2VlIHtAbGluayBmbG9vcn0KICAgKi8KICByb3VuZCwKCiAgLyoqCiAgICogR2V0IHRoZSBzaWduIG9mIGEgbnVtYmVyCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9ICsxIGlmIHRoZSBudW1iZXIgd2FzIHBvc2l0aXZlLCAtMSBpZiBpdCB3YXMgbmVnYXRpdmUsIG9yIDAgaWYgdGhlIGlucHV0IHdhcyB6ZXJvLgogICAqLwogIHNpZ24sCgogIC8qKgogICAqIFRoZSBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBzaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBjb3N9CiAgICovCiAgc2luLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBoeXBlcmJvbGljIHNpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIHNpbn0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICBzaW5oLAoKICAvKioKICAgKiBUaGUgc3F1YXJlIHJvb3QgZnVuY3Rpb24uCiAgICoKICAgKgogICAqIE5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIGEgaG9sZG92ZXIgZnJvbSBiZWZvcmUgSlMKICAgKiBoYWQgdGhlIGAqKmAgb3BlcmF0b3IgZm9yIHBlcmZvcm1pbmcgdGhpcyBjYWxjdWxhdGlvbgogICAqIGJ5IHVzaW5nIGB4ICoqIDAuNWAuCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBzcXVhcmUgcm9vdCBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgY2JydH0KICAgKiBAc2VlIHtAbGluayBwb3d9CiAgICovCiAgc3FydCwKCiAgLyoqCiAgICogVGhlIHRhbmdlbnQgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIHRhbmdlbnQKICAgKi8KICB0YW4sCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIHRhbmdlbnQgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnNlX2h5cGVyYm9saWNfZnVuY3Rpb25zI0RlZmluaXRpb25zX2luX3Rlcm1zX29mX2xvZ2FyaXRobXMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGh5cGVyYm9saWMgdGFuZ2VudAogICAqCiAgICogQHNlZSB7QGxpbmsgdGFufQogICAqIEBzZWUge0BsaW5rIGFzaW5ofQogICAqIEBzZWUge0BsaW5rIGFjb3NofQogICAqLwogIHRhbmgsCgogIC8qKgogICAqIFRydW5jYXRlIGEgZnJhY3Rpb24gdG8gYW4gaW50ZWdlciBieSBzaW1wbHkgZHJvcHBpbmcgdGhlIGZyYWN0aW9uYWwgcGFydC4KICAgKiBOb3RlIHRoYXQgdGhpcyBkaWZmZXJzIGZyb20gdGhlIGBmbG9vcmAgZnVuY3Rpb246CiAgICoKICAgKiBgYGAKICAgKiBmbG9vcig0LjIpOyAgLy8gNAogICAqIGZsb29yKC00LjIpOyAvLyAtNQogICAqCiAgICogdHJ1bmMoNC4yKTsgIC8vIDQKICAgKiB0cnVuYygtNC4yKTsgLy8gLTQKICAgKiBgYGAKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludGVnZXIgcGFydCBvbmx5IG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBmbG9vcn0KICAgKi8KICB0cnVuYywKfSA9IE1hdGg7CgovKioKICogR2V0IHRoZSBiaW5vbWlhbCBjb2VmZmljaWVudCAobiBjaG9vc2UgaykuCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBuIEEgcG9zaXRpdmUgaW50ZWdlcgogKiBAcGFyYW0ge251bWJlcn0gayBBIHBvc2l0aXZlIGludGVnZXIgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIGBuYAogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgdmFsdWUgKG4gY2hvb3NlIGspCiAqLwpmdW5jdGlvbiBiaW5vbWlhbChuLCBrKSB7CiAgaWYgKG4gPT09IDApIHJldHVybiAxOwogIHZhciBsdXQgPSBfX2Jpbm9taWFsQ29lZmZpY2llbnRzOwogIHdoaWxlIChuID49IGx1dC5sZW5ndGgpIHsKICAgIHZhciBzID0gbHV0Lmxlbmd0aDsKICAgIHZhciBuZXh0Um93ID0gWzFdOwogICAgZm9yICh2YXIgaSA9IDEsIHByZXYgPSBzIC0gMTsgaSA8IHM7IGkrKykgewogICAgICBuZXh0Um93W2ldID0gbHV0W3ByZXZdW2kgLSAxXSArIGx1dFtwcmV2XVtpXTsKICAgIH0KICAgIG5leHRSb3dbc10gPSAxOwogICAgbHV0LnB1c2gobmV4dFJvdyk7CiAgfQogIHJldHVybiBsdXRbbl1ba107Cn0KCi8qKgogKiBDb25zdHJhaW4gYSBudW1iZXIgdG8gd2l0aGluIGEgZ2l2ZW4gcmFuZ2UuCiAqIFRoaXMgaXMgcmVhbGx5IG5vdGhpbmcgbW9yZSB0aGFuIGEgY29udmVuaWVudAogKiBmdW5jdGlvbiB3cmFwcGVyIGFyb3VuZCB0aGUgc3RhdGVtZW50OgogKgogKiBgYGAKICogdiA8IHMgPyBzIDogdiA+IGUgPyBlIDogdgogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb25zdHJhaW4KICogQHBhcmFtIHtudW1iZXJ9IGxvd2VyQm91bmQgVGhlIGxvd2VyIGJvdW5kIG9uIG91ciB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gdXBwZXJCb3VuZCBUaGUgdXBwZXIgYm91bmQgb24gb3VyIHZhbHVlCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSB2YWx1ZSwgaWYgaXQgZmFsbHMgd2l0aGluZyBbbG93ZXJCb3VuZCx1cHBlckJvdW5kXSwgb3RoZXJ3aXNlIG9uZSBvZiB0aG9zZSBib3VuZHMuCiAqCiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbk1hcH0KICovCmZ1bmN0aW9uIGNvbnN0cmFpbih2LCBzLCBlKSB7CiAgcmV0dXJuIHYgPCBzID8gcyA6IHYgPiBlID8gZSA6IHY7Cn0KCi8qKgogKiBUaGUgY29zZWNhbnQgZnVuY3Rpb24sIHdoaWNoIGlzOgogKgogKiBgYGAKICogMSAvIHNpbih2KQogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSBpbnB1dCB2YWx1ZSwgaW4gcmFkaWFucy4KICogQHJldHVybnMge251bWJlcn0gVGhlIGNvc2VjYW50IG9mIG91ciB2YWx1ZS4KICoKICogQHNlZSB7QGxpbmsgc2VjfQogKi8KZnVuY3Rpb24gY3NjKHYpIHsKICByZXR1cm4gMSAvIHNpbih2KTsKfQoKLyoqCiAqIFRoZSBjb3RhbmdlbnQgZnVuY3Rpb24sIHdoaWNoIGlzOgogKgogKiBgYGAKICogY29zKHYpIC8gc2luKHYpCiAqIGBgYAogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIGlucHV0IHZhbHVlLCBpbiByYWRpYW5zLgogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY290YW5nZW50IG9mIG91ciB2YWx1ZS4KICoKICogQHNlZSB7QGxpbmsgdGFufQogKi8KZnVuY3Rpb24gY3RuKHYpIHsKICByZXR1cm4gY29zKHYpIC8gc2luKHYpOwp9CgovKioKICogQ29udmVydCBhIG51bWJlciBpbiByYWRpYW5zIHRvIGEgbnVtYmVyIGluIGRlZ3JlZXMuCiAqIFRoaXMgaXMgcmVhbGx5IG5vdGhpbmcgbW9yZSB0aGFuIGEgY29udmVuaWVudAogKiBmdW5jdGlvbiB3cmFwcGVyIGFyb3VuZCB0aGUgc3RhdGVtZW50OgogKgogKiBgYGAKICogdi9QSSAqIDE4MAogKiBgYGAKICoKICogV2l0aCBvbmUgdHJpY2ssIGluIHRoYXQgaXQgYWxsb3dzIHlvdSB0byBjb25zdHJhaW4gdGhlCiAqIHJlc3VsdGFudCB2YWx1ZSB0byB0aGUgc3RhbmRhcmQgWzAsIDM2MF0gaW50ZXJ2YWwuCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29uc3RyYWluCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY29uc3RyYWluPyBBIGJvb2xlYW4gdGhhdCBkZXRlcm1pbmVzIHdoZXRoZXIgb3Igbm90IHRvIGNvbnN0cmFpbiB0aGUgcmVzdWx0YW50IHZhbHVlIHRvIFswLCAzNjBdIChkZWZhdWx0ID0gZmFsc2UpCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBkZWdyZWUgdmFsdWUgY29ycmVzcG9uZGluZyB0byB0aGUgaW5wdXQgdmFsdWUgaW4gcmFkaWFucywgb3B0aW9uYWxseSBjb25zdHJhaW5lZCB0byBbMCwgMzYwXQogKgogKiBAc2VlIHtAbGluayByYWRpYW5zfQogKiBAc2VlIHtAbGluayBjb25zdHJhaW59CiAqLwpmdW5jdGlvbiBkZWdyZWVzKHYsIGNvbnN0cmFpbiA9IGZhbHNlKSB7CiAgbGV0IGQgPSAodiAvIFBJKSAqIDE4MDsKICBpZiAoIWNvbnN0cmFpbikgcmV0dXJuIGQ7CiAgd2hpbGUgKGQgPCAwKSBkICs9IDM2MDsKICByZXR1cm4gZCAlIDM2MDsKfQoKLyoqCiAqIENhbGN1bGF0ZSB0aGUgMkQgRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gdHdvIHBvaW50cy4KICoKICogQHBhcmFtIHtudW1iZXJ9IHgxIFRoZSBmaXJzdCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkxIFRoZSBmaXJzdCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHgyIFRoZSBzZWNvbmQgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MiBUaGUgc2Vjb25kIHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgZXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gdGhlIHR3byBjb29yZGluYXRlcwogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDEgVGhlIGZpcnN0IHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDIgVGhlIHNlY29uZCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICogQHJldHVybnMge251bWJlcn0gVGhlIGV1Y2xpZGVhbiBkaXN0YW5jZSBiZXR3ZWVuIHRoZSB0d28gY29vcmRpbmF0ZXMKICovCmZ1bmN0aW9uIGRpc3QoeDEsIHkxLCB4MiwgeTIpIHsKICBpZiAoeDEueCAhPT0gdW5kZWZpbmVkICYmIHgxLnkgIT09IHVuZGVmaW5lZCkgewogICAgeTIgPSB5MS55OwogICAgeDIgPSB5MS54OwogICAgeTEgPSB4MS55OwogICAgeDEgPSB4MS55OwogIH0KICBjb25zdCBkeCA9IHgyIC0geDE7CiAgY29uc3QgZHkgPSB5MiAtIHkxOwogIHJldHVybiBoeXBvdChkeCwgZHkpOwp9CgovKioKICogUGVyZm9ybXMgYSBsaW5lL2xpbmUgaW50ZXJzZWN0aW9uIHRlc3QgZ2l2ZSBlaXRoZXIgZm91ciBwb2ludHMKICogZGVmaW5pbmcgdGhlIGxpbmVzIChwMS0tcDIpIGFuZCAocDMtLXA0KSwgb3IgZWlnaHQgY29vcmRpbmF0ZXMKICogc3Bhbm5pbmcgbGluZXMgKHgxLHkxKS0tKHgyLHkyKSBhbmQgKHgzLHkzKS0tKHg0LHk0KS4KICoKICogVGhpcyBmdW5jdGlvbiBjb3ZlcnMgYm90aCAibGluZS9saW5lIiBhbmQgInNlZ21lbnQiLyJzZWdtZW50IgogKiB0ZXN0aW5nIGJ5IHNldHRpbmcgYSBib29sZWFuIHZhbHVlIGBpbkJvdW5kc2Agb24gdGhlIHJlc3VsdDoKICogd2hlbiBmYWxzZSwgdGhlcmUgaXMgb25seSBhIGxpbmUvbGluZSBpbnRlcnNlY3Rpb24sIGJ1dCB3aGVuCiAqIHRydWUsIHRoZSBhY3R1YWwgbGluZSBzZWdtZW50cyBpbnRlcnNlY3QuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBjZW50ZXIoKTsKICogICAgICAgLy8gLi4uY29kZSBnb2VzIGhlcmUuLi4KICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geDEgVGhlIGZpcnN0IHBvaW50J3MgeCBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MSBUaGUgZmlyc3QgcG9pbnQncyB5IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHgyIFRoZSBzZWNvbmQgcG9pbnQncyB4IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHkyIFRoZSBzZWNvbmQgcG9pbnQncyB5IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHgzIFRoZSB0aGlyZCBwb2ludCdzIHggY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0geTMgVGhlIHRoaXJkIHBvaW50J3MgeSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB4NCBUaGUgZm91cnRoIHBvaW50J3MgeCBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB5NCBUaGUgZm91cnRoIHBvaW50J3MgeSBjb29yZGluYXRlCiAqIEByZXR1cm5zIHtQb2ludExpa2V8ZmFsc2V9IEVpdGhlciB0aGUgaW50ZXJzZWN0aW9uIHBvaW50LCBvciBmYWxzZSBpZiB0aGVyZSBpcyBubyBpbnRlcnNlY3Rpb24KICoKICogQHBhcmFtIHtQb2ludExpbmV9IHAxIFRoZSBmaXJzdCBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaW5lfSBwMiBUaGUgc2Vjb25kIGNvb3JkaW5hdGUKICogQHBhcmFtIHtQb2ludExpbmV9IHAzIFRoZSB0aGlyZCBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaW5lfSBwNCBUaGUgZm91cnRoIGNvb3JkaW5hdGUKICogQHJldHVybnMge1BvaW50TGlrZXxmYWxzZX0gRWl0aGVyIHRoZSBpbnRlcnNlY3Rpb24gcG9pbnQsIG9yIGZhbHNlIGlmIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbgogKi8KZnVuY3Rpb24gbGxpKHgxLCB5MSwgeDIsIHkyLCB4MywgeTMsIHg0LCB5NCkgewogIGlmICh4MS54ICE9PSB1bmRlZmluZWQgJiYgeDEueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5NCA9IHkyLnk7CiAgICB4NCA9IHkyLng7CiAgICB5MyA9IHgyLnk7CiAgICB4MyA9IHgyLng7CiAgICB5MiA9IHkxLnk7CiAgICB4MiA9IHkxLng7CiAgICB5MSA9IHgxLnk7CiAgICB4MSA9IHgxLng7CiAgfQogIGNvbnN0IG54ID0gKHgxICogeTIgLSB5MSAqIHgyKSAqICh4MyAtIHg0KSAtICh4MSAtIHgyKSAqICh4MyAqIHk0IC0geTMgKiB4NCk7CiAgY29uc3QgbnkgPSAoeDEgKiB5MiAtIHkxICogeDIpICogKHkzIC0geTQpIC0gKHkxIC0geTIpICogKHgzICogeTQgLSB5MyAqIHg0KTsKICBjb25zdCBkID0gKHgxIC0geDIpICogKHkzIC0geTQpIC0gKHkxIC0geTIpICogKHgzIC0geDQpOwoKICBpZiAoZCA9PT0gMCkgcmV0dXJuIGZhbHNlOwoKICBjb25zdCByID0geyB4OiBueCAvIGQsIHk6IG55IC8gZCwgaW5Cb3VuZHM6IHRydWUgfTsKICBsZXQgYSA9IHgxOwogIGxldCBiID0geDI7CiAgaWYgKHgxID4geDIpIHsKICAgIGEgPSB4MjsKICAgIGIgPSB4MTsKICB9CiAgaWYgKHIueCA8IGEgfHwgci54ID4gYikgci5pbkJvdW5kcyA9IGZhbHNlOwogIGVsc2UgewogICAgYSA9IHkxOwogICAgYiA9IHkyOwogICAgaWYgKHkxID4geTIpIHsKICAgICAgYSA9IHkyOwogICAgICBiID0geTE7CiAgICB9CiAgICBpZiAoci55IDwgYSB8fCByLnkgPiBiKSByLmluQm91bmRzID0gZmFsc2U7CiAgICBlbHNlIHsKICAgICAgYSA9IHgzOwogICAgICBiID0geDQ7CiAgICAgIGlmICh4MyA+IHg0KSB7CiAgICAgICAgYSA9IHg0OwogICAgICAgIGIgPSB4MzsKICAgICAgfQogICAgICBpZiAoci54IDwgYSB8fCByLnggPiBiKSByLmluQm91bmRzID0gZmFsc2U7CiAgICAgIGVsc2UgewogICAgICAgIGEgPSB5MzsKICAgICAgICBiID0geTQ7CiAgICAgICAgaWYgKHkzID4geTQpIHsKICAgICAgICAgIGEgPSB5NDsKICAgICAgICAgIGIgPSB5MzsKICAgICAgICB9CiAgICAgICAgaWYgKHIueSA8IGEgfHwgci55ID4gYikgci5pbkJvdW5kcyA9IGZhbHNlOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiByOwp9CgovKioKICogTWFwIGEgdmFsdWUgZnJvbSBvbmUgaW50ZXJ2YWwgdG8gYW5vdGhlciwgb3B0aW9uYWxseQogKiBjb25zdHJhaW5lZCB0byB0aGUgdGFyZ2V0IGludGVydmFsLgogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgT3VyIGlucHV0IHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSBvcmlnaW5hbFN0YXJ0IFRoZSBsb3dlciBib3VuZCBvZiBvdXIgZG9tYWluCiAqIEBwYXJhbSB7bnVtYmVyfSBvcmlnaW5hbEVuZCBUaGUgdXBwZXIgYm91bmQgb2Ygb3VyIGRvbWFpbgogKiBAcGFyYW0ge251bWJlcn0gbmV3U3RhcnQgVGhlIGxvd2VyIGJvdW5kIG9mIG91ciB0YXJnZXQgaW50ZXJ2YWwKICogQHBhcmFtIHtudW1iZXJ9IG5ld0VuZCBUaGUgdXBwZXIgYm91bmQgb24gb3VyIHRhcmdldCBpbnRlcnZhbAogKiBAcGFyYW0ge2Jvb2xlYW59IGNvbnN0cmFpbj8gIEEgYm9vbGVhbiB0aGF0IGRldGVybWluZXMgd2hldGhlciBvciBub3QgdG8gY29uc3RyYWluIHRoZSByZXN1bHRhbnQgdmFsdWUgdG8gW25ld1N0YXJ0LG5ld0VuZF0gKGRlZmF1bHQgPSBmYWxzZSkKICogQHJldHVybnMge251bWJlcn0gVGhlIHJlc3VsdCBvZiBtYXBwaW5nIG91ciB2YWx1ZSBmcm9tIG91ciBkb21haW4gaW50ZXJ2YWwgdG8gb3VyIHRhcmdldCBpbnRlcnZhbCwgb3B0aW9uYWxseSBjb25zdHJhaW5lZCB0byB0aGUgdGFyZ2V0IGludGVydmFsLgogKgogKiBAc2VlIHtAbGluayBjb25zdHJhaW59CiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbk1hcH0KICovCmZ1bmN0aW9uIG1hcCh2LCBzLCBlLCBucywgbmUsIGNvbnN0cmFpbmVkID0gZmFsc2UpIHsKICBjb25zdCBpMSA9IGUgLSBzLAogICAgaTIgPSBuZSAtIG5zLAogICAgcCA9IHYgLSBzOwogIGxldCByID0gbnMgKyAocCAqIGkyKSAvIGkxOwogIGlmIChjb25zdHJhaW5lZCkgcmV0dXJuIGNvbnN0cmFpbihyLCBucywgbmUpOwogIHJldHVybiByOwp9CgovKioKICogQ29udmVydCBhIG51bWJlciBpbiBkZWdyZWVzIHRvIGEgbnVtYmVyIGluIHJhZGlhbnMuCiAqIFRoaXMgaXMgcmVhbGx5IG5vdGhpbmcgbW9yZSB0aGFuIGEgY29udmVuaWVudAogKiBmdW5jdGlvbiB3cmFwcGVyIGFyb3VuZCB0aGUgc3RhdGVtZW50OgogKgogKiBgYGAKICogdi8xODAgKiBQSQogKiBgYGAKICoKICogV2l0aCBvbmUgdHJpY2ssIGluIHRoYXQgaXQgYWxsb3dzIHlvdSB0byBjb25zdHJhaW4gdGhlCiAqIHJlc3VsdGFudCB2YWx1ZSB0byB0aGUgc3RhbmRhcmQgWzAsIFRBVV0gaW50ZXJ2YWwuCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29uc3RyYWluCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY29uc3RyYWluPyBBIGJvb2xlYW4gdGhhdCBkZXRlcm1pbmVzIHdoZXRoZXIgb3Igbm90IHRvIGNvbnN0cmFpbiB0aGUgcmVzdWx0YW50IHZhbHVlIHRvIFswLCBUQVVdIChkZWZhdWx0ID0gZmFsc2UpCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSByYWRpYW5zIHZhbHVlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGlucHV0IHZhbHVlIGluIGRlZ3JlZXMsIG9wdGlvbmFsbHkgY29uc3RyYWluZWQgdG8gWzAsIFRBVV0KICoKICogQHNlZSB7QGxpbmsgZGVncmVlc30KICogQHNlZSB7QGxpbmsgY29uc3RyYWlufQogKi8KZnVuY3Rpb24gcmFkaWFucyh2LCBjb25zdHJhaW4gPSBmYWxzZSkgewogIGxldCByID0gKHYgLyAxODApICogUEk7CiAgaWYgKCFjb25zdHJhaW4pIHJldHVybiByOwogIHdoaWxlIChyIDwgMCkgciArPSBUQVU7CiAgcmV0dXJuIHIgJSBUQVU7Cn0KCi8qKgogKiBHZW5lcmF0ZSBhIHBzZXVkby1yYW5kb20gbnVtYmVyLgogKgogKiBUaGlzIGlzIGJhc2VkIG9uIHRoZSBTcGxpdE1peDMyIGFsZ29yaXRobSwgY292ZXJlZAogKiBvdmVyIG9uIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS80NzU5MzMxNi83NDA1NTMKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjApOwogKiAgICAgICByYW5nZSgwLCBoZWlnaHQgKyAyMCwgMjAsICh2KSA9PiB7CiAqICAgICAgICAgdGV4dChyYW5kb20oKSwgNSwgdik7CiAqICAgICAgIH0pCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICoKICoKICogQHJldHVybnMge251bWJlcn0gQSByYW5kb20gbnVtYmVyIGluIHRoZSBpbnRlcnZhbCBbMCwxKQogKgogKiBAcGFyYW0ge251bWJlcn0gYSBUaGUgdXBwZXIgYm91bmQgZm9yIHRoZSByYW5kb20gbnVtYmVyCiAqIEByZXR1cm5zIHtudW1iZXJ9IEEgcmFuZG9tIG51bWJlciBpbiB0aGUgaW50ZXJ2YWwgWzAsYSkKICoKICogQHBhcmFtIHtudW1iZXJ9IGEgVGhlIGxvd2VyIGJvdW5kIGZvciB0aGUgcmFuZG9tIG51bWJlcgogKiBAcGFyYW0ge251bWJlcn0gYiBUaGUgdXBwZXIgYm91bmQgZm9yIHRoZSByYW5kb20gbnVtYmVyCiAqIEByZXR1cm5zIHtudW1iZXJ9IEEgcmFuZG9tIG51bWJlciBpbiB0aGUgaW50ZXJ2YWwgW2EsIGIpCiAqCiAqIEBzZWUge0BsaW5rIHJhbmRvbVNlZWR9CiAqLwpmdW5jdGlvbiByYW5kb20oYSA9IDEsIGIpIHsKICBjb25zdCByID0gX19wcm5nLm5leHQoKTsKICBpZiAoYiA9PT0gdW5kZWZpbmVkKSByZXR1cm4gYSAqIHI7CiAgcmV0dXJuIGEgKyByICogKGIgLSBhKTsKfQoKLyoqCiAqIFNldCB0aGUgcHNldWRvLXJhbmRvbSBudW1iZXIgZ2VuZXJhdG9yIHNlZWQuIElmIG5vIHNlZWQKICogdmFsdWUgaXMgcHJvdmlkZWQsIHRoaXMgaXMgZXF1aXZhbGVudCB0byBjYWxsaW5nOgogKgogKiBgYGAKICogcmFuZG9tU2VlZChEYXRlLm5vdygpICogTWF0aC5yYW5kb20oKSkKICogYGBgCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBzZWVkPyBUaGUgcmFuZG9tIHNlZWQgdmFsdWUuCiAqCiAqIEBzZWUge0BsaW5rIHJhbmRvbX0KICovCmZ1bmN0aW9uIHJhbmRvbVNlZWQoc2VlZCA9IERhdGUubm93KCkgKiBNYXRoLnJhbmRvbSgpKSB7CiAgX19wcm5nLnJlc2VlZChzZWVkKTsKfQoKLyoqCiAqIFRoZSBzZWNhbnQgZnVuY3Rpb24sIHdoaWNoIGlzOgogKgogKiBgYGAKICogMSAvIGNvcyh2KQogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSBpbnB1dCB2YWx1ZSwgaW4gcmFkaWFucy4KICogQHJldHVybnMge251bWJlcn0gVGhlIHNlY2FudCBvZiBvdXIgdmFsdWUuCiAqCiAqIEBzZWUge0BsaW5rIGNzY30KICovCmZ1bmN0aW9uIHNlYyh2KSB7CiAgcmV0dXJuIDEgLyBjb3Modik7Cn0KLyoqCiAqIEludmVydCBhIG1hdHJpeCwgb3IgdW5kZWZpbmVkIGlmIHRoZSBtYXRyaXggaXMgbm90IGludmVydGlibGUuCiAqCiAqIEBwYXJhbSB7TWF0cml4fSBNIFRoZSBtYXRyaXggdG8gaW52ZXJ0CiAqIEByZXR1cm5zIHtudW1iZXJbXVtdfSBUaGUgbWF0cml4IGludmVyc2UgYXMgMkQgbnVtYmVyIGFycmF5CiAqLwpmdW5jdGlvbiBpbnZlcnRNYXRyaXgoTSkgewogIC8vIENvcGllZCBmcm9tIGh0dHA6Ly9ibG9nLmFjaXBvLmNvbS9tYXRyaXgtaW52ZXJzaW9uLWluLWphdmFzY3JpcHQvCiAgLy8gV2l0aCBwZXJtaXNzaW9uLCBodHRwOi8vYmxvZy5hY2lwby5jb20vbWF0cml4LWludmVyc2lvbi1pbi1qYXZhc2NyaXB0LyNjb21tZW50LTUwNTcyODk4ODkKCiAgLy8gKDEpICdhdWdtZW50JyB0aGUgbWF0cml4IChsZWZ0KSBieSB0aGUgaWRlbnRpdHkgKG9uIHRoZSByaWdodCkKICAvLyAoMikgVHVybiB0aGUgbWF0cml4IG9uIHRoZSBsZWZ0IGludG8gdGhlIGlkZW50aXR5IGJ5IGVsZW1ldHJ5IHJvdyBvcHMKICAvLyAoMykgVGhlIG1hdHJpeCBvbiB0aGUgcmlnaHQgaXMgdGhlIGludmVyc2UgKHdhcyB0aGUgaWRlbnRpdHkgbWF0cml4KQogIC8vIFRoZXJlIGFyZSAzIGVsZW10YXJ5IHJvdyBvcHM6CiAgLy8gKGEpIFN3YXAgMiByb3dzCiAgLy8gKGIpIE11bHRpcGx5IGEgcm93IGJ5IGEgc2NhbGFyCiAgLy8gKGMpIEFkZCAyIHJvd3MKCiAgLy8gaWYgdGhlIG1hdHJpeCBpc24ndCBzcXVhcmU6IGV4aXQgKGVycm9yKQogIGlmIChNLmxlbmd0aCAhPT0gTVswXS5sZW5ndGgpIHsKICAgIGNvbnNvbGUud2FybigiQ2Fubm90IGludmVydCBub24tc3F1YXJlIG1hdHJpY2VzIik7CiAgICByZXR1cm47CiAgfQoKICAvLyBjcmVhdGUgdGhlIGlkZW50aXR5IG1hdHJpeCAoSSksIGFuZCBhIGNvcHkgKEMpIG9mIHRoZSBvcmlnaW5hbAogIHZhciBpID0gMCwKICAgIGlpID0gMCwKICAgIGogPSAwLAogICAgZGltID0gTS5sZW5ndGgsCiAgICBlID0gMCwKICAgIHQgPSAwOwogIHZhciBJID0gW10sCiAgICBDID0gW107CiAgZm9yIChpID0gMDsgaSA8IGRpbTsgaSArPSAxKSB7CiAgICAvLyBDcmVhdGUgdGhlIHJvdwogICAgSVtJLmxlbmd0aF0gPSBbXTsKICAgIENbQy5sZW5ndGhdID0gW107CiAgICBmb3IgKGogPSAwOyBqIDwgZGltOyBqICs9IDEpIHsKICAgICAgLy9pZiB3ZSdyZSBvbiB0aGUgZGlhZ29uYWwsIHB1dCBhIDEgKGZvciBpZGVudGl0eSkKICAgICAgaWYgKGkgPT0gaikgewogICAgICAgIElbaV1bal0gPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIElbaV1bal0gPSAwOwogICAgICB9CgogICAgICAvLyBBbHNvLCBtYWtlIHRoZSBjb3B5IG9mIHRoZSBvcmlnaW5hbAogICAgICBDW2ldW2pdID0gTVtpXVtqXTsKICAgIH0KICB9CgogIC8vIFBlcmZvcm0gZWxlbWVudGFyeSByb3cgb3BlcmF0aW9ucwogIGZvciAoaSA9IDA7IGkgPCBkaW07IGkgKz0gMSkgewogICAgLy8gZ2V0IHRoZSBlbGVtZW50IGUgb24gdGhlIGRpYWdvbmFsCiAgICBlID0gQ1tpXVtpXTsKCiAgICAvLyBpZiB3ZSBoYXZlIGEgMCBvbiB0aGUgZGlhZ29uYWwgKHdlJ2xsIG5lZWQgdG8gc3dhcCB3aXRoIGEgbG93ZXIgcm93KQogICAgaWYgKGUgPT0gMCkgewogICAgICAvL2xvb2sgdGhyb3VnaCBldmVyeSByb3cgYmVsb3cgdGhlIGkndGggcm93CiAgICAgIGZvciAoaWkgPSBpICsgMTsgaWkgPCBkaW07IGlpICs9IDEpIHsKICAgICAgICAvL2lmIHRoZSBpaSd0aCByb3cgaGFzIGEgbm9uLTAgaW4gdGhlIGkndGggY29sCiAgICAgICAgaWYgKENbaWldW2ldICE9IDApIHsKICAgICAgICAgIC8vaXQgd291bGQgbWFrZSB0aGUgZGlhZ29uYWwgaGF2ZSBhIG5vbi0wIHNvIHN3YXAgaXQKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBkaW07IGorKykgewogICAgICAgICAgICBlID0gQ1tpXVtqXTsgLy90ZW1wIHN0b3JlIGkndGggcm93CiAgICAgICAgICAgIENbaV1bal0gPSBDW2lpXVtqXTsgLy9yZXBsYWNlIGkndGggcm93IGJ5IGlpJ3RoCiAgICAgICAgICAgIENbaWldW2pdID0gZTsgLy9yZXBhY2UgaWkndGggYnkgdGVtcAogICAgICAgICAgICBlID0gSVtpXVtqXTsgLy90ZW1wIHN0b3JlIGkndGggcm93CiAgICAgICAgICAgIElbaV1bal0gPSBJW2lpXVtqXTsgLy9yZXBsYWNlIGkndGggcm93IGJ5IGlpJ3RoCiAgICAgICAgICAgIElbaWldW2pdID0gZTsgLy9yZXBhY2UgaWkndGggYnkgdGVtcAogICAgICAgICAgfQogICAgICAgICAgLy9kb24ndCBib3RoZXIgY2hlY2tpbmcgb3RoZXIgcm93cyBzaW5jZSB3ZSd2ZSBzd2FwcGVkCiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy9nZXQgdGhlIG5ldyBkaWFnb25hbAogICAgICBlID0gQ1tpXVtpXTsKICAgICAgLy9pZiBpdCdzIHN0aWxsIDAsIG5vdCBpbnZlcnRpYmxlIChlcnJvcikKICAgICAgaWYgKGUgPT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQoKICAgIC8vIFNjYWxlIHRoaXMgcm93IGRvd24gYnkgZSAoc28gd2UgaGF2ZSBhIDEgb24gdGhlIGRpYWdvbmFsKQogICAgZm9yIChqID0gMDsgaiA8IGRpbTsgaisrKSB7CiAgICAgIENbaV1bal0gPSBDW2ldW2pdIC8gZTsgLy9hcHBseSB0byBvcmlnaW5hbCBtYXRyaXgKICAgICAgSVtpXVtqXSA9IElbaV1bal0gLyBlOyAvL2FwcGx5IHRvIGlkZW50aXR5CiAgICB9CgogICAgLy8gU3VidHJhY3QgdGhpcyByb3cgKHNjYWxlZCBhcHByb3ByaWF0ZWx5IGZvciBlYWNoIHJvdykgZnJvbSBBTEwgb2YKICAgIC8vIHRoZSBvdGhlciByb3dzIHNvIHRoYXQgdGhlcmUgd2lsbCBiZSAwJ3MgaW4gdGhpcyBjb2x1bW4gaW4gdGhlCiAgICAvLyByb3dzIGFib3ZlIGFuZCBiZWxvdyB0aGlzIG9uZQogICAgZm9yIChpaSA9IDA7IGlpIDwgZGltOyBpaSsrKSB7CiAgICAgIC8vIE9ubHkgYXBwbHkgdG8gb3RoZXIgcm93cyAod2Ugd2FudCBhIDEgb24gdGhlIGRpYWdvbmFsKQogICAgICBpZiAoaWkgPT0gaSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICAvLyBXZSB3YW50IHRvIGNoYW5nZSB0aGlzIGVsZW1lbnQgdG8gMAogICAgICBlID0gQ1tpaV1baV07CgogICAgICAvLyBTdWJ0cmFjdCAodGhlIHJvdyBhYm92ZShvciBiZWxvdykgc2NhbGVkIGJ5IGUpIGZyb20gKHRoZQogICAgICAvLyBjdXJyZW50IHJvdykgYnV0IHN0YXJ0IGF0IHRoZSBpJ3RoIGNvbHVtbiBhbmQgYXNzdW1lIGFsbCB0aGUKICAgICAgLy8gc3R1ZmYgbGVmdCBvZiBkaWFnb25hbCBpcyAwICh3aGljaCBpdCBzaG91bGQgYmUgaWYgd2UgbWFkZSB0aGlzCiAgICAgIC8vIGFsZ29yaXRobSBjb3JyZWN0bHkpCiAgICAgIGZvciAoaiA9IDA7IGogPCBkaW07IGorKykgewogICAgICAgIENbaWldW2pdIC09IGUgKiBDW2ldW2pdOyAvL2FwcGx5IHRvIG9yaWdpbmFsIG1hdHJpeAogICAgICAgIElbaWldW2pdIC09IGUgKiBJW2ldW2pdOyAvL2FwcGx5IHRvIGlkZW50aXR5CiAgICAgIH0KICAgIH0KICB9CgogIC8vd2UndmUgZG9uZSBhbGwgb3BlcmF0aW9ucywgQyBzaG91bGQgYmUgdGhlIGlkZW50aXR5CiAgLy9tYXRyaXggSSBzaG91bGQgYmUgdGhlIGludmVyc2U6CiAgcmV0dXJuIEk7Cn0KCi8qKgogKiBNdWx0aXBseSB0d28gbWF0cmljZXMKICoKICogQHBhcmFtIHtNYXRyaXh9IG0xCiAqIEBwYXJhbSB7TWF0cml4fSBtMgogKiBAcmV0dXJucyB7bnVtYmVyW11bXX0gVGhlIHJlc3VsdCBvZiBtMSAqIG0yICBhcyAyRCBudW1iZXIgYXJyYXkKICovCmZ1bmN0aW9uIG11bHRpcGx5TWF0cml4KG0xLCBtMikgewogIHZhciBNID0gW107CiAgdmFyIG0ydCA9IHRyYW5zcG9zZU1hdHJpeChtMik7CiAgbTEuZm9yRWFjaCgocm93LCByKSA9PiB7CiAgICBNW3JdID0gW107CiAgICBtMnQuZm9yRWFjaCgoY29sLCBjKSA9PiB7CiAgICAgIE1bcl1bY10gPSByb3cubWFwKCh2LCBpKSA9PiBjb2xbaV0gKiB2KS5yZWR1Y2UoKGEsIHYpID0+IGEgKyB2LCAwKTsKICAgIH0pOwogIH0pOwogIHJldHVybiBNOwp9CgovKioKICogVHJhbnNwb3NlIGEgbWF0cml4CiAqCiAqIEBwYXJhbSB7TWF0cml4fSBNIFRoZSBtYXRyaXggdG8gdHJhbnNwb3NlCiAqIEByZXR1cm5zIHtudW1iZXJbXVtdfSBUaGUgbWF0cml4IHRyYW5zcG9zZSBhcyAyRCBudW1iZXIgYXJyYXkKICovCmZ1bmN0aW9uIHRyYW5zcG9zZU1hdHJpeChNKSB7CiAgcmV0dXJuIE1bMF0ubWFwKChjb2wsIGkpID0+IE0ubWFwKChyb3cpID0+IHJvd1tpXSkpOwp9Ci8qKgogKiBQcm9qZWN0IGEgM0QgY29vcmRpbmF0ZSB0byAyRC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgNTAsIC0wLjQpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIC0xLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAtMSksIHByb2plY3QoMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgMSwgMSksIHByb2plY3QoLTEsIC0xLCAxKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIDNEIGNvb3JkaW5hdGUncyB4IHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSAzRCBjb29yZGluYXRlJ3MgeCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geiBUaGUgM0QgY29vcmRpbmF0ZSdzIHggdmFsdWUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCAgVGhlIHByb2plY3RlZCAyRCB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSAyRCBjb29yZGluYXRlIGFzIHt4LHksen0gY29vcmRpbmF0ZQogKiBAcmV0dXJucyB7UG9pbnRMaWtlfSBwICBUaGUgcHJvamVjdGVkIDJEIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgc2V0UHJvamVjdG9yfQogKi8KZnVuY3Rpb24gcHJvamVjdCh4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkICYmIHgueiAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIHJldHVybiBfX3Byb2plY3Rvci5wcm9qZWN0KHgsIHksIHopOwp9CgovKioKICogU2V0IHRoZSBwcm9qZWN0b3IncyB4LCB5LCBhbmQgeiBheGlzIHJvdGF0aW9uCiAqIGluIHJhZGlhbnMuIE5vdGUgdGhhdCB0aGVzZSBhcmUgYXBwbGllZCBpbiBvcmRlci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgNTAsIC0wLjQpOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgY29uc3QgbSA9IG1pbGxpcygpIC8gNTAwMDsKICogICAgICAgcm90YXRlUHJvamVjdG9yKG0sIDIgKiBtLCAzICogbSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIC0xLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAtMSksIHByb2plY3QoMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgMSwgMSksIHByb2plY3QoLTEsIC0xLCAxKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGFuZ2xlIG9mIHJvdGF0aW9uIG92ZXIgdGhlIHggYXhpcyBpbiByYWRpYW5zCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBhbmdsZSBvZiByb3RhdGlvbiBvdmVyIHRoZSB5IGF4aXMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0geiBUaGUgYW5nbGUgb2Ygcm90YXRpb24gb3ZlciB0aGUgeiBheGlzIGluIHJhZGlhbnMKICoKICogQHNlZSB7QGxpbmsgcHJvamVjdH0KICovCmZ1bmN0aW9uIHJvdGF0ZVByb2plY3Rvcih4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkICYmIHgueiAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIF9fcHJvamVjdG9yLnNldFJvdGF0aW9uKHgsIHksIHopOwp9CgovKioKICogU2V0IHRoZSBwcm9qZWN0IHBhcmFtZXRlcnMuIEN1cnJlbnRseSwgb25seQogKiBjYWJpbmV0IHByb2plY3QgaXMgc3VwcG9ydGVkLCB3aGljaCBhY2NlcHRzCiAqIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgNTAsIC0wLjQpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIC0xLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAtMSksIHByb2plY3QoMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgMSwgMSksIHByb2plY3QoLTEsIC0xLCAxKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtICB7bnVtYmVyfSB4T2Zmc2V0IG9mIHRoZSBwcm9qZWN0aW9uIHdydCB0aGUgY2FudmFzIChkZWZhdWx0ID0gMCkKICogQHBhcmFtICB7bnVtYmVyfSB5T2Zmc2V0IG9mIHRoZSBwcm9qZWN0aW9uIHdydCB0aGUgY2FudmFzIChkZWZhdWx0ID0gMCkKICogQHBhcmFtICB7bnVtYmVyfSBzY2FsZSBmYWN0b3IgZm9yIHRoZSAzRCBpbnB1dCAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSAge251bWJlcn0gY2FiaW5ldCBhbmdsZSBpbiByYWRpYW5zIChkZWZhdWx0ID0gLXBpLzYpCiAqCiAqIEBzZWUge0BsaW5rIHByb2plY3R9CiAqLwpmdW5jdGlvbiBzZXRQcm9qZWN0b3IoLi4uYXJncykgewogIF9fcHJvamVjdG9yLnVwZGF0ZSguLi5hcmdzKTsKfQovKioKICogU2V0IGEgYm9yZGVyIGFyb3VuZCB0aGUgY2FudmFzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRCb3JkZXIoMTAsIGByZWRgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcnxib29sZWFufSB3aWR0aD8gVGhlIHdpZHRoIG9mIHRoZSBib3JkZXIgaW4gcGl4ZWxzLCBkaXNhYmxpbmcgdGhlIGJvcmRlciBvbWl0dGVkCiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvcj8gVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBibGFjaykKICoKICogQHNlZSB7QGxpbmsgbm9Cb3JkZXJ9CiAqLwpmdW5jdGlvbiBzZXRCb3JkZXIod2lkdGggPSAxLCBjb2xvciA9IGBibGFja2ApIHsKICBpZiAoIXdpZHRoKSB7CiAgICBfX2NhbnZhcy5zdHlsZS5ib3JkZXIgPSBgbm9uZWA7CiAgfSBlbHNlIHsKICAgIF9fY2FudmFzLnN0eWxlLmJvcmRlciA9IGAke3dpZHRofXB4IHNvbGlkICR7Y29sb3J9YDsKICB9Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgc3Ryb2tlIGFuZCBmaWxsIGNvbG91ciBhdAogKiB0aGUgc2FtZSB0aW1lLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIKICoKICogQHNlZSB7QGxpbmsgc2V0U3Ryb2tlfQogKiBAc2VlIHtAbGluayBzZXRGaWxsfQogKiBAc2VlIHtAbGluayBub0NvbG9yfQogKi8KZnVuY3Rpb24gc2V0Q29sb3IoY29sb3IpIHsKICBzZXRGaWxsKGNvbG9yKTsKICBzZXRTdHJva2UoY29sb3IpOwp9CgovKioKICogQ2hhbmdlIHRoZSBjdXJzb3IgdG8gYSBzcGVjaWZpYyBpY29uOgogKgogKiAtIEFVVE8gLSB1c2Ugd2hhdGV2ZXIgdGhlIGJyb3dzZXIgd291bGQgb3RoZXJ3aXNlIHVzZQogKiAtIENST1NTIC0gdXNlIGEgY3Jvc3MtaGFpciBpY29uCiAqIC0gUE9JTlRFUiAtIHVzZSB0aGUgInBvaW50ZXIiIGljb24gdGhhdCBpcyBhbHNvIHVzZWQgZm9yIGNsaWNrYWJsZSBsaW5rcwogKgogKiBVc2UgYW55IG90aGVyIHN0cmluZyBmb3VuZCBvdmVyIG9uIHRoZSBNRE4gY3Vyc29yIGFydGljbGUgdG8gc2V0IGEgY3Vyc29yIG5vdCBjb3ZlcmVkIGJ5IHRoZSBhYm92ZSBjb25zdGFudHMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYCNGRjAyYCk7CiAqICAgICAgIHJlY3QoMCwgMCwgd2lkdGgvMiwgaGVpZ2h0KTsKICogICAgICAgc2V0Q29sb3IoYCMwRkYyYCk7CiAqICAgICAgIHJlY3Qod2lkdGgvMiwgMCwgd2lkdGgvMiwgaGVpZ2h0KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJNb3ZlKHgsIHkpIHsKICogICAgICAgaWYgKHggPCB3aWR0aC8yKSB7CiAqICAgICAgICAgc2V0Q3Vyc29yKEFVVE8pOwogKiAgICAgICB9IGVsc2UgewogKiAgICAgICAgIG5vQ3Vyc29yKCk7CiAqICAgICAgIH0KICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBUaGUgQ1NTIGN1cnNvciB0eXBlCiAqCiAqIEBzZWUge0BsaW5rIG5vQ3Vyc29yfQogKi8KZnVuY3Rpb24gc2V0Q3Vyc29yKHR5cGUpIHsKICBfX2N1cnJlbnRfY3Vyc29yID0gdHlwZTsKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBfX2N1cnJlbnRfY3Vyc29yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZpbGwgY29sb3VyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBibGFjaykKICoKICogQHNlZSB7QGxpbmsgbm9GaWxsfQogKi8KZnVuY3Rpb24gc2V0RmlsbChjb2xvciA9IGBibGFja2ApIHsKICBpZiAoQ1NTX0NPTE9SX01BUFtjb2xvcl0gPT09IF9faGlnaGxpZ2h0X2NvbG9yKSB7CiAgICBjb2xvciA9IF9fY3VycmVudF9oaWdobGlnaHRfY29sb3I7CiAgfQogIF9fY3R4LmZpbGxTdHlsZSA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZvbnQgdXNpbmcgYSBzaW5nbGUgc3RyaW5nLiBGb3IgdGhlIHN5bnRheCwKICogc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0NTUy9mb250CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBmb250IEEgQ1NTIHNob3J0aGFuZCBmb250IHByb3BlcnR5CiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRGYW1pbHl9CiAqIEBzZWUge0BsaW5rIHNldEZvbnRTaXplfQogKiBAc2VlIHtAbGluayBzZXRGb250V2VpZ2h0fQogKi8KZnVuY3Rpb24gc2V0Rm9udChmb250KSB7CiAgX19jdHguZm9udCA9IGZvbnQgfHwgYCR7X19mb250LndlaWdodH0gJHtfX2ZvbnQuc2l6ZX1weCAke19fZm9udC5mYW1pbHl9YDsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBmb250IGZhbWlseS4KICoKICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgVGhlIENTUyBmb250IGZhbWlseSBuYW1lCiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRTaXplfQogKiBAc2VlIHtAbGluayBzZXRGb250V2VpZ2h0fQogKi8KZnVuY3Rpb24gc2V0Rm9udEZhbWlseShuYW1lKSB7CiAgX19mb250LmZhbWlseSA9IG5hbWU7CiAgc2V0Rm9udCgpOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZvbnQgc2l6ZQogKgogKiBAcGFyYW0ge251bWJlcn0gcHggVGhlIGZvbnQgc2l6ZSBpbiBwaXhlbHMKICoKICogQHNlZSB7QGxpbmsgc2V0Rm9udEZhbWlseX0KICogQHNlZSB7QGxpbmsgc2V0Rm9udFdlaWdodH0KICovCmZ1bmN0aW9uIHNldEZvbnRTaXplKHB4KSB7CiAgX19mb250LnNpemUgPSBweDsKICBzZXRGb250KCk7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgZm9udCB3ZWlnaHQKICoKICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSB2YWwgVGhlIENTUyB3ZWlnaHQgbnVtYmVyIG9yIG9uZSBvZiB0aGUgc3BlY2lhbCBzdHJpbmdzICJub3JtYWwiLCAiYm9sZCIsICJib2xkZXIiLCBvciAibGlnaHRlciIuCiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRGYW1pbHl9CiAqIEBzZWUge0BsaW5rIHNldEZvbnRTaXplfQogKi8KZnVuY3Rpb24gc2V0Rm9udFdlaWdodCh2YWwpIHsKICBfX2ZvbnQud2VpZ2h0ID0gdmFsOwogIHNldEZvbnQoKTsKfQoKLyoqCiAqIFNldCB0aGUgYmFja2dyb3VuZCBncmlkIHNwYWNpbmcgYW5kIGNvbG91ci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEdyaWQoMjAsIGBsYXZlbmRlcmApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHNwYWNpbmc/IFRoZSBzcGFjaW5nIGJldHdlZW4gZ3JpZCBsaW5lcyBpbiBwaXhlbHMgKGRlZmF1bHQgPSAyMCkKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yPyBUaGUgQ1NTIGNvbG9yIHRvIHVzZSBmb3IgdGhlIGJvcmRlciAoZGVmYXVsdCA9IGxpZ2h0Z3JleSkKICoKICogQHNlZSB7QGxpbmsgbm9HcmlkfQogKi8KZnVuY3Rpb24gc2V0R3JpZChzcGFjaW5nID0gMjAsIGNvbG9yID0gYGxpZ2h0Z3JleWApIHsKICBfX2RyYXdfZ3JpZCA9IHRydWU7CiAgX19ncmlkX3NwYWNpbmcgPSBzcGFjaW5nOwogIF9fZ3JpZF9jb2xvciA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjb2xvciB0aGF0IHNob3VsZCBiZSB1c2VkIHRvIHJlcGxhY2Ugd2hhdGV2ZXIKICogaGlnaGxpZ2h0KCkgbWFya2VkIGFzIHRoZSAidG8gaGlnaGxpZ2h0IiBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0SGlnaGxpZ2h0Q29sb3IoYGxpbWVgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KCJsZXQncyBnbyIsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICBpZiAoc3RhdGUpIGhpZ2hsaWdodChgcmVkYCk7CiAqICAgICAgIGVsc2UgaGlnaGxpZ2h0KGZhbHNlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIKICoKICogQHNlZSB7QGxpbmsgaGlnaGxpZ2h0fQogKi8KZnVuY3Rpb24gc2V0SGlnaGxpZ2h0Q29sb3IoY29sb3IpIHsKICBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yID0gY29sb3I7Cn0KCi8qKgogKiBTZXQgdGhlIGxpbmUgZGFzaCBwcm9wZXJ0eS4gU2VlIHRoZSBmb2xsb3dpbmcgTUROIGFydGljbGUgZm9yIHRoZSBkZXRhaWxzOgogKgogKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9kb2NzL1dlYi9BUEkvQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEL3NldExpbmVEYXNoCiAqCiAqIEBwYXJhbSAge251bWJlcltdfSAuLi52YWx1ZXMgVGhlIGRhc2ggaW50ZXJ2YWxzIGluIHBpeGVsCiAqCiAqIEBzZWUge0BsaW5rIG5vTGluZURhc2h9CiAqLwpmdW5jdGlvbiBzZXRMaW5lRGFzaCguLi52YWx1ZXMpIHsKICBfX2N0eC5zZXRMaW5lRGFzaCh2YWx1ZXMpOwp9CgovKioKICogU2V0IHRoZSBsaW5lIHdpZHRoIGluIHBpeGVscy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcmFuZ2UoMSwgMTAsIChpKSA9PiB7CiAqICAgICAgICAgc2V0TGluZVdpZHRoKGkpOwogKiAgICAgICAgIGxpbmUoMjAsIGkgKiAyMCwgMTgwLCBpICogMjApOwogKiAgICAgICB9KQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aD8gVGhlIGxpbmUgd2lkdGggaW4gcGl4ZWxzIChkZWZhdWx0ID0gMSkKICoKICogQHNlZSB7QGxpbmsgc2V0VGV4dFN0cm9rZX0KICovCmZ1bmN0aW9uIHNldExpbmVXaWR0aCh3aWR0aCA9IDEpIHsKICBfX2N0eC5saW5lV2lkdGggPSB3aWR0aDsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBzdHJva2UgY29sb3VyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBibGFjaykKICoKICogQHNlZSB7QGxpbmsgc2V0RmlsbH0KICogQHNlZSB7QGxpbmsgc2V0Q29sb3J9CiAqLwpmdW5jdGlvbiBzZXRTdHJva2UoY29sb3IgPSBgYmxhY2tgKSB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdID09PSBfX2hpZ2hsaWdodF9jb2xvcikgewogICAgY29sb3IgPSBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwogIH0KICBfX2N0eC5zdHJva2VTdHlsZSA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IHRleHQgYWxpZ25tZW50IHZhbHVlcy4KICoKICogVmFsaWQgYHhBbGlnbmAgdmFsdWVzIGFyZToKICoKICogLSBDRU5URVIgLSB0aGUgdGV4dCBhbmNob3IgaXMgaW4gdGhlIG1pZGRsZSBvZiB0aGUgdGV4dC4gVGV4dCBpcyBwbGFjZWQgZXZlbmx5IG9uIGVpdGhlciBzaWRlLgogKiAtIEVORCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgcmlnaHQgZm9yIExUUiB0ZXh0LCBhbmQgb24gdGhlIGxlZnQgZm9yIFJUTCB0ZXh0LgogKiAtIExFRlQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIGxlZnQgc2lkZSBvZiB0aGUgdGV4dC4gYWxsIHRleHQgaXMgdG8gdGhlIHJpZ2h0LgogKiAtIFJJR0hUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSByaWdodCBzaWRlIG9mIHRoZSB0ZXh0LiBBbGwgdGV4dCBpcyB0byB0aGUgbGVmdC4KICogLSBTVEFSVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgbGVmdCBmb3IgTFRSIHRleHQsIGFuZCBvbiB0aGUgcmlnaHQgZm9yIFJUTCB0ZXh0LgogKgogKiBWYWxpZCBgeUFsaWduYCB2YWx1ZXMgYXJlOgogKgogKiAtIEFMUEhBQkVUSUMgLSBzdGFuZGFyZCB0ZXh0IGFsaWdubWVudCAoZGVmYXVsdCkKICogLSBCT1RUT00gLSB0aGUgdGV4dCBpcyBhbGlnbmVkIHRvIHRoZSBib3R0b20gb2YgdGhlIGJvdW5kaW5nIGJveAogKiAtIEhBTkdJTkcgLSByZWxldmFudCBmb3IgVGliZXRhbiBhbmQgb3RoZXIgSW5kaWMgc2NyaXB0cy4KICogLSBJREVPR1JBUEhJQyAtIHJlbGV2YW50IGZvciBpZGVvZ3JhcGhpYyBDSktWIHRleHQuCiAqIC0gTUlERExFIC0gVGhlIHZlcnRpY2FsIGVxdWl2YWxlbnQgb2YgImNlbnRlciIuCiAqIC0gVE9QIC0gVGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgdG9wIG9mIHRoZSB0eXBvZ3JhcGhpYyAiZW0gc3F1YXJlIi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRGb250U2l6ZSgyMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBsaW5lKHdpZHRoIC8gMiwgMCwgd2lkdGggLyAyLCBoZWlnaHQpOwogKiAgICAgICBsaW5lKDAsIGhlaWdodCAvIDIsIHdpZHRoLCBoZWlnaHQgLyAyKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dCgiY2VudGVyIG1pZGRsZSIsIHdpZHRoIC8gMiwgaGVpZ2h0LzIpOwogKiAgICAgICBsaW5lKDAsIGhlaWdodCAvIDIgLSA1MCwgd2lkdGgsIGhlaWdodCAvIDIgLSA1MCk7CiAqICAgICAgIHNldFRleHRBbGlnbihSSUdIVCwgVE9QKTsKICogICAgICAgdGV4dCgicmlnaHQgdG9wIiwgd2lkdGggLyAyLCBoZWlnaHQvMiAtIDUwKTsKICogICAgICAgbGluZSgwLCBoZWlnaHQgLyAyICsgNTAsIHdpZHRoLCBoZWlnaHQgLyAyICsgNTApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oTEVGVCwgQk9UVE9NKTsKICogICAgICAgdGV4dCgibGVmdCBib3R0b20iLCB3aWR0aCAvIDIsIGhlaWdodC8yICsgNTApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSB4QWxpZ24gVGhlIENTUyBob3Jpem9udGFsIGFsaWdubWVudAogKiBAcGFyYW0ge3N0cmluZ30geUFsaWduIFRoZSBDU1MgdmVydGljYWwgYWxpZ25tZW50CiAqLwpmdW5jdGlvbiBzZXRUZXh0QWxpZ24oeEFsaWduLCB5QWxpZ24pIHsKICBfX2N0eC50ZXh0QWxpZ24gPSB4QWxpZ247CiAgX19jdHgudGV4dEJhc2VsaW5lID0geUFsaWduOwp9CgovKioKICogU2V0IHRoZSB0ZXh0IG91dGxpbmUgc3Ryb2tpbmcgcHJvcGVydGllcy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoYHJlZGAsIDEpOwogKiAgICAgICBzZXRGaWxsKGB5ZWxsb3dgKTsKICogICAgICAgdGV4dCgiZmFuY3kgdGV4dCIsIHdpZHRoLzIsIDgwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICAgIHNldEZvbnRTaXplKDY1KTsKICogICAgICAgc2V0VGV4dFN0cm9rZShgcmVkYCwgMyk7CiAqICAgICAgIHNldEZpbGwoYHllbGxvd2ApOwogKiAgICAgICB0ZXh0KCJmYW5jeSB0ZXh0Iiwgd2lkdGgvMiwgMTQwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yIFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyCiAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aD8gVGhlIHRleHQgc3Ryb2tlIHdpZHRoIGluIHBpeGVscyAoZGVmYXVsdCA9IDEpCiAqCiAqIEBzZWUge0BsaW5rIHNldFN0cm9rZX0KICogQHNlZSB7QGxpbmsgc2V0TGluZVdpZHRofQogKi8KZnVuY3Rpb24gc2V0VGV4dFN0cm9rZShjb2xvciwgd2lkdGggPSAxKSB7CiAgX190ZXh0U3Ryb2tlID0gY29sb3I7CiAgc2V0TGluZVdpZHRoKHdpZHRoKTsKfQovKioKICogU3RhcnQgYSBuZXcgc2hhcGUuIFRoaXMgeWllbGRzIGEgYFNoYXBlYCBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIEFQSQogKgogKiAtIGBtYWtlTW92YWJsZShtb3ZhYmxlPzogYm9vbGVhbilgIC0gYWxsb3cgdGhpcyBzaGFwZSB0byBiZSBtb3ZlZCBhcm91bmQgd2l0aCB0aGUgcG9pbnRlciAoYG1vdmFibGVgIGlzIHRydWUgaWYgb21pdHRlZCkKICogLSBgYWxsb3dSZXNpemluZyhhbGxvd2VkPzogYm9vbGVhbilgIC0gYWxsb3cgdGhlIHBvaW50cyB0aGF0IG1ha2UgdXAgdGhpcyBzaGFwZSB0byBiZSBtb3ZlZCBhcm91bmQgKGBhbGxvd2VkYCBpcyB0cnVlIGlmIG9taXR0ZWQpCiAqCiAqIC0gYGFkZCh4LCB5KWAgLSBhZGQgYSBwb2ludCB0byB0aGUgc2hhcGUncyBjdXJyZW50IHNlZ21lbnQuCiAqIC0gYGNsb3NlKClgIC0gY2xvc2UgdGhlIGN1cnJlbnQgc2VnbWVudCBzbyBubyBuZXcgcG9pbnRzIGNhbiBiZSBhZGRlZC4KICogLSBgbmV3U2VnbWVudChjbG9zZUV4aXN0aW5nPzogYm9vbGVhbilgIC0gc3RhcnQgYSBuZXcgc2VnbWVudCBpbiB0aGlzIHNoYXBlLCB3CiAqCiAqIC0gYG9mZnNldCh4LCB5KWAgLSAodGVtcG9yYXJpbHkpIG1vdmUgdGhpcyBzaGFwZSBieSAoeCx5KQogKiAtIGBjb21taXQoKWAgLSBjb21taXQgdGhlIG9mZnNldCBhcyByZWFsIGNvb3JkaW5hdGVzLgogKiAtIGByZXNldCgpYCAtIHJlc2V0IHRoZSBzaGFwZSB0byBoYXZpbmcgbm8gb2Zmc2V0LgogKgogKiAtIGBkcmF3KHNob3dQb2ludHM/KWAgLSBkcmF3cyB0aGUgc2hhcGUgdXNpbmcgdGhlIGN1cnJlbnQgc3Ryb2tlIGFuZCBmaWxsIHNldHRpbmdzLgogKiAtIGBpbnNpZGUoeCwgeSk6IHNlZ21lbnRbXWAgLSByZXR1cm5zIHRoZSBsaXN0IG9mIGFsbCBzZWdtZW50cyB0aGF0ICh4LHkpIGlzIGluc2lkZSBvZi4KICoKICogTm90ZSB0aGF0IHNoYXBlcyBkbyBub3QgcGVyZm9ybSBhbnkgc29ydCBvZiBib29sZWFuIG9wZXJhdGlvbnMsIGFuZAogKiBkZWZpbmluZyBhIHNoYXBlIHdpdGggYSBjdXRvdXQgaXMgbm90IHBvc3NpYmxlLiBZb3UnbGwgd2FudCB0byB1c2UKICogU1ZHIGltYWdlcyBmb3IgdGhhdCwgaW5zdGVhZC4gRS5nLiBjcmVhdGUgYW4gU1ZHIGRhdGEgdXJpLCB0aGVuIHVzZQogKiB0aGF0IGFzIGBzcmNgIGZvciBhbiBJbWFnZSBhbmQgZHJhdyB0aGF0IGltYWdlIHVzaW5nIHRoZSBgaW1hZ2UoKWAKICogZnVuY3Rpb24uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBsZXQgc2hhcGU7CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNoYXBlID0gc3RhcnRTaGFwZSgpOwogKiAgICAgICBzaGFwZS5hbGxvd1Jlc2l6aW5nKCk7CiAqICAgICAgIHNoYXBlLm1ha2VNb3ZhYmxlKCk7CiAqICAgICAgIHNoYXBlLmFkZCgwLGhlaWdodC8yKTsKICogICAgICAgc2hhcGUuYWRkKHdpZHRoLzIsIDApOwogKiAgICAgICBzaGFwZS5hZGQod2lkdGgsIGhlaWdodC8yKTsKICogICAgICAgc2hhcGUuYWRkKHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIHNoYXBlLmNsb3NlKCk7CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGBnb2xkYCk7CiAqICAgICAgIHNoYXBlLmRyYXcodHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge1NoYXBlfSB0aGUgbmV3bHkgY3JlYXRlZCBzaGFwZSBvYmplY3QKICoKICogQHNlZSB7QGxpbmsgZW5kU2hhcGV9CiAqLwpmdW5jdGlvbiBzdGFydFNoYXBlKCkgewogIHJldHVybiAoX19zaGFwZSA9IG5ldyBTaGFwZSgpKTsKfQoKLyoqCiAqIENsZWFyIHRoZSBjdXJyZW50IHNoYXBlLCBvcHRpb25hbGx5IGNsb3NpbmcgaXQuCiAqCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY2xvc2U/IFdoZW4gdXNlZCwgY2xvc2VzIHRoZSBzaGFwZSdzIGN1cnJlbnQgc2VnbWVudC4KICogQHJldHVybnMge1NoYXBlfSBUaGUgc2hhcGUgdGhhdCBnb3QgY2xvc2VkCiAqCiAqIEBzZWUge0BsaW5rIHN0YXJ0U2hhcGV9CiAqLwpmdW5jdGlvbiBlbmRTaGFwZShjbG9zZSA9IGZhbHNlKSB7CiAgaWYgKF9fc2hhcGUgJiYgY2xvc2UpIF9fc2hhcGUuY2xvc2UoKTsKICBjb25zdCBzaGFwZSA9IF9fc2hhcGU7CiAgX19zaGFwZSA9IHVuZGVmaW5lZDsKICByZXR1cm4gc2hhcGU7Cn0KCi8qKgogKiBTdGFydCBhIG5ldyBzZWdtZW50IGluIGEgc2hhcGUuCiAqCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY2xvc2U/IENsb3NlcyB0aGUgY3VycmVudCBzZWdtZW50IGJlZm9yZSBvcGVuaW5nIGEgbmV3IG9uZSAoZGVmYXVsdCA9IHRydWUpCiAqCiAqIEBzZWUge0BsaW5rIHN0YXJ0U2hhcGV9CiAqIEBzZWUge0BsaW5rIGVuZFNoYXBlfQogKi8KZnVuY3Rpb24gbmV3U2VnbWVudChjbG9zZSA9IHRydWUpIHsKICBfX3NoYXBlPy5uZXdTZWdtZW50KGNsb3NlKTsKfQovKioKICogQ2VudGVycyB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gb24geW91ciBncmFwaGljLgogKiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gY2FsbGluZzoKICoKICogYGBgCiAqIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqIGBgYAogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgY2VudGVyKCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBsaW5lKDAsIC1odWdlLCAwLCBodWdlKTsKICogICAgICAgbGluZSgtaHVnZSwgMCwgaHVnZSwgMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCggMTAsICAxMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCggMTAsIC0xMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCgtMTAsIC0xMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCgtMTAsICAxMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIGNlbnRlcigpIHsKICB0cmFuc2xhdGUod2lkdGggLyAyLCBoZWlnaHQgLyAyKTsKfQoKLyoqCiAqIFJlc2V0IHRoZSBjb29yZGluYXRlIHRyYW5zZm9ybSBtYXRyaXguCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIG5vR3JpZCgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYGxpZ2h0Z3JleWApOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHRyYW5zbGF0ZSg1MCw1MCk7CiAqICAgICAgIGxpbmUoMCwwLDEwMCwwKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApOwogKiAgICAgICBwb2ludCgxMCwwKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBwb2ludCgxMCwwKTsKICogICAgICAgbGluZSgwLDAsMTAwLDApOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICByb3RhdGUoLVBJLzYpCiAqICAgICAgIHBvaW50KDEwMCwwKTsKICogICAgICAgc2NhbGUoMC41LCAwLjUpOwogKiAgICAgICBwb2ludCgxMDAsMCk7CiAqICAgICAgIGxpbmUoMTAwLDAsMjAwLDApOwogKiAgICAgICByZXNldFRyYW5zZm9ybSgpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgbGluZSgwLDMsMTAwLDMpOwogKiAgICAgICBwb2ludCgwLDMpOwogKiAgICAgICBwb2ludCgxMCwzKTsKICogICAgICAgcG9pbnQoMTAwLDMpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHJlc2V0VHJhbnNmb3JtKCkgewogIF9fY3R4LnJlc2V0VHJhbnNmb3JtKCk7Cn0KCi8qKgogKiBSb3RhdGUgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIHdydCB0aGUgY3VycmVudCBvcmlnaW4uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIG5vR3JpZCgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYGxpZ2h0Z3JleWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgVGhlIGFuZ2xlIGJ5IHdoaWNoIHRvIHJvdGF0ZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gaW4gcmFkaWFucwogKgogKiBAc2VlIHtAbGluayB0cmFuc2Zvcm19CiAqIEBzZWUge0BsaW5rIHJlc2V0VHJhbnNmb3JtfQogKi8KZnVuY3Rpb24gcm90YXRlKGFuZ2xlID0gMCkgewogIF9fY3R4LnJvdGF0ZShhbmdsZSk7Cn0KCi8qKgogKiBTY2FsZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gd3J0IHRoZSBjdXJyZW50IG9yaWdpbi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgbGlnaHRncmV5YCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwb2ludCgwLDApOwogKiAgICAgICBzZXRDb2xvcihgZGFya2dyZWVuYCk7CiAqICAgICAgIGxpbmUoMCwwLDIwLDIwKTsKICogICAgICAgcG9pbnQoMjAsMjApOwogKiAgICAgICByb3RhdGUoUEkvNCk7CiAqICAgICAgIHNjYWxlKDIpOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgYW1vdW50IGJ5IHdoaWNoIHRvIHNjYWxlIHRoZSB4IGNvb3JkaW5hdGVzLgogKiBAcGFyYW0ge251bWJlcn0geT8gVGhlIGFtb3VudCBieSB3aGljaCB0byBzY2FsZSB0aGUgeCBjb29yZGluYXRlcyAoZGVmYXVsdCA9IHNhbWUgYXMgeCkKICoKICogQHNlZSB7QGxpbmsgdHJhbnNmb3JtfQogKiBAc2VlIHtAbGluayByZXNldFRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHNjYWxlKHggPSAxLCB5ID0geCkgewogIF9fY3R4LnNjYWxlKHgsIHkpOwp9CgovKioKICogQ29udmVydCBhIHNjcmVlbiAoZS5nLiBicm93c2VyKSBjb29yZGluYXRlIGludG8gaXRzCiAqIGNvcnJlc3BvbmRpbmcgInRyYW5zZm9ybWVkIiBjb29yZGluYXRlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBub0dyaWQoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBsaWdodGdyZXlgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBzY2FsZSgwLjUpOwogKiAgICAgICBpZiAocG9pbnRlci5hY3RpdmUpIHsKICogICAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgICAgcG9pbnQocG9pbnRlci54LCBwb2ludGVyLnkpOwogKiAgICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgICAgcG9pbnQoc2NyZWVuVG9Xb3JsZChwb2ludGVyLngsIHBvaW50ZXIueSkpOwogKiAgICAgICB9CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSgpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHNjcmVlbiBjb29yZGluYXRlJ3MgeCB2YWx1ZSBpbiBwaXhlbHMKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHNjcmVlbiBjb29yZGluYXRlJ3MgeSB2YWx1ZSBpbiBwaXhlbHMKICogQHJldHVybnMge1BvaW50TGlrZX0gcCBUaGUgd29ybGQge3gseX0gY29vcmRpbmF0ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgc2NyZWVuIHt4LHl9IGNvb3JkaW5hdGUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCBUaGUgd29ybGQge3gseX0gY29vcmRpbmF0ZQogKgogKiBAc2VlIHtAbGluayBwcm9qZWN0fQogKiBAc2VlIHtAbGluayB3b3JsZFRvU2NyZWVufQogKi8KZnVuY3Rpb24gc2NyZWVuVG9Xb3JsZCh4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIGxldCBNID0gX19jdHguZ2V0VHJhbnNmb3JtKCkuaW52ZXJ0U2VsZigpOwoKICByZXR1cm4gbmV3IFBvaW50KHggKiBNLmEgKyB5ICogTS5jICsgTS5lLCB4ICogTS5iICsgeSAqIE0uZCArIE0uZik7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgdHJhbnNmb3JtIG1hdHJpeCwgYmFzZWQgb24gYXBwbHlpbmc6CiAqCiAqIGBgYAogKiAgICAgICB8IGEgYiBjIHwKICogICBtID0gfCBkIGUgZiB8CiAqICAgICAgIHwgMCAwIDEgfAogKiBgYGAKICoKICogV2l0aCB0aGUgcGFyYW1ldGVycyBkZWZhdWx0aW5nIHRvIHRoZSBpZGVudGl0eSBtYXRyaXguCiAqCiAqIFNlZSB0aGUgZm9sbG93aW5nIE1ETiBhcnRpY2xlIGZvciBtb3JlIGRldGFpbHMgYWJvdXQgdGhpcyBmdW5jdGlvbjoKICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZG9jcy9XZWIvQVBJL0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC90cmFuc2Zvcm0KICoKICogQHBhcmFtIHtudW1iZXJ9IGEgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0ge251bWJlcn0gYiAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSB7bnVtYmVyfSBjIChkZWZhdWx0ID0gMCkKICogQHBhcmFtIHtudW1iZXJ9IGQgKGRlZmF1bHQgPSAwKQogKiBAcGFyYW0ge251bWJlcn0gZSAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSB7bnVtYmVyfSBmIChkZWZhdWx0ID0gMCkKICoKICogQHNlZSB7QGxpbmsgcmVzZXRUcmFuc2Zvcm19CiAqLwpmdW5jdGlvbiB0cmFuc2Zvcm0oYSA9IDEsIGIgPSAwLCBjID0gMCwgZCA9IDAsIGUgPSAxLCBmID0gMCkgewogIF9fY3R4LnRyYW5zZm9ybShhLCBiLCBjLCBkLCBlLCBmKTsKfQoKLyoqCiAqIFRyYW5zbGF0ZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gYnkgc29tZSBhbW91bnQgb2YgeCBhbmQgeSB1bml0cy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHBvaW50KDAsMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHggdmFsdWUgaW4gcGl4ZWxzIHRvIGJlIHRyZWF0ZWQgYXMgdGhlIG5ldyAiemVybyIKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHkgdmFsdWUgaW4gcGl4ZWxzIHRvIGJlIHRyZWF0ZWQgYXMgdGhlIG5ldyAiemVybyIKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHt4LHl9IGNvb3JkaW5hdGUgdG8gYmUgdHJlYXRlZCBhcyB0aGUgbmV3ICJ6ZXJvIgogKgogKiBAc2VlIHtAbGluayB0cmFuc2Zvcm19CiAqIEBzZWUge0BsaW5rIHJlc2V0VHJhbnNmb3JtfQogKi8KZnVuY3Rpb24gdHJhbnNsYXRlKHggPSAwLCB5ID0gMCkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIF9fY3R4LnRyYW5zbGF0ZSh4LCB5KTsKfQoKLyoqCiAqIENvbnZlcnQgYW4gaW4tY2FudmFzICJ0cmFuc2Zvcm1lZCIgY29vcmRpbmF0ZSBpbnRvIGl0cwogKiBjb3JyZXNwb25kaW5nICJzY3JlZW4iIChpLmUuIGJyb3dzZXIgY2FudmFzIG9mZnNldCkgY29vcmRpbmF0ZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7CiAqCiAqICAgICAgIHJvdGF0ZShtaWxsaXMoKSAvIDIwMDApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIGNvbnN0IHAgPSBuZXcgUG9pbnQoMzAsIDApOwogKiAgICAgICBwb2ludChwKTsKICogICAgICAgdGV4dChgJHtwLnh9LCR7cC55fWAsIHAueCArIDEwLCBwLnkgKyAxMCk7CiAqCiAqICAgICAgIGNvbnN0IHt4LCB5fSA9IHdvcmxkVG9TY3JlZW4ocCk7CiAqICAgICAgIHJlc2V0VHJhbnNmb3JtKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDE2KTsKICogICAgICAgdGV4dChgJHt4LnRvRml4ZWQoKX0sJHt5LnRvRml4ZWQoKX1gLCB4IC0gMjUsIHkgLSAxNSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHdvcmxkIGNvb3JkaW5hdGUncyB4IHZhbHVlIGluIHBpeGVscwogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgd29ybGQgY29vcmRpbmF0ZSdzIHkgdmFsdWUgaW4gcGl4ZWxzCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgVGhlIHNjcmVlbiB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSB3b3JsZCB7eCx5fSBjb29yZGluYXRlCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgVGhlIHNjcmVlbiB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBzZWUge0BsaW5rIHByb2plY3R9CiAqIEBzZWUge0BsaW5rIHNjcmVlblRvV29ybGR9CiAqLwpmdW5jdGlvbiB3b3JsZFRvU2NyZWVuKHgsIHkpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgbGV0IE0gPSBfX2N0eC5nZXRUcmFuc2Zvcm0oKTsKCiAgcmV0dXJuIG5ldyBQb2ludCh4ICogTS5hICsgeSAqIE0uYyArIE0uZSwgeCAqIE0uYiArIHkgKiBNLmQgKyBNLmYpOwp9CmZ1bmN0aW9uIGdyaWQoKSB7CiAgc2F2ZSgpOwogIHNldExpbmVXaWR0aCgwLjUpOwogIG5vRmlsbCgpOwogIHNldFN0cm9rZShfX2dyaWRfY29sb3IpOwogIGZvciAoCiAgICBsZXQgeCA9ICgtMC41ICsgX19ncmlkX3NwYWNpbmcgLyAyKSB8IDA7CiAgICB4IDwgd2lkdGg7CiAgICB4ICs9IF9fZ3JpZF9zcGFjaW5nCiAgKSB7CiAgICBsaW5lKHgsIDAsIHgsIGhlaWdodCk7CiAgfQogIGZvciAoCiAgICBsZXQgeSA9ICgtMC41ICsgX19ncmlkX3NwYWNpbmcgLyAyKSB8IDA7CiAgICB5IDwgaGVpZ2h0OwogICAgeSArPSBfX2dyaWRfc3BhY2luZwogICkgewogICAgbGluZSgwLCB5LCB3aWR0aCwgeSk7CiAgfQogIHJlc3RvcmUoKTsKfQpmdW5jdGlvbiBfX3NhZmVseUludGVyY2VwdEtleShldnQpIHsKICAvLyBXZSBkb24ndCB3YW50IHRvIGludGVyZmVyZSB3aXRoIHRoZSBicm93c2VyLCBzbyB3ZSdyZSBvbmx5CiAgLy8gZ29pbmcgdG8gYWxsb3cgdW5tb2RpZmllZCBrZXlzLCBvciBzaGlmdC1tb2RpZmllZCBrZXlzLAogIC8vIGFuZCB0YWIgaGFzIHRvIGFsd2F5cyB3b3JrLiBGb3Igb2J2aW91cyByZWFzb25zLgogIGNvbnN0IHRhYiA9IGV2dC5rZXkgIT09ICJUYWIiOwogIGNvbnN0IGZ1bmN0aW9uS2V5ID0gZXZ0LmtleS5tYXRjaCgvRlxkKy8pID09PSBudWxsOwogIGNvbnN0IHNwZWNpZmljQ2hlY2sgPSB0YWIgJiYgZnVuY3Rpb25LZXk7CiAgaWYgKCFldnQuYWx0S2V5ICYmICFldnQuY3RybEtleSAmJiAhZXZ0Lm1ldGFLZXkgJiYgc3BlY2lmaWNDaGVjaykgewogICAgaWYgKGV2dC50YXJnZXQgPT09IF9fY2FudmFzKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBfX2tleURvd24oa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KSB7CiAga2V5Ym9hcmRba2V5XSA9IERhdGUubm93KCk7CiAgaWYgKHR5cGVvZiBrZXlEb3duICE9PSBgdW5kZWZpbmVkYCkKICAgIGtleURvd24oa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KTsKfQoKX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihga2V5ZG93bmAsIChldnQpID0+IHsKICBfX3NhZmVseUludGVyY2VwdEtleShldnQpOwogIGNvbnN0IHsga2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5IH0gPSBldnQ7CiAgaWYgKF9fZmluaXNoZWRfc2V0dXApIF9fa2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9KTsKCmZ1bmN0aW9uIF9fa2V5VXAoa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KSB7CiAgZGVsZXRlIGtleWJvYXJkW2tleV07CiAgaWYgKHR5cGVvZiBrZXlVcCAhPT0gYHVuZGVmaW5lZGApCiAgICBrZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9CgpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBrZXl1cGAsIChldnQpID0+IHsKICBfX3NhZmVseUludGVyY2VwdEtleShldnQpOwogIGNvbnN0IHsga2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5IH0gPSBldnQ7CiAgaWYgKF9fZmluaXNoZWRfc2V0dXApIF9fa2V5VXAoa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KTsKfSk7CmNvbnN0IF9fYmlub21pYWxDb2VmZmljaWVudHMgPSBbWzFdLCBbMSwgMV1dOwpjbGFzcyBNYXRyaXggewogIGNvbnN0cnVjdG9yKG4sIG0sIGRhdGEpIHsKICAgIGRhdGEgPSBuIGluc3RhbmNlb2YgQXJyYXkgPyBuIDogZGF0YTsKICAgIHRoaXMuZGF0YSA9CiAgICAgIGRhdGEgPz8gWy4uLm5ldyBBcnJheShuKV0ubWFwKCh2KSA9PiBbLi4ubmV3IEFycmF5KG0pXS5tYXAoKHYpID0+IDApKTsKICAgIHRoaXMucm93cyA9IHRoaXMuZGF0YS5sZW5ndGg7CiAgICB0aGlzLmNvbHMgPSB0aGlzLmRhdGFbMF0ubGVuZ3RoOwogIH0KICBzZXREYXRhKGRhdGEpIHsKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgfQogIGdldChpLCBqKSB7CiAgICByZXR1cm4gdGhpcy5kYXRhW2ldW2pdOwogIH0KICBzZXQoaSwgaiwgdmFsdWUpIHsKICAgIHRoaXMuZGF0YVtpXVtqXSA9IHZhbHVlOwogIH0KICByb3coaSkgewogICAgcmV0dXJuIHRoaXMuZGF0YVtpXTsKICB9CiAgY29sKGopIHsKICAgIHZhciBkID0gdGhpcy5kYXRhLAogICAgICBjb2wgPSBbXTsKICAgIGZvciAobGV0IHIgPSAwLCBsID0gZC5sZW5ndGg7IHIgPCBsOyByKyspIHsKICAgICAgY29sLnB1c2goZFtyXVtqXSk7CiAgICB9CiAgICByZXR1cm4gY29sOwogIH0KICBtdWx0aXBseShvdGhlcikgewogICAgcmV0dXJuIG5ldyBNYXRyaXgobXVsdGlwbHlNYXRyaXgodGhpcy5kYXRhLCBvdGhlci5kYXRhKSk7CiAgfQogIGludmVydCgpIHsKICAgIHJldHVybiBuZXcgTWF0cml4KGludmVydE1hdHJpeCh0aGlzLmRhdGEpKTsKICB9CiAgdHJhbnNwb3NlKCkgewogICAgcmV0dXJuIG5ldyBNYXRyaXgodHJhbnNwb3NlTWF0cml4KHRoaXMuZGF0YSkpOwogIH0KfQpjbGFzcyBQb2ludCB7CiAgY29uc3RydWN0b3IoeCwgeSkgewogICAgdGhpcy54ID0geDsKICAgIHRoaXMueSA9IHk7CiAgfQp9CgpjbGFzcyBDaXJjbGUgZXh0ZW5kcyBQb2ludCB7CiAgY29uc3RydWN0b3IoeCwgeSwgcikgewogICAgc3VwZXIoeCwgeSk7CiAgICB0aGlzLnIgPSByOwogIH0KfQpmdW5jdGlvbiBfX2NoZWNrRm9yQ3VycmVudE1vdmFibGUoeCwgeSwgdHlwZSkgewogIGN1cnJlbnRNb3ZhYmxlID0gZmFsc2U7CgogIGlmICghX19tb3ZhYmxlX3BvaW50cy5sZW5ndGgpIHJldHVybjsKCiAgY29uc3QgbWF0Y2hlcyA9IFtdOwogIGNvbnN0IG1hdGNoUGFkZGluZyA9IHR5cGUuaW5jbHVkZXMoYG1vdXNlYCkgPyAxMCA6IDMwOwoKICBfX21vdmFibGVfcG9pbnRzLmZvckVhY2goKHAsIHBvcykgPT4gewogICAgaWYgKHAgaW5zdGFuY2VvZiBTaGFwZSkgewogICAgICBpZiAocC5pbnNpZGUoeCwgeSkubGVuZ3RoID4gMCkgewogICAgICAgIG1hdGNoZXMucHVzaCh7IHAsIGQ6IDAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGxldCB4MiA9IHBbMF0gPT09IHVuZGVmaW5lZCA/IHAueCA6IHBbMF07CiAgICAgIGxldCB5MiA9IHBbMV0gPT09IHVuZGVmaW5lZCA/IHAueSA6IHBbMV07CiAgICAgIGNvbnN0IGQgPSBkaXN0KHgsIHksIHgyLCB5Mik7CiAgICAgIGlmIChkIDwgKHAuciA/IHAuciA6IDApICsgbWF0Y2hQYWRkaW5nKSB7CiAgICAgICAgbWF0Y2hlcy5wdXNoKHsgcCwgZCB9KTsKICAgICAgfQogICAgfQogIH0pOwoKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgYXV0b2A7CgogIGlmIChtYXRjaGVzLmxlbmd0aCkgewogICAgbWF0Y2hlcy5zb3J0KChhLCBiKSA9PiBhLmQgLSBiLmQpOwogICAgY3VycmVudE1vdmFibGUgPSBtYXRjaGVzWzBdLnA7CiAgICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgcG9pbnRlcmA7CiAgfQp9CgpmdW5jdGlvbiBfX3RvUG9pbnRlckV2ZW50KGV2dCkgewogIGxldCBwb2ludGVyID0gZXZ0OwogIC8vIENvbnZlcnQgbW91c2Ugb3IgdG91Y2ggaW50byBnZW5lcmljIHBvaW50ZXIuIFdoaWNoIHdlIG5lZWQKICAvLyB0byBkbyBiZWNhdXNlIENocm9tZSBvbiBNYWNPUyBoYXMgZGVjaWRlZCB0byBub3QgZ2VuZXJhdGUKICAvLyBwb2ludGVyIGV2ZW50cyB3aGVuIHRoZXJlJ3MgYSBtb3VzZS4gVGhhbmtzIEdvb2dsZSEKICBpZiAoZXZ0LnR5cGUuaW5jbHVkZXMoYHRvdWNoYCkpIHsKICAgIGNvbnN0IHsgdG91Y2hlcywgY2hhbmdlZFRvdWNoZXMgfSA9IGV2dC5vcmlnaW5hbEV2ZW50ID8/IGV2dDsKICAgIHBvaW50ZXIgPSB0b3VjaGVzWzBdID8/IGNoYW5nZWRUb3VjaGVzWzBdOwogIH0KICBjb25zdCB7IGNsaWVudFgsIGNsaWVudFkgfSA9IHBvaW50ZXI7CiAgY29uc3QgeyBsZWZ0LCB0b3AgfSA9IF9fY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogIHJldHVybiB7IG9mZnNldFg6IGNsaWVudFggLSBsZWZ0LCBvZmZzZXRZOiBjbGllbnRZIC0gdG9wIH07Cn0KCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09CgpbYHRvdWNoc3RhcnRgLCBgbW91c2Vkb3duYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2dCkgPT4gewogICAgaWYgKF9fZmluaXNoZWRfc2V0dXApIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgY29uc3QgeyBvZmZzZXRYLCBvZmZzZXRZIH0gPSBfX3RvUG9pbnRlckV2ZW50KGV2dCk7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUsIGRvd246IHRydWUsIG1hcms6IHsgeCwgeSB9IH0pOwogICAgICBfX2NoZWNrRm9yQ3VycmVudE1vdmFibGUoeCwgeSwgdHlwZSk7CiAgICAgIF9fcG9pbnRlckRvd24oeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyRG93bih4LCB5KSB7CiAgaWYgKGN1cnJlbnRNb3ZhYmxlKSB7CiAgICBpZiAoY3VycmVudE1vdmFibGUgaW5zdGFuY2VvZiBTaGFwZSkgewogICAgICAvLyBkb24ndCBkbyBhbnl0aGluZyBzcGVjaWFsLgogICAgfSBlbHNlIHsKICAgICAgY3VycmVudE1vdmFibGUuX2R4ID0gY3VycmVudE1vdmFibGUueCAtIHg7CiAgICAgIGN1cnJlbnRNb3ZhYmxlLl9keSA9IGN1cnJlbnRNb3ZhYmxlLnkgLSB5OwogICAgfQogIH0KICBpZiAodHlwZW9mIHBvaW50ZXJEb3duICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlckRvd24oeCwgeSk7Cn0KCltgdG91Y2hlbmRgLCBgbW91c2V1cGBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChldnQpID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGNvbnN0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gX190b1BvaW50ZXJFdmVudChldnQpOwogICAgICBjb25zdCB7IHgsIHkgfSA9IHNjcmVlblRvV29ybGQob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwgewogICAgICAgIHgsCiAgICAgICAgeSwKICAgICAgICB0eXBlLAogICAgICAgIGRvd246IGZhbHNlLAogICAgICAgIG1hcms6IGZhbHNlLAogICAgICAgIGRyYWc6IGZhbHNlLAogICAgICB9KTsKICAgICAgX19wb2ludGVyVXAoeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyVXAoeCwgeSkgewogIGlmICh0eXBlb2YgcG9pbnRlclVwICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlclVwKHgsIHkpOwogIGlmIChwb2ludGVyLm1hcms/LnggPT09IHggJiYgcG9pbnRlci5tYXJrPy55ID09PSB5KSB7CiAgICBpZiAodHlwZW9mIHBvaW50ZXJDbGljayAhPT0gYHVuZGVmaW5lZGApIHBvaW50ZXJDbGljayh4LCB5KTsKICB9CiAgaWYgKGN1cnJlbnRNb3ZhYmxlICYmIGN1cnJlbnRNb3ZhYmxlIGluc3RhbmNlb2YgU2hhcGUpIHsKICAgIGN1cnJlbnRNb3ZhYmxlLmNvbW1pdCgpOwogIH0KfQoKW2B0b3VjaG1vdmVgLCBgbW91c2Vtb3ZlYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2dCkgPT4gewogICAgaWYgKF9fZmluaXNoZWRfc2V0dXApIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgY29uc3QgeyBvZmZzZXRYLCBvZmZzZXRZIH0gPSBfX3RvUG9pbnRlckV2ZW50KGV2dCk7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUgfSk7CiAgICAgIGlmICghcG9pbnRlci5kb3duKSBfX2NoZWNrRm9yQ3VycmVudE1vdmFibGUoeCwgeSwgdHlwZSk7CiAgICAgIF9fcG9pbnRlck1vdmUoeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyTW92ZSh4LCB5KSB7CiAgbGV0IGhhZE1vdmFibGUgPSBmYWxzZTsKICBpZiAocG9pbnRlci5kb3duICYmIGN1cnJlbnRNb3ZhYmxlKSB7CiAgICBpZiAoY3VycmVudE1vdmFibGUgaW5zdGFuY2VvZiBTaGFwZSkgewogICAgICBjdXJyZW50TW92YWJsZS5vZmZzZXQoeCAtIHBvaW50ZXIubWFyay54LCB5IC0gcG9pbnRlci5tYXJrLnkpOwogICAgfSBlbHNlIGlmIChjdXJyZW50TW92YWJsZVswXSkgewogICAgICBjdXJyZW50TW92YWJsZVswXSA9IHggKyBjdXJyZW50TW92YWJsZS5fZHg7CiAgICAgIGN1cnJlbnRNb3ZhYmxlWzFdID0geSArIGN1cnJlbnRNb3ZhYmxlLl9keTsKICAgIH0gZWxzZSB7CiAgICAgIGN1cnJlbnRNb3ZhYmxlLnggPSB4ICsgY3VycmVudE1vdmFibGUuX2R4OwogICAgICBjdXJyZW50TW92YWJsZS55ID0geSArIGN1cnJlbnRNb3ZhYmxlLl9keTsKICAgIH0KICAgIGhhZE1vdmFibGUgPSB0cnVlOwogIH0KCiAgcG9pbnRlci5kcmFnID0gcG9pbnRlci5kb3duOwoKICBpZiAocG9pbnRlci5kcmFnICYmIHR5cGVvZiBwb2ludGVyRHJhZyAhPT0gYHVuZGVmaW5lZGApIHsKICAgIHBvaW50ZXJEcmFnKHgsIHkpOwogIH0KCiAgaWYgKHR5cGVvZiBwb2ludGVyTW92ZSAhPT0gYHVuZGVmaW5lZGApIHsKICAgIHBvaW50ZXJNb3ZlKHgsIHkpOwogIH0KCiAgaWYgKGhhZE1vdmFibGUgJiYgIXBsYXlpbmcpIHJlZHJhdygpOwp9CgpbYHRvdWNoc3RhcnRgLCBgbW91c2VlbnRlcmBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsICgpID0+IHsKICAgIHBvaW50ZXIuYWN0aXZlID0gdHJ1ZTsKICAgIF9fcG9pbnRlckFjdGl2ZSh0cnVlKTsKICB9KTsKfSk7CgpbYHRvdWNoZW5kYCwgYG1vdXNlbGVhdmVgXS5mb3JFYWNoKCh0eXBlKSA9PiB7CiAgX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCAoKSA9PiB7CiAgICBfX3BvaW50ZXJBY3RpdmUoZmFsc2UpOwogIH0pOwp9KTsKCmZ1bmN0aW9uIF9fcG9pbnRlckFjdGl2ZShhY3RpdmUpIHsKICBpZiAodHlwZW9mIHBvaW50ZXJBY3RpdmUgIT09IGB1bmRlZmluZWRgKSB7CiAgICBwb2ludGVyQWN0aXZlKGFjdGl2ZSk7CiAgfQp9Ci8qKgogKiBjb2RlIHVzZWQgYnkgcHJvamVjdC5qcywgYnV0IG5hbWVkIHNvIHRoYXQgaXQgbG9hZHMKICogZmlyc3QsIGFuZCBkb2VzIG5vdCBnZXQgYWRkZWQgdG8gdGhlIGQudHMgZmlsZS4KICovCmNsYXNzIENhYmluZXRQcm9qZWN0b3IgewogIEEgPSAwOwogIEIgPSAwOwogIEMgPSAwOwoKICBjb25zdHJ1Y3RvcihveCwgb3ksIHNjYWxlLCBwaGkpIHsKICAgIHRoaXMudXBkYXRlKG94LCBveSwgc2NhbGUsIHBoaSk7CiAgfQoKICBzZXRSb3RhdGlvbih4ID0gMCwgeSA9IDAsIHogPSAwKSB7CiAgICB0aGlzLkEgPSB4OwogICAgdGhpcy5CID0gejsKICAgIHRoaXMuQyA9IHk7CiAgfQoKICByb3RhdGUoeCwgeSwgeikgewogICAgbGV0IHsgQSwgQiwgQyB9ID0gdGhpczsKICAgIGxldCBhID0geDsKICAgIGxldCBiID0geSAqIGNvcyhBKSAtIHogKiBzaW4oQSk7CiAgICBsZXQgYyA9IHkgKiBzaW4oQSkgKyB6ICogY29zKEEpOwogICAgeCA9IGE7CiAgICB5ID0gYjsKICAgIHogPSBjOwogICAgYSA9IHggKiBjb3MoQikgKyB6ICogc2luKEIpOwogICAgYiA9IHk7CiAgICBjID0geCAqIC1zaW4oQikgKyB6ICogY29zKEIpOwogICAgeCA9IGE7CiAgICB5ID0gYjsKICAgIHogPSBjOwogICAgYSA9IHggKiBjb3MoQykgLSB5ICogc2luKEMpOwogICAgYiA9IHggKiBzaW4oQykgKyB5ICogY29zKEMpOwogICAgYyA9IHo7CgogICAgcmV0dXJuIFthLCBiLCBjXTsKICB9CgogIHVwZGF0ZShveCA9IDAsIG95ID0gMCwgc2NhbGUgPSAxLCBwaGkgPSAtUEkgLyA2KSB7CiAgICB0aGlzLm9mZnNldCA9IG5ldyBQb2ludChveCwgb3kpOwogICAgdGhpcy5zY2FsZSA9IHNjYWxlOwogICAgdGhpcy5waGkgPSBwaGk7CiAgfQoKICBwcm9qZWN0KHgsIHksIHopIHsKICAgIGNvbnN0IHsgb2Zmc2V0LCBzY2FsZSwgcGhpIH0gPSB0aGlzOwogICAgeCAqPSBzY2FsZTsKICAgIHkgKj0gc2NhbGU7CiAgICB6ICo9IHNjYWxlOwogICAgW3gsIHksIHpdID0gdGhpcy5yb3RhdGUoeCwgeSwgeik7CiAgICBjb25zdCBhID0geSwKICAgICAgYiA9IC16LAogICAgICBjID0gLXggLyAyOwoKICAgIHJldHVybiBuZXcgUG9pbnQoCiAgICAgIG9mZnNldC54ICsgYSArIGMgKiBjb3MocGhpKSwKICAgICAgb2Zmc2V0LnkgKyBiICsgYyAqIHNpbihwaGkpCiAgICApOwogIH0KfQoKbGV0IF9fcHJvamVjdG9yID0gbmV3IENhYmluZXRQcm9qZWN0b3IoKTsKY29uc3QgUE9MWUdPTiA9IGBwb2x5Z29uYDsKY29uc3QgU1BMSU5FID0gYHNwbGluZWA7CmNvbnN0IEJFWklFUiA9IGBiZXppZXJgOwoKLyoqCiAqIC4uLmRvY3MgZ28gaGVyZS4uLgogKi8KY2xhc3MgU2VnbWVudCB7CiAgY2xvc2VkID0gZmFsc2U7CiAgb3ggPSAwOwogIG95ID0gMDsKICBwb2ludHMgPSBbXTsKCiAgYWRkKHgsIHksIHR5cGUgPSBQT0xZR09OKSB7CiAgICBjb25zdCB7IGNsb3NlZCwgcG9pbnRzIH0gPSB0aGlzOwogICAgaWYgKGNsb3NlZCkgcmV0dXJuOwogICAgY29uc3QgcCA9IHsgeCwgeSwgdHlwZSB9OwogICAgcG9pbnRzLnB1c2gocCk7CiAgICByZXR1cm4gcDsKICB9CgogIGNsb3NlKCkgewogICAgdGhpcy5jbG9zZWQgPSB0cnVlOwogIH0KCiAgb2Zmc2V0KHgsIHkpIHsKICAgIHRoaXMub3ggPSB4OwogICAgdGhpcy5veSA9IHk7CiAgfQoKICBjb21taXQoKSB7CiAgICBjb25zdCB7IG94LCBveSwgcG9pbnRzIH0gPSB0aGlzOwogICAgcG9pbnRzLmZvckVhY2goKHApID0+IHsKICAgICAgcC54ICs9IG94OwogICAgICBwLnkgKz0gb3k7CiAgICB9KTsKICAgIHRoaXMub3ggPSAwOwogICAgdGhpcy5veSA9IDA7CiAgfQoKICBkcmF3KHNob3dQb2ludHMgPSBmYWxzZSkgewogICAgY29uc3QgeyBjbG9zZWQsIG94LCBveSwgcG9pbnRzIH0gPSB0aGlzOwogICAgc3RhcnQoKTsKICAgIGNvbnN0IHMgPSBwb2ludHMuc2xpY2UoKTsKICAgIGlmIChjbG9zZWQpIHMucHVzaChzWzBdKTsKICAgIHMuZm9yRWFjaCgoeyB4LCB5IH0pID0+IHZlcnRleCh4ICsgb3gsIHkgKyBveSkpOwogICAgZW5kKCk7CiAgICBpZiAoc2hvd1BvaW50cykgewogICAgICBwb2ludHMuZm9yRWFjaCgocCkgPT4gcG9pbnQocC54ICsgb3gsIHAueSArIG95KSk7CiAgICB9CiAgfQoKICBpbnNpZGUoeCwgeSkgewogICAgLy8gbGV0J3MgZG8gc29tZSByYXkgY2FzdGluZywgdHJlYXRpbmcgdGhlIHBhdGggY2xvc2VkLgogICAgbGV0IGNyb3NzaW5nID0gMDsKICAgIGNvbnN0IHsgb3gsIG95LCBwb2ludHMgfSA9IHRoaXM7CiAgICBjb25zdCB7IGxlbmd0aDogbiB9ID0gcG9pbnRzOwogICAgaWYgKG4gPCAzKSByZXR1cm4gMDsKICAgIGZvciAobGV0IGkgPSAwLCBwMSwgcDI7IGkgPCBuOyBpKyspIHsKICAgICAgcDEgPSBwb2ludHNbaV07CiAgICAgIHAyID0gcG9pbnRzWyhpICsgMSkgJSBuXTsKICAgICAgY29uc3QgciA9IGxsaSgKICAgICAgICB7CiAgICAgICAgICB4OiBwMS54ICsgb3gsCiAgICAgICAgICB5OiBwMS55ICsgb3ksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB4OiBwMi54ICsgb3gsCiAgICAgICAgICB5OiBwMi55ICsgb3ksCiAgICAgICAgfSwKICAgICAgICB7IHgsIHkgfSwKICAgICAgICB7IHgsIHk6IHkgLSBodWdlIH0KICAgICAgKTsKICAgICAgaWYgKHI/LmluQm91bmRzKSBjcm9zc2luZysrOwogICAgfQogICAgcmV0dXJuIGNyb3NzaW5nICUgMiA9PT0gMTsKICB9Cn0KCi8qKgogKiAuLi5jb2RlIGdvZXMgaGVyZS4uLgogKi8KY2xhc3MgU2hhcGUgewogIHNlZ21lbnRzID0gW107CiAgcmVzaXphYmxlID0gZmFsc2U7CgogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5uZXdTZWdtZW50KCk7CiAgfQoKICBtYWtlTW92YWJsZShtb3ZhYmxlID0gdHJ1ZSkgewogICAgaWYgKG1vdmFibGUpIHsKICAgICAgc2V0TW92YWJsZSh0aGlzKTsKICAgIH0gZWxzZSB7CiAgICAgIHVuc2V0TW92YWJsZSh0aGlzKTsKICAgIH0KICB9CgogIGFsbG93UmVzaXppbmcoYWxsb3dlZCA9IHRydWUpIHsKICAgIHRoaXMucmVzaXphYmxlID0gYWxsb3dlZDsKICB9CgogIGNsb3NlKCkgewogICAgdGhpcy5zZWdtZW50cy5hdCgtMSkuY2xvc2UoKTsKICB9CgogIG5ld1NlZ21lbnQoY2xvc2VDdXJyZW50ID0gZmFsc2UpIHsKICAgIGNvbnN0IHsgc2VnbWVudHMgfSA9IHRoaXM7CiAgICBpZiAoc2VnbWVudHMubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBzZWdtZW50cy5wdXNoKG5ldyBTZWdtZW50KCkpOwogICAgfQogICAgY29uc3QgY3VycmVudCA9IHNlZ21lbnRzLmF0KC0xKTsKICAgIGlmIChjdXJyZW50Py5wb2ludHMubGVuZ3RoKSB7CiAgICAgIGlmIChjbG9zZUN1cnJlbnQpIGN1cnJlbnQuY2xvc2UoKTsKICAgICAgc2VnbWVudHMucHVzaChuZXcgU2VnbWVudCgpKTsKICAgIH0KICB9CgogIGFkZCh4LCB5LCB0eXBlID0gUE9MWUdPTikgewogICAgY29uc3QgcCA9IHRoaXMuc2VnbWVudHMuYXQoLTEpLmFkZCh4LCB5LCB0eXBlKTsKICAgIGlmICh0aGlzLnJlc2l6YWJsZSkgc2V0TW92YWJsZShwKTsKICB9CgogIGFkZFBvaW50KHgsIHkpIHsKICAgIGNvbnN0IHAgPSB0aGlzLnNlZ21lbnRzLmF0KC0xKS5hZGQoeCwgeSk7CiAgICBpZiAodGhpcy5yZXNpemFibGUpIHNldE1vdmFibGUocCk7CiAgfQoKICBvZmZzZXQoeCwgeSwgc2VnbWVudElkID0gdW5kZWZpbmVkKSB7CiAgICBjb25zdCB7IHNlZ21lbnRzIH0gPSB0aGlzOwogICAgaWYgKHNlZ21lbnRJZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHNlZ21lbnRzW3NlZ21lbnRJZF0ub2Zmc2V0KHgsIHkpOwogICAgfSBlbHNlIHsKICAgICAgc2VnbWVudHMuZm9yRWFjaCgocCkgPT4gcC5vZmZzZXQoeCwgeSkpOwogICAgfQogIH0KCiAgY29tbWl0KCkgewogICAgdGhpcy5zZWdtZW50cy5mb3JFYWNoKChwKSA9PiBwLmNvbW1pdCgpKTsKICB9CgogIHJlc2V0KCkgewogICAgc2VnbWVudHMuZm9yRWFjaCgocCkgPT4gcC5vZmZzZXQoMCwgMCkpOwogIH0KCiAgZHJhdyhzaG93UG9pbnRzID0gZmFsc2UpIHsKICAgIHRoaXMuc2VnbWVudHMuZm9yRWFjaCgocCkgPT4gcC5kcmF3KHNob3dQb2ludHMpKTsKICB9CgogIGluc2lkZSh4LCB5KSB7CiAgICByZXR1cm4gdGhpcy5zZWdtZW50cwogICAgICAubWFwKChzLCBpZCkgPT4gewogICAgICAgIHMuaWQgPSBpZDsKICAgICAgICByZXR1cm4gczsKICAgICAgfSkKICAgICAgLmZpbHRlcigocykgPT4gcy5pbnNpZGUoeCwgeSkpOwogIH0KfQpjbGFzcyBWZWN0b3IgewogIGNvbnN0cnVjdG9yKHgsIHksIHopIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIHogPSB4Lno7CiAgICAgIHkgPSB4Lnk7CiAgICAgIHggPSB4Lng7CiAgICB9CiAgICB0aGlzLnggPSB4OwogICAgdGhpcy55ID0geTsKICAgIGlmICh6ICE9PSB1bmRlZmluZWQpIHsKICAgICAgdGhpcy56ID0gejsKICAgIH0KICB9CgogIGRpc3Qob3RoZXIsIHksIHogPSAwKSB7CiAgICBpZiAoeSAhPT0gdW5kZWZpbmVkKSBvdGhlciA9IHsgeDogb3RoZXIsIHksIHogfTsKICAgIGxldCBzdW0gPSAwOwogICAgc3VtICs9ICh0aGlzLnggLSBvdGhlci54KSAqKiAyOwogICAgc3VtICs9ICh0aGlzLnkgLSBvdGhlci55KSAqKiAyOwogICAgbGV0IHoxID0gdGhpcy56ID8gdGhpcy56IDogMDsKICAgIGxldCB6MiA9IG90aGVyLnogPyBvdGhlci56IDogMDsKICAgIHN1bSArPSAoejEgLSB6MikgKiogMjsKICAgIHJldHVybiBzdW0gKiogMC41OwogIH0KCiAgbm9ybWFsaXplKGYpIHsKICAgIGxldCBtYWcgPSB0aGlzLmRpc3QoMCwgMCwgMCk7CiAgICByZXR1cm4gbmV3IFZlY3RvcigKICAgICAgKGYgKiB0aGlzLngpIC8gbWFnLAogICAgICAoZiAqIHRoaXMueSkgLyBtYWcsCiAgICAgIChmICogdGhpcy56KSAvIG1hZwogICAgKTsKICB9CgogIGdldEFuZ2xlKCkgewogICAgcmV0dXJuIC1NYXRoLmF0YW4yKHRoaXMueSwgdGhpcy54KTsKICB9CgogIHJlZmxlY3Qob3RoZXIpIHsKICAgIGxldCBwID0gbmV3IFZlY3RvcihvdGhlci54IC0gdGhpcy54LCBvdGhlci55IC0gdGhpcy55KTsKICAgIGlmIChvdGhlci56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcC56ID0gb3RoZXIuejsKICAgICAgaWYgKHRoaXMueiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcC56IC09IHRoaXMuejsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXMuc3VidHJhY3QocCk7CiAgfQoKICBhZGQob3RoZXIpIHsKICAgIGxldCBwID0gbmV3IFZlY3Rvcih0aGlzLnggKyBvdGhlci54LCB0aGlzLnkgKyBvdGhlci55KTsKICAgIGlmICh0aGlzLnogIT09IHVuZGVmaW5lZCkgewogICAgICBwLnogPSB0aGlzLno7CiAgICAgIGlmIChvdGhlci56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBwLnogKz0gb3RoZXIuejsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHA7CiAgfQoKICBzdWJ0cmFjdChvdGhlcikgewogICAgbGV0IHAgPSBuZXcgVmVjdG9yKHRoaXMueCAtIG90aGVyLngsIHRoaXMueSAtIG90aGVyLnkpOwogICAgaWYgKHRoaXMueiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHAueiA9IHRoaXMuejsKICAgICAgaWYgKG90aGVyLnogIT09IHVuZGVmaW5lZCkgewogICAgICAgIHAueiAtPSBvdGhlci56OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcDsKICB9CgogIHNjYWxlKGYgPSAxKSB7CiAgICBpZiAoZiA9PT0gMCkgewogICAgICByZXR1cm4gbmV3IFZlY3RvcigwLCAwLCB0aGlzLnogPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IDApOwogICAgfQogICAgbGV0IHAgPSBuZXcgVmVjdG9yKHRoaXMueCAqIGYsIHRoaXMueSAqIGYpOwogICAgaWYgKHRoaXMueiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHAueiA9IHRoaXMueiAqIGY7CiAgICB9CiAgICByZXR1cm4gcDsKICB9Cn0K"),R=class extends h{static{l(this,"GraphicsElement")}set onload(e){this._onload=e}set onerror(e){this._onerror=e}handleAttributeChange(...e){}handleChildChanges(...e){}connectedCallback(){super.connectedCallback(),this.label=document.createElement("label"),this.title||(console.warn("<graphics-element> is missing a title attribute. Always caption your figures."),this.title=""),this.label.textContent=this.title,M(this)?this.loadSource():new IntersectionObserver((e,x)=>e.forEach(t=>{t.isIntersecting&&(this.loadSource(),x.disconnect())}),{threshold:.1,rootMargin:`${window.innerHeight}px`}).observe(this)}getStyle(){return`
=======
var v=Object.defineProperty;var l=(n,e)=>v(n,"name",{value:e,configurable:!0});var T="registered as custom element";function y(n,e){console.warn(`missing implementation for ${e}(...data) in ${n.__proto__.constructor.name}`)}l(y,"NotImplemented");function G(n){return n.prototype.constructor.name.replace(/([A-Z])([a-z])/g,(e,x,t,$)=>{let r=`${x.toLowerCase()}${t}`;return $>0?`-${r}`:r})}l(G,"getElementTagName");var h=class extends HTMLElement{static{l(this,"CustomElement")}static register(e){if(!e[T]){let x=e.tagName||G(e);return customElements.define(x,e),e[T]=!0,customElements.whenDefined(x)}return Promise.resolve()}static get tagName(){return G(this)}constructor(e={}){super(),customElements.resolveScope||(customElements.resolveScope=function($){try{return $.getRootNode().host}catch(r){console.warn(r)}return window}),this._options=e;let x={childList:$=>{this.handleChildChanges(Array.from($.addedNodes),Array.from($.removedNodes)),this.render()},attributes:$=>{this.handleAttributeChange($.attributeName,$.oldValue,this.getAttribute($.attributeName)),this.render()}};this._observer=new MutationObserver($=>{this.isConnected&&$.forEach(r=>{x[r.type](r)})}),this._observer.observe(this,{childList:!0,attributes:!0});let t={mode:"open"};this._shadow=this.attachShadow(t),this._style=document.createElement("style"),this._style.textContent=this.getStyle(),this._options.header!==!1&&(this._header=document.createElement("header")),this._options.slot!==!1&&this._options.void!==!0&&(this._slot=document.createElement("slot")),this._options.footer!==!1&&(this._footer=document.createElement("footer"))}connectedCallback(){this.render()}handleChildChanges(e,x){this._options.void||y(this,"handleChildChanges")}handleAttributeChange(e,x,t){y(this,"handleAttributeChange")}getStyle(){return""}render(){this._shadow.innerHTML="",this._shadow.append(this._style),this._options.header!==!1&&this._shadow.append(this._header),this._options.slot!==!1&&this._shadow.append(this._slot),this._options.footer!==!1&&this._shadow.append(this._footer)}};var O=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREEN","DARKGREY","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREEN","GREENYELLOW","GREY","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREEN","LIGHTGREY","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TRANSPARENT","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN"],w={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(128, 128, 128)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",transparent:"rgba(0,0,0,0)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",ALICEBLUE:"rgb(240, 248, 255)",ANTIQUEWHITE:"rgb(250, 235, 215)",AQUA:"rgb(0, 255, 255)",AQUAMARINE:"rgb(127, 255, 212)",AZURE:"rgb(240, 255, 255)",BEIGE:"rgb(245, 245, 220)",BISQUE:"rgb(255, 228, 196)",BLACK:"rgb(0, 0, 0)",BLANCHEDALMOND:"rgb(255, 235, 205)",BLUE:"rgb(0, 0, 255)",BLUEVIOLET:"rgb(138, 43, 226)",BROWN:"rgb(165, 42, 42)",BURLYWOOD:"rgb(222, 184, 135)",CADETBLUE:"rgb(95, 158, 160)",CHARTREUSE:"rgb(127, 255, 0)",CHOCOLATE:"rgb(210, 105, 30)",CORAL:"rgb(255, 127, 80)",CORNFLOWERBLUE:"rgb(100, 149, 237)",CORNSILK:"rgb(255, 248, 220)",CRIMSON:"rgb(220, 20, 60)",CYAN:"rgb(0, 255, 255)",DARKBLUE:"rgb(0, 0, 139)",DARKCYAN:"rgb(0, 139, 139)",DARKGOLDENROD:"rgb(184, 134, 11)",DARKGRAY:"rgb(169, 169, 169)",DARKGREEN:"rgb(0, 100, 0)",DARKGREY:"rgb(169, 169, 169)",DARKKHAKI:"rgb(189, 183, 107)",DARKMAGENTA:"rgb(139, 0, 139)",DARKOLIVEGREEN:"rgb(85, 107, 47)",DARKORANGE:"rgb(255, 140, 0)",DARKORCHID:"rgb(153, 50, 204)",DARKRED:"rgb(139, 0, 0)",DARKSALMON:"rgb(233, 150, 122)",DARKSEAGREEN:"rgb(143, 188, 143)",DARKSLATEBLUE:"rgb(72, 61, 139)",DARKSLATEGRAY:"rgb(47, 79, 79)",DARKSLATEGREY:"rgb(47, 79, 79)",DARKTURQUOISE:"rgb(0, 206, 209)",DARKVIOLET:"rgb(148, 0, 211)",DEEPPINK:"rgb(255, 20, 147)",DEEPSKYBLUE:"rgb(0, 191, 255)",DIMGRAY:"rgb(105, 105, 105)",DIMGREY:"rgb(105, 105, 105)",DODGERBLUE:"rgb(30, 144, 255)",FIREBRICK:"rgb(178, 34, 34)",FLORALWHITE:"rgb(255, 250, 240)",FORESTGREEN:"rgb(34, 139, 34)",FUCHSIA:"rgb(255, 0, 255)",GAINSBORO:"rgb(220, 220, 220)",GHOSTWHITE:"rgb(248, 248, 255)",GOLD:"rgb(255, 215, 0)",GOLDENROD:"rgb(218, 165, 32)",GRAY:"rgb(128, 128, 128)",GREEN:"rgb(0, 128, 0)",GREENYELLOW:"rgb(173, 255, 47)",GREY:"rgb(128, 128, 128)",HONEYDEW:"rgb(240, 255, 240)",HOTPINK:"rgb(255, 105, 180)",INDIANRED:"rgb(205, 92, 92)",INDIGO:"rgb(75, 0, 130)",IVORY:"rgb(255, 255, 240)",KHAKI:"rgb(240, 230, 140)",LAVENDER:"rgb(230, 230, 250)",LAVENDERBLUSH:"rgb(255, 240, 245)",LAWNGREEN:"rgb(124, 252, 0)",LEMONCHIFFON:"rgb(255, 250, 205)",LIGHTBLUE:"rgb(173, 216, 230)",LIGHTCORAL:"rgb(240, 128, 128)",LIGHTCYAN:"rgb(224, 255, 255)",LIGHTGOLDENRODYELLOW:"rgb(250, 250, 210)",LIGHTGRAY:"rgb(211, 211, 211)",LIGHTGREEN:"rgb(144, 238, 144)",LIGHTGREY:"rgb(211, 211, 211)",LIGHTPINK:"rgb(255, 182, 193)",LIGHTSALMON:"rgb(255, 160, 122)",LIGHTSEAGREEN:"rgb(32, 178, 170)",LIGHTSKYBLUE:"rgb(135, 206, 250)",LIGHTSLATEGRAY:"rgb(119, 136, 153)",LIGHTSLATEGREY:"rgb(119, 136, 153)",LIGHTSTEELBLUE:"rgb(176, 196, 222)",LIGHTYELLOW:"rgb(255, 255, 224)",LIME:"rgb(0, 255, 0)",LIMEGREEN:"rgb(50, 205, 50)",LINEN:"rgb(250, 240, 230)",MAGENTA:"rgb(255, 0, 255)",MAROON:"rgb(128, 0, 0)",MEDIUMAQUAMARINE:"rgb(102, 205, 170)",MEDIUMBLUE:"rgb(0, 0, 205)",MEDIUMORCHID:"rgb(186, 85, 211)",MEDIUMPURPLE:"rgb(147, 112, 219)",MEDIUMSEAGREEN:"rgb(60, 179, 113)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",MEDIUMSPRINGGREEN:"rgb(0, 250, 154)",MEDIUMTURQUOISE:"rgb(72, 209, 204)",MEDIUMVIOLETRED:"rgb(199, 21, 133)",MIDNIGHTBLUE:"rgb(25, 25, 112)",MINTCREAM:"rgb(245, 255, 250)",MISTYROSE:"rgb(255, 228, 225)",MOCCASIN:"rgb(255, 228, 181)",NAVAJOWHITE:"rgb(255, 222, 173)",NAVY:"rgb(0, 0, 128)",OLDLACE:"rgb(253, 245, 230)",OLIVE:"rgb(128, 128, 0)",OLIVEDRAB:"rgb(107, 142, 35)",ORANGE:"rgb(255, 165, 0)",ORANGERED:"rgb(255, 69, 0)",ORCHID:"rgb(218, 112, 214)",PALEGOLDENROD:"rgb(238, 232, 170)",PALEGREEN:"rgb(152, 251, 152)",PALETURQUOISE:"rgb(175, 238, 238)",PALEVIOLETRED:"rgb(219, 112, 147)",PAPAYAWHIP:"rgb(255, 239, 213)",PEACHPUFF:"rgb(255, 218, 185)",PERU:"rgb(205, 133, 63)",PINK:"rgb(255, 192, 203)",PLUM:"rgb(221, 160, 221)",POWDERBLUE:"rgb(176, 224, 230)",PURPLE:"rgb(128, 0, 128)",REBECCAPURPLE:"rgb(102, 51, 153)",RED:"rgb(255, 0, 0)",ROSYBROWN:"rgb(188, 143, 143)",ROYALBLUE:"rgb(65, 105, 225)",SADDLEBROWN:"rgb(139, 69, 19)",SALMON:"rgb(250, 128, 114)",SANDYBROWN:"rgb(244, 164, 96)",SEAGREEN:"rgb(46, 139, 87)",SEASHELL:"rgb(255, 245, 238)",SIENNA:"rgb(160, 82, 45)",SILVER:"rgb(192, 192, 192)",SKYBLUE:"rgb(135, 206, 235)",SLATEBLUE:"rgb(106, 90, 205)",SLATEGRAY:"rgb(112, 128, 144)",SLATEGREY:"rgb(112, 128, 144)",SNOW:"rgb(255, 250, 250)",SPRINGGREEN:"rgb(0, 255, 127)",STEELBLUE:"rgb(70, 130, 180)",TAN:"rgb(210, 180, 140)",TEAL:"rgb(0, 128, 128)",THISTLE:"rgb(216, 191, 216)",TOMATO:"rgb(255, 99, 71)",TRANSPARENT:"rgba(0,0,0,0)",TURQUOISE:"rgb(64, 224, 208)",VIOLET:"rgb(238, 130, 238)",WHEAT:"rgb(245, 222, 179)",WHITE:"rgb(255, 255, 255)",WHITESMOKE:"rgb(245, 245, 245)",YELLOW:"rgb(255, 255, 0)",YELLOWGREEN:"rgb(154, 205, 50)"};function S(n,e,x,t,$,m,E){var i,s,f,a,o=x.length,g=x[0].length;if(e<1)throw new Error("degree must be at least 1 (linear)");if(e>o-1)throw new Error("degree must be less than or equal to point count - 1");if(!$)for($=[],i=0;i<o;i++)$[i]=1;if($.length<x.length&&($=$.concat($.slice(0,e))),t){if(t.length!==o+e+1)throw new Error("bad knot vector length")}else{var t=[];for(i=0;i<o+e+1;i++)t[i]=i}t.length===x.length&&(t=t.concat(t.slice(0,e)));var d=[e,t.length-1-e],A=t[d[0]],p=t[d[1]];if(E||(n=n*(p-A)+A),n<A||n>p)throw new Error("out of bounds");for(f=d[0];f<d[1]&&!(n>=t[f]&&n<=t[f+1]);f++);var b=[];for(i=0;i<o;i++){for(b[i]=[],s=0;s<g;s++)b[i][s]=x[i][s]*$[i];b[i][g]=$[i]}var u;for(a=1;a<=e+1;a++)for(i=f;i>f-e-1+a;i--)for(u=(n-t[i])/(t[i+e+1-a]-t[i]),s=0;s<g+1;s++)b[i][s]=(1-u)*b[i-1][s]+u*b[i][s];var m=m||[];for(i=0;i<g;i++)m[i]=b[f][i]/b[f][g];return m}l(S,"interpolate");var c=3,L=class{static{l(this,"BSpline")}constructor(e,x=!0){this.points=e,this.points=e.map(t=>t instanceof Array?t:[t.x,t.y]),this.formKnots(x),this.formWeights()}getLUT(e=100){let x=e-1;return[...new Array(e)].map((t,$)=>{let r=S($/x,c,this.points,this.knots,this.weights);return{x:r[0],y:r[1]}})}formKnots(e=!1){if(!e)return this.formUniformKnots();let x=[],t=this.points.length,$=t-c;for(let r=1;r<t-c;r++)x.push(r+c);for(let r=0;r<=c;r++)x=[c].concat(x);for(let r=0;r<=c;r++)x.push($+c);return this.knots=x}formUniformKnots(){return this.knots=[...new Array(this.points.length+c+1)].map((e,x)=>x)}formWeights(){return this.weights=this.points.map(e=>1)}};function I(n){let e=new TextEncoder().encode(n),x=String.fromCodePoint(...e);return btoa(x)}l(I,"base64");function U(n){let e=atob(n),x=Uint8Array.from(e,t=>t.codePointAt(0));return new TextDecoder().decode(x)}l(U,"decode64");function C(n){let e=/^(.*)\/([^.]+(\.([^\/?#]+))+)(\?[^#]*)?(#.*)?$/,x=n.match(e);if(x!==null){let{[1]:t,[2]:$,[4]:r}=x;n=t}return n}l(C,"getURLbase");function M(n){if(typeof window>"u"||typeof document>"u")return!0;var e=n.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}l(M,"isInViewport");var k=String(import.meta.url),B=U("Y29uc3QgQUxQSEFCRVRJQyA9IGBhbHBoYWJldGljYDsKY29uc3QgQVVUTyA9IGBhdXRvYDsKY29uc3QgQk9UVE9NID0gYGJvdHRvbWA7CmNvbnN0IEJPVFRPTV9MRUZUID0gYGJvdHRvbi1sZWZ0YDsKY29uc3QgQk9UVE9NX1JJR0hUID0gYGJvdHRvbS1yaWdodGA7CmNvbnN0IENFTlRFUiA9IGBjZW50ZXJgOwpjb25zdCBDT05TVFJBSU4gPSB0cnVlOwpjb25zdCBDUk9TUyA9IGBjcm9zc2hhaXJgOwpjb25zdCBFTkQgPSBgZW5kYDsKY29uc3QgSEFORCA9IGBwb2ludGVyYDsKY29uc3QgSEFOR0lORyA9IGBoYW5naW5nYDsKY29uc3QgSURFT0dSQVBISUMgPSBgaWRlb2dyYXBoaWNgOwpjb25zdCBMRUZUID0gYGxlZnRgOwpjb25zdCBNSURETEUgPSBgbWlkZGxlYDsKY29uc3QgUE9JTlRFUiA9IGBkZWZhdWx0YDsKY29uc3QgUklHSFQgPSBgcmlnaHRgOwpjb25zdCBTVEFSVCA9IGBzdGFydGA7CmNvbnN0IFRPUCA9IGB0b3BgOwpjb25zdCBUT1BfTEVGVCA9IGB0b3AtbGVmdGA7CmNvbnN0IFRPUF9SSUdIVCA9IGB0b3AtcmlnaHRgOwoKLy8gImludGVybmFsIiB2YXJzCgpsZXQgX19jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBjYW52YXNgKTsKX19jYW52YXMudGFiSW5kZXggPSAwOwpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBwb2ludGVyZG93bmAsICgpID0+IF9fY2FudmFzLmZvY3VzKCkpOwpsZXQgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwoKbGV0IF9fY3VycmVudF9jdXJzb3I7CmxldCBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19jdXJyZW50X2h1ZTsKbGV0IF9fZHJhd19ncmlkOwpsZXQgX19kcmF3aW5nOwpsZXQgX19lbGVtZW50OwpsZXQgX19maW5pc2hlZF9zZXR1cDsKbGV0IF9fZmlyc3Q7CmxldCBfX2ZvbnQ7CmxldCBfX2dyaWRfY29sb3I7CmxldCBfX2dyaWRfc3BhY2luZzsKbGV0IF9faGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19sYXN0X2ZyYW1lOwpsZXQgX19tb3ZhYmxlX3BvaW50czsKbGV0IF9fcmVkcmF3aW5nOwpsZXQgX19zaGFwZTsKbGV0IF9fc3RhcnRfdGltZTsKbGV0IF9fc3R5bGVfc3RhY2s7CmxldCBfX3RleHRTdHJva2U7Cgpjb25zdCBfX3BybmcgPSBuZXcgKGNsYXNzIHsKICBjb25zdHJ1Y3RvcihzZWVkID0gRGF0ZS5ub3coKSkgewogICAgdGhpcy5hID0gc2VlZDsKICB9CiAgcmVzZWVkKHNlZWQpIHsKICAgIHRoaXMuYSA9IHNlZWQ7CiAgfQogIG5leHQoKSB7CiAgICAvLyBTcGxpdE1peDMyLCBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDc1OTMzMTYvNzQwNTUzCiAgICBsZXQgeyBhIH0gPSB0aGlzOwogICAgYSB8PSAwOwogICAgYSA9IChhICsgMHg5ZTM3NzliOSkgfCAwOwogICAgbGV0IHQgPSBhIF4gKGEgPj4+IDE2KTsKICAgIHQgPSBNYXRoLmltdWwodCwgMHgyMWYwYWFhZCk7CiAgICB0ID0gdCBeICh0ID4+PiAxNSk7CiAgICB0ID0gTWF0aC5pbXVsKHQsIDB4NzM1YTJkOTcpOwogICAgdGhpcy5hID0gYTsKICAgIHJldHVybiAoKHQgPSB0IF4gKHQgPj4+IDE1KSkgPj4+IDApIC8gNDI5NDk2NzI5NjsKICB9Cn0pKCk7Cgphc3luYyBmdW5jdGlvbiByZXNldChlbGVtZW50ID0gX19lbGVtZW50KSB7CiAgX19lbGVtZW50ID0gZWxlbWVudDsKCiAgLy8gZGVmYXVsdCB2YXJpYWJsZSB2YWx1ZXMKICBfX2N1cnJlbnRfY3Vyc29yID0gYGF1dG9gOwogIF9fY3VycmVudF9oaWdobGlnaHRfY29sb3IgPSBgcmdiKDAsMjU0LDEyNClgOwogIF9fY3VycmVudF9odWUgPSAwOwogIF9fZHJhd19ncmlkID0gdHJ1ZTsKICBfX2RyYXdpbmcgPSBmYWxzZTsKICBfX2ZpbmlzaGVkX3NldHVwID0gZmFsc2U7CiAgX19mb250ID0geyBmYW1pbHk6IGBzYW5zLXNlcmlmYCwgc2l6ZTogMTYsIHdlaWdodDogNDAwIH07CiAgX19ncmlkX2NvbG9yID0gYGxpZ2h0Z3JleWA7CiAgX19ncmlkX3NwYWNpbmcgPSAyMDsKICBfX2hpZ2hsaWdodF9jb2xvciA9IGZhbHNlOwogIF9fbW92YWJsZV9wb2ludHMgPSBbXTsKICBfX3JlZHJhd2luZyA9IGZhbHNlOwogIF9fc2hhcGUgPSB1bmRlZmluZWQ7CiAgX19zdGFydF90aW1lID0gRGF0ZS5ub3coKTsKICBfX3N0eWxlX3N0YWNrID0gW107CiAgX190ZXh0U3Ryb2tlID0gYHRyYW5zcGFyZW50YDsKCiAgY3VycmVudE1vdmFibGUgPSBmYWxzZTsKICBwbGF5aW5nID0gZmFsc2U7CiAgZnJhbWUgPSAwOwogIHBvaW50ZXIueCA9IDA7CiAgcG9pbnRlci55ID0gMDsKICBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhrZXlib2FyZCkuZm9yRWFjaCgobikgPT4gZGVsZXRlIGtleWJvYXJkW25dKTsKCiAgLy8gbWFrZSBzdXJlIHdlIGRvbid0IGRvdWJsZS1nZW5lcmF0ZSB0aGVzZToKICBjbGVhclNsaWRlcnMoKTsKICBjbGVhckJ1dHRvbnMoKTsKCiAgLy8gcnVuIHNldHVwCiAgYXdhaXQgX19zZXR1cCgpOwogIF9fZmluaXNoZWRfc2V0dXAgPSB0cnVlOwoKICAvLyBydW4gZmlyc3QgZHJhdwogIF9fbGFzdF9mcmFtZSA9IERhdGUubm93KCk7CiAgYXdhaXQgX19kcmF3KCk7CgogIHJldHVybiB7IHdpZHRoLCBoZWlnaHQgfTsKfQoKZnVuY3Rpb24gaGFsdCgpIHsKICBwbGF5aW5nID0gZmFsc2U7CiAgX19jYW52YXMgPSB1bmRlZmluZWQ7CiAgX19jdHggPSB1bmRlZmluZWQ7CiAgX19maW5pc2hlZF9zZXR1cCA9IGZhbHNlOwogIF9fZHJhd2luZyA9IHRydWU7CiAgX19yZWRyYXdpbmcgPSB0cnVlOwogIF9fZmlyc3QgPSB1bmRlZmluZWQ7CiAgX19tb3ZhYmxlX3BvaW50cyA9IHVuZGVmaW5lZDsKICBfX2N1cnJlbnRfY3Vyc29yID0gdW5kZWZpbmVkOwogIF9fY3VycmVudF9odWUgPSAwOwogIF9fZm9udCA9IHVuZGVmaW5lZDsKICBfX3N0YXJ0X3RpbWUgPSAwOwogIGNsZWFyU2xpZGVycygpOwogIGNsZWFyQnV0dG9ucygpOwp9CgpmdW5jdGlvbiBfX2dldERlc2NyaXB0aW9uKCkgewogIGlmICh0eXBlb2YgZ2V0RGVzY3JpcHRpb24gIT09IGB1bmRlZmluZWRgKSByZXR1cm4gZ2V0RGVzY3JpcHRpb24oKTsKfQoKYXN5bmMgZnVuY3Rpb24gX19zZXR1cCgpIHsKICBpZiAodHlwZW9mIHNldHVwICE9PSBgdW5kZWZpbmVkYCkgYXdhaXQgc2V0dXAoKTsKICBpZiAodHlwZW9mIF9fbW9yZV9zZXR1cCAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IF9fbW9yZV9zZXR1cCgpOwogIGlmICghd2lkdGggJiYgIWhlaWdodCkgc2V0U2l6ZSgpOwp9Cgphc3luYyBmdW5jdGlvbiBfX2RyYXcoKSB7CiAgaWYgKCFfX2ZpbmlzaGVkX3NldHVwKSByZXR1cm47CiAgaWYgKCFfX2RyYXdpbmcpIHsKICAgIF9fZHJhd2luZyA9IHRydWU7CiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogICAgZnJhbWVEZWx0YSA9IG5vdyAtIF9fbGFzdF9mcmFtZTsKICAgIGZyYW1lKys7CiAgICByZXNldFRyYW5zZm9ybSgpOwogICAgaWYgKHR5cGVvZiBkcmF3ICE9PSBgdW5kZWZpbmVkYCkgYXdhaXQgZHJhdygpOwogICAgaWYgKHR5cGVvZiBfX21vcmVfZHJhdyAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IF9fbW9yZV9kcmF3KCk7CiAgICBfX2RyYXdpbmcgPSBmYWxzZTsKICAgIF9fbGFzdF9mcmFtZSA9IG5vdzsKICAgIGlmIChwbGF5aW5nKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gX19kcmF3KCkpOwogIH0KfQovKioKICogVGhlIGN1cnJlbnQgZnJhbWUgbnVtYmVyCiAqCiAqIEBjb25zdGFudCB7bnVtYmVyfQogKi8KbGV0IGZyYW1lID0gMDsKCi8qKgogKiBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZSB0aGUgbGFzdCBmcmFtZS4KICoKICogQGNvbnN0YW50IHtudW1iZXJ9CiAqLwpsZXQgZnJhbWVEZWx0YSA9IDA7CgovKioKICogVGhlIGhlaWdodCBvZiB0aGUgY2FudmFzIGluIHBpeGVscwogKgogKiBAY29uc3RhbnQge251bWJlcn0KICovCmxldCBoZWlnaHQgPSAwOwoKLyoqCiAqIFRoZSB3aWR0aCBvZiB0aGUgY2FudmFzIGluIHBpeGVscwogKgogKiBAY29uc3RhbnQge251bWJlcn0KICovCmxldCB3aWR0aCA9IDA7CgovKioKICogVGhlIGN1cnJlbnQgcGxheSBzdGF0ZQogKgogKiBAY29uc3RhbnQge2Jvb2xlYW59CiAqLwpsZXQgcGxheWluZyA9IGZhbHNlOwoKLyoqCiAqIFRoZSBgcG9pbnRlcmAgb2JqZWN0IHJlcHJlc2VudHMgdGhlIG1vdXNlIGN1cnNvciAod2hlbiB1c2luZwogKiBhIG1vdXNlKSBvciBmaW5nZXIgcG9zaXRpb24gKGZvciB0b3VjaCBkZXZpY2VzKSwgYW5kIG1vZGVscwogKiBzZXZlcmFsIGFzcGVjdHM6CiAqCiAqIC0gYGFjdGl2ZWAgKGJvb2xlYW4pIFdoZXRoZXIgdGhlIHBvaW50ZXIgaXMgZXZlbiBvbiBvciBvdmVyIHRoZSBjYW52YXMuCiAqIC0gYHhgIChudW1iZXIpIFRoZSBwb2ludGVyJ3MgeCBvZmZzZXQgaW4gcGl4ZWxzIHdpdGggcmVzcGVjdCB0byB0aGUgY2FudmFzCiAqIC0gYHlgIChudW1iZXIpIFRoZSBwb2ludGVyJ3MgeSBvZmZzZXQgaW4gcGl4ZWxzIHdpdGggcmVzcGVjdCB0byB0aGUgY2FudmFzCiAqIC0gYGRvd25gIChib29sZWFuKSBXaGV0aGVyIHRoZSBwb2ludGVyIGlzICJlbmdhZ2VkIiBvciBub3QKICogLSBgZHJhZ2AgKGJvb2xlYW4pIFdoZXRoZXIgYSBjbGljay90b3VjaC1kcmFnIGlzIGluIHByb2dyZXNzCiAqIC0gYG1hcmtgICh7eCx5fSkgV2hlbiBkcmFnZ2luZywgdGhpcyByZXByZXNlbnRzIHRoZSBvcmlnaW5hbCBjb29yZGluYXRlIG9mIHRoZSBwb2ludGVyICJkb3duIiBldmVudAogKgogKiBAY29uc3RhbnQge29iamVjdH0KICovCmNvbnN0IHBvaW50ZXIgPSB7IHg6IDAsIHk6IDAgfTsKCi8qKgogKiBJZiBhbnkgcG9pbnRzIHdlcmUgcmVnaXN0ZXJlZCBhcyBtb3ZhYmxlLCBhbmQgdGhlIHBvaW50ZXIgaXMKICogbmVhciBlbm91Z2ggdG8gYSBtb3ZhYmxlIHBvaW50LCB0aGlzIHZhbHVlIHdpbGwgcG9pbnQgdG8KICogdGhhdCBtb3ZhYmxlIHBvaW50LCBvciBgZmFsc2VgIGlmIHRoZSBwb2ludGVyIGlzIG5vdCBuZWFyCiAqIGFueSBtb3ZhYmxlIHBvaW50IChvciwgb2YgY291cnNlLCB0aGVyZSBhcmUgbm8gbW92YWJsZSBwb2ludHMpCiAqCiAqIEBjb25zdGFudCB7UG9pbnRMaWtlfGZhbHNlfQogKi8KbGV0IGN1cnJlbnRNb3ZhYmxlID0gZmFsc2U7CgovKioKICogVGhlIGBrZXlib2FyZGAgb2JqZWN0IGlzIGEgdHJ1dGggdGFibGUgdGhhdCBjYW4gYmUgY2hlY2tlZCB0bwogKiBzZWUgaWYgYW55IGtleSBpcyBjdXJyZW50bHkgcHJlc3NlZCwgYW5kIGlmIHNvLCB3aGVuIHRoYXQKICoga2V5cHJlc3Mgd2FzIGluaXRpYXRlZCwgYnkgc3RvcmluZzoKICoKICogYGBgCiAqIHsKICogICBba2V5OnN0cmluZ106IGRhdGV0aW1lCiAqIH0KICogYGBgCiAqCiAqIFdoZW4gYSBrZXkgaXMgcmVsZWFzZWQsIGl0cyBtYXBwaW5nIGlzIHJlbW92ZWQgZW50aXJlbHksCiAqIHJhdGhlciB0aGFuIGl0IGJlaW5nIHNldCB0byBhIGZhbHNleSB2YWx1ZS4KICoKICogQGNvbnN0YW50IHtvYmplY3R9CiAqLwpjb25zdCBrZXlib2FyZCA9IHt9OwoKLy8gY29uc3RhbnRzLi4uCmNvbnN0IHsKICAvKioKICAgKiBUaGUgcmF0aW8gb2YgYSBjaXJjbGUncyBjaXJjdW1mZXJlbmNlIHRvIGl0cyBkaWFtZXRlci4KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9QaQogICAqCiAgICogQGNvbnN0YW50IHtudW1iZXJ9CiAgICoKICAgKiBAc2VlIHtAbGluayBUQVV9CiAgICovCiAgUEksCgogIC8qKgogICAqIFRoZSBiYXNlIGZvciB0aGUgbmF0dXJhbCBsb2dhcml0aG0uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRV8obWF0aGVtYXRpY2FsX2NvbnN0YW50KQogICAqCiAgICogQGNvbnN0YW50IHtudW1iZXJ9CiAgICovCiAgRSwKfSA9IE1hdGg7Cgpjb25zdCB7CiAgLyoqCiAgICogQSB2ZXJ5IHNtYWxsIHZhbHVlIGZvciBwZXJmb3JtaW5nIGltcHJlY2lzZSBtYXRoIG9wZXJhdGlvbnMKICAgKiBzdWNoIGFzIGNoZWNraW5nIHdoZXRoZXIgYSB2YWx1ZSBpcyBhcHByb3hpbWF0ZWx5IHRoZSBzYW1lCiAgICogYXMgc29tZSBvdGhlciB2YWx1ZS4KICAgKgogICAqIEBjb25zdGFudCB7bnVtYmVyfQogICAqLwogIGVwc2lsb24sCgogIC8qKgogICAqIEEgdmVyeSBsYXJnZSB2YWx1ZSB0aGF0IGNhbiBzdGlsbCBiZSB1c2VkIHRvIGRyYXcgdGhpbmdzCiAgICogb24gdGhlIGNhbnZhcyAoc3VjaCBhcyBsaW5lcyBmcm9tIC1odWdlIHRvICtodWdlKS4KICAgKgogICAqIEBjb25zdGFudCB7bnVtYmVyfQogICAqLwogIGh1Z2UsCgogIC8qKgogICAqIFRoZSByYXRpbyBvZiBhIGNpcmNsZSdzIGNpcmN1bWZlcmVuY2UgdG8gaXRzIHJhZGl1cywgaS5lLiAyKlBJCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVHVybl8oYW5nbGUpI1RhdV9wcm9wb3NhbHMKICAgKgogICAqIEBjb25zdGFudCB7bnVtYmVyfQogICAqCiAgICogQHNlZSB7QGxpbmsgUEl9CiAgICovCiAgVEFVLAp9ID0geyBlcHNpbG9uOiAxZS0xMCwgaHVnZTogMV8wMDBfMDAwLCBUQVU6IFBJICogMiB9OwovKioKICogRW5zdXJlIHRoYXQgdGhlcmUgaXMgbm8gYm9yZGVyIGFyb3VuZCB0aGUgY2FudmFzIGVsZW1lbnQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEJvcmRlcig1LCBgcmVkYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgdGV4dChgY2xpY2sgbWVgLCB3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyVXAoeCwgeSkgewogKiAgICAgICBzZXRCb3JkZXIoNSwgYHJlZGApOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCwgeSkgewogKiAgICAgICBub0JvcmRlcigpOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldEJvcmRlcn0KICovCmZ1bmN0aW9uIG5vQm9yZGVyKCkgewogIHNldEJvcmRlcihmYWxzZSk7Cn0KCi8qKgogKiBEaXNhYmxlIGJvdGggc3Ryb2tlIGFuZCBmaWxsIGNvbG9yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoYE5vdyB5b3Ugc2VlIG1lYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vQ29sb3IoKTsKICogICAgICAgdGV4dChgTm93IHlvdSBkb24ndGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldENvbG9yfQogKiBAc2VlIHtAbGluayBub1N0cm9rZX0KICogQHNlZSB7QGxpbmsgbm9GaWxsfQogKi8KZnVuY3Rpb24gbm9Db2xvcigpIHsKICBub0ZpbGwoKTsKICBub1N0cm9rZSgpOwp9CgovKioKICogSGlkZSB0aGUgY3Vyc29yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGAjRkYwMmApOwogKiAgICAgICByZWN0KDAsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIHNldENvbG9yKGAjMEZGMmApOwogKiAgICAgICByZWN0KHdpZHRoLzIsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSh4LCB5KSB7CiAqICAgICAgIGlmICh4IDwgd2lkdGgvMikgewogKiAgICAgICAgIHNldEN1cnNvcihBVVRPKTsKICogICAgICAgfSBlbHNlIHsKICogICAgICAgICBub0N1cnNvcigpOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2V0Q3Vyc29yfQogKi8KZnVuY3Rpb24gbm9DdXJzb3IoKSB7CiAgX19jYW52YXMuc3R5bGUuY3Vyc29yID0gYG5vbmVgOwp9CgovKioKICogRGlzYWJsZSB0aGUgZmlsbCBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICByZWN0KDIwLCA3MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgZmlsbGVkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICByZWN0KDMwLCA4MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgbm90IGZpbGxlZGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldEZpbGx9CiAqLwpmdW5jdGlvbiBub0ZpbGwoKSB7CiAgc2V0RmlsbChgdHJhbnNwYXJlbnRgKTsKfQoKLyoqCiAqIERpc2FibGUgdGhlIGRlZmF1bHQgZ3JpZCBiYWNrZ3JvdW5kLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoYGNsaWNrIG1lYCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlclVwKHgsIHkpIHsKICogICAgICAgc2V0R3JpZCgyMCwgYGxpZ2h0Z3JleWApOwogKiAgICAgICByZWRyYXcoKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCwgeSkgewogKiAgICAgICBub0dyaWQoKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRHcmlkfQogKi8KZnVuY3Rpb24gbm9HcmlkKCkgewogIF9fZHJhd19ncmlkID0gZmFsc2U7Cn0KCi8qKgogKiBTZXQgdGhlIGxpbmUgc3Ryb2tlIHRvICJzb2xpZCIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldExpbmVEYXNoKDEpOwogKiAgICAgICBsaW5lKDAsMjAsd2lkdGgsNTApOwogKiAgICAgICBzZXRMaW5lRGFzaCg1KTsKICogICAgICAgbGluZSgwLDMwLHdpZHRoLDkwKTsKICogICAgICAgc2V0TGluZURhc2goMSwyLDMsNCk7CiAqICAgICAgIGxpbmUoMCw0MCx3aWR0aCwxMzApOwogKiAgICAgICBub0xpbmVEYXNoKCk7CiAqICAgICAgIGxpbmUoMCw1MCx3aWR0aCwxODApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldExpbmVEYXNofQogKi8KCmZ1bmN0aW9uIG5vTGluZURhc2goKSB7CiAgX19jdHguc2V0TGluZURhc2goW10pOwp9CgovKioKICogRGlzYWJsZSB0aGUgc3Ryb2tlIGNvbG9yLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dFN0cm9rZSgxKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHJlY3QoMjAsIDcwLCAyMCwgMjApOwogKiAgICAgICB0ZXh0KGBzdHJva2VkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgLSAyNSk7CiAqICAgICAgIG5vU3Ryb2tlKCk7CiAqICAgICAgIHJlY3QoNDIsIDgyLCAyMCwgMjApOwogKiAgICAgICB0ZXh0KGBub3Qgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldFN0cm9rZX0KICovCgpmdW5jdGlvbiBub1N0cm9rZSgpIHsKICBzZXRTdHJva2UoYHRyYW5zcGFyZW50YCk7Cn0KCi8qKgogKiBEaXNhYmxlIHRleHQgc3Ryb2tpbmcsIGJ1dCBub3QgcmVndWxhciBzaGFwZSBzdHJva2luZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICByZWN0KDIwLCA3MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub1RleHRTdHJva2UoKTsKICogICAgICAgcmVjdCg0MiwgODIsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYG5vdCBzdHJva2VkYCwgd2lkdGgvMiwgaGVpZ2h0LzIgKyAyNSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2V0VGV4dFN0cm9rZX0KICovCgpmdW5jdGlvbiBub1RleHRTdHJva2UoKSB7CiAgc2V0VGV4dFN0cm9rZShmYWxzZSwgdW5kZWZpbmVkKTsKfQovKioKICogQWRkIGEgc2xpZGVyIHRvIHlvdXIgZmlndXJlLCBhbGxvd2luZyB1c2VycyB0byBjb250cm9sCiAqIGEgdmFyaWFibGUgaW4geW91ciBncmFwaGljcyBjb2RlIGRpcmVjdGx5IGJ5IGludGVyYWN0aW5nCiAqIHdpdGggdGhhdCBvbi1wYWdlIHNsaWRlciwgd2hpY2ggaXMgZXNwZWNpYWxseSBpbXBvcnRhbnQgaWYKICogeW91IHdhbnQgeW91ciBncmFwaGljcyB0byBiZSB1c2VhYmxlIGJ5IHVzZXJzIHdobyBkb24ndAogKiBoYXZlLCBvciBjYW5ub3QgdXNlLCBhIG1vdXNlLgogKgogKiBUaGUgYHByb3BMYWJlbGAgdmFsdWUgc2hvdWxkIGJlIHRoZSBuYW1lIG9mIHRoZSB2YXJpYWJsZQogKiB0aGF0IHlvdXIgZ3JhcGhpY3MgY29kZSB1c2VzLCBhbmQgc2hvdWxkIF9ub3RfIGJlICJwcmVhbGxvY2F0ZWQiCiAqIGluIHlvdXIgY29kZSB3aXRoIGEgY29uc3QsIGxldCwgb3IgdmFyOiBpdCB3aWxsIGF1dG9tYXRpY2FsbHkKICogZ2V0IGFkZGVkIGFzIHBhcnQgb2YgdGhlIHNvdXJjZSBsb2FkaW5nIHByb2Nlc3MuCiAqCiAqIFRoZSBvcHRpb25zIG9iamVjdCBhY2NlcHRzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllcyBhbmQgdmFsdWVzOgogKgogKiAtIG1pbiAtIHRoZSBzbGlkZXIncyBtaW5pbXVtIHZhbHVlLCBkZWZhdWx0cyB0byAwCiAqIC0gbWF4IC0gdGhlIHNsaWRlcidzIG1heGltdW0gdmFsdWUsIGRlZmF1bHRzIHRvIDEKICogLSBzdGVwIC0gdGhlIHN0ZXAgc2l6ZSwgZGVmYXVsdHMgdG8gKG1heCAtIG1pbikvMTAKICogLSB2YWx1ZSAtIHRoZSBpbml0aWFsIHZhbHVlLCBkZWZhdWx0cyB0byAobWF4ICsgbWluKS8yCiAqIC0gY2xhc3NlcyAtIHRoZSBDU1MgY2xhc3NlcyB0aGF0IHdpbGwgYmUgdXNlZCwgZGVmYXVsdHMgdG8gYCJzbGlkZXIiYAogKiAtIHRyYW5zZm9ybSAtIGEgdmFsdWUgcHJlcHJvY2Vzc29yICBkZWZhdWx0cyB0byAodikgPT4gdgogKgogKiBUaGUgYHRyYW5zZm9ybWAgcHJlLXByb2Nlc3NvciBydW5zIGFmdGVyIHRoZSB1c2VyIHVwZGF0ZXMKICogdGhlIHNsaWRlciwgYnV0IGJlZm9yZSBpdHMgdmFsdWUgZ2V0cyBhc3NpZ25lZCB0byB5b3VyIHZhcmlhYmxlLAogKiBzbyB0aGF0IHlvdSBjYW4gbWFwIGl0IHRvIHNvbWV0aGluZyBlbHNlIChmb3IgaW5zdGFuY2UsIG51bWJlcnMKICogaW4gb25lIHJhbmdlIHRvIG51bWJlcnMgaW4gYSBjb21wbGV0ZWx5IGRpZmZlcmVudCByYW5nZSwgb3IgZXZlbgogKiBudW1iZXJzIHRvIHN0cmluZ3Mgb3IgZW50aXJlIG9iamVjdHMpCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSg0MDAsIDIwMCk7CiAqICAgICAgIGFkZFNsaWRlcihgYmdDb2xvcmAsIHsKICogICAgICAgICBtaW46IDAsCiAqICAgICAgICAgbWF4OiAyNTUsCiAqICAgICAgICAgc3RlcDogMSwKICogICAgICAgICB2YWx1ZTogMjAwLAogKiAgICAgICAgIHRyYW5zZm9ybTogKHYpID0+IHsKICogICAgICAgICAgIC8vIGNvbnZlcnQgdiBpbnRvIGEgaGV4IGNvbG9yIGNvZGUKICogICAgICAgICAgIHYgPSAodikudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsIGAwYCk7CiAqICAgICAgICAgICByZXR1cm4gYCMke3Z9JHt2fSR7dn1gOwogKiAgICAgICAgIH0KICogICAgICAgfSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihiZ0NvbG9yKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gdmFyTmFtZSBUaGUgbmFtZSBmb3IgdGhlIHZhcmlhYmxlIHRoaXMgc2xpZGVyIGdldHMgdGllZCB0by4KICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgU2VlIGRlc2NyaXB0aW9uCiAqIEByZXR1cm5zIHtIVE1MSW5wdXRFbGVtZW50fSB0aGUgSFRNTCBpbnB1dCBlbGVtZW50IGZvciB0aGlzIHNsaWRlcgogKgogKiBAc2VlIHtAbGluayBjbGVhclNsaWRlcnN9CiAqLwpmdW5jdGlvbiBhZGRTbGlkZXIocHJvcExhYmVsLCBhc3NpZ24sIG9wdGlvbnMgPSB7fSkgewogIGxldCB7CiAgICBtaW4sCiAgICBtYXgsCiAgICBzdGVwLAogICAgdmFsdWUsCiAgICBjbGFzc2VzID0gYHNsaWRlcmAsCiAgICB0cmFuc2Zvcm0gPSAodikgPT4gdiwKICB9ID0gb3B0aW9uczsKCiAgbWluID0gbWluID09PSB1bmRlZmluZWQgPyAwIDogbWluOwogIG1heCA9IG1heCA9PT0gdW5kZWZpbmVkID8gMSA6IG1heDsKICBzdGVwID0gc3RlcCA9PT0gdW5kZWZpbmVkID8gKG1heCAtIG1pbikgLyAxMCA6IHN0ZXA7CiAgdmFsdWUgPSB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gKG1heCArIG1pbikgLyAyIDogdmFsdWU7CgogIC8vIGN1c3RvbSAicm91bmRpbmciLCBwdXJlbHkgZm9yIHN0cmluZ3MKICBjb25zdCByb3VuZCA9ICh2LCBkID0gNCkgPT4gewogICAgdiA9IGAke3Z9YDsKICAgIGNvbnN0IGZzID0gdi5pbmRleE9mKGAuYCk7CiAgICBpZiAoZnMgIT09IC0xKSB7CiAgICAgIGxldCBwcmVjID0gZCAtIGZzID4gMCA/IGQgLSBmcyA6IDA7CiAgICAgIHYgPSB2LnN1YnN0cmluZygwLCBmcyArIHByZWMpOwogICAgfQogICAgcmV0dXJuIHY7CiAgfTsKCiAgY29uc3QgY3JlYXRlID0gKHRhZykgPT4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOwoKICBsZXQgc2xpZGVyID0gY3JlYXRlKGBpbnB1dGApOwogIHNsaWRlci50eXBlID0gYHJhbmdlYDsKICBzbGlkZXIubWluID0gbWluOwogIHNsaWRlci5tYXggPSBtYXg7CiAgc2xpZGVyLnN0ZXAgPSBzdGVwOwogIHNsaWRlci5zZXRBdHRyaWJ1dGUoYHZhbHVlYCwgdmFsdWUpOwogIHNsaWRlci5zZXRBdHRyaWJ1dGUoYGNsYXNzYCwgY2xhc3Nlcyk7CgogIGNvbnN0IHVwZGF0ZSA9ICh7IHZhbHVlIH0pID0+IHsKICAgIHZhbHVlRmllbGQudGV4dENvbnRlbnQgPSByb3VuZCh2YWx1ZSk7CiAgICBhc3NpZ24odHJhbnNmb3JtKHBhcnNlRmxvYXQodmFsdWUpKSk7CiAgICBpZiAoIXBsYXlpbmcpIHJlZHJhdygpOwogIH07CgogIHNsaWRlci5hZGRFdmVudExpc3RlbmVyKGBpbnB1dGAsICh7IHRhcmdldCB9KSA9PiB1cGRhdGUodGFyZ2V0KSk7CgogIGxldCB0YWJsZSA9IF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKGB0YWJsZS5zbGlkZXItd3JhcHBlcmApOwogIGlmICghdGFibGUpIHsKICAgIHRhYmxlID0gY3JlYXRlKGB0YWJsZWApOwogICAgdGFibGUuY2xhc3NMaXN0LmFkZChgc2xpZGVyLXdyYXBwZXJgKTsKICAgIF9fZWxlbWVudC5wcmVwZW5kKHRhYmxlKTsKICB9CiAgbGV0IHRyID0gY3JlYXRlKGB0cmApOwoKICBsZXQgdGQgPSBjcmVhdGUoYHRkYCk7CiAgbGV0IGxhYmVsID0gY3JlYXRlKGBsYWJlbGApOwogIGxhYmVsLmNsYXNzTGlzdC5hZGQoYHNsaWRlci1sYWJlbGApOwogIGxhYmVsLmlubmVySFRNTCA9IHByb3BMYWJlbAogICAgLnJlcGxhY2UoL18oLispJC8sIGA8c3ViPiQxPC9zdWI+YCkKICAgIC5yZXBsYWNlKC8oXGQrKS8sIGA8c3ViPiQxPC9zdWI+YCk7CiAgdGQuYXBwZW5kKGxhYmVsKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbWluYCk7CiAgdGQudGV4dENvbnRlbnQgPSByb3VuZChzbGlkZXIubWluKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC53aWR0aCA9IGAqYDsKICB0ZC5hcHBlbmQoc2xpZGVyKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbWF4YCk7CiAgdGQudGV4dENvbnRlbnQgPSByb3VuZChzbGlkZXIubWF4KTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB2YXIgdmFsdWVGaWVsZCA9IGNyZWF0ZShgbGFiZWxgKTsgLy8gZnVuY3Rpb24gc2NvcGVkCiAgdmFsdWVGaWVsZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItdmFsdWVgKTsKICB0ZC5hcHBlbmQodmFsdWVGaWVsZCk7CiAgdHIuYXBwZW5kKHRkKTsKICB0ZC5hZGRFdmVudExpc3RlbmVyKGBwb2ludGVyZG93bmAsICgpID0+IHsKICAgIGNvbnN0IHZhbHVlID0gcHJvbXB0KGBuZXcgdmFsdWU/YCwgc2xpZGVyLnZhbHVlKTsKICAgIGlmICh2YWx1ZSAhPT0gbnVsbCkgewogICAgICBzbGlkZXIudmFsdWUgPSB2YWx1ZTsKICAgICAgdXBkYXRlKHsgdmFsdWUgfSk7CiAgICB9CiAgfSk7CgogIHRhYmxlLmFwcGVuZCh0cik7CgogIHVwZGF0ZShzbGlkZXIpOwogIHJldHVybiBzbGlkZXI7Cn0KCi8qKgogKiBSZW1vdmUgYWxsIHNsaWRlcnMgZm9yIHlvdXIgZmlndXJlIGZyb20gdGhlIHBhZ2UuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGFkZFNsaWRlcihgeGApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHRleHQoYGNsaWNrIHRvIGNsZWFyYCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oKSB7CiAqICAgICAgIGNsZWFyU2xpZGVycygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIGFkZFNsaWRlcn0KICovCgpmdW5jdGlvbiBjbGVhclNsaWRlcnMoKSB7CiAgY29uc3QgdGFibGUgPSBfX2VsZW1lbnQucXVlcnlTZWxlY3RvcihgdGFibGUuc2xpZGVyLXdyYXBwZXJgKTsKICBpZiAodGFibGUpIHRhYmxlLmlubmVySFRNTCA9IGBgOwp9CgovKioKICogQWRkIGEgYnV0dG9uIGJlbG93IHlvdXIgZmlndXJlIHRoYXQgY2FuIHRyaWdnZXIgZXZlbnQtYmFzZWQKICogY29kZSwgd2hpY2ggaXMgZXNwZWNpYWxseSBpbXBvcnRhbnQgaWYgeW91IHdhbnQgeW91ciBncmFwaGljcwogKiB0byBiZSB1c2VhYmxlIGJ5IHVzZXJzIHdobyBkb24ndCBoYXZlLCBvciBjYW5ub3QgdXNlLCBhIG1vdXNlLgogKgogKiBvbkNsaWNrIGlzIHNpbWlsYXIgdG8gdGhlIHN0YW5kYXJkIEpTIGV2ZW50IGhhbmRsZXIsIGV4Y2VwdAogKiB0aGF0IHRoZSBjYWxsIGFyZ3VtZW50IGlzIGEgcmVmZXJlbmNlIHRvIHlvdXIgYnV0dG9uLCBub3QKICogdGhlIGNsaWNrIGV2ZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgY29sb3JzID0gW2B3aGl0ZWAsIGBibGFja2BdOwogKiAgICAgbGV0IGJnQ29sb3IgPSAwOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRCdXR0b24oYGZsaXAgYmFja2dyb3VuZGAsIChidXR0b24pID0+IHsKICogICAgICAgICBiZ0NvbG9yID0gLShiZ0NvbG9yIC0gMSk7CiAqICAgICAgICAgcmVkcmF3KCk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoY29sb3JzW2JnQ29sb3JdKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gbGFiZWwgVGhlIHRleHQgbGFiZWwgZm9yIHlvdXIgYnV0dG9uCiAqIEBwYXJhbSB7RnVuY3Rpb259IG9uQ2xpY2sgVGhlIGNsaWNrIGhhbmRsaW5nIGZ1bmN0aW9uLCBzZWUgZGVzY3JpcHRpb24uCiAqIEByZXR1cm5zIHtIVE1MQnV0dG9uRWxlbWVudH0gVGhlIGJ1dHRvbiBlbGVtZW50IHRoaXMgYWRkZWQgdG8gdGhlIHBhZ2UKICoKICogQHNlZSB7QGxpbmsgY2xlYXJCdXR0b25zfQogKi8KZnVuY3Rpb24gYWRkQnV0dG9uKGxhYmVsLCBvbkNsaWNrKSB7CiAgaWYgKCFvbkNsaWNrKSB0aHJvdyBuZXcgRXJyb3IoYGEgYnV0dG9uIG11c3QgaGF2ZSBhbiBvbkNsaWNrIGhhbmRsZXJgKTsKICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBidXR0b25gKTsKICBidG4uY2xhc3NMaXN0LmFkZChgZ3JhcGhpY3MtZWxlbWVudC1idXR0b25gKTsKICBidG4udGV4dENvbnRlbnQgPSBsYWJlbDsKICBidG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCAoKSA9PiBvbkNsaWNrKGJ0bikpOwogIF9fZWxlbWVudC5wcmVwZW5kKGJ0bik7CiAgcmV0dXJuIGJ0bjsKfQoKLyoqCiAqIFJlbW92ZSBhbGwgYnV0dG9ucyBmb3IgeW91ciBmaWd1cmUgZnJvbSB0aGUgcGFnZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGB0aGlzIGRvZXMgbm90aGluZ2AsICgpID0+IHt9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KGBjbGljayB0byBjbGVhcmAsIHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKCkgewogKiAgICAgICBjbGVhckJ1dHRvbnMoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBhZGRCdXR0b259CiAqLwpmdW5jdGlvbiBjbGVhckJ1dHRvbnMoKSB7CiAgX19lbGVtZW50CiAgICAucXVlcnlTZWxlY3RvckFsbChgYnV0dG9uLmdyYXBoaWNzLWVsZW1lbnQtYnV0dG9uYCkKICAgIC5mb3JFYWNoKChlKSA9PiBlLnJlbW92ZSgpKTsKfQovKioKICogRHJhdyBhIGNpcmN1bGFyIGFyYyB3aXRoIHJhZGl1cyBgcmAgYXQgKHgseSksCiAqIHN0YXJ0aW5nIGF0IGFuZ2xlIGBzYCBhbmQgZW5kaW5nIGF0IGFuZ2xlIGBlYC4KICogSWYgYHdlZGdlYCBpcyB0cnVlLCB0aGlzIHdpbGwgZHJhdyBhIGNsb3NlZAogKiBzaGFwZSB0aGF0IGlzIGFuY2hvcmVkIGF0ICh4LHkpLiBJZiBvbWl0dGVkCiAqIG9yIGV4cGxpY2l0bHkgc2V0IHRvIGZhbHNlLCB0aGlzIHdpbGwgZHJhdwogKiBhbiBvcGVuIHNoYXBlIHdpdGggYSBmaWxsIHRoYXQgY29ubmVjdHMgdGhlCiAqIGZpcnN0IGFuZCBsYXN0IHBvaW50IG9uIHRoZSBhcmMsIGJ1dCBubyBjbG9zaW5nCiAqIHN0cm9rZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYCNGMDAyYCk7CiAqICAgICAgIGFyYyh3aWR0aC8yICsgMzAsIGhlaWdodC8yIC0gNDAsIDQwLCAwLCAwLjY2KlRBVSk7CiAqICAgICAgIGFyYyh3aWR0aC8yIC0gMzAsIGhlaWdodC8yICsgMjAsIDQwLCAwLCAwLjY2KlRBVSwgdHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGNpcmN1bGFyIGNlbnRlciB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBjaXJjdWxhciBjZW50ZXIgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhpcyBhcmMgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydEFuZ2xlIFRoZSBzdGFydCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0gZW5kQW5nbGUgVGhlIGVuZCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge2Jvb2xlYW59IGRyYXdXZWRnZSBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRvIGRyYXcgYSB3ZWRnZSBvciBjYXBwZWQgY2lyY2xlIChkZWZhdWx0PWNpcmNsZSkKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHBvaW50IFRoZSBjaXJjdWxhciBjZW50ZXIge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhpcyBhcmMgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydEFuZ2xlIFRoZSBzdGFydCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0gZW5kQW5nbGUgVGhlIGVuZCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge2Jvb2xlYW59IGRyYXdXZWRnZSBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRvIGRyYXcgYSB3ZWRnZSBvciBjYXBwZWQgY2lyY2xlIChkZWZhdWx0PWNpcmNsZSkKICoKICogQHNlZSB7QGxpbmsgY2lyY2xlfQogKi8KZnVuY3Rpb24gYXJjKHgsIHksIHIsIHMgPSAwLCBlID0gVEFVLCB3ZWRnZSA9IGZhbHNlKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB3ZWRnZSA9IGU7CiAgICBlID0gczsKICAgIHMgPSByOwogICAgciA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgY29uc3Qgc3RlcCA9IDAuMTsKICBzdGFydCgpOwogIGlmICh3ZWRnZSkgdmVydGV4KHgsIHkpOwogIGxldCBhID0gczsKICB2ZXJ0ZXgoeCArIHIgKiBjb3MocyksIHkgKyByICogc2luKHMpKTsKICBmb3IgKGEgPSBzICsgc3RlcDsgYSA8IGU7IGEgKz0gc3RlcCkgewogICAgdmVydGV4KHggKyByICogY29zKGEpLCB5ICsgciAqIHNpbihhKSk7CiAgfQogIHZlcnRleCh4ICsgciAqIGNvcyhlKSwgeSArIHIgKiBzaW4oZSkpOwogIGlmICh3ZWRnZSkgdmVydGV4KHgsIHkpOwogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIHBhaXIgb2YgaG9yaXpvbnRhbCBhbmQgdmVydGljYWwgYXhlcy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Qm9yZGVyKDEsIGBibGFja2ApOwogKiAgICAgICBzZXRHcmlkKDUwLCBgbGlnaHRncmV5YCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBzZXRDdXJzb3IoYG5vbmVgKTsKICogICAgICAgY2xlYXIoYCNmZmZlZjdgKTsKICogICAgICAgc2V0Q29sb3IoYCMzMzNgKTsKICogICAgICAgdHJhbnNsYXRlKDI1LDI1KTsKICogICAgICAgYXhlcygKICogICAgICAgICBgdGltZSAocylgLCAwLCB3aWR0aC01MCwKICogICAgICAgICBgZGlzdGFuY2UgKGttKWAsIDAsIGhlaWdodC01MCwKICogICAgICAgICAiMCIsICI2MCIsCiAqICAgICAgICAgIjAiLCAiNTAwIik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGhMYWJlbCB0aGUgaG9yaXpvbnRhbCBheGlzIGxhYmVsCiAqIEBwYXJhbSB7bnVtYmVyfSBocyB0aGUgc3RhcnQgKGxlZnQpIHBpeGVsIHZhbHVlIGZvciB0aGUgaG9yaXpvbnRhbCBheGlzCiAqIEBwYXJhbSB7bnVtYmVyfSBoZSB0aGUgZW5kIChyaWdodCkgcGl4ZWwgdmFsdWUgZm9yIHRoZSBob3Jpem9udGFsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IHZMYWJlbCB0aGUgdmVydGljYWwgYXhpcyBsYWJlbAogKiBAcGFyYW0ge251bWJlcn0gdnMgdGhlIHN0YXJ0ICh0b3ApIHBpeGVsIHZhbHVlIGZvciB0aGUgdmVydGljYWwgYXhpcwogKiBAcGFyYW0ge251bWJlcn0gdmUgdGhlIGVuZCAoYm90dG9tKSBwaXhlbCB2YWx1ZSBmb3IgdGhlIHZlcnRpY2FsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IGhzTGFiZWw/IGFuIG9wdGlvbmFsIGxhYmVsIGZvciB0aGUgc3RhcnQgKGxlZnQpIG9mIHRoZSBob3Jpem9udGFsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IGhlTGFiZWw/IGFuIG9wdGlvbmFsIGxhYmVsIGZvciB0aGUgZW5kIChyaWdodCkgb2YgdGhlIGhvcml6b250YWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gdnNMYWJlbD8gYW4gb3B0aW9uYWwgbGFiZWwgZm9yIHRoZSBzdGFydCAodG9wKSBvZiB0aGUgdmVydGljYWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gdmVMYWJlbD8gYW4gb3B0aW9uYWwgbGFiZWwgZm9yIHRoZSBlbmQgKGJvdHRvbSkgb2YgdGhlIHZlcnRpY2FsIGF4aXMKICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiBheGVzKAogIGhMYWJlbCwKICBocywKICBoZSwKICB2TGFiZWwsCiAgdnMsCiAgdmUsCiAgaHNMYWJlbCA9IGZhbHNlLAogIGhlTGFiZWwgPSBmYWxzZSwKICB2c0xhYmVsID0gZmFsc2UsCiAgdmVMYWJlbCA9IGZhbHNlCikgewogIGxpbmUoaHMsIDAsIGhlLCAwKTsKICBsaW5lKDAsIHZzLCAwLCB2ZSk7CgogIGNvbnN0IGhwb3MgPSAwIC0gNTsKICB0ZXh0KGAke2hMYWJlbH0g4oaSYCwgd2lkdGggLyAyICsgNSwgaHBvcywgUklHSFQpOwogIHRleHQoaHNMYWJlbCA/IGhzTGFiZWwgOiBocywgaHMsIGhwb3MsIFJJR0hUKTsKICB0ZXh0KGhlTGFiZWwgPyBoZUxhYmVsIDogaGUsIGhlLCBocG9zLCBSSUdIVCk7CgogIGNvbnN0IHZwb3MgPSAtNTsKICBzYXZlKCk7CiAgdHJhbnNsYXRlKHZwb3MsIGhlaWdodCAvIDIpOwogIHJvdGF0ZSgtUEkgLyAyKTsKICB0ZXh0KGAke3ZMYWJlbH1gLCAwLCAwLCBMRUZUKTsKICByZXN0b3JlKCk7CiAgdGV4dChg4oaTYCwgdnBvcywgaGVpZ2h0IC8gMiArIDE2LCBSSUdIVCk7CiAgdGV4dCh2c0xhYmVsID8gdnNMYWJlbCA6IHZzLCB2cG9zLCB2cyArIDUsIFJJR0hUKTsKICB0ZXh0KHZlTGFiZWwgPyB2ZUxhYmVsIDogdmUsIHZwb3MsIHZlLCBSSUdIVCk7Cn0KCi8qKgogKiBEcmF3IG9uZSBvciBtb3JlIEJlemllciBjdXJ2ZXMgZnJvbSBhbiBhcnJheQogKiBvZiBQb2ludCBvciBQb2ludC1saWtlcyB0aGF0IGltcGxlbWVudDoKICoKICogYGBgCiAqIHsKICogICB4OiBudW1iZXIKICogICB5OiBudW1iZXIKICogfQogKiBgYGAKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYCNGMDAyYCk7CiAqICAgICAgIGJlemllcigKICogICAgICAgICBuZXcgUG9pbnQoMjAsIGhlaWdodCAtIDU1KSwKICogICAgICAgICBuZXcgUG9pbnQoMjAsIDI1KSwKICogICAgICAgICB7IHg6IHdpZHRoIC0gMjAsIHk6IDI1fSwKICogICAgICAgICB7IHg6IHdpZHRoIC0gMjAsIHk6IGhlaWdodCAtIDU1fQogKiAgICAgICApOwogKiAgICAgICBub0ZpbGwoKQogKiAgICAgICBiZXppZXIoCiAqICAgICAgICAgbmV3IFBvaW50KDAsIGhlaWdodCAtIDIwKSwKICogICAgICAgICBuZXcgUG9pbnQod2lkdGggLSAyMCwgaGVpZ2h0IC0gMjApLAogKiAgICAgICAgIHsgeDogMjAsIHk6IDIwfSwKICogICAgICAgICB7IHg6IHdpZHRoLCB5OiAyMH0KICogICAgICAgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcls4XX0gLi4uY29vcmRpbmF0ZXMgRWlnaHQgeCwgeSB2YWx1ZXMuCiAqIEBwYXJhbSB7bnVtYmVyWzZuXX0gLi4uYWRkaXRpb25hbENvb3JkaW5hdGVzPyBNdWx0aXBsZXMgb2Ygc2l4IHgsIHkgdmFsdWVzLgogKgogKiBAcGFyYW0ge1BvaW50TGlrZVs0XX0gLi4uY29vcmRpbmF0ZXMgRm91ciB7eCx5fSBjb29yZGluYXRlcy4KICogQHBhcmFtIHtQb2ludExpa2VbM25dfSAuLi5hZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IE11bHRpcGxlcyBvZiB0aHJlZSB7eCx5fSBjb29yZGluYXRlcy4KICoKICogQHNlZSB7QGxpbmsgYnNwbGluZX0KICogQHNlZSB7QGxpbmsgc3BsaW5lfQogKi8KZnVuY3Rpb24gYmV6aWVyKC4uLmFyZ3MpIHsKICBsZXQgcG9pbnRzID0gYXJnczsKCiAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBgbnVtYmVyYCkgewogICAgcG9pbnRzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgcG9pbnRzLnB1c2goeyB4OiBhcmdzW2ldLCB5OiBhcmdzW2kgKyAxXSB9KTsKICAgIH0KICB9CgogIGNvbnN0IGIgPSAodCwgYSwgYiwgYywgZCkgPT4gewogICAgY29uc3QgbXQgPSAxIC0gdDsKICAgIHJldHVybiBhICogbXQgKiogMyArIDMgKiBiICogbXQgKiogMiAqIHQgKyAzICogYyAqIG10ICogdCAqKiAyICsgZCAqIHQgKiogMzsKICB9OwoKICBsZXQgW3AwLCAuLi5yZXN0XSA9IHBvaW50czsKICBzdGFydCgpOwogIGZvciAobGV0IGkgPSAwLCBlID0gcmVzdC5sZW5ndGg7IGkgPCBlOyBpICs9IDMpIHsKICAgIGxldCBbcDEsIHAyLCBwM10gPSByZXN0LnNsaWNlKGksIGkgKyAzKTsKICAgIGlmIChwMSAmJiBwMiAmJiBwMykgewogICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IDE7IHQgKz0gMC4wMSkgewogICAgICAgIHZlcnRleChiKHQsIHAwLngsIHAxLngsIHAyLngsIHAzLngpLCBiKHQsIHAwLnksIHAxLnksIHAyLnksIHAzLnkpKTsKICAgICAgfQogICAgICB2ZXJ0ZXgocDMueCwgcDMueSk7CiAgICAgIHAwID0gcDM7CiAgICB9CiAgfQogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIEItc3BsaW5lIHVzaW5nIGZvdXIgb3IgbW9yZSBQb2ludCBvcgogKiBQb2ludC1saWtlcyB0aGF0IGltcGxlbWVudDoKICoKICogYGBgCiAqIHsKICogICB4OiBudW1iZXIKICogICB5OiBudW1iZXIKICogfQogKiBgYGAKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICByYW5nZSgwLCBUQVUsIFBJIC8gNSwgKGEpID0+IHBvaW50cy5wdXNoKAogKiAgICAgICAgIG5ldyBQb2ludCgKICogICAgICAgICAgIHJhbmRvbSgzMCkgKyA1MCAqIGNvcyhhKSwKICogICAgICAgICAgIHJhbmRvbSgzMCkgKyA1MCAqIHNpbihhKQogKiAgICAgICAgICkKICogICAgICAgKSk7CiAqICAgICAgIHNldE1vdmFibGUoLi4ucG9pbnRzKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGggLyAyLCBoZWlnaHQgLyAyKTsKICogICAgICAgbm9TdHJva2UoKTsKICogICAgICAgc2V0RmlsbChgIzAwMDJgKTsKICogICAgICAgYnNwbGluZSguLi5wb2ludHMpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHBvaW50cy5mb3JFYWNoKHAgPT4gcG9pbnQocCkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyWzhdfSAuLi5jb29yZGluYXRlcyBFaWdodCB4LCB5IHZhbHVlcy4KICogQHBhcmFtIHtudW1iZXJbMm5dfSAuLi5hZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IE11bHRpcGxlcyBvZiB4LCB5IHZhbHVlcy4KICoKICogQHBhcmFtIHtQb2ludExpa2VbNF19IC4uLmNvb3JkaW5hdGVzIEZvdXIge3gseX0gY29vcmRpbmF0ZXMuCiAqIEBwYXJhbSB7UG9pbnRMaWtlW25dfSAuLi5hZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IFplcm8gb3IgbW9yZSB7eCx5fSBjb29yZGluYXRlcy4KICoKICogQHNlZSB7QGxpbmsgYmV6aWVyfQogKiBAc2VlIHtAbGluayBzcGxpbmV9CiAqLwoKZnVuY3Rpb24gYnNwbGluZSguLi5hcmdzKSB7CiAgbGV0IG9wZW4gPSB0cnVlOwogIGlmICh0eXBlb2YgYXJnc1thcmdzLmxlbmd0aCAtIDFdID09PSBgYm9vbGVhbmApIHsKICAgIG9wZW4gPSBhcmdzLnNwbGljZShhcmdzLmxlbmd0aCAtIDEsIDEpWzBdOwogIH0KCiAgbGV0IHBvaW50cyA9IGFyZ3M7CgogIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gYG51bWJlcmApIHsKICAgIHBvaW50cyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHBvaW50cy5wdXNoKHsgeDogYXJnc1tpXSwgeTogYXJnc1tpICsgMV0gfSk7CiAgICB9CiAgfQoKICBzdGFydCgpOwogIG5ldyBCU3BsaW5lKHBvaW50cywgb3BlbikuZ2V0TFVUKCkuZm9yRWFjaCgocCkgPT4gdmVydGV4KHAueCwgcC55KSk7CiAgZW5kKCk7Cn0KCi8qKgogKiBEcmF3IGEgY2lyY2xlIHdpdGggcmFkaXVzIGByYCBhdCBgeCx5YC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYCNGMDAyYCk7CiAqICAgICAgIGNpcmNsZSh3aWR0aC8yLCBoZWlnaHQvMiwgODApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBjaXJjbGUncyBjZW50ZXIgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgY2lyY2xlJ3MgY2VudGVyIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHIgVGhlIGNpcmNsZSdzIHJhZGl1cyBpbiBwaXhlbHMKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIGNpcmNsZSdzIGNlbnRlciB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSByIFRoZSBjaXJjbGUncyByYWRpdXMgaW4gcGl4ZWxzCiAqCiAqIEBzZWUge0BsaW5rIGFyY30KICovCmZ1bmN0aW9uIGNpcmNsZSh4LCB5LCByKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICByID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBhcmMoeCwgeSwgciwgMCwgVEFVLCBmYWxzZSk7Cn0KCi8qKgogKiBDbGVhciB0aGUgY2FudmFzLCBhbmQgc2V0IGl0IHRvIGEgc3BlY2lmaWMgKENTUykgY29sb3VyLgogKiBJZiBubyBgbm9HcmlkKClgIGNhbGwgd2FzIG1hZGUsIHRoaXMgd2lsbCB0aGVuIGFsc28gZHJhdwogKiB0aGUgYmFja2dyb3VuZCBncmlkLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHBpbmtgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge2NvbG9yfSBjb2xvcj8gVGhlIChDU1MpIGJhY2tncm91bmQgY29sb3IgdG8gdXNlIChkZWZhdWx0ID0gYHdoaXRlYCkKICovCmZ1bmN0aW9uIGNsZWFyKGNvbG9yID0gYHdoaXRlYCkgewogIHNhdmUoKTsKICBfX2NhbnZhcy5zdHlsZS5iYWNrZ3JvdW5kID0gY29sb3I7CiAgX19jYW52YXMud2lkdGggPSB3aWR0aDsKICBfX2N0eCA9IF9fY2FudmFzLmdldENvbnRleHQoYDJkYCk7CiAgaWYgKF9fZHJhd19ncmlkKSBncmlkKCk7CiAgcmVzdG9yZSgpOwp9CgovKioKICogQ291bnRlcnBhcnQgdG8gc3RhcnQoKSwgZmluYWxpemVzIHRoZSBjdXJyZW50IHNoYXBlIGFuZAogKiBjb2xvdXJzIGl0LiBJZiBgY2xvc2VgIGlzIHRydWUsIGl0IHdpbGwgY2xvc2UgdGhlIHBhdGgKICogYmVmb3JlIGNvbG91cmluZy4KICoKICogSWYgYG5vRmlsbCgpYCBpcyBpbiBlZmZlY3QsIHRoZSBzaGFwZSB3aWxsIG5vdCBiZSBmaWxsZWQuCiAqIGlmIGBub1N0cm9rZSgpYCBpcyBpbiBlZmZlY3QsIHRoZSBzaGFwZSBvdXRsaW5lIHdpbGwgbm90IGJlIGNvbG91cmVkLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgZ29sZGApOwogKiAgICAgICBzdGFydCgpOwogKiAgICAgICB2ZXJ0ZXgoMCxoZWlnaHQvMik7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCAwKTsKICogICAgICAgdmVydGV4KHdpZHRoLCBoZWlnaHQvMik7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgICBlbmQodHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtib29sZWFufSBjbG9zZT8gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IHRvIGNsb3NlIHRoZSBwYXRoIChkZWZhdWx0ID0gZmFsc2UpCiAqCiAqIEBzZWUge0BsaW5rIHN0YXJ0fQogKiBAc2VlIHtAbGluayB2ZXJ0ZXh9CiAqIEBzZWUge0BsaW5rIGVuZFNoYXBlfQogKi8KZnVuY3Rpb24gZW5kKGNsb3NlID0gZmFsc2UpIHsKICBpZiAoY2xvc2UpIF9fY3R4LmNsb3NlUGF0aCgpOwogIF9fY3R4LmZpbGwoKTsKICBfX2N0eC5zdHJva2UoKTsKICBpZiAoX19jdHgubGluZVdpZHRoICUgMiA9PT0gMSkgewogICAgX19jdHgudHJhbnNsYXRlKC0wLjUsIC0wLjUpOwogIH0KfQoKLyoqCiAqIERyYXcgYW4gaW1hZ2UgaW4gYSBnaXZlbiBsb2NhdGlvbiB3aXRoIGFuIG9wdGlvbmFsCiAqIHdpZHRoIGFuZCBoZWlnaHQuIElmIG9taXR0ZWQsIHRoZSB3aWR0aCBhbmQgaGVpZ2h0CiAqIHdpbGwgYmUgdGhlIGltYWdlJ3Mgb3duIGRpbWVuc2lvbnMuIE5vdGUgdGhhdCB0aGUKICogaW1hZ2UgbWF5IGJlIGVpdGhlciBhIFVSTCwgb3IgYW4gPGltZz4gZWxlbWVudC4KICoKICogTm90ZSB0aGF0IHRoaXMgaXMgYW4gYXN5bmMgZnVuY3Rpb246IGlmIGl0IGlzIGltcG9ydGFudAogKiB0aGF0IG5vdGhpbmcgZ2V0cyBkcmF3biB1bnRpbCB0aGUgaW1hZ2UgaGFzIGJlZW4gZHJhd24sCiAqIHJlbWVtYmVyIHRvIGBhd2FpdGAgaXRzIGNhbGwuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBhc3luYyBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgYXdhaXQgaW1hZ2UoYGh0dHBzOi8vZHVtbXlpbWFnZS5jb20vMTAweDEwMGAsIDUwLCA1MCwgMTAwLCAxMDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7SW1hZ2V8c3RyaW5nfSBpbWdPclVSTCBUaGUgaW1hZ2UgdG8gZHJhdyBlaXRoZXIgYXMgSW1hZ2Ugb2JqZWN0LCBvciBpbWFnZSBVUkwuCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBkcmF3IHBvc2l0aW9uJ3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgZHJhdyBwb3NpdGlvbidzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHcgVGhlIHdpZHRoIG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHBhcmFtIHtudW1iZXJ9IGggVGhlIGhlaWdodCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEByZXR1cm5zIHtJbWFnZX0gVGhlIGRyYXduIGltYWdlCiAqCiAqIEBwYXJhbSB7SW1hZ2V8c3RyaW5nfSBpbWdPclVSTCBUaGUgaW1hZ2UgdG8gZHJhdyBlaXRoZXIgYXMgSW1hZ2Ugb2JqZWN0LCBvciBpbWFnZSBVUkwuCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSBkcmF3IHBvc2l0aW9uIGFzIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHcgVGhlIHdpZHRoIG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHBhcmFtIHtudW1iZXJ9IGggVGhlIGhlaWdodCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEByZXR1cm5zIHtJbWFnZX0gVGhlIGRyYXduIGltYWdlCiAqLwphc3luYyBmdW5jdGlvbiBpbWFnZShpbWcsIHggPSAwLCB5ID0gMCwgdywgaCkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgaCA9IHc7CiAgICB3ID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgaWYgKHR5cGVvZiBpbWcgPT09IGBzdHJpbmdgKSB7CiAgICBpbWcgPSBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIGNvbnN0IHRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGltZ2ApOwogICAgICB0YWcub25sb2FkID0gKCkgPT4gcmVzb2x2ZSh0YWcpOwogICAgICB0YWcub25lcnJvciA9ICgpID0+IHJlamVjdCgpOwogICAgICB0YWcuc3JjID0gaW1nOwogICAgfSk7CiAgfQogIF9fY3R4LmRyYXdJbWFnZShpbWcsIHgsIHksIHcgfHwgaW1nLndpZHRoLCBoIHx8IGltZy5oZWlnaHQpOwogIHJldHVybiBpbWc7Cn0KCi8qKgogKiBEcmF3IGEgbGluZSBmcm9tIG9uZSBjb29yZGluYXRlIHRvIGFub3RoZXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICByYW5nZSgwLGhlaWdodCwyMCwgKGkpID0+IGxpbmUoMCwgMCwgd2lkdGgsIGkpKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geDEgVGhlIGZpcnN0IHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTEgVGhlIGZpcnN0IHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geDIgVGhlIHNlY29uZCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkyIFRoZSBzZWNvbmQgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMSBUaGUgZmlyc3QgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMiBUaGUgc2Vjb25kIHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKi8KZnVuY3Rpb24gbGluZSh4MSwgeTEsIHgyLCB5MikgewogIGlmICh4MS54ICE9PSB1bmRlZmluZWQgJiYgeDEueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5MiA9IHkxLnk7CiAgICB4MiA9IHkxLng7CiAgICB5MSA9IHgxLnk7CiAgICB4MSA9IHgxLng7CiAgfQoKICBzdGFydCgpOwogIHZlcnRleCh4MSwgeTEpOwogIHZlcnRleCh4MiwgeTIpOwogIGVuZCgpOwp9CgovKioKICogUGxvdCBhIHk9Zih4KSBmdW5jdGlvbi4gVGhlIGlucHV0IHRvIHRoZSBmdW5jdGlvbgogKiB3aWxsIHNwYW4gdGhlIGludGVydmFsIFthLGJdIHVzaW5nIHRoZSBpbmRpY2F0ZWQKICogbnVtYmVyIG9mIHN0ZXBzLCBhbmQgdGhlIHJlIHN1bHQgbWF5IGJlIHNjYWxlZCBib3RoCiAqIGluIHRoZSB4IGFuZCB5IGRpcmVjdGlvbiBpbiBvcmRlciB0byBkcmF3IHNvbWV0aGluZwogKiB0aGF0IHlvdSBjYW4gYWN0dWFsbHkgc2VlIChlLmcuIGlmIHlvdSdyZSBwbG90dGluZwogKiB0byB0aGUgZG9tYWluIFswLDFdIHlvdSB3b3VsZG4ndCBiZSBhYmxlIHRvIHNlZSB0aGUKICogcmVzdWx0IHdpdGhvdXQgc2NhbGluZykuCiAqCiAqIFRoaXMgZnVuY3Rpb24gaXMgYXdhcmUgb2YsIGFuZCB3aWxsIHBsb3QsIGRpc2NvbnRpbnVpdGllcwogKiB1c2luZyB0aGUgc3RhbmRhcmQgb3BlbiBjaXJjbGUgbm90YXRpb24sIHVubGVzcyBpbnN0cnVjdGVkCiAqIG5vdCB0byBkbyBzbyB1c2luZyB0aGUgYGlnbm9yZURpc2NvbnRpbnVpdHlgIGJvb2xlYW4gZmxhZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICB0cmFuc2xhdGUoMCwgaGVpZ2h0IC8gMik7CiAqICAgICAgIGNvbnN0IGZuID0gKHgpID0+IGNvcyh4KSAqKiA2IC8gc2luKHgpIC0gc2luKHgpLzI7CiAqICAgICAgIHBsb3QoZm4sIDAsIDIqVEFVLCAxMjAsIHdpZHRoIC8gVEFVLCBoZWlnaHQgLyAyKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmIHRoZSBgeSA9IGYoeClgIGZ1bmN0aW9uIHRvIHBsb3QKICogQHBhcmFtIHtudW1iZXJ9IGE/IFRoZSBsb3dlciBib3VuZCBmb3IgdGhlIGlucHV0IHZhbHVlIChkZWZhdWx0ID0gMCkKICogQHBhcmFtIHtudW1iZXJ9IGI/IFRoZSB1cHBlciBib3VuZCBmb3IgdGhlIGlucHV0IHZhbHVlIChkZWZhdWx0ID0gMSkKICogQHBhcmFtIHtudW1iZXJ9IHN0ZXBzPyBUaGUgbnVtYmVyIG9mIHBsb3QgcG9pbnRzIHRvIHBsb3Qgb3ZlciB0aGUgaW50ZXJ2YWwgW2EsYl0gKGRlZmF1bHQgPSAxMDApCiAqIEBwYXJhbSB7bnVtYmVyfSB4c2NhbGU/IEFuIG9wdGlvbmFsIHNjYWxpbmcgZmFjdG9yIHRvIGFwcGx5IHRvIGVhY2ggcGxvdCBwb2ludCdzIHggdmFsdWUgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0ge251bWJlcn0geXNjYWxlPyBBbiBvcHRpb25hbCBzY2FsaW5nIGZhY3RvciB0byBhcHBseSB0byBlYWNoIHBsb3QgcG9pbnQncyB5IHZhbHVlIChkZWZhdWx0ID0gMSkKICogQHBhcmFtIHtib29sZWFufSBpZ25vcmVEaXNjb250aW51aXR5PyBEbyBub3QgZHJhdyBzcGVjaWFsIGVsZW1lbnRzIGZvciBkaXNjb250aW51aXRpZXMgKGRlZmF1bHQgPSBmYWxzZSkKICoKICogQHNlZSB7QGxpbmsgcGxvdERhdGF9CiAqLwpmdW5jdGlvbiBwbG90KAogIGYsCiAgYSA9IDAsCiAgYiA9IDEsCiAgc3RlcHMgPSAxMDAsCiAgeHNjYWxlID0gMSwKICB5c2NhbGUgPSAxLAogIGlnbm9yZURpc2NvbnRpbnVpdHkgPSBmYWxzZQopIHsKICBjb25zdCBpbnRlcnZhbCA9IGIgLSBhOwogIHN0YXJ0KCk7CiAgbGV0IFtweSwgZHksIHBkeV0gPSBbMCwgMCwgMF07CiAgY29uc3Qgc3RlcCA9IGludGVydmFsIC8gKHN0ZXBzIC0gMSk7CiAgY29uc3QgZGlzY29udGludWl0eSA9IChpLCB4LCB5KSA9PiB7CiAgICBlbmQoKTsKICAgIHNhdmUoKTsKICAgIG5vRmlsbCgpOwogICAgcG9pbnQoeCAqIHhzY2FsZSwgcHkgKiB5c2NhbGUpOwogICAgcG9pbnQoeCAqIHhzY2FsZSwgeSAqIHlzY2FsZSk7CiAgICByZXN0b3JlKCk7CiAgICBzdGFydCgpOwogIH07CiAgZm9yIChsZXQgaSA9IDAsIHgsIHk7IGkgPCBzdGVwczsgaSsrKSB7CiAgICB4ID0gYSArIGkgKiBzdGVwOwogICAgeSA9IGYoeCk7CiAgICAvLyBJZiBmKHgpIGNoYW5nZXMgaW4gdmlvbGF0aW9uIG9mIHdoYXQgaXRzIGYnKHgpIHN1Z2dlc3RlZCwKICAgIC8vIHRoYXQncyBhIGRpc2NvbnRpbnVpdHkgYW5kIHdlIGRyYXcgYW4gYXN5bXB0b3RlLgogICAgZHkgPSAoeSAtIHB5KSAqIHN0ZXA7CiAgICBpZiAoIWlnbm9yZURpc2NvbnRpbnVpdHkpIHsKICAgICAgaWYgKHBkeSAhPT0gbnVsbCAmJiBzaWduKHkgLSBweSkgIT09IHNpZ24ocGR5KSAmJiBhYnMocGR5KSA+IDAuMDEpIHsKICAgICAgICBkaXNjb250aW51aXR5KGksIHgsIHkpOwogICAgICAgIHBkeSA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcGR5ID0gZHk7CiAgICAgIH0KICAgIH0KICAgIHZlcnRleCh4ICogeHNjYWxlLCB5ICogeXNjYWxlKTsKICAgIHB5ID0geTsKICB9CiAgZW5kKCk7Cn0KCi8qKgogKiBQbG90IGEgMkQgZ3JhcGggdXNpbmcgYSBjb2xsZWN0aW9uIG9mIGFueS1kaW1lbnNpb25hbCBkYXRhLAogKiBieSBpbmRpY2F0aW5nIHdoaWNoIGRpbWVuc2lvbiBzaG91bGQgYmUgdHJlYXRlZCBhcyB0aGUgYHhgCiAqIGFuZCB3aGljaCBkaW1lbnNpb24gc2hvdWxkIGJlIHRyZWF0ZWQgYXMgdGhlIGB5YC4gSWYgbm8gYHhgCiAqIGFuZCBgeWAgYXJlIHByb3ZpZGVkLCBgZGF0YWAgd2lsbCBiZSB0cmVhdGVkIGEgMUQgYXJyYXkgYW5kCiAqIHdpbGwgcGxvdCB3aXRoIHRoZSBhcnJheSBpbmRleCBhcyBgeGAgYW5kIGVsZW1lbnQgYXQgdGhhdAogKiBpbmRleCBhcyBgeWAuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHRyYW5zbGF0ZSgwLCBoZWlnaHQvMik7CiAqCiAqICAgICAgIHNldFN0cm9rZShgZGFya2dyZWVuYCk7CiAqICAgICAgIGxldCBkYXRhID0gYXJyYXkod2lkdGgsIChpKSA9PiBbaSwgaGVpZ2h0LzIgKiBzaW4oaS8yNSldKTsKICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAqCiAqICAgICAgIHNldFN0cm9rZShgcHVycGxlYCk7CiAqICAgICAgIGRhdGEgPSBhcnJheSh3aWR0aCwgKGkpID0+ICh7CiAqICAgICAgICAgbWVlcDogaSwKICogICAgICAgICBtb29wOiBoZWlnaHQvMiAqIGNvcyhpLzI1KQogKiAgICAgICB9KSk7CiAqICAgICAgIHBsb3REYXRhKGRhdGEsIGBtZWVwYCwgYG1vb3BgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge29iamVjdFtdfSBkYXRhIFRoZSBhbnktZGltZW5zaW9uYWwgZGF0YSBmcm9tIHdoaWNoIHRvIHBsb3Qgb25lIGRpbWVuc2lvbiBhZ2FpbiBhbm90aGVyCiAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30geD8gVGhlIHByb3BlcnR5IG5hbWUgb3IgaW5kaXZpZHVhbCBlbGVtZW50IGFycmF5IGluZGV4IHRvIHVzZSBhcyB4IGRpbWVuc2lvbgogKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IHk/IFRoZSBwcm9wZXJ0eSBuYW1lIG9yIGluZGl2aWR1YWwgZWxlbWVudCBhcnJheSBpbmRleCB0byB1c2UgYXMgeSBkaW1lbnNpb24KICoKICogQHNlZSB7QGxpbmsgcGxvdH0KICovCmZ1bmN0aW9uIHBsb3REYXRhKGRhdGEsIHgsIHkpIHsKICBzdGFydCgpOwogIGlmICh4ICE9PSB1bmRlZmluZWQgJiYgeSAhPT0gdW5kZWZpbmVkKSB7CiAgICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgICAgeSA9IHgueTsKICAgICAgeCA9IHgueDsKICAgIH0KICAgIGRhdGEuZm9yRWFjaCgocCkgPT4gdmVydGV4KHBbeF0sIHBbeV0pKTsKICB9IGVsc2UgewogICAgZGF0YS5mb3JFYWNoKCh5LCB4KSA9PiB2ZXJ0ZXgoeCwgeSkpOwogIH0KICBlbmQoKTsKfQoKLyoqCiAqIERyYXcgYSBwb2ludCAoZWl0aGVyIGZyb20geC95IG9yIHBvaW50LWxpa2UpLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHJhbmdlKDAsIFRBVSwgKGEpID0+IHsKICogICAgICAgICBwb2ludCg0MCAqIGNvcyhhKSwgNDAgKiBzaW4oYSkpOwogKiAgICAgICB9KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgcG9pbnQncyBjZW50ZXIgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgcG9pbnQncyBjZW50ZXIgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgcG9pbnQncyBjZW50ZXIge3gseX0gY29vcmRpbmF0ZQogKgogKiBAc2VlIHtAbGluayBjaXJjbGV9CiAqLwpmdW5jdGlvbiBwb2ludCh4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgY2lyY2xlKHgsIHksIDMpOwp9CgovKioKICogRHJhdyBhIHJlY3RhbmdsZSBhdCB0aGUgc3BlY2lmaWVkIGNvb3JkaW5hdGUsIHdpdGgKICogdGhlIHNwZWNpZmljIHdpZHRoIGFuZCBoZWlnaHQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg0MCwgNDAsIHdpZHRoIC0gODAsIGhlaWdodCAtIDgwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgcmVjdCdzIGNvcm5lciAgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgcmVjdCdzIGNvcm5lciAgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gdyBUaGUgd2lkdGggb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcGFyYW0ge251bWJlcn0gaCBUaGUgaGVpZ2h0IG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHJlY3Q7cyBjb3JkZXIge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0gdyBUaGUgd2lkdGggb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcGFyYW0ge251bWJlcn0gaCBUaGUgaGVpZ2h0IG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICovCmZ1bmN0aW9uIHJlY3QoeCwgeSwgdywgaCkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgaCA9IHc7CiAgICB3ID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeCwgeSk7CiAgdmVydGV4KHggKyB3LCB5KTsKICB2ZXJ0ZXgoeCArIHcsIHkgKyBoKTsKICB2ZXJ0ZXgoeCwgeSArIGgpOwogIHZlcnRleCh4LCB5KTsKICBlbmQoKTsKfQoKLyoqCiAqIERyYXcgYSBjYXJkaW5hbCAoaGVybWl0ZSkgc3BsaW5lIHRoYXQgcGFzc2VzIHRocm91Z2ggZWFjaAogKiBwb2ludCBwcm92aWRlZCwgdXNpbmcgYSBtYXRoZW1hdGljYWxseSB2aXJ0dWFsIHN0YXJ0IGFuZAogKiBlbmQgdG8gZW5zdXJlIHRoZSBjdXJ2ZSBzdGFydHMgYW5kIGVuZHMgYXQgdGhlIHByb3ZpZGVkCiAqIHN0YXJ0IGFuZCBlbmQgcG9pbnQuIFRoaXMgY2FuIGJlIGJ5cGFzc2VkIGJ5IHNldHRpbmcKICogdGhlIGB2aXJ0dWFsYCBhcmd1bWVudCB0byBgZmFsc2VgLgogKgogKiBBZGRpdGlvbmFsbHksIHRoZSBzcGxpbmUncyB0aWdodG5lc3MsIHdoaWNoIGNvbnRyb2xzCiAqIGhvdyAiYmVuZHkiIHRoZSBzcGxpbmUgaXMgKHRoZSB0aWdodGVyIHRoZSBzcGxpbmUsCiAqIHRoZSBzaGFycGVyIGJlbmRzIGJlY29tZSkgY2FuIGJlIGNvbnRyb2xsZWQgYnkgc2V0dGluZwogKiB0aGUgYHRpZ2h0bmVzc2AgdmFsdWUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgcmFuZ2UoMCwgVEFVLCBQSSAvIDUsIChhKSA9PiBwb2ludHMucHVzaCgKICogICAgICAgICBuZXcgUG9pbnQoCiAqICAgICAgICAgICByYW5kb20oMzApICsgNTAgKiBjb3MoYSksCiAqICAgICAgICAgICByYW5kb20oMzApICsgNTAgKiBzaW4oYSkKICogICAgICAgICApCiAqICAgICAgICkpOwogKiAgICAgICBzZXRNb3ZhYmxlKC4uLnBvaW50cyk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7CiAqICAgICAgIHNldEZpbGwoYCMwMDAyYCk7CiAqICAgICAgIHNwbGluZSguLi5wb2ludHMpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHBvaW50cy5mb3JFYWNoKHAgPT4gcG9pbnQocCkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlW119IC4uLnBvaW50cyBUaGUgcG9pbnRzIGFjcm9zcyB3aGljaCB0byBmaXQgYSBzcGxpbmUKICogQHBhcmFtIHtib29sZWFufSB2aXJ0dWFsPyBXaGV0aGVyIG9yIG5vdCB0byBpbnZlbnQgbmV3IG1hdGhlbWF0aWNhbCBwb2ludHMgdGhhdCBlbnN1cmUgdGhlIGN1cnZlIHN0YXJ0cyBhbmQgZW5kcyBhdCB0aGUgcHJvdmlkZWQgc3RhcnQgYW5kIGVuZCBwb2ludHMuIChkZWZhdWx0ID0gdHJ1ZSkKICogQHBhcmFtIHtudW1iZXJ9IHRpZ2h0bmVzcz8gSG93IHRpZ2h0IHRoaXMgc3BsaW5lIHNob3VsZCBiZSBmaXQgdGhyb3VnaCB0aGUgcG9pbnRzIHByb3ZpZGVkLiBUaGUgaGlnaGVyIHRoZSB0aWdodG5lc3MsIHRoZSBtb3JlIHBvbHlnb25hbCB0aGUgY3VydmUgYmVjb21lcyAoZGVmYXVsdCA9IDEpCiAqCiAqIEBzZWUge0BsaW5rIGJlemllcn0KICogQHNlZSB7QGxpbmsgYnNwbGluZX0KICovCmZ1bmN0aW9uIHNwbGluZSguLi5hcmdzKSB7CiAgbGV0IHBvaW50cyA9IGFyZ3M7CiAgbGV0IHZpcnR1YWwgPSB0cnVlOwogIGxldCBUID0gMTsKCiAgLy8gaWYgdGhlIGxhc3Qgb3Igc2luZ2xlLXRvLWxhc3QgaXMgYSBib29sLCB0aGF0J3MgYHZpcnR1YWxgOgogIGlmICh0eXBlb2YgYXJnc1thcmdzLmxlbmd0aCAtIDFdID09PSBgYm9vbGVhbmApIHsKICAgIFt2aXJ0dWFsXSA9IGFyZ3Muc3BsaWNlKGFyZ3MubGVuZ3RoIC0gMSwgMSk7CiAgfSBlbHNlIGlmICh0eXBlb2YgYXJnc1thcmdzLmxlbmd0aCAtIDJdID09PSBgYm9vbGVhbmApIHsKICAgIFt2aXJ0dWFsXSA9IGFyZ3Muc3BsaWNlKGFyZ3MubGVuZ3RoIC0gMiwgMSk7CiAgfQoKICAvLyBJZiB0aGlzIG1ha2VzIHRoZSBudW1iZXIgb2YgYXJncyBvZGQsIHRoZSBsYXN0IGFyZyBpcyBUCiAgaWYgKGFyZ3MubGVuZ3RoICUgMiA9PT0gMSkgewogICAgW1RdID0gYXJncy5zcGxpY2UoYXJncy5sZW5ndGggLSAxLCAxKTsKICB9CgogIC8vIHRoZW4sIHdlIGNhbiBjb252ZXJ0CiAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBgbnVtYmVyYCkgewogICAgcG9pbnRzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgcG9pbnRzLnB1c2goeyB4OiBhcmdzW2ldLCB5OiBhcmdzW2kgKyAxXSB9KTsKICAgIH0KICB9CgogIGxldCBjcG9pbnRzID0gcG9pbnRzOwogIGlmICh2aXJ0dWFsKSB7CiAgICBjb25zdCBmMCA9IHBvaW50c1swXSwKICAgICAgZjEgPSBwb2ludHNbMV0sCiAgICAgIGYyID0gcG9pbnRzWzJdLAogICAgICBmc20gPSBuZXcgVmVjdG9yKGYwLnggLyAyICsgZjIueCAvIDIsIGYwLnkgLyAyICsgZjIueSAvIDIpLAogICAgICBmMHIgPSBuZXcgVmVjdG9yKGYwKS5yZWZsZWN0KGYxKSwKICAgICAgZnNyID0gZnNtLnJlZmxlY3QoZjEpLAogICAgICBmbiA9IG5ldyBWZWN0b3IoZjByLnggLyAyICsgZnNyLnggLyAyLCBmMHIueSAvIDIgKyBmc3IueSAvIDIpLAogICAgICBsMiA9IHBvaW50cy5hdCgtMyksCiAgICAgIGwxID0gcG9pbnRzLmF0KC0yKSwKICAgICAgbDAgPSBwb2ludHMuYXQoLTEpLAogICAgICBsc20gPSBuZXcgVmVjdG9yKGwwLnggLyAyICsgbDIueCAvIDIsIGwwLnkgLyAyICsgbDIueSAvIDIpLAogICAgICBsMHIgPSBuZXcgVmVjdG9yKGwwKS5yZWZsZWN0KGwxKSwKICAgICAgbG4gPSBuZXcgVmVjdG9yKGwwci54IC8gMiArIGxzbS54IC8gMiwgbDByLnkgLyAyICsgbHNtLnkgLyAyKTsKICAgIGNwb2ludHMgPSBbZm4sIC4uLnBvaW50cywgbG5dOwogIH0KCiAgLy8gZm91ciBwb2ludCBzbGlkaW5nIHdpbmRvdyBvdmVyIHRoZSBzZWdtZW50CiAgY29uc3QgYmV6aWVyUG9pbnRzID0gW107CiAgZm9yIChsZXQgaSA9IDAsIGUgPSBjcG9pbnRzLmxlbmd0aCAtIDM7IGkgPCBlOyBpKyspIHsKICAgIGxldCBbYzEsIGMyLCBjMywgYzRdID0gY3BvaW50cy5zbGljZShpLCBpICsgNCk7CiAgICBsZXQgcDIgPSB7CiAgICAgIHg6IGMyLnggKyAoYzMueCAtIGMxLngpIC8gKDYgKiBUKSwKICAgICAgeTogYzIueSArIChjMy55IC0gYzEueSkgLyAoNiAqIFQpLAogICAgfTsKICAgIGxldCBwMyA9IHsKICAgICAgeDogYzMueCAtIChjNC54IC0gYzIueCkgLyAoNiAqIFQpLAogICAgICB5OiBjMy55IC0gKGM0LnkgLSBjMi55KSAvICg2ICogVCksCiAgICB9OwogICAgaWYgKGkgPT09IDApIGJlemllclBvaW50cy5wdXNoKGMyKTsKICAgIGJlemllclBvaW50cy5wdXNoKHAyLCBwMywgYzMpOwogIH0KCiAgYmV6aWVyKC4uLmJlemllclBvaW50cyk7Cn0KCi8qKgogKiBTdGFydHMgYSAobmV3KSBzaGFwZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYGdvbGRgKTsKICogICAgICAgc3RhcnQoKTsKICogICAgICAgdmVydGV4KDAsaGVpZ2h0LzIpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgMCk7CiAqICAgICAgIHZlcnRleCh3aWR0aCwgaGVpZ2h0LzIpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgaGVpZ2h0KTsKICogICAgICAgZW5kKHRydWUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIGVuZH0KICogQHNlZSB7QGxpbmsgdmVydGV4fQogKiBAc2VlIHtAbGluayBzdGFydFNoYXBlfQogKi8KZnVuY3Rpb24gc3RhcnQoKSB7CiAgaWYgKF9fY3R4LmxpbmVXaWR0aCAlIDIgPT09IDEpIHsKICAgIF9fY3R4LnRyYW5zbGF0ZSgwLjUsIDAuNSk7CiAgfQogIF9fY3R4LmJlZ2luUGF0aCgpOwogIF9fZmlyc3QgPSBmYWxzZTsKfQoKLyoqCiAqIERyYXcgc29tZSB0ZXh0IHRvIHRoZSBzY3JlZW4uIEl0cyBwbGFjZW1lbnQgaXMKICogZGV0ZXJtaW5lZCBieSBib3RoIHRoZSBjb29yZGluYXRlIHByb3ZpZGVkLCBhbmQKICogdGhlIHgveSBhbGlnbm1lbnQgcHJvdmlkZWQuIFZhbGlkIGB4QWxpZ25gIHZhbHVlcwogKiBhcmU6CiAqCiAqIC0gQ0VOVEVSIC0gdGhlIHRleHQgYW5jaG9yIGlzIGluIHRoZSBtaWRkbGUgb2YgdGhlIHRleHQuIFRleHQgaXMgcGxhY2VkIGV2ZW5seSBvbiBlaXRoZXIgc2lkZS4KICogLSBFTkQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIHJpZ2h0IGZvciBMVFIgdGV4dCwgYW5kIG9uIHRoZSBsZWZ0IGZvciBSVEwgdGV4dC4KICogLSBMRUZUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIHRleHQuIGFsbCB0ZXh0IGlzIHRvIHRoZSByaWdodC4KICogLSBSSUdIVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgdGV4dC4gQWxsIHRleHQgaXMgdG8gdGhlIGxlZnQuCiAqIC0gU1RBUlQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIGxlZnQgZm9yIExUUiB0ZXh0LCBhbmQgb24gdGhlIHJpZ2h0IGZvciBSVEwgdGV4dC4KICoKICogVmFsaWQgYHlBbGlnbmAgdmFsdWVzIGFyZToKICoKICogLSBBTFBIQUJFVElDIC0gc3RhbmRhcmQgdGV4dCBhbGlnbm1lbnQKICogLSBCT1RUT00gLSB0aGUgdGV4dCBpcyBhbGlnbmVkIHRvIHRoZSBib3R0b20gb2YgdGhlIGJvdW5kaW5nIGJveAogKiAtIEhBTkdJTkcgLSByZWxldmFudCBmb3IgVGliZXRhbiBhbmQgb3RoZXIgSW5kaWMgc2NyaXB0cy4KICogLSBJREVPR1JBUEhJQyAtIHJlbGV2YW50IGZvciBpZGVvZ3JhcGhpYyBDSktWIHRleHQuCiAqIC0gTUlERExFIC0gVGhlIHZlcnRpY2FsIGVxdWl2YWxlbnQgb2YgImNlbnRlciIuCiAqIC0gVE9QIC0gVGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgdG9wIG9mIHRoZSB0eXBvZ3JhcGhpYyAiZW0gc3F1YXJlIi4KICoKICogTm90ZSB0aGF0IHRoZSBwcmltYXJ5IHRleHQgY29sb3VyIHVzZXMgdGhlIGZpbGwgY29sb3VyLiBJZiB0ZXh0CiAqIHN0cm9raW5nIGlzIGVuYWJsZWQsIHRoZSB0aGUgdGV4dCBvdXRsaW5lIHdpbGwgYmUgY29sb3VyZWQgdXNpbmcKICogdGhlIGN1cnJlbnQgc3Ryb2tlIGNvbG91ci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KCJub3JtYWwgdGV4dCIsIHdpZHRoLzIsIDYwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKDEpOwogKiAgICAgICB0ZXh0KCJ1bmZpbGxlZCB0ZXh0Iiwgd2lkdGgvMiwgMTAwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICAgIHNldFN0cm9rZShgcmVkYCk7CiAqICAgICAgIHNldEZpbGwoYHllbGxvd2ApOwogKiAgICAgICB0ZXh0KCJmYW5jeSB0ZXh0Iiwgd2lkdGgvMiwgMTQwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgdGV4dCB3ZSB3YW50IHRvIHNob3cKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHRleHQgbG9jYXRpb24ncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSB0ZXh0IGxvY2F0aW9uJ3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge3N0cmluZ30geEFsaWduPyBBbiBvcHRpb25hbCBob3Jpem9udGFsIGFsaWdubWVudCBzdHJpbmcKICogQHBhcmFtIHtzdHJpbmd9IHlBbGlnbj8gQW4gb3B0aW9uYWwgdmVydGljYWwgIGFsaWdubWVudCBzdHJpbmcKICoKICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgdGV4dCB3ZSB3YW50IHRvIHNob3cKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHRleHQgbG9jYXRpb24ncyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7c3RyaW5nfSB4QWxpZ24/IEFuIG9wdGlvbmFsIGhvcml6b250YWwgYWxpZ25tZW50IHN0cmluZwogKiBAcGFyYW0ge3N0cmluZ30geUFsaWduPyBBbiBvcHRpb25hbCB2ZXJ0aWNhbCAgYWxpZ25tZW50IHN0cmluZwogKgogKiBAc2VlIHtAbGluayBzZXRUZXh0U3Ryb2tlfQogKi8KZnVuY3Rpb24gdGV4dChzdHIsIHgsIHksIHhBbGlnbiwgeUFsaWduKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5QWxpZ24gPSB4QWxpZ247CiAgICB4QWxpZ24gPSB5OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBzYXZlKCk7CiAgaWYgKHhBbGlnbikgewogICAgc2V0VGV4dEFsaWduKHhBbGlnbiwgeUFsaWduKTsKICB9CiAgX19jdHguZmlsbFRleHQoc3RyLCB4LCB5KTsKICBpZiAoX190ZXh0U3Ryb2tlKSB7CiAgICBzZXRTdHJva2UoX190ZXh0U3Ryb2tlKTsKICAgIF9fY3R4LnN0cm9rZVRleHQoc3RyLCB4LCB5KTsKICB9CiAgcmVzdG9yZSgpOwp9CgovKioKICogRHJhdyBhIHRyaWFuZ2xlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHRyaWFuZ2xlKHdpZHRoLzIsIDMwLCAxLzQgKiB3aWR0aCwgMTYwLCAzLzQgKiB3aWR0aCwgMTEwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geDEgVGhlIGZpcnN0IHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTEgVGhlIGZpcnN0IHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geDIgVGhlIHNlY29uZCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkyIFRoZSBzZWNvbmQgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB4MyBUaGUgdGhpcmQgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MyBUaGUgdGhpcmQgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMSBUaGUgZmlyc3QgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwMiBUaGUgc2Vjb25kIHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDMgVGhlIHRoaXJkIHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKi8KZnVuY3Rpb24gdHJpYW5nbGUoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykgewogIGlmICh4MS54ICE9PSB1bmRlZmluZWQgJiYgeDEueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5MyA9IHgyLnk7CiAgICB4MyA9IHgyLng7CiAgICB5MiA9IHkxLnk7CiAgICB4MiA9IHkxLng7CiAgICB5MSA9IHgxLnk7CiAgICB4MSA9IHgxLng7CiAgfQoKICBzdGFydCgpOwogIHZlcnRleCh4MSwgeTEpOwogIHZlcnRleCh4MiwgeTIpOwogIHZlcnRleCh4MywgeTMpOwogIHZlcnRleCh4MSwgeTEpOwogIGVuZCgpOwp9CgovKioKICogQWRkIGEgdmVydGV4IHRvIHRoZSBjdXJyZW50bHkgYWN0aXZlIHNoYXBlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHN0YXJ0KCk7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCAzMCk7CiAqICAgICAgIHZlcnRleCgxLzQgKiB3aWR0aCwgMTYwKTsKICogICAgICAgdmVydGV4KDMvNCAqIHdpZHRoLCAxMTApOwogKiAgICAgICBlbmQoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgdmVydGV4J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgdmVydGV4J3MgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgdmVydGV4IHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgZW5kfQogKiBAc2VlIHtAbGluayBzdGFydH0KICovCmZ1bmN0aW9uIHZlcnRleCh4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgaWYgKF9fZmlyc3QpIHsKICAgIF9fY3R4LmxpbmVUbyh4LCB5KTsKICB9IGVsc2UgewogICAgX19maXJzdCA9IHsgeCwgeSB9OwogICAgX19jdHgubW92ZVRvKHgsIHkpOwogIH0KfQovKioKICogQ3JlYXRlIGFuIGFycmF5IG9mIHNwZWNpZmllZCBsZW5ndGgsIG9wdGlvbmFsbHkgZmlsbGVkIHVzaW5nIGEKICogZnVuY3Rpb24gdGhhdCB0YWtlcyB0aGUgZWxlbWVudCBpbmRleCBhcyBzaW5nbGUgaW5wdXQgYXJndW1lbnQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHRyYW5zbGF0ZSgwLCBoZWlnaHQvMik7CiAqICAgICAgIGxldCBkYXRhID0gYXJyYXkod2lkdGgsIChpKSA9PiBbaSwgaGVpZ2h0LzIgKiBzaW4oaS8yNSldKTsKICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAqICAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggVGhlIHNpemUgb2YgdGhlIGFycmF5IHlvdSB3YW50CiAqIEBwYXJhbSB7RnVuY3Rpb259IGZpbGxGdW5jdGlvbj8gVGhlIG9wdGlvbmFsIGZ1bmN0aW9uIHRoYXQgZ2V0cyB1c2VkIHRvIGZpbGwgdGhlIGFycmF5CiAqLwpmdW5jdGlvbiBhcnJheShsZW4sIGZpbGxGdW5jdGlvbikgewogIGNvbnN0IGFyciA9IG5ldyBBcnJheShsZW4pLmZpbGwoKTsKICBpZiAoZmlsbEZ1bmN0aW9uKSB7CiAgICByZXR1cm4gYXJyLm1hcCgoXywgaSkgPT4gZmlsbEZ1bmN0aW9uKGkpKTsKICB9CiAgcmV0dXJuIGFycjsKfQoKLyoqCiAqIEVtcHR5IHRoZSBsaXN0IG9mIG1vdmFibGUgcG9pbnRzIGluIHlvdXIgZ3JhcGhpYy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRCdXR0b24oYGxvY2tgLCAoKSA9PiB7CiAqICAgICAgICAgY2xlYXJNb3ZhYmxlKCk7CiAqICAgICAgICAgcmVkcmF3KCk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGZvcihsZXQgcCBvZiBwb2ludHMpIHsKICogICAgICAgICBzZXRDb2xvcihpc01vdmFibGUocCkgPyBgcmVkYCA6IGBncmV5YCk7CiAqICAgICAgICAgcG9pbnQocCk7CiAqICAgICAgIH0KICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgseSkgewogKiAgICAgICBpZiAoY3VycmVudE1vdmFibGUpIHJldHVybjsKICogICAgICAgY29uc3QgcCA9IG5ldyBQb2ludCh4LHkpOwogKiAgICAgICBwb2ludHMucHVzaChwKTsKICogICAgICAgc2V0TW92YWJsZShwKTsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgaXNNb3ZhYmxlfQogKiBAc2VlIHtAbGluayBzZXRNb3ZhYmxlfQogKi8KZnVuY3Rpb24gY2xlYXJNb3ZhYmxlKCkgewogIF9fbW92YWJsZV9wb2ludHMuc3BsaWNlKDAsIF9fbW92YWJsZV9wb2ludHMubGVuZ3RoKTsKfQoKLyoqCiAqIENyZWF0ZSBhIGNvcHkgb2YgdGhlIGN1cnJlbnQgY2FudmFzIGVsZW1lbnQKICogZm9yIHVzZSBzb21ld2hlcmUgZWxzZSBpbiB5b3VyIG93biBjb2RlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHBpbmtgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgseSkgewogKiAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KAogKiAgICAgICAgIG5ldyBDdXN0b21FdmVudChgZ3JhcGhpY3M6dXBkYXRlYCwgewogKiAgICAgICAgICAgZGV0YWlsOiB7CiAqICAgICAgICAgICAgIGNhbnZhczogY29weSgpCiAqICAgICAgICAgICB9CiAqICAgICAgICAgfSkKICogICAgICAgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcmV0dXJucyB7SFRNTENhbnZhc0VsZW1lbnR9IEEgY29weSBvZiB0aGUgY3VycmVudCBjYW52YXMKICovCmZ1bmN0aW9uIGNvcHkoKSB7CiAgY29uc3QgY29weSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGNhbnZhc2ApOwogIGNvcHkud2lkdGggPSB3aWR0aDsKICBjb3B5LmhlaWdodCA9IGhlaWdodDsKICBjb25zdCBjdHggPSBjb3B5LmdldENvbnRleHQoYDJkYCk7CiAgY3R4LmRyYXdJbWFnZShfX2NhbnZhcywgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgcmV0dXJuIGNvcHk7Cn0KCi8qKgogKiBHZW5lcmF0ZXMgYSBjb2xvciBiYXNlZCBvbiB0aGUgSFNMIGNvbG9yIHNwYWNlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoY29sb3IoNDUsIDgwLCA5MCkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBodWUgaW4gdGhlIHJhbmdlIFswLCAzNjBdCiAqIEBwYXJhbSB7bnVtYmVyfSBzYXR1cmF0aW9uIGluIHRoZSByYW5nZSBbMCwgMTAwXQogKiBAcGFyYW0ge251bWJlcn0gbGlnaHRuZXNzIGluIHRoZSByYW5nZSBbMCwgMTAwXQogKiBAcGFyYW0ge251bWJlcn0gb3BhY2l0eSBpbiB0aGUgcmFuZ2UgWzAsIDFdCiAqIEByZXR1cm5zIHtzdHJpbmd9IEEgQ1NTIGhzbGEgY29sb3Igc3RyaW5nCiAqCiAqIEBzZWUge0BsaW5rIHJhbmRvbUNvbG9yfQogKi8KZnVuY3Rpb24gY29sb3IoaCA9IF9fY3VycmVudF9odWUsIHMgPSA1MCwgbCA9IDUwLCBhID0gMSkgewogIHJldHVybiBgaHNsYSgke2h9LCR7c30lLCR7bH0lLCR7YX0pYDsKfQoKLyoqCiAqIEZpbmQgYW4gSFRNTCBlbGVtZW50IGluc2lkZSB5b3VyIGdyYXBoaWNzLWVsZW1lbnQKICogYnkgcXVlcnkgc2VsZWN0b3IuIFRoaXMgaXMgZXF1aXZhbGVudCB0bzoKICoKICogYGBgCiAqIHlvdXJFbGVtZW50LnF1ZXJ5U2VsZWN0b3IocXMpCiAqIGBgYAogKgogKiBAcGFyYW0ge3N0cmluZ30gcXVlcnlTZWxlY3RvciBBIHF1ZXJ5IHNlbGVjdG9yCiAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxudWxsfSBUaGUgbWF0Y2hlZCBlbGVtZW50LCBvciBudWxsIGlmIHRoZXJlIHdhcyBubyBtYXRjaC4KICovCmZ1bmN0aW9uIGZpbmQocXMpIHsKICByZXR1cm4gX19lbGVtZW50LnF1ZXJ5U2VsZWN0b3IocXMpOwp9CgovKioKICogRmluZCBhbGwgSFRNTCBlbGVtZW50cyBpbnNpZGUgeW91ciBncmFwaGljcy1lbGVtZW50CiAqIHRoYXQgbWF0Y2ggYSBnaXZlbiBxdWVyeSBzZWxlY3Rvci4gVGhpcyBpcyBlcXVpdmFsZW50IHRvOgogKgogKiBgYGAKICogQXJyYXkuZnJvbSh5b3VyRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHFzKSkKICogYGBgCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBxdWVyeVNlbGVjdG9yIEEgcXVlcnkgc2VsZWN0b3IKICogQHJldHVybnMge0hUTUxFbGVtZW50W119IEFuIGFycmF5IHdpdGggYWxsIG1hdGNoaW5nIGVsZW1lbnRzLCBbXSBpZiB0aGVyZSB3ZXJlIG5vIG1hdGNoZXMuCiAqLwpmdW5jdGlvbiBmaW5kQWxsKHFzKSB7CiAgcmV0dXJuIFsuLi5fX2VsZW1lbnQucXVlcnlTZWxlY3RvckFsbChxcyldOwp9CgovKioKICogTWFyayBhIHNwZWNpZmljIGNvbG9yIGFzIHRoZSBoaWdobGlnaHQgY29sb3IsCiAqIHdoaWNoIGNhdXNlcyB0aGUgZ3JhcGhpYyB0byByZWRyYXcgd2l0aCB0aGF0CiAqIGNvbG9yIHJlcGxhY2VkIGJ5IHdoaWNoZXZlciBjb2xvciB5b3UgcGlja2VkCiAqIGFzIGhpZ2hsaWdodCBjb2xvci4KICoKICogTm90ZSB0aGF0IHlvdSBjYW4gb25seSB1c2UgbmFtZWQgKENTUykgY29sb3JzCiAqIHdpdGggdGhpcyBmdW5jdGlvbi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0SGlnaGxpZ2h0Q29sb3IoYGxpbWVgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KCJsZXQncyBnbyIsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICBpZiAoc3RhdGUpIGhpZ2hsaWdodChgcmVkYCk7CiAqICAgICAgIGVsc2UgaGlnaGxpZ2h0KGZhbHNlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge2NvbG9yfGJvb2xlYW59IGNvbG9yIFNldCB0aGUgY29sb3IgdGhhdCBzaG91bGQgZ2V0IHJlcGxhY2VkIHdpdGggdGhlIGhpZ2hsaWdodCBjb2xvciwgb3IgZGlzYWJsZSBoaWdobGlnaHQgd2hlbiBjb2xvciBpcyBgZmFsc2VgCiAqCiAqIEBzZWUge0BsaW5rIHNldEhpZ2hsaWdodENvbG9yfQogKi8KZnVuY3Rpb24gaGlnaGxpZ2h0KGNvbG9yKSB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdKSB7CiAgICBfX2hpZ2hsaWdodF9jb2xvciA9IENTU19DT0xPUl9NQVBbY29sb3JdOwogIH0gZWxzZSB7CiAgICBfX2hpZ2hsaWdodF9jb2xvciA9IGNvbG9yOwogIH0KICByZWRyYXcoKTsKfQoKLyoqCiAqIENoZWNrIHdoZXRoZXIgYSBwb2ludCBpcyByZWdpc3RlcmVkIGFzIG1vdmFibGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGBsb2NrYCwgKCkgPT4gewogKiAgICAgICAgIGNsZWFyTW92YWJsZSgpOwogKiAgICAgICAgIHJlZHJhdygpOwogKiAgICAgICB9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBmb3IobGV0IHAgb2YgcG9pbnRzKSB7CiAqICAgICAgICAgc2V0Q29sb3IoaXNNb3ZhYmxlKHApID8gYHJlZGAgOiBgZ3JleWApOwogKiAgICAgICAgIHBvaW50KHApOwogKiAgICAgICB9CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bih4LHkpIHsKICogICAgICAgaWYgKGN1cnJlbnRNb3ZhYmxlKSByZXR1cm47CiAqICAgICAgIGNvbnN0IHAgPSBuZXcgUG9pbnQoeCx5KTsKICogICAgICAgcG9pbnRzLnB1c2gocCk7CiAqICAgICAgIHNldE1vdmFibGUocCk7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBUaGUgcG9pbnQgdGhhdCB3ZSB3YW50IHRvIGNoZWNrICJtb3ZhYmlsaXR5IiBmb3IKICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgb3VyIHBvaW50IGlzIGluIHRoZSBsaXN0IG9mIG1vdmFibGUgcG9pbnRzLCBvdGhlcndpc2UgZmFsc2UKICoKICogQHNlZSB7QGxpbmsgY2xlYXJNb3ZhYmxlfQogKiBAc2VlIHtAbGluayBzZXRNb3ZhYmxlfQogKi8KZnVuY3Rpb24gaXNNb3ZhYmxlKHBvaW50KSB7CiAgcmV0dXJuIF9fbW92YWJsZV9wb2ludHMuaW5jbHVkZXMocG9pbnQpOwp9CgovKioKICogR2V0IHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRoYXQgdGhpcwogKiBncmFwaGljIGhhcyBiZWVuIHJ1bm5pbmcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIGNvbnN0IHNlY29uZHMgPSAobWlsbGlzKCkvMTAwMCl8MDsKICogICAgICAgdGV4dChgJHtzZWNvbmRzfXNgLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcmV0dXJucyB7bnVtYmVyfSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHNpbmNlIHRoZSBncmFwaGljIGxvYWRlZCBpbgogKi8KZnVuY3Rpb24gbWlsbGlzKCkgewogIHJldHVybiBEYXRlLm5vdygpIC0gX19zdGFydF90aW1lOwp9CgovKioKICogUGF1c2UgdGhlIGdyYXBoaWMgaWYgaXRzIGN1cnJlbnRseSBwbGF5aW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBjb25zdCBzZWNvbmRzID0gKG1pbGxpcygpLzEwMDApLnRvRml4ZWQoMSk7CiAqICAgICAgIHRleHQoYCR7c2Vjb25kc31zYCwgd2lkdGgvMiwgaGVpZ2h0LzIpCiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyQWN0aXZlKHN0YXRlKSB7CiAqICAgICAgIGlmKHN0YXRlKSB7CiAqICAgICAgICAgcGF1c2UoKTsKICogICAgICAgfSBlbHNlIHsKICogICAgICAgICBwbGF5KCk7CiAqICAgICAgIH0KICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBwbGF5fQogKiBAc2VlIHtAbGluayB0b2dnbGVQbGF5fQogKi8KZnVuY3Rpb24gcGF1c2UoKSB7CiAgcGxheWluZyA9IGZhbHNlOwp9CgovKioKICogU3RhcnQgcGxheWluZyB5b3VyIGdyYXBoaWMsIG1lYW5pbmcgaXQgd2lsbCBjYWxsIGRyYXcoKQogKiBhdCB3aGF0ZXZlciByYXRlIHRoZSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgbG9vcCBpcwogKiBhbGxvd2VkIHRvIHJ1biBvbiB5b3VyIGNvbXB1dGVyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgbGV0IGZwcyA9IDA7CiAqICAgICBsZXQgY2hlY2tlZCA9IGZhbHNlOwogKiAgICAgbGV0IGxhc3RGcmFtZUNoZWNrID0gMDsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKS50b0ZpeGVkKDEpOwogKiAgICAgICB0ZXh0KGBmcHM6ICR7ZnBzfWAsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgICBpZiAoc2Vjb25kcy5lbmRzV2l0aChgLjBgKSkgewogKiAgICAgICAgIGlmICghY2hlY2tlZCkgewogKiAgICAgICAgICAgY2hlY2tlZCA9IHRydWU7CiAqICAgICAgICAgICBmcHMgPSBmcmFtZSAtIGxhc3RGcmFtZUNoZWNrOwogKiAgICAgICAgICAgbGFzdEZyYW1lQ2hlY2sgPSBmcmFtZTsKICogICAgICAgICB9CiAqICAgICAgIH0gZWxzZSB7CiAqICAgICAgICAgY2hlY2tlZCA9IGZhbHNlOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgcGF1c2V9CiAqIEBzZWUge0BsaW5rIHRvZ2dsZVBsYXl9CiAqLwpmdW5jdGlvbiBwbGF5KCkgewogIHBsYXlpbmcgPSB0cnVlOwogIF9fZHJhdygpOwp9CgovKioKICogR2VuZXJhdGUgYSByYW5kb20gY29sb3VyLiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbgogKiBhbGxvd3MgeW91IHRvIGdldCAidGhlIGN1cnJlbnRseSBnZW5lcmF0ZWQgcmFuZG9tCiAqIGNvbG91ciIgaW4gZGlmZmVyZW50IG9wYWNpdGllcyBieSBjYWxsaW5nIHRoZSBmdW5jdGlvbgogKiB3aXRoIGFuIG9wYWNpdHkgdmFsdWUsIGFuZCBgZmFsc2VgIGFzIGN5Y2xlIGFyZ3VtZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIocmFuZG9tQ29sb3IoKSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bigpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICoKICogQHBhcmFtIHtudW1iZXJ9IG9wYWNpdHkgVGhlIG9wYWNpdHkgdmFsdWUgaW4gdGhlIHJhbmdlIFswLDFdCiAqIEBwYXJhbSB7bnVtYmVyfSBjeWNsZT8gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IHRvIG1vdmUgb24gdG8gdGhlIG5leHQgY29sb3VyIChkZWZhdWx0ID0gdHJ1ZSkKICoKICogQHNlZSB7QGxpbmsgY29sb3J9CiAqLwpmdW5jdGlvbiByYW5kb21Db2xvcihhID0gMS4wLCBjeWNsZSA9IHRydWUpIHsKICBpZiAoY3ljbGUpIF9fY3VycmVudF9odWUgPSByYW5kb20oMCwgMzYwKTsKICByZXR1cm4gYGhzbGEoJHtfX2N1cnJlbnRfaHVlfSw1MCUsNTAlLCR7YX0pYDsKfQoKLyoqCiAqIEFuIGFsdGVybmF0aXZlIHRvIHdyaXRpbmcgZm9yIGxvb3BzLCBiZWNhdXNlCiAqIG5vIG9uZSB3YW50cyB0byBjb25zdGFudGx5IHdyaXRlIHZhciBhbGxvY2F0aW9ucwogKiB0aGF0IG9ubHkgbGl2ZSBmb3IgdGhlIGR1cmF0aW9uIG9mIGEgbG9vcC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICByYW5nZSgwLCBUQVUsIChhKSA9PiBwb2ludCg0MCAqIGNvcyhhKSwgNDAgKiBzaW4oYSkpKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgVGhlIGVxdWl2YWxlbnQgb2YgYSBmb3IgbG9vcCdzIGluaXRpYWwgYGxldCBpID0gLi4uYAogKiBAcGFyYW0ge251bWJlcn0gZW5kIFRoZSBlcXVpdmFsZW50IG9mIGEgZm9yIGxvb3AncyBgaSA8IGVuZGAKICogQHBhcmFtIHtudW1iZXJ9IHN0ZXA/IFRoZSBzdGVwIHNpemUgYnkgd2hpY2ggdG8gaW5jcmVtZW50IGF0IGVhY2ggaXRlcmF0aW9uIChkZWZhdWx0cyA9IGAoc3RhcnQtZW5kKS8xMGApCiAqIEBwYXJhbSB7RnVuY3Rpb259IHJ1bkZ1bmN0aW9uIFRoZSBmdW5jdGlvbiB0byBydW4gYXQgZWFjaCBpdGVyYXRpb24KICovCmZ1bmN0aW9uIHJhbmdlKHN0YXJ0LCBlbmQsIHN0ZXAsIHJ1bkZ1bmN0aW9uKSB7CiAgaWYgKHR5cGVvZiBzdGVwID09PSBgZnVuY3Rpb25gKSB7CiAgICBydW5GdW5jdGlvbiA9IHN0ZXA7CiAgICBzdGVwID0gKGVuZCAtIHN0YXJ0KSAvIDEwOwogIH0KICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkgKz0gc3RlcCkgewogICAgcnVuRnVuY3Rpb24oaSk7CiAgfQp9CgovKioKICogU2FmZWx5IHRyaWdnZXIgYSBuZXcgZHJhdyBwYXNzLiBJZiB0aGUgZ3JhcGhpYyBpcyBydW5uaW5nCiAqIGluIGFuaW1hdGVkIG1vZGUsIG9yIGEgcmVkcmF3KCkgaXMgdHJpZ2dlcmVkIF9kdXJpbmdfIGEKICogcmVkcmF3KCksIHRoaXMgY2FsbCB3aWxsIGRvIG5vdGhpbmcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjb25zdCBoID0gbWFwKHBvaW50ZXIueCwgMCwgd2lkdGgsIDAsIDM2MCk7CiAqICAgICAgIGNvbnN0IGwgPSBtYXAocG9pbnRlci55LCAwLCBoZWlnaHQsIDUwLCAwKTsKICogICAgICAgY2xlYXIoY29sb3IoaCwgMTAwLCBsKSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSgpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIHJlZHJhdygpIHsKICBpZiAoX19yZWRyYXdpbmcpIHJldHVybjsKICBpZiAocGxheWluZykgcmV0dXJuOwogIF9fcmVkcmF3aW5nID0gdHJ1ZTsKICBfX2RyYXcoKTsKICBfX3JlZHJhd2luZyA9IGZhbHNlOwp9CgovKioKICogUmVzdG9yZSB0aGUgZ3JhcGhpY3MgY29udGV4dCAodHJhbnNmb3JtcywKICogY3VycmVudCBjb2xvcnMsIGV0YykgdG8gd2hhdCB0aGV5IHdlcmUKICogd2hlbiBzYXZlKCkgd2FzIGNhbGxlZC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZSgwLDAsODAsMCk7CiAqICAgICAgIHNhdmUoKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApCiAqICAgICAgIHJhbmdlKDAsIDUsIDEsIChhKSA9PiB7CiAqICAgICAgICAgcm90YXRlKFBJLzgpOwogKiAgICAgICAgIGxpbmUoMCwwLDgwLDApOwogKiAgICAgICB9KTsKICogICAgICAgcmVzdG9yZSgpOwogKiAgICAgICBsaW5lKC0yMCwwLC04MCwwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzYXZlfQogKi8KZnVuY3Rpb24gcmVzdG9yZSgpIHsKICBfX2N0eC5yZXN0b3JlKCk7Cn0KCi8qKgogKiBNYXJrIG9uZSBvciBtb3JlIHBvaW50cyBhcyBtb3ZhYmxlLCBtZWFuaW5nCiAqIHRoYXQgdGhlIHVzZXIgY2FuIHJlcG9zaXRpb24gdGhlIHBvaW50IGFyb3VuZCBvbgogKiB0aGUgY2FudmFzIGJ5IHRvdWNoL2NsaWNrLWRyYWdnaW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGZvciAobGV0IGkgPSA0MDsgaSA8IDIwMDsgaSArPSAyMCkgewogKiAgICAgICAgIHBvaW50cy5wdXNoKG5ldyBQb2ludChpIC0gMjAsIDEyMCkpOwogKiAgICAgICB9CiAqICAgICAgIHNldE1vdmFibGUoLi4ucG9pbnRzKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICBzZXRTdHJva2UoYHB1cnBsZWApOwogKiAgICAgICBic3BsaW5lKC4uLnBvaW50cyk7CiAqICAgICAgIGZvcihsZXQgcCBvZiBwb2ludHMpIHBvaW50KHApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlW25dfSBwb2ludHMgT25lIG9yIG1vcmUgcG9pbnRzIHRvIG1hcmsgYXMgbW92YWJsZS4KICoKICogQHNlZSB7QGxpbmsgaXNNb3ZhYmxlfQogKiBAc2VlIHtAbGluayBjbGVhck1vdmFibGV9CiAqLwpmdW5jdGlvbiBzZXRNb3ZhYmxlKC4uLnBvaW50cykgewogIHBvaW50cy5mb3JFYWNoKChwKSA9PiB7CiAgICBpZiAoX19tb3ZhYmxlX3BvaW50cy5pbmRleE9mKHApID09PSAtMSkgewogICAgICBfX21vdmFibGVfcG9pbnRzLnB1c2gocCk7CiAgICB9CiAgfSk7Cn0KCi8qKgogKiBTZXQgKG9yIGNoYW5nZSkgdGhlIGdyYXBoaWMncyBzaXplLiBOb3RlIHRoYXQgeW91ciB3aWR0aAogKiBhbmQgaGVpZ2h0IHZhbHVlcyB3aWxsIGdldCByb3VuZGVkIHRvIGludGVnZXIgdmFsdWVzLgogKgogKiBOb3RlIHRoYXQgYHNldFNpemVgIHdpbGwgaW1tZWRpYXRlbHkgdHJpZ2dlciBhIHJlZHJhdywKICogd2hldGhlciB5b3Ugd2FudCBpdCB0byBvciBub3QsIGJlY2F1c2UgY2hhbmdpbmcgY2FudmFzCiAqIGRpbWVuc2lvbnMgY2xlYXJzIHRoZSBjYW52YXMsIG5lY2Vzc2l0YXRpbmcgYSByZWRyYXcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSg0MDAsIDIwMCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBjZW50ZXIoKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCkKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KGAke3dpZHRofS8ke2hlaWdodH1gLCAwLCAwLCBDRU5URVIsIE1JRERMRSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyVXAoKSB7CiAqICAgICAgIHNldFNpemUocmFuZG9tKDEwMCw0MDApLCAyMDApOwogKiAgICAgICAvLyBOb3RlIHRoYXQgdGhlcmUgaXMgbm8gcmVkcmF3KCkgaGVyZSEKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gd2lkdGggVGhlIGdyYXBoaWNzIHdpZHRoIGluIHBpeGVscwogKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IFRoZSBncmFwaGljcyBoZWlnaHQgaW4gcGl4ZWxzCiAqLwpmdW5jdGlvbiBzZXRTaXplKHcgPSA0MDAsIGggPSAyMDApIHsKICB3aWR0aCA9IF9fY2FudmFzLndpZHRoID0gdyB8IDA7CiAgaGVpZ2h0ID0gX19jYW52YXMuaGVpZ2h0ID0gaCB8IDA7CiAgX19lbGVtZW50LnN0eWxlLm1heFdpZHRoID0gYGNhbGMoMmVtICsgJHt3aWR0aH1weGA7CiAgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwogIF9fZHJhdygpOwp9CgovKioKICogU2F2ZSB0aGUgY3VycmVudCBncmFwaGljcyBjb250ZXh0ICh0cmFuc2Zvcm1zLAogKiBjdXJyZW50IGNvbG9ycywgZXRjKSBzbyB0aGF0IHRob3NlIGNhbiBiZSByZXN0b3JlZAogKiBhZnRlciBjaGFuZ2luZyB0aGVtLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICBsaW5lKDAsMCw4MCwwKTsKICogICAgICAgc2F2ZSgpOwogKiAgICAgICBzZXRDb2xvcihgZGFya2dyZWVuYCkKICogICAgICAgcmFuZ2UoMCwgNSwgMSwgKGEpID0+IHsKICogICAgICAgICByb3RhdGUoUEkvOCk7CiAqICAgICAgICAgbGluZSgwLDAsODAsMCk7CiAqICAgICAgIH0pOwogKiAgICAgICByZXN0b3JlKCk7CiAqICAgICAgIGxpbmUoLTIwLDAsLTgwLDApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqICogQHNlZSB7QGxpbmsgcmVzdG9yZX0KICovCmZ1bmN0aW9uIHNhdmUoKSB7CiAgX19jdHguc2F2ZSgpOwp9CgovKioKICogQ29udmVydCB0aGUgY3VycmVudCBjYW52YXMgaW50byBhbiBkYXRhIFVSTAogKiB0aGF0IHJlcHJlc2VudHMgYSBQTkcgaW1hZ2UuCiAqCiAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBjdXJyZW50IGNhbnZhcyBhcyBQTkcgZGF0YSBVUkwKICovCmZ1bmN0aW9uIHRvRGF0YVVSTCgpIHsKICByZXR1cm4gX19jYW52YXMudG9EYXRhVVJMKCk7Cn0KCi8qKgogKiBJZiB0aGUgZ3JhcGhpYyBpcyBjdXJyZW50bHkgcGxheWluZywgcGF1c2UgaXQsCiAqIGFuZCBpZiBpdCdzIHBhdXNlZCwgcGxheSBpdC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKS50b0ZpeGVkKDEpOwogKiAgICAgICB0ZXh0KGAke3NlY29uZHN9c2AsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICB0b2dnbGVQbGF5KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge2Jvb2xlYW59IFRoZSBuZXcgcGxheSBzdGF0ZQogKgogKiBAc2VlIHtAbGluayBwYXVzZX0KICogQHNlZSB7QGxpbmsgcGxheX0KICovCmZ1bmN0aW9uIHRvZ2dsZVBsYXkoKSB7CiAgcGxheWluZyA/IHBhdXNlKCkgOiBwbGF5KCk7CiAgcmV0dXJuIHBsYXlpbmc7Cn0KY29uc3QgewogIC8qKgogICAqIEdldCB0aGUgYWJzb2x1dGUgdmFsdWUgZm9yIHNvbWUgaW5wdXQKICAgKgogICAqIEV4YW1wbGU6CiAgICoKICAgKiA8Z3JhcGhpY3MtZWxlbWVudD4KICAgKiAgIDxncmFwaGljcy1zb3VyY2U+CiAgICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAgICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAgICogICAgICAgdHJhbnNsYXRlKDAsIGhlaWdodC8yKTsKICAgKiAgICAgICBub0ZpbGwoKTsKICAgKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAgICogICAgICAgbGluZSgtaHVnZSwgMCwgaHVnZSwgMCk7CiAgICoKICAgKiAgICAgICBjb25zdCB3MiA9IHdpZHRoLzI7CiAgICogICAgICAgY29uc3QgZGF0YSA9IGFycmF5KHdpZHRoLCAoeCkgPT4gW3gsIHggLSB3MiwgYWJzKHggLSB3MildKTsKICAgKgogICAqICAgICAgIHNldFN0cm9rZShgcmVkYCk7CiAgICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMSk7CiAgICoKICAgKiAgICAgICBzZXRTdHJva2UoYGJsdWVgKTsKICAgKiAgICAgICBwbG90RGF0YShkYXRhLCAwLCAyKTsKICAgKiAgICAgfQogICAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAgICogPC9ncmFwaGljcy1lbGVtZW50PgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IHYgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnB1dCB2YWx1ZSB3aXRoIGl0cyBzaWduIHNldCB0byBwb3NpdGl2ZQogICAqLwogIGFicywKCiAgLyoqCiAgICogVGhlIGludmVyc2UgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gdiBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludmVyc2UgY29zaW5lIG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBhc2lufQogICAqIEBzZWUge0BsaW5rIGFjb3NofQogICAqLwogIGFjb3MsCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGludmVyc2UgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBoeXBlcmJvbGljIGludmVyc2UgY29zaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBhc2luaH0KICAgKiBAc2VlIHtAbGluayBhY29zfQogICAqLwogIGFjb3NoLAoKICAvKioKICAgKiBUaGUgaW52ZXJzZSBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnZlcnNlIHNpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGFjb3N9CiAgICogQHNlZSB7QGxpbmsgYXNpbmh9CiAgICovCiAgYXNpbiwKCiAgLyoqCiAgICogVGhlIGh5cGVyYm9saWMgaW52ZXJzZSBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBoeXBlcmJvbGljIGludmVyc2Ugc2luZQogICAqCiAgICogQHNlZSB7QGxpbmsgYWNvc2h9CiAgICogQHNlZSB7QGxpbmsgYXNpbn0KICAgKi8KICBhc2luaCwKCiAgLyoqCiAgICogVGhlIGludmVyc2UgdGFuZ2VudCBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaW52ZXJzZSB0YW5nZW50CiAgICoKICAgKiBAc2VlIHtAbGluayB0YW59CiAgICovCiAgYXRhbiwKCiAgLyoqCiAgICogVGhlICJhdGFuMiIgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9BdGFuMgogICAqCiAgICogQHBhcmFtIHt5fSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHBhcmFtIHt4fSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGF0YW4yIGFuZ2xlIGZvciB0aGlzIG51bWJlciBwYWlyCiAgICovCiAgYXRhbjIsCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGludmVyc2UgdGFuZ2VudCBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIHRhbmdlbnQKICAgKgogICAqIEBzZWUge0BsaW5rIHRhbn0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKiBAc2VlIHtAbGluayBhc2luaH0KICAgKi8KICBhdGFuaCwKCiAgLyoqCiAgICogVGhlIGN1YmUgcm9vdCBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgKHJlYWwpIGN1YmUgcm9vdCBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgc3FydH0KICAgKi8KICBjYnJ0LAoKICAvKioKICAgKiBUaGUgInJvdW5kIHVwIHRvIHRoZSBuZWFyZXN0IGludGVnZXIiIGZ1bmN0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaW50ZWdlciByZXN1bHQgYWZ0ZXIgcm91bmRpbmcgdXAuCiAgICoKICAgKiBAc2VlIHtAbGluayBmbG9vcn0KICAgKiBAc2VlIHtAbGluayByb3VuZH0KICAgKi8KICBjZWlsLAoKICAvKioKICAgKiBHZXQgdGhlIG51bWJlciBvZiBsZWFkaW5nIHplcm8gYml0cyBpbiB0aGUgMzItYml0IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiBhIG51bWJlcgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIGxlYWRpbmcgemVybyBiaXRzIGluIHRoZSAzMi1iaXQgYmluYXJ5IHJlcHJlc2VudGF0aW9uIG9mIHRoYXQgbnVtYmVyLgogICAqLwogIGNsejMyLAoKICAvKioKICAgKiBUaGUgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBjb3NpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIHNpbn0KICAgKi8KICBjb3MsCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwZXJib2xpYyBjb3NpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGNvc30KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICBjb3NoLAoKICAvKioKICAgKiBUaGUgZXhwb25lbnQgZnVuY3Rpb24sIHRoYXQgaXM6IGVeeAogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgdmFsdWUgb2YgRSByYWlzZWQgdG8gdGhhdCBudW1iZXIncyBwb3dlcgogICAqCiAgICogQHNlZSB7QGxpbmsgRX0KICAgKi8KICBleHAsCgogIC8qKgogICAqIFRoZSAicm91bmQgZG93biB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIiBmdW5jdGlvbi4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludGVnZXIgcmVzdWx0IGFmdGVyIHJvdW5kaW5nIGRvd24uCiAgICoKICAgKiBAc2VlIHtAbGluayBjZWlsfQogICAqIEBzZWUge0BsaW5rIHJvdW5kfQogICAqLwogIGZsb29yLAoKICAvKioKICAgKiBSb3VuZCBhIG51bWJlciB0byB0aGUgbmVhcmVzdCAzMiBiaXQsIHJhdGhlciB0aGFuIHRoZQogICAqIHN0YW5kYXJkIEpTIDY0IGJpdCwgZmxvYXRpbmcgcG9pbnQgcmVwcmVzZW50YXRpb24uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBudW1iZXIgYWZ0ZXIgcm91bmRpbmcgdG8gdGhlIG5lYXJlc3QgMzIgYml0IGZsb2F0aW5nIHBvaW50IHJlcHJlc2VudGF0aW9uLgogICAqCiAgICogQHNlZSB7QGxpbmsgcm91bmR9CiAgICovCiAgZnJvdW5kLAoKICAvKioKICAgKiBUaGUgRXVjbGlkZWFuIGh5cG90ZW51c2UgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyW119IC4uLmlucHV0IFR3byBvciBtb3JlIG51bWJlcnMKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwb3RlbnVzZSBnaXZlbiB0aG9zZSBudW1iZXJzLgogICAqLwogIGh5cG90LAoKICAvKioKICAgKiBUaGUgMzIgYml0IGludGVnZXIgbXVsdGlwbGljYXRpb24gZnVuY3Rpb24uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gYSBBbnkgMzIgYml0IGludGVnZXIKICAgKiBAcGFyYW0ge251bWJlcn0gYiBBbnkgMzIgYml0IGludGVnZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgMzIgYml0IGludGVnZXIgcmVzdWx0IG9mIGEgKiBiCiAgICovCiAgaW11bCwKCiAgLyoqCiAgICogVGhlIG5hdHVyYWwgbG9nYXJpdGhtIGZ1bmN0aW9uLCBpLmUuIHRoZSBiYXNlLUUgbG9nYXJpdGhtCiAgICoKICAgKiAoTm90ZSB0aGF0IGluIEpTIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkICJsb2ciIHJhdGhlciB0aGFuICJsbiIpCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBuYXR1cmFsIGxvZ2FyaXRobSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgRX0KICAgKiBAc2VlIHtAbGluayBsb2d9CiAgICovCiAgbG9nOiBsbiwKCiAgLyoqCiAgICogVGhlICJjb21tb24gbG9nYXJpdGhtIiBmdW5jdGlvbiwgaS5lLiB0aGUgYmFzZS0xMCBsb2dhcml0aG0uCiAgICoKICAgKiAoTm90ZSB0aGF0IGluIEpTIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkICJsb2cxMCIgcmF0aGVyIHRoYW4gImxvZyIpCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBjb21tb24gbG9nYXJpdGhtIG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBsbn0KICAgKi8KICBsb2cxMDogbG9nLAoKICAvKioKICAgKiBUaGUgYmluYXJ5IGxvZ2FyaXRobSBmdW5jdGlvbiwgaS5lLiB0aGUgYmFzZS0yIGxvZ2FyaXRobS4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGJhc2UgMiBsb2dhcml0aG0gb2YgdGhhdCBudW1iZXIKICAgKgogICAqIEBzZWUge0BsaW5rIGxufQogICAqIEBzZWUge0BsaW5rIGxvZ30KICAgKi8KICBsb2cyLAoKICAvKioKICAgKiBGaW5kIHRoZSBtYXhpbXVtIHZhbHVlIGluIGEgc2V0IG9mIG51bWJlcnMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSAuLi5pbnB1dCBBbnkgdHdvIG9yICBtb3JlIG51bWJlcnMKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaGlnaGVzdCB2YWx1ZWQgbnVtYmVyIGZyb20gYW1vbmcgdGhlIGlucHV0LgogICAqCiAgICogQHNlZSB7QGxpbmsgbWlufQogICAqLwogIG1heCwKCiAgLyoqCiAgICogRmluZCB0aGUgbWluaW11bSB2YWx1ZSBpbiBhIHNldCBvZiBudW1iZXJzCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gLi4uaW5wdXQgQW55IHR3byBvciAgbW9yZSBudW1iZXJzCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGxvd2VzdCB2YWx1ZWQgbnVtYmVyIGZyb20gYW1vbmcgdGhlIGlucHV0LgogICAqCiAgICogQHNlZSB7QGxpbmsgbWF4fQogICAqLwogIG1pbiwKCiAgLyoqCiAgICogVGhlIHBvd2VyIGZ1bmN0aW9uLgogICAqCiAgICogTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gaXMgYSBob2xkb3ZlciBmcm9tIGJlZm9yZSBKUwogICAqIGhhZCB0aGUgYCoqYCBvcGVyYXRvciBmb3IgcGVyZm9ybWluZyB0aGlzIGNhbGN1bGF0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGEgQW55IG51bWJlcgogICAqIEBwYXJhbSB7bnVtYmVyfSBiIEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfE5hTn0gb3V0cHV0IGEgKiogYiBvciBOYU4gaWYgdGhhdCBpcyB1bmRlZmluZWQKICAgKi8KICBwb3csCgogIC8qKgogICAqIFRoZSAicm91bmQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciIgZnVuY3Rpb24sIHJvdW5kaW5nIGFueQogICAqIHZhbHVlIFt4LjAsIHguNDk5OS4uLl0gdG8geCwgYW5kIGFueSB2YWx1ZSBbeC41LCB4Ljk5OS4uLl0KICAgKiB0byB4ICsgMS4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludGVnZXIgcmVzdWx0IGFmdGVyIHJvdW5kaW5nLgogICAqCiAgICogQHNlZSB7QGxpbmsgY2VpbH0KICAgKiBAc2VlIHtAbGluayBmbG9vcn0KICAgKi8KICByb3VuZCwKCiAgLyoqCiAgICogR2V0IHRoZSBzaWduIG9mIGEgbnVtYmVyCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9ICsxIGlmIHRoZSBudW1iZXIgd2FzIHBvc2l0aXZlLCAtMSBpZiBpdCB3YXMgbmVnYXRpdmUsIG9yIDAgaWYgdGhlIGlucHV0IHdhcyB6ZXJvLgogICAqLwogIHNpZ24sCgogIC8qKgogICAqIFRoZSBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBzaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBjb3N9CiAgICovCiAgc2luLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBoeXBlcmJvbGljIHNpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIHNpbn0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICBzaW5oLAoKICAvKioKICAgKiBUaGUgc3F1YXJlIHJvb3QgZnVuY3Rpb24uCiAgICoKICAgKgogICAqIE5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIGEgaG9sZG92ZXIgZnJvbSBiZWZvcmUgSlMKICAgKiBoYWQgdGhlIGAqKmAgb3BlcmF0b3IgZm9yIHBlcmZvcm1pbmcgdGhpcyBjYWxjdWxhdGlvbgogICAqIGJ5IHVzaW5nIGB4ICoqIDAuNWAuCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBzcXVhcmUgcm9vdCBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgY2JydH0KICAgKiBAc2VlIHtAbGluayBwb3d9CiAgICovCiAgc3FydCwKCiAgLyoqCiAgICogVGhlIHRhbmdlbnQgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIHRhbmdlbnQKICAgKi8KICB0YW4sCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIHRhbmdlbnQgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnNlX2h5cGVyYm9saWNfZnVuY3Rpb25zI0RlZmluaXRpb25zX2luX3Rlcm1zX29mX2xvZ2FyaXRobXMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGh5cGVyYm9saWMgdGFuZ2VudAogICAqCiAgICogQHNlZSB7QGxpbmsgdGFufQogICAqIEBzZWUge0BsaW5rIGFzaW5ofQogICAqIEBzZWUge0BsaW5rIGFjb3NofQogICAqLwogIHRhbmgsCgogIC8qKgogICAqIFRydW5jYXRlIGEgZnJhY3Rpb24gdG8gYW4gaW50ZWdlciBieSBzaW1wbHkgZHJvcHBpbmcgdGhlIGZyYWN0aW9uYWwgcGFydC4KICAgKiBOb3RlIHRoYXQgdGhpcyBkaWZmZXJzIGZyb20gdGhlIGBmbG9vcmAgZnVuY3Rpb246CiAgICoKICAgKiBgYGAKICAgKiBmbG9vcig0LjIpOyAgLy8gNAogICAqIGZsb29yKC00LjIpOyAvLyAtNQogICAqCiAgICogdHJ1bmMoNC4yKTsgIC8vIDQKICAgKiB0cnVuYygtNC4yKTsgLy8gLTQKICAgKiBgYGAKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludGVnZXIgcGFydCBvbmx5IG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBmbG9vcn0KICAgKi8KICB0cnVuYywKfSA9IE1hdGg7CgovKioKICogR2V0IHRoZSBiaW5vbWlhbCBjb2VmZmljaWVudCAobiBjaG9vc2UgaykuCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBuIEEgcG9zaXRpdmUgaW50ZWdlcgogKiBAcGFyYW0ge251bWJlcn0gayBBIHBvc2l0aXZlIGludGVnZXIgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIGBuYAogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgdmFsdWUgKG4gY2hvb3NlIGspCiAqLwpmdW5jdGlvbiBiaW5vbWlhbChuLCBrKSB7CiAgaWYgKG4gPT09IDApIHJldHVybiAxOwogIHZhciBsdXQgPSBfX2Jpbm9taWFsQ29lZmZpY2llbnRzOwogIHdoaWxlIChuID49IGx1dC5sZW5ndGgpIHsKICAgIHZhciBzID0gbHV0Lmxlbmd0aDsKICAgIHZhciBuZXh0Um93ID0gWzFdOwogICAgZm9yICh2YXIgaSA9IDEsIHByZXYgPSBzIC0gMTsgaSA8IHM7IGkrKykgewogICAgICBuZXh0Um93W2ldID0gbHV0W3ByZXZdW2kgLSAxXSArIGx1dFtwcmV2XVtpXTsKICAgIH0KICAgIG5leHRSb3dbc10gPSAxOwogICAgbHV0LnB1c2gobmV4dFJvdyk7CiAgfQogIHJldHVybiBsdXRbbl1ba107Cn0KCi8qKgogKiBDb25zdHJhaW4gYSBudW1iZXIgdG8gd2l0aGluIGEgZ2l2ZW4gcmFuZ2UuCiAqIFRoaXMgaXMgcmVhbGx5IG5vdGhpbmcgbW9yZSB0aGFuIGEgY29udmVuaWVudAogKiBmdW5jdGlvbiB3cmFwcGVyIGFyb3VuZCB0aGUgc3RhdGVtZW50OgogKgogKiBgYGAKICogdiA8IHMgPyBzIDogdiA+IGUgPyBlIDogdgogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb25zdHJhaW4KICogQHBhcmFtIHtudW1iZXJ9IGxvd2VyQm91bmQgVGhlIGxvd2VyIGJvdW5kIG9uIG91ciB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gdXBwZXJCb3VuZCBUaGUgdXBwZXIgYm91bmQgb24gb3VyIHZhbHVlCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSB2YWx1ZSwgaWYgaXQgZmFsbHMgd2l0aGluZyBbbG93ZXJCb3VuZCx1cHBlckJvdW5kXSwgb3RoZXJ3aXNlIG9uZSBvZiB0aG9zZSBib3VuZHMuCiAqCiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbk1hcH0KICovCmZ1bmN0aW9uIGNvbnN0cmFpbih2LCBzLCBlKSB7CiAgcmV0dXJuIHYgPCBzID8gcyA6IHYgPiBlID8gZSA6IHY7Cn0KCi8qKgogKiBUaGUgY29zZWNhbnQgZnVuY3Rpb24sIHdoaWNoIGlzOgogKgogKiBgYGAKICogMSAvIHNpbih2KQogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSBpbnB1dCB2YWx1ZSwgaW4gcmFkaWFucy4KICogQHJldHVybnMge251bWJlcn0gVGhlIGNvc2VjYW50IG9mIG91ciB2YWx1ZS4KICoKICogQHNlZSB7QGxpbmsgc2VjfQogKi8KZnVuY3Rpb24gY3NjKHYpIHsKICByZXR1cm4gMSAvIHNpbih2KTsKfQoKLyoqCiAqIFRoZSBjb3RhbmdlbnQgZnVuY3Rpb24sIHdoaWNoIGlzOgogKgogKiBgYGAKICogY29zKHYpIC8gc2luKHYpCiAqIGBgYAogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIGlucHV0IHZhbHVlLCBpbiByYWRpYW5zLgogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY290YW5nZW50IG9mIG91ciB2YWx1ZS4KICoKICogQHNlZSB7QGxpbmsgdGFufQogKi8KZnVuY3Rpb24gY3RuKHYpIHsKICByZXR1cm4gY29zKHYpIC8gc2luKHYpOwp9CgovKioKICogQ29udmVydCBhIG51bWJlciBpbiByYWRpYW5zIHRvIGEgbnVtYmVyIGluIGRlZ3JlZXMuCiAqIFRoaXMgaXMgcmVhbGx5IG5vdGhpbmcgbW9yZSB0aGFuIGEgY29udmVuaWVudAogKiBmdW5jdGlvbiB3cmFwcGVyIGFyb3VuZCB0aGUgc3RhdGVtZW50OgogKgogKiBgYGAKICogdi9QSSAqIDE4MAogKiBgYGAKICoKICogV2l0aCBvbmUgdHJpY2ssIGluIHRoYXQgaXQgYWxsb3dzIHlvdSB0byBjb25zdHJhaW4gdGhlCiAqIHJlc3VsdGFudCB2YWx1ZSB0byB0aGUgc3RhbmRhcmQgWzAsIDM2MF0gaW50ZXJ2YWwuCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29uc3RyYWluCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY29uc3RyYWluPyBBIGJvb2xlYW4gdGhhdCBkZXRlcm1pbmVzIHdoZXRoZXIgb3Igbm90IHRvIGNvbnN0cmFpbiB0aGUgcmVzdWx0YW50IHZhbHVlIHRvIFswLCAzNjBdIChkZWZhdWx0ID0gZmFsc2UpCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBkZWdyZWUgdmFsdWUgY29ycmVzcG9uZGluZyB0byB0aGUgaW5wdXQgdmFsdWUgaW4gcmFkaWFucywgb3B0aW9uYWxseSBjb25zdHJhaW5lZCB0byBbMCwgMzYwXQogKgogKiBAc2VlIHtAbGluayByYWRpYW5zfQogKiBAc2VlIHtAbGluayBjb25zdHJhaW59CiAqLwpmdW5jdGlvbiBkZWdyZWVzKHYsIGNvbnN0cmFpbiA9IGZhbHNlKSB7CiAgbGV0IGQgPSAodiAvIFBJKSAqIDE4MDsKICBpZiAoIWNvbnN0cmFpbikgcmV0dXJuIGQ7CiAgd2hpbGUgKGQgPCAwKSBkICs9IDM2MDsKICByZXR1cm4gZCAlIDM2MDsKfQoKLyoqCiAqIENhbGN1bGF0ZSB0aGUgMkQgRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gdHdvIHBvaW50cy4KICoKICogQHBhcmFtIHtudW1iZXJ9IHgxIFRoZSBmaXJzdCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkxIFRoZSBmaXJzdCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHgyIFRoZSBzZWNvbmQgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MiBUaGUgc2Vjb25kIHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgZXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gdGhlIHR3byBjb29yZGluYXRlcwogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDEgVGhlIGZpcnN0IHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDIgVGhlIHNlY29uZCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICogQHJldHVybnMge251bWJlcn0gVGhlIGV1Y2xpZGVhbiBkaXN0YW5jZSBiZXR3ZWVuIHRoZSB0d28gY29vcmRpbmF0ZXMKICovCmZ1bmN0aW9uIGRpc3QoeDEsIHkxLCB4MiwgeTIpIHsKICBpZiAoeDEueCAhPT0gdW5kZWZpbmVkICYmIHgxLnkgIT09IHVuZGVmaW5lZCkgewogICAgeTIgPSB5MS55OwogICAgeDIgPSB5MS54OwogICAgeTEgPSB4MS55OwogICAgeDEgPSB4MS55OwogIH0KICBjb25zdCBkeCA9IHgyIC0geDE7CiAgY29uc3QgZHkgPSB5MiAtIHkxOwogIHJldHVybiBoeXBvdChkeCwgZHkpOwp9CgovKioKICogUGVyZm9ybXMgYSBsaW5lL2xpbmUgaW50ZXJzZWN0aW9uIHRlc3QgZ2l2ZSBlaXRoZXIgZm91ciBwb2ludHMKICogZGVmaW5pbmcgdGhlIGxpbmVzIChwMS0tcDIpIGFuZCAocDMtLXA0KSwgb3IgZWlnaHQgY29vcmRpbmF0ZXMKICogc3Bhbm5pbmcgbGluZXMgKHgxLHkxKS0tKHgyLHkyKSBhbmQgKHgzLHkzKS0tKHg0LHk0KS4KICoKICogVGhpcyBmdW5jdGlvbiBjb3ZlcnMgYm90aCAibGluZS9saW5lIiBhbmQgInNlZ21lbnQiLyJzZWdtZW50IgogKiB0ZXN0aW5nIGJ5IHNldHRpbmcgYSBib29sZWFuIHZhbHVlIGBpbkJvdW5kc2Agb24gdGhlIHJlc3VsdDoKICogd2hlbiBmYWxzZSwgdGhlcmUgaXMgb25seSBhIGxpbmUvbGluZSBpbnRlcnNlY3Rpb24sIGJ1dCB3aGVuCiAqIHRydWUsIHRoZSBhY3R1YWwgbGluZSBzZWdtZW50cyBpbnRlcnNlY3QuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBjZW50ZXIoKTsKICogICAgICAgLy8gLi4uY29kZSBnb2VzIGhlcmUuLi4KICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geDEgVGhlIGZpcnN0IHBvaW50J3MgeCBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MSBUaGUgZmlyc3QgcG9pbnQncyB5IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHgyIFRoZSBzZWNvbmQgcG9pbnQncyB4IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHkyIFRoZSBzZWNvbmQgcG9pbnQncyB5IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHgzIFRoZSB0aGlyZCBwb2ludCdzIHggY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0geTMgVGhlIHRoaXJkIHBvaW50J3MgeSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB4NCBUaGUgZm91cnRoIHBvaW50J3MgeCBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB5NCBUaGUgZm91cnRoIHBvaW50J3MgeSBjb29yZGluYXRlCiAqIEByZXR1cm5zIHtQb2ludExpa2V8ZmFsc2V9IEVpdGhlciB0aGUgaW50ZXJzZWN0aW9uIHBvaW50LCBvciBmYWxzZSBpZiB0aGVyZSBpcyBubyBpbnRlcnNlY3Rpb24KICoKICogQHBhcmFtIHtQb2ludExpbmV9IHAxIFRoZSBmaXJzdCBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaW5lfSBwMiBUaGUgc2Vjb25kIGNvb3JkaW5hdGUKICogQHBhcmFtIHtQb2ludExpbmV9IHAzIFRoZSB0aGlyZCBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaW5lfSBwNCBUaGUgZm91cnRoIGNvb3JkaW5hdGUKICogQHJldHVybnMge1BvaW50TGlrZXxmYWxzZX0gRWl0aGVyIHRoZSBpbnRlcnNlY3Rpb24gcG9pbnQsIG9yIGZhbHNlIGlmIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbgogKi8KZnVuY3Rpb24gbGxpKHgxLCB5MSwgeDIsIHkyLCB4MywgeTMsIHg0LCB5NCkgewogIGlmICh4MS54ICE9PSB1bmRlZmluZWQgJiYgeDEueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5NCA9IHkyLnk7CiAgICB4NCA9IHkyLng7CiAgICB5MyA9IHgyLnk7CiAgICB4MyA9IHgyLng7CiAgICB5MiA9IHkxLnk7CiAgICB4MiA9IHkxLng7CiAgICB5MSA9IHgxLnk7CiAgICB4MSA9IHgxLng7CiAgfQogIGNvbnN0IG54ID0gKHgxICogeTIgLSB5MSAqIHgyKSAqICh4MyAtIHg0KSAtICh4MSAtIHgyKSAqICh4MyAqIHk0IC0geTMgKiB4NCk7CiAgY29uc3QgbnkgPSAoeDEgKiB5MiAtIHkxICogeDIpICogKHkzIC0geTQpIC0gKHkxIC0geTIpICogKHgzICogeTQgLSB5MyAqIHg0KTsKICBjb25zdCBkID0gKHgxIC0geDIpICogKHkzIC0geTQpIC0gKHkxIC0geTIpICogKHgzIC0geDQpOwoKICBpZiAoZCA9PT0gMCkgcmV0dXJuIGZhbHNlOwoKICBjb25zdCByID0geyB4OiBueCAvIGQsIHk6IG55IC8gZCwgaW5Cb3VuZHM6IHRydWUgfTsKICBsZXQgYSA9IHgxOwogIGxldCBiID0geDI7CiAgaWYgKHgxID4geDIpIHsKICAgIGEgPSB4MjsKICAgIGIgPSB4MTsKICB9CiAgaWYgKHIueCA8IGEgfHwgci54ID4gYikgci5pbkJvdW5kcyA9IGZhbHNlOwogIGVsc2UgewogICAgYSA9IHkxOwogICAgYiA9IHkyOwogICAgaWYgKHkxID4geTIpIHsKICAgICAgYSA9IHkyOwogICAgICBiID0geTE7CiAgICB9CiAgICBpZiAoci55IDwgYSB8fCByLnkgPiBiKSByLmluQm91bmRzID0gZmFsc2U7CiAgICBlbHNlIHsKICAgICAgYSA9IHgzOwogICAgICBiID0geDQ7CiAgICAgIGlmICh4MyA+IHg0KSB7CiAgICAgICAgYSA9IHg0OwogICAgICAgIGIgPSB4MzsKICAgICAgfQogICAgICBpZiAoci54IDwgYSB8fCByLnggPiBiKSByLmluQm91bmRzID0gZmFsc2U7CiAgICAgIGVsc2UgewogICAgICAgIGEgPSB5MzsKICAgICAgICBiID0geTQ7CiAgICAgICAgaWYgKHkzID4geTQpIHsKICAgICAgICAgIGEgPSB5NDsKICAgICAgICAgIGIgPSB5MzsKICAgICAgICB9CiAgICAgICAgaWYgKHIueSA8IGEgfHwgci55ID4gYikgci5pbkJvdW5kcyA9IGZhbHNlOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiByOwp9CgovKioKICogTWFwIGEgdmFsdWUgZnJvbSBvbmUgaW50ZXJ2YWwgdG8gYW5vdGhlciwgb3B0aW9uYWxseQogKiBjb25zdHJhaW5lZCB0byB0aGUgdGFyZ2V0IGludGVydmFsLgogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgT3VyIGlucHV0IHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSBvcmlnaW5hbFN0YXJ0IFRoZSBsb3dlciBib3VuZCBvZiBvdXIgZG9tYWluCiAqIEBwYXJhbSB7bnVtYmVyfSBvcmlnaW5hbEVuZCBUaGUgdXBwZXIgYm91bmQgb2Ygb3VyIGRvbWFpbgogKiBAcGFyYW0ge251bWJlcn0gbmV3U3RhcnQgVGhlIGxvd2VyIGJvdW5kIG9mIG91ciB0YXJnZXQgaW50ZXJ2YWwKICogQHBhcmFtIHtudW1iZXJ9IG5ld0VuZCBUaGUgdXBwZXIgYm91bmQgb24gb3VyIHRhcmdldCBpbnRlcnZhbAogKiBAcGFyYW0ge2Jvb2xlYW59IGNvbnN0cmFpbj8gIEEgYm9vbGVhbiB0aGF0IGRldGVybWluZXMgd2hldGhlciBvciBub3QgdG8gY29uc3RyYWluIHRoZSByZXN1bHRhbnQgdmFsdWUgdG8gW25ld1N0YXJ0LG5ld0VuZF0gKGRlZmF1bHQgPSBmYWxzZSkKICogQHJldHVybnMge251bWJlcn0gVGhlIHJlc3VsdCBvZiBtYXBwaW5nIG91ciB2YWx1ZSBmcm9tIG91ciBkb21haW4gaW50ZXJ2YWwgdG8gb3VyIHRhcmdldCBpbnRlcnZhbCwgb3B0aW9uYWxseSBjb25zdHJhaW5lZCB0byB0aGUgdGFyZ2V0IGludGVydmFsLgogKgogKiBAc2VlIHtAbGluayBjb25zdHJhaW59CiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbk1hcH0KICovCmZ1bmN0aW9uIG1hcCh2LCBzLCBlLCBucywgbmUsIGNvbnN0cmFpbmVkID0gZmFsc2UpIHsKICBjb25zdCBpMSA9IGUgLSBzLAogICAgaTIgPSBuZSAtIG5zLAogICAgcCA9IHYgLSBzOwogIGxldCByID0gbnMgKyAocCAqIGkyKSAvIGkxOwogIGlmIChjb25zdHJhaW5lZCkgcmV0dXJuIGNvbnN0cmFpbihyLCBucywgbmUpOwogIHJldHVybiByOwp9CgovKioKICogQ29udmVydCBhIG51bWJlciBpbiBkZWdyZWVzIHRvIGEgbnVtYmVyIGluIHJhZGlhbnMuCiAqIFRoaXMgaXMgcmVhbGx5IG5vdGhpbmcgbW9yZSB0aGFuIGEgY29udmVuaWVudAogKiBmdW5jdGlvbiB3cmFwcGVyIGFyb3VuZCB0aGUgc3RhdGVtZW50OgogKgogKiBgYGAKICogdi8xODAgKiBQSQogKiBgYGAKICoKICogV2l0aCBvbmUgdHJpY2ssIGluIHRoYXQgaXQgYWxsb3dzIHlvdSB0byBjb25zdHJhaW4gdGhlCiAqIHJlc3VsdGFudCB2YWx1ZSB0byB0aGUgc3RhbmRhcmQgWzAsIFRBVV0gaW50ZXJ2YWwuCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29uc3RyYWluCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY29uc3RyYWluPyBBIGJvb2xlYW4gdGhhdCBkZXRlcm1pbmVzIHdoZXRoZXIgb3Igbm90IHRvIGNvbnN0cmFpbiB0aGUgcmVzdWx0YW50IHZhbHVlIHRvIFswLCBUQVVdIChkZWZhdWx0ID0gZmFsc2UpCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSByYWRpYW5zIHZhbHVlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGlucHV0IHZhbHVlIGluIGRlZ3JlZXMsIG9wdGlvbmFsbHkgY29uc3RyYWluZWQgdG8gWzAsIFRBVV0KICoKICogQHNlZSB7QGxpbmsgZGVncmVlc30KICogQHNlZSB7QGxpbmsgY29uc3RyYWlufQogKi8KZnVuY3Rpb24gcmFkaWFucyh2LCBjb25zdHJhaW4gPSBmYWxzZSkgewogIGxldCByID0gKHYgLyAxODApICogUEk7CiAgaWYgKCFjb25zdHJhaW4pIHJldHVybiByOwogIHdoaWxlIChyIDwgMCkgciArPSBUQVU7CiAgcmV0dXJuIHIgJSBUQVU7Cn0KCi8qKgogKiBHZW5lcmF0ZSBhIHBzZXVkby1yYW5kb20gbnVtYmVyLgogKgogKiBUaGlzIGlzIGJhc2VkIG9uIHRoZSBTcGxpdE1peDMyIGFsZ29yaXRobSwgY292ZXJlZAogKiBvdmVyIG9uIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS80NzU5MzMxNi83NDA1NTMKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjApOwogKiAgICAgICByYW5nZSgwLCBoZWlnaHQgKyAyMCwgMjAsICh2KSA9PiB7CiAqICAgICAgICAgdGV4dChyYW5kb20oKSwgNSwgdik7CiAqICAgICAgIH0pCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICoKICoKICogQHJldHVybnMge251bWJlcn0gQSByYW5kb20gbnVtYmVyIGluIHRoZSBpbnRlcnZhbCBbMCwxKQogKgogKiBAcGFyYW0ge251bWJlcn0gYSBUaGUgdXBwZXIgYm91bmQgZm9yIHRoZSByYW5kb20gbnVtYmVyCiAqIEByZXR1cm5zIHtudW1iZXJ9IEEgcmFuZG9tIG51bWJlciBpbiB0aGUgaW50ZXJ2YWwgWzAsYSkKICoKICogQHBhcmFtIHtudW1iZXJ9IGEgVGhlIGxvd2VyIGJvdW5kIGZvciB0aGUgcmFuZG9tIG51bWJlcgogKiBAcGFyYW0ge251bWJlcn0gYiBUaGUgdXBwZXIgYm91bmQgZm9yIHRoZSByYW5kb20gbnVtYmVyCiAqIEByZXR1cm5zIHtudW1iZXJ9IEEgcmFuZG9tIG51bWJlciBpbiB0aGUgaW50ZXJ2YWwgW2EsIGIpCiAqCiAqIEBzZWUge0BsaW5rIHJhbmRvbVNlZWR9CiAqLwpmdW5jdGlvbiByYW5kb20oYSA9IDEsIGIpIHsKICBjb25zdCByID0gX19wcm5nLm5leHQoKTsKICBpZiAoYiA9PT0gdW5kZWZpbmVkKSByZXR1cm4gYSAqIHI7CiAgcmV0dXJuIGEgKyByICogKGIgLSBhKTsKfQoKLyoqCiAqIFNldCB0aGUgcHNldWRvLXJhbmRvbSBudW1iZXIgZ2VuZXJhdG9yIHNlZWQuIElmIG5vIHNlZWQKICogdmFsdWUgaXMgcHJvdmlkZWQsIHRoaXMgaXMgZXF1aXZhbGVudCB0byBjYWxsaW5nOgogKgogKiBgYGAKICogcmFuZG9tU2VlZChEYXRlLm5vdygpICogTWF0aC5yYW5kb20oKSkKICogYGBgCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBzZWVkPyBUaGUgcmFuZG9tIHNlZWQgdmFsdWUuCiAqCiAqIEBzZWUge0BsaW5rIHJhbmRvbX0KICovCmZ1bmN0aW9uIHJhbmRvbVNlZWQoc2VlZCA9IERhdGUubm93KCkgKiBNYXRoLnJhbmRvbSgpKSB7CiAgX19wcm5nLnJlc2VlZChzZWVkKTsKfQoKLyoqCiAqIFRoZSBzZWNhbnQgZnVuY3Rpb24sIHdoaWNoIGlzOgogKgogKiBgYGAKICogMSAvIGNvcyh2KQogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSBpbnB1dCB2YWx1ZSwgaW4gcmFkaWFucy4KICogQHJldHVybnMge251bWJlcn0gVGhlIHNlY2FudCBvZiBvdXIgdmFsdWUuCiAqCiAqIEBzZWUge0BsaW5rIGNzY30KICovCmZ1bmN0aW9uIHNlYyh2KSB7CiAgcmV0dXJuIDEgLyBjb3Modik7Cn0KLyoqCiAqIEludmVydCBhIG1hdHJpeCwgb3IgdW5kZWZpbmVkIGlmIHRoZSBtYXRyaXggaXMgbm90IGludmVydGlibGUuCiAqCiAqIEBwYXJhbSB7TWF0cml4fSBNIFRoZSBtYXRyaXggdG8gaW52ZXJ0CiAqIEByZXR1cm5zIHtudW1iZXJbXVtdfSBUaGUgbWF0cml4IGludmVyc2UgYXMgMkQgbnVtYmVyIGFycmF5CiAqLwpmdW5jdGlvbiBpbnZlcnRNYXRyaXgoTSkgewogIC8vIENvcGllZCBmcm9tIGh0dHA6Ly9ibG9nLmFjaXBvLmNvbS9tYXRyaXgtaW52ZXJzaW9uLWluLWphdmFzY3JpcHQvCiAgLy8gV2l0aCBwZXJtaXNzaW9uLCBodHRwOi8vYmxvZy5hY2lwby5jb20vbWF0cml4LWludmVyc2lvbi1pbi1qYXZhc2NyaXB0LyNjb21tZW50LTUwNTcyODk4ODkKCiAgLy8gKDEpICdhdWdtZW50JyB0aGUgbWF0cml4IChsZWZ0KSBieSB0aGUgaWRlbnRpdHkgKG9uIHRoZSByaWdodCkKICAvLyAoMikgVHVybiB0aGUgbWF0cml4IG9uIHRoZSBsZWZ0IGludG8gdGhlIGlkZW50aXR5IGJ5IGVsZW1ldHJ5IHJvdyBvcHMKICAvLyAoMykgVGhlIG1hdHJpeCBvbiB0aGUgcmlnaHQgaXMgdGhlIGludmVyc2UgKHdhcyB0aGUgaWRlbnRpdHkgbWF0cml4KQogIC8vIFRoZXJlIGFyZSAzIGVsZW10YXJ5IHJvdyBvcHM6CiAgLy8gKGEpIFN3YXAgMiByb3dzCiAgLy8gKGIpIE11bHRpcGx5IGEgcm93IGJ5IGEgc2NhbGFyCiAgLy8gKGMpIEFkZCAyIHJvd3MKCiAgLy8gaWYgdGhlIG1hdHJpeCBpc24ndCBzcXVhcmU6IGV4aXQgKGVycm9yKQogIGlmIChNLmxlbmd0aCAhPT0gTVswXS5sZW5ndGgpIHsKICAgIGNvbnNvbGUud2FybigiQ2Fubm90IGludmVydCBub24tc3F1YXJlIG1hdHJpY2VzIik7CiAgICByZXR1cm47CiAgfQoKICAvLyBjcmVhdGUgdGhlIGlkZW50aXR5IG1hdHJpeCAoSSksIGFuZCBhIGNvcHkgKEMpIG9mIHRoZSBvcmlnaW5hbAogIHZhciBpID0gMCwKICAgIGlpID0gMCwKICAgIGogPSAwLAogICAgZGltID0gTS5sZW5ndGgsCiAgICBlID0gMCwKICAgIHQgPSAwOwogIHZhciBJID0gW10sCiAgICBDID0gW107CiAgZm9yIChpID0gMDsgaSA8IGRpbTsgaSArPSAxKSB7CiAgICAvLyBDcmVhdGUgdGhlIHJvdwogICAgSVtJLmxlbmd0aF0gPSBbXTsKICAgIENbQy5sZW5ndGhdID0gW107CiAgICBmb3IgKGogPSAwOyBqIDwgZGltOyBqICs9IDEpIHsKICAgICAgLy9pZiB3ZSdyZSBvbiB0aGUgZGlhZ29uYWwsIHB1dCBhIDEgKGZvciBpZGVudGl0eSkKICAgICAgaWYgKGkgPT0gaikgewogICAgICAgIElbaV1bal0gPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIElbaV1bal0gPSAwOwogICAgICB9CgogICAgICAvLyBBbHNvLCBtYWtlIHRoZSBjb3B5IG9mIHRoZSBvcmlnaW5hbAogICAgICBDW2ldW2pdID0gTVtpXVtqXTsKICAgIH0KICB9CgogIC8vIFBlcmZvcm0gZWxlbWVudGFyeSByb3cgb3BlcmF0aW9ucwogIGZvciAoaSA9IDA7IGkgPCBkaW07IGkgKz0gMSkgewogICAgLy8gZ2V0IHRoZSBlbGVtZW50IGUgb24gdGhlIGRpYWdvbmFsCiAgICBlID0gQ1tpXVtpXTsKCiAgICAvLyBpZiB3ZSBoYXZlIGEgMCBvbiB0aGUgZGlhZ29uYWwgKHdlJ2xsIG5lZWQgdG8gc3dhcCB3aXRoIGEgbG93ZXIgcm93KQogICAgaWYgKGUgPT0gMCkgewogICAgICAvL2xvb2sgdGhyb3VnaCBldmVyeSByb3cgYmVsb3cgdGhlIGkndGggcm93CiAgICAgIGZvciAoaWkgPSBpICsgMTsgaWkgPCBkaW07IGlpICs9IDEpIHsKICAgICAgICAvL2lmIHRoZSBpaSd0aCByb3cgaGFzIGEgbm9uLTAgaW4gdGhlIGkndGggY29sCiAgICAgICAgaWYgKENbaWldW2ldICE9IDApIHsKICAgICAgICAgIC8vaXQgd291bGQgbWFrZSB0aGUgZGlhZ29uYWwgaGF2ZSBhIG5vbi0wIHNvIHN3YXAgaXQKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBkaW07IGorKykgewogICAgICAgICAgICBlID0gQ1tpXVtqXTsgLy90ZW1wIHN0b3JlIGkndGggcm93CiAgICAgICAgICAgIENbaV1bal0gPSBDW2lpXVtqXTsgLy9yZXBsYWNlIGkndGggcm93IGJ5IGlpJ3RoCiAgICAgICAgICAgIENbaWldW2pdID0gZTsgLy9yZXBhY2UgaWkndGggYnkgdGVtcAogICAgICAgICAgICBlID0gSVtpXVtqXTsgLy90ZW1wIHN0b3JlIGkndGggcm93CiAgICAgICAgICAgIElbaV1bal0gPSBJW2lpXVtqXTsgLy9yZXBsYWNlIGkndGggcm93IGJ5IGlpJ3RoCiAgICAgICAgICAgIElbaWldW2pdID0gZTsgLy9yZXBhY2UgaWkndGggYnkgdGVtcAogICAgICAgICAgfQogICAgICAgICAgLy9kb24ndCBib3RoZXIgY2hlY2tpbmcgb3RoZXIgcm93cyBzaW5jZSB3ZSd2ZSBzd2FwcGVkCiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy9nZXQgdGhlIG5ldyBkaWFnb25hbAogICAgICBlID0gQ1tpXVtpXTsKICAgICAgLy9pZiBpdCdzIHN0aWxsIDAsIG5vdCBpbnZlcnRpYmxlIChlcnJvcikKICAgICAgaWYgKGUgPT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQoKICAgIC8vIFNjYWxlIHRoaXMgcm93IGRvd24gYnkgZSAoc28gd2UgaGF2ZSBhIDEgb24gdGhlIGRpYWdvbmFsKQogICAgZm9yIChqID0gMDsgaiA8IGRpbTsgaisrKSB7CiAgICAgIENbaV1bal0gPSBDW2ldW2pdIC8gZTsgLy9hcHBseSB0byBvcmlnaW5hbCBtYXRyaXgKICAgICAgSVtpXVtqXSA9IElbaV1bal0gLyBlOyAvL2FwcGx5IHRvIGlkZW50aXR5CiAgICB9CgogICAgLy8gU3VidHJhY3QgdGhpcyByb3cgKHNjYWxlZCBhcHByb3ByaWF0ZWx5IGZvciBlYWNoIHJvdykgZnJvbSBBTEwgb2YKICAgIC8vIHRoZSBvdGhlciByb3dzIHNvIHRoYXQgdGhlcmUgd2lsbCBiZSAwJ3MgaW4gdGhpcyBjb2x1bW4gaW4gdGhlCiAgICAvLyByb3dzIGFib3ZlIGFuZCBiZWxvdyB0aGlzIG9uZQogICAgZm9yIChpaSA9IDA7IGlpIDwgZGltOyBpaSsrKSB7CiAgICAgIC8vIE9ubHkgYXBwbHkgdG8gb3RoZXIgcm93cyAod2Ugd2FudCBhIDEgb24gdGhlIGRpYWdvbmFsKQogICAgICBpZiAoaWkgPT0gaSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICAvLyBXZSB3YW50IHRvIGNoYW5nZSB0aGlzIGVsZW1lbnQgdG8gMAogICAgICBlID0gQ1tpaV1baV07CgogICAgICAvLyBTdWJ0cmFjdCAodGhlIHJvdyBhYm92ZShvciBiZWxvdykgc2NhbGVkIGJ5IGUpIGZyb20gKHRoZQogICAgICAvLyBjdXJyZW50IHJvdykgYnV0IHN0YXJ0IGF0IHRoZSBpJ3RoIGNvbHVtbiBhbmQgYXNzdW1lIGFsbCB0aGUKICAgICAgLy8gc3R1ZmYgbGVmdCBvZiBkaWFnb25hbCBpcyAwICh3aGljaCBpdCBzaG91bGQgYmUgaWYgd2UgbWFkZSB0aGlzCiAgICAgIC8vIGFsZ29yaXRobSBjb3JyZWN0bHkpCiAgICAgIGZvciAoaiA9IDA7IGogPCBkaW07IGorKykgewogICAgICAgIENbaWldW2pdIC09IGUgKiBDW2ldW2pdOyAvL2FwcGx5IHRvIG9yaWdpbmFsIG1hdHJpeAogICAgICAgIElbaWldW2pdIC09IGUgKiBJW2ldW2pdOyAvL2FwcGx5IHRvIGlkZW50aXR5CiAgICAgIH0KICAgIH0KICB9CgogIC8vd2UndmUgZG9uZSBhbGwgb3BlcmF0aW9ucywgQyBzaG91bGQgYmUgdGhlIGlkZW50aXR5CiAgLy9tYXRyaXggSSBzaG91bGQgYmUgdGhlIGludmVyc2U6CiAgcmV0dXJuIEk7Cn0KCi8qKgogKiBNdWx0aXBseSB0d28gbWF0cmljZXMKICoKICogQHBhcmFtIHtNYXRyaXh9IG0xCiAqIEBwYXJhbSB7TWF0cml4fSBtMgogKiBAcmV0dXJucyB7bnVtYmVyW11bXX0gVGhlIHJlc3VsdCBvZiBtMSAqIG0yICBhcyAyRCBudW1iZXIgYXJyYXkKICovCmZ1bmN0aW9uIG11bHRpcGx5TWF0cml4KG0xLCBtMikgewogIHZhciBNID0gW107CiAgdmFyIG0ydCA9IHRyYW5zcG9zZU1hdHJpeChtMik7CiAgbTEuZm9yRWFjaCgocm93LCByKSA9PiB7CiAgICBNW3JdID0gW107CiAgICBtMnQuZm9yRWFjaCgoY29sLCBjKSA9PiB7CiAgICAgIE1bcl1bY10gPSByb3cubWFwKCh2LCBpKSA9PiBjb2xbaV0gKiB2KS5yZWR1Y2UoKGEsIHYpID0+IGEgKyB2LCAwKTsKICAgIH0pOwogIH0pOwogIHJldHVybiBNOwp9CgovKioKICogVHJhbnNwb3NlIGEgbWF0cml4CiAqCiAqIEBwYXJhbSB7TWF0cml4fSBNIFRoZSBtYXRyaXggdG8gdHJhbnNwb3NlCiAqIEByZXR1cm5zIHtudW1iZXJbXVtdfSBUaGUgbWF0cml4IHRyYW5zcG9zZSBhcyAyRCBudW1iZXIgYXJyYXkKICovCmZ1bmN0aW9uIHRyYW5zcG9zZU1hdHJpeChNKSB7CiAgcmV0dXJuIE1bMF0ubWFwKChjb2wsIGkpID0+IE0ubWFwKChyb3cpID0+IHJvd1tpXSkpOwp9Ci8qKgogKiBQcm9qZWN0IGEgM0QgY29vcmRpbmF0ZSB0byAyRC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgNTAsIC0wLjQpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIC0xLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAtMSksIHByb2plY3QoMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgMSwgMSksIHByb2plY3QoLTEsIC0xLCAxKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIDNEIGNvb3JkaW5hdGUncyB4IHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSAzRCBjb29yZGluYXRlJ3MgeCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geiBUaGUgM0QgY29vcmRpbmF0ZSdzIHggdmFsdWUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCAgVGhlIHByb2plY3RlZCAyRCB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSAyRCBjb29yZGluYXRlIGFzIHt4LHksen0gY29vcmRpbmF0ZQogKiBAcmV0dXJucyB7UG9pbnRMaWtlfSBwICBUaGUgcHJvamVjdGVkIDJEIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgc2V0UHJvamVjdG9yfQogKi8KZnVuY3Rpb24gcHJvamVjdCh4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkICYmIHgueiAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIHJldHVybiBfX3Byb2plY3Rvci5wcm9qZWN0KHgsIHksIHopOwp9CgovKioKICogU2V0IHRoZSBwcm9qZWN0b3IncyB4LCB5LCBhbmQgeiBheGlzIHJvdGF0aW9uCiAqIGluIHJhZGlhbnMuIE5vdGUgdGhhdCB0aGVzZSBhcmUgYXBwbGllZCBpbiBvcmRlci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgNTAsIC0wLjQpOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgY29uc3QgbSA9IG1pbGxpcygpIC8gNTAwMDsKICogICAgICAgcm90YXRlUHJvamVjdG9yKG0sIDIgKiBtLCAzICogbSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIC0xLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAtMSksIHByb2plY3QoMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgMSwgMSksIHByb2plY3QoLTEsIC0xLCAxKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGFuZ2xlIG9mIHJvdGF0aW9uIG92ZXIgdGhlIHggYXhpcyBpbiByYWRpYW5zCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBhbmdsZSBvZiByb3RhdGlvbiBvdmVyIHRoZSB5IGF4aXMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0geiBUaGUgYW5nbGUgb2Ygcm90YXRpb24gb3ZlciB0aGUgeiBheGlzIGluIHJhZGlhbnMKICoKICogQHNlZSB7QGxpbmsgcHJvamVjdH0KICovCmZ1bmN0aW9uIHJvdGF0ZVByb2plY3Rvcih4LCB5LCB6KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkICYmIHgueiAhPT0gdW5kZWZpbmVkKSB7CiAgICB6ID0geC56OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIF9fcHJvamVjdG9yLnNldFJvdGF0aW9uKHgsIHksIHopOwp9CgovKioKICogU2V0IHRoZSBwcm9qZWN0IHBhcmFtZXRlcnMuIEN1cnJlbnRseSwgb25seQogKiBjYWJpbmV0IHByb2plY3QgaXMgc3VwcG9ydGVkLCB3aGljaCBhY2NlcHRzCiAqIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0UHJvamVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgNTAsIC0wLjQpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIC0xLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgLTEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIDEsIDEpKTsKICogICAgICAgc2V0Q29sb3IoYGdyZWVuYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAtMSksIHByb2plY3QoMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgxLCAxLCAxKSwgcHJvamVjdCgxLCAtMSwgMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIC0xKSk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgMSwgMSksIHByb2plY3QoLTEsIC0xLCAxKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtICB7bnVtYmVyfSB4T2Zmc2V0IG9mIHRoZSBwcm9qZWN0aW9uIHdydCB0aGUgY2FudmFzIChkZWZhdWx0ID0gMCkKICogQHBhcmFtICB7bnVtYmVyfSB5T2Zmc2V0IG9mIHRoZSBwcm9qZWN0aW9uIHdydCB0aGUgY2FudmFzIChkZWZhdWx0ID0gMCkKICogQHBhcmFtICB7bnVtYmVyfSBzY2FsZSBmYWN0b3IgZm9yIHRoZSAzRCBpbnB1dCAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSAge251bWJlcn0gY2FiaW5ldCBhbmdsZSBpbiByYWRpYW5zIChkZWZhdWx0ID0gLXBpLzYpCiAqCiAqIEBzZWUge0BsaW5rIHByb2plY3R9CiAqLwpmdW5jdGlvbiBzZXRQcm9qZWN0b3IoLi4uYXJncykgewogIF9fcHJvamVjdG9yLnVwZGF0ZSguLi5hcmdzKTsKfQovKioKICogU2V0IGEgYm9yZGVyIGFyb3VuZCB0aGUgY2FudmFzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRCb3JkZXIoMTAsIGByZWRgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcnxib29sZWFufSB3aWR0aD8gVGhlIHdpZHRoIG9mIHRoZSBib3JkZXIgaW4gcGl4ZWxzLCBkaXNhYmxpbmcgdGhlIGJvcmRlciBvbWl0dGVkCiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvcj8gVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBibGFjaykKICoKICogQHNlZSB7QGxpbmsgbm9Cb3JkZXJ9CiAqLwpmdW5jdGlvbiBzZXRCb3JkZXIod2lkdGggPSAxLCBjb2xvciA9IGBibGFja2ApIHsKICBpZiAoIXdpZHRoKSB7CiAgICBfX2NhbnZhcy5zdHlsZS5ib3JkZXIgPSBgbm9uZWA7CiAgfSBlbHNlIHsKICAgIF9fY2FudmFzLnN0eWxlLmJvcmRlciA9IGAke3dpZHRofXB4IHNvbGlkICR7Y29sb3J9YDsKICB9Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgc3Ryb2tlIGFuZCBmaWxsIGNvbG91ciBhdAogKiB0aGUgc2FtZSB0aW1lLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIKICoKICogQHNlZSB7QGxpbmsgc2V0U3Ryb2tlfQogKiBAc2VlIHtAbGluayBzZXRGaWxsfQogKiBAc2VlIHtAbGluayBub0NvbG9yfQogKi8KZnVuY3Rpb24gc2V0Q29sb3IoY29sb3IpIHsKICBzZXRGaWxsKGNvbG9yKTsKICBzZXRTdHJva2UoY29sb3IpOwp9CgovKioKICogQ2hhbmdlIHRoZSBjdXJzb3IgdG8gYSBzcGVjaWZpYyBpY29uOgogKgogKiAtIEFVVE8gLSB1c2Ugd2hhdGV2ZXIgdGhlIGJyb3dzZXIgd291bGQgb3RoZXJ3aXNlIHVzZQogKiAtIENST1NTIC0gdXNlIGEgY3Jvc3MtaGFpciBpY29uCiAqIC0gUE9JTlRFUiAtIHVzZSB0aGUgInBvaW50ZXIiIGljb24gdGhhdCBpcyBhbHNvIHVzZWQgZm9yIGNsaWNrYWJsZSBsaW5rcwogKgogKiBVc2UgYW55IG90aGVyIHN0cmluZyBmb3VuZCBvdmVyIG9uIHRoZSBNRE4gY3Vyc29yIGFydGljbGUgdG8gc2V0IGEgY3Vyc29yIG5vdCBjb3ZlcmVkIGJ5IHRoZSBhYm92ZSBjb25zdGFudHMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYCNGRjAyYCk7CiAqICAgICAgIHJlY3QoMCwgMCwgd2lkdGgvMiwgaGVpZ2h0KTsKICogICAgICAgc2V0Q29sb3IoYCMwRkYyYCk7CiAqICAgICAgIHJlY3Qod2lkdGgvMiwgMCwgd2lkdGgvMiwgaGVpZ2h0KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJNb3ZlKHgsIHkpIHsKICogICAgICAgaWYgKHggPCB3aWR0aC8yKSB7CiAqICAgICAgICAgc2V0Q3Vyc29yKEFVVE8pOwogKiAgICAgICB9IGVsc2UgewogKiAgICAgICAgIG5vQ3Vyc29yKCk7CiAqICAgICAgIH0KICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBUaGUgQ1NTIGN1cnNvciB0eXBlCiAqCiAqIEBzZWUge0BsaW5rIG5vQ3Vyc29yfQogKi8KZnVuY3Rpb24gc2V0Q3Vyc29yKHR5cGUpIHsKICBfX2N1cnJlbnRfY3Vyc29yID0gdHlwZTsKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBfX2N1cnJlbnRfY3Vyc29yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZpbGwgY29sb3VyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBibGFjaykKICoKICogQHNlZSB7QGxpbmsgbm9GaWxsfQogKi8KZnVuY3Rpb24gc2V0RmlsbChjb2xvciA9IGBibGFja2ApIHsKICBpZiAoQ1NTX0NPTE9SX01BUFtjb2xvcl0gPT09IF9faGlnaGxpZ2h0X2NvbG9yKSB7CiAgICBjb2xvciA9IF9fY3VycmVudF9oaWdobGlnaHRfY29sb3I7CiAgfQogIF9fY3R4LmZpbGxTdHlsZSA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZvbnQgdXNpbmcgYSBzaW5nbGUgc3RyaW5nLiBGb3IgdGhlIHN5bnRheCwKICogc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0NTUy9mb250CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBmb250IEEgQ1NTIHNob3J0aGFuZCBmb250IHByb3BlcnR5CiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRGYW1pbHl9CiAqIEBzZWUge0BsaW5rIHNldEZvbnRTaXplfQogKiBAc2VlIHtAbGluayBzZXRGb250V2VpZ2h0fQogKi8KZnVuY3Rpb24gc2V0Rm9udChmb250KSB7CiAgX19jdHguZm9udCA9IGZvbnQgfHwgYCR7X19mb250LndlaWdodH0gJHtfX2ZvbnQuc2l6ZX1weCAke19fZm9udC5mYW1pbHl9YDsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBmb250IGZhbWlseS4KICoKICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgVGhlIENTUyBmb250IGZhbWlseSBuYW1lCiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRTaXplfQogKiBAc2VlIHtAbGluayBzZXRGb250V2VpZ2h0fQogKi8KZnVuY3Rpb24gc2V0Rm9udEZhbWlseShuYW1lKSB7CiAgX19mb250LmZhbWlseSA9IG5hbWU7CiAgc2V0Rm9udCgpOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZvbnQgc2l6ZQogKgogKiBAcGFyYW0ge251bWJlcn0gcHggVGhlIGZvbnQgc2l6ZSBpbiBwaXhlbHMKICoKICogQHNlZSB7QGxpbmsgc2V0Rm9udEZhbWlseX0KICogQHNlZSB7QGxpbmsgc2V0Rm9udFdlaWdodH0KICovCmZ1bmN0aW9uIHNldEZvbnRTaXplKHB4KSB7CiAgX19mb250LnNpemUgPSBweDsKICBzZXRGb250KCk7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgZm9udCB3ZWlnaHQKICoKICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSB2YWwgVGhlIENTUyB3ZWlnaHQgbnVtYmVyIG9yIG9uZSBvZiB0aGUgc3BlY2lhbCBzdHJpbmdzICJub3JtYWwiLCAiYm9sZCIsICJib2xkZXIiLCBvciAibGlnaHRlciIuCiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRGYW1pbHl9CiAqIEBzZWUge0BsaW5rIHNldEZvbnRTaXplfQogKi8KZnVuY3Rpb24gc2V0Rm9udFdlaWdodCh2YWwpIHsKICBfX2ZvbnQud2VpZ2h0ID0gdmFsOwogIHNldEZvbnQoKTsKfQoKLyoqCiAqIFNldCB0aGUgYmFja2dyb3VuZCBncmlkIHNwYWNpbmcgYW5kIGNvbG91ci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEdyaWQoMjAsIGBsYXZlbmRlcmApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHNwYWNpbmc/IFRoZSBzcGFjaW5nIGJldHdlZW4gZ3JpZCBsaW5lcyBpbiBwaXhlbHMgKGRlZmF1bHQgPSAyMCkKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yPyBUaGUgQ1NTIGNvbG9yIHRvIHVzZSBmb3IgdGhlIGJvcmRlciAoZGVmYXVsdCA9IGxpZ2h0Z3JleSkKICoKICogQHNlZSB7QGxpbmsgbm9HcmlkfQogKi8KZnVuY3Rpb24gc2V0R3JpZChzcGFjaW5nID0gMjAsIGNvbG9yID0gYGxpZ2h0Z3JleWApIHsKICBfX2RyYXdfZ3JpZCA9IHRydWU7CiAgX19ncmlkX3NwYWNpbmcgPSBzcGFjaW5nOwogIF9fZ3JpZF9jb2xvciA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjb2xvciB0aGF0IHNob3VsZCBiZSB1c2VkIHRvIHJlcGxhY2Ugd2hhdGV2ZXIKICogaGlnaGxpZ2h0KCkgbWFya2VkIGFzIHRoZSAidG8gaGlnaGxpZ2h0IiBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0SGlnaGxpZ2h0Q29sb3IoYGxpbWVgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KCJsZXQncyBnbyIsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICBpZiAoc3RhdGUpIGhpZ2hsaWdodChgcmVkYCk7CiAqICAgICAgIGVsc2UgaGlnaGxpZ2h0KGZhbHNlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIKICoKICogQHNlZSB7QGxpbmsgaGlnaGxpZ2h0fQogKi8KZnVuY3Rpb24gc2V0SGlnaGxpZ2h0Q29sb3IoY29sb3IpIHsKICBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yID0gY29sb3I7Cn0KCi8qKgogKiBTZXQgdGhlIGxpbmUgZGFzaCBwcm9wZXJ0eS4gU2VlIHRoZSBmb2xsb3dpbmcgTUROIGFydGljbGUgZm9yIHRoZSBkZXRhaWxzOgogKgogKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9kb2NzL1dlYi9BUEkvQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEL3NldExpbmVEYXNoCiAqCiAqIEBwYXJhbSAge251bWJlcltdfSAuLi52YWx1ZXMgVGhlIGRhc2ggaW50ZXJ2YWxzIGluIHBpeGVsCiAqCiAqIEBzZWUge0BsaW5rIG5vTGluZURhc2h9CiAqLwpmdW5jdGlvbiBzZXRMaW5lRGFzaCguLi52YWx1ZXMpIHsKICBfX2N0eC5zZXRMaW5lRGFzaCh2YWx1ZXMpOwp9CgovKioKICogU2V0IHRoZSBsaW5lIHdpZHRoIGluIHBpeGVscy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcmFuZ2UoMSwgMTAsIChpKSA9PiB7CiAqICAgICAgICAgc2V0TGluZVdpZHRoKGkpOwogKiAgICAgICAgIGxpbmUoMjAsIGkgKiAyMCwgMTgwLCBpICogMjApOwogKiAgICAgICB9KQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aD8gVGhlIGxpbmUgd2lkdGggaW4gcGl4ZWxzIChkZWZhdWx0ID0gMSkKICoKICogQHNlZSB7QGxpbmsgc2V0VGV4dFN0cm9rZX0KICovCmZ1bmN0aW9uIHNldExpbmVXaWR0aCh3aWR0aCA9IDEpIHsKICBfX2N0eC5saW5lV2lkdGggPSB3aWR0aDsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBzdHJva2UgY29sb3VyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGByZWRgKTsKICogICAgICAgcmVjdCg1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gY29sb3IgVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBibGFjaykKICoKICogQHNlZSB7QGxpbmsgc2V0RmlsbH0KICogQHNlZSB7QGxpbmsgc2V0Q29sb3J9CiAqLwpmdW5jdGlvbiBzZXRTdHJva2UoY29sb3IgPSBgYmxhY2tgKSB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdID09PSBfX2hpZ2hsaWdodF9jb2xvcikgewogICAgY29sb3IgPSBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwogIH0KICBfX2N0eC5zdHJva2VTdHlsZSA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IHRleHQgYWxpZ25tZW50IHZhbHVlcy4KICoKICogVmFsaWQgYHhBbGlnbmAgdmFsdWVzIGFyZToKICoKICogLSBDRU5URVIgLSB0aGUgdGV4dCBhbmNob3IgaXMgaW4gdGhlIG1pZGRsZSBvZiB0aGUgdGV4dC4gVGV4dCBpcyBwbGFjZWQgZXZlbmx5IG9uIGVpdGhlciBzaWRlLgogKiAtIEVORCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgcmlnaHQgZm9yIExUUiB0ZXh0LCBhbmQgb24gdGhlIGxlZnQgZm9yIFJUTCB0ZXh0LgogKiAtIExFRlQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIGxlZnQgc2lkZSBvZiB0aGUgdGV4dC4gYWxsIHRleHQgaXMgdG8gdGhlIHJpZ2h0LgogKiAtIFJJR0hUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSByaWdodCBzaWRlIG9mIHRoZSB0ZXh0LiBBbGwgdGV4dCBpcyB0byB0aGUgbGVmdC4KICogLSBTVEFSVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgbGVmdCBmb3IgTFRSIHRleHQsIGFuZCBvbiB0aGUgcmlnaHQgZm9yIFJUTCB0ZXh0LgogKgogKiBWYWxpZCBgeUFsaWduYCB2YWx1ZXMgYXJlOgogKgogKiAtIEFMUEhBQkVUSUMgLSBzdGFuZGFyZCB0ZXh0IGFsaWdubWVudCAoZGVmYXVsdCkKICogLSBCT1RUT00gLSB0aGUgdGV4dCBpcyBhbGlnbmVkIHRvIHRoZSBib3R0b20gb2YgdGhlIGJvdW5kaW5nIGJveAogKiAtIEhBTkdJTkcgLSByZWxldmFudCBmb3IgVGliZXRhbiBhbmQgb3RoZXIgSW5kaWMgc2NyaXB0cy4KICogLSBJREVPR1JBUEhJQyAtIHJlbGV2YW50IGZvciBpZGVvZ3JhcGhpYyBDSktWIHRleHQuCiAqIC0gTUlERExFIC0gVGhlIHZlcnRpY2FsIGVxdWl2YWxlbnQgb2YgImNlbnRlciIuCiAqIC0gVE9QIC0gVGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgdG9wIG9mIHRoZSB0eXBvZ3JhcGhpYyAiZW0gc3F1YXJlIi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRGb250U2l6ZSgyMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBsaW5lKHdpZHRoIC8gMiwgMCwgd2lkdGggLyAyLCBoZWlnaHQpOwogKiAgICAgICBsaW5lKDAsIGhlaWdodCAvIDIsIHdpZHRoLCBoZWlnaHQgLyAyKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dCgiY2VudGVyIG1pZGRsZSIsIHdpZHRoIC8gMiwgaGVpZ2h0LzIpOwogKiAgICAgICBsaW5lKDAsIGhlaWdodCAvIDIgLSA1MCwgd2lkdGgsIGhlaWdodCAvIDIgLSA1MCk7CiAqICAgICAgIHNldFRleHRBbGlnbihSSUdIVCwgVE9QKTsKICogICAgICAgdGV4dCgicmlnaHQgdG9wIiwgd2lkdGggLyAyLCBoZWlnaHQvMiAtIDUwKTsKICogICAgICAgbGluZSgwLCBoZWlnaHQgLyAyICsgNTAsIHdpZHRoLCBoZWlnaHQgLyAyICsgNTApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oTEVGVCwgQk9UVE9NKTsKICogICAgICAgdGV4dCgibGVmdCBib3R0b20iLCB3aWR0aCAvIDIsIGhlaWdodC8yICsgNTApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSB4QWxpZ24gVGhlIENTUyBob3Jpem9udGFsIGFsaWdubWVudAogKiBAcGFyYW0ge3N0cmluZ30geUFsaWduIFRoZSBDU1MgdmVydGljYWwgYWxpZ25tZW50CiAqLwpmdW5jdGlvbiBzZXRUZXh0QWxpZ24oeEFsaWduLCB5QWxpZ24pIHsKICBfX2N0eC50ZXh0QWxpZ24gPSB4QWxpZ247CiAgX19jdHgudGV4dEJhc2VsaW5lID0geUFsaWduOwp9CgovKioKICogU2V0IHRoZSB0ZXh0IG91dGxpbmUgc3Ryb2tpbmcgcHJvcGVydGllcy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoYHJlZGAsIDEpOwogKiAgICAgICBzZXRGaWxsKGB5ZWxsb3dgKTsKICogICAgICAgdGV4dCgiZmFuY3kgdGV4dCIsIHdpZHRoLzIsIDgwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICAgIHNldEZvbnRTaXplKDY1KTsKICogICAgICAgc2V0VGV4dFN0cm9rZShgcmVkYCwgMyk7CiAqICAgICAgIHNldEZpbGwoYHllbGxvd2ApOwogKiAgICAgICB0ZXh0KCJmYW5jeSB0ZXh0Iiwgd2lkdGgvMiwgMTQwLCBDRU5URVIsIENFTlRFUik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yIFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyCiAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aD8gVGhlIHRleHQgc3Ryb2tlIHdpZHRoIGluIHBpeGVscyAoZGVmYXVsdCA9IDEpCiAqCiAqIEBzZWUge0BsaW5rIHNldFN0cm9rZX0KICogQHNlZSB7QGxpbmsgc2V0TGluZVdpZHRofQogKi8KZnVuY3Rpb24gc2V0VGV4dFN0cm9rZShjb2xvciwgd2lkdGggPSAxKSB7CiAgX190ZXh0U3Ryb2tlID0gY29sb3I7CiAgc2V0TGluZVdpZHRoKHdpZHRoKTsKfQovKioKICogU3RhcnQgYSBuZXcgc2hhcGUuIFRoaXMgeWllbGRzIGEgYFNoYXBlYCBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIEFQSQogKgogKiAtIGBtYWtlTW92YWJsZShtb3ZhYmxlPzogYm9vbGVhbilgIC0gYWxsb3cgdGhpcyBzaGFwZSB0byBiZSBtb3ZlZCBhcm91bmQgd2l0aCB0aGUgcG9pbnRlciAoYG1vdmFibGVgIGlzIHRydWUgaWYgb21pdHRlZCkKICogLSBgYWxsb3dSZXNpemluZyhhbGxvd2VkPzogYm9vbGVhbilgIC0gYWxsb3cgdGhlIHBvaW50cyB0aGF0IG1ha2UgdXAgdGhpcyBzaGFwZSB0byBiZSBtb3ZlZCBhcm91bmQgKGBhbGxvd2VkYCBpcyB0cnVlIGlmIG9taXR0ZWQpCiAqCiAqIC0gYGFkZCh4LCB5KWAgLSBhZGQgYSBwb2ludCB0byB0aGUgc2hhcGUncyBjdXJyZW50IHNlZ21lbnQuCiAqIC0gYGNsb3NlKClgIC0gY2xvc2UgdGhlIGN1cnJlbnQgc2VnbWVudCBzbyBubyBuZXcgcG9pbnRzIGNhbiBiZSBhZGRlZC4KICogLSBgbmV3U2VnbWVudChjbG9zZUV4aXN0aW5nPzogYm9vbGVhbilgIC0gc3RhcnQgYSBuZXcgc2VnbWVudCBpbiB0aGlzIHNoYXBlLCB3CiAqCiAqIC0gYG9mZnNldCh4LCB5KWAgLSAodGVtcG9yYXJpbHkpIG1vdmUgdGhpcyBzaGFwZSBieSAoeCx5KQogKiAtIGBjb21taXQoKWAgLSBjb21taXQgdGhlIG9mZnNldCBhcyByZWFsIGNvb3JkaW5hdGVzLgogKiAtIGByZXNldCgpYCAtIHJlc2V0IHRoZSBzaGFwZSB0byBoYXZpbmcgbm8gb2Zmc2V0LgogKgogKiAtIGBkcmF3KHNob3dQb2ludHM/KWAgLSBkcmF3cyB0aGUgc2hhcGUgdXNpbmcgdGhlIGN1cnJlbnQgc3Ryb2tlIGFuZCBmaWxsIHNldHRpbmdzLgogKiAtIGBpbnNpZGUoeCwgeSk6IHNlZ21lbnRbXWAgLSByZXR1cm5zIHRoZSBsaXN0IG9mIGFsbCBzZWdtZW50cyB0aGF0ICh4LHkpIGlzIGluc2lkZSBvZi4KICoKICogTm90ZSB0aGF0IHNoYXBlcyBkbyBub3QgcGVyZm9ybSBhbnkgc29ydCBvZiBib29sZWFuIG9wZXJhdGlvbnMsIGFuZAogKiBkZWZpbmluZyBhIHNoYXBlIHdpdGggYSBjdXRvdXQgaXMgbm90IHBvc3NpYmxlLiBZb3UnbGwgd2FudCB0byB1c2UKICogU1ZHIGltYWdlcyBmb3IgdGhhdCwgaW5zdGVhZC4gRS5nLiBjcmVhdGUgYW4gU1ZHIGRhdGEgdXJpLCB0aGVuIHVzZQogKiB0aGF0IGFzIGBzcmNgIGZvciBhbiBJbWFnZSBhbmQgZHJhdyB0aGF0IGltYWdlIHVzaW5nIHRoZSBgaW1hZ2UoKWAKICogZnVuY3Rpb24uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBsZXQgc2hhcGU7CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNoYXBlID0gc3RhcnRTaGFwZSgpOwogKiAgICAgICBzaGFwZS5hbGxvd1Jlc2l6aW5nKCk7CiAqICAgICAgIHNoYXBlLm1ha2VNb3ZhYmxlKCk7CiAqICAgICAgIHNoYXBlLmFkZCgwLGhlaWdodC8yKTsKICogICAgICAgc2hhcGUuYWRkKHdpZHRoLzIsIDApOwogKiAgICAgICBzaGFwZS5hZGQod2lkdGgsIGhlaWdodC8yKTsKICogICAgICAgc2hhcGUuYWRkKHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIHNoYXBlLmNsb3NlKCk7CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGBnb2xkYCk7CiAqICAgICAgIHNoYXBlLmRyYXcodHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge1NoYXBlfSB0aGUgbmV3bHkgY3JlYXRlZCBzaGFwZSBvYmplY3QKICoKICogQHNlZSB7QGxpbmsgZW5kU2hhcGV9CiAqLwpmdW5jdGlvbiBzdGFydFNoYXBlKCkgewogIHJldHVybiAoX19zaGFwZSA9IG5ldyBTaGFwZSgpKTsKfQoKLyoqCiAqIENsZWFyIHRoZSBjdXJyZW50IHNoYXBlLCBvcHRpb25hbGx5IGNsb3NpbmcgaXQuCiAqCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY2xvc2U/IFdoZW4gdXNlZCwgY2xvc2VzIHRoZSBzaGFwZSdzIGN1cnJlbnQgc2VnbWVudC4KICogQHJldHVybnMge1NoYXBlfSBUaGUgc2hhcGUgdGhhdCBnb3QgY2xvc2VkCiAqCiAqIEBzZWUge0BsaW5rIHN0YXJ0U2hhcGV9CiAqLwpmdW5jdGlvbiBlbmRTaGFwZShjbG9zZSA9IGZhbHNlKSB7CiAgaWYgKF9fc2hhcGUgJiYgY2xvc2UpIF9fc2hhcGUuY2xvc2UoKTsKICBjb25zdCBzaGFwZSA9IF9fc2hhcGU7CiAgX19zaGFwZSA9IHVuZGVmaW5lZDsKICByZXR1cm4gc2hhcGU7Cn0KCi8qKgogKiBTdGFydCBhIG5ldyBzZWdtZW50IGluIGEgc2hhcGUuCiAqCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY2xvc2U/IENsb3NlcyB0aGUgY3VycmVudCBzZWdtZW50IGJlZm9yZSBvcGVuaW5nIGEgbmV3IG9uZSAoZGVmYXVsdCA9IHRydWUpCiAqCiAqIEBzZWUge0BsaW5rIHN0YXJ0U2hhcGV9CiAqIEBzZWUge0BsaW5rIGVuZFNoYXBlfQogKi8KZnVuY3Rpb24gbmV3U2VnbWVudChjbG9zZSA9IHRydWUpIHsKICBfX3NoYXBlPy5uZXdTZWdtZW50KGNsb3NlKTsKfQovKioKICogQ2VudGVycyB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gb24geW91ciBncmFwaGljLgogKiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gY2FsbGluZzoKICoKICogYGBgCiAqIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqIGBgYAogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgY2VudGVyKCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBsaW5lKDAsIC1odWdlLCAwLCBodWdlKTsKICogICAgICAgbGluZSgtaHVnZSwgMCwgaHVnZSwgMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCggMTAsICAxMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCggMTAsIC0xMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCgtMTAsIC0xMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCgtMTAsICAxMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIGNlbnRlcigpIHsKICB0cmFuc2xhdGUod2lkdGggLyAyLCBoZWlnaHQgLyAyKTsKfQoKLyoqCiAqIFJlc2V0IHRoZSBjb29yZGluYXRlIHRyYW5zZm9ybSBtYXRyaXguCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIG5vR3JpZCgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYGxpZ2h0Z3JleWApOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHRyYW5zbGF0ZSg1MCw1MCk7CiAqICAgICAgIGxpbmUoMCwwLDEwMCwwKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApOwogKiAgICAgICBwb2ludCgxMCwwKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBwb2ludCgxMCwwKTsKICogICAgICAgbGluZSgwLDAsMTAwLDApOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICByb3RhdGUoLVBJLzYpCiAqICAgICAgIHBvaW50KDEwMCwwKTsKICogICAgICAgc2NhbGUoMC41LCAwLjUpOwogKiAgICAgICBwb2ludCgxMDAsMCk7CiAqICAgICAgIGxpbmUoMTAwLDAsMjAwLDApOwogKiAgICAgICByZXNldFRyYW5zZm9ybSgpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgbGluZSgwLDMsMTAwLDMpOwogKiAgICAgICBwb2ludCgwLDMpOwogKiAgICAgICBwb2ludCgxMCwzKTsKICogICAgICAgcG9pbnQoMTAwLDMpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHJlc2V0VHJhbnNmb3JtKCkgewogIF9fY3R4LnJlc2V0VHJhbnNmb3JtKCk7Cn0KCi8qKgogKiBSb3RhdGUgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIHdydCB0aGUgY3VycmVudCBvcmlnaW4uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIG5vR3JpZCgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYGxpZ2h0Z3JleWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgVGhlIGFuZ2xlIGJ5IHdoaWNoIHRvIHJvdGF0ZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gaW4gcmFkaWFucwogKgogKiBAc2VlIHtAbGluayB0cmFuc2Zvcm19CiAqIEBzZWUge0BsaW5rIHJlc2V0VHJhbnNmb3JtfQogKi8KZnVuY3Rpb24gcm90YXRlKGFuZ2xlID0gMCkgewogIF9fY3R4LnJvdGF0ZShhbmdsZSk7Cn0KCi8qKgogKiBTY2FsZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gd3J0IHRoZSBjdXJyZW50IG9yaWdpbi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgbGlnaHRncmV5YCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwb2ludCgwLDApOwogKiAgICAgICBzZXRDb2xvcihgZGFya2dyZWVuYCk7CiAqICAgICAgIGxpbmUoMCwwLDIwLDIwKTsKICogICAgICAgcG9pbnQoMjAsMjApOwogKiAgICAgICByb3RhdGUoUEkvNCk7CiAqICAgICAgIHNjYWxlKDIpOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgYW1vdW50IGJ5IHdoaWNoIHRvIHNjYWxlIHRoZSB4IGNvb3JkaW5hdGVzLgogKiBAcGFyYW0ge251bWJlcn0geT8gVGhlIGFtb3VudCBieSB3aGljaCB0byBzY2FsZSB0aGUgeCBjb29yZGluYXRlcyAoZGVmYXVsdCA9IHNhbWUgYXMgeCkKICoKICogQHNlZSB7QGxpbmsgdHJhbnNmb3JtfQogKiBAc2VlIHtAbGluayByZXNldFRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHNjYWxlKHggPSAxLCB5ID0geCkgewogIF9fY3R4LnNjYWxlKHgsIHkpOwp9CgovKioKICogQ29udmVydCBhIHNjcmVlbiAoZS5nLiBicm93c2VyKSBjb29yZGluYXRlIGludG8gaXRzCiAqIGNvcnJlc3BvbmRpbmcgInRyYW5zZm9ybWVkIiBjb29yZGluYXRlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBub0dyaWQoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBsaWdodGdyZXlgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBzY2FsZSgwLjUpOwogKiAgICAgICBpZiAocG9pbnRlci5hY3RpdmUpIHsKICogICAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgICAgcG9pbnQocG9pbnRlci54LCBwb2ludGVyLnkpOwogKiAgICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgICAgcG9pbnQoc2NyZWVuVG9Xb3JsZChwb2ludGVyLngsIHBvaW50ZXIueSkpOwogKiAgICAgICB9CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSgpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHNjcmVlbiBjb29yZGluYXRlJ3MgeCB2YWx1ZSBpbiBwaXhlbHMKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHNjcmVlbiBjb29yZGluYXRlJ3MgeSB2YWx1ZSBpbiBwaXhlbHMKICogQHJldHVybnMge1BvaW50TGlrZX0gcCBUaGUgd29ybGQge3gseX0gY29vcmRpbmF0ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgc2NyZWVuIHt4LHl9IGNvb3JkaW5hdGUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCBUaGUgd29ybGQge3gseX0gY29vcmRpbmF0ZQogKgogKiBAc2VlIHtAbGluayBwcm9qZWN0fQogKiBAc2VlIHtAbGluayB3b3JsZFRvU2NyZWVufQogKi8KZnVuY3Rpb24gc2NyZWVuVG9Xb3JsZCh4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIGxldCBNID0gX19jdHguZ2V0VHJhbnNmb3JtKCkuaW52ZXJ0U2VsZigpOwoKICByZXR1cm4gbmV3IFBvaW50KHggKiBNLmEgKyB5ICogTS5jICsgTS5lLCB4ICogTS5iICsgeSAqIE0uZCArIE0uZik7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgdHJhbnNmb3JtIG1hdHJpeCwgYmFzZWQgb24gYXBwbHlpbmc6CiAqCiAqIGBgYAogKiAgICAgICB8IGEgYiBjIHwKICogICBtID0gfCBkIGUgZiB8CiAqICAgICAgIHwgMCAwIDEgfAogKiBgYGAKICoKICogV2l0aCB0aGUgcGFyYW1ldGVycyBkZWZhdWx0aW5nIHRvIHRoZSBpZGVudGl0eSBtYXRyaXguCiAqCiAqIFNlZSB0aGUgZm9sbG93aW5nIE1ETiBhcnRpY2xlIGZvciBtb3JlIGRldGFpbHMgYWJvdXQgdGhpcyBmdW5jdGlvbjoKICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZG9jcy9XZWIvQVBJL0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC90cmFuc2Zvcm0KICoKICogQHBhcmFtIHtudW1iZXJ9IGEgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0ge251bWJlcn0gYiAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSB7bnVtYmVyfSBjIChkZWZhdWx0ID0gMCkKICogQHBhcmFtIHtudW1iZXJ9IGQgKGRlZmF1bHQgPSAwKQogKiBAcGFyYW0ge251bWJlcn0gZSAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSB7bnVtYmVyfSBmIChkZWZhdWx0ID0gMCkKICoKICogQHNlZSB7QGxpbmsgcmVzZXRUcmFuc2Zvcm19CiAqLwpmdW5jdGlvbiB0cmFuc2Zvcm0oYSA9IDEsIGIgPSAwLCBjID0gMCwgZCA9IDAsIGUgPSAxLCBmID0gMCkgewogIF9fY3R4LnRyYW5zZm9ybShhLCBiLCBjLCBkLCBlLCBmKTsKfQoKLyoqCiAqIFRyYW5zbGF0ZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gYnkgc29tZSBhbW91bnQgb2YgeCBhbmQgeSB1bml0cy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHBvaW50KDAsMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHggdmFsdWUgaW4gcGl4ZWxzIHRvIGJlIHRyZWF0ZWQgYXMgdGhlIG5ldyAiemVybyIKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHkgdmFsdWUgaW4gcGl4ZWxzIHRvIGJlIHRyZWF0ZWQgYXMgdGhlIG5ldyAiemVybyIKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHt4LHl9IGNvb3JkaW5hdGUgdG8gYmUgdHJlYXRlZCBhcyB0aGUgbmV3ICJ6ZXJvIgogKgogKiBAc2VlIHtAbGluayB0cmFuc2Zvcm19CiAqIEBzZWUge0BsaW5rIHJlc2V0VHJhbnNmb3JtfQogKi8KZnVuY3Rpb24gdHJhbnNsYXRlKHggPSAwLCB5ID0gMCkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIF9fY3R4LnRyYW5zbGF0ZSh4LCB5KTsKfQoKLyoqCiAqIENvbnZlcnQgYW4gaW4tY2FudmFzICJ0cmFuc2Zvcm1lZCIgY29vcmRpbmF0ZSBpbnRvIGl0cwogKiBjb3JyZXNwb25kaW5nICJzY3JlZW4iIChpLmUuIGJyb3dzZXIgY2FudmFzIG9mZnNldCkgY29vcmRpbmF0ZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7CiAqCiAqICAgICAgIHJvdGF0ZShtaWxsaXMoKSAvIDIwMDApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIGNvbnN0IHAgPSBuZXcgUG9pbnQoMzAsIDApOwogKiAgICAgICBwb2ludChwKTsKICogICAgICAgdGV4dChgJHtwLnh9LCR7cC55fWAsIHAueCArIDEwLCBwLnkgKyAxMCk7CiAqCiAqICAgICAgIGNvbnN0IHt4LCB5fSA9IHdvcmxkVG9TY3JlZW4ocCk7CiAqICAgICAgIHJlc2V0VHJhbnNmb3JtKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDE2KTsKICogICAgICAgdGV4dChgJHt4LnRvRml4ZWQoKX0sJHt5LnRvRml4ZWQoKX1gLCB4IC0gMjUsIHkgLSAxNSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHdvcmxkIGNvb3JkaW5hdGUncyB4IHZhbHVlIGluIHBpeGVscwogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgd29ybGQgY29vcmRpbmF0ZSdzIHkgdmFsdWUgaW4gcGl4ZWxzCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgVGhlIHNjcmVlbiB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSB3b3JsZCB7eCx5fSBjb29yZGluYXRlCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgVGhlIHNjcmVlbiB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBzZWUge0BsaW5rIHByb2plY3R9CiAqIEBzZWUge0BsaW5rIHNjcmVlblRvV29ybGR9CiAqLwpmdW5jdGlvbiB3b3JsZFRvU2NyZWVuKHgsIHkpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgbGV0IE0gPSBfX2N0eC5nZXRUcmFuc2Zvcm0oKTsKCiAgcmV0dXJuIG5ldyBQb2ludCh4ICogTS5hICsgeSAqIE0uYyArIE0uZSwgeCAqIE0uYiArIHkgKiBNLmQgKyBNLmYpOwp9CmZ1bmN0aW9uIGdyaWQoKSB7CiAgc2F2ZSgpOwogIHNldExpbmVXaWR0aCgwLjUpOwogIG5vRmlsbCgpOwogIHNldFN0cm9rZShfX2dyaWRfY29sb3IpOwogIGZvciAoCiAgICBsZXQgeCA9ICgtMC41ICsgX19ncmlkX3NwYWNpbmcgLyAyKSB8IDA7CiAgICB4IDwgd2lkdGg7CiAgICB4ICs9IF9fZ3JpZF9zcGFjaW5nCiAgKSB7CiAgICBsaW5lKHgsIDAsIHgsIGhlaWdodCk7CiAgfQogIGZvciAoCiAgICBsZXQgeSA9ICgtMC41ICsgX19ncmlkX3NwYWNpbmcgLyAyKSB8IDA7CiAgICB5IDwgaGVpZ2h0OwogICAgeSArPSBfX2dyaWRfc3BhY2luZwogICkgewogICAgbGluZSgwLCB5LCB3aWR0aCwgeSk7CiAgfQogIHJlc3RvcmUoKTsKfQpmdW5jdGlvbiBfX3NhZmVseUludGVyY2VwdEtleShldnQpIHsKICAvLyBXZSBkb24ndCB3YW50IHRvIGludGVyZmVyZSB3aXRoIHRoZSBicm93c2VyLCBzbyB3ZSdyZSBvbmx5CiAgLy8gZ29pbmcgdG8gYWxsb3cgdW5tb2RpZmllZCBrZXlzLCBvciBzaGlmdC1tb2RpZmllZCBrZXlzLAogIC8vIGFuZCB0YWIgaGFzIHRvIGFsd2F5cyB3b3JrLiBGb3Igb2J2aW91cyByZWFzb25zLgogIGNvbnN0IHRhYiA9IGV2dC5rZXkgIT09ICJUYWIiOwogIGNvbnN0IGZ1bmN0aW9uS2V5ID0gZXZ0LmtleS5tYXRjaCgvRlxkKy8pID09PSBudWxsOwogIGNvbnN0IHNwZWNpZmljQ2hlY2sgPSB0YWIgJiYgZnVuY3Rpb25LZXk7CiAgaWYgKCFldnQuYWx0S2V5ICYmICFldnQuY3RybEtleSAmJiAhZXZ0Lm1ldGFLZXkgJiYgc3BlY2lmaWNDaGVjaykgewogICAgaWYgKGV2dC50YXJnZXQgPT09IF9fY2FudmFzKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBfX2tleURvd24oa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KSB7CiAga2V5Ym9hcmRba2V5XSA9IERhdGUubm93KCk7CiAgaWYgKHR5cGVvZiBrZXlEb3duICE9PSBgdW5kZWZpbmVkYCkKICAgIGtleURvd24oa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KTsKfQoKX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihga2V5ZG93bmAsIChldnQpID0+IHsKICBfX3NhZmVseUludGVyY2VwdEtleShldnQpOwogIGNvbnN0IHsga2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5IH0gPSBldnQ7CiAgaWYgKF9fZmluaXNoZWRfc2V0dXApIF9fa2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9KTsKCmZ1bmN0aW9uIF9fa2V5VXAoa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KSB7CiAgZGVsZXRlIGtleWJvYXJkW2tleV07CiAgaWYgKHR5cGVvZiBrZXlVcCAhPT0gYHVuZGVmaW5lZGApCiAgICBrZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9CgpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBrZXl1cGAsIChldnQpID0+IHsKICBfX3NhZmVseUludGVyY2VwdEtleShldnQpOwogIGNvbnN0IHsga2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5IH0gPSBldnQ7CiAgaWYgKF9fZmluaXNoZWRfc2V0dXApIF9fa2V5VXAoa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KTsKfSk7CmNvbnN0IF9fYmlub21pYWxDb2VmZmljaWVudHMgPSBbWzFdLCBbMSwgMV1dOwpjbGFzcyBNYXRyaXggewogIGNvbnN0cnVjdG9yKG4sIG0sIGRhdGEpIHsKICAgIGRhdGEgPSBuIGluc3RhbmNlb2YgQXJyYXkgPyBuIDogZGF0YTsKICAgIHRoaXMuZGF0YSA9CiAgICAgIGRhdGEgPz8gWy4uLm5ldyBBcnJheShuKV0ubWFwKCh2KSA9PiBbLi4ubmV3IEFycmF5KG0pXS5tYXAoKHYpID0+IDApKTsKICAgIHRoaXMucm93cyA9IHRoaXMuZGF0YS5sZW5ndGg7CiAgICB0aGlzLmNvbHMgPSB0aGlzLmRhdGFbMF0ubGVuZ3RoOwogIH0KICBzZXREYXRhKGRhdGEpIHsKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgfQogIGdldChpLCBqKSB7CiAgICByZXR1cm4gdGhpcy5kYXRhW2ldW2pdOwogIH0KICBzZXQoaSwgaiwgdmFsdWUpIHsKICAgIHRoaXMuZGF0YVtpXVtqXSA9IHZhbHVlOwogIH0KICByb3coaSkgewogICAgcmV0dXJuIHRoaXMuZGF0YVtpXTsKICB9CiAgY29sKGopIHsKICAgIHZhciBkID0gdGhpcy5kYXRhLAogICAgICBjb2wgPSBbXTsKICAgIGZvciAobGV0IHIgPSAwLCBsID0gZC5sZW5ndGg7IHIgPCBsOyByKyspIHsKICAgICAgY29sLnB1c2goZFtyXVtqXSk7CiAgICB9CiAgICByZXR1cm4gY29sOwogIH0KICBtdWx0aXBseShvdGhlcikgewogICAgcmV0dXJuIG5ldyBNYXRyaXgobXVsdGlwbHlNYXRyaXgodGhpcy5kYXRhLCBvdGhlci5kYXRhKSk7CiAgfQogIGludmVydCgpIHsKICAgIHJldHVybiBuZXcgTWF0cml4KGludmVydE1hdHJpeCh0aGlzLmRhdGEpKTsKICB9CiAgdHJhbnNwb3NlKCkgewogICAgcmV0dXJuIG5ldyBNYXRyaXgodHJhbnNwb3NlTWF0cml4KHRoaXMuZGF0YSkpOwogIH0KfQpjbGFzcyBQb2ludCB7CiAgY29uc3RydWN0b3IoeCwgeSkgewogICAgdGhpcy54ID0geDsKICAgIHRoaXMueSA9IHk7CiAgfQp9CgpjbGFzcyBDaXJjbGUgZXh0ZW5kcyBQb2ludCB7CiAgY29uc3RydWN0b3IoeCwgeSwgcikgewogICAgc3VwZXIoeCwgeSk7CiAgICB0aGlzLnIgPSByOwogIH0KfQpmdW5jdGlvbiBfX2NoZWNrRm9yQ3VycmVudE1vdmFibGUoeCwgeSwgdHlwZSkgewogIGN1cnJlbnRNb3ZhYmxlID0gZmFsc2U7CgogIGlmICghX19tb3ZhYmxlX3BvaW50cy5sZW5ndGgpIHJldHVybjsKCiAgY29uc3QgbWF0Y2hlcyA9IFtdOwogIGNvbnN0IG1hdGNoUGFkZGluZyA9IHR5cGUuaW5jbHVkZXMoYG1vdXNlYCkgPyAxMCA6IDMwOwoKICBfX21vdmFibGVfcG9pbnRzLmZvckVhY2goKHAsIHBvcykgPT4gewogICAgaWYgKHAgaW5zdGFuY2VvZiBTaGFwZSkgewogICAgICBpZiAocC5pbnNpZGUoeCwgeSkubGVuZ3RoID4gMCkgewogICAgICAgIG1hdGNoZXMucHVzaCh7IHAsIGQ6IDAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGxldCB4MiA9IHBbMF0gPT09IHVuZGVmaW5lZCA/IHAueCA6IHBbMF07CiAgICAgIGxldCB5MiA9IHBbMV0gPT09IHVuZGVmaW5lZCA/IHAueSA6IHBbMV07CiAgICAgIGNvbnN0IGQgPSBkaXN0KHgsIHksIHgyLCB5Mik7CiAgICAgIGlmIChkIDwgKHAuciA/IHAuciA6IDApICsgbWF0Y2hQYWRkaW5nKSB7CiAgICAgICAgbWF0Y2hlcy5wdXNoKHsgcCwgZCB9KTsKICAgICAgfQogICAgfQogIH0pOwoKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgYXV0b2A7CgogIGlmIChtYXRjaGVzLmxlbmd0aCkgewogICAgbWF0Y2hlcy5zb3J0KChhLCBiKSA9PiBhLmQgLSBiLmQpOwogICAgY3VycmVudE1vdmFibGUgPSBtYXRjaGVzWzBdLnA7CiAgICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgcG9pbnRlcmA7CiAgfQp9CgpmdW5jdGlvbiBfX3RvUG9pbnRlckV2ZW50KGV2dCkgewogIGxldCBwb2ludGVyID0gZXZ0OwogIC8vIENvbnZlcnQgbW91c2Ugb3IgdG91Y2ggaW50byBnZW5lcmljIHBvaW50ZXIuIFdoaWNoIHdlIG5lZWQKICAvLyB0byBkbyBiZWNhdXNlIENocm9tZSBvbiBNYWNPUyBoYXMgZGVjaWRlZCB0byBub3QgZ2VuZXJhdGUKICAvLyBwb2ludGVyIGV2ZW50cyB3aGVuIHRoZXJlJ3MgYSBtb3VzZS4gVGhhbmtzIEdvb2dsZSEKICBpZiAoZXZ0LnR5cGUuaW5jbHVkZXMoYHRvdWNoYCkpIHsKICAgIGNvbnN0IHsgdG91Y2hlcywgY2hhbmdlZFRvdWNoZXMgfSA9IGV2dC5vcmlnaW5hbEV2ZW50ID8/IGV2dDsKICAgIHBvaW50ZXIgPSB0b3VjaGVzWzBdID8/IGNoYW5nZWRUb3VjaGVzWzBdOwogIH0KICBjb25zdCB7IGNsaWVudFgsIGNsaWVudFkgfSA9IHBvaW50ZXI7CiAgY29uc3QgeyBsZWZ0LCB0b3AgfSA9IF9fY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogIHJldHVybiB7IG9mZnNldFg6IGNsaWVudFggLSBsZWZ0LCBvZmZzZXRZOiBjbGllbnRZIC0gdG9wIH07Cn0KCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09CgpbYHRvdWNoc3RhcnRgLCBgbW91c2Vkb3duYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2dCkgPT4gewogICAgaWYgKF9fZmluaXNoZWRfc2V0dXApIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgY29uc3QgeyBvZmZzZXRYLCBvZmZzZXRZIH0gPSBfX3RvUG9pbnRlckV2ZW50KGV2dCk7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUsIGRvd246IHRydWUsIG1hcms6IHsgeCwgeSB9IH0pOwogICAgICBfX2NoZWNrRm9yQ3VycmVudE1vdmFibGUoeCwgeSwgdHlwZSk7CiAgICAgIF9fcG9pbnRlckRvd24oeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyRG93bih4LCB5KSB7CiAgaWYgKGN1cnJlbnRNb3ZhYmxlKSB7CiAgICBpZiAoY3VycmVudE1vdmFibGUgaW5zdGFuY2VvZiBTaGFwZSkgewogICAgICAvLyBkb24ndCBkbyBhbnl0aGluZyBzcGVjaWFsLgogICAgfSBlbHNlIHsKICAgICAgY3VycmVudE1vdmFibGUuX2R4ID0gY3VycmVudE1vdmFibGUueCAtIHg7CiAgICAgIGN1cnJlbnRNb3ZhYmxlLl9keSA9IGN1cnJlbnRNb3ZhYmxlLnkgLSB5OwogICAgfQogIH0KICBpZiAodHlwZW9mIHBvaW50ZXJEb3duICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlckRvd24oeCwgeSk7Cn0KCltgdG91Y2hlbmRgLCBgbW91c2V1cGBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChldnQpID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGNvbnN0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gX190b1BvaW50ZXJFdmVudChldnQpOwogICAgICBjb25zdCB7IHgsIHkgfSA9IHNjcmVlblRvV29ybGQob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwgewogICAgICAgIHgsCiAgICAgICAgeSwKICAgICAgICB0eXBlLAogICAgICAgIGRvd246IGZhbHNlLAogICAgICAgIG1hcms6IGZhbHNlLAogICAgICAgIGRyYWc6IGZhbHNlLAogICAgICB9KTsKICAgICAgX19wb2ludGVyVXAoeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyVXAoeCwgeSkgewogIGlmICh0eXBlb2YgcG9pbnRlclVwICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlclVwKHgsIHkpOwogIGlmIChwb2ludGVyLm1hcms/LnggPT09IHggJiYgcG9pbnRlci5tYXJrPy55ID09PSB5KSB7CiAgICBpZiAodHlwZW9mIHBvaW50ZXJDbGljayAhPT0gYHVuZGVmaW5lZGApIHBvaW50ZXJDbGljayh4LCB5KTsKICB9CiAgaWYgKGN1cnJlbnRNb3ZhYmxlICYmIGN1cnJlbnRNb3ZhYmxlIGluc3RhbmNlb2YgU2hhcGUpIHsKICAgIGN1cnJlbnRNb3ZhYmxlLmNvbW1pdCgpOwogIH0KfQoKW2B0b3VjaG1vdmVgLCBgbW91c2Vtb3ZlYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2dCkgPT4gewogICAgaWYgKF9fZmluaXNoZWRfc2V0dXApIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgY29uc3QgeyBvZmZzZXRYLCBvZmZzZXRZIH0gPSBfX3RvUG9pbnRlckV2ZW50KGV2dCk7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUgfSk7CiAgICAgIGlmICghcG9pbnRlci5kb3duKSBfX2NoZWNrRm9yQ3VycmVudE1vdmFibGUoeCwgeSwgdHlwZSk7CiAgICAgIF9fcG9pbnRlck1vdmUoeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyTW92ZSh4LCB5KSB7CiAgbGV0IGhhZE1vdmFibGUgPSBmYWxzZTsKICBpZiAocG9pbnRlci5kb3duICYmIGN1cnJlbnRNb3ZhYmxlKSB7CiAgICBpZiAoY3VycmVudE1vdmFibGUgaW5zdGFuY2VvZiBTaGFwZSkgewogICAgICBjdXJyZW50TW92YWJsZS5vZmZzZXQoeCAtIHBvaW50ZXIubWFyay54LCB5IC0gcG9pbnRlci5tYXJrLnkpOwogICAgfSBlbHNlIGlmIChjdXJyZW50TW92YWJsZVswXSkgewogICAgICBjdXJyZW50TW92YWJsZVswXSA9IHggKyBjdXJyZW50TW92YWJsZS5fZHg7CiAgICAgIGN1cnJlbnRNb3ZhYmxlWzFdID0geSArIGN1cnJlbnRNb3ZhYmxlLl9keTsKICAgIH0gZWxzZSB7CiAgICAgIGN1cnJlbnRNb3ZhYmxlLnggPSB4ICsgY3VycmVudE1vdmFibGUuX2R4OwogICAgICBjdXJyZW50TW92YWJsZS55ID0geSArIGN1cnJlbnRNb3ZhYmxlLl9keTsKICAgIH0KICAgIGhhZE1vdmFibGUgPSB0cnVlOwogIH0KCiAgcG9pbnRlci5kcmFnID0gcG9pbnRlci5kb3duOwoKICBpZiAocG9pbnRlci5kcmFnICYmIHR5cGVvZiBwb2ludGVyRHJhZyAhPT0gYHVuZGVmaW5lZGApIHsKICAgIHBvaW50ZXJEcmFnKHgsIHkpOwogIH0KCiAgaWYgKHR5cGVvZiBwb2ludGVyTW92ZSAhPT0gYHVuZGVmaW5lZGApIHsKICAgIHBvaW50ZXJNb3ZlKHgsIHkpOwogIH0KCiAgaWYgKGhhZE1vdmFibGUgJiYgIXBsYXlpbmcpIHJlZHJhdygpOwp9CgpbYHRvdWNoc3RhcnRgLCBgbW91c2VlbnRlcmBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsICgpID0+IHsKICAgIHBvaW50ZXIuYWN0aXZlID0gdHJ1ZTsKICAgIF9fcG9pbnRlckFjdGl2ZSh0cnVlKTsKICB9KTsKfSk7CgpbYHRvdWNoZW5kYCwgYG1vdXNlbGVhdmVgXS5mb3JFYWNoKCh0eXBlKSA9PiB7CiAgX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCAoKSA9PiB7CiAgICBfX3BvaW50ZXJBY3RpdmUoZmFsc2UpOwogIH0pOwp9KTsKCmZ1bmN0aW9uIF9fcG9pbnRlckFjdGl2ZShhY3RpdmUpIHsKICBpZiAodHlwZW9mIHBvaW50ZXJBY3RpdmUgIT09IGB1bmRlZmluZWRgKSB7CiAgICBwb2ludGVyQWN0aXZlKGFjdGl2ZSk7CiAgfQp9Ci8qKgogKiBjb2RlIHVzZWQgYnkgcHJvamVjdC5qcywgYnV0IG5hbWVkIHNvIHRoYXQgaXQgbG9hZHMKICogZmlyc3QsIGFuZCBkb2VzIG5vdCBnZXQgYWRkZWQgdG8gdGhlIGQudHMgZmlsZS4KICovCmNsYXNzIENhYmluZXRQcm9qZWN0b3IgewogIEEgPSAwOwogIEIgPSAwOwogIEMgPSAwOwoKICBjb25zdHJ1Y3RvcihveCwgb3ksIHNjYWxlLCBwaGkpIHsKICAgIHRoaXMudXBkYXRlKG94LCBveSwgc2NhbGUsIHBoaSk7CiAgfQoKICBzZXRSb3RhdGlvbih4ID0gMCwgeSA9IDAsIHogPSAwKSB7CiAgICB0aGlzLkEgPSB4OwogICAgdGhpcy5CID0gejsKICAgIHRoaXMuQyA9IHk7CiAgfQoKICByb3RhdGUoeCwgeSwgeikgewogICAgbGV0IHsgQSwgQiwgQyB9ID0gdGhpczsKICAgIGxldCBhID0geDsKICAgIGxldCBiID0geSAqIGNvcyhBKSAtIHogKiBzaW4oQSk7CiAgICBsZXQgYyA9IHkgKiBzaW4oQSkgKyB6ICogY29zKEEpOwogICAgeCA9IGE7CiAgICB5ID0gYjsKICAgIHogPSBjOwogICAgYSA9IHggKiBjb3MoQikgKyB6ICogc2luKEIpOwogICAgYiA9IHk7CiAgICBjID0geCAqIC1zaW4oQikgKyB6ICogY29zKEIpOwogICAgeCA9IGE7CiAgICB5ID0gYjsKICAgIHogPSBjOwogICAgYSA9IHggKiBjb3MoQykgLSB5ICogc2luKEMpOwogICAgYiA9IHggKiBzaW4oQykgKyB5ICogY29zKEMpOwogICAgYyA9IHo7CgogICAgcmV0dXJuIFthLCBiLCBjXTsKICB9CgogIHVwZGF0ZShveCA9IDAsIG95ID0gMCwgc2NhbGUgPSAxLCBwaGkgPSAtUEkgLyA2KSB7CiAgICB0aGlzLm9mZnNldCA9IG5ldyBQb2ludChveCwgb3kpOwogICAgdGhpcy5zY2FsZSA9IHNjYWxlOwogICAgdGhpcy5waGkgPSBwaGk7CiAgfQoKICBwcm9qZWN0KHgsIHksIHopIHsKICAgIGNvbnN0IHsgb2Zmc2V0LCBzY2FsZSwgcGhpIH0gPSB0aGlzOwogICAgeCAqPSBzY2FsZTsKICAgIHkgKj0gc2NhbGU7CiAgICB6ICo9IHNjYWxlOwogICAgW3gsIHksIHpdID0gdGhpcy5yb3RhdGUoeCwgeSwgeik7CiAgICBjb25zdCBhID0geSwKICAgICAgYiA9IC16LAogICAgICBjID0gLXggLyAyOwoKICAgIHJldHVybiBuZXcgUG9pbnQoCiAgICAgIG9mZnNldC54ICsgYSArIGMgKiBjb3MocGhpKSwKICAgICAgb2Zmc2V0LnkgKyBiICsgYyAqIHNpbihwaGkpCiAgICApOwogIH0KfQoKbGV0IF9fcHJvamVjdG9yID0gbmV3IENhYmluZXRQcm9qZWN0b3IoKTsKLyoqCiAqIC4uLmRvY3MgZ28gaGVyZS4uLgogKi8KY2xhc3MgU2VnbWVudCB7CiAgb3ggPSAwOwogIG95ID0gMDsKICBwb2ludHMgPSBbXTsKICBpbnN0cnVjdGlvbnMgPSBbXTsKCiAgY2xvc2VkID0gZmFsc2U7CiAgc3ZnX2QgPSBgYDsKCiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLnBhdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoYGh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnYCwgYHBhdGhgKTsKICB9CgogIGFkZCh4LCB5KSB7CiAgICBjb25zdCB7IGNsb3NlZCwgcG9pbnRzIH0gPSB0aGlzOwogICAgaWYgKGNsb3NlZCkgcmV0dXJuOwogICAgY29uc3QgcCA9IHsgeCwgeSB9OwogICAgcG9pbnRzLnB1c2gocCk7CiAgICByZXR1cm4gcDsKICB9CgogIF9pbnN0cnVjdGlvbih0eXBlTmFtZSwgLi4uYXJncykgewogICAgbGV0IHBvaW50cyA9IGFyZ3M7CgogICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBgbnVtYmVyYCkgewogICAgICBwb2ludHMgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgICAgcG9pbnRzLnB1c2goeyB4OiBhcmdzW2ldLCB5OiBhcmdzW2kgKyAxXSB9KTsKICAgICAgfQogICAgfQoKICAgIC8vIHNlZSBkcmF3LnNwbGluZSguLi5hcmdzKQogICAgbGV0IFQgPSAxOwogICAgaWYgKHR5cGVOYW1lID09PSBgc3BsaW5lYCkgewogICAgICBpZiAoYXJncy5sZW5ndGggJSAyID09PSAxKSB7CiAgICAgICAgW1RdID0gYXJncy5zcGxpY2UoYXJncy5sZW5ndGggLSAxLCAxKTsKICAgICAgICBwb2ludHMucG9wKCk7CiAgICAgIH0KICAgIH0KCiAgICBwb2ludHMuZm9yRWFjaCgocCkgPT4gewogICAgICBjb25zdCBvcCA9IHsgW3R5cGVOYW1lXTogdHJ1ZSwgeDogcC54LCB5OiBwLnkgfTsKICAgICAgaWYgKHR5cGVOYW1lID09PSBgc3BsaW5lYCkgT2JqZWN0LmFzc2lnbihvcCwgeyBUIH0pOwogICAgICB0aGlzLmluc3RydWN0aW9ucy5wdXNoKG9wKTsKICAgIH0pOwoKICAgIHRoaXMudXBkYXRlU1ZHKCk7CiAgfQoKICBtb3ZlVG8oeCwgeSkgewogICAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHkgPSB4Lnk7CiAgICAgIHggPSB4Lng7CiAgICB9CiAgICAvLyBUT0RPOiBjb250aW51ZSBoZXJlLCBtYWtlIHBvaW50cyByZWFsIHBvaW50cwogICAgdGhpcy5faW5zdHJ1Y3Rpb24oYG1vdmVgLCB4LCB5KTsKICB9CgogIGxpbmVUbyguLi5hcmdzKSB7CiAgICAvLyBUT0RPOiBjb250aW51ZSBoZXJlLCBtYWtlIHBvaW50cyByZWFsIHBvaW50cwogICAgdGhpcy5faW5zdHJ1Y3Rpb24oYGxpbmVgLCAuLi5hcmdzKTsKICB9CgogIGN1cnZlVG8oLi4uYXJncykgewogICAgLy8gVE9ETzogY29udGludWUgaGVyZSwgbWFrZSBwb2ludHMgcmVhbCBwb2ludHMKICAgIHRoaXMuX2luc3RydWN0aW9uKGBiZXppZXJgLCAuLi5hcmdzKTsKICB9CgogIHNwbGluZVRvKC4uLmFyZ3MpIHsKICAgIC8vIFRPRE86IGNvbnRpbnVlIGhlcmUsIG1ha2UgcG9pbnRzIHJlYWwgcG9pbnRzCiAgICB0aGlzLl9pbnN0cnVjdGlvbihgc3BsaW5lYCwgLi4uYXJncyk7CiAgfQoKICB1cGRhdGVTVkcoKSB7CiAgICBsZXQgZCA9IGBgOwogICAgY29uc3Qgb3BzID0gdGhpcy5pbnN0cnVjdGlvbnMuc2xpY2UoKTsKICAgIHRoaXMucmVwbGFjZVNwbGluZVdpdGhCZXppZXJzKG9wcyk7CiAgICB3aGlsZSAob3BzLmxlbmd0aCkgewogICAgICBjb25zdCBvcCA9IG9wcy5zaGlmdCgpOwogICAgICBpZiAob3AubW92ZSkgZCA9IGBNICR7b3AueH0gJHtvcC55fWA7CiAgICAgIGlmIChvcC5saW5lKSBkID0gYCR7ZH0gTCAke29wLnh9ICR7b3AueX1gOwogICAgICBpZiAob3AuYmV6aWVyKSB7CiAgICAgICAgY29uc3Qgb3AyID0gb3BzLnNoaWZ0KCk7CiAgICAgICAgY29uc3Qgb3AzID0gb3BzLnNoaWZ0KCk7CiAgICAgICAgZCA9IGAke2R9IEMgJHtvcC54fSAke29wLnl9ICR7b3AyLnh9ICR7b3AyLnl9ICR7b3AzLnh9ICR7b3AzLnl9YDsKICAgICAgfQogICAgfQogICAgaWYgKHRoaXMuY2xvc2VkKSBkICs9IGAgWmA7CiAgICB0aGlzLnN2Z19kID0gZDsKICAgIHRoaXMucGF0aC5zZXRBdHRyaWJ1dGUoYGRgLCBkKTsKICB9CgogIGdldFNWRygpIHsKICAgIHJldHVybiBgPHBhdGggZmlsbD0iJHtfX2N0eC5maWxsU3R5bGV9IiBzdHJva2U9IiR7X19jdHguc3Ryb2tlU3R5bGV9IiBkPSIke3RoaXMuc3ZnX2R9Ii8+YDsKICB9CgogIGNsb3NlKCkgewogICAgdGhpcy5jbG9zZWQgPSB0cnVlOwogICAgdGhpcy51cGRhdGVTVkcoKTsKICB9CgogIG9mZnNldCh4LCB5KSB7CiAgICB0aGlzLm94ID0geDsKICAgIHRoaXMub3kgPSB5OwogIH0KCiAgY29tbWl0KCkgewogICAgY29uc3QgeyBveCwgb3ksIHBvaW50cyB9ID0gdGhpczsKICAgIHBvaW50cy5mb3JFYWNoKChwKSA9PiB7CiAgICAgIHAueCArPSBveDsKICAgICAgcC55ICs9IG95OwogICAgfSk7CiAgICB0aGlzLm94ID0gMDsKICAgIHRoaXMub3kgPSAwOwogIH0KCiAgaW5zaWRlKHgsIHkpIHsKICAgIGNvbnN0IHsgcGF0aCB9ID0gdGhpczsKICAgIHBhdGguc2V0QXR0cmlidXRlKGBkYCwgdGhpcy5zdmdfZCk7CiAgICByZXR1cm4gcGF0aC5pc1BvaW50SW5GaWxsKG5ldyBET01Qb2ludCh4LCB5KSk7CiAgfQoKICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgLy8gQ29kZSAqanVzdCogZm9yIGNvbnZlcnRpbmcgY2FyZGluYWwgc3BsaW5lcyBpbnRvIHBvbHktQmV6aWVycwogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgcmVwbGFjZVNwbGluZVdpdGhCZXppZXJzKG9wcykgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKG9wc1tpXS5zcGxpbmUpIHsKICAgICAgICB0aGlzLmNvbnZlcnRTcGxpbmUob3BzLCBpKTsKICAgICAgfQogICAgfQogIH0KCiAgY29udmVydFNwbGluZShvcHMsIGkpIHsKICAgIGNvbnN0IHNwbGluZXMgPSBbXTsKICAgIC8vIHJlbW92ZSB0aGUgc2VxdWVuY2Ugb2Ygc3BsaW5lIHBvaW50cyBzdGFydGluZyBhdCBvcHNbaV0KICAgIHdoaWxlIChvcHNbaV0gJiYgb3BzW2ldLnNwbGluZSkgc3BsaW5lcy5wdXNoKG9wcy5zcGxpY2UoaSwgMSlbMF0pOwogICAgLy8gaW5qZWN0IHRoZSBlcXVpdmFsZW50IGJlemllciBzZXF1ZW5jZQogICAgb3BzLnNwbGljZShpLCAwLCAuLi50aGlzLnNwbGluZVBvaW50c1RvQmV6aWVyUG9pbnRzKHNwbGluZXMsIG9wcywgaSkpOwogIH0KCiAgc3BsaW5lUG9pbnRzVG9CZXppZXJQb2ludHMoc3BsaW5lcywgb3BzLCBpKSB7CiAgICBsZXQgYmV6aWVycyA9IFtdOwogICAgbGV0IHExID0gb3BzLmF0KGkgLSAyKTsKICAgIGxldCBxMiA9IG9wcy5hdChpIC0gMSk7CiAgICBsZXQgcTMsIHE0OwogICAgbGV0IHAgPSBzcGxpbmVzWzBdOwoKICAgIC8vIFRoZSBmaXJzdCAgc2VnbWVudCBuZWVkcyBzcGVjaWFsIGhhbmRsaW5nIHRvCiAgICAvLyBlbnN1cmUgdGhlIGRlcGFydHVyZSB0YW5nZW50IGlzIGNvcnJlY3QuCiAgICBxMyA9IHNwbGluZXNbMV0gPz8gb3BzWzBdOwogICAgYmV6aWVycy5wdXNoKC4uLnRoaXMuZmlyc3RTcGxpbmVUb0JlemllcihxMSwgcTIsIHAsIHEzLCBvcHMsIGkpKTsKCiAgICAvLyBJbnRlcm1lZGlhdGUgc2VnbWVudHMgYXJlICJub3JtYWwgY29udmVyc2lvbiBtYXRoIi4KICAgIGZvciAobGV0IGogPSAxOyBqIDwgc3BsaW5lcy5sZW5ndGg7IGorKykgewogICAgICBxMSA9IHEyOwogICAgICBxMiA9IHA7CiAgICAgIHAgPSBzcGxpbmVzW2pdOwogICAgICBxMyA9IHNwbGluZXNbaiArIDFdID8/IG9wc1tpXSA/PyBvcHNbMF07CiAgICAgIGJlemllcnMucHVzaCguLi50aGlzLmZ1bGxTcGxpbmVUb0JlemllcihxMSwgcTIsIHAsIHEzLCBvcHMsIGkpKTsKICAgIH0KCiAgICAvLyBUaGUgbGFzdCBzZWdtZW50IG5lZWRzIHNwZWNpYWwgaGFuZGxpbmcgdG8KICAgIC8vIGVuc3VyZSB0aGUgYXJyaXZhbCB0YW5nZW50IGlzIGNvcnJlY3QuCiAgICBxMyA9IG9wc1tpXSA/PyBvcHNbMF07CiAgICBxNCA9IG9wc1tpICsgMV0gPz8gb3BzWzFdOwogICAgYmV6aWVycy5wdXNoKC4uLnRoaXMubGFzdFNwbGluZVRvQmV6aWVyKHEyLCBwLCBxMywgcTQsIG9wcywgaSkpOwoKICAgIHJldHVybiBiZXppZXJzOwogIH0KCiAgLy8gcDMgaXMgb3VyIHByaW5jaXBhbCBwb2ludAogIGZpcnN0U3BsaW5lVG9CZXppZXIocDEsIHAyLCBwMywgcDQsIG9wcywgaSkgewogICAgLy8gUmVwb3NpdGlvbiBwMSBzbyB0aGF0IHRoZSB0YW5nZW50IGF0CiAgICAvLyBwMiB3aWxsIG1hdGNoIHRoZSBhY3R1YWwgdGFuZ2VudCBhdCBwMi4KICAgIHAxID0gdGhpcy51cGRhdGVGcm9tVGFuZ2VudChwMSwgcDIsIHAzKTsKICAgIHJldHVybiB0aGlzLmZ1bGxTcGxpbmVUb0JlemllcihwMSwgcDIsIHAzLCBwNCwgb3BzLCBpKTsKICB9CgogIC8vIHAyIGlzIG91ciBwcmluY2lwYWwgcG9pbnQKICBsYXN0U3BsaW5lVG9CZXppZXIocDEsIHAyLCBwMywgcDQsIG9wcywgaSkgewogICAgLy8gUmVwb3NpdGlvbiBwNCBzbyB0aGF0IHRoZSB0YW5nZW50IGF0CiAgICAvLyBwMyB3aWxsIG1hdGNoIHRoZSBhY3R1YWwgdGFuZ2VudCBhdCBwMy4KICAgIHA0ID0gdGhpcy51cGRhdGVGcm9tVGFuZ2VudChwNCwgcDMsIHAyKTsKICAgIHJldHVybiB0aGlzLmZ1bGxTcGxpbmVUb0JlemllcihwMSwgcDIsIHAzLCBwNCwgb3BzLCBpKTsKICB9CgogIC8vIGNyZWF0ZSB0aGUgQmV6aWVyIGVxdWl2YWxlbnQgb2YgcDItLXAzCiAgZnVsbFNwbGluZVRvQmV6aWVyKHAxLCBwMiwgcDMsIHA0LCBvcHMsIGkpIHsKICAgIGNvbnN0IFQgPSBwMy5UID8/IHAyLlQgPz8gMTsKICAgIGNvbnN0IHRlbnNpb24gPSA2ICogVDsKICAgIHJldHVybiBbCiAgICAgIHsKICAgICAgICBiZXppZXI6IHRydWUsCiAgICAgICAgeDogcDIueCArIChwMy54IC0gcDEueCkgLyB0ZW5zaW9uLAogICAgICAgIHk6IHAyLnkgKyAocDMueSAtIHAxLnkpIC8gdGVuc2lvbiwKICAgICAgfSwKICAgICAgewogICAgICAgIGJlemllcjogdHJ1ZSwKICAgICAgICB4OiBwMy54IC0gKHA0LnggLSBwMi54KSAvIHRlbnNpb24sCiAgICAgICAgeTogcDMueSAtIChwNC55IC0gcDIueSkgLyB0ZW5zaW9uLAogICAgICB9LAogICAgICB7IGJlemllcjogdHJ1ZSwgeDogcDMueCwgeTogcDMueSB9LAogICAgXTsKICB9CgogIHVwZGF0ZUZyb21UYW5nZW50KHExLCBxMiwgcDMpIHsKICAgIC8vIE5vIG1hdHRlciB3aGV0aGVyIHExIGFuZCBxMiBhcmUgbGluZSBvcgogICAgLy8gYmV6aWVyIGNvb3JkaW5hdGVzLCB0aGUgbG9naWMgaXMgdGhlIHNhbWUuCiAgICByZXR1cm4gewogICAgICB0YW5nZW50Q29ycmVjdGlvbjogdHJ1ZSwKICAgICAgeDogcDMueCArIChxMS54IC0gcTIueCksCiAgICAgIHk6IHAzLnkgKyAocTEueSAtIHEyLnkpLAogICAgfTsKICB9Cn0KCi8qKgogKiAuLi5kb2NzIGdvIGhlcmUuLi4KICovCmNsYXNzIFNoYXBlIHsKICBzZWdtZW50cyA9IFtdOwogIHJlc2l6YWJsZSA9IGZhbHNlOwoKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMubmV3U2VnbWVudCgpOwogIH0KCiAgbWFrZU1vdmFibGUobW92YWJsZSA9IHRydWUpIHsKICAgIGlmIChtb3ZhYmxlKSB7CiAgICAgIHNldE1vdmFibGUodGhpcyk7CiAgICB9IGVsc2UgewogICAgICB1bnNldE1vdmFibGUodGhpcyk7CiAgICB9CiAgfQoKICBhbGxvd1Jlc2l6aW5nKGFsbG93ZWQgPSB0cnVlKSB7CiAgICB0aGlzLnJlc2l6YWJsZSA9IGFsbG93ZWQ7CiAgfQoKICBjbG9zZSgpIHsKICAgIHRoaXMubmV3U2VnbWVudCh0cnVlKTsKICB9CgogIG5ld1NlZ21lbnQoY2xvc2VDdXJyZW50ID0gZmFsc2UpIHsKICAgIGNvbnN0IHsgc2VnbWVudHMgfSA9IHRoaXM7CiAgICBpZiAoc2VnbWVudHMubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBzZWdtZW50cy5wdXNoKG5ldyBTZWdtZW50KCkpOwogICAgfQogICAgY29uc3QgY3VycmVudCA9IHNlZ21lbnRzLmF0KC0xKTsKICAgIGlmIChjdXJyZW50Py5wb2ludHMubGVuZ3RoIHx8IGN1cnJlbnQ/Lmluc3RydWN0aW9ucy5sZW5ndGgpIHsKICAgICAgaWYgKGNsb3NlQ3VycmVudCkgY3VycmVudC5jbG9zZSgpOwogICAgICBzZWdtZW50cy5wdXNoKG5ldyBTZWdtZW50KCkpOwogICAgfQogIH0KCiAgYWRkKHgsIHkpIHsKICAgIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgICB5ID0geC55OwogICAgICB4ID0geC54OwogICAgfQogICAgY29uc3QgcCA9IHRoaXMuc2VnbWVudHMuYXQoLTEpLmFkZCh4LCB5KTsKICAgIGlmICh0aGlzLnJlc2l6YWJsZSkgc2V0TW92YWJsZShwKTsKICAgIHRoaXMuX3N2ZyA9IGZhbHNlOwogIH0KCiAgbW92ZVRvKHgsIHkpIHsKICAgIHRoaXMubmV3U2VnbWVudCgpOwogICAgY29uc3QgcHRzID0gdGhpcy5zZWdtZW50cy5hdCgtMSkubW92ZVRvKHgsIHkpOwogICAgaWYgKHRoaXMucmVzaXphYmxlKSBwdHMuZm9yRWFjaCgocCkgPT4gc2V0TW92YWJsZShwKSk7CiAgICB0aGlzLl9zdmcgPSBmYWxzZTsKICB9CgogIGxpbmVUbyguLi5hcmdzKSB7CiAgICBjb25zdCBwdHMgPSB0aGlzLnNlZ21lbnRzLmF0KC0xKT8ubGluZVRvKC4uLmFyZ3MpOwogICAgaWYgKHRoaXMucmVzaXphYmxlKSBwdHMuZm9yRWFjaCgocCkgPT4gc2V0TW92YWJsZShwKSk7CiAgICB0aGlzLl9zdmcgPSBmYWxzZTsKICB9CgogIGN1cnZlVG8oLi4uYXJncykgewogICAgY29uc3QgcHRzID0gdGhpcy5zZWdtZW50cy5hdCgtMSk/LmN1cnZlVG8oLi4uYXJncyk7CiAgICBpZiAodGhpcy5yZXNpemFibGUpIHB0cy5mb3JFYWNoKChwKSA9PiBzZXRNb3ZhYmxlKHApKTsKICAgIHRoaXMuX3N2ZyA9IGZhbHNlOwogIH0KCiAgc3BsaW5lVG8oLi4uYXJncykgewogICAgY29uc3QgcHRzID0gdGhpcy5zZWdtZW50cy5hdCgtMSk/LnNwbGluZVRvKC4uLmFyZ3MpOwogICAgaWYgKHRoaXMucmVzaXphYmxlKSBwdHMuZm9yRWFjaCgocCkgPT4gc2V0TW92YWJsZShwKSk7CiAgICB0aGlzLl9zdmcgPSBmYWxzZTsKICB9CgogIG9mZnNldCh4LCB5LCBzZWdtZW50SWQgPSB1bmRlZmluZWQpIHsKICAgIGNvbnN0IHsgc2VnbWVudHMgfSA9IHRoaXM7CiAgICBpZiAoc2VnbWVudElkICE9PSB1bmRlZmluZWQpIHsKICAgICAgc2VnbWVudHNbc2VnbWVudElkXS5vZmZzZXQoeCwgeSk7CiAgICB9IGVsc2UgewogICAgICBzZWdtZW50cy5mb3JFYWNoKChwKSA9PiBwLm9mZnNldCh4LCB5KSk7CiAgICB9CiAgfQoKICBjb21taXQoKSB7CiAgICB0aGlzLnNlZ21lbnRzLmZvckVhY2goKHApID0+IHAuY29tbWl0KCkpOwogIH0KCiAgcmVzZXQoKSB7CiAgICBzZWdtZW50cy5mb3JFYWNoKChwKSA9PiBwLm9mZnNldCgwLCAwKSk7CiAgfQoKICBidWlsZEltYWdlKHNob3dQb2ludHMpIHsKICAgIGNvbnN0IHN2ZyA9IGA8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJVVEYtOCI/Pgo8c3ZnIHdpZHRoPSIke3dpZHRofXB4IiBoZWlnaHQ9IiR7aGVpZ2h0fXB4IiB2aWV3Qm94PSIwIDAgJHt3aWR0aH0gJHtoZWlnaHR9IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMCI+CiAgJHt0aGlzLnNlZ21lbnRzLm1hcCgocykgPT4gcy5nZXRTVkcoc2hvd1BvaW50cykpfQo8L3N2Zz5gOwogICAgY29uc3QgaW1nID0gKHRoaXMuX2ltZyA9IG5ldyBJbWFnZSgpKTsKICAgIGltZy5zaG93UG9pbnRzID0gc2hvd1BvaW50czsKICAgIGltZy5sb2FkZWQgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICBpbWcub25sb2FkID0gKCkgPT4gcmVzb2x2ZSh0cnVlKTsKICAgIH0pOwogICAgaW1nLnNyYyA9IGBkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCR7YnRvYShzdmcpfWA7CiAgfQoKICBhc3luYyBkcmF3KHNob3dQb2ludHMgPSBmYWxzZSkgewogICAgaWYgKCF0aGlzLl9pbWcgfHwgdGhpcy5faW1nLnNob3dQb2ludHMgIT09IHNob3dQb2ludHMpIHsKICAgICAgdGhpcy5idWlsZEltYWdlKHNob3dQb2ludHMpOwogICAgfQogICAgYXdhaXQgdGhpcy5faW1nLmxvYWRlZDsKICAgIGltYWdlKHRoaXMuX2ltZyk7CiAgfQoKICBpbnNpZGUoeCwgeSkgewogICAgcmV0dXJuIHRoaXMuc2VnbWVudHMKICAgICAgLm1hcCgocywgaWQpID0+IHsKICAgICAgICBzLmlkID0gaWQ7CiAgICAgICAgcmV0dXJuIHM7CiAgICAgIH0pCiAgICAgIC5maWx0ZXIoKHMpID0+IHMuaW5zaWRlKHgsIHkpKTsKICB9Cn0KY2xhc3MgVmVjdG9yIHsKICBjb25zdHJ1Y3Rvcih4LCB5LCB6KSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgewogICAgICB6ID0geC56OwogICAgICB5ID0geC55OwogICAgICB4ID0geC54OwogICAgfQogICAgdGhpcy54ID0geDsKICAgIHRoaXMueSA9IHk7CiAgICBpZiAoeiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMueiA9IHo7CiAgICB9CiAgfQoKICBkaXN0KG90aGVyLCB5LCB6ID0gMCkgewogICAgaWYgKHkgIT09IHVuZGVmaW5lZCkgb3RoZXIgPSB7IHg6IG90aGVyLCB5LCB6IH07CiAgICBsZXQgc3VtID0gMDsKICAgIHN1bSArPSAodGhpcy54IC0gb3RoZXIueCkgKiogMjsKICAgIHN1bSArPSAodGhpcy55IC0gb3RoZXIueSkgKiogMjsKICAgIGxldCB6MSA9IHRoaXMueiA/IHRoaXMueiA6IDA7CiAgICBsZXQgejIgPSBvdGhlci56ID8gb3RoZXIueiA6IDA7CiAgICBzdW0gKz0gKHoxIC0gejIpICoqIDI7CiAgICByZXR1cm4gc3VtICoqIDAuNTsKICB9CgogIG5vcm1hbGl6ZShmKSB7CiAgICBsZXQgbWFnID0gdGhpcy5kaXN0KDAsIDAsIDApOwogICAgcmV0dXJuIG5ldyBWZWN0b3IoCiAgICAgIChmICogdGhpcy54KSAvIG1hZywKICAgICAgKGYgKiB0aGlzLnkpIC8gbWFnLAogICAgICAoZiAqIHRoaXMueikgLyBtYWcKICAgICk7CiAgfQoKICBnZXRBbmdsZSgpIHsKICAgIHJldHVybiAtTWF0aC5hdGFuMih0aGlzLnksIHRoaXMueCk7CiAgfQoKICByZWZsZWN0KG90aGVyKSB7CiAgICBsZXQgcCA9IG5ldyBWZWN0b3Iob3RoZXIueCAtIHRoaXMueCwgb3RoZXIueSAtIHRoaXMueSk7CiAgICBpZiAob3RoZXIueiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHAueiA9IG90aGVyLno7CiAgICAgIGlmICh0aGlzLnogIT09IHVuZGVmaW5lZCkgewogICAgICAgIHAueiAtPSB0aGlzLno7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0aGlzLnN1YnRyYWN0KHApOwogIH0KCiAgYWRkKG90aGVyKSB7CiAgICBsZXQgcCA9IG5ldyBWZWN0b3IodGhpcy54ICsgb3RoZXIueCwgdGhpcy55ICsgb3RoZXIueSk7CiAgICBpZiAodGhpcy56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcC56ID0gdGhpcy56OwogICAgICBpZiAob3RoZXIueiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcC56ICs9IG90aGVyLno7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwOwogIH0KCiAgc3VidHJhY3Qob3RoZXIpIHsKICAgIGxldCBwID0gbmV3IFZlY3Rvcih0aGlzLnggLSBvdGhlci54LCB0aGlzLnkgLSBvdGhlci55KTsKICAgIGlmICh0aGlzLnogIT09IHVuZGVmaW5lZCkgewogICAgICBwLnogPSB0aGlzLno7CiAgICAgIGlmIChvdGhlci56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBwLnogLT0gb3RoZXIuejsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHA7CiAgfQoKICBzY2FsZShmID0gMSkgewogICAgaWYgKGYgPT09IDApIHsKICAgICAgcmV0dXJuIG5ldyBWZWN0b3IoMCwgMCwgdGhpcy56ID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiAwKTsKICAgIH0KICAgIGxldCBwID0gbmV3IFZlY3Rvcih0aGlzLnggKiBmLCB0aGlzLnkgKiBmKTsKICAgIGlmICh0aGlzLnogIT09IHVuZGVmaW5lZCkgewogICAgICBwLnogPSB0aGlzLnogKiBmOwogICAgfQogICAgcmV0dXJuIHA7CiAgfQp9Cg=="),R=class extends h{static{l(this,"GraphicsElement")}set onload(e){this._onload=e}set onerror(e){this._onerror=e}handleAttributeChange(...e){}handleChildChanges(...e){}connectedCallback(){super.connectedCallback(),this.label=document.createElement("label"),this.title||(console.warn("<graphics-element> is missing a title attribute. Always caption your figures."),this.title=""),this.label.textContent=this.title,M(this)?this.loadSource():new IntersectionObserver((e,x)=>e.forEach(t=>{t.isIntersecting&&(this.loadSource(),x.disconnect())}),{threshold:.1,rootMargin:`${window.innerHeight}px`}).observe(this)}getStyle(){return`
>>>>>>> afd0eea (had an idea)
=======
var v=Object.defineProperty;var l=(n,e)=>v(n,"name",{value:e,configurable:!0});var T="registered as custom element";function y(n,e){console.warn(`missing implementation for ${e}(...data) in ${n.__proto__.constructor.name}`)}l(y,"NotImplemented");function G(n){return n.prototype.constructor.name.replace(/([A-Z])([a-z])/g,(e,x,t,$)=>{let r=`${x.toLowerCase()}${t}`;return $>0?`-${r}`:r})}l(G,"getElementTagName");var h=class extends HTMLElement{static{l(this,"CustomElement")}static register(e){if(!e[T]){let x=e.tagName||G(e);return customElements.define(x,e),e[T]=!0,customElements.whenDefined(x)}return Promise.resolve()}static get tagName(){return G(this)}constructor(e={}){super(),customElements.resolveScope||(customElements.resolveScope=function($){try{return $.getRootNode().host}catch(r){console.warn(r)}return window}),this._options=e;let x={childList:$=>{this.handleChildChanges(Array.from($.addedNodes),Array.from($.removedNodes)),this.render()},attributes:$=>{this.handleAttributeChange($.attributeName,$.oldValue,this.getAttribute($.attributeName)),this.render()}};this._observer=new MutationObserver($=>{this.isConnected&&$.forEach(r=>{x[r.type](r)})}),this._observer.observe(this,{childList:!0,attributes:!0});let t={mode:"open"};this._shadow=this.attachShadow(t),this._style=document.createElement("style"),this._style.textContent=this.getStyle(),this._options.header!==!1&&(this._header=document.createElement("header")),this._options.slot!==!1&&this._options.void!==!0&&(this._slot=document.createElement("slot")),this._options.footer!==!1&&(this._footer=document.createElement("footer"))}connectedCallback(){this.render()}handleChildChanges(e,x){this._options.void||y(this,"handleChildChanges")}handleAttributeChange(e,x,t){y(this,"handleAttributeChange")}getStyle(){return""}render(){this._shadow.innerHTML="",this._shadow.append(this._style),this._options.header!==!1&&this._shadow.append(this._header),this._options.slot!==!1&&this._shadow.append(this._slot),this._options.footer!==!1&&this._shadow.append(this._footer)}};var O=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREEN","DARKGREY","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREEN","GREENYELLOW","GREY","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREEN","LIGHTGREY","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TRANSPARENT","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN"],w={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(128, 128, 128)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",transparent:"rgba(0,0,0,0)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",ALICEBLUE:"rgb(240, 248, 255)",ANTIQUEWHITE:"rgb(250, 235, 215)",AQUA:"rgb(0, 255, 255)",AQUAMARINE:"rgb(127, 255, 212)",AZURE:"rgb(240, 255, 255)",BEIGE:"rgb(245, 245, 220)",BISQUE:"rgb(255, 228, 196)",BLACK:"rgb(0, 0, 0)",BLANCHEDALMOND:"rgb(255, 235, 205)",BLUE:"rgb(0, 0, 255)",BLUEVIOLET:"rgb(138, 43, 226)",BROWN:"rgb(165, 42, 42)",BURLYWOOD:"rgb(222, 184, 135)",CADETBLUE:"rgb(95, 158, 160)",CHARTREUSE:"rgb(127, 255, 0)",CHOCOLATE:"rgb(210, 105, 30)",CORAL:"rgb(255, 127, 80)",CORNFLOWERBLUE:"rgb(100, 149, 237)",CORNSILK:"rgb(255, 248, 220)",CRIMSON:"rgb(220, 20, 60)",CYAN:"rgb(0, 255, 255)",DARKBLUE:"rgb(0, 0, 139)",DARKCYAN:"rgb(0, 139, 139)",DARKGOLDENROD:"rgb(184, 134, 11)",DARKGRAY:"rgb(169, 169, 169)",DARKGREEN:"rgb(0, 100, 0)",DARKGREY:"rgb(169, 169, 169)",DARKKHAKI:"rgb(189, 183, 107)",DARKMAGENTA:"rgb(139, 0, 139)",DARKOLIVEGREEN:"rgb(85, 107, 47)",DARKORANGE:"rgb(255, 140, 0)",DARKORCHID:"rgb(153, 50, 204)",DARKRED:"rgb(139, 0, 0)",DARKSALMON:"rgb(233, 150, 122)",DARKSEAGREEN:"rgb(143, 188, 143)",DARKSLATEBLUE:"rgb(72, 61, 139)",DARKSLATEGRAY:"rgb(47, 79, 79)",DARKSLATEGREY:"rgb(47, 79, 79)",DARKTURQUOISE:"rgb(0, 206, 209)",DARKVIOLET:"rgb(148, 0, 211)",DEEPPINK:"rgb(255, 20, 147)",DEEPSKYBLUE:"rgb(0, 191, 255)",DIMGRAY:"rgb(105, 105, 105)",DIMGREY:"rgb(105, 105, 105)",DODGERBLUE:"rgb(30, 144, 255)",FIREBRICK:"rgb(178, 34, 34)",FLORALWHITE:"rgb(255, 250, 240)",FORESTGREEN:"rgb(34, 139, 34)",FUCHSIA:"rgb(255, 0, 255)",GAINSBORO:"rgb(220, 220, 220)",GHOSTWHITE:"rgb(248, 248, 255)",GOLD:"rgb(255, 215, 0)",GOLDENROD:"rgb(218, 165, 32)",GRAY:"rgb(128, 128, 128)",GREEN:"rgb(0, 128, 0)",GREENYELLOW:"rgb(173, 255, 47)",GREY:"rgb(128, 128, 128)",HONEYDEW:"rgb(240, 255, 240)",HOTPINK:"rgb(255, 105, 180)",INDIANRED:"rgb(205, 92, 92)",INDIGO:"rgb(75, 0, 130)",IVORY:"rgb(255, 255, 240)",KHAKI:"rgb(240, 230, 140)",LAVENDER:"rgb(230, 230, 250)",LAVENDERBLUSH:"rgb(255, 240, 245)",LAWNGREEN:"rgb(124, 252, 0)",LEMONCHIFFON:"rgb(255, 250, 205)",LIGHTBLUE:"rgb(173, 216, 230)",LIGHTCORAL:"rgb(240, 128, 128)",LIGHTCYAN:"rgb(224, 255, 255)",LIGHTGOLDENRODYELLOW:"rgb(250, 250, 210)",LIGHTGRAY:"rgb(211, 211, 211)",LIGHTGREEN:"rgb(144, 238, 144)",LIGHTGREY:"rgb(211, 211, 211)",LIGHTPINK:"rgb(255, 182, 193)",LIGHTSALMON:"rgb(255, 160, 122)",LIGHTSEAGREEN:"rgb(32, 178, 170)",LIGHTSKYBLUE:"rgb(135, 206, 250)",LIGHTSLATEGRAY:"rgb(119, 136, 153)",LIGHTSLATEGREY:"rgb(119, 136, 153)",LIGHTSTEELBLUE:"rgb(176, 196, 222)",LIGHTYELLOW:"rgb(255, 255, 224)",LIME:"rgb(0, 255, 0)",LIMEGREEN:"rgb(50, 205, 50)",LINEN:"rgb(250, 240, 230)",MAGENTA:"rgb(255, 0, 255)",MAROON:"rgb(128, 0, 0)",MEDIUMAQUAMARINE:"rgb(102, 205, 170)",MEDIUMBLUE:"rgb(0, 0, 205)",MEDIUMORCHID:"rgb(186, 85, 211)",MEDIUMPURPLE:"rgb(147, 112, 219)",MEDIUMSEAGREEN:"rgb(60, 179, 113)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",MEDIUMSPRINGGREEN:"rgb(0, 250, 154)",MEDIUMTURQUOISE:"rgb(72, 209, 204)",MEDIUMVIOLETRED:"rgb(199, 21, 133)",MIDNIGHTBLUE:"rgb(25, 25, 112)",MINTCREAM:"rgb(245, 255, 250)",MISTYROSE:"rgb(255, 228, 225)",MOCCASIN:"rgb(255, 228, 181)",NAVAJOWHITE:"rgb(255, 222, 173)",NAVY:"rgb(0, 0, 128)",OLDLACE:"rgb(253, 245, 230)",OLIVE:"rgb(128, 128, 0)",OLIVEDRAB:"rgb(107, 142, 35)",ORANGE:"rgb(255, 165, 0)",ORANGERED:"rgb(255, 69, 0)",ORCHID:"rgb(218, 112, 214)",PALEGOLDENROD:"rgb(238, 232, 170)",PALEGREEN:"rgb(152, 251, 152)",PALETURQUOISE:"rgb(175, 238, 238)",PALEVIOLETRED:"rgb(219, 112, 147)",PAPAYAWHIP:"rgb(255, 239, 213)",PEACHPUFF:"rgb(255, 218, 185)",PERU:"rgb(205, 133, 63)",PINK:"rgb(255, 192, 203)",PLUM:"rgb(221, 160, 221)",POWDERBLUE:"rgb(176, 224, 230)",PURPLE:"rgb(128, 0, 128)",REBECCAPURPLE:"rgb(102, 51, 153)",RED:"rgb(255, 0, 0)",ROSYBROWN:"rgb(188, 143, 143)",ROYALBLUE:"rgb(65, 105, 225)",SADDLEBROWN:"rgb(139, 69, 19)",SALMON:"rgb(250, 128, 114)",SANDYBROWN:"rgb(244, 164, 96)",SEAGREEN:"rgb(46, 139, 87)",SEASHELL:"rgb(255, 245, 238)",SIENNA:"rgb(160, 82, 45)",SILVER:"rgb(192, 192, 192)",SKYBLUE:"rgb(135, 206, 235)",SLATEBLUE:"rgb(106, 90, 205)",SLATEGRAY:"rgb(112, 128, 144)",SLATEGREY:"rgb(112, 128, 144)",SNOW:"rgb(255, 250, 250)",SPRINGGREEN:"rgb(0, 255, 127)",STEELBLUE:"rgb(70, 130, 180)",TAN:"rgb(210, 180, 140)",TEAL:"rgb(0, 128, 128)",THISTLE:"rgb(216, 191, 216)",TOMATO:"rgb(255, 99, 71)",TRANSPARENT:"rgba(0,0,0,0)",TURQUOISE:"rgb(64, 224, 208)",VIOLET:"rgb(238, 130, 238)",WHEAT:"rgb(245, 222, 179)",WHITE:"rgb(255, 255, 255)",WHITESMOKE:"rgb(245, 245, 245)",YELLOW:"rgb(255, 255, 0)",YELLOWGREEN:"rgb(154, 205, 50)"};function S(n,e,x,t,$,m,E){var i,s,f,a,o=x.length,g=x[0].length;if(e<1)throw new Error("degree must be at least 1 (linear)");if(e>o-1)throw new Error("degree must be less than or equal to point count - 1");if(!$)for($=[],i=0;i<o;i++)$[i]=1;if($.length<x.length&&($=$.concat($.slice(0,e))),t){if(t.length!==o+e+1)throw new Error("bad knot vector length")}else{var t=[];for(i=0;i<o+e+1;i++)t[i]=i}t.length===x.length&&(t=t.concat(t.slice(0,e)));var d=[e,t.length-1-e],A=t[d[0]],p=t[d[1]];if(E||(n=n*(p-A)+A),n<A||n>p)throw new Error("out of bounds");for(f=d[0];f<d[1]&&!(n>=t[f]&&n<=t[f+1]);f++);var b=[];for(i=0;i<o;i++){for(b[i]=[],s=0;s<g;s++)b[i][s]=x[i][s]*$[i];b[i][g]=$[i]}var u;for(a=1;a<=e+1;a++)for(i=f;i>f-e-1+a;i--)for(u=(n-t[i])/(t[i+e+1-a]-t[i]),s=0;s<g+1;s++)b[i][s]=(1-u)*b[i-1][s]+u*b[i][s];var m=m||[];for(i=0;i<g;i++)m[i]=b[f][i]/b[f][g];return m}l(S,"interpolate");var c=3,L=class{static{l(this,"BSpline")}constructor(e,x=!0){this.points=e,this.points=e.map(t=>t instanceof Array?t:[t.x,t.y]),this.formKnots(x),this.formWeights()}getLUT(e=100){let x=e-1;return[...new Array(e)].map((t,$)=>{let r=S($/x,c,this.points,this.knots,this.weights);return{x:r[0],y:r[1]}})}formKnots(e=!1){if(!e)return this.formUniformKnots();let x=[],t=this.points.length,$=t-c;for(let r=1;r<t-c;r++)x.push(r+c);for(let r=0;r<=c;r++)x=[c].concat(x);for(let r=0;r<=c;r++)x.push($+c);return this.knots=x}formUniformKnots(){return this.knots=[...new Array(this.points.length+c+1)].map((e,x)=>x)}formWeights(){return this.weights=this.points.map(e=>1)}};function I(n){let e=new TextEncoder().encode(n),x=String.fromCodePoint(...e);return btoa(x)}l(I,"base64");function U(n){let e=atob(n),x=Uint8Array.from(e,t=>t.codePointAt(0));return new TextDecoder().decode(x)}l(U,"decode64");function C(n){let e=/^(.*)\/([^.]+(\.([^\/?#]+))+)(\?[^#]*)?(#.*)?$/,x=n.match(e);if(x!==null){let{[1]:t,[2]:$,[4]:r}=x;n=t}return n}l(C,"getURLbase");function M(n){if(typeof window>"u"||typeof document>"u")return!0;var e=n.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}l(M,"isInViewport");var k=String(import.meta.url),B=U("Y29uc3QgQUxQSEFCRVRJQyA9IGBhbHBoYWJldGljYDsKY29uc3QgQVVUTyA9IGBhdXRvYDsKY29uc3QgQk9UVE9NID0gYGJvdHRvbWA7CmNvbnN0IEJPVFRPTV9MRUZUID0gYGJvdHRvbi1sZWZ0YDsKY29uc3QgQk9UVE9NX1JJR0hUID0gYGJvdHRvbS1yaWdodGA7CmNvbnN0IENFTlRFUiA9IGBjZW50ZXJgOwpjb25zdCBDT05TVFJBSU4gPSB0cnVlOwpjb25zdCBDUk9TUyA9IGBjcm9zc2hhaXJgOwpjb25zdCBFTkQgPSBgZW5kYDsKY29uc3QgSEFORCA9IGBwb2ludGVyYDsKY29uc3QgSEFOR0lORyA9IGBoYW5naW5nYDsKY29uc3QgSURFT0dSQVBISUMgPSBgaWRlb2dyYXBoaWNgOwpjb25zdCBMRUZUID0gYGxlZnRgOwpjb25zdCBNSURETEUgPSBgbWlkZGxlYDsKY29uc3QgUE9JTlRFUiA9IGBkZWZhdWx0YDsKY29uc3QgUklHSFQgPSBgcmlnaHRgOwpjb25zdCBTVEFSVCA9IGBzdGFydGA7CmNvbnN0IFRPUCA9IGB0b3BgOwpjb25zdCBUT1BfTEVGVCA9IGB0b3AtbGVmdGA7CmNvbnN0IFRPUF9SSUdIVCA9IGB0b3AtcmlnaHRgOwoKLy8gImludGVybmFsIiB2YXJzCgpsZXQgX19jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBjYW52YXNgKTsKX19jYW52YXMudGFiSW5kZXggPSAwOwpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBwb2ludGVyZG93bmAsICgpID0+IF9fY2FudmFzLmZvY3VzKCkpOwpsZXQgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwoKbGV0IF9fY3VycmVudF9jdXJzb3I7CmxldCBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19jdXJyZW50X2h1ZTsKbGV0IF9fZHJhd19ncmlkOwpsZXQgX19kcmF3aW5nOwpsZXQgX19lbGVtZW50OwpsZXQgX19maW5pc2hlZF9zZXR1cDsKbGV0IF9fZmlyc3Q7CmxldCBfX2ZvbnQ7CmxldCBfX2dyaWRfY29sb3I7CmxldCBfX2dyaWRfc3BhY2luZzsKbGV0IF9faGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19sYXN0X2ZyYW1lOwpsZXQgX19tb3ZhYmxlX3BvaW50czsKbGV0IF9fcmVkcmF3aW5nOwpsZXQgX19zaGFwZTsKbGV0IF9fc3RhcnRfdGltZTsKbGV0IF9fc3R5bGVfc3RhY2s7CmxldCBfX3RleHRTdHJva2U7Cgpjb25zdCBfX3BybmcgPSBuZXcgKGNsYXNzIHsKICBjb25zdHJ1Y3RvcihzZWVkID0gRGF0ZS5ub3coKSkgewogICAgdGhpcy5hID0gc2VlZDsKICB9CiAgcmVzZWVkKHNlZWQpIHsKICAgIHRoaXMuYSA9IHNlZWQ7CiAgfQogIG5leHQoKSB7CiAgICAvLyBTcGxpdE1peDMyLCBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDc1OTMzMTYvNzQwNTUzCiAgICBsZXQgeyBhIH0gPSB0aGlzOwogICAgYSB8PSAwOwogICAgYSA9IChhICsgMHg5ZTM3NzliOSkgfCAwOwogICAgbGV0IHQgPSBhIF4gKGEgPj4+IDE2KTsKICAgIHQgPSBNYXRoLmltdWwodCwgMHgyMWYwYWFhZCk7CiAgICB0ID0gdCBeICh0ID4+PiAxNSk7CiAgICB0ID0gTWF0aC5pbXVsKHQsIDB4NzM1YTJkOTcpOwogICAgdGhpcy5hID0gYTsKICAgIHJldHVybiAoKHQgPSB0IF4gKHQgPj4+IDE1KSkgPj4+IDApIC8gNDI5NDk2NzI5NjsKICB9Cn0pKCk7Cgphc3luYyBmdW5jdGlvbiBfX3Jlc2V0KGVsZW1lbnQgPSBfX2VsZW1lbnQpIHsKICBfX2VsZW1lbnQgPSBlbGVtZW50OwoKICAvLyBkZWZhdWx0IHZhcmlhYmxlIHZhbHVlcwogIF9fY3VycmVudF9jdXJzb3IgPSBgYXV0b2A7CiAgX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvciA9IGByZ2IoMCwyNTQsMTI0KWA7CiAgX19jdXJyZW50X2h1ZSA9IDA7CiAgX19kcmF3X2dyaWQgPSB0cnVlOwogIF9fZHJhd2luZyA9IGZhbHNlOwogIF9fZmluaXNoZWRfc2V0dXAgPSBmYWxzZTsKICBfX2ZvbnQgPSB7IGZhbWlseTogYHNhbnMtc2VyaWZgLCBzaXplOiAxNiwgd2VpZ2h0OiA0MDAgfTsKICBfX2dyaWRfY29sb3IgPSBgbGlnaHRncmV5YDsKICBfX2dyaWRfc3BhY2luZyA9IDIwOwogIF9faGlnaGxpZ2h0X2NvbG9yID0gZmFsc2U7CiAgX19tb3ZhYmxlX3BvaW50cyA9IFtdOwogIF9fcmVkcmF3aW5nID0gZmFsc2U7CiAgX19zaGFwZSA9IHVuZGVmaW5lZDsKICBfX3N0YXJ0X3RpbWUgPSBEYXRlLm5vdygpOwogIF9fc3R5bGVfc3RhY2sgPSBbXTsKICBfX3RleHRTdHJva2UgPSBgdHJhbnNwYXJlbnRgOwoKICBjdXJyZW50TW92YWJsZSA9IGZhbHNlOwogIHBsYXlpbmcgPSBmYWxzZTsKICBmcmFtZSA9IDA7CiAgcG9pbnRlci54ID0gMDsKICBwb2ludGVyLnkgPSAwOwogIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGtleWJvYXJkKS5mb3JFYWNoKChuKSA9PiBkZWxldGUga2V5Ym9hcmRbbl0pOwoKICAvLyBtYWtlIHN1cmUgd2UgZG9uJ3QgZG91YmxlLWdlbmVyYXRlIHRoZXNlOgogIGNsZWFyU2xpZGVycygpOwogIGNsZWFyQnV0dG9ucygpOwoKICAvLyBydW4gc2V0dXAKICBhd2FpdCBfX3NldHVwKCk7CiAgX19maW5pc2hlZF9zZXR1cCA9IHRydWU7CgogIC8vIHJ1biBmaXJzdCBkcmF3CiAgX19sYXN0X2ZyYW1lID0gRGF0ZS5ub3coKTsKICBhd2FpdCBfX2RyYXcoKTsKCiAgcmV0dXJuIHsgd2lkdGgsIGhlaWdodCB9Owp9CgpmdW5jdGlvbiBfX2hhbHQoKSB7CiAgcGxheWluZyA9IGZhbHNlOwogIF9fY2FudmFzID0gdW5kZWZpbmVkOwogIF9fY3R4ID0gdW5kZWZpbmVkOwogIF9fZmluaXNoZWRfc2V0dXAgPSBmYWxzZTsKICBfX2RyYXdpbmcgPSB0cnVlOwogIF9fcmVkcmF3aW5nID0gdHJ1ZTsKICBfX2ZpcnN0ID0gdW5kZWZpbmVkOwogIF9fbW92YWJsZV9wb2ludHMgPSB1bmRlZmluZWQ7CiAgX19jdXJyZW50X2N1cnNvciA9IHVuZGVmaW5lZDsKICBfX2N1cnJlbnRfaHVlID0gMDsKICBfX2ZvbnQgPSB1bmRlZmluZWQ7CiAgX19zdGFydF90aW1lID0gMDsKICBjbGVhclNsaWRlcnMoKTsKICBjbGVhckJ1dHRvbnMoKTsKfQoKZnVuY3Rpb24gX19nZXREZXNjcmlwdGlvbigpIHsKICBpZiAodHlwZW9mIGdldERlc2NyaXB0aW9uICE9PSBgdW5kZWZpbmVkYCkgcmV0dXJuIGdldERlc2NyaXB0aW9uKCk7Cn0KCmFzeW5jIGZ1bmN0aW9uIF9fc2V0dXAoKSB7CiAgaWYgKHR5cGVvZiBzZXR1cCAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IHNldHVwKCk7CiAgaWYgKHR5cGVvZiBfX21vcmVfc2V0dXAgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBfX21vcmVfc2V0dXAoKTsKICBpZiAoIXdpZHRoICYmICFoZWlnaHQpIHNldFNpemUoKTsKfQoKYXN5bmMgZnVuY3Rpb24gX19kcmF3KCkgewogIGlmICghX19maW5pc2hlZF9zZXR1cCkgcmV0dXJuOwogIGlmICghX19kcmF3aW5nKSB7CiAgICBfX2RyYXdpbmcgPSB0cnVlOwogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICAgIGZyYW1lRGVsdGEgPSBub3cgLSBfX2xhc3RfZnJhbWU7CiAgICBmcmFtZSsrOwogICAgcmVzZXRUcmFuc2Zvcm0oKTsKICAgIGlmICh0eXBlb2YgZHJhdyAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IGRyYXcoKTsKICAgIGlmICh0eXBlb2YgX19tb3JlX2RyYXcgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBfX21vcmVfZHJhdygpOwogICAgX19kcmF3aW5nID0gZmFsc2U7CiAgICBfX2xhc3RfZnJhbWUgPSBub3c7CiAgICBpZiAocGxheWluZykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IF9fZHJhdygpKTsKICB9Cn0KLyoqCiAqIFRoZSBjdXJyZW50IGZyYW1lIG51bWJlcgogKgogKiBAY29uc3RhbnQge251bWJlcn0KICovCmxldCBmcmFtZSA9IDA7CgovKioKICogVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgc2luY2UgdGhlIGxhc3QgZnJhbWUuCiAqCiAqIEBjb25zdGFudCB7bnVtYmVyfQogKi8KbGV0IGZyYW1lRGVsdGEgPSAwOwoKLyoqCiAqIFRoZSBoZWlnaHQgb2YgdGhlIGNhbnZhcyBpbiBwaXhlbHMKICoKICogQGNvbnN0YW50IHtudW1iZXJ9CiAqLwpsZXQgaGVpZ2h0ID0gMDsKCi8qKgogKiBUaGUgd2lkdGggb2YgdGhlIGNhbnZhcyBpbiBwaXhlbHMKICoKICogQGNvbnN0YW50IHtudW1iZXJ9CiAqLwpsZXQgd2lkdGggPSAwOwoKLyoqCiAqIFRoZSBjdXJyZW50IHBsYXkgc3RhdGUKICoKICogQGNvbnN0YW50IHtib29sZWFufQogKi8KbGV0IHBsYXlpbmcgPSBmYWxzZTsKCi8qKgogKiBUaGUgYHBvaW50ZXJgIG9iamVjdCByZXByZXNlbnRzIHRoZSBtb3VzZSBjdXJzb3IgKHdoZW4gdXNpbmcKICogYSBtb3VzZSkgb3IgZmluZ2VyIHBvc2l0aW9uIChmb3IgdG91Y2ggZGV2aWNlcyksIGFuZCBtb2RlbHMKICogc2V2ZXJhbCBhc3BlY3RzOgogKgogKiAtIGBhY3RpdmVgIChib29sZWFuKSBXaGV0aGVyIHRoZSBwb2ludGVyIGlzIGV2ZW4gb24gb3Igb3ZlciB0aGUgY2FudmFzLgogKiAtIGB4YCAobnVtYmVyKSBUaGUgcG9pbnRlcidzIHggb2Zmc2V0IGluIHBpeGVscyB3aXRoIHJlc3BlY3QgdG8gdGhlIGNhbnZhcwogKiAtIGB5YCAobnVtYmVyKSBUaGUgcG9pbnRlcidzIHkgb2Zmc2V0IGluIHBpeGVscyB3aXRoIHJlc3BlY3QgdG8gdGhlIGNhbnZhcwogKiAtIGBkb3duYCAoYm9vbGVhbikgV2hldGhlciB0aGUgcG9pbnRlciBpcyAiZW5nYWdlZCIgb3Igbm90CiAqIC0gYGRyYWdgIChib29sZWFuKSBXaGV0aGVyIGEgY2xpY2svdG91Y2gtZHJhZyBpcyBpbiBwcm9ncmVzcwogKiAtIGBtYXJrYCAoe3gseX0pIFdoZW4gZHJhZ2dpbmcsIHRoaXMgcmVwcmVzZW50cyB0aGUgb3JpZ2luYWwgY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnRlciAiZG93biIgZXZlbnQKICoKICogQGNvbnN0YW50IHtvYmplY3R9CiAqLwpjb25zdCBwb2ludGVyID0geyB4OiAwLCB5OiAwIH07CgovKioKICogSWYgYW55IHBvaW50cyB3ZXJlIHJlZ2lzdGVyZWQgYXMgbW92YWJsZSwgYW5kIHRoZSBwb2ludGVyIGlzCiAqIG5lYXIgZW5vdWdoIHRvIGEgbW92YWJsZSBwb2ludCwgdGhpcyB2YWx1ZSB3aWxsIHBvaW50IHRvCiAqIHRoYXQgbW92YWJsZSBwb2ludCwgb3IgYGZhbHNlYCBpZiB0aGUgcG9pbnRlciBpcyBub3QgbmVhcgogKiBhbnkgbW92YWJsZSBwb2ludCAob3IsIG9mIGNvdXJzZSwgdGhlcmUgYXJlIG5vIG1vdmFibGUgcG9pbnRzKQogKgogKiBAY29uc3RhbnQge1BvaW50TGlrZXxmYWxzZX0KICovCmxldCBjdXJyZW50TW92YWJsZSA9IGZhbHNlOwoKLyoqCiAqIFRoZSBga2V5Ym9hcmRgIG9iamVjdCBpcyBhIHRydXRoIHRhYmxlIHRoYXQgY2FuIGJlIGNoZWNrZWQgdG8KICogc2VlIGlmIGFueSBrZXkgaXMgY3VycmVudGx5IHByZXNzZWQsIGFuZCBpZiBzbywgd2hlbiB0aGF0CiAqIGtleXByZXNzIHdhcyBpbml0aWF0ZWQsIGJ5IHN0b3Jpbmc6CiAqCiAqIGBgYAogKiB7CiAqICAgW2tleTpzdHJpbmddOiBkYXRldGltZQogKiB9CiAqIGBgYAogKgogKiBXaGVuIGEga2V5IGlzIHJlbGVhc2VkLCBpdHMgbWFwcGluZyBpcyByZW1vdmVkIGVudGlyZWx5LAogKiByYXRoZXIgdGhhbiBpdCBiZWluZyBzZXQgdG8gYSBmYWxzZXkgdmFsdWUuCiAqCiAqIEBjb25zdGFudCB7b2JqZWN0fQogKi8KY29uc3Qga2V5Ym9hcmQgPSB7fTsKCi8vIGNvbnN0YW50cy4uLgpjb25zdCB7CiAgLyoqCiAgICogVGhlIHJhdGlvIG9mIGEgY2lyY2xlJ3MgY2lyY3VtZmVyZW5jZSB0byBpdHMgZGlhbWV0ZXIuCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUGkKICAgKgogICAqIEBjb25zdGFudCB7bnVtYmVyfQogICAqCiAgICogQHNlZSB7QGxpbmsgVEFVfQogICAqLwogIFBJLAoKICAvKioKICAgKiBUaGUgYmFzZSBmb3IgdGhlIG5hdHVyYWwgbG9nYXJpdGhtLgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0VfKG1hdGhlbWF0aWNhbF9jb25zdGFudCkKICAgKgogICAqIEBjb25zdGFudCB7bnVtYmVyfQogICAqLwogIEUsCn0gPSBNYXRoOwoKY29uc3QgewogIC8qKgogICAqIEEgdmVyeSBzbWFsbCB2YWx1ZSBmb3IgcGVyZm9ybWluZyBpbXByZWNpc2UgbWF0aCBvcGVyYXRpb25zCiAgICogc3VjaCBhcyBjaGVja2luZyB3aGV0aGVyIGEgdmFsdWUgaXMgYXBwcm94aW1hdGVseSB0aGUgc2FtZQogICAqIGFzIHNvbWUgb3RoZXIgdmFsdWUuCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKi8KICBlcHNpbG9uLAoKICAvKioKICAgKiBBIHZlcnkgbGFyZ2UgdmFsdWUgdGhhdCBjYW4gc3RpbGwgYmUgdXNlZCB0byBkcmF3IHRoaW5ncwogICAqIG9uIHRoZSBjYW52YXMgKHN1Y2ggYXMgbGluZXMgZnJvbSAtaHVnZSB0byAraHVnZSkuCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKi8KICBodWdlLAoKICAvKioKICAgKiBUaGUgcmF0aW8gb2YgYSBjaXJjbGUncyBjaXJjdW1mZXJlbmNlIHRvIGl0cyByYWRpdXMsIGkuZS4gMipQSQogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1R1cm5fKGFuZ2xlKSNUYXVfcHJvcG9zYWxzCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKgogICAqIEBzZWUge0BsaW5rIFBJfQogICAqLwogIFRBVSwKfSA9IHsgZXBzaWxvbjogMWUtMTAsIGh1Z2U6IDFfMDAwXzAwMCwgVEFVOiBQSSAqIDIgfTsKLyoqCiAqIEVuc3VyZSB0aGF0IHRoZXJlIGlzIG5vIGJvcmRlciBhcm91bmQgdGhlIGNhbnZhcyBlbGVtZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRCb3JkZXIoNSwgYHJlZGApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoYGNsaWNrIG1lYCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlclVwKHgsIHkpIHsKICogICAgICAgc2V0Qm9yZGVyKDUsIGByZWRgKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgsIHkpIHsKICogICAgICAgbm9Cb3JkZXIoKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRCb3JkZXJ9CiAqLwpmdW5jdGlvbiBub0JvcmRlcigpIHsKICBzZXRCb3JkZXIoZmFsc2UpOwp9CgovKioKICogRGlzYWJsZSBib3RoIHN0cm9rZSBhbmQgZmlsbCBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KGBOb3cgeW91IHNlZSBtZWAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub0NvbG9yKCk7CiAqICAgICAgIHRleHQoYE5vdyB5b3UgZG9uJ3RgLCB3aWR0aC8yLCBoZWlnaHQvMiArIDI1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRDb2xvcn0KICogQHNlZSB7QGxpbmsgbm9TdHJva2V9CiAqIEBzZWUge0BsaW5rIG5vRmlsbH0KICovCmZ1bmN0aW9uIG5vQ29sb3IoKSB7CiAgbm9GaWxsKCk7CiAgbm9TdHJva2UoKTsKfQoKLyoqCiAqIEhpZGUgdGhlIGN1cnNvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgI0ZGMDJgKTsKICogICAgICAgcmVjdCgwLCAwLCB3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgICBzZXRDb2xvcihgIzBGRjJgKTsKICogICAgICAgcmVjdCh3aWR0aC8yLCAwLCB3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlck1vdmUoeCwgeSkgewogKiAgICAgICBpZiAoeCA8IHdpZHRoLzIpIHsKICogICAgICAgICBzZXRDdXJzb3IoQVVUTyk7CiAqICAgICAgIH0gZWxzZSB7CiAqICAgICAgICAgbm9DdXJzb3IoKTsKICogICAgICAgfQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldEN1cnNvcn0KICovCmZ1bmN0aW9uIG5vQ3Vyc29yKCkgewogIF9fY2FudmFzLnN0eWxlLmN1cnNvciA9IGBub25lYDsKfQoKLyoqCiAqIERpc2FibGUgdGhlIGZpbGwgY29sb3IuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKDEpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcmVjdCgyMCwgNzAsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYGZpbGxlZGAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgcmVjdCgzMCwgODAsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYG5vdCBmaWxsZWRgLCB3aWR0aC8yLCBoZWlnaHQvMiArIDI1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRGaWxsfQogKi8KZnVuY3Rpb24gbm9GaWxsKCkgewogIHNldEZpbGwoYHRyYW5zcGFyZW50YCk7Cn0KCi8qKgogKiBEaXNhYmxlIHRoZSBkZWZhdWx0IGdyaWQgYmFja2dyb3VuZC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KGBjbGljayBtZWAsIHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJVcCh4LCB5KSB7CiAqICAgICAgIHNldEdyaWQoMjAsIGBsaWdodGdyZXlgKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgsIHkpIHsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICAgIHJlZHJhdygpCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2V0R3JpZH0KICovCmZ1bmN0aW9uIG5vR3JpZCgpIHsKICBfX2RyYXdfZ3JpZCA9IGZhbHNlOwp9CgovKioKICogU2V0IHRoZSBsaW5lIHN0cm9rZSB0byAic29saWQiLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRMaW5lRGFzaCgxKTsKICogICAgICAgbGluZSgwLDIwLHdpZHRoLDUwKTsKICogICAgICAgc2V0TGluZURhc2goNSk7CiAqICAgICAgIGxpbmUoMCwzMCx3aWR0aCw5MCk7CiAqICAgICAgIHNldExpbmVEYXNoKDEsMiwzLDQpOwogKiAgICAgICBsaW5lKDAsNDAsd2lkdGgsMTMwKTsKICogICAgICAgbm9MaW5lRGFzaCgpOwogKiAgICAgICBsaW5lKDAsNTAsd2lkdGgsMTgwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRMaW5lRGFzaH0KICovCgpmdW5jdGlvbiBub0xpbmVEYXNoKCkgewogIF9fY3R4LnNldExpbmVEYXNoKFtdKTsKfQoKLyoqCiAqIERpc2FibGUgdGhlIHN0cm9rZSBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICByZWN0KDIwLCA3MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub1N0cm9rZSgpOwogKiAgICAgICByZWN0KDQyLCA4MiwgMjAsIDIwKTsKICogICAgICAgdGV4dChgbm90IHN0cm9rZWRgLCB3aWR0aC8yLCBoZWlnaHQvMiArIDI1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRTdHJva2V9CiAqLwoKZnVuY3Rpb24gbm9TdHJva2UoKSB7CiAgc2V0U3Ryb2tlKGB0cmFuc3BhcmVudGApOwp9CgovKioKICogRGlzYWJsZSB0ZXh0IHN0cm9raW5nLCBidXQgbm90IHJlZ3VsYXIgc2hhcGUgc3Ryb2tpbmcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKDEpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgcmVjdCgyMCwgNzAsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYHN0cm9rZWRgLCB3aWR0aC8yLCBoZWlnaHQvMiAtIDI1KTsKICogICAgICAgbm9UZXh0U3Ryb2tlKCk7CiAqICAgICAgIHJlY3QoNDIsIDgyLCAyMCwgMjApOwogKiAgICAgICB0ZXh0KGBub3Qgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldFRleHRTdHJva2V9CiAqLwoKZnVuY3Rpb24gbm9UZXh0U3Ryb2tlKCkgewogIHNldFRleHRTdHJva2UoZmFsc2UsIHVuZGVmaW5lZCk7Cn0KLyoqCiAqIEFkZCBhIHNsaWRlciB0byB5b3VyIGZpZ3VyZSwgYWxsb3dpbmcgdXNlcnMgdG8gY29udHJvbAogKiBhIHZhcmlhYmxlIGluIHlvdXIgZ3JhcGhpY3MgY29kZSBkaXJlY3RseSBieSBpbnRlcmFjdGluZwogKiB3aXRoIHRoYXQgb24tcGFnZSBzbGlkZXIsIHdoaWNoIGlzIGVzcGVjaWFsbHkgaW1wb3J0YW50IGlmCiAqIHlvdSB3YW50IHlvdXIgZ3JhcGhpY3MgdG8gYmUgdXNlYWJsZSBieSB1c2VycyB3aG8gZG9uJ3QKICogaGF2ZSwgb3IgY2Fubm90IHVzZSwgYSBtb3VzZS4KICoKICogVGhlIGBwcm9wTGFiZWxgIHZhbHVlIHNob3VsZCBiZSB0aGUgbmFtZSBvZiB0aGUgdmFyaWFibGUKICogdGhhdCB5b3VyIGdyYXBoaWNzIGNvZGUgdXNlcywgYW5kIHNob3VsZCBfbm90XyBiZSAicHJlYWxsb2NhdGVkIgogKiBpbiB5b3VyIGNvZGUgd2l0aCBhIGNvbnN0LCBsZXQsIG9yIHZhcjogaXQgd2lsbCBhdXRvbWF0aWNhbGx5CiAqIGdldCBhZGRlZCBhcyBwYXJ0IG9mIHRoZSBzb3VyY2UgbG9hZGluZyBwcm9jZXNzLgogKgogKiBUaGUgb3B0aW9ucyBvYmplY3QgYWNjZXB0cyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXMgYW5kIHZhbHVlczoKICoKICogLSBtaW4gLSB0aGUgc2xpZGVyJ3MgbWluaW11bSB2YWx1ZSwgZGVmYXVsdHMgdG8gMAogKiAtIG1heCAtIHRoZSBzbGlkZXIncyBtYXhpbXVtIHZhbHVlLCBkZWZhdWx0cyB0byAxCiAqIC0gc3RlcCAtIHRoZSBzdGVwIHNpemUsIGRlZmF1bHRzIHRvIChtYXggLSBtaW4pLzEwCiAqIC0gdmFsdWUgLSB0aGUgaW5pdGlhbCB2YWx1ZSwgZGVmYXVsdHMgdG8gKG1heCArIG1pbikvMgogKiAtIGNsYXNzZXMgLSB0aGUgQ1NTIGNsYXNzZXMgdGhhdCB3aWxsIGJlIHVzZWQsIGRlZmF1bHRzIHRvIGAic2xpZGVyImAKICogLSB0cmFuc2Zvcm0gLSBhIHZhbHVlIHByZXByb2Nlc3NvciAgZGVmYXVsdHMgdG8gKHYpID0+IHYKICoKICogVGhlIGB0cmFuc2Zvcm1gIHByZS1wcm9jZXNzb3IgcnVucyBhZnRlciB0aGUgdXNlciB1cGRhdGVzCiAqIHRoZSBzbGlkZXIsIGJ1dCBiZWZvcmUgaXRzIHZhbHVlIGdldHMgYXNzaWduZWQgdG8geW91ciB2YXJpYWJsZSwKICogc28gdGhhdCB5b3UgY2FuIG1hcCBpdCB0byBzb21ldGhpbmcgZWxzZSAoZm9yIGluc3RhbmNlLCBudW1iZXJzCiAqIGluIG9uZSByYW5nZSB0byBudW1iZXJzIGluIGEgY29tcGxldGVseSBkaWZmZXJlbnQgcmFuZ2UsIG9yIGV2ZW4KICogbnVtYmVycyB0byBzdHJpbmdzIG9yIGVudGlyZSBvYmplY3RzKQogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoNDAwLCAyMDApOwogKiAgICAgICBhZGRTbGlkZXIoYGJnQ29sb3JgLCB7CiAqICAgICAgICAgbWluOiAwLAogKiAgICAgICAgIG1heDogMjU1LAogKiAgICAgICAgIHN0ZXA6IDEsCiAqICAgICAgICAgdmFsdWU6IDIwMCwKICogICAgICAgICB0cmFuc2Zvcm06ICh2KSA9PiB7CiAqICAgICAgICAgICAvLyBjb252ZXJ0IHYgaW50byBhIGhleCBjb2xvciBjb2RlCiAqICAgICAgICAgICB2ID0gKHYpLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCBgMGApOwogKiAgICAgICAgICAgcmV0dXJuIGAjJHt2fSR7dn0ke3Z9YDsKICogICAgICAgICB9CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYmdDb2xvcik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IHZhck5hbWUgVGhlIG5hbWUgZm9yIHRoZSB2YXJpYWJsZSB0aGlzIHNsaWRlciBnZXRzIHRpZWQgdG8uCiAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIFNlZSBkZXNjcmlwdGlvbgogKiBAcmV0dXJucyB7SFRNTElucHV0RWxlbWVudH0gdGhlIEhUTUwgaW5wdXQgZWxlbWVudCBmb3IgdGhpcyBzbGlkZXIKICoKICogQHNlZSB7QGxpbmsgY2xlYXJTbGlkZXJzfQogKi8KZnVuY3Rpb24gYWRkU2xpZGVyKHByb3BMYWJlbCwgYXNzaWduLCBvcHRpb25zID0ge30pIHsKICBsZXQgewogICAgbWluLAogICAgbWF4LAogICAgc3RlcCwKICAgIHZhbHVlLAogICAgY2xhc3NlcyA9IGBzbGlkZXJgLAogICAgdHJhbnNmb3JtID0gKHYpID0+IHYsCiAgfSA9IG9wdGlvbnM7CgogIG1pbiA9IG1pbiA9PT0gdW5kZWZpbmVkID8gMCA6IG1pbjsKICBtYXggPSBtYXggPT09IHVuZGVmaW5lZCA/IDEgOiBtYXg7CiAgc3RlcCA9IHN0ZXAgPT09IHVuZGVmaW5lZCA/IChtYXggLSBtaW4pIC8gMTAgOiBzdGVwOwogIHZhbHVlID0gdmFsdWUgPT09IHVuZGVmaW5lZCA/IChtYXggKyBtaW4pIC8gMiA6IHZhbHVlOwoKICAvLyBjdXN0b20gInJvdW5kaW5nIiwgcHVyZWx5IGZvciBzdHJpbmdzCiAgY29uc3Qgcm91bmQgPSAodiwgZCA9IDQpID0+IHsKICAgIHYgPSBgJHt2fWA7CiAgICBjb25zdCBmcyA9IHYuaW5kZXhPZihgLmApOwogICAgaWYgKGZzICE9PSAtMSkgewogICAgICBsZXQgcHJlYyA9IGQgLSBmcyA+IDAgPyBkIC0gZnMgOiAwOwogICAgICB2ID0gdi5zdWJzdHJpbmcoMCwgZnMgKyBwcmVjKTsKICAgIH0KICAgIHJldHVybiB2OwogIH07CgogIGNvbnN0IGNyZWF0ZSA9ICh0YWcpID0+IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTsKCiAgbGV0IHNsaWRlciA9IGNyZWF0ZShgaW5wdXRgKTsKICBzbGlkZXIudHlwZSA9IGByYW5nZWA7CiAgc2xpZGVyLm1pbiA9IG1pbjsKICBzbGlkZXIubWF4ID0gbWF4OwogIHNsaWRlci5zdGVwID0gc3RlcDsKICBzbGlkZXIuc2V0QXR0cmlidXRlKGB2YWx1ZWAsIHZhbHVlKTsKICBzbGlkZXIuc2V0QXR0cmlidXRlKGBjbGFzc2AsIGNsYXNzZXMpOwoKICBjb25zdCB1cGRhdGUgPSAoeyB2YWx1ZSB9KSA9PiB7CiAgICB2YWx1ZUZpZWxkLnRleHRDb250ZW50ID0gcm91bmQodmFsdWUpOwogICAgYXNzaWduKHRyYW5zZm9ybShwYXJzZUZsb2F0KHZhbHVlKSkpOwogICAgaWYgKCFwbGF5aW5nKSByZWRyYXcoKTsKICB9OwoKICBzbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcihgaW5wdXRgLCAoeyB0YXJnZXQgfSkgPT4gdXBkYXRlKHRhcmdldCkpOwoKICBsZXQgdGFibGUgPSBfX2VsZW1lbnQucXVlcnlTZWxlY3RvcihgdGFibGUuc2xpZGVyLXdyYXBwZXJgKTsKICBpZiAoIXRhYmxlKSB7CiAgICB0YWJsZSA9IGNyZWF0ZShgdGFibGVgKTsKICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoYHNsaWRlci13cmFwcGVyYCk7CiAgICBfX2VsZW1lbnQucHJlcGVuZCh0YWJsZSk7CiAgfQogIGxldCB0ciA9IGNyZWF0ZShgdHJgKTsKCiAgbGV0IHRkID0gY3JlYXRlKGB0ZGApOwogIGxldCBsYWJlbCA9IGNyZWF0ZShgbGFiZWxgKTsKICBsYWJlbC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbGFiZWxgKTsKICBsYWJlbC5pbm5lckhUTUwgPSBwcm9wTGFiZWwKICAgIC5yZXBsYWNlKC9fKC4rKSQvLCBgPHN1Yj4kMTwvc3ViPmApCiAgICAucmVwbGFjZSgvKFxkKykvLCBgPHN1Yj4kMTwvc3ViPmApOwogIHRkLmFwcGVuZChsYWJlbCk7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLW1pbmApOwogIHRkLnRleHRDb250ZW50ID0gcm91bmQoc2xpZGVyLm1pbik7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdGQud2lkdGggPSBgKmA7CiAgdGQuYXBwZW5kKHNsaWRlcik7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLW1heGApOwogIHRkLnRleHRDb250ZW50ID0gcm91bmQoc2xpZGVyLm1heCk7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdmFyIHZhbHVlRmllbGQgPSBjcmVhdGUoYGxhYmVsYCk7IC8vIGZ1bmN0aW9uIHNjb3BlZAogIHZhbHVlRmllbGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLXZhbHVlYCk7CiAgdGQuYXBwZW5kKHZhbHVlRmllbGQpOwogIHRyLmFwcGVuZCh0ZCk7CiAgdGQuYWRkRXZlbnRMaXN0ZW5lcihgcG9pbnRlcmRvd25gLCAoKSA9PiB7CiAgICBjb25zdCB2YWx1ZSA9IHByb21wdChgbmV3IHZhbHVlP2AsIHNsaWRlci52YWx1ZSk7CiAgICBpZiAodmFsdWUgIT09IG51bGwpIHsKICAgICAgc2xpZGVyLnZhbHVlID0gdmFsdWU7CiAgICAgIHVwZGF0ZSh7IHZhbHVlIH0pOwogICAgfQogIH0pOwoKICB0YWJsZS5hcHBlbmQodHIpOwoKICB1cGRhdGUoc2xpZGVyKTsKICByZXR1cm4gc2xpZGVyOwp9CgovKioKICogUmVtb3ZlIGFsbCBzbGlkZXJzIGZvciB5b3VyIGZpZ3VyZSBmcm9tIHRoZSBwYWdlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRTbGlkZXIoYHhgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KGBjbGljayB0byBjbGVhcmAsIHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKCkgewogKiAgICAgICBjbGVhclNsaWRlcnMoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBhZGRTbGlkZXJ9CiAqLwoKZnVuY3Rpb24gY2xlYXJTbGlkZXJzKCkgewogIGNvbnN0IHRhYmxlID0gX19lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYHRhYmxlLnNsaWRlci13cmFwcGVyYCk7CiAgaWYgKHRhYmxlKSB0YWJsZS5pbm5lckhUTUwgPSBgYDsKfQoKLyoqCiAqIEFkZCBhIGJ1dHRvbiBiZWxvdyB5b3VyIGZpZ3VyZSB0aGF0IGNhbiB0cmlnZ2VyIGV2ZW50LWJhc2VkCiAqIGNvZGUsIHdoaWNoIGlzIGVzcGVjaWFsbHkgaW1wb3J0YW50IGlmIHlvdSB3YW50IHlvdXIgZ3JhcGhpY3MKICogdG8gYmUgdXNlYWJsZSBieSB1c2VycyB3aG8gZG9uJ3QgaGF2ZSwgb3IgY2Fubm90IHVzZSwgYSBtb3VzZS4KICoKICogb25DbGljayBpcyBzaW1pbGFyIHRvIHRoZSBzdGFuZGFyZCBKUyBldmVudCBoYW5kbGVyLCBleGNlcHQKICogdGhhdCB0aGUgY2FsbCBhcmd1bWVudCBpcyBhIHJlZmVyZW5jZSB0byB5b3VyIGJ1dHRvbiwgbm90CiAqIHRoZSBjbGljayBldmVudC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IGNvbG9ycyA9IFtgd2hpdGVgLCBgYmxhY2tgXTsKICogICAgIGxldCBiZ0NvbG9yID0gMDsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGBmbGlwIGJhY2tncm91bmRgLCAoYnV0dG9uKSA9PiB7CiAqICAgICAgICAgYmdDb2xvciA9IC0oYmdDb2xvciAtIDEpOwogKiAgICAgICAgIHJlZHJhdygpOwogKiAgICAgICB9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGNvbG9yc1tiZ0NvbG9yXSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGxhYmVsIFRoZSB0ZXh0IGxhYmVsIGZvciB5b3VyIGJ1dHRvbgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkNsaWNrIFRoZSBjbGljayBoYW5kbGluZyBmdW5jdGlvbiwgc2VlIGRlc2NyaXB0aW9uLgogKiBAcmV0dXJucyB7SFRNTEJ1dHRvbkVsZW1lbnR9IFRoZSBidXR0b24gZWxlbWVudCB0aGlzIGFkZGVkIHRvIHRoZSBwYWdlCiAqCiAqIEBzZWUge0BsaW5rIGNsZWFyQnV0dG9uc30KICovCmZ1bmN0aW9uIGFkZEJ1dHRvbihsYWJlbCwgb25DbGljaykgewogIGlmICghb25DbGljaykgdGhyb3cgbmV3IEVycm9yKGBhIGJ1dHRvbiBtdXN0IGhhdmUgYW4gb25DbGljayBoYW5kbGVyYCk7CiAgY29uc3QgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgYnV0dG9uYCk7CiAgYnRuLmNsYXNzTGlzdC5hZGQoYGdyYXBoaWNzLWVsZW1lbnQtYnV0dG9uYCk7CiAgYnRuLnRleHRDb250ZW50ID0gbGFiZWw7CiAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoYGNsaWNrYCwgKCkgPT4gb25DbGljayhidG4pKTsKICBfX2VsZW1lbnQucHJlcGVuZChidG4pOwogIHJldHVybiBidG47Cn0KCi8qKgogKiBSZW1vdmUgYWxsIGJ1dHRvbnMgZm9yIHlvdXIgZmlndXJlIGZyb20gdGhlIHBhZ2UuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGFkZEJ1dHRvbihgdGhpcyBkb2VzIG5vdGhpbmdgLCAoKSA9PiB7fSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dChgY2xpY2sgdG8gY2xlYXJgLCB3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bigpIHsKICogICAgICAgY2xlYXJCdXR0b25zKCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgYWRkQnV0dG9ufQogKi8KZnVuY3Rpb24gY2xlYXJCdXR0b25zKCkgewogIF9fZWxlbWVudAogICAgLnF1ZXJ5U2VsZWN0b3JBbGwoYGJ1dHRvbi5ncmFwaGljcy1lbGVtZW50LWJ1dHRvbmApCiAgICAuZm9yRWFjaCgoZSkgPT4gZS5yZW1vdmUoKSk7Cn0KLyoqCiAqIERyYXcgYSBjaXJjdWxhciBhcmMgd2l0aCByYWRpdXMgYHJgIGF0ICh4LHkpLAogKiBzdGFydGluZyBhdCBhbmdsZSBgc2AgYW5kIGVuZGluZyBhdCBhbmdsZSBgZWAuCiAqIElmIGB3ZWRnZWAgaXMgdHJ1ZSwgdGhpcyB3aWxsIGRyYXcgYSBjbG9zZWQKICogc2hhcGUgdGhhdCBpcyBhbmNob3JlZCBhdCAoeCx5KS4gSWYgb21pdHRlZAogKiBvciBleHBsaWNpdGx5IHNldCB0byBmYWxzZSwgdGhpcyB3aWxsIGRyYXcKICogYW4gb3BlbiBzaGFwZSB3aXRoIGEgZmlsbCB0aGF0IGNvbm5lY3RzIHRoZQogKiBmaXJzdCBhbmQgbGFzdCBwb2ludCBvbiB0aGUgYXJjLCBidXQgbm8gY2xvc2luZwogKiBzdHJva2UuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGAjRjAwMmApOwogKiAgICAgICBhcmMod2lkdGgvMiArIDMwLCBoZWlnaHQvMiAtIDQwLCA0MCwgMCwgMC42NipUQVUpOwogKiAgICAgICBhcmMod2lkdGgvMiAtIDMwLCBoZWlnaHQvMiArIDIwLCA0MCwgMCwgMC42NipUQVUsIHRydWUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBjaXJjdWxhciBjZW50ZXIgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgY2lyY3VsYXIgY2VudGVyIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHJhZGl1cyBUaGUgcmFkaXVzIG9mIHRoaXMgYXJjIGluIHBpeGVscwogKiBAcGFyYW0ge251bWJlcn0gc3RhcnRBbmdsZSBUaGUgc3RhcnQgYW5nbGUgZm9yIHRoaXMgYXJjIGluIHJhZGlhbnMKICogQHBhcmFtIHtudW1iZXJ9IGVuZEFuZ2xlIFRoZSBlbmQgYW5nbGUgZm9yIHRoaXMgYXJjIGluIHJhZGlhbnMKICogQHBhcmFtIHtib29sZWFufSBkcmF3V2VkZ2UgQSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0byBkcmF3IGEgd2VkZ2Ugb3IgY2FwcGVkIGNpcmNsZSAoZGVmYXVsdD1jaXJjbGUpCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwb2ludCBUaGUgY2lyY3VsYXIgY2VudGVyIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHJhZGl1cyBUaGUgcmFkaXVzIG9mIHRoaXMgYXJjIGluIHBpeGVscwogKiBAcGFyYW0ge251bWJlcn0gc3RhcnRBbmdsZSBUaGUgc3RhcnQgYW5nbGUgZm9yIHRoaXMgYXJjIGluIHJhZGlhbnMKICogQHBhcmFtIHtudW1iZXJ9IGVuZEFuZ2xlIFRoZSBlbmQgYW5nbGUgZm9yIHRoaXMgYXJjIGluIHJhZGlhbnMKICogQHBhcmFtIHtib29sZWFufSBkcmF3V2VkZ2UgQSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0byBkcmF3IGEgd2VkZ2Ugb3IgY2FwcGVkIGNpcmNsZSAoZGVmYXVsdD1jaXJjbGUpCiAqCiAqIEBzZWUge0BsaW5rIGNpcmNsZX0KICovCmZ1bmN0aW9uIGFyYyh4LCB5LCByLCBzID0gMCwgZSA9IFRBVSwgd2VkZ2UgPSBmYWxzZSkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgd2VkZ2UgPSBlOwogICAgZSA9IHM7CiAgICBzID0gcjsKICAgIHIgPSB5OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIGNvbnN0IHN0ZXAgPSAwLjE7CiAgc3RhcnQoKTsKICBpZiAod2VkZ2UpIHZlcnRleCh4LCB5KTsKICBsZXQgYSA9IHM7CiAgdmVydGV4KHggKyByICogY29zKHMpLCB5ICsgciAqIHNpbihzKSk7CiAgZm9yIChhID0gcyArIHN0ZXA7IGEgPCBlOyBhICs9IHN0ZXApIHsKICAgIHZlcnRleCh4ICsgciAqIGNvcyhhKSwgeSArIHIgKiBzaW4oYSkpOwogIH0KICB2ZXJ0ZXgoeCArIHIgKiBjb3MoZSksIHkgKyByICogc2luKGUpKTsKICBpZiAod2VkZ2UpIHZlcnRleCh4LCB5KTsKICBlbmQoKTsKfQoKLyoqCiAqIERyYXcgYSBwYWlyIG9mIGhvcml6b250YWwgYW5kIHZlcnRpY2FsIGF4ZXMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEJvcmRlcigxLCBgYmxhY2tgKTsKICogICAgICAgc2V0R3JpZCg1MCwgYGxpZ2h0Z3JleWApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgc2V0Q3Vyc29yKGBub25lYCk7CiAqICAgICAgIGNsZWFyKGAjZmZmZWY3YCk7CiAqICAgICAgIHNldENvbG9yKGAjMzMzYCk7CiAqICAgICAgIHRyYW5zbGF0ZSgyNSwyNSk7CiAqICAgICAgIGF4ZXMoCiAqICAgICAgICAgYHRpbWUgKHMpYCwgMCwgd2lkdGgtNTAsCiAqICAgICAgICAgYGRpc3RhbmNlIChrbSlgLCAwLCBoZWlnaHQtNTAsCiAqICAgICAgICAgIjAiLCAiNjAiLAogKiAgICAgICAgICIwIiwgIjUwMCIpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBoTGFiZWwgdGhlIGhvcml6b250YWwgYXhpcyBsYWJlbAogKiBAcGFyYW0ge251bWJlcn0gaHMgdGhlIHN0YXJ0IChsZWZ0KSBwaXhlbCB2YWx1ZSBmb3IgdGhlIGhvcml6b250YWwgYXhpcwogKiBAcGFyYW0ge251bWJlcn0gaGUgdGhlIGVuZCAocmlnaHQpIHBpeGVsIHZhbHVlIGZvciB0aGUgaG9yaXpvbnRhbCBheGlzCiAqIEBwYXJhbSB7c3RyaW5nfSB2TGFiZWwgdGhlIHZlcnRpY2FsIGF4aXMgbGFiZWwKICogQHBhcmFtIHtudW1iZXJ9IHZzIHRoZSBzdGFydCAodG9wKSBwaXhlbCB2YWx1ZSBmb3IgdGhlIHZlcnRpY2FsIGF4aXMKICogQHBhcmFtIHtudW1iZXJ9IHZlIHRoZSBlbmQgKGJvdHRvbSkgcGl4ZWwgdmFsdWUgZm9yIHRoZSB2ZXJ0aWNhbCBheGlzCiAqIEBwYXJhbSB7c3RyaW5nfSBoc0xhYmVsPyBhbiBvcHRpb25hbCBsYWJlbCBmb3IgdGhlIHN0YXJ0IChsZWZ0KSBvZiB0aGUgaG9yaXpvbnRhbCBheGlzCiAqIEBwYXJhbSB7c3RyaW5nfSBoZUxhYmVsPyBhbiBvcHRpb25hbCBsYWJlbCBmb3IgdGhlIGVuZCAocmlnaHQpIG9mIHRoZSBob3Jpem9udGFsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IHZzTGFiZWw/IGFuIG9wdGlvbmFsIGxhYmVsIGZvciB0aGUgc3RhcnQgKHRvcCkgb2YgdGhlIHZlcnRpY2FsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IHZlTGFiZWw/IGFuIG9wdGlvbmFsIGxhYmVsIGZvciB0aGUgZW5kIChib3R0b20pIG9mIHRoZSB2ZXJ0aWNhbCBheGlzCiAqIEByZXR1cm5zIHt2b2lkfQogKi8KZnVuY3Rpb24gYXhlcygKICBoTGFiZWwsCiAgaHMsCiAgaGUsCiAgdkxhYmVsLAogIHZzLAogIHZlLAogIGhzTGFiZWwgPSBmYWxzZSwKICBoZUxhYmVsID0gZmFsc2UsCiAgdnNMYWJlbCA9IGZhbHNlLAogIHZlTGFiZWwgPSBmYWxzZQopIHsKICBsaW5lKGhzLCAwLCBoZSwgMCk7CiAgbGluZSgwLCB2cywgMCwgdmUpOwoKICBjb25zdCBocG9zID0gMCAtIDU7CiAgdGV4dChgJHtoTGFiZWx9IOKGkmAsIHdpZHRoIC8gMiArIDUsIGhwb3MsIFJJR0hUKTsKICB0ZXh0KGhzTGFiZWwgPyBoc0xhYmVsIDogaHMsIGhzLCBocG9zLCBSSUdIVCk7CiAgdGV4dChoZUxhYmVsID8gaGVMYWJlbCA6IGhlLCBoZSwgaHBvcywgUklHSFQpOwoKICBjb25zdCB2cG9zID0gLTU7CiAgc2F2ZSgpOwogIHRyYW5zbGF0ZSh2cG9zLCBoZWlnaHQgLyAyKTsKICByb3RhdGUoLVBJIC8gMik7CiAgdGV4dChgJHt2TGFiZWx9YCwgMCwgMCwgTEVGVCk7CiAgcmVzdG9yZSgpOwogIHRleHQoYOKGk2AsIHZwb3MsIGhlaWdodCAvIDIgKyAxNiwgUklHSFQpOwogIHRleHQodnNMYWJlbCA/IHZzTGFiZWwgOiB2cywgdnBvcywgdnMgKyA1LCBSSUdIVCk7CiAgdGV4dCh2ZUxhYmVsID8gdmVMYWJlbCA6IHZlLCB2cG9zLCB2ZSwgUklHSFQpOwp9CgovKioKICogRHJhdyBvbmUgb3IgbW9yZSBCZXppZXIgY3VydmVzIGZyb20gYW4gYXJyYXkKICogb2YgUG9pbnQgb3IgUG9pbnQtbGlrZXMgdGhhdCBpbXBsZW1lbnQ6CiAqCiAqIGBgYAogKiB7CiAqICAgeDogbnVtYmVyCiAqICAgeTogbnVtYmVyCiAqIH0KICogYGBgCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGAjRjAwMmApOwogKiAgICAgICBiZXppZXIoCiAqICAgICAgICAgbmV3IFBvaW50KDIwLCBoZWlnaHQgLSA1NSksCiAqICAgICAgICAgbmV3IFBvaW50KDIwLCAyNSksCiAqICAgICAgICAgeyB4OiB3aWR0aCAtIDIwLCB5OiAyNX0sCiAqICAgICAgICAgeyB4OiB3aWR0aCAtIDIwLCB5OiBoZWlnaHQgLSA1NX0KICogICAgICAgKTsKICogICAgICAgbm9GaWxsKCkKICogICAgICAgYmV6aWVyKAogKiAgICAgICAgIG5ldyBQb2ludCgwLCBoZWlnaHQgLSAyMCksCiAqICAgICAgICAgbmV3IFBvaW50KHdpZHRoIC0gMjAsIGhlaWdodCAtIDIwKSwKICogICAgICAgICB7IHg6IDIwLCB5OiAyMH0sCiAqICAgICAgICAgeyB4OiB3aWR0aCwgeTogMjB9CiAqICAgICAgICk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJbOF19IC4uLmNvb3JkaW5hdGVzIEVpZ2h0IHgsIHkgdmFsdWVzLgogKiBAcGFyYW0ge251bWJlcls2bl19IC4uLmFkZGl0aW9uYWxDb29yZGluYXRlcz8gTXVsdGlwbGVzIG9mIHNpeCB4LCB5IHZhbHVlcy4KICoKICogQHBhcmFtIHtQb2ludExpa2VbNF19IC4uLmNvb3JkaW5hdGVzIEZvdXIge3gseX0gY29vcmRpbmF0ZXMuCiAqIEBwYXJhbSB7UG9pbnRMaWtlWzNuXX0gLi4uYWRkaXRpb25hbENvb3JkaW5hdGVzPyBNdWx0aXBsZXMgb2YgdGhyZWUge3gseX0gY29vcmRpbmF0ZXMuCiAqCiAqIEBzZWUge0BsaW5rIGJzcGxpbmV9CiAqIEBzZWUge0BsaW5rIHNwbGluZX0KICovCmZ1bmN0aW9uIGJlemllciguLi5hcmdzKSB7CiAgbGV0IHBvaW50cyA9IGFyZ3M7CgogIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gYG51bWJlcmApIHsKICAgIHBvaW50cyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHBvaW50cy5wdXNoKHsgeDogYXJnc1tpXSwgeTogYXJnc1tpICsgMV0gfSk7CiAgICB9CiAgfQoKICBjb25zdCBiID0gKHQsIGEsIGIsIGMsIGQpID0+IHsKICAgIGNvbnN0IG10ID0gMSAtIHQ7CiAgICByZXR1cm4gYSAqIG10ICoqIDMgKyAzICogYiAqIG10ICoqIDIgKiB0ICsgMyAqIGMgKiBtdCAqIHQgKiogMiArIGQgKiB0ICoqIDM7CiAgfTsKCiAgbGV0IFtwMCwgLi4ucmVzdF0gPSBwb2ludHM7CiAgc3RhcnQoKTsKICBmb3IgKGxldCBpID0gMCwgZSA9IHJlc3QubGVuZ3RoOyBpIDwgZTsgaSArPSAzKSB7CiAgICBsZXQgW3AxLCBwMiwgcDNdID0gcmVzdC5zbGljZShpLCBpICsgMyk7CiAgICBpZiAocDEgJiYgcDIgJiYgcDMpIHsKICAgICAgZm9yIChsZXQgdCA9IDA7IHQgPCAxOyB0ICs9IDAuMDEpIHsKICAgICAgICB2ZXJ0ZXgoYih0LCBwMC54LCBwMS54LCBwMi54LCBwMy54KSwgYih0LCBwMC55LCBwMS55LCBwMi55LCBwMy55KSk7CiAgICAgIH0KICAgICAgdmVydGV4KHAzLngsIHAzLnkpOwogICAgICBwMCA9IHAzOwogICAgfQogIH0KICBlbmQoKTsKfQoKLyoqCiAqIERyYXcgYSBCLXNwbGluZSB1c2luZyBmb3VyIG9yIG1vcmUgUG9pbnQgb3IKICogUG9pbnQtbGlrZXMgdGhhdCBpbXBsZW1lbnQ6CiAqCiAqIGBgYAogKiB7CiAqICAgeDogbnVtYmVyCiAqICAgeTogbnVtYmVyCiAqIH0KICogYGBgCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgcmFuZ2UoMCwgVEFVLCBQSSAvIDUsIChhKSA9PiBwb2ludHMucHVzaCgKICogICAgICAgICBuZXcgUG9pbnQoCiAqICAgICAgICAgICByYW5kb20oMzApICsgNTAgKiBjb3MoYSksCiAqICAgICAgICAgICByYW5kb20oMzApICsgNTAgKiBzaW4oYSkKICogICAgICAgICApCiAqICAgICAgICkpOwogKiAgICAgICBzZXRNb3ZhYmxlKC4uLnBvaW50cyk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7CiAqICAgICAgIG5vU3Ryb2tlKCk7CiAqICAgICAgIHNldEZpbGwoYCMwMDAyYCk7CiAqICAgICAgIGJzcGxpbmUoLi4ucG9pbnRzKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBwb2ludHMuZm9yRWFjaChwID0+IHBvaW50KHApKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcls4XX0gLi4uY29vcmRpbmF0ZXMgRWlnaHQgeCwgeSB2YWx1ZXMuCiAqIEBwYXJhbSB7bnVtYmVyWzJuXX0gLi4uYWRkaXRpb25hbENvb3JkaW5hdGVzPyBNdWx0aXBsZXMgb2YgeCwgeSB2YWx1ZXMuCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlWzRdfSAuLi5jb29yZGluYXRlcyBGb3VyIHt4LHl9IGNvb3JkaW5hdGVzLgogKiBAcGFyYW0ge1BvaW50TGlrZVtuXX0gLi4uYWRkaXRpb25hbENvb3JkaW5hdGVzPyBaZXJvIG9yIG1vcmUge3gseX0gY29vcmRpbmF0ZXMuCiAqCiAqIEBzZWUge0BsaW5rIGJlemllcn0KICogQHNlZSB7QGxpbmsgc3BsaW5lfQogKi8KCmZ1bmN0aW9uIGJzcGxpbmUoLi4uYXJncykgewogIGxldCBvcGVuID0gdHJ1ZTsKICBpZiAodHlwZW9mIGFyZ3NbYXJncy5sZW5ndGggLSAxXSA9PT0gYGJvb2xlYW5gKSB7CiAgICBvcGVuID0gYXJncy5zcGxpY2UoYXJncy5sZW5ndGggLSAxLCAxKVswXTsKICB9CgogIGxldCBwb2ludHMgPSBhcmdzOwoKICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09IGBudW1iZXJgKSB7CiAgICBwb2ludHMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkgKz0gMikgewogICAgICBwb2ludHMucHVzaCh7IHg6IGFyZ3NbaV0sIHk6IGFyZ3NbaSArIDFdIH0pOwogICAgfQogIH0KCiAgc3RhcnQoKTsKICBuZXcgQlNwbGluZShwb2ludHMsIG9wZW4pLmdldExVVCgpLmZvckVhY2goKHApID0+IHZlcnRleChwLngsIHAueSkpOwogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIGNpcmNsZSB3aXRoIHJhZGl1cyBgcmAgYXQgYHgseWAuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGAjRjAwMmApOwogKiAgICAgICBjaXJjbGUod2lkdGgvMiwgaGVpZ2h0LzIsIDgwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgY2lyY2xlJ3MgY2VudGVyIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIGNpcmNsZSdzIGNlbnRlciB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSByIFRoZSBjaXJjbGUncyByYWRpdXMgaW4gcGl4ZWxzCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSBjaXJjbGUncyBjZW50ZXIge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0gciBUaGUgY2lyY2xlJ3MgcmFkaXVzIGluIHBpeGVscwogKgogKiBAc2VlIHtAbGluayBhcmN9CiAqLwpmdW5jdGlvbiBjaXJjbGUoeCwgeSwgcikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgciA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgYXJjKHgsIHksIHIsIDAsIFRBVSwgZmFsc2UpOwp9CgovKioKICogQ2xlYXIgdGhlIGNhbnZhcywgYW5kIHNldCBpdCB0byBhIHNwZWNpZmljIChDU1MpIGNvbG91ci4KICogSWYgbm8gYG5vR3JpZCgpYCBjYWxsIHdhcyBtYWRlLCB0aGlzIHdpbGwgdGhlbiBhbHNvIGRyYXcKICogdGhlIGJhY2tncm91bmQgZ3JpZC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBwaW5rYCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtjb2xvcn0gY29sb3I/IFRoZSAoQ1NTKSBiYWNrZ3JvdW5kIGNvbG9yIHRvIHVzZSAoZGVmYXVsdCA9IGB3aGl0ZWApCiAqLwpmdW5jdGlvbiBjbGVhcihjb2xvciA9IGB3aGl0ZWApIHsKICBzYXZlKCk7CiAgX19jYW52YXMuc3R5bGUuYmFja2dyb3VuZCA9IGNvbG9yOwogIF9fY2FudmFzLndpZHRoID0gd2lkdGg7CiAgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwogIGlmIChfX2RyYXdfZ3JpZCkgZ3JpZCgpOwogIHJlc3RvcmUoKTsKfQoKLyoqCiAqIENvdW50ZXJwYXJ0IHRvIHN0YXJ0KCksIGZpbmFsaXplcyB0aGUgY3VycmVudCBzaGFwZSBhbmQKICogY29sb3VycyBpdC4gSWYgYGNsb3NlYCBpcyB0cnVlLCBpdCB3aWxsIGNsb3NlIHRoZSBwYXRoCiAqIGJlZm9yZSBjb2xvdXJpbmcuCiAqCiAqIElmIGBub0ZpbGwoKWAgaXMgaW4gZWZmZWN0LCB0aGUgc2hhcGUgd2lsbCBub3QgYmUgZmlsbGVkLgogKiBpZiBgbm9TdHJva2UoKWAgaXMgaW4gZWZmZWN0LCB0aGUgc2hhcGUgb3V0bGluZSB3aWxsIG5vdCBiZSBjb2xvdXJlZC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYGdvbGRgKTsKICogICAgICAgc3RhcnQoKTsKICogICAgICAgdmVydGV4KDAsaGVpZ2h0LzIpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgMCk7CiAqICAgICAgIHZlcnRleCh3aWR0aCwgaGVpZ2h0LzIpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgaGVpZ2h0KTsKICogICAgICAgZW5kKHRydWUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY2xvc2U/IEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyB3aGV0aGVyIG9yIG5vdCB0byBjbG9zZSB0aGUgcGF0aCAoZGVmYXVsdCA9IGZhbHNlKQogKgogKiBAc2VlIHtAbGluayBzdGFydH0KICogQHNlZSB7QGxpbmsgdmVydGV4fQogKiBAc2VlIHtAbGluayBlbmRTaGFwZX0KICovCmZ1bmN0aW9uIGVuZChjbG9zZSA9IGZhbHNlKSB7CiAgaWYgKGNsb3NlKSBfX2N0eC5jbG9zZVBhdGgoKTsKICBfX2N0eC5maWxsKCk7CiAgX19jdHguc3Ryb2tlKCk7CiAgaWYgKF9fY3R4LmxpbmVXaWR0aCAlIDIgPT09IDEpIHsKICAgIF9fY3R4LnRyYW5zbGF0ZSgtMC41LCAtMC41KTsKICB9Cn0KCi8qKgogKiBEcmF3IGFuIGltYWdlIGluIGEgZ2l2ZW4gbG9jYXRpb24gd2l0aCBhbiBvcHRpb25hbAogKiB3aWR0aCBhbmQgaGVpZ2h0LiBJZiBvbWl0dGVkLCB0aGUgd2lkdGggYW5kIGhlaWdodAogKiB3aWxsIGJlIHRoZSBpbWFnZSdzIG93biBkaW1lbnNpb25zLiBOb3RlIHRoYXQgdGhlCiAqIGltYWdlIG1heSBiZSBlaXRoZXIgYSBVUkwsIG9yIGFuIDxpbWc+IGVsZW1lbnQuCiAqCiAqIE5vdGUgdGhhdCB0aGlzIGlzIGFuIGFzeW5jIGZ1bmN0aW9uOiBpZiBpdCBpcyBpbXBvcnRhbnQKICogdGhhdCBub3RoaW5nIGdldHMgZHJhd24gdW50aWwgdGhlIGltYWdlIGhhcyBiZWVuIGRyYXduLAogKiByZW1lbWJlciB0byBgYXdhaXRgIGl0cyBjYWxsLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgYXN5bmMgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGF3YWl0IGltYWdlKGBodHRwczovL2R1bW15aW1hZ2UuY29tLzEwMHgxMDBgLCA1MCwgNTAsIDEwMCwgMTAwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge0ltYWdlfHN0cmluZ30gaW1nT3JVUkwgVGhlIGltYWdlIHRvIGRyYXcgZWl0aGVyIGFzIEltYWdlIG9iamVjdCwgb3IgaW1hZ2UgVVJMLgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgZHJhdyBwb3NpdGlvbidzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIGRyYXcgcG9zaXRpb24ncyB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB3IFRoZSB3aWR0aCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEBwYXJhbSB7bnVtYmVyfSBoIFRoZSBoZWlnaHQgb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcmV0dXJucyB7SW1hZ2V9IFRoZSBkcmF3biBpbWFnZQogKgogKiBAcGFyYW0ge0ltYWdlfHN0cmluZ30gaW1nT3JVUkwgVGhlIGltYWdlIHRvIGRyYXcgZWl0aGVyIGFzIEltYWdlIG9iamVjdCwgb3IgaW1hZ2UgVVJMLgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgZHJhdyBwb3NpdGlvbiBhcyB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB3IFRoZSB3aWR0aCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEBwYXJhbSB7bnVtYmVyfSBoIFRoZSBoZWlnaHQgb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcmV0dXJucyB7SW1hZ2V9IFRoZSBkcmF3biBpbWFnZQogKi8KYXN5bmMgZnVuY3Rpb24gaW1hZ2UoaW1nLCB4ID0gMCwgeSA9IDAsIHcsIGgpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIGggPSB3OwogICAgdyA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIGlmICh0eXBlb2YgaW1nID09PSBgc3RyaW5nYCkgewogICAgaW1nID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBjb25zdCB0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBpbWdgKTsKICAgICAgdGFnLm9ubG9hZCA9ICgpID0+IHJlc29sdmUodGFnKTsKICAgICAgdGFnLm9uZXJyb3IgPSAoKSA9PiByZWplY3QoKTsKICAgICAgdGFnLnNyYyA9IGltZzsKICAgIH0pOwogIH0KICBfX2N0eC5kcmF3SW1hZ2UoaW1nLCB4LCB5LCB3IHx8IGltZy53aWR0aCwgaCB8fCBpbWcuaGVpZ2h0KTsKICByZXR1cm4gaW1nOwp9CgovKioKICogRHJhdyBhIGxpbmUgZnJvbSBvbmUgY29vcmRpbmF0ZSB0byBhbm90aGVyLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgcmFuZ2UoMCxoZWlnaHQsMjAsIChpKSA9PiBsaW5lKDAsIDAsIHdpZHRoLCBpKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHgxIFRoZSBmaXJzdCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkxIFRoZSBmaXJzdCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHgyIFRoZSBzZWNvbmQgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MiBUaGUgc2Vjb25kIHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDEgVGhlIGZpcnN0IHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDIgVGhlIHNlY29uZCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICovCmZ1bmN0aW9uIGxpbmUoeDEsIHkxLCB4MiwgeTIpIHsKICBpZiAoeDEueCAhPT0gdW5kZWZpbmVkICYmIHgxLnkgIT09IHVuZGVmaW5lZCkgewogICAgeTIgPSB5MS55OwogICAgeDIgPSB5MS54OwogICAgeTEgPSB4MS55OwogICAgeDEgPSB4MS54OwogIH0KCiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICB2ZXJ0ZXgoeDIsIHkyKTsKICBlbmQoKTsKfQoKLyoqCiAqIFBsb3QgYSB5PWYoeCkgZnVuY3Rpb24uIFRoZSBpbnB1dCB0byB0aGUgZnVuY3Rpb24KICogd2lsbCBzcGFuIHRoZSBpbnRlcnZhbCBbYSxiXSB1c2luZyB0aGUgaW5kaWNhdGVkCiAqIG51bWJlciBvZiBzdGVwcywgYW5kIHRoZSByZSBzdWx0IG1heSBiZSBzY2FsZWQgYm90aAogKiBpbiB0aGUgeCBhbmQgeSBkaXJlY3Rpb24gaW4gb3JkZXIgdG8gZHJhdyBzb21ldGhpbmcKICogdGhhdCB5b3UgY2FuIGFjdHVhbGx5IHNlZSAoZS5nLiBpZiB5b3UncmUgcGxvdHRpbmcKICogdG8gdGhlIGRvbWFpbiBbMCwxXSB5b3Ugd291bGRuJ3QgYmUgYWJsZSB0byBzZWUgdGhlCiAqIHJlc3VsdCB3aXRob3V0IHNjYWxpbmcpLgogKgogKiBUaGlzIGZ1bmN0aW9uIGlzIGF3YXJlIG9mLCBhbmQgd2lsbCBwbG90LCBkaXNjb250aW51aXRpZXMKICogdXNpbmcgdGhlIHN0YW5kYXJkIG9wZW4gY2lyY2xlIG5vdGF0aW9uLCB1bmxlc3MgaW5zdHJ1Y3RlZAogKiBub3QgdG8gZG8gc28gdXNpbmcgdGhlIGBpZ25vcmVEaXNjb250aW51aXR5YCBib29sZWFuIGZsYWcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgbm9GaWxsKCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgdHJhbnNsYXRlKDAsIGhlaWdodCAvIDIpOwogKiAgICAgICBjb25zdCBmbiA9ICh4KSA9PiBjb3MoeCkgKiogNiAvIHNpbih4KSAtIHNpbih4KS8yOwogKiAgICAgICBwbG90KGZuLCAwLCAyKlRBVSwgMTIwLCB3aWR0aCAvIFRBVSwgaGVpZ2h0IC8gMik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gZiB0aGUgYHkgPSBmKHgpYCBmdW5jdGlvbiB0byBwbG90CiAqIEBwYXJhbSB7bnVtYmVyfSBhPyBUaGUgbG93ZXIgYm91bmQgZm9yIHRoZSBpbnB1dCB2YWx1ZSAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSB7bnVtYmVyfSBiPyBUaGUgdXBwZXIgYm91bmQgZm9yIHRoZSBpbnB1dCB2YWx1ZSAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGVwcz8gVGhlIG51bWJlciBvZiBwbG90IHBvaW50cyB0byBwbG90IG92ZXIgdGhlIGludGVydmFsIFthLGJdIChkZWZhdWx0ID0gMTAwKQogKiBAcGFyYW0ge251bWJlcn0geHNjYWxlPyBBbiBvcHRpb25hbCBzY2FsaW5nIGZhY3RvciB0byBhcHBseSB0byBlYWNoIHBsb3QgcG9pbnQncyB4IHZhbHVlIChkZWZhdWx0ID0gMSkKICogQHBhcmFtIHtudW1iZXJ9IHlzY2FsZT8gQW4gb3B0aW9uYWwgc2NhbGluZyBmYWN0b3IgdG8gYXBwbHkgdG8gZWFjaCBwbG90IHBvaW50J3MgeSB2YWx1ZSAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSB7Ym9vbGVhbn0gaWdub3JlRGlzY29udGludWl0eT8gRG8gbm90IGRyYXcgc3BlY2lhbCBlbGVtZW50cyBmb3IgZGlzY29udGludWl0aWVzIChkZWZhdWx0ID0gZmFsc2UpCiAqCiAqIEBzZWUge0BsaW5rIHBsb3REYXRhfQogKi8KZnVuY3Rpb24gcGxvdCgKICBmLAogIGEgPSAwLAogIGIgPSAxLAogIHN0ZXBzID0gMTAwLAogIHhzY2FsZSA9IDEsCiAgeXNjYWxlID0gMSwKICBpZ25vcmVEaXNjb250aW51aXR5ID0gZmFsc2UKKSB7CiAgY29uc3QgaW50ZXJ2YWwgPSBiIC0gYTsKICBzdGFydCgpOwogIGxldCBbcHksIGR5LCBwZHldID0gWzAsIDAsIDBdOwogIGNvbnN0IHN0ZXAgPSBpbnRlcnZhbCAvIChzdGVwcyAtIDEpOwogIGNvbnN0IGRpc2NvbnRpbnVpdHkgPSAoaSwgeCwgeSkgPT4gewogICAgZW5kKCk7CiAgICBzYXZlKCk7CiAgICBub0ZpbGwoKTsKICAgIHBvaW50KHggKiB4c2NhbGUsIHB5ICogeXNjYWxlKTsKICAgIHBvaW50KHggKiB4c2NhbGUsIHkgKiB5c2NhbGUpOwogICAgcmVzdG9yZSgpOwogICAgc3RhcnQoKTsKICB9OwogIGZvciAobGV0IGkgPSAwLCB4LCB5OyBpIDwgc3RlcHM7IGkrKykgewogICAgeCA9IGEgKyBpICogc3RlcDsKICAgIHkgPSBmKHgpOwogICAgLy8gSWYgZih4KSBjaGFuZ2VzIGluIHZpb2xhdGlvbiBvZiB3aGF0IGl0cyBmJyh4KSBzdWdnZXN0ZWQsCiAgICAvLyB0aGF0J3MgYSBkaXNjb250aW51aXR5IGFuZCB3ZSBkcmF3IGFuIGFzeW1wdG90ZS4KICAgIGR5ID0gKHkgLSBweSkgKiBzdGVwOwogICAgaWYgKCFpZ25vcmVEaXNjb250aW51aXR5KSB7CiAgICAgIGlmIChwZHkgIT09IG51bGwgJiYgc2lnbih5IC0gcHkpICE9PSBzaWduKHBkeSkgJiYgYWJzKHBkeSkgPiAwLjAxKSB7CiAgICAgICAgZGlzY29udGludWl0eShpLCB4LCB5KTsKICAgICAgICBwZHkgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHBkeSA9IGR5OwogICAgICB9CiAgICB9CiAgICB2ZXJ0ZXgoeCAqIHhzY2FsZSwgeSAqIHlzY2FsZSk7CiAgICBweSA9IHk7CiAgfQogIGVuZCgpOwp9CgovKioKICogUGxvdCBhIDJEIGdyYXBoIHVzaW5nIGEgY29sbGVjdGlvbiBvZiBhbnktZGltZW5zaW9uYWwgZGF0YSwKICogYnkgaW5kaWNhdGluZyB3aGljaCBkaW1lbnNpb24gc2hvdWxkIGJlIHRyZWF0ZWQgYXMgdGhlIGB4YAogKiBhbmQgd2hpY2ggZGltZW5zaW9uIHNob3VsZCBiZSB0cmVhdGVkIGFzIHRoZSBgeWAuIElmIG5vIGB4YAogKiBhbmQgYHlgIGFyZSBwcm92aWRlZCwgYGRhdGFgIHdpbGwgYmUgdHJlYXRlZCBhIDFEIGFycmF5IGFuZAogKiB3aWxsIHBsb3Qgd2l0aCB0aGUgYXJyYXkgaW5kZXggYXMgYHhgIGFuZCBlbGVtZW50IGF0IHRoYXQKICogaW5kZXggYXMgYHlgLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICB0cmFuc2xhdGUoMCwgaGVpZ2h0LzIpOwogKgogKiAgICAgICBzZXRTdHJva2UoYGRhcmtncmVlbmApOwogKiAgICAgICBsZXQgZGF0YSA9IGFycmF5KHdpZHRoLCAoaSkgPT4gW2ksIGhlaWdodC8yICogc2luKGkvMjUpXSk7CiAqICAgICAgIHBsb3REYXRhKGRhdGEsIDAsIDEpOwogKgogKiAgICAgICBzZXRTdHJva2UoYHB1cnBsZWApOwogKiAgICAgICBkYXRhID0gYXJyYXkod2lkdGgsIChpKSA9PiAoewogKiAgICAgICAgIG1lZXA6IGksCiAqICAgICAgICAgbW9vcDogaGVpZ2h0LzIgKiBjb3MoaS8yNSkKICogICAgICAgfSkpOwogKiAgICAgICBwbG90RGF0YShkYXRhLCBgbWVlcGAsIGBtb29wYCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtvYmplY3RbXX0gZGF0YSBUaGUgYW55LWRpbWVuc2lvbmFsIGRhdGEgZnJvbSB3aGljaCB0byBwbG90IG9uZSBkaW1lbnNpb24gYWdhaW4gYW5vdGhlcgogKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IHg/IFRoZSBwcm9wZXJ0eSBuYW1lIG9yIGluZGl2aWR1YWwgZWxlbWVudCBhcnJheSBpbmRleCB0byB1c2UgYXMgeCBkaW1lbnNpb24KICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSB5PyBUaGUgcHJvcGVydHkgbmFtZSBvciBpbmRpdmlkdWFsIGVsZW1lbnQgYXJyYXkgaW5kZXggdG8gdXNlIGFzIHkgZGltZW5zaW9uCiAqCiAqIEBzZWUge0BsaW5rIHBsb3R9CiAqLwpmdW5jdGlvbiBwbG90RGF0YShkYXRhLCB4LCB5KSB7CiAgc3RhcnQoKTsKICBpZiAoeCAhPT0gdW5kZWZpbmVkICYmIHkgIT09IHVuZGVmaW5lZCkgewogICAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHkgPSB4Lnk7CiAgICAgIHggPSB4Lng7CiAgICB9CiAgICBkYXRhLmZvckVhY2goKHApID0+IHZlcnRleChwW3hdLCBwW3ldKSk7CiAgfSBlbHNlIHsKICAgIGRhdGEuZm9yRWFjaCgoeSwgeCkgPT4gdmVydGV4KHgsIHkpKTsKICB9CiAgZW5kKCk7Cn0KCi8qKgogKiBEcmF3IGEgcG9pbnQgKGVpdGhlciBmcm9tIHgveSBvciBwb2ludC1saWtlKS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICByYW5nZSgwLCBUQVUsIChhKSA9PiB7CiAqICAgICAgICAgcG9pbnQoNDAgKiBjb3MoYSksIDQwICogc2luKGEpKTsKICogICAgICAgfSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHBvaW50J3MgY2VudGVyIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHBvaW50J3MgY2VudGVyIHkgcGl4ZWwgdmFsdWUKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHBvaW50J3MgY2VudGVyIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgY2lyY2xlfQogKi8KZnVuY3Rpb24gcG9pbnQoeCwgeSkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIGNpcmNsZSh4LCB5LCAzKTsKfQoKLyoqCiAqIERyYXcgYSByZWN0YW5nbGUgYXQgdGhlIHNwZWNpZmllZCBjb29yZGluYXRlLCB3aXRoCiAqIHRoZSBzcGVjaWZpYyB3aWR0aCBhbmQgaGVpZ2h0LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHJlY3QoNDAsIDQwLCB3aWR0aCAtIDgwLCBoZWlnaHQgLSA4MCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHJlY3QncyBjb3JuZXIgIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHJlY3QncyBjb3JuZXIgIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHcgVGhlIHdpZHRoIG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHBhcmFtIHtudW1iZXJ9IGggVGhlIGhlaWdodCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSByZWN0O3MgY29yZGVyIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHcgVGhlIHdpZHRoIG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHBhcmFtIHtudW1iZXJ9IGggVGhlIGhlaWdodCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqLwpmdW5jdGlvbiByZWN0KHgsIHksIHcsIGgpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIGggPSB3OwogICAgdyA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIHN0YXJ0KCk7CiAgdmVydGV4KHgsIHkpOwogIHZlcnRleCh4ICsgdywgeSk7CiAgdmVydGV4KHggKyB3LCB5ICsgaCk7CiAgdmVydGV4KHgsIHkgKyBoKTsKICB2ZXJ0ZXgoeCwgeSk7CiAgZW5kKCk7Cn0KCi8qKgogKiBEcmF3IGEgY2FyZGluYWwgKGhlcm1pdGUpIHNwbGluZSB0aGF0IHBhc3NlcyB0aHJvdWdoIGVhY2gKICogcG9pbnQgcHJvdmlkZWQsIHVzaW5nIGEgbWF0aGVtYXRpY2FsbHkgdmlydHVhbCBzdGFydCBhbmQKICogZW5kIHRvIGVuc3VyZSB0aGUgY3VydmUgc3RhcnRzIGFuZCBlbmRzIGF0IHRoZSBwcm92aWRlZAogKiBzdGFydCBhbmQgZW5kIHBvaW50LiBUaGlzIGNhbiBiZSBieXBhc3NlZCBieSBzZXR0aW5nCiAqIHRoZSBgdmlydHVhbGAgYXJndW1lbnQgdG8gYGZhbHNlYC4KICoKICogQWRkaXRpb25hbGx5LCB0aGUgc3BsaW5lJ3MgdGlnaHRuZXNzLCB3aGljaCBjb250cm9scwogKiBob3cgImJlbmR5IiB0aGUgc3BsaW5lIGlzICh0aGUgdGlnaHRlciB0aGUgc3BsaW5lLAogKiB0aGUgc2hhcnBlciBiZW5kcyBiZWNvbWUpIGNhbiBiZSBjb250cm9sbGVkIGJ5IHNldHRpbmcKICogdGhlIGB0aWdodG5lc3NgIHZhbHVlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHJhbmdlKDAsIFRBVSwgUEkgLyA1LCAoYSkgPT4gcG9pbnRzLnB1c2goCiAqICAgICAgICAgbmV3IFBvaW50KAogKiAgICAgICAgICAgcmFuZG9tKDMwKSArIDUwICogY29zKGEpLAogKiAgICAgICAgICAgcmFuZG9tKDMwKSArIDUwICogc2luKGEpCiAqICAgICAgICAgKQogKiAgICAgICApKTsKICogICAgICAgc2V0TW92YWJsZSguLi5wb2ludHMpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwogKiAgICAgICBzZXRGaWxsKGAjMDAwMmApOwogKiAgICAgICBzcGxpbmUoLi4ucG9pbnRzKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICBwb2ludHMuZm9yRWFjaChwID0+IHBvaW50KHApKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKgogKiBAcGFyYW0ge1BvaW50TGlrZVtdfSAuLi5wb2ludHMgVGhlIHBvaW50cyBhY3Jvc3Mgd2hpY2ggdG8gZml0IGEgc3BsaW5lCiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmlydHVhbD8gV2hldGhlciBvciBub3QgdG8gaW52ZW50IG5ldyBtYXRoZW1hdGljYWwgcG9pbnRzIHRoYXQgZW5zdXJlIHRoZSBjdXJ2ZSBzdGFydHMgYW5kIGVuZHMgYXQgdGhlIHByb3ZpZGVkIHN0YXJ0IGFuZCBlbmQgcG9pbnRzLiAoZGVmYXVsdCA9IHRydWUpCiAqIEBwYXJhbSB7bnVtYmVyfSB0aWdodG5lc3M/IEhvdyB0aWdodCB0aGlzIHNwbGluZSBzaG91bGQgYmUgZml0IHRocm91Z2ggdGhlIHBvaW50cyBwcm92aWRlZC4gVGhlIGhpZ2hlciB0aGUgdGlnaHRuZXNzLCB0aGUgbW9yZSBwb2x5Z29uYWwgdGhlIGN1cnZlIGJlY29tZXMgKGRlZmF1bHQgPSAxKQogKgogKiBAc2VlIHtAbGluayBiZXppZXJ9CiAqIEBzZWUge0BsaW5rIGJzcGxpbmV9CiAqLwpmdW5jdGlvbiBzcGxpbmUoLi4uYXJncykgewogIGxldCBwb2ludHMgPSBhcmdzOwogIGxldCB2aXJ0dWFsID0gdHJ1ZTsKICBsZXQgVCA9IDE7CgogIC8vIGlmIHRoZSBsYXN0IG9yIHNpbmdsZS10by1sYXN0IGlzIGEgYm9vbCwgdGhhdCdzIGB2aXJ0dWFsYDoKICBpZiAodHlwZW9mIGFyZ3NbYXJncy5sZW5ndGggLSAxXSA9PT0gYGJvb2xlYW5gKSB7CiAgICBbdmlydHVhbF0gPSBhcmdzLnNwbGljZShhcmdzLmxlbmd0aCAtIDEsIDEpOwogIH0gZWxzZSBpZiAodHlwZW9mIGFyZ3NbYXJncy5sZW5ndGggLSAyXSA9PT0gYGJvb2xlYW5gKSB7CiAgICBbdmlydHVhbF0gPSBhcmdzLnNwbGljZShhcmdzLmxlbmd0aCAtIDIsIDEpOwogIH0KCiAgLy8gSWYgdGhpcyBtYWtlcyB0aGUgbnVtYmVyIG9mIGFyZ3Mgb2RkLCB0aGUgbGFzdCBhcmcgaXMgVAogIGlmIChhcmdzLmxlbmd0aCAlIDIgPT09IDEpIHsKICAgIFtUXSA9IGFyZ3Muc3BsaWNlKGFyZ3MubGVuZ3RoIC0gMSwgMSk7CiAgfQoKICAvLyB0aGVuLCB3ZSBjYW4gY29udmVydAogIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gYG51bWJlcmApIHsKICAgIHBvaW50cyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHBvaW50cy5wdXNoKHsgeDogYXJnc1tpXSwgeTogYXJnc1tpICsgMV0gfSk7CiAgICB9CiAgfQoKICBsZXQgY3BvaW50cyA9IHBvaW50czsKICBpZiAodmlydHVhbCkgewogICAgY29uc3QgZjAgPSBwb2ludHNbMF0sCiAgICAgIGYxID0gcG9pbnRzWzFdLAogICAgICBmMiA9IHBvaW50c1syXSwKICAgICAgZnNtID0gbmV3IFZlY3RvcihmMC54IC8gMiArIGYyLnggLyAyLCBmMC55IC8gMiArIGYyLnkgLyAyKSwKICAgICAgZjByID0gbmV3IFZlY3RvcihmMCkucmVmbGVjdChmMSksCiAgICAgIGZzciA9IGZzbS5yZWZsZWN0KGYxKSwKICAgICAgZm4gPSBuZXcgVmVjdG9yKGYwci54IC8gMiArIGZzci54IC8gMiwgZjByLnkgLyAyICsgZnNyLnkgLyAyKSwKICAgICAgbDIgPSBwb2ludHMuYXQoLTMpLAogICAgICBsMSA9IHBvaW50cy5hdCgtMiksCiAgICAgIGwwID0gcG9pbnRzLmF0KC0xKSwKICAgICAgbHNtID0gbmV3IFZlY3RvcihsMC54IC8gMiArIGwyLnggLyAyLCBsMC55IC8gMiArIGwyLnkgLyAyKSwKICAgICAgbDByID0gbmV3IFZlY3RvcihsMCkucmVmbGVjdChsMSksCiAgICAgIGxuID0gbmV3IFZlY3RvcihsMHIueCAvIDIgKyBsc20ueCAvIDIsIGwwci55IC8gMiArIGxzbS55IC8gMik7CiAgICBjcG9pbnRzID0gW2ZuLCAuLi5wb2ludHMsIGxuXTsKICB9CgogIC8vIGZvdXIgcG9pbnQgc2xpZGluZyB3aW5kb3cgb3ZlciB0aGUgc2VnbWVudAogIGNvbnN0IGJlemllclBvaW50cyA9IFtdOwogIGZvciAobGV0IGkgPSAwLCBlID0gY3BvaW50cy5sZW5ndGggLSAzOyBpIDwgZTsgaSsrKSB7CiAgICBsZXQgW2MxLCBjMiwgYzMsIGM0XSA9IGNwb2ludHMuc2xpY2UoaSwgaSArIDQpOwogICAgbGV0IHAyID0gewogICAgICB4OiBjMi54ICsgKGMzLnggLSBjMS54KSAvICg2ICogVCksCiAgICAgIHk6IGMyLnkgKyAoYzMueSAtIGMxLnkpIC8gKDYgKiBUKSwKICAgIH07CiAgICBsZXQgcDMgPSB7CiAgICAgIHg6IGMzLnggLSAoYzQueCAtIGMyLngpIC8gKDYgKiBUKSwKICAgICAgeTogYzMueSAtIChjNC55IC0gYzIueSkgLyAoNiAqIFQpLAogICAgfTsKICAgIGlmIChpID09PSAwKSBiZXppZXJQb2ludHMucHVzaChjMik7CiAgICBiZXppZXJQb2ludHMucHVzaChwMiwgcDMsIGMzKTsKICB9CgogIGJlemllciguLi5iZXppZXJQb2ludHMpOwp9CgovKioKICogU3RhcnRzIGEgKG5ldykgc2hhcGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGBnb2xkYCk7CiAqICAgICAgIHN0YXJ0KCk7CiAqICAgICAgIHZlcnRleCgwLGhlaWdodC8yKTsKICogICAgICAgdmVydGV4KHdpZHRoLzIsIDApOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgsIGhlaWdodC8yKTsKICogICAgICAgdmVydGV4KHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIGVuZCh0cnVlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBlbmR9CiAqIEBzZWUge0BsaW5rIHZlcnRleH0KICogQHNlZSB7QGxpbmsgc3RhcnRTaGFwZX0KICovCmZ1bmN0aW9uIHN0YXJ0KCkgewogIGlmIChfX2N0eC5saW5lV2lkdGggJSAyID09PSAxKSB7CiAgICBfX2N0eC50cmFuc2xhdGUoMC41LCAwLjUpOwogIH0KICBfX2N0eC5iZWdpblBhdGgoKTsKICBfX2ZpcnN0ID0gZmFsc2U7Cn0KCi8qKgogKiBEcmF3IHNvbWUgdGV4dCB0byB0aGUgc2NyZWVuLiBJdHMgcGxhY2VtZW50IGlzCiAqIGRldGVybWluZWQgYnkgYm90aCB0aGUgY29vcmRpbmF0ZSBwcm92aWRlZCwgYW5kCiAqIHRoZSB4L3kgYWxpZ25tZW50IHByb3ZpZGVkLiBWYWxpZCBgeEFsaWduYCB2YWx1ZXMKICogYXJlOgogKgogKiAtIENFTlRFUiAtIHRoZSB0ZXh0IGFuY2hvciBpcyBpbiB0aGUgbWlkZGxlIG9mIHRoZSB0ZXh0LiBUZXh0IGlzIHBsYWNlZCBldmVubHkgb24gZWl0aGVyIHNpZGUuCiAqIC0gRU5EIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSByaWdodCBmb3IgTFRSIHRleHQsIGFuZCBvbiB0aGUgbGVmdCBmb3IgUlRMIHRleHQuCiAqIC0gTEVGVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgbGVmdCBzaWRlIG9mIHRoZSB0ZXh0LiBhbGwgdGV4dCBpcyB0byB0aGUgcmlnaHQuCiAqIC0gUklHSFQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIHJpZ2h0IHNpZGUgb2YgdGhlIHRleHQuIEFsbCB0ZXh0IGlzIHRvIHRoZSBsZWZ0LgogKiAtIFNUQVJUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSBsZWZ0IGZvciBMVFIgdGV4dCwgYW5kIG9uIHRoZSByaWdodCBmb3IgUlRMIHRleHQuCiAqCiAqIFZhbGlkIGB5QWxpZ25gIHZhbHVlcyBhcmU6CiAqCiAqIC0gQUxQSEFCRVRJQyAtIHN0YW5kYXJkIHRleHQgYWxpZ25tZW50CiAqIC0gQk9UVE9NIC0gdGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgYm90dG9tIG9mIHRoZSBib3VuZGluZyBib3gKICogLSBIQU5HSU5HIC0gcmVsZXZhbnQgZm9yIFRpYmV0YW4gYW5kIG90aGVyIEluZGljIHNjcmlwdHMuCiAqIC0gSURFT0dSQVBISUMgLSByZWxldmFudCBmb3IgaWRlb2dyYXBoaWMgQ0pLViB0ZXh0LgogKiAtIE1JRERMRSAtIFRoZSB2ZXJ0aWNhbCBlcXVpdmFsZW50IG9mICJjZW50ZXIiLgogKiAtIFRPUCAtIFRoZSB0ZXh0IGlzIGFsaWduZWQgdG8gdGhlIHRvcCBvZiB0aGUgdHlwb2dyYXBoaWMgImVtIHNxdWFyZSIuCiAqCiAqIE5vdGUgdGhhdCB0aGUgcHJpbWFyeSB0ZXh0IGNvbG91ciB1c2VzIHRoZSBmaWxsIGNvbG91ci4gSWYgdGV4dAogKiBzdHJva2luZyBpcyBlbmFibGVkLCB0aGUgdGhlIHRleHQgb3V0bGluZSB3aWxsIGJlIGNvbG91cmVkIHVzaW5nCiAqIHRoZSBjdXJyZW50IHN0cm9rZSBjb2xvdXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgdGV4dCgibm9ybWFsIHRleHQiLCB3aWR0aC8yLCA2MCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgc2V0VGV4dFN0cm9rZSgxKTsKICogICAgICAgdGV4dCgidW5maWxsZWQgdGV4dCIsIHdpZHRoLzIsIDEwMCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgICBzZXRTdHJva2UoYHJlZGApOwogKiAgICAgICBzZXRGaWxsKGB5ZWxsb3dgKTsKICogICAgICAgdGV4dCgiZmFuY3kgdGV4dCIsIHdpZHRoLzIsIDE0MCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHRleHQgd2Ugd2FudCB0byBzaG93CiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSB0ZXh0IGxvY2F0aW9uJ3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgdGV4dCBsb2NhdGlvbidzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtzdHJpbmd9IHhBbGlnbj8gQW4gb3B0aW9uYWwgaG9yaXpvbnRhbCBhbGlnbm1lbnQgc3RyaW5nCiAqIEBwYXJhbSB7c3RyaW5nfSB5QWxpZ24/IEFuIG9wdGlvbmFsIHZlcnRpY2FsICBhbGlnbm1lbnQgc3RyaW5nCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHRleHQgd2Ugd2FudCB0byBzaG93CiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSB0ZXh0IGxvY2F0aW9uJ3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge3N0cmluZ30geEFsaWduPyBBbiBvcHRpb25hbCBob3Jpem9udGFsIGFsaWdubWVudCBzdHJpbmcKICogQHBhcmFtIHtzdHJpbmd9IHlBbGlnbj8gQW4gb3B0aW9uYWwgdmVydGljYWwgIGFsaWdubWVudCBzdHJpbmcKICoKICogQHNlZSB7QGxpbmsgc2V0VGV4dFN0cm9rZX0KICovCmZ1bmN0aW9uIHRleHQoc3RyLCB4LCB5LCB4QWxpZ24sIHlBbGlnbikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeUFsaWduID0geEFsaWduOwogICAgeEFsaWduID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgc2F2ZSgpOwogIGlmICh4QWxpZ24pIHsKICAgIHNldFRleHRBbGlnbih4QWxpZ24sIHlBbGlnbik7CiAgfQogIF9fY3R4LmZpbGxUZXh0KHN0ciwgeCwgeSk7CiAgaWYgKF9fdGV4dFN0cm9rZSkgewogICAgc2V0U3Ryb2tlKF9fdGV4dFN0cm9rZSk7CiAgICBfX2N0eC5zdHJva2VUZXh0KHN0ciwgeCwgeSk7CiAgfQogIHJlc3RvcmUoKTsKfQoKLyoqCiAqIERyYXcgYSB0cmlhbmdsZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYHJlZGApOwogKiAgICAgICB0cmlhbmdsZSh3aWR0aC8yLCAzMCwgMS80ICogd2lkdGgsIDE2MCwgMy80ICogd2lkdGgsIDExMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHgxIFRoZSBmaXJzdCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkxIFRoZSBmaXJzdCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHgyIFRoZSBzZWNvbmQgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MiBUaGUgc2Vjb25kIHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geDMgVGhlIHRoaXJkIHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTMgVGhlIHRoaXJkIHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDEgVGhlIGZpcnN0IHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDIgVGhlIHNlY29uZCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtQb2ludExpa2V9IHAzIFRoZSB0aGlyZCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICovCmZ1bmN0aW9uIHRyaWFuZ2xlKHgxLCB5MSwgeDIsIHkyLCB4MywgeTMpIHsKICBpZiAoeDEueCAhPT0gdW5kZWZpbmVkICYmIHgxLnkgIT09IHVuZGVmaW5lZCkgewogICAgeTMgPSB4Mi55OwogICAgeDMgPSB4Mi54OwogICAgeTIgPSB5MS55OwogICAgeDIgPSB5MS54OwogICAgeTEgPSB4MS55OwogICAgeDEgPSB4MS54OwogIH0KCiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICB2ZXJ0ZXgoeDIsIHkyKTsKICB2ZXJ0ZXgoeDMsIHkzKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICBlbmQoKTsKfQoKLyoqCiAqIEFkZCBhIHZlcnRleCB0byB0aGUgY3VycmVudGx5IGFjdGl2ZSBzaGFwZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYHJlZGApOwogKiAgICAgICBzdGFydCgpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgMzApOwogKiAgICAgICB2ZXJ0ZXgoMS80ICogd2lkdGgsIDE2MCk7CiAqICAgICAgIHZlcnRleCgzLzQgKiB3aWR0aCwgMTEwKTsKICogICAgICAgZW5kKCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHZlcnRleCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHZlcnRleCdzIHkgcGl4ZWwgdmFsdWUKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHZlcnRleCB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBzZWUge0BsaW5rIGVuZH0KICogQHNlZSB7QGxpbmsgc3RhcnR9CiAqLwpmdW5jdGlvbiB2ZXJ0ZXgoeCwgeSkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIGlmIChfX2ZpcnN0KSB7CiAgICBfX2N0eC5saW5lVG8oeCwgeSk7CiAgfSBlbHNlIHsKICAgIF9fZmlyc3QgPSB7IHgsIHkgfTsKICAgIF9fY3R4Lm1vdmVUbyh4LCB5KTsKICB9Cn0KLyoqCiAqIENyZWF0ZSBhbiBhcnJheSBvZiBzcGVjaWZpZWQgbGVuZ3RoLCBvcHRpb25hbGx5IGZpbGxlZCB1c2luZyBhCiAqIGZ1bmN0aW9uIHRoYXQgdGFrZXMgdGhlIGVsZW1lbnQgaW5kZXggYXMgc2luZ2xlIGlucHV0IGFyZ3VtZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICB0cmFuc2xhdGUoMCwgaGVpZ2h0LzIpOwogKiAgICAgICBsZXQgZGF0YSA9IGFycmF5KHdpZHRoLCAoaSkgPT4gW2ksIGhlaWdodC8yICogc2luKGkvMjUpXSk7CiAqICAgICAgIHBsb3REYXRhKGRhdGEsIDAsIDEpOwogKiAgICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIFRoZSBzaXplIG9mIHRoZSBhcnJheSB5b3Ugd2FudAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmaWxsRnVuY3Rpb24/IFRoZSBvcHRpb25hbCBmdW5jdGlvbiB0aGF0IGdldHMgdXNlZCB0byBmaWxsIHRoZSBhcnJheQogKi8KZnVuY3Rpb24gYXJyYXkobGVuLCBmaWxsRnVuY3Rpb24pIHsKICBjb25zdCBhcnIgPSBuZXcgQXJyYXkobGVuKS5maWxsKCk7CiAgaWYgKGZpbGxGdW5jdGlvbikgewogICAgcmV0dXJuIGFyci5tYXAoKF8sIGkpID0+IGZpbGxGdW5jdGlvbihpKSk7CiAgfQogIHJldHVybiBhcnI7Cn0KCi8qKgogKiBFbXB0eSB0aGUgbGlzdCBvZiBtb3ZhYmxlIHBvaW50cyBpbiB5b3VyIGdyYXBoaWMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGBsb2NrYCwgKCkgPT4gewogKiAgICAgICAgIGNsZWFyTW92YWJsZSgpOwogKiAgICAgICAgIHJlZHJhdygpOwogKiAgICAgICB9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBmb3IobGV0IHAgb2YgcG9pbnRzKSB7CiAqICAgICAgICAgc2V0Q29sb3IoaXNNb3ZhYmxlKHApID8gYHJlZGAgOiBgZ3JleWApOwogKiAgICAgICAgIHBvaW50KHApOwogKiAgICAgICB9CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bih4LHkpIHsKICogICAgICAgaWYgKGN1cnJlbnRNb3ZhYmxlKSByZXR1cm47CiAqICAgICAgIGNvbnN0IHAgPSBuZXcgUG9pbnQoeCx5KTsKICogICAgICAgcG9pbnRzLnB1c2gocCk7CiAqICAgICAgIHNldE1vdmFibGUocCk7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIGlzTW92YWJsZX0KICogQHNlZSB7QGxpbmsgc2V0TW92YWJsZX0KICovCmZ1bmN0aW9uIGNsZWFyTW92YWJsZSgpIHsKICBfX21vdmFibGVfcG9pbnRzLnNwbGljZSgwLCBfX21vdmFibGVfcG9pbnRzLmxlbmd0aCk7Cn0KCi8qKgogKiBDcmVhdGUgYSBjb3B5IG9mIHRoZSBjdXJyZW50IGNhbnZhcyBlbGVtZW50CiAqIGZvciB1c2Ugc29tZXdoZXJlIGVsc2UgaW4geW91ciBvd24gY29kZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBwaW5rYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bih4LHkpIHsKICogICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCgKICogICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoYGdyYXBoaWNzOnVwZGF0ZWAsIHsKICogICAgICAgICAgIGRldGFpbDogewogKiAgICAgICAgICAgICBjYW52YXM6IGNvcHkoKQogKiAgICAgICAgICAgfQogKiAgICAgICAgIH0pCiAqICAgICAgICk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge0hUTUxDYW52YXNFbGVtZW50fSBBIGNvcHkgb2YgdGhlIGN1cnJlbnQgY2FudmFzCiAqLwpmdW5jdGlvbiBjb3B5KCkgewogIGNvbnN0IGNvcHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBjYW52YXNgKTsKICBjb3B5LndpZHRoID0gd2lkdGg7CiAgY29weS5oZWlnaHQgPSBoZWlnaHQ7CiAgY29uc3QgY3R4ID0gY29weS5nZXRDb250ZXh0KGAyZGApOwogIGN0eC5kcmF3SW1hZ2UoX19jYW52YXMsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogIHJldHVybiBjb3B5Owp9CgovKioKICogR2VuZXJhdGVzIGEgY29sb3IgYmFzZWQgb24gdGhlIEhTTCBjb2xvciBzcGFjZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGNvbG9yKDQ1LCA4MCwgOTApKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gaHVlIGluIHRoZSByYW5nZSBbMCwgMzYwXQogKiBAcGFyYW0ge251bWJlcn0gc2F0dXJhdGlvbiBpbiB0aGUgcmFuZ2UgWzAsIDEwMF0KICogQHBhcmFtIHtudW1iZXJ9IGxpZ2h0bmVzcyBpbiB0aGUgcmFuZ2UgWzAsIDEwMF0KICogQHBhcmFtIHtudW1iZXJ9IG9wYWNpdHkgaW4gdGhlIHJhbmdlIFswLCAxXQogKiBAcmV0dXJucyB7c3RyaW5nfSBBIENTUyBoc2xhIGNvbG9yIHN0cmluZwogKgogKiBAc2VlIHtAbGluayByYW5kb21Db2xvcn0KICovCmZ1bmN0aW9uIGNvbG9yKGggPSBfX2N1cnJlbnRfaHVlLCBzID0gNTAsIGwgPSA1MCwgYSA9IDEpIHsKICByZXR1cm4gYGhzbGEoJHtofSwke3N9JSwke2x9JSwke2F9KWA7Cn0KCi8qKgogKiBGaW5kIGFuIEhUTUwgZWxlbWVudCBpbnNpZGUgeW91ciBncmFwaGljcy1lbGVtZW50CiAqIGJ5IHF1ZXJ5IHNlbGVjdG9yLiBUaGlzIGlzIGVxdWl2YWxlbnQgdG86CiAqCiAqIGBgYAogKiB5b3VyRWxlbWVudC5xdWVyeVNlbGVjdG9yKHFzKQogKiBgYGAKICoKICogQHBhcmFtIHtzdHJpbmd9IHF1ZXJ5U2VsZWN0b3IgQSBxdWVyeSBzZWxlY3RvcgogKiBAcmV0dXJucyB7SFRNTEVsZW1lbnR8bnVsbH0gVGhlIG1hdGNoZWQgZWxlbWVudCwgb3IgbnVsbCBpZiB0aGVyZSB3YXMgbm8gbWF0Y2guCiAqLwpmdW5jdGlvbiBmaW5kKHFzKSB7CiAgcmV0dXJuIF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKHFzKTsKfQoKLyoqCiAqIEZpbmQgYWxsIEhUTUwgZWxlbWVudHMgaW5zaWRlIHlvdXIgZ3JhcGhpY3MtZWxlbWVudAogKiB0aGF0IG1hdGNoIGEgZ2l2ZW4gcXVlcnkgc2VsZWN0b3IuIFRoaXMgaXMgZXF1aXZhbGVudCB0bzoKICoKICogYGBgCiAqIEFycmF5LmZyb20oeW91ckVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChxcykpCiAqIGBgYAogKgogKiBAcGFyYW0ge3N0cmluZ30gcXVlcnlTZWxlY3RvciBBIHF1ZXJ5IHNlbGVjdG9yCiAqIEByZXR1cm5zIHtIVE1MRWxlbWVudFtdfSBBbiBhcnJheSB3aXRoIGFsbCBtYXRjaGluZyBlbGVtZW50cywgW10gaWYgdGhlcmUgd2VyZSBubyBtYXRjaGVzLgogKi8KZnVuY3Rpb24gZmluZEFsbChxcykgewogIHJldHVybiBbLi4uX19lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocXMpXTsKfQoKLyoqCiAqIE1hcmsgYSBzcGVjaWZpYyBjb2xvciBhcyB0aGUgaGlnaGxpZ2h0IGNvbG9yLAogKiB3aGljaCBjYXVzZXMgdGhlIGdyYXBoaWMgdG8gcmVkcmF3IHdpdGggdGhhdAogKiBjb2xvciByZXBsYWNlZCBieSB3aGljaGV2ZXIgY29sb3IgeW91IHBpY2tlZAogKiBhcyBoaWdobGlnaHQgY29sb3IuCiAqCiAqIE5vdGUgdGhhdCB5b3UgY2FuIG9ubHkgdXNlIG5hbWVkIChDU1MpIGNvbG9ycwogKiB3aXRoIHRoaXMgZnVuY3Rpb24uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEhpZ2hsaWdodENvbG9yKGBsaW1lYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dCgibGV0J3MgZ28iLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJBY3RpdmUoc3RhdGUpIHsKICogICAgICAgaWYgKHN0YXRlKSBoaWdobGlnaHQoYHJlZGApOwogKiAgICAgICBlbHNlIGhpZ2hsaWdodChmYWxzZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtjb2xvcnxib29sZWFufSBjb2xvciBTZXQgdGhlIGNvbG9yIHRoYXQgc2hvdWxkIGdldCByZXBsYWNlZCB3aXRoIHRoZSBoaWdobGlnaHQgY29sb3IsIG9yIGRpc2FibGUgaGlnaGxpZ2h0IHdoZW4gY29sb3IgaXMgYGZhbHNlYAogKgogKiBAc2VlIHtAbGluayBzZXRIaWdobGlnaHRDb2xvcn0KICovCmZ1bmN0aW9uIGhpZ2hsaWdodChjb2xvcikgewogIGlmIChDU1NfQ09MT1JfTUFQW2NvbG9yXSkgewogICAgX19oaWdobGlnaHRfY29sb3IgPSBDU1NfQ09MT1JfTUFQW2NvbG9yXTsKICB9IGVsc2UgewogICAgX19oaWdobGlnaHRfY29sb3IgPSBjb2xvcjsKICB9CiAgcmVkcmF3KCk7Cn0KCi8qKgogKiBDaGVjayB3aGV0aGVyIGEgcG9pbnQgaXMgcmVnaXN0ZXJlZCBhcyBtb3ZhYmxlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgcG9pbnRzID0gW107CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGFkZEJ1dHRvbihgbG9ja2AsICgpID0+IHsKICogICAgICAgICBjbGVhck1vdmFibGUoKTsKICogICAgICAgICByZWRyYXcoKTsKICogICAgICAgfSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgZm9yKGxldCBwIG9mIHBvaW50cykgewogKiAgICAgICAgIHNldENvbG9yKGlzTW92YWJsZShwKSA/IGByZWRgIDogYGdyZXlgKTsKICogICAgICAgICBwb2ludChwKTsKICogICAgICAgfQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCx5KSB7CiAqICAgICAgIGlmIChjdXJyZW50TW92YWJsZSkgcmV0dXJuOwogKiAgICAgICBjb25zdCBwID0gbmV3IFBvaW50KHgseSk7CiAqICAgICAgIHBvaW50cy5wdXNoKHApOwogKiAgICAgICBzZXRNb3ZhYmxlKHApOwogKiAgICAgICByZWRyYXcoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gVGhlIHBvaW50IHRoYXQgd2Ugd2FudCB0byBjaGVjayAibW92YWJpbGl0eSIgZm9yCiAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIG91ciBwb2ludCBpcyBpbiB0aGUgbGlzdCBvZiBtb3ZhYmxlIHBvaW50cywgb3RoZXJ3aXNlIGZhbHNlCiAqCiAqIEBzZWUge0BsaW5rIGNsZWFyTW92YWJsZX0KICogQHNlZSB7QGxpbmsgc2V0TW92YWJsZX0KICovCmZ1bmN0aW9uIGlzTW92YWJsZShwb2ludCkgewogIHJldHVybiBfX21vdmFibGVfcG9pbnRzLmluY2x1ZGVzKHBvaW50KTsKfQoKLyoqCiAqIEdldCB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0aGF0IHRoaXMKICogZ3JhcGhpYyBoYXMgYmVlbiBydW5uaW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBjb25zdCBzZWNvbmRzID0gKG1pbGxpcygpLzEwMDApfDA7CiAqICAgICAgIHRleHQoYCR7c2Vjb25kc31zYCwgd2lkdGgvMiwgaGVpZ2h0LzIpCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge251bWJlcn0gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZSB0aGUgZ3JhcGhpYyBsb2FkZWQgaW4KICovCmZ1bmN0aW9uIG1pbGxpcygpIHsKICByZXR1cm4gRGF0ZS5ub3coKSAtIF9fc3RhcnRfdGltZTsKfQoKLyoqCiAqIFBhdXNlIHRoZSBncmFwaGljIGlmIGl0cyBjdXJyZW50bHkgcGxheWluZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKS50b0ZpeGVkKDEpOwogKiAgICAgICB0ZXh0KGAke3NlY29uZHN9c2AsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICBpZihzdGF0ZSkgewogKiAgICAgICAgIHBhdXNlKCk7CiAqICAgICAgIH0gZWxzZSB7CiAqICAgICAgICAgcGxheSgpOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgcGxheX0KICogQHNlZSB7QGxpbmsgdG9nZ2xlUGxheX0KICovCmZ1bmN0aW9uIHBhdXNlKCkgewogIHBsYXlpbmcgPSBmYWxzZTsKfQoKLyoqCiAqIFN0YXJ0IHBsYXlpbmcgeW91ciBncmFwaGljLCBtZWFuaW5nIGl0IHdpbGwgY2FsbCBkcmF3KCkKICogYXQgd2hhdGV2ZXIgcmF0ZSB0aGUgcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGxvb3AgaXMKICogYWxsb3dlZCB0byBydW4gb24geW91ciBjb21wdXRlci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGxldCBmcHMgPSAwOwogKiAgICAgbGV0IGNoZWNrZWQgPSBmYWxzZTsKICogICAgIGxldCBsYXN0RnJhbWVDaGVjayA9IDA7CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIGNvbnN0IHNlY29uZHMgPSAobWlsbGlzKCkvMTAwMCkudG9GaXhlZCgxKTsKICogICAgICAgdGV4dChgZnBzOiAke2Zwc31gLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgICAgaWYgKHNlY29uZHMuZW5kc1dpdGgoYC4wYCkpIHsKICogICAgICAgICBpZiAoIWNoZWNrZWQpIHsKICogICAgICAgICAgIGNoZWNrZWQgPSB0cnVlOwogKiAgICAgICAgICAgZnBzID0gZnJhbWUgLSBsYXN0RnJhbWVDaGVjazsKICogICAgICAgICAgIGxhc3RGcmFtZUNoZWNrID0gZnJhbWU7CiAqICAgICAgICAgfQogKiAgICAgICB9IGVsc2UgewogKiAgICAgICAgIGNoZWNrZWQgPSBmYWxzZTsKICogICAgICAgfQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHBhdXNlfQogKiBAc2VlIHtAbGluayB0b2dnbGVQbGF5fQogKi8KZnVuY3Rpb24gcGxheSgpIHsKICBwbGF5aW5nID0gdHJ1ZTsKICBfX2RyYXcoKTsKfQoKLyoqCiAqIEdlbmVyYXRlIGEgcmFuZG9tIGNvbG91ci4gTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24KICogYWxsb3dzIHlvdSB0byBnZXQgInRoZSBjdXJyZW50bHkgZ2VuZXJhdGVkIHJhbmRvbQogKiBjb2xvdXIiIGluIGRpZmZlcmVudCBvcGFjaXRpZXMgYnkgY2FsbGluZyB0aGUgZnVuY3Rpb24KICogd2l0aCBhbiBvcGFjaXR5IHZhbHVlLCBhbmQgYGZhbHNlYCBhcyBjeWNsZSBhcmd1bWVudC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oKSB7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBvcGFjaXR5IFRoZSBvcGFjaXR5IHZhbHVlIGluIHRoZSByYW5nZSBbMCwxXQogKiBAcGFyYW0ge251bWJlcn0gY3ljbGU/IEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyB3aGV0aGVyIG9yIG5vdCB0byBtb3ZlIG9uIHRvIHRoZSBuZXh0IGNvbG91ciAoZGVmYXVsdCA9IHRydWUpCiAqCiAqIEBzZWUge0BsaW5rIGNvbG9yfQogKi8KZnVuY3Rpb24gcmFuZG9tQ29sb3IoYSA9IDEuMCwgY3ljbGUgPSB0cnVlKSB7CiAgaWYgKGN5Y2xlKSBfX2N1cnJlbnRfaHVlID0gcmFuZG9tKDAsIDM2MCk7CiAgcmV0dXJuIGBoc2xhKCR7X19jdXJyZW50X2h1ZX0sNTAlLDUwJSwke2F9KWA7Cn0KCi8qKgogKiBBbiBhbHRlcm5hdGl2ZSB0byB3cml0aW5nIGZvciBsb29wcywgYmVjYXVzZQogKiBubyBvbmUgd2FudHMgdG8gY29uc3RhbnRseSB3cml0ZSB2YXIgYWxsb2NhdGlvbnMKICogdGhhdCBvbmx5IGxpdmUgZm9yIHRoZSBkdXJhdGlvbiBvZiBhIGxvb3AuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcmFuZ2UoMCwgVEFVLCAoYSkgPT4gcG9pbnQoNDAgKiBjb3MoYSksIDQwICogc2luKGEpKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IFRoZSBlcXVpdmFsZW50IG9mIGEgZm9yIGxvb3AncyBpbml0aWFsIGBsZXQgaSA9IC4uLmAKICogQHBhcmFtIHtudW1iZXJ9IGVuZCBUaGUgZXF1aXZhbGVudCBvZiBhIGZvciBsb29wJ3MgYGkgPCBlbmRgCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGVwPyBUaGUgc3RlcCBzaXplIGJ5IHdoaWNoIHRvIGluY3JlbWVudCBhdCBlYWNoIGl0ZXJhdGlvbiAoZGVmYXVsdHMgPSBgKHN0YXJ0LWVuZCkvMTBgKQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBydW5GdW5jdGlvbiBUaGUgZnVuY3Rpb24gdG8gcnVuIGF0IGVhY2ggaXRlcmF0aW9uCiAqLwpmdW5jdGlvbiByYW5nZShzdGFydCwgZW5kLCBzdGVwLCBydW5GdW5jdGlvbikgewogIGlmICh0eXBlb2Ygc3RlcCA9PT0gYGZ1bmN0aW9uYCkgewogICAgcnVuRnVuY3Rpb24gPSBzdGVwOwogICAgc3RlcCA9IChlbmQgLSBzdGFydCkgLyAxMDsKICB9CiAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpICs9IHN0ZXApIHsKICAgIHJ1bkZ1bmN0aW9uKGkpOwogIH0KfQoKLyoqCiAqIFNhZmVseSB0cmlnZ2VyIGEgbmV3IGRyYXcgcGFzcy4gSWYgdGhlIGdyYXBoaWMgaXMgcnVubmluZwogKiBpbiBhbmltYXRlZCBtb2RlLCBvciBhIHJlZHJhdygpIGlzIHRyaWdnZXJlZCBfZHVyaW5nXyBhCiAqIHJlZHJhdygpLCB0aGlzIGNhbGwgd2lsbCBkbyBub3RoaW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY29uc3QgaCA9IG1hcChwb2ludGVyLngsIDAsIHdpZHRoLCAwLCAzNjApOwogKiAgICAgICBjb25zdCBsID0gbWFwKHBvaW50ZXIueSwgMCwgaGVpZ2h0LCA1MCwgMCk7CiAqICAgICAgIGNsZWFyKGNvbG9yKGgsIDEwMCwgbCkpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlck1vdmUoKSB7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqLwpmdW5jdGlvbiByZWRyYXcoKSB7CiAgaWYgKF9fcmVkcmF3aW5nKSByZXR1cm47CiAgaWYgKHBsYXlpbmcpIHJldHVybjsKICBfX3JlZHJhd2luZyA9IHRydWU7CiAgX19kcmF3KCk7CiAgX19yZWRyYXdpbmcgPSBmYWxzZTsKfQoKLyoqCiAqIFJlc3RvcmUgdGhlIGdyYXBoaWNzIGNvbnRleHQgKHRyYW5zZm9ybXMsCiAqIGN1cnJlbnQgY29sb3JzLCBldGMpIHRvIHdoYXQgdGhleSB3ZXJlCiAqIHdoZW4gc2F2ZSgpIHdhcyBjYWxsZWQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIGxpbmUoMCwwLDgwLDApOwogKiAgICAgICBzYXZlKCk7CiAqICAgICAgIHNldENvbG9yKGBkYXJrZ3JlZW5gKQogKiAgICAgICByYW5nZSgwLCA1LCAxLCAoYSkgPT4gewogKiAgICAgICAgIHJvdGF0ZShQSS84KTsKICogICAgICAgICBsaW5lKDAsMCw4MCwwKTsKICogICAgICAgfSk7CiAqICAgICAgIHJlc3RvcmUoKTsKICogICAgICAgbGluZSgtMjAsMCwtODAsMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2F2ZX0KICovCmZ1bmN0aW9uIHJlc3RvcmUoKSB7CiAgX19jdHgucmVzdG9yZSgpOwp9CgovKioKICogTWFyayBvbmUgb3IgbW9yZSBwb2ludHMgYXMgbW92YWJsZSwgbWVhbmluZwogKiB0aGF0IHRoZSB1c2VyIGNhbiByZXBvc2l0aW9uIHRoZSBwb2ludCBhcm91bmQgb24KICogdGhlIGNhbnZhcyBieSB0b3VjaC9jbGljay1kcmFnZ2luZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBmb3IgKGxldCBpID0gNDA7IGkgPCAyMDA7IGkgKz0gMjApIHsKICogICAgICAgICBwb2ludHMucHVzaChuZXcgUG9pbnQoaSAtIDIwLCAxMjApKTsKICogICAgICAgfQogKiAgICAgICBzZXRNb3ZhYmxlKC4uLnBvaW50cyk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgc2V0U3Ryb2tlKGBwdXJwbGVgKTsKICogICAgICAgYnNwbGluZSguLi5wb2ludHMpOwogKiAgICAgICBmb3IobGV0IHAgb2YgcG9pbnRzKSBwb2ludChwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge1BvaW50TGlrZVtuXX0gcG9pbnRzIE9uZSBvciBtb3JlIHBvaW50cyB0byBtYXJrIGFzIG1vdmFibGUuCiAqCiAqIEBzZWUge0BsaW5rIGlzTW92YWJsZX0KICogQHNlZSB7QGxpbmsgY2xlYXJNb3ZhYmxlfQogKi8KZnVuY3Rpb24gc2V0TW92YWJsZSguLi5wb2ludHMpIHsKICBwb2ludHMuZm9yRWFjaCgocCkgPT4gewogICAgaWYgKF9fbW92YWJsZV9wb2ludHMuaW5kZXhPZihwKSA9PT0gLTEpIHsKICAgICAgX19tb3ZhYmxlX3BvaW50cy5wdXNoKHApOwogICAgfQogIH0pOwp9CgovKioKICogU2V0IChvciBjaGFuZ2UpIHRoZSBncmFwaGljJ3Mgc2l6ZS4gTm90ZSB0aGF0IHlvdXIgd2lkdGgKICogYW5kIGhlaWdodCB2YWx1ZXMgd2lsbCBnZXQgcm91bmRlZCB0byBpbnRlZ2VyIHZhbHVlcy4KICoKICogTm90ZSB0aGF0IGBzZXRTaXplYCB3aWxsIGltbWVkaWF0ZWx5IHRyaWdnZXIgYSByZWRyYXcsCiAqIHdoZXRoZXIgeW91IHdhbnQgaXQgdG8gb3Igbm90LCBiZWNhdXNlIGNoYW5naW5nIGNhbnZhcwogKiBkaW1lbnNpb25zIGNsZWFycyB0aGUgY2FudmFzLCBuZWNlc3NpdGF0aW5nIGEgcmVkcmF3LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoNDAwLCAyMDApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgY2VudGVyKCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApCiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgdGV4dChgJHt3aWR0aH0vJHtoZWlnaHR9YCwgMCwgMCwgQ0VOVEVSLCBNSURETEUpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlclVwKCkgewogKiAgICAgICBzZXRTaXplKHJhbmRvbSgxMDAsNDAwKSwgMjAwKTsKICogICAgICAgLy8gTm90ZSB0aGF0IHRoZXJlIGlzIG5vIHJlZHJhdygpIGhlcmUhCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIFRoZSBncmFwaGljcyB3aWR0aCBpbiBwaXhlbHMKICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCBUaGUgZ3JhcGhpY3MgaGVpZ2h0IGluIHBpeGVscwogKi8KZnVuY3Rpb24gc2V0U2l6ZSh3ID0gNDAwLCBoID0gMjAwKSB7CiAgd2lkdGggPSBfX2NhbnZhcy53aWR0aCA9IHcgfCAwOwogIGhlaWdodCA9IF9fY2FudmFzLmhlaWdodCA9IGggfCAwOwogIF9fZWxlbWVudC5zdHlsZS5tYXhXaWR0aCA9IGBjYWxjKDJlbSArICR7d2lkdGh9cHhgOwogIF9fY3R4ID0gX19jYW52YXMuZ2V0Q29udGV4dChgMmRgKTsKICBfX2RyYXcoKTsKfQoKLyoqCiAqIFNhdmUgdGhlIGN1cnJlbnQgZ3JhcGhpY3MgY29udGV4dCAodHJhbnNmb3JtcywKICogY3VycmVudCBjb2xvcnMsIGV0Yykgc28gdGhhdCB0aG9zZSBjYW4gYmUgcmVzdG9yZWQKICogYWZ0ZXIgY2hhbmdpbmcgdGhlbS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZSgwLDAsODAsMCk7CiAqICAgICAgIHNhdmUoKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApCiAqICAgICAgIHJhbmdlKDAsIDUsIDEsIChhKSA9PiB7CiAqICAgICAgICAgcm90YXRlKFBJLzgpOwogKiAgICAgICAgIGxpbmUoMCwwLDgwLDApOwogKiAgICAgICB9KTsKICogICAgICAgcmVzdG9yZSgpOwogKiAgICAgICBsaW5lKC0yMCwwLC04MCwwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiAqIEBzZWUge0BsaW5rIHJlc3RvcmV9CiAqLwpmdW5jdGlvbiBzYXZlKCkgewogIF9fY3R4LnNhdmUoKTsKfQoKLyoqCiAqIENvbnZlcnQgdGhlIGN1cnJlbnQgY2FudmFzIGludG8gYW4gZGF0YSBVUkwKICogdGhhdCByZXByZXNlbnRzIGEgUE5HIGltYWdlLgogKgogKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgY3VycmVudCBjYW52YXMgYXMgUE5HIGRhdGEgVVJMCiAqLwpmdW5jdGlvbiB0b0RhdGFVUkwoKSB7CiAgcmV0dXJuIF9fY2FudmFzLnRvRGF0YVVSTCgpOwp9CgovKioKICogSWYgdGhlIGdyYXBoaWMgaXMgY3VycmVudGx5IHBsYXlpbmcsIHBhdXNlIGl0LAogKiBhbmQgaWYgaXQncyBwYXVzZWQsIHBsYXkgaXQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIGNvbnN0IHNlY29uZHMgPSAobWlsbGlzKCkvMTAwMCkudG9GaXhlZCgxKTsKICogICAgICAgdGV4dChgJHtzZWNvbmRzfXNgLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJBY3RpdmUoc3RhdGUpIHsKICogICAgICAgdG9nZ2xlUGxheSgpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEByZXR1cm5zIHtib29sZWFufSBUaGUgbmV3IHBsYXkgc3RhdGUKICoKICogQHNlZSB7QGxpbmsgcGF1c2V9CiAqIEBzZWUge0BsaW5rIHBsYXl9CiAqLwpmdW5jdGlvbiB0b2dnbGVQbGF5KCkgewogIHBsYXlpbmcgPyBwYXVzZSgpIDogcGxheSgpOwogIHJldHVybiBwbGF5aW5nOwp9CmNvbnN0IHsKICAvKioKICAgKiBHZXQgdGhlIGFic29sdXRlIHZhbHVlIGZvciBzb21lIGlucHV0CiAgICoKICAgKiBFeGFtcGxlOgogICAqCiAgICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAgICogICA8Z3JhcGhpY3Mtc291cmNlPgogICAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogICAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogICAqICAgICAgIHRyYW5zbGF0ZSgwLCBoZWlnaHQvMik7CiAgICogICAgICAgbm9GaWxsKCk7CiAgICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogICAqICAgICAgIGxpbmUoLWh1Z2UsIDAsIGh1Z2UsIDApOwogICAqCiAgICogICAgICAgY29uc3QgdzIgPSB3aWR0aC8yOwogICAqICAgICAgIGNvbnN0IGRhdGEgPSBhcnJheSh3aWR0aCwgKHgpID0+IFt4LCB4IC0gdzIsIGFicyh4IC0gdzIpXSk7CiAgICoKICAgKiAgICAgICBzZXRTdHJva2UoYHJlZGApOwogICAqICAgICAgIHBsb3REYXRhKGRhdGEsIDAsIDEpOwogICAqCiAgICogICAgICAgc2V0U3Ryb2tlKGBibHVlYCk7CiAgICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMik7CiAgICogICAgIH0KICAgKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogICAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSB2IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaW5wdXQgdmFsdWUgd2l0aCBpdHMgc2lnbiBzZXQgdG8gcG9zaXRpdmUKICAgKi8KICBhYnMsCgogIC8qKgogICAqIFRoZSBpbnZlcnNlIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IHYgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnZlcnNlIGNvc2luZSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgYXNpbn0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICBhY29zLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIGNvc2luZQogICAqCiAgICogQHNlZSB7QGxpbmsgYXNpbmh9CiAgICogQHNlZSB7QGxpbmsgYWNvc30KICAgKi8KICBhY29zaCwKCiAgLyoqCiAgICogVGhlIGludmVyc2Ugc2luZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaW52ZXJzZSBzaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBhY29zfQogICAqIEBzZWUge0BsaW5rIGFzaW5ofQogICAqLwogIGFzaW4sCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGludmVyc2Ugc2luZSBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIHNpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGFjb3NofQogICAqIEBzZWUge0BsaW5rIGFzaW59CiAgICovCiAgYXNpbmgsCgogIC8qKgogICAqIFRoZSBpbnZlcnNlIHRhbmdlbnQgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludmVyc2UgdGFuZ2VudAogICAqCiAgICogQHNlZSB7QGxpbmsgdGFufQogICAqLwogIGF0YW4sCgogIC8qKgogICAqIFRoZSAiYXRhbjIiIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQXRhbjIKICAgKgogICAqIEBwYXJhbSB7eX0gaW5wdXQgQW55IG51bWJlcgogICAqIEBwYXJhbSB7eH0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBhdGFuMiBhbmdsZSBmb3IgdGhpcyBudW1iZXIgcGFpcgogICAqLwogIGF0YW4yLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIHRhbmdlbnQgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnNlX2h5cGVyYm9saWNfZnVuY3Rpb25zI0RlZmluaXRpb25zX2luX3Rlcm1zX29mX2xvZ2FyaXRobXMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGh5cGVyYm9saWMgaW52ZXJzZSB0YW5nZW50CiAgICoKICAgKiBAc2VlIHtAbGluayB0YW59CiAgICogQHNlZSB7QGxpbmsgYWNvc2h9CiAgICogQHNlZSB7QGxpbmsgYXNpbmh9CiAgICovCiAgYXRhbmgsCgogIC8qKgogICAqIFRoZSBjdWJlIHJvb3QgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIChyZWFsKSBjdWJlIHJvb3Qgb2YgdGhhdCBudW1iZXIKICAgKgogICAqIEBzZWUge0BsaW5rIHNxcnR9CiAgICovCiAgY2JydCwKCiAgLyoqCiAgICogVGhlICJyb3VuZCB1cCB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIiBmdW5jdGlvbi4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGludGVnZXIgcmVzdWx0IGFmdGVyIHJvdW5kaW5nIHVwLgogICAqCiAgICogQHNlZSB7QGxpbmsgZmxvb3J9CiAgICogQHNlZSB7QGxpbmsgcm91bmR9CiAgICovCiAgY2VpbCwKCiAgLyoqCiAgICogR2V0IHRoZSBudW1iZXIgb2YgbGVhZGluZyB6ZXJvIGJpdHMgaW4gdGhlIDMyLWJpdCBiaW5hcnkgcmVwcmVzZW50YXRpb24gb2YgYSBudW1iZXIKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIG51bWJlciBvZiBsZWFkaW5nIHplcm8gYml0cyBpbiB0aGUgMzItYml0IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGF0IG51bWJlci4KICAgKi8KICBjbHozMiwKCiAgLyoqCiAgICogVGhlIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY29zaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBzaW59CiAgICovCiAgY29zLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBjb3NpbmUgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnNlX2h5cGVyYm9saWNfZnVuY3Rpb25zI0RlZmluaXRpb25zX2luX3Rlcm1zX29mX2xvZ2FyaXRobXMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGh5cGVyYm9saWMgY29zaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBjb3N9CiAgICogQHNlZSB7QGxpbmsgYWNvc2h9CiAgICovCiAgY29zaCwKCiAgLyoqCiAgICogVGhlIGV4cG9uZW50IGZ1bmN0aW9uLCB0aGF0IGlzOiBlXngKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIHZhbHVlIG9mIEUgcmFpc2VkIHRvIHRoYXQgbnVtYmVyJ3MgcG93ZXIKICAgKgogICAqIEBzZWUge0BsaW5rIEV9CiAgICovCiAgZXhwLAoKICAvKioKICAgKiBUaGUgInJvdW5kIGRvd24gdG8gdGhlIG5lYXJlc3QgaW50ZWdlciIgZnVuY3Rpb24uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnRlZ2VyIHJlc3VsdCBhZnRlciByb3VuZGluZyBkb3duLgogICAqCiAgICogQHNlZSB7QGxpbmsgY2VpbH0KICAgKiBAc2VlIHtAbGluayByb3VuZH0KICAgKi8KICBmbG9vciwKCiAgLyoqCiAgICogUm91bmQgYSBudW1iZXIgdG8gdGhlIG5lYXJlc3QgMzIgYml0LCByYXRoZXIgdGhhbiB0aGUKICAgKiBzdGFuZGFyZCBKUyA2NCBiaXQsIGZsb2F0aW5nIHBvaW50IHJlcHJlc2VudGF0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgbnVtYmVyIGFmdGVyIHJvdW5kaW5nIHRvIHRoZSBuZWFyZXN0IDMyIGJpdCBmbG9hdGluZyBwb2ludCByZXByZXNlbnRhdGlvbi4KICAgKgogICAqIEBzZWUge0BsaW5rIHJvdW5kfQogICAqLwogIGZyb3VuZCwKCiAgLyoqCiAgICogVGhlIEV1Y2xpZGVhbiBoeXBvdGVudXNlIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcltdfSAuLi5pbnB1dCBUd28gb3IgbW9yZSBudW1iZXJzCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGh5cG90ZW51c2UgZ2l2ZW4gdGhvc2UgbnVtYmVycy4KICAgKi8KICBoeXBvdCwKCiAgLyoqCiAgICogVGhlIDMyIGJpdCBpbnRlZ2VyIG11bHRpcGxpY2F0aW9uIGZ1bmN0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGEgQW55IDMyIGJpdCBpbnRlZ2VyCiAgICogQHBhcmFtIHtudW1iZXJ9IGIgQW55IDMyIGJpdCBpbnRlZ2VyCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIDMyIGJpdCBpbnRlZ2VyIHJlc3VsdCBvZiBhICogYgogICAqLwogIGltdWwsCgogIC8qKgogICAqIFRoZSBuYXR1cmFsIGxvZ2FyaXRobSBmdW5jdGlvbiwgaS5lLiB0aGUgYmFzZS1FIGxvZ2FyaXRobQogICAqCiAgICogKE5vdGUgdGhhdCBpbiBKUyB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCAibG9nIiByYXRoZXIgdGhhbiAibG4iKQogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgbmF0dXJhbCBsb2dhcml0aG0gb2YgdGhhdCBudW1iZXIKICAgKgogICAqIEBzZWUge0BsaW5rIEV9CiAgICogQHNlZSB7QGxpbmsgbG9nfQogICAqLwogIGxvZzogbG4sCgogIC8qKgogICAqIFRoZSAiY29tbW9uIGxvZ2FyaXRobSIgZnVuY3Rpb24sIGkuZS4gdGhlIGJhc2UtMTAgbG9nYXJpdGhtLgogICAqCiAgICogKE5vdGUgdGhhdCBpbiBKUyB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCAibG9nMTAiIHJhdGhlciB0aGFuICJsb2ciKQogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY29tbW9uIGxvZ2FyaXRobSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgbG59CiAgICovCiAgbG9nMTA6IGxvZywKCiAgLyoqCiAgICogVGhlIGJpbmFyeSBsb2dhcml0aG0gZnVuY3Rpb24sIGkuZS4gdGhlIGJhc2UtMiBsb2dhcml0aG0uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBiYXNlIDIgbG9nYXJpdGhtIG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBsbn0KICAgKiBAc2VlIHtAbGluayBsb2d9CiAgICovCiAgbG9nMiwKCiAgLyoqCiAgICogRmluZCB0aGUgbWF4aW11bSB2YWx1ZSBpbiBhIHNldCBvZiBudW1iZXJzCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gLi4uaW5wdXQgQW55IHR3byBvciAgbW9yZSBudW1iZXJzCiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGhpZ2hlc3QgdmFsdWVkIG51bWJlciBmcm9tIGFtb25nIHRoZSBpbnB1dC4KICAgKgogICAqIEBzZWUge0BsaW5rIG1pbn0KICAgKi8KICBtYXgsCgogIC8qKgogICAqIEZpbmQgdGhlIG1pbmltdW0gdmFsdWUgaW4gYSBzZXQgb2YgbnVtYmVycwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IC4uLmlucHV0IEFueSB0d28gb3IgIG1vcmUgbnVtYmVycwogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBsb3dlc3QgdmFsdWVkIG51bWJlciBmcm9tIGFtb25nIHRoZSBpbnB1dC4KICAgKgogICAqIEBzZWUge0BsaW5rIG1heH0KICAgKi8KICBtaW4sCgogIC8qKgogICAqIFRoZSBwb3dlciBmdW5jdGlvbi4KICAgKgogICAqIE5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIGEgaG9sZG92ZXIgZnJvbSBiZWZvcmUgSlMKICAgKiBoYWQgdGhlIGAqKmAgb3BlcmF0b3IgZm9yIHBlcmZvcm1pbmcgdGhpcyBjYWxjdWxhdGlvbi4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBhIEFueSBudW1iZXIKICAgKiBAcGFyYW0ge251bWJlcn0gYiBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcnxOYU59IG91dHB1dCBhICoqIGIgb3IgTmFOIGlmIHRoYXQgaXMgdW5kZWZpbmVkCiAgICovCiAgcG93LAoKICAvKioKICAgKiBUaGUgInJvdW5kIHRvIHRoZSBuZWFyZXN0IGludGVnZXIiIGZ1bmN0aW9uLCByb3VuZGluZyBhbnkKICAgKiB2YWx1ZSBbeC4wLCB4LjQ5OTkuLi5dIHRvIHgsIGFuZCBhbnkgdmFsdWUgW3guNSwgeC45OTkuLi5dCiAgICogdG8geCArIDEuCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnRlZ2VyIHJlc3VsdCBhZnRlciByb3VuZGluZy4KICAgKgogICAqIEBzZWUge0BsaW5rIGNlaWx9CiAgICogQHNlZSB7QGxpbmsgZmxvb3J9CiAgICovCiAgcm91bmQsCgogIC8qKgogICAqIEdldCB0aGUgc2lnbiBvZiBhIG51bWJlcgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSArMSBpZiB0aGUgbnVtYmVyIHdhcyBwb3NpdGl2ZSwgLTEgaWYgaXQgd2FzIG5lZ2F0aXZlLCBvciAwIGlmIHRoZSBpbnB1dCB3YXMgemVyby4KICAgKi8KICBzaWduLAoKICAvKioKICAgKiBUaGUgc2luZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgc2luZQogICAqCiAgICogQHNlZSB7QGxpbmsgY29zfQogICAqLwogIHNpbiwKCiAgLyoqCiAgICogVGhlIGh5cGVyYm9saWMgc2luZSBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaHlwZXJib2xpYyBzaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBzaW59CiAgICogQHNlZSB7QGxpbmsgYWNvc2h9CiAgICovCiAgc2luaCwKCiAgLyoqCiAgICogVGhlIHNxdWFyZSByb290IGZ1bmN0aW9uLgogICAqCiAgICoKICAgKiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBpcyBhIGhvbGRvdmVyIGZyb20gYmVmb3JlIEpTCiAgICogaGFkIHRoZSBgKipgIG9wZXJhdG9yIGZvciBwZXJmb3JtaW5nIHRoaXMgY2FsY3VsYXRpb24KICAgKiBieSB1c2luZyBgeCAqKiAwLjVgLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgc3F1YXJlIHJvb3Qgb2YgdGhhdCBudW1iZXIKICAgKgogICAqIEBzZWUge0BsaW5rIGNicnR9CiAgICogQHNlZSB7QGxpbmsgcG93fQogICAqLwogIHNxcnQsCgogIC8qKgogICAqIFRoZSB0YW5nZW50IGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSB0YW5nZW50CiAgICovCiAgdGFuLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyB0YW5nZW50IGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBoeXBlcmJvbGljIHRhbmdlbnQKICAgKgogICAqIEBzZWUge0BsaW5rIHRhbn0KICAgKiBAc2VlIHtAbGluayBhc2luaH0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICB0YW5oLAoKICAvKioKICAgKiBUcnVuY2F0ZSBhIGZyYWN0aW9uIHRvIGFuIGludGVnZXIgYnkgc2ltcGx5IGRyb3BwaW5nIHRoZSBmcmFjdGlvbmFsIHBhcnQuCiAgICogTm90ZSB0aGF0IHRoaXMgZGlmZmVycyBmcm9tIHRoZSBgZmxvb3JgIGZ1bmN0aW9uOgogICAqCiAgICogYGBgCiAgICogZmxvb3IoNC4yKTsgIC8vIDQKICAgKiBmbG9vcigtNC4yKTsgLy8gLTUKICAgKgogICAqIHRydW5jKDQuMik7ICAvLyA0CiAgICogdHJ1bmMoLTQuMik7IC8vIC00CiAgICogYGBgCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnRlZ2VyIHBhcnQgb25seSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgZmxvb3J9CiAgICovCiAgdHJ1bmMsCn0gPSBNYXRoOwoKLyoqCiAqIEdldCB0aGUgYmlub21pYWwgY29lZmZpY2llbnQgKG4gY2hvb3NlIGspLgogKgogKiBAcGFyYW0ge251bWJlcn0gbiBBIHBvc2l0aXZlIGludGVnZXIKICogQHBhcmFtIHtudW1iZXJ9IGsgQSBwb3NpdGl2ZSBpbnRlZ2VyIGxlc3MgdGhhbiBvciBlcXVhbCB0byBgbmAKICogQHJldHVybnMge251bWJlcn0gVGhlIHZhbHVlIChuIGNob29zZSBrKQogKi8KZnVuY3Rpb24gYmlub21pYWwobiwgaykgewogIGlmIChuID09PSAwKSByZXR1cm4gMTsKICB2YXIgbHV0ID0gX19iaW5vbWlhbENvZWZmaWNpZW50czsKICB3aGlsZSAobiA+PSBsdXQubGVuZ3RoKSB7CiAgICB2YXIgcyA9IGx1dC5sZW5ndGg7CiAgICB2YXIgbmV4dFJvdyA9IFsxXTsKICAgIGZvciAodmFyIGkgPSAxLCBwcmV2ID0gcyAtIDE7IGkgPCBzOyBpKyspIHsKICAgICAgbmV4dFJvd1tpXSA9IGx1dFtwcmV2XVtpIC0gMV0gKyBsdXRbcHJldl1baV07CiAgICB9CiAgICBuZXh0Um93W3NdID0gMTsKICAgIGx1dC5wdXNoKG5leHRSb3cpOwogIH0KICByZXR1cm4gbHV0W25dW2tdOwp9CgovKioKICogQ29uc3RyYWluIGEgbnVtYmVyIHRvIHdpdGhpbiBhIGdpdmVuIHJhbmdlLgogKiBUaGlzIGlzIHJlYWxseSBub3RoaW5nIG1vcmUgdGhhbiBhIGNvbnZlbmllbnQKICogZnVuY3Rpb24gd3JhcHBlciBhcm91bmQgdGhlIHN0YXRlbWVudDoKICoKICogYGBgCiAqIHYgPCBzID8gcyA6IHYgPiBlID8gZSA6IHYKICogYGBgCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29uc3RyYWluCiAqIEBwYXJhbSB7bnVtYmVyfSBsb3dlckJvdW5kIFRoZSBsb3dlciBib3VuZCBvbiBvdXIgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHVwcGVyQm91bmQgVGhlIHVwcGVyIGJvdW5kIG9uIG91ciB2YWx1ZQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgdmFsdWUsIGlmIGl0IGZhbGxzIHdpdGhpbmcgW2xvd2VyQm91bmQsdXBwZXJCb3VuZF0sIG90aGVyd2lzZSBvbmUgb2YgdGhvc2UgYm91bmRzLgogKgogKiBAc2VlIHtAbGluayBjb25zdHJhaW5NYXB9CiAqLwpmdW5jdGlvbiBjb25zdHJhaW4odiwgcywgZSkgewogIHJldHVybiB2IDwgcyA/IHMgOiB2ID4gZSA/IGUgOiB2Owp9CgovKioKICogVGhlIGNvc2VjYW50IGZ1bmN0aW9uLCB3aGljaCBpczoKICoKICogYGBgCiAqIDEgLyBzaW4odikKICogYGBgCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgaW5wdXQgdmFsdWUsIGluIHJhZGlhbnMuCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBjb3NlY2FudCBvZiBvdXIgdmFsdWUuCiAqCiAqIEBzZWUge0BsaW5rIHNlY30KICovCmZ1bmN0aW9uIGNzYyh2KSB7CiAgcmV0dXJuIDEgLyBzaW4odik7Cn0KCi8qKgogKiBUaGUgY290YW5nZW50IGZ1bmN0aW9uLCB3aGljaCBpczoKICoKICogYGBgCiAqIGNvcyh2KSAvIHNpbih2KQogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSBpbnB1dCB2YWx1ZSwgaW4gcmFkaWFucy4KICogQHJldHVybnMge251bWJlcn0gVGhlIGNvdGFuZ2VudCBvZiBvdXIgdmFsdWUuCiAqCiAqIEBzZWUge0BsaW5rIHRhbn0KICovCmZ1bmN0aW9uIGN0bih2KSB7CiAgcmV0dXJuIGNvcyh2KSAvIHNpbih2KTsKfQoKLyoqCiAqIENvbnZlcnQgYSBudW1iZXIgaW4gcmFkaWFucyB0byBhIG51bWJlciBpbiBkZWdyZWVzLgogKiBUaGlzIGlzIHJlYWxseSBub3RoaW5nIG1vcmUgdGhhbiBhIGNvbnZlbmllbnQKICogZnVuY3Rpb24gd3JhcHBlciBhcm91bmQgdGhlIHN0YXRlbWVudDoKICoKICogYGBgCiAqIHYvUEkgKiAxODAKICogYGBgCiAqCiAqIFdpdGggb25lIHRyaWNrLCBpbiB0aGF0IGl0IGFsbG93cyB5b3UgdG8gY29uc3RyYWluIHRoZQogKiByZXN1bHRhbnQgdmFsdWUgdG8gdGhlIHN0YW5kYXJkIFswLCAzNjBdIGludGVydmFsLgogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnN0cmFpbgogKiBAcGFyYW0ge2Jvb2xlYW59IGNvbnN0cmFpbj8gQSBib29sZWFuIHRoYXQgZGV0ZXJtaW5lcyB3aGV0aGVyIG9yIG5vdCB0byBjb25zdHJhaW4gdGhlIHJlc3VsdGFudCB2YWx1ZSB0byBbMCwgMzYwXSAoZGVmYXVsdCA9IGZhbHNlKQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgZGVncmVlIHZhbHVlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGlucHV0IHZhbHVlIGluIHJhZGlhbnMsIG9wdGlvbmFsbHkgY29uc3RyYWluZWQgdG8gWzAsIDM2MF0KICoKICogQHNlZSB7QGxpbmsgcmFkaWFuc30KICogQHNlZSB7QGxpbmsgY29uc3RyYWlufQogKi8KZnVuY3Rpb24gZGVncmVlcyh2LCBjb25zdHJhaW4gPSBmYWxzZSkgewogIGxldCBkID0gKHYgLyBQSSkgKiAxODA7CiAgaWYgKCFjb25zdHJhaW4pIHJldHVybiBkOwogIHdoaWxlIChkIDwgMCkgZCArPSAzNjA7CiAgcmV0dXJuIGQgJSAzNjA7Cn0KCi8qKgogKiBDYWxjdWxhdGUgdGhlIDJEIEV1Y2xpZGVhbiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwb2ludHMuCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4MSBUaGUgZmlyc3QgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MSBUaGUgZmlyc3QgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB4MiBUaGUgc2Vjb25kIHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTIgVGhlIHNlY29uZCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICogQHJldHVybnMge251bWJlcn0gVGhlIGV1Y2xpZGVhbiBkaXN0YW5jZSBiZXR3ZWVuIHRoZSB0d28gY29vcmRpbmF0ZXMKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAxIFRoZSBmaXJzdCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtQb2ludExpa2V9IHAyIFRoZSBzZWNvbmQgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBldWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiB0aGUgdHdvIGNvb3JkaW5hdGVzCiAqLwpmdW5jdGlvbiBkaXN0KHgxLCB5MSwgeDIsIHkyKSB7CiAgaWYgKHgxLnggIT09IHVuZGVmaW5lZCAmJiB4MS55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkyID0geTEueTsKICAgIHgyID0geTEueDsKICAgIHkxID0geDEueTsKICAgIHgxID0geDEueTsKICB9CiAgY29uc3QgZHggPSB4MiAtIHgxOwogIGNvbnN0IGR5ID0geTIgLSB5MTsKICByZXR1cm4gaHlwb3QoZHgsIGR5KTsKfQoKLyoqCiAqIFBlcmZvcm1zIGEgbGluZS9saW5lIGludGVyc2VjdGlvbiB0ZXN0IGdpdmUgZWl0aGVyIGZvdXIgcG9pbnRzCiAqIGRlZmluaW5nIHRoZSBsaW5lcyAocDEtLXAyKSBhbmQgKHAzLS1wNCksIG9yIGVpZ2h0IGNvb3JkaW5hdGVzCiAqIHNwYW5uaW5nIGxpbmVzICh4MSx5MSktLSh4Mix5MikgYW5kICh4Myx5MyktLSh4NCx5NCkuCiAqCiAqIFRoaXMgZnVuY3Rpb24gY292ZXJzIGJvdGggImxpbmUvbGluZSIgYW5kICJzZWdtZW50Ii8ic2VnbWVudCIKICogdGVzdGluZyBieSBzZXR0aW5nIGEgYm9vbGVhbiB2YWx1ZSBgaW5Cb3VuZHNgIG9uIHRoZSByZXN1bHQ6CiAqIHdoZW4gZmFsc2UsIHRoZXJlIGlzIG9ubHkgYSBsaW5lL2xpbmUgaW50ZXJzZWN0aW9uLCBidXQgd2hlbgogKiB0cnVlLCB0aGUgYWN0dWFsIGxpbmUgc2VnbWVudHMgaW50ZXJzZWN0LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgY2VudGVyKCk7CiAqICAgICAgIC8vIC4uLmNvZGUgZ29lcyBoZXJlLi4uCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHgxIFRoZSBmaXJzdCBwb2ludCdzIHggY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0geTEgVGhlIGZpcnN0IHBvaW50J3MgeSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB4MiBUaGUgc2Vjb25kIHBvaW50J3MgeCBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MiBUaGUgc2Vjb25kIHBvaW50J3MgeSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB4MyBUaGUgdGhpcmQgcG9pbnQncyB4IGNvb3JkaW5hdGUKICogQHBhcmFtIHtudW1iZXJ9IHkzIFRoZSB0aGlyZCBwb2ludCdzIHkgY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0geDQgVGhlIGZvdXJ0aCBwb2ludCdzIHggY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0geTQgVGhlIGZvdXJ0aCBwb2ludCdzIHkgY29vcmRpbmF0ZQogKiBAcmV0dXJucyB7UG9pbnRMaWtlfGZhbHNlfSBFaXRoZXIgdGhlIGludGVyc2VjdGlvbiBwb2ludCwgb3IgZmFsc2UgaWYgdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uCiAqCiAqIEBwYXJhbSB7UG9pbnRMaW5lfSBwMSBUaGUgZmlyc3QgY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGluZX0gcDIgVGhlIHNlY29uZCBjb29yZGluYXRlCiAqIEBwYXJhbSB7UG9pbnRMaW5lfSBwMyBUaGUgdGhpcmQgY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGluZX0gcDQgVGhlIGZvdXJ0aCBjb29yZGluYXRlCiAqIEByZXR1cm5zIHtQb2ludExpa2V8ZmFsc2V9IEVpdGhlciB0aGUgaW50ZXJzZWN0aW9uIHBvaW50LCBvciBmYWxzZSBpZiB0aGVyZSBpcyBubyBpbnRlcnNlY3Rpb24KICovCmZ1bmN0aW9uIGxsaSh4MSwgeTEsIHgyLCB5MiwgeDMsIHkzLCB4NCwgeTQpIHsKICBpZiAoeDEueCAhPT0gdW5kZWZpbmVkICYmIHgxLnkgIT09IHVuZGVmaW5lZCkgewogICAgeTQgPSB5Mi55OwogICAgeDQgPSB5Mi54OwogICAgeTMgPSB4Mi55OwogICAgeDMgPSB4Mi54OwogICAgeTIgPSB5MS55OwogICAgeDIgPSB5MS54OwogICAgeTEgPSB4MS55OwogICAgeDEgPSB4MS54OwogIH0KICBjb25zdCBueCA9ICh4MSAqIHkyIC0geTEgKiB4MikgKiAoeDMgLSB4NCkgLSAoeDEgLSB4MikgKiAoeDMgKiB5NCAtIHkzICogeDQpOwogIGNvbnN0IG55ID0gKHgxICogeTIgLSB5MSAqIHgyKSAqICh5MyAtIHk0KSAtICh5MSAtIHkyKSAqICh4MyAqIHk0IC0geTMgKiB4NCk7CiAgY29uc3QgZCA9ICh4MSAtIHgyKSAqICh5MyAtIHk0KSAtICh5MSAtIHkyKSAqICh4MyAtIHg0KTsKCiAgaWYgKGQgPT09IDApIHJldHVybiBmYWxzZTsKCiAgY29uc3QgciA9IHsgeDogbnggLyBkLCB5OiBueSAvIGQsIGluQm91bmRzOiB0cnVlIH07CiAgbGV0IGEgPSB4MTsKICBsZXQgYiA9IHgyOwogIGlmICh4MSA+IHgyKSB7CiAgICBhID0geDI7CiAgICBiID0geDE7CiAgfQogIGlmIChyLnggPCBhIHx8IHIueCA+IGIpIHIuaW5Cb3VuZHMgPSBmYWxzZTsKICBlbHNlIHsKICAgIGEgPSB5MTsKICAgIGIgPSB5MjsKICAgIGlmICh5MSA+IHkyKSB7CiAgICAgIGEgPSB5MjsKICAgICAgYiA9IHkxOwogICAgfQogICAgaWYgKHIueSA8IGEgfHwgci55ID4gYikgci5pbkJvdW5kcyA9IGZhbHNlOwogICAgZWxzZSB7CiAgICAgIGEgPSB4MzsKICAgICAgYiA9IHg0OwogICAgICBpZiAoeDMgPiB4NCkgewogICAgICAgIGEgPSB4NDsKICAgICAgICBiID0geDM7CiAgICAgIH0KICAgICAgaWYgKHIueCA8IGEgfHwgci54ID4gYikgci5pbkJvdW5kcyA9IGZhbHNlOwogICAgICBlbHNlIHsKICAgICAgICBhID0geTM7CiAgICAgICAgYiA9IHk0OwogICAgICAgIGlmICh5MyA+IHk0KSB7CiAgICAgICAgICBhID0geTQ7CiAgICAgICAgICBiID0geTM7CiAgICAgICAgfQogICAgICAgIGlmIChyLnkgPCBhIHx8IHIueSA+IGIpIHIuaW5Cb3VuZHMgPSBmYWxzZTsKICAgICAgfQogICAgfQogIH0KICByZXR1cm4gcjsKfQoKLyoqCiAqIE1hcCBhIHZhbHVlIGZyb20gb25lIGludGVydmFsIHRvIGFub3RoZXIsIG9wdGlvbmFsbHkKICogY29uc3RyYWluZWQgdG8gdGhlIHRhcmdldCBpbnRlcnZhbC4KICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIE91ciBpbnB1dCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gb3JpZ2luYWxTdGFydCBUaGUgbG93ZXIgYm91bmQgb2Ygb3VyIGRvbWFpbgogKiBAcGFyYW0ge251bWJlcn0gb3JpZ2luYWxFbmQgVGhlIHVwcGVyIGJvdW5kIG9mIG91ciBkb21haW4KICogQHBhcmFtIHtudW1iZXJ9IG5ld1N0YXJ0IFRoZSBsb3dlciBib3VuZCBvZiBvdXIgdGFyZ2V0IGludGVydmFsCiAqIEBwYXJhbSB7bnVtYmVyfSBuZXdFbmQgVGhlIHVwcGVyIGJvdW5kIG9uIG91ciB0YXJnZXQgaW50ZXJ2YWwKICogQHBhcmFtIHtib29sZWFufSBjb25zdHJhaW4/ICBBIGJvb2xlYW4gdGhhdCBkZXRlcm1pbmVzIHdoZXRoZXIgb3Igbm90IHRvIGNvbnN0cmFpbiB0aGUgcmVzdWx0YW50IHZhbHVlIHRvIFtuZXdTdGFydCxuZXdFbmRdIChkZWZhdWx0ID0gZmFsc2UpCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSByZXN1bHQgb2YgbWFwcGluZyBvdXIgdmFsdWUgZnJvbSBvdXIgZG9tYWluIGludGVydmFsIHRvIG91ciB0YXJnZXQgaW50ZXJ2YWwsIG9wdGlvbmFsbHkgY29uc3RyYWluZWQgdG8gdGhlIHRhcmdldCBpbnRlcnZhbC4KICoKICogQHNlZSB7QGxpbmsgY29uc3RyYWlufQogKiBAc2VlIHtAbGluayBjb25zdHJhaW5NYXB9CiAqLwpmdW5jdGlvbiBtYXAodiwgcywgZSwgbnMsIG5lLCBjb25zdHJhaW5lZCA9IGZhbHNlKSB7CiAgY29uc3QgaTEgPSBlIC0gcywKICAgIGkyID0gbmUgLSBucywKICAgIHAgPSB2IC0gczsKICBsZXQgciA9IG5zICsgKHAgKiBpMikgLyBpMTsKICBpZiAoY29uc3RyYWluZWQpIHJldHVybiBjb25zdHJhaW4ociwgbnMsIG5lKTsKICByZXR1cm4gcjsKfQoKLyoqCiAqIENvbnZlcnQgYSBudW1iZXIgaW4gZGVncmVlcyB0byBhIG51bWJlciBpbiByYWRpYW5zLgogKiBUaGlzIGlzIHJlYWxseSBub3RoaW5nIG1vcmUgdGhhbiBhIGNvbnZlbmllbnQKICogZnVuY3Rpb24gd3JhcHBlciBhcm91bmQgdGhlIHN0YXRlbWVudDoKICoKICogYGBgCiAqIHYvMTgwICogUEkKICogYGBgCiAqCiAqIFdpdGggb25lIHRyaWNrLCBpbiB0aGF0IGl0IGFsbG93cyB5b3UgdG8gY29uc3RyYWluIHRoZQogKiByZXN1bHRhbnQgdmFsdWUgdG8gdGhlIHN0YW5kYXJkIFswLCBUQVVdIGludGVydmFsLgogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnN0cmFpbgogKiBAcGFyYW0ge2Jvb2xlYW59IGNvbnN0cmFpbj8gQSBib29sZWFuIHRoYXQgZGV0ZXJtaW5lcyB3aGV0aGVyIG9yIG5vdCB0byBjb25zdHJhaW4gdGhlIHJlc3VsdGFudCB2YWx1ZSB0byBbMCwgVEFVXSAoZGVmYXVsdCA9IGZhbHNlKQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgcmFkaWFucyB2YWx1ZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBpbnB1dCB2YWx1ZSBpbiBkZWdyZWVzLCBvcHRpb25hbGx5IGNvbnN0cmFpbmVkIHRvIFswLCBUQVVdCiAqCiAqIEBzZWUge0BsaW5rIGRlZ3JlZXN9CiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbn0KICovCmZ1bmN0aW9uIHJhZGlhbnModiwgY29uc3RyYWluID0gZmFsc2UpIHsKICBsZXQgciA9ICh2IC8gMTgwKSAqIFBJOwogIGlmICghY29uc3RyYWluKSByZXR1cm4gcjsKICB3aGlsZSAociA8IDApIHIgKz0gVEFVOwogIHJldHVybiByICUgVEFVOwp9CgovKioKICogR2VuZXJhdGUgYSBwc2V1ZG8tcmFuZG9tIG51bWJlci4KICoKICogVGhpcyBpcyBiYXNlZCBvbiB0aGUgU3BsaXRNaXgzMiBhbGdvcml0aG0sIGNvdmVyZWQKICogb3ZlciBvbiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDc1OTMzMTYvNzQwNTUzCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDIwKTsKICogICAgICAgcmFuZ2UoMCwgaGVpZ2h0ICsgMjAsIDIwLCAodikgPT4gewogKiAgICAgICAgIHRleHQocmFuZG9tKCksIDUsIHYpOwogKiAgICAgICB9KQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqCiAqCiAqIEByZXR1cm5zIHtudW1iZXJ9IEEgcmFuZG9tIG51bWJlciBpbiB0aGUgaW50ZXJ2YWwgWzAsMSkKICoKICogQHBhcmFtIHtudW1iZXJ9IGEgVGhlIHVwcGVyIGJvdW5kIGZvciB0aGUgcmFuZG9tIG51bWJlcgogKiBAcmV0dXJucyB7bnVtYmVyfSBBIHJhbmRvbSBudW1iZXIgaW4gdGhlIGludGVydmFsIFswLGEpCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBhIFRoZSBsb3dlciBib3VuZCBmb3IgdGhlIHJhbmRvbSBudW1iZXIKICogQHBhcmFtIHtudW1iZXJ9IGIgVGhlIHVwcGVyIGJvdW5kIGZvciB0aGUgcmFuZG9tIG51bWJlcgogKiBAcmV0dXJucyB7bnVtYmVyfSBBIHJhbmRvbSBudW1iZXIgaW4gdGhlIGludGVydmFsIFthLCBiKQogKgogKiBAc2VlIHtAbGluayByYW5kb21TZWVkfQogKi8KZnVuY3Rpb24gcmFuZG9tKGEgPSAxLCBiKSB7CiAgY29uc3QgciA9IF9fcHJuZy5uZXh0KCk7CiAgaWYgKGIgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGEgKiByOwogIHJldHVybiBhICsgciAqIChiIC0gYSk7Cn0KCi8qKgogKiBTZXQgdGhlIHBzZXVkby1yYW5kb20gbnVtYmVyIGdlbmVyYXRvciBzZWVkLiBJZiBubyBzZWVkCiAqIHZhbHVlIGlzIHByb3ZpZGVkLCB0aGlzIGlzIGVxdWl2YWxlbnQgdG8gY2FsbGluZzoKICoKICogYGBgCiAqIHJhbmRvbVNlZWQoRGF0ZS5ub3coKSAqIE1hdGgucmFuZG9tKCkpCiAqIGBgYAogKgogKiBAcGFyYW0ge251bWJlcn0gc2VlZD8gVGhlIHJhbmRvbSBzZWVkIHZhbHVlLgogKgogKiBAc2VlIHtAbGluayByYW5kb219CiAqLwpmdW5jdGlvbiByYW5kb21TZWVkKHNlZWQgPSBEYXRlLm5vdygpICogTWF0aC5yYW5kb20oKSkgewogIF9fcHJuZy5yZXNlZWQoc2VlZCk7Cn0KCi8qKgogKiBUaGUgc2VjYW50IGZ1bmN0aW9uLCB3aGljaCBpczoKICoKICogYGBgCiAqIDEgLyBjb3ModikKICogYGBgCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgaW5wdXQgdmFsdWUsIGluIHJhZGlhbnMuCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBzZWNhbnQgb2Ygb3VyIHZhbHVlLgogKgogKiBAc2VlIHtAbGluayBjc2N9CiAqLwpmdW5jdGlvbiBzZWModikgewogIHJldHVybiAxIC8gY29zKHYpOwp9Ci8qKgogKiBJbnZlcnQgYSBtYXRyaXgsIG9yIHVuZGVmaW5lZCBpZiB0aGUgbWF0cml4IGlzIG5vdCBpbnZlcnRpYmxlLgogKgogKiBAcGFyYW0ge01hdHJpeH0gTSBUaGUgbWF0cml4IHRvIGludmVydAogKiBAcmV0dXJucyB7bnVtYmVyW11bXX0gVGhlIG1hdHJpeCBpbnZlcnNlIGFzIDJEIG51bWJlciBhcnJheQogKi8KZnVuY3Rpb24gaW52ZXJ0TWF0cml4KE0pIHsKICAvLyBDb3BpZWQgZnJvbSBodHRwOi8vYmxvZy5hY2lwby5jb20vbWF0cml4LWludmVyc2lvbi1pbi1qYXZhc2NyaXB0LwogIC8vIFdpdGggcGVybWlzc2lvbiwgaHR0cDovL2Jsb2cuYWNpcG8uY29tL21hdHJpeC1pbnZlcnNpb24taW4tamF2YXNjcmlwdC8jY29tbWVudC01MDU3Mjg5ODg5CgogIC8vICgxKSAnYXVnbWVudCcgdGhlIG1hdHJpeCAobGVmdCkgYnkgdGhlIGlkZW50aXR5IChvbiB0aGUgcmlnaHQpCiAgLy8gKDIpIFR1cm4gdGhlIG1hdHJpeCBvbiB0aGUgbGVmdCBpbnRvIHRoZSBpZGVudGl0eSBieSBlbGVtZXRyeSByb3cgb3BzCiAgLy8gKDMpIFRoZSBtYXRyaXggb24gdGhlIHJpZ2h0IGlzIHRoZSBpbnZlcnNlICh3YXMgdGhlIGlkZW50aXR5IG1hdHJpeCkKICAvLyBUaGVyZSBhcmUgMyBlbGVtdGFyeSByb3cgb3BzOgogIC8vIChhKSBTd2FwIDIgcm93cwogIC8vIChiKSBNdWx0aXBseSBhIHJvdyBieSBhIHNjYWxhcgogIC8vIChjKSBBZGQgMiByb3dzCgogIC8vIGlmIHRoZSBtYXRyaXggaXNuJ3Qgc3F1YXJlOiBleGl0IChlcnJvcikKICBpZiAoTS5sZW5ndGggIT09IE1bMF0ubGVuZ3RoKSB7CiAgICBjb25zb2xlLndhcm4oIkNhbm5vdCBpbnZlcnQgbm9uLXNxdWFyZSBtYXRyaWNlcyIpOwogICAgcmV0dXJuOwogIH0KCiAgLy8gY3JlYXRlIHRoZSBpZGVudGl0eSBtYXRyaXggKEkpLCBhbmQgYSBjb3B5IChDKSBvZiB0aGUgb3JpZ2luYWwKICB2YXIgaSA9IDAsCiAgICBpaSA9IDAsCiAgICBqID0gMCwKICAgIGRpbSA9IE0ubGVuZ3RoLAogICAgZSA9IDAsCiAgICB0ID0gMDsKICB2YXIgSSA9IFtdLAogICAgQyA9IFtdOwogIGZvciAoaSA9IDA7IGkgPCBkaW07IGkgKz0gMSkgewogICAgLy8gQ3JlYXRlIHRoZSByb3cKICAgIElbSS5sZW5ndGhdID0gW107CiAgICBDW0MubGVuZ3RoXSA9IFtdOwogICAgZm9yIChqID0gMDsgaiA8IGRpbTsgaiArPSAxKSB7CiAgICAgIC8vaWYgd2UncmUgb24gdGhlIGRpYWdvbmFsLCBwdXQgYSAxIChmb3IgaWRlbnRpdHkpCiAgICAgIGlmIChpID09IGopIHsKICAgICAgICBJW2ldW2pdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICBJW2ldW2pdID0gMDsKICAgICAgfQoKICAgICAgLy8gQWxzbywgbWFrZSB0aGUgY29weSBvZiB0aGUgb3JpZ2luYWwKICAgICAgQ1tpXVtqXSA9IE1baV1bal07CiAgICB9CiAgfQoKICAvLyBQZXJmb3JtIGVsZW1lbnRhcnkgcm93IG9wZXJhdGlvbnMKICBmb3IgKGkgPSAwOyBpIDwgZGltOyBpICs9IDEpIHsKICAgIC8vIGdldCB0aGUgZWxlbWVudCBlIG9uIHRoZSBkaWFnb25hbAogICAgZSA9IENbaV1baV07CgogICAgLy8gaWYgd2UgaGF2ZSBhIDAgb24gdGhlIGRpYWdvbmFsICh3ZSdsbCBuZWVkIHRvIHN3YXAgd2l0aCBhIGxvd2VyIHJvdykKICAgIGlmIChlID09IDApIHsKICAgICAgLy9sb29rIHRocm91Z2ggZXZlcnkgcm93IGJlbG93IHRoZSBpJ3RoIHJvdwogICAgICBmb3IgKGlpID0gaSArIDE7IGlpIDwgZGltOyBpaSArPSAxKSB7CiAgICAgICAgLy9pZiB0aGUgaWkndGggcm93IGhhcyBhIG5vbi0wIGluIHRoZSBpJ3RoIGNvbAogICAgICAgIGlmIChDW2lpXVtpXSAhPSAwKSB7CiAgICAgICAgICAvL2l0IHdvdWxkIG1ha2UgdGhlIGRpYWdvbmFsIGhhdmUgYSBub24tMCBzbyBzd2FwIGl0CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgZGltOyBqKyspIHsKICAgICAgICAgICAgZSA9IENbaV1bal07IC8vdGVtcCBzdG9yZSBpJ3RoIHJvdwogICAgICAgICAgICBDW2ldW2pdID0gQ1tpaV1bal07IC8vcmVwbGFjZSBpJ3RoIHJvdyBieSBpaSd0aAogICAgICAgICAgICBDW2lpXVtqXSA9IGU7IC8vcmVwYWNlIGlpJ3RoIGJ5IHRlbXAKICAgICAgICAgICAgZSA9IElbaV1bal07IC8vdGVtcCBzdG9yZSBpJ3RoIHJvdwogICAgICAgICAgICBJW2ldW2pdID0gSVtpaV1bal07IC8vcmVwbGFjZSBpJ3RoIHJvdyBieSBpaSd0aAogICAgICAgICAgICBJW2lpXVtqXSA9IGU7IC8vcmVwYWNlIGlpJ3RoIGJ5IHRlbXAKICAgICAgICAgIH0KICAgICAgICAgIC8vZG9uJ3QgYm90aGVyIGNoZWNraW5nIG90aGVyIHJvd3Mgc2luY2Ugd2UndmUgc3dhcHBlZAogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vZ2V0IHRoZSBuZXcgZGlhZ29uYWwKICAgICAgZSA9IENbaV1baV07CiAgICAgIC8vaWYgaXQncyBzdGlsbCAwLCBub3QgaW52ZXJ0aWJsZSAoZXJyb3IpCiAgICAgIGlmIChlID09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KCiAgICAvLyBTY2FsZSB0aGlzIHJvdyBkb3duIGJ5IGUgKHNvIHdlIGhhdmUgYSAxIG9uIHRoZSBkaWFnb25hbCkKICAgIGZvciAoaiA9IDA7IGogPCBkaW07IGorKykgewogICAgICBDW2ldW2pdID0gQ1tpXVtqXSAvIGU7IC8vYXBwbHkgdG8gb3JpZ2luYWwgbWF0cml4CiAgICAgIElbaV1bal0gPSBJW2ldW2pdIC8gZTsgLy9hcHBseSB0byBpZGVudGl0eQogICAgfQoKICAgIC8vIFN1YnRyYWN0IHRoaXMgcm93IChzY2FsZWQgYXBwcm9wcmlhdGVseSBmb3IgZWFjaCByb3cpIGZyb20gQUxMIG9mCiAgICAvLyB0aGUgb3RoZXIgcm93cyBzbyB0aGF0IHRoZXJlIHdpbGwgYmUgMCdzIGluIHRoaXMgY29sdW1uIGluIHRoZQogICAgLy8gcm93cyBhYm92ZSBhbmQgYmVsb3cgdGhpcyBvbmUKICAgIGZvciAoaWkgPSAwOyBpaSA8IGRpbTsgaWkrKykgewogICAgICAvLyBPbmx5IGFwcGx5IHRvIG90aGVyIHJvd3MgKHdlIHdhbnQgYSAxIG9uIHRoZSBkaWFnb25hbCkKICAgICAgaWYgKGlpID09IGkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgLy8gV2Ugd2FudCB0byBjaGFuZ2UgdGhpcyBlbGVtZW50IHRvIDAKICAgICAgZSA9IENbaWldW2ldOwoKICAgICAgLy8gU3VidHJhY3QgKHRoZSByb3cgYWJvdmUob3IgYmVsb3cpIHNjYWxlZCBieSBlKSBmcm9tICh0aGUKICAgICAgLy8gY3VycmVudCByb3cpIGJ1dCBzdGFydCBhdCB0aGUgaSd0aCBjb2x1bW4gYW5kIGFzc3VtZSBhbGwgdGhlCiAgICAgIC8vIHN0dWZmIGxlZnQgb2YgZGlhZ29uYWwgaXMgMCAod2hpY2ggaXQgc2hvdWxkIGJlIGlmIHdlIG1hZGUgdGhpcwogICAgICAvLyBhbGdvcml0aG0gY29ycmVjdGx5KQogICAgICBmb3IgKGogPSAwOyBqIDwgZGltOyBqKyspIHsKICAgICAgICBDW2lpXVtqXSAtPSBlICogQ1tpXVtqXTsgLy9hcHBseSB0byBvcmlnaW5hbCBtYXRyaXgKICAgICAgICBJW2lpXVtqXSAtPSBlICogSVtpXVtqXTsgLy9hcHBseSB0byBpZGVudGl0eQogICAgICB9CiAgICB9CiAgfQoKICAvL3dlJ3ZlIGRvbmUgYWxsIG9wZXJhdGlvbnMsIEMgc2hvdWxkIGJlIHRoZSBpZGVudGl0eQogIC8vbWF0cml4IEkgc2hvdWxkIGJlIHRoZSBpbnZlcnNlOgogIHJldHVybiBJOwp9CgovKioKICogTXVsdGlwbHkgdHdvIG1hdHJpY2VzCiAqCiAqIEBwYXJhbSB7TWF0cml4fSBtMQogKiBAcGFyYW0ge01hdHJpeH0gbTIKICogQHJldHVybnMge251bWJlcltdW119IFRoZSByZXN1bHQgb2YgbTEgKiBtMiAgYXMgMkQgbnVtYmVyIGFycmF5CiAqLwpmdW5jdGlvbiBtdWx0aXBseU1hdHJpeChtMSwgbTIpIHsKICB2YXIgTSA9IFtdOwogIHZhciBtMnQgPSB0cmFuc3Bvc2VNYXRyaXgobTIpOwogIG0xLmZvckVhY2goKHJvdywgcikgPT4gewogICAgTVtyXSA9IFtdOwogICAgbTJ0LmZvckVhY2goKGNvbCwgYykgPT4gewogICAgICBNW3JdW2NdID0gcm93Lm1hcCgodiwgaSkgPT4gY29sW2ldICogdikucmVkdWNlKChhLCB2KSA9PiBhICsgdiwgMCk7CiAgICB9KTsKICB9KTsKICByZXR1cm4gTTsKfQoKLyoqCiAqIFRyYW5zcG9zZSBhIG1hdHJpeAogKgogKiBAcGFyYW0ge01hdHJpeH0gTSBUaGUgbWF0cml4IHRvIHRyYW5zcG9zZQogKiBAcmV0dXJucyB7bnVtYmVyW11bXX0gVGhlIG1hdHJpeCB0cmFuc3Bvc2UgYXMgMkQgbnVtYmVyIGFycmF5CiAqLwpmdW5jdGlvbiB0cmFuc3Bvc2VNYXRyaXgoTSkgewogIHJldHVybiBNWzBdLm1hcCgoY29sLCBpKSA9PiBNLm1hcCgocm93KSA9PiByb3dbaV0pKTsKfQovKioKICogUHJvamVjdCBhIDNEIGNvb3JkaW5hdGUgdG8gMkQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldFByb2plY3Rvcih3aWR0aCAvIDIsIGhlaWdodCAvIDIsIDUwLCAtMC40KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgLTEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoMSwgMSwgLTEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAxKSwgcHJvamVjdCgxLCAxLCAxKSk7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgLTEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoLTEsIDEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KDEsIC0xLCAtMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KDEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAxKSk7CiAqICAgICAgIHNldENvbG9yKGBncmVlbmApOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoLTEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSAzRCBjb29yZGluYXRlJ3MgeCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgM0QgY29vcmRpbmF0ZSdzIHggdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHogVGhlIDNEIGNvb3JkaW5hdGUncyB4IHZhbHVlCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgIFRoZSBwcm9qZWN0ZWQgMkQge3gseX0gY29vcmRpbmF0ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgMkQgY29vcmRpbmF0ZSBhcyB7eCx5LHp9IGNvb3JkaW5hdGUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCAgVGhlIHByb2plY3RlZCAyRCB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBzZWUge0BsaW5rIHNldFByb2plY3Rvcn0KICovCmZ1bmN0aW9uIHByb2plY3QoeCwgeSwgeikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCAmJiB4LnogIT09IHVuZGVmaW5lZCkgewogICAgeiA9IHguejsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICByZXR1cm4gX19wcm9qZWN0b3IucHJvamVjdCh4LCB5LCB6KTsKfQoKLyoqCiAqIFNldCB0aGUgcHJvamVjdG9yJ3MgeCwgeSwgYW5kIHogYXhpcyByb3RhdGlvbgogKiBpbiByYWRpYW5zLiBOb3RlIHRoYXQgdGhlc2UgYXJlIGFwcGxpZWQgaW4gb3JkZXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldFByb2plY3Rvcih3aWR0aCAvIDIsIGhlaWdodCAvIDIsIDUwLCAtMC40KTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGNvbnN0IG0gPSBtaWxsaXMoKSAvIDUwMDA7CiAqICAgICAgIHJvdGF0ZVByb2plY3RvcihtLCAyICogbSwgMyAqIG0pOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgLTEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoMSwgMSwgLTEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAxKSwgcHJvamVjdCgxLCAxLCAxKSk7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgLTEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoLTEsIDEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KDEsIC0xLCAtMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KDEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAxKSk7CiAqICAgICAgIHNldENvbG9yKGBncmVlbmApOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoLTEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBhbmdsZSBvZiByb3RhdGlvbiBvdmVyIHRoZSB4IGF4aXMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgYW5nbGUgb2Ygcm90YXRpb24gb3ZlciB0aGUgeSBheGlzIGluIHJhZGlhbnMKICogQHBhcmFtIHtudW1iZXJ9IHogVGhlIGFuZ2xlIG9mIHJvdGF0aW9uIG92ZXIgdGhlIHogYXhpcyBpbiByYWRpYW5zCiAqCiAqIEBzZWUge0BsaW5rIHByb2plY3R9CiAqLwpmdW5jdGlvbiByb3RhdGVQcm9qZWN0b3IoeCwgeSwgeikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCAmJiB4LnogIT09IHVuZGVmaW5lZCkgewogICAgeiA9IHguejsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBfX3Byb2plY3Rvci5zZXRSb3RhdGlvbih4LCB5LCB6KTsKfQoKLyoqCiAqIFNldCB0aGUgcHJvamVjdCBwYXJhbWV0ZXJzLiBDdXJyZW50bHksIG9ubHkKICogY2FiaW5ldCBwcm9qZWN0IGlzIHN1cHBvcnRlZCwgd2hpY2ggYWNjZXB0cwogKiB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldFByb2plY3Rvcih3aWR0aCAvIDIsIGhlaWdodCAvIDIsIDUwLCAtMC40KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgLTEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoMSwgMSwgLTEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAxKSwgcHJvamVjdCgxLCAxLCAxKSk7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgLTEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoLTEsIDEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KDEsIC0xLCAtMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KDEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAxKSk7CiAqICAgICAgIHNldENvbG9yKGBncmVlbmApOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoLTEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSAge251bWJlcn0geE9mZnNldCBvZiB0aGUgcHJvamVjdGlvbiB3cnQgdGhlIGNhbnZhcyAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSAge251bWJlcn0geU9mZnNldCBvZiB0aGUgcHJvamVjdGlvbiB3cnQgdGhlIGNhbnZhcyAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSAge251bWJlcn0gc2NhbGUgZmFjdG9yIGZvciB0aGUgM0QgaW5wdXQgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0gIHtudW1iZXJ9IGNhYmluZXQgYW5nbGUgaW4gcmFkaWFucyAoZGVmYXVsdCA9IC1waS82KQogKgogKiBAc2VlIHtAbGluayBwcm9qZWN0fQogKi8KZnVuY3Rpb24gc2V0UHJvamVjdG9yKC4uLmFyZ3MpIHsKICBfX3Byb2plY3Rvci51cGRhdGUoLi4uYXJncyk7Cn0KLyoqCiAqIFNldCBhIGJvcmRlciBhcm91bmQgdGhlIGNhbnZhcy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Qm9yZGVyKDEwLCBgcmVkYCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ8Ym9vbGVhbn0gd2lkdGg/IFRoZSB3aWR0aCBvZiB0aGUgYm9yZGVyIGluIHBpeGVscywgZGlzYWJsaW5nIHRoZSBib3JkZXIgb21pdHRlZAogKiBAcGFyYW0ge3N0cmluZ30gY29sb3I/IFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyIChkZWZhdWx0ID0gYmxhY2spCiAqCiAqIEBzZWUge0BsaW5rIG5vQm9yZGVyfQogKi8KZnVuY3Rpb24gc2V0Qm9yZGVyKHdpZHRoID0gMSwgY29sb3IgPSBgYmxhY2tgKSB7CiAgaWYgKCF3aWR0aCkgewogICAgX19jYW52YXMuc3R5bGUuYm9yZGVyID0gYG5vbmVgOwogIH0gZWxzZSB7CiAgICBfX2NhbnZhcy5zdHlsZS5ib3JkZXIgPSBgJHt3aWR0aH1weCBzb2xpZCAke2NvbG9yfWA7CiAgfQp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IHN0cm9rZSBhbmQgZmlsbCBjb2xvdXIgYXQKICogdGhlIHNhbWUgdGltZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIHJlY3QoNTAsIDUwLCAxMDAsIDEwMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yIFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyCiAqCiAqIEBzZWUge0BsaW5rIHNldFN0cm9rZX0KICogQHNlZSB7QGxpbmsgc2V0RmlsbH0KICogQHNlZSB7QGxpbmsgbm9Db2xvcn0KICovCmZ1bmN0aW9uIHNldENvbG9yKGNvbG9yKSB7CiAgc2V0RmlsbChjb2xvcik7CiAgc2V0U3Ryb2tlKGNvbG9yKTsKfQoKLyoqCiAqIENoYW5nZSB0aGUgY3Vyc29yIHRvIGEgc3BlY2lmaWMgaWNvbjoKICoKICogLSBBVVRPIC0gdXNlIHdoYXRldmVyIHRoZSBicm93c2VyIHdvdWxkIG90aGVyd2lzZSB1c2UKICogLSBDUk9TUyAtIHVzZSBhIGNyb3NzLWhhaXIgaWNvbgogKiAtIFBPSU5URVIgLSB1c2UgdGhlICJwb2ludGVyIiBpY29uIHRoYXQgaXMgYWxzbyB1c2VkIGZvciBjbGlja2FibGUgbGlua3MKICoKICogVXNlIGFueSBvdGhlciBzdHJpbmcgZm91bmQgb3ZlciBvbiB0aGUgTUROIGN1cnNvciBhcnRpY2xlIHRvIHNldCBhIGN1cnNvciBub3QgY292ZXJlZCBieSB0aGUgYWJvdmUgY29uc3RhbnRzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGAjRkYwMmApOwogKiAgICAgICByZWN0KDAsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIHNldENvbG9yKGAjMEZGMmApOwogKiAgICAgICByZWN0KHdpZHRoLzIsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSh4LCB5KSB7CiAqICAgICAgIGlmICh4IDwgd2lkdGgvMikgewogKiAgICAgICAgIHNldEN1cnNvcihBVVRPKTsKICogICAgICAgfSBlbHNlIHsKICogICAgICAgICBub0N1cnNvcigpOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgVGhlIENTUyBjdXJzb3IgdHlwZQogKgogKiBAc2VlIHtAbGluayBub0N1cnNvcn0KICovCmZ1bmN0aW9uIHNldEN1cnNvcih0eXBlKSB7CiAgX19jdXJyZW50X2N1cnNvciA9IHR5cGU7CiAgX19jYW52YXMuc3R5bGUuY3Vyc29yID0gX19jdXJyZW50X2N1cnNvcjsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBmaWxsIGNvbG91ci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHJlY3QoNTAsIDUwLCAxMDAsIDEwMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yIFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyIChkZWZhdWx0ID0gYmxhY2spCiAqCiAqIEBzZWUge0BsaW5rIG5vRmlsbH0KICovCmZ1bmN0aW9uIHNldEZpbGwoY29sb3IgPSBgYmxhY2tgKSB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdID09PSBfX2hpZ2hsaWdodF9jb2xvcikgewogICAgY29sb3IgPSBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwogIH0KICBfX2N0eC5maWxsU3R5bGUgPSBjb2xvcjsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBmb250IHVzaW5nIGEgc2luZ2xlIHN0cmluZy4gRm9yIHRoZSBzeW50YXgsCiAqIHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9DU1MvZm9udAogKgogKiBAcGFyYW0ge3N0cmluZ30gZm9udCBBIENTUyBzaG9ydGhhbmQgZm9udCBwcm9wZXJ0eQogKgogKiBAc2VlIHtAbGluayBzZXRGb250RmFtaWx5fQogKiBAc2VlIHtAbGluayBzZXRGb250U2l6ZX0KICogQHNlZSB7QGxpbmsgc2V0Rm9udFdlaWdodH0KICovCmZ1bmN0aW9uIHNldEZvbnQoZm9udCkgewogIF9fY3R4LmZvbnQgPSBmb250IHx8IGAke19fZm9udC53ZWlnaHR9ICR7X19mb250LnNpemV9cHggJHtfX2ZvbnQuZmFtaWx5fWA7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgZm9udCBmYW1pbHkuCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIFRoZSBDU1MgZm9udCBmYW1pbHkgbmFtZQogKgogKiBAc2VlIHtAbGluayBzZXRGb250U2l6ZX0KICogQHNlZSB7QGxpbmsgc2V0Rm9udFdlaWdodH0KICovCmZ1bmN0aW9uIHNldEZvbnRGYW1pbHkobmFtZSkgewogIF9fZm9udC5mYW1pbHkgPSBuYW1lOwogIHNldEZvbnQoKTsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBmb250IHNpemUKICoKICogQHBhcmFtIHtudW1iZXJ9IHB4IFRoZSBmb250IHNpemUgaW4gcGl4ZWxzCiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRGYW1pbHl9CiAqIEBzZWUge0BsaW5rIHNldEZvbnRXZWlnaHR9CiAqLwpmdW5jdGlvbiBzZXRGb250U2l6ZShweCkgewogIF9fZm9udC5zaXplID0gcHg7CiAgc2V0Rm9udCgpOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZvbnQgd2VpZ2h0CiAqCiAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gdmFsIFRoZSBDU1Mgd2VpZ2h0IG51bWJlciBvciBvbmUgb2YgdGhlIHNwZWNpYWwgc3RyaW5ncyAibm9ybWFsIiwgImJvbGQiLCAiYm9sZGVyIiwgb3IgImxpZ2h0ZXIiLgogKgogKiBAc2VlIHtAbGluayBzZXRGb250RmFtaWx5fQogKiBAc2VlIHtAbGluayBzZXRGb250U2l6ZX0KICovCmZ1bmN0aW9uIHNldEZvbnRXZWlnaHQodmFsKSB7CiAgX19mb250LndlaWdodCA9IHZhbDsKICBzZXRGb250KCk7Cn0KCi8qKgogKiBTZXQgdGhlIGJhY2tncm91bmQgZ3JpZCBzcGFjaW5nIGFuZCBjb2xvdXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRHcmlkKDIwLCBgbGF2ZW5kZXJgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBzcGFjaW5nPyBUaGUgc3BhY2luZyBiZXR3ZWVuIGdyaWQgbGluZXMgaW4gcGl4ZWxzIChkZWZhdWx0ID0gMjApCiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvcj8gVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBsaWdodGdyZXkpCiAqCiAqIEBzZWUge0BsaW5rIG5vR3JpZH0KICovCmZ1bmN0aW9uIHNldEdyaWQoc3BhY2luZyA9IDIwLCBjb2xvciA9IGBsaWdodGdyZXlgKSB7CiAgX19kcmF3X2dyaWQgPSB0cnVlOwogIF9fZ3JpZF9zcGFjaW5nID0gc3BhY2luZzsKICBfX2dyaWRfY29sb3IgPSBjb2xvcjsKfQoKLyoqCiAqIFNldCB0aGUgY29sb3IgdGhhdCBzaG91bGQgYmUgdXNlZCB0byByZXBsYWNlIHdoYXRldmVyCiAqIGhpZ2hsaWdodCgpIG1hcmtlZCBhcyB0aGUgInRvIGhpZ2hsaWdodCIgY29sb3IuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEhpZ2hsaWdodENvbG9yKGBsaW1lYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dCgibGV0J3MgZ28iLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJBY3RpdmUoc3RhdGUpIHsKICogICAgICAgaWYgKHN0YXRlKSBoaWdobGlnaHQoYHJlZGApOwogKiAgICAgICBlbHNlIGhpZ2hsaWdodChmYWxzZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yIFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyCiAqCiAqIEBzZWUge0BsaW5rIGhpZ2hsaWdodH0KICovCmZ1bmN0aW9uIHNldEhpZ2hsaWdodENvbG9yKGNvbG9yKSB7CiAgX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvciA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBsaW5lIGRhc2ggcHJvcGVydHkuIFNlZSB0aGUgZm9sbG93aW5nIE1ETiBhcnRpY2xlIGZvciB0aGUgZGV0YWlsczoKICoKICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZG9jcy9XZWIvQVBJL0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC9zZXRMaW5lRGFzaAogKgogKiBAcGFyYW0gIHtudW1iZXJbXX0gLi4udmFsdWVzIFRoZSBkYXNoIGludGVydmFscyBpbiBwaXhlbAogKgogKiBAc2VlIHtAbGluayBub0xpbmVEYXNofQogKi8KZnVuY3Rpb24gc2V0TGluZURhc2goLi4udmFsdWVzKSB7CiAgX19jdHguc2V0TGluZURhc2godmFsdWVzKTsKfQoKLyoqCiAqIFNldCB0aGUgbGluZSB3aWR0aCBpbiBwaXhlbHMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHJhbmdlKDEsIDEwLCAoaSkgPT4gewogKiAgICAgICAgIHNldExpbmVXaWR0aChpKTsKICogICAgICAgICBsaW5lKDIwLCBpICogMjAsIDE4MCwgaSAqIDIwKTsKICogICAgICAgfSkKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gd2lkdGg/IFRoZSBsaW5lIHdpZHRoIGluIHBpeGVscyAoZGVmYXVsdCA9IDEpCiAqCiAqIEBzZWUge0BsaW5rIHNldFRleHRTdHJva2V9CiAqLwpmdW5jdGlvbiBzZXRMaW5lV2lkdGgod2lkdGggPSAxKSB7CiAgX19jdHgubGluZVdpZHRoID0gd2lkdGg7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgc3Ryb2tlIGNvbG91ci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHJlY3QoNTAsIDUwLCAxMDAsIDEwMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yIFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyIChkZWZhdWx0ID0gYmxhY2spCiAqCiAqIEBzZWUge0BsaW5rIHNldEZpbGx9CiAqIEBzZWUge0BsaW5rIHNldENvbG9yfQogKi8KZnVuY3Rpb24gc2V0U3Ryb2tlKGNvbG9yID0gYGJsYWNrYCkgewogIGlmIChDU1NfQ09MT1JfTUFQW2NvbG9yXSA9PT0gX19oaWdobGlnaHRfY29sb3IpIHsKICAgIGNvbG9yID0gX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvcjsKICB9CiAgX19jdHguc3Ryb2tlU3R5bGUgPSBjb2xvcjsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCB0ZXh0IGFsaWdubWVudCB2YWx1ZXMuCiAqCiAqIFZhbGlkIGB4QWxpZ25gIHZhbHVlcyBhcmU6CiAqCiAqIC0gQ0VOVEVSIC0gdGhlIHRleHQgYW5jaG9yIGlzIGluIHRoZSBtaWRkbGUgb2YgdGhlIHRleHQuIFRleHQgaXMgcGxhY2VkIGV2ZW5seSBvbiBlaXRoZXIgc2lkZS4KICogLSBFTkQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIHJpZ2h0IGZvciBMVFIgdGV4dCwgYW5kIG9uIHRoZSBsZWZ0IGZvciBSVEwgdGV4dC4KICogLSBMRUZUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIHRleHQuIGFsbCB0ZXh0IGlzIHRvIHRoZSByaWdodC4KICogLSBSSUdIVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgdGV4dC4gQWxsIHRleHQgaXMgdG8gdGhlIGxlZnQuCiAqIC0gU1RBUlQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIGxlZnQgZm9yIExUUiB0ZXh0LCBhbmQgb24gdGhlIHJpZ2h0IGZvciBSVEwgdGV4dC4KICoKICogVmFsaWQgYHlBbGlnbmAgdmFsdWVzIGFyZToKICoKICogLSBBTFBIQUJFVElDIC0gc3RhbmRhcmQgdGV4dCBhbGlnbm1lbnQgKGRlZmF1bHQpCiAqIC0gQk9UVE9NIC0gdGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgYm90dG9tIG9mIHRoZSBib3VuZGluZyBib3gKICogLSBIQU5HSU5HIC0gcmVsZXZhbnQgZm9yIFRpYmV0YW4gYW5kIG90aGVyIEluZGljIHNjcmlwdHMuCiAqIC0gSURFT0dSQVBISUMgLSByZWxldmFudCBmb3IgaWRlb2dyYXBoaWMgQ0pLViB0ZXh0LgogKiAtIE1JRERMRSAtIFRoZSB2ZXJ0aWNhbCBlcXVpdmFsZW50IG9mICJjZW50ZXIiLgogKiAtIFRPUCAtIFRoZSB0ZXh0IGlzIGFsaWduZWQgdG8gdGhlIHRvcCBvZiB0aGUgdHlwb2dyYXBoaWMgImVtIHNxdWFyZSIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgbGluZSh3aWR0aCAvIDIsIDAsIHdpZHRoIC8gMiwgaGVpZ2h0KTsKICogICAgICAgbGluZSgwLCBoZWlnaHQgLyAyLCB3aWR0aCwgaGVpZ2h0IC8gMik7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHRleHQoImNlbnRlciBtaWRkbGUiLCB3aWR0aCAvIDIsIGhlaWdodC8yKTsKICogICAgICAgbGluZSgwLCBoZWlnaHQgLyAyIC0gNTAsIHdpZHRoLCBoZWlnaHQgLyAyIC0gNTApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oUklHSFQsIFRPUCk7CiAqICAgICAgIHRleHQoInJpZ2h0IHRvcCIsIHdpZHRoIC8gMiwgaGVpZ2h0LzIgLSA1MCk7CiAqICAgICAgIGxpbmUoMCwgaGVpZ2h0IC8gMiArIDUwLCB3aWR0aCwgaGVpZ2h0IC8gMiArIDUwKTsKICogICAgICAgc2V0VGV4dEFsaWduKExFRlQsIEJPVFRPTSk7CiAqICAgICAgIHRleHQoImxlZnQgYm90dG9tIiwgd2lkdGggLyAyLCBoZWlnaHQvMiArIDUwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30geEFsaWduIFRoZSBDU1MgaG9yaXpvbnRhbCBhbGlnbm1lbnQKICogQHBhcmFtIHtzdHJpbmd9IHlBbGlnbiBUaGUgQ1NTIHZlcnRpY2FsIGFsaWdubWVudAogKi8KZnVuY3Rpb24gc2V0VGV4dEFsaWduKHhBbGlnbiwgeUFsaWduKSB7CiAgX19jdHgudGV4dEFsaWduID0geEFsaWduOwogIF9fY3R4LnRleHRCYXNlbGluZSA9IHlBbGlnbjsKfQoKLyoqCiAqIFNldCB0aGUgdGV4dCBvdXRsaW5lIHN0cm9raW5nIHByb3BlcnRpZXMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKGByZWRgLCAxKTsKICogICAgICAgc2V0RmlsbChgeWVsbG93YCk7CiAqICAgICAgIHRleHQoImZhbmN5IHRleHQiLCB3aWR0aC8yLCA4MCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgICBzZXRGb250U2l6ZSg2NSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoYHJlZGAsIDMpOwogKiAgICAgICBzZXRGaWxsKGB5ZWxsb3dgKTsKICogICAgICAgdGV4dCgiZmFuY3kgdGV4dCIsIHdpZHRoLzIsIDE0MCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvciBUaGUgQ1NTIGNvbG9yIHRvIHVzZSBmb3IgdGhlIGJvcmRlcgogKiBAcGFyYW0ge251bWJlcn0gd2lkdGg/IFRoZSB0ZXh0IHN0cm9rZSB3aWR0aCBpbiBwaXhlbHMgKGRlZmF1bHQgPSAxKQogKgogKiBAc2VlIHtAbGluayBzZXRTdHJva2V9CiAqIEBzZWUge0BsaW5rIHNldExpbmVXaWR0aH0KICovCmZ1bmN0aW9uIHNldFRleHRTdHJva2UoY29sb3IsIHdpZHRoID0gMSkgewogIF9fdGV4dFN0cm9rZSA9IGNvbG9yOwogIHNldExpbmVXaWR0aCh3aWR0aCk7Cn0KLyoqCiAqIFN0YXJ0IGEgbmV3IHNoYXBlLiBUaGlzIHlpZWxkcyBhIGBTaGFwZWAgb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBBUEk6CiAqCiAqIC0gYG1ha2VNb3ZhYmxlKG1vdmFibGU/OiBib29sZWFuKWAgLSBhbGxvdyB0aGlzIHNoYXBlIHRvIGJlIG1vdmVkIGFyb3VuZCB3aXRoIHRoZSBwb2ludGVyIChgbW92YWJsZWAgaXMgdHJ1ZSBpZiBvbWl0dGVkKQogKiAtIGBhbGxvd1Jlc2l6aW5nKGFsbG93ZWQ/OiBib29sZWFuKWAgLSBhbGxvdyB0aGUgcG9pbnRzIHRoYXQgbWFrZSB1cCB0aGlzIHNoYXBlIHRvIGJlIG1vdmVkIGFyb3VuZCAoYGFsbG93ZWRgIGlzIHRydWUgaWYgb21pdHRlZCkKICogLSBgc2hvd1BvaW50cyhzaG93UG9pbnRzPzogYm9vbGVhbilgIC0gZGV0ZXJtaW5lcyB3aGV0aGVyIG9yIG5vdCB0byBkcmF3IHRoZSBwYXRoaW5nIHBvaW50cyBvbiB0b3Agb2YgdGhlIHNoYXBlIGR1cmluZyBkcmF3KCkuCiAqIC0gYGNsb3NlKClgIC0gY2xvc2UgdGhlIGN1cnJlbnQgc2VnbWVudCBzbyBubyBuZXcgcG9pbnRzIGNhbiBiZSBhZGRlZC4KICogLSBgbmV3U2VnbWVudChjbG9zZUV4aXN0aW5nPzogYm9vbGVhbilgIC0gc3RhcnQgYSBuZXcgc2VnbWVudCBpbiB0aGlzIHNoYXBlLCB3CiAqCiAqIEEgU2hhcGUgYWxzbyBzdXBwb3J0cyB0aGUgZm9sbG93aW5nIHV0aWxpdHkgZnVuY3Rpb25zOgogKgogKiAtIGBvZmZzZXQoeCwgeSlgIC0gKHRlbXBvcmFyaWx5KSBtb3ZlIHRoaXMgc2hhcGUgYnkgKHgseSkKICogLSBgY29tbWl0KClgIC0gY29tbWl0IHRoZSB0ZW1wb3Jhcnkgb2Zmc2V0IGJ5IHJld3JpdGluZyBhbGwgY29vcmRpYW50ZXMuCiAqIC0gYHJlc2V0KClgIC0gcmVzZXQgdGhlIHNoYXBlIHRvIGhhdmluZyBubyBvZmZzZXQuCiAqIC0gYGRyYXcoKWAgLSBkcmF3cyB0aGUgc2hhcGUgdXNpbmcgaXRzIGN1cnJlbnQgc3Ryb2tlLCBmaWxsLCBhbmQgInNob3cgcG9pbnRzIiBzZXR0aW5ncy4KICogLSBgaW5zaWRlKHgsIHkpOiBzZWdtZW50W11gIC0gcmV0dXJucyB0aGUgbGlzdCBvZiBhbGwgc2VnbWVudHMgdGhhdCAoeCx5KSBpcyBpbnNpZGUgb2YuCiAqCiAqIEFuZCBpdCBzdXBwb3J0cyB0aGUgZm9sbG93aW5nIHBhdGhpbmcgZnVuY3Rpb25zLCB3aXRoIGFyZ3VtZW50cyB0aGF0IGNhbiBlaXRoZXIgY29uc2lzdCBvZgogKiAodGhlIG5lY2Vzc2FyeSBudW1iZXIgb2YpIHBhaXJzIG9mIGNvb3JkaW5hdGUgdmFsdWVzLCBvciAodGhlIG5lY2Vzc2FyeSBudW1iZXIgb2YpIHBvaW50bGlrZXMsCiAqIGJlaW5nIG9iamVjdHMgd2l0aCBhbiBgeGAgYW5kIGB5YCBwcm9wZXJ0eS4KICoKICogLSBgbW92ZVRvKHgseSBPUiBwOnBvaW50TGlrZSlgIC0gc3RhcnQgYSBuZXcgc2VnbWVudCBhbmQgbWFyayBpdHMgcGF0aCBhcyBzdGFydGluZyBhdCAoeCx5KS4KICogLSBgbGluZVRvKHgseSwuLi4gT1IgcCwuLi4pYCAtIGFkZCBvbmUgb3IgbW9yZSBwb2ludHMgdGhhdCBjb25uZWN0IHRvIHRoZSBwcmV2aW91cyBwb2ludCB3aXRoIGEgc3RyYWlnaHQgbGluZS4KICogLSBgcXVhZFRvKGN4LGN5LHgseSwuLi4gT1IgY3AscCwuLi4pYCAtIGFkZCBvbmUgb3IgbW9yZSBxdWFkcmF0aWMgYmV6aWVyIGN1cnZlcywgd2hlcmUgKGN4LGN5KS9jcCBpcyB0aGUgY29udHJvbCBwb2ludCwgYW5kICh4LHkpL3AgdGhlIGVuZCBwb2ludC4KICogLSBgY3VydmVUbyhjeDEsY3kxLGN4MixjeTIseCx5LC4uLiBPUiBjMXAsYzJwLHAsLi4uKWAgLSBhZGQgb25lIG9yIG1vcmUgY3ViaWMgYmV6aWVyIGN1cnZlcywgd2hpY2ggaGF2ZSB0d28gY29udHJvbCBwb2ludHMuCiAqIC0gYHNwbGluZVRvKHgxLHkxLC4uLiBPUiBwMSwuLi4pYCAtIGFkZCBvbmUgb3IgbW9yZSBjYXJkaW5hbCBzcGxpbmUgcGF0aGluZyBjb29yZGluYXRlcy4KICoKICogQ2FyZGluYWwgc3BsaW5lIGNvb3JkaW5hdGVzIGFyZSByZW5kZXJlZCBieSB0cmVhdGluZyB0aGUgcGF0aCBhcyBjbG9zZWQKICogKGV2ZW4gaWYgaXQgaXMgbm90KSwgcGVyZm9ybWluZyB3cmFwLWFyb3VuZCBsb29rdXBzIGFzIG5lZWRlZCBpbiBvcmRlcgogKiB0byBkcmF3ICJzb21ldGhpbmcgc2Vuc2libGUiLgogKgogKiBOb3RlIHRoYXQgc2hhcGUgY3V0b3V0cyBhcmUgbm90IChjdXJyZW50bHkpIHBvc3NpYmxlLiBZb3UnbGwgd2FudCB0bwogKiByb2xsIHlvdXIgb3duIFNWRyBidWlsZGVyIGFuZCB0aGVuIHR1cm4gdGhhdCBTVkcgaW50byBhIGRhdGEtdXJpIHRoYXQKICogeW91IGp1c3QgcmVuZGVyIHdpdGggaW1hZ2UoKSBpbnN0ZWFkIGlmIHlvdSBuZWVkIGN1dG91dHMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBsZXQgc2hhcGU7CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNoYXBlID0gc3RhcnRTaGFwZSgpOwogKiAgICAgICBzaGFwZS5hbGxvd1Jlc2l6aW5nKCk7CiAqICAgICAgIHNoYXBlLm1ha2VNb3ZhYmxlKCk7CiAqICAgICAgIHNoYXBlLmFkZCgwLGhlaWdodC8yKTsKICogICAgICAgc2hhcGUuYWRkKHdpZHRoLzIsIDApOwogKiAgICAgICBzaGFwZS5hZGQod2lkdGgsIGhlaWdodC8yKTsKICogICAgICAgc2hhcGUuYWRkKHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIHNoYXBlLmNsb3NlKCk7CiAqICAgICB9CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGBnb2xkYCk7CiAqICAgICAgIHNoYXBlLmRyYXcodHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge1NoYXBlfSB0aGUgbmV3bHkgY3JlYXRlZCBzaGFwZSBvYmplY3QKICoKICogQHNlZSB7QGxpbmsgZW5kU2hhcGV9CiAqLwpmdW5jdGlvbiBzdGFydFNoYXBlKCkgewogIHJldHVybiAoX19zaGFwZSA9IG5ldyBTaGFwZSgpKTsKfQoKLyoqCiAqIENsZWFyIHRoZSBjdXJyZW50IHNoYXBlLCBvcHRpb25hbGx5IGNsb3NpbmcgaXQuCiAqCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY2xvc2U/IFdoZW4gdXNlZCwgY2xvc2VzIHRoZSBzaGFwZSdzIGN1cnJlbnQgc2VnbWVudC4KICogQHJldHVybnMge1NoYXBlfSBUaGUgc2hhcGUgdGhhdCBnb3QgY2xvc2VkCiAqCiAqIEBzZWUge0BsaW5rIHN0YXJ0U2hhcGV9CiAqLwpmdW5jdGlvbiBlbmRTaGFwZShjbG9zZSA9IGZhbHNlKSB7CiAgaWYgKF9fc2hhcGUgJiYgY2xvc2UpIF9fc2hhcGUuY2xvc2UoKTsKICBjb25zdCBzaGFwZSA9IF9fc2hhcGU7CiAgX19zaGFwZSA9IHVuZGVmaW5lZDsKICByZXR1cm4gc2hhcGU7Cn0KCi8qKgogKiBTdGFydCBhIG5ldyBzZWdtZW50IGluIGEgc2hhcGUuCiAqCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY2xvc2U/IENsb3NlcyB0aGUgY3VycmVudCBzZWdtZW50IGJlZm9yZSBvcGVuaW5nIGEgbmV3IG9uZSAoZGVmYXVsdCA9IHRydWUpCiAqCiAqIEBzZWUge0BsaW5rIHN0YXJ0U2hhcGV9CiAqIEBzZWUge0BsaW5rIGVuZFNoYXBlfQogKi8KZnVuY3Rpb24gbmV3U2VnbWVudChjbG9zZSA9IHRydWUpIHsKICBfX3NoYXBlPy5uZXdTZWdtZW50KGNsb3NlKTsKfQovKioKICogQ2VudGVycyB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gb24geW91ciBncmFwaGljLgogKiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gY2FsbGluZzoKICoKICogYGBgCiAqIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqIGBgYAogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgY2VudGVyKCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBsaW5lKDAsIC1odWdlLCAwLCBodWdlKTsKICogICAgICAgbGluZSgtaHVnZSwgMCwgaHVnZSwgMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCggMTAsICAxMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCggMTAsIC0xMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCgtMTAsIC0xMCk7CiAqICAgICAgIHNldENvbG9yKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgICBwb2ludCgtMTAsICAxMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICovCmZ1bmN0aW9uIGNlbnRlcigpIHsKICB0cmFuc2xhdGUod2lkdGggLyAyLCBoZWlnaHQgLyAyKTsKfQoKLyoqCiAqIFJlc2V0IHRoZSBjb29yZGluYXRlIHRyYW5zZm9ybSBtYXRyaXguCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIG5vR3JpZCgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYGxpZ2h0Z3JleWApOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHRyYW5zbGF0ZSg1MCw1MCk7CiAqICAgICAgIGxpbmUoMCwwLDEwMCwwKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApOwogKiAgICAgICBwb2ludCgxMCwwKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBwb2ludCgxMCwwKTsKICogICAgICAgbGluZSgwLDAsMTAwLDApOwogKiAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICByb3RhdGUoLVBJLzYpCiAqICAgICAgIHBvaW50KDEwMCwwKTsKICogICAgICAgc2NhbGUoMC41LCAwLjUpOwogKiAgICAgICBwb2ludCgxMDAsMCk7CiAqICAgICAgIGxpbmUoMTAwLDAsMjAwLDApOwogKiAgICAgICByZXNldFRyYW5zZm9ybSgpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgbGluZSgwLDMsMTAwLDMpOwogKiAgICAgICBwb2ludCgwLDMpOwogKiAgICAgICBwb2ludCgxMCwzKTsKICogICAgICAgcG9pbnQoMTAwLDMpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHJlc2V0VHJhbnNmb3JtKCkgewogIF9fY3R4LnJlc2V0VHJhbnNmb3JtKCk7Cn0KCi8qKgogKiBSb3RhdGUgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIHdydCB0aGUgY3VycmVudCBvcmlnaW4uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIG5vR3JpZCgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYGxpZ2h0Z3JleWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgVGhlIGFuZ2xlIGJ5IHdoaWNoIHRvIHJvdGF0ZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gaW4gcmFkaWFucwogKgogKiBAc2VlIHtAbGluayB0cmFuc2Zvcm19CiAqIEBzZWUge0BsaW5rIHJlc2V0VHJhbnNmb3JtfQogKi8KZnVuY3Rpb24gcm90YXRlKGFuZ2xlID0gMCkgewogIF9fY3R4LnJvdGF0ZShhbmdsZSk7Cn0KCi8qKgogKiBTY2FsZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gd3J0IHRoZSBjdXJyZW50IG9yaWdpbi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgbGlnaHRncmV5YCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwb2ludCgwLDApOwogKiAgICAgICBzZXRDb2xvcihgZGFya2dyZWVuYCk7CiAqICAgICAgIGxpbmUoMCwwLDIwLDIwKTsKICogICAgICAgcG9pbnQoMjAsMjApOwogKiAgICAgICByb3RhdGUoUEkvNCk7CiAqICAgICAgIHNjYWxlKDIpOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgYW1vdW50IGJ5IHdoaWNoIHRvIHNjYWxlIHRoZSB4IGNvb3JkaW5hdGVzLgogKiBAcGFyYW0ge251bWJlcn0geT8gVGhlIGFtb3VudCBieSB3aGljaCB0byBzY2FsZSB0aGUgeCBjb29yZGluYXRlcyAoZGVmYXVsdCA9IHNhbWUgYXMgeCkKICoKICogQHNlZSB7QGxpbmsgdHJhbnNmb3JtfQogKiBAc2VlIHtAbGluayByZXNldFRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHNjYWxlKHggPSAxLCB5ID0geCkgewogIF9fY3R4LnNjYWxlKHgsIHkpOwp9CgovKioKICogQ29udmVydCBhIHNjcmVlbiAoZS5nLiBicm93c2VyKSBjb29yZGluYXRlIGludG8gaXRzCiAqIGNvcnJlc3BvbmRpbmcgInRyYW5zZm9ybWVkIiBjb29yZGluYXRlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBub0dyaWQoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBsaWdodGdyZXlgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBzY2FsZSgwLjUpOwogKiAgICAgICBpZiAocG9pbnRlci5hY3RpdmUpIHsKICogICAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgICAgcG9pbnQocG9pbnRlci54LCBwb2ludGVyLnkpOwogKiAgICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgICAgcG9pbnQoc2NyZWVuVG9Xb3JsZChwb2ludGVyLngsIHBvaW50ZXIueSkpOwogKiAgICAgICB9CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSgpIHsKICogICAgICAgcmVkcmF3KCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHNjcmVlbiBjb29yZGluYXRlJ3MgeCB2YWx1ZSBpbiBwaXhlbHMKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHNjcmVlbiBjb29yZGluYXRlJ3MgeSB2YWx1ZSBpbiBwaXhlbHMKICogQHJldHVybnMge1BvaW50TGlrZX0gcCBUaGUgd29ybGQge3gseX0gY29vcmRpbmF0ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgc2NyZWVuIHt4LHl9IGNvb3JkaW5hdGUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCBUaGUgd29ybGQge3gseX0gY29vcmRpbmF0ZQogKgogKiBAc2VlIHtAbGluayBwcm9qZWN0fQogKiBAc2VlIHtAbGluayB3b3JsZFRvU2NyZWVufQogKi8KZnVuY3Rpb24gc2NyZWVuVG9Xb3JsZCh4LCB5KSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIGxldCBNID0gX19jdHguZ2V0VHJhbnNmb3JtKCkuaW52ZXJ0U2VsZigpOwoKICByZXR1cm4gbmV3IFBvaW50KHggKiBNLmEgKyB5ICogTS5jICsgTS5lLCB4ICogTS5iICsgeSAqIE0uZCArIE0uZik7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgdHJhbnNmb3JtIG1hdHJpeCwgYmFzZWQgb24gYXBwbHlpbmc6CiAqCiAqIGBgYAogKiAgICAgICB8IGEgYiBjIHwKICogICBtID0gfCBkIGUgZiB8CiAqICAgICAgIHwgMCAwIDEgfAogKiBgYGAKICoKICogV2l0aCB0aGUgcGFyYW1ldGVycyBkZWZhdWx0aW5nIHRvIHRoZSBpZGVudGl0eSBtYXRyaXguCiAqCiAqIFNlZSB0aGUgZm9sbG93aW5nIE1ETiBhcnRpY2xlIGZvciBtb3JlIGRldGFpbHMgYWJvdXQgdGhpcyBmdW5jdGlvbjoKICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZG9jcy9XZWIvQVBJL0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC90cmFuc2Zvcm0KICoKICogQHBhcmFtIHtudW1iZXJ9IGEgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0ge251bWJlcn0gYiAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSB7bnVtYmVyfSBjIChkZWZhdWx0ID0gMCkKICogQHBhcmFtIHtudW1iZXJ9IGQgKGRlZmF1bHQgPSAwKQogKiBAcGFyYW0ge251bWJlcn0gZSAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSB7bnVtYmVyfSBmIChkZWZhdWx0ID0gMCkKICoKICogQHNlZSB7QGxpbmsgcmVzZXRUcmFuc2Zvcm19CiAqLwpmdW5jdGlvbiB0cmFuc2Zvcm0oYSA9IDEsIGIgPSAwLCBjID0gMCwgZCA9IDAsIGUgPSAxLCBmID0gMCkgewogIF9fY3R4LnRyYW5zZm9ybShhLCBiLCBjLCBkLCBlLCBmKTsKfQoKLyoqCiAqIFRyYW5zbGF0ZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gYnkgc29tZSBhbW91bnQgb2YgeCBhbmQgeSB1bml0cy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHBvaW50KDAsMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHggdmFsdWUgaW4gcGl4ZWxzIHRvIGJlIHRyZWF0ZWQgYXMgdGhlIG5ldyAiemVybyIKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHkgdmFsdWUgaW4gcGl4ZWxzIHRvIGJlIHRyZWF0ZWQgYXMgdGhlIG5ldyAiemVybyIKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHt4LHl9IGNvb3JkaW5hdGUgdG8gYmUgdHJlYXRlZCBhcyB0aGUgbmV3ICJ6ZXJvIgogKgogKiBAc2VlIHtAbGluayB0cmFuc2Zvcm19CiAqIEBzZWUge0BsaW5rIHJlc2V0VHJhbnNmb3JtfQogKi8KZnVuY3Rpb24gdHJhbnNsYXRlKHggPSAwLCB5ID0gMCkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIF9fY3R4LnRyYW5zbGF0ZSh4LCB5KTsKfQoKLyoqCiAqIENvbnZlcnQgYW4gaW4tY2FudmFzICJ0cmFuc2Zvcm1lZCIgY29vcmRpbmF0ZSBpbnRvIGl0cwogKiBjb3JyZXNwb25kaW5nICJzY3JlZW4iIChpLmUuIGJyb3dzZXIgY2FudmFzIG9mZnNldCkgY29vcmRpbmF0ZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7CiAqCiAqICAgICAgIHJvdGF0ZShtaWxsaXMoKSAvIDIwMDApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIGNvbnN0IHAgPSBuZXcgUG9pbnQoMzAsIDApOwogKiAgICAgICBwb2ludChwKTsKICogICAgICAgdGV4dChgJHtwLnh9LCR7cC55fWAsIHAueCArIDEwLCBwLnkgKyAxMCk7CiAqCiAqICAgICAgIGNvbnN0IHt4LCB5fSA9IHdvcmxkVG9TY3JlZW4ocCk7CiAqICAgICAgIHJlc2V0VHJhbnNmb3JtKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDE2KTsKICogICAgICAgdGV4dChgJHt4LnRvRml4ZWQoKX0sJHt5LnRvRml4ZWQoKX1gLCB4IC0gMjUsIHkgLSAxNSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHdvcmxkIGNvb3JkaW5hdGUncyB4IHZhbHVlIGluIHBpeGVscwogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgd29ybGQgY29vcmRpbmF0ZSdzIHkgdmFsdWUgaW4gcGl4ZWxzCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgVGhlIHNjcmVlbiB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSB3b3JsZCB7eCx5fSBjb29yZGluYXRlCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgVGhlIHNjcmVlbiB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBzZWUge0BsaW5rIHByb2plY3R9CiAqIEBzZWUge0BsaW5rIHNjcmVlblRvV29ybGR9CiAqLwpmdW5jdGlvbiB3b3JsZFRvU2NyZWVuKHgsIHkpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgbGV0IE0gPSBfX2N0eC5nZXRUcmFuc2Zvcm0oKTsKCiAgcmV0dXJuIG5ldyBQb2ludCh4ICogTS5hICsgeSAqIE0uYyArIE0uZSwgeCAqIE0uYiArIHkgKiBNLmQgKyBNLmYpOwp9CmZ1bmN0aW9uIGdyaWQoKSB7CiAgc2F2ZSgpOwogIHNldExpbmVXaWR0aCgwLjUpOwogIG5vRmlsbCgpOwogIHNldFN0cm9rZShfX2dyaWRfY29sb3IpOwogIGZvciAoCiAgICBsZXQgeCA9ICgtMC41ICsgX19ncmlkX3NwYWNpbmcgLyAyKSB8IDA7CiAgICB4IDwgd2lkdGg7CiAgICB4ICs9IF9fZ3JpZF9zcGFjaW5nCiAgKSB7CiAgICBsaW5lKHgsIDAsIHgsIGhlaWdodCk7CiAgfQogIGZvciAoCiAgICBsZXQgeSA9ICgtMC41ICsgX19ncmlkX3NwYWNpbmcgLyAyKSB8IDA7CiAgICB5IDwgaGVpZ2h0OwogICAgeSArPSBfX2dyaWRfc3BhY2luZwogICkgewogICAgbGluZSgwLCB5LCB3aWR0aCwgeSk7CiAgfQogIHJlc3RvcmUoKTsKfQpmdW5jdGlvbiBfX3NhZmVseUludGVyY2VwdEtleShldnQpIHsKICAvLyBXZSBkb24ndCB3YW50IHRvIGludGVyZmVyZSB3aXRoIHRoZSBicm93c2VyLCBzbyB3ZSdyZSBvbmx5CiAgLy8gZ29pbmcgdG8gYWxsb3cgdW5tb2RpZmllZCBrZXlzLCBvciBzaGlmdC1tb2RpZmllZCBrZXlzLAogIC8vIGFuZCB0YWIgaGFzIHRvIGFsd2F5cyB3b3JrLiBGb3Igb2J2aW91cyByZWFzb25zLgogIGNvbnN0IHRhYiA9IGV2dC5rZXkgIT09ICJUYWIiOwogIGNvbnN0IGZ1bmN0aW9uS2V5ID0gZXZ0LmtleS5tYXRjaCgvRlxkKy8pID09PSBudWxsOwogIGNvbnN0IHNwZWNpZmljQ2hlY2sgPSB0YWIgJiYgZnVuY3Rpb25LZXk7CiAgaWYgKCFldnQuYWx0S2V5ICYmICFldnQuY3RybEtleSAmJiAhZXZ0Lm1ldGFLZXkgJiYgc3BlY2lmaWNDaGVjaykgewogICAgaWYgKGV2dC50YXJnZXQgPT09IF9fY2FudmFzKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBfX2tleURvd24oa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KSB7CiAga2V5Ym9hcmRba2V5XSA9IERhdGUubm93KCk7CiAgaWYgKHR5cGVvZiBrZXlEb3duICE9PSBgdW5kZWZpbmVkYCkKICAgIGtleURvd24oa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KTsKfQoKX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihga2V5ZG93bmAsIChldnQpID0+IHsKICBfX3NhZmVseUludGVyY2VwdEtleShldnQpOwogIGNvbnN0IHsga2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5IH0gPSBldnQ7CiAgaWYgKF9fZmluaXNoZWRfc2V0dXApIF9fa2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9KTsKCmZ1bmN0aW9uIF9fa2V5VXAoa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KSB7CiAgZGVsZXRlIGtleWJvYXJkW2tleV07CiAgaWYgKHR5cGVvZiBrZXlVcCAhPT0gYHVuZGVmaW5lZGApCiAgICBrZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9CgpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBrZXl1cGAsIChldnQpID0+IHsKICBfX3NhZmVseUludGVyY2VwdEtleShldnQpOwogIGNvbnN0IHsga2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5IH0gPSBldnQ7CiAgaWYgKF9fZmluaXNoZWRfc2V0dXApIF9fa2V5VXAoa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KTsKfSk7CmNvbnN0IF9fYmlub21pYWxDb2VmZmljaWVudHMgPSBbWzFdLCBbMSwgMV1dOwpjbGFzcyBNYXRyaXggewogIGNvbnN0cnVjdG9yKG4sIG0sIGRhdGEpIHsKICAgIGRhdGEgPSBuIGluc3RhbmNlb2YgQXJyYXkgPyBuIDogZGF0YTsKICAgIHRoaXMuZGF0YSA9CiAgICAgIGRhdGEgPz8gWy4uLm5ldyBBcnJheShuKV0ubWFwKCh2KSA9PiBbLi4ubmV3IEFycmF5KG0pXS5tYXAoKHYpID0+IDApKTsKICAgIHRoaXMucm93cyA9IHRoaXMuZGF0YS5sZW5ndGg7CiAgICB0aGlzLmNvbHMgPSB0aGlzLmRhdGFbMF0ubGVuZ3RoOwogIH0KICBzZXREYXRhKGRhdGEpIHsKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgfQogIGdldChpLCBqKSB7CiAgICByZXR1cm4gdGhpcy5kYXRhW2ldW2pdOwogIH0KICBzZXQoaSwgaiwgdmFsdWUpIHsKICAgIHRoaXMuZGF0YVtpXVtqXSA9IHZhbHVlOwogIH0KICByb3coaSkgewogICAgcmV0dXJuIHRoaXMuZGF0YVtpXTsKICB9CiAgY29sKGopIHsKICAgIHZhciBkID0gdGhpcy5kYXRhLAogICAgICBjb2wgPSBbXTsKICAgIGZvciAobGV0IHIgPSAwLCBsID0gZC5sZW5ndGg7IHIgPCBsOyByKyspIHsKICAgICAgY29sLnB1c2goZFtyXVtqXSk7CiAgICB9CiAgICByZXR1cm4gY29sOwogIH0KICBtdWx0aXBseShvdGhlcikgewogICAgcmV0dXJuIG5ldyBNYXRyaXgobXVsdGlwbHlNYXRyaXgodGhpcy5kYXRhLCBvdGhlci5kYXRhKSk7CiAgfQogIGludmVydCgpIHsKICAgIHJldHVybiBuZXcgTWF0cml4KGludmVydE1hdHJpeCh0aGlzLmRhdGEpKTsKICB9CiAgdHJhbnNwb3NlKCkgewogICAgcmV0dXJuIG5ldyBNYXRyaXgodHJhbnNwb3NlTWF0cml4KHRoaXMuZGF0YSkpOwogIH0KfQpjbGFzcyBQb2ludCB7CiAgY29uc3RydWN0b3IoeCwgeSkgewogICAgdGhpcy54ID0geDsKICAgIHRoaXMueSA9IHk7CiAgfQp9CgpjbGFzcyBDaXJjbGUgZXh0ZW5kcyBQb2ludCB7CiAgY29uc3RydWN0b3IoeCwgeSwgcikgewogICAgc3VwZXIoeCwgeSk7CiAgICB0aGlzLnIgPSByOwogIH0KfQpmdW5jdGlvbiBfX2NoZWNrRm9yQ3VycmVudE1vdmFibGUoeCwgeSwgdHlwZSkgewogIGN1cnJlbnRNb3ZhYmxlID0gZmFsc2U7CgogIGlmICghX19tb3ZhYmxlX3BvaW50cy5sZW5ndGgpIHJldHVybjsKCiAgY29uc3QgbWF0Y2hlcyA9IFtdOwogIGNvbnN0IG1hdGNoUGFkZGluZyA9IHR5cGUuaW5jbHVkZXMoYG1vdXNlYCkgPyAxMCA6IDMwOwoKICBfX21vdmFibGVfcG9pbnRzLmZvckVhY2goKHAsIHBvcykgPT4gewogICAgaWYgKHAgaW5zdGFuY2VvZiBTaGFwZSkgewogICAgICBpZiAocC5pbnNpZGUoeCwgeSkubGVuZ3RoID4gMCkgewogICAgICAgIG1hdGNoZXMucHVzaCh7IHAsIGQ6IDAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGxldCB4MiA9IHBbMF0gPT09IHVuZGVmaW5lZCA/IHAueCA6IHBbMF07CiAgICAgIGxldCB5MiA9IHBbMV0gPT09IHVuZGVmaW5lZCA/IHAueSA6IHBbMV07CiAgICAgIGNvbnN0IGQgPSBkaXN0KHgsIHksIHgyLCB5Mik7CiAgICAgIGlmIChkIDwgKHAuciA/IHAuciA6IDApICsgbWF0Y2hQYWRkaW5nKSB7CiAgICAgICAgbWF0Y2hlcy5wdXNoKHsgcCwgZCB9KTsKICAgICAgfQogICAgfQogIH0pOwoKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgYXV0b2A7CgogIGlmIChtYXRjaGVzLmxlbmd0aCkgewogICAgbWF0Y2hlcy5zb3J0KChhLCBiKSA9PiBhLmQgLSBiLmQpOwogICAgY3VycmVudE1vdmFibGUgPSBtYXRjaGVzWzBdLnA7CiAgICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgcG9pbnRlcmA7CiAgfQp9CgpmdW5jdGlvbiBfX3RvUG9pbnRlckV2ZW50KGV2dCkgewogIGxldCBwb2ludGVyID0gZXZ0OwogIC8vIENvbnZlcnQgbW91c2Ugb3IgdG91Y2ggaW50byBnZW5lcmljIHBvaW50ZXIuIFdoaWNoIHdlIG5lZWQKICAvLyB0byBkbyBiZWNhdXNlIENocm9tZSBvbiBNYWNPUyBoYXMgZGVjaWRlZCB0byBub3QgZ2VuZXJhdGUKICAvLyBwb2ludGVyIGV2ZW50cyB3aGVuIHRoZXJlJ3MgYSBtb3VzZS4gVGhhbmtzIEdvb2dsZSEKICBpZiAoZXZ0LnR5cGUuaW5jbHVkZXMoYHRvdWNoYCkpIHsKICAgIGNvbnN0IHsgdG91Y2hlcywgY2hhbmdlZFRvdWNoZXMgfSA9IGV2dC5vcmlnaW5hbEV2ZW50ID8/IGV2dDsKICAgIHBvaW50ZXIgPSB0b3VjaGVzWzBdID8/IGNoYW5nZWRUb3VjaGVzWzBdOwogIH0KICBjb25zdCB7IGNsaWVudFgsIGNsaWVudFkgfSA9IHBvaW50ZXI7CiAgY29uc3QgeyBsZWZ0LCB0b3AgfSA9IF9fY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogIHJldHVybiB7IG9mZnNldFg6IGNsaWVudFggLSBsZWZ0LCBvZmZzZXRZOiBjbGllbnRZIC0gdG9wIH07Cn0KCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09CgpbYHRvdWNoc3RhcnRgLCBgbW91c2Vkb3duYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2dCkgPT4gewogICAgaWYgKF9fZmluaXNoZWRfc2V0dXApIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgY29uc3QgeyBvZmZzZXRYLCBvZmZzZXRZIH0gPSBfX3RvUG9pbnRlckV2ZW50KGV2dCk7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUsIGRvd246IHRydWUsIG1hcms6IHsgeCwgeSB9IH0pOwogICAgICBfX2NoZWNrRm9yQ3VycmVudE1vdmFibGUoeCwgeSwgdHlwZSk7CiAgICAgIF9fcG9pbnRlckRvd24oeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyRG93bih4LCB5KSB7CiAgaWYgKGN1cnJlbnRNb3ZhYmxlKSB7CiAgICBpZiAoY3VycmVudE1vdmFibGUgaW5zdGFuY2VvZiBTaGFwZSkgewogICAgICAvLyBkb24ndCBkbyBhbnl0aGluZyBzcGVjaWFsLgogICAgfSBlbHNlIHsKICAgICAgY3VycmVudE1vdmFibGUuX2R4ID0gY3VycmVudE1vdmFibGUueCAtIHg7CiAgICAgIGN1cnJlbnRNb3ZhYmxlLl9keSA9IGN1cnJlbnRNb3ZhYmxlLnkgLSB5OwogICAgfQogIH0KICBpZiAodHlwZW9mIHBvaW50ZXJEb3duICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlckRvd24oeCwgeSk7Cn0KCltgdG91Y2hlbmRgLCBgbW91c2V1cGBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChldnQpID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGNvbnN0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gX190b1BvaW50ZXJFdmVudChldnQpOwogICAgICBjb25zdCB7IHgsIHkgfSA9IHNjcmVlblRvV29ybGQob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwgewogICAgICAgIHgsCiAgICAgICAgeSwKICAgICAgICB0eXBlLAogICAgICAgIGRvd246IGZhbHNlLAogICAgICAgIG1hcms6IGZhbHNlLAogICAgICAgIGRyYWc6IGZhbHNlLAogICAgICB9KTsKICAgICAgX19wb2ludGVyVXAoeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyVXAoeCwgeSkgewogIGlmICh0eXBlb2YgcG9pbnRlclVwICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlclVwKHgsIHkpOwogIGlmIChwb2ludGVyLm1hcms/LnggPT09IHggJiYgcG9pbnRlci5tYXJrPy55ID09PSB5KSB7CiAgICBpZiAodHlwZW9mIHBvaW50ZXJDbGljayAhPT0gYHVuZGVmaW5lZGApIHBvaW50ZXJDbGljayh4LCB5KTsKICB9CiAgaWYgKGN1cnJlbnRNb3ZhYmxlICYmIGN1cnJlbnRNb3ZhYmxlIGluc3RhbmNlb2YgU2hhcGUpIHsKICAgIGN1cnJlbnRNb3ZhYmxlLmNvbW1pdCgpOwogIH0KfQoKW2B0b3VjaG1vdmVgLCBgbW91c2Vtb3ZlYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2dCkgPT4gewogICAgaWYgKF9fZmluaXNoZWRfc2V0dXApIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgY29uc3QgeyBvZmZzZXRYLCBvZmZzZXRZIH0gPSBfX3RvUG9pbnRlckV2ZW50KGV2dCk7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUgfSk7CiAgICAgIGlmICghcG9pbnRlci5kb3duKSBfX2NoZWNrRm9yQ3VycmVudE1vdmFibGUoeCwgeSwgdHlwZSk7CiAgICAgIF9fcG9pbnRlck1vdmUoeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyTW92ZSh4LCB5KSB7CiAgbGV0IGhhZE1vdmFibGUgPSBmYWxzZTsKICBpZiAocG9pbnRlci5kb3duICYmIGN1cnJlbnRNb3ZhYmxlKSB7CiAgICBpZiAoY3VycmVudE1vdmFibGUgaW5zdGFuY2VvZiBTaGFwZSkgewogICAgICBjdXJyZW50TW92YWJsZS5vZmZzZXQoeCAtIHBvaW50ZXIubWFyay54LCB5IC0gcG9pbnRlci5tYXJrLnkpOwogICAgfSBlbHNlIGlmIChjdXJyZW50TW92YWJsZVswXSkgewogICAgICBjdXJyZW50TW92YWJsZVswXSA9IHggKyBjdXJyZW50TW92YWJsZS5fZHg7CiAgICAgIGN1cnJlbnRNb3ZhYmxlWzFdID0geSArIGN1cnJlbnRNb3ZhYmxlLl9keTsKICAgIH0gZWxzZSB7CiAgICAgIGN1cnJlbnRNb3ZhYmxlLnggPSB4ICsgY3VycmVudE1vdmFibGUuX2R4OwogICAgICBjdXJyZW50TW92YWJsZS55ID0geSArIGN1cnJlbnRNb3ZhYmxlLl9keTsKICAgIH0KICAgIGN1cnJlbnRNb3ZhYmxlLl9fb25fbW92ZT8uKCk7CiAgICBoYWRNb3ZhYmxlID0gdHJ1ZTsKICB9CgogIHBvaW50ZXIuZHJhZyA9IHBvaW50ZXIuZG93bjsKCiAgaWYgKHBvaW50ZXIuZHJhZyAmJiB0eXBlb2YgcG9pbnRlckRyYWcgIT09IGB1bmRlZmluZWRgKSB7CiAgICBwb2ludGVyRHJhZyh4LCB5KTsKICB9CgogIGlmICh0eXBlb2YgcG9pbnRlck1vdmUgIT09IGB1bmRlZmluZWRgKSB7CiAgICBwb2ludGVyTW92ZSh4LCB5KTsKICB9CgogIGlmIChoYWRNb3ZhYmxlICYmICFwbGF5aW5nKSByZWRyYXcoKTsKfQoKW2B0b3VjaHN0YXJ0YCwgYG1vdXNlZW50ZXJgXS5mb3JFYWNoKCh0eXBlKSA9PiB7CiAgX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCAoKSA9PiB7CiAgICBwb2ludGVyLmFjdGl2ZSA9IHRydWU7CiAgICBfX3BvaW50ZXJBY3RpdmUodHJ1ZSk7CiAgfSk7Cn0pOwoKW2B0b3VjaGVuZGAsIGBtb3VzZWxlYXZlYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKCkgPT4gewogICAgX19wb2ludGVyQWN0aXZlKGZhbHNlKTsKICB9KTsKfSk7CgpmdW5jdGlvbiBfX3BvaW50ZXJBY3RpdmUoYWN0aXZlKSB7CiAgaWYgKHR5cGVvZiBwb2ludGVyQWN0aXZlICE9PSBgdW5kZWZpbmVkYCkgewogICAgcG9pbnRlckFjdGl2ZShhY3RpdmUpOwogIH0KfQovKioKICogY29kZSB1c2VkIGJ5IHByb2plY3QuanMsIGJ1dCBuYW1lZCBzbyB0aGF0IGl0IGxvYWRzCiAqIGZpcnN0LCBhbmQgZG9lcyBub3QgZ2V0IGFkZGVkIHRvIHRoZSBkLnRzIGZpbGUuCiAqLwpjbGFzcyBDYWJpbmV0UHJvamVjdG9yIHsKICBBID0gMDsKICBCID0gMDsKICBDID0gMDsKCiAgY29uc3RydWN0b3Iob3gsIG95LCBzY2FsZSwgcGhpKSB7CiAgICB0aGlzLnVwZGF0ZShveCwgb3ksIHNjYWxlLCBwaGkpOwogIH0KCiAgc2V0Um90YXRpb24oeCA9IDAsIHkgPSAwLCB6ID0gMCkgewogICAgdGhpcy5BID0geDsKICAgIHRoaXMuQiA9IHo7CiAgICB0aGlzLkMgPSB5OwogIH0KCiAgcm90YXRlKHgsIHksIHopIHsKICAgIGxldCB7IEEsIEIsIEMgfSA9IHRoaXM7CiAgICBsZXQgYSA9IHg7CiAgICBsZXQgYiA9IHkgKiBjb3MoQSkgLSB6ICogc2luKEEpOwogICAgbGV0IGMgPSB5ICogc2luKEEpICsgeiAqIGNvcyhBKTsKICAgIHggPSBhOwogICAgeSA9IGI7CiAgICB6ID0gYzsKICAgIGEgPSB4ICogY29zKEIpICsgeiAqIHNpbihCKTsKICAgIGIgPSB5OwogICAgYyA9IHggKiAtc2luKEIpICsgeiAqIGNvcyhCKTsKICAgIHggPSBhOwogICAgeSA9IGI7CiAgICB6ID0gYzsKICAgIGEgPSB4ICogY29zKEMpIC0geSAqIHNpbihDKTsKICAgIGIgPSB4ICogc2luKEMpICsgeSAqIGNvcyhDKTsKICAgIGMgPSB6OwoKICAgIHJldHVybiBbYSwgYiwgY107CiAgfQoKICB1cGRhdGUob3ggPSAwLCBveSA9IDAsIHNjYWxlID0gMSwgcGhpID0gLVBJIC8gNikgewogICAgdGhpcy5vZmZzZXQgPSBuZXcgUG9pbnQob3gsIG95KTsKICAgIHRoaXMuc2NhbGUgPSBzY2FsZTsKICAgIHRoaXMucGhpID0gcGhpOwogIH0KCiAgcHJvamVjdCh4LCB5LCB6KSB7CiAgICBjb25zdCB7IG9mZnNldCwgc2NhbGUsIHBoaSB9ID0gdGhpczsKICAgIHggKj0gc2NhbGU7CiAgICB5ICo9IHNjYWxlOwogICAgeiAqPSBzY2FsZTsKICAgIFt4LCB5LCB6XSA9IHRoaXMucm90YXRlKHgsIHksIHopOwogICAgY29uc3QgYSA9IHksCiAgICAgIGIgPSAteiwKICAgICAgYyA9IC14IC8gMjsKCiAgICByZXR1cm4gbmV3IFBvaW50KAogICAgICBvZmZzZXQueCArIGEgKyBjICogY29zKHBoaSksCiAgICAgIG9mZnNldC55ICsgYiArIGMgKiBzaW4ocGhpKQogICAgKTsKICB9Cn0KCmxldCBfX3Byb2plY3RvciA9IG5ldyBDYWJpbmV0UHJvamVjdG9yKCk7Ci8qKgogKiAuLi5kb2NzIGdvIGhlcmUuLi4KICovCmNsYXNzIFNlZ21lbnQgewogIG94ID0gMDsKICBveSA9IDA7CiAgcG9pbnRzID0gW107CiAgaW5zdHJ1Y3Rpb25zID0gW107CgogIGNsb3NlZCA9IGZhbHNlOwogIHN2Z19kID0gYGA7CgogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5wYXRoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKGBodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z2AsIGBwYXRoYCk7CiAgfQoKICBhZGQoeCwgeSkgewogICAgY29uc3QgeyBjbG9zZWQsIHBvaW50cyB9ID0gdGhpczsKICAgIGlmIChjbG9zZWQpIHJldHVybjsKICAgIGNvbnN0IHAgPSB7IHgsIHkgfTsKICAgIHBvaW50cy5wdXNoKHApOwogICAgcmV0dXJuIHA7CiAgfQoKICBfaW5zdHJ1Y3Rpb24odHlwZU5hbWUsIC4uLmFyZ3MpIHsKICAgIGxldCBwb2ludHMgPSBhcmdzOwoKICAgIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gYG51bWJlcmApIHsKICAgICAgcG9pbnRzID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkgKz0gMikgewogICAgICAgIHBvaW50cy5wdXNoKHsgeDogYXJnc1tpXSwgeTogYXJnc1tpICsgMV0gfSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBzZWUgZHJhdy5zcGxpbmUoLi4uYXJncykKICAgIGxldCBUID0gMTsKICAgIGlmICh0eXBlTmFtZSA9PT0gYHNwbGluZWApIHsKICAgICAgaWYgKGFyZ3MubGVuZ3RoICUgMiA9PT0gMSkgewogICAgICAgIFtUXSA9IGFyZ3Muc3BsaWNlKGFyZ3MubGVuZ3RoIC0gMSwgMSk7CiAgICAgICAgcG9pbnRzLnBvcCgpOwogICAgICB9CiAgICB9CgogICAgcG9pbnRzLmZvckVhY2goKHApID0+IHsKICAgICAgcFt0eXBlTmFtZV0gPSB0cnVlOwogICAgICBpZiAodHlwZU5hbWUgPT09IGBzcGxpbmVgKSBwLlQgPSBUOwogICAgICB0aGlzLmluc3RydWN0aW9ucy5wdXNoKHApOwogICAgfSk7CgogICAgdGhpcy5pbnZhbGlkYXRlKCk7CgogICAgcmV0dXJuIHBvaW50czsKICB9CgogIG1vdmVUbyh4LCB5KSB7CiAgICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgICAgeSA9IHgueTsKICAgICAgeCA9IHgueDsKICAgIH0KICAgIHJldHVybiB0aGlzLl9pbnN0cnVjdGlvbihgbW92ZWAsIHgsIHkpOwogIH0KCiAgbGluZVRvKC4uLmFyZ3MpIHsKICAgIHJldHVybiB0aGlzLl9pbnN0cnVjdGlvbihgbGluZWAsIC4uLmFyZ3MpOwogIH0KCiAgY3VydmVUbyguLi5hcmdzKSB7CiAgICByZXR1cm4gdGhpcy5faW5zdHJ1Y3Rpb24oYGJlemllcmAsIC4uLmFyZ3MpOwogIH0KCiAgcXVhZFRvKC4uLmFyZ3MpIHsKICAgIHJldHVybiB0aGlzLl9pbnN0cnVjdGlvbihgcXVhZGAsIC4uLmFyZ3MpOwogIH0KCiAgc3BsaW5lVG8oLi4uYXJncykgewogICAgcmV0dXJuIHRoaXMuX2luc3RydWN0aW9uKGBzcGxpbmVgLCAuLi5hcmdzKTsKICB9CgogIGNsb3NlKCkgewogICAgdGhpcy5jbG9zZWQgPSB0cnVlOwogICAgdGhpcy5pbnZhbGlkYXRlKCk7CiAgfQoKICBvZmZzZXQoeCwgeSkgewogICAgdGhpcy5veCA9IHg7CiAgICB0aGlzLm95ID0geTsKICAgIHRoaXMuaW52YWxpZGF0ZSgpOwogIH0KCiAgY29tbWl0KHgsIHkpIHsKICAgIGNvbnN0IHsgb3gsIG95LCBpbnN0cnVjdGlvbnMgfSA9IHRoaXM7CiAgICBpbnN0cnVjdGlvbnMuZm9yRWFjaCgocCkgPT4gewogICAgICBwLnggKz0geDsKICAgICAgcC55ICs9IHk7CiAgICB9KTsKICAgIHRoaXMub3ggPSAwOwogICAgdGhpcy5veSA9IDA7CiAgICB0aGlzLmludmFsaWRhdGUoKTsKICB9CgogIGluc2lkZSh4LCB5KSB7CiAgICBjb25zdCB7IHBhdGggfSA9IHRoaXM7CiAgICBwYXRoLnNldEF0dHJpYnV0ZShgZGAsIHRoaXMuc3ZnX2QpOwogICAgcmV0dXJuIHBhdGguaXNQb2ludEluRmlsbChuZXcgRE9NUG9pbnQoeCwgeSkpOwogIH0KCiAgaW52YWxpZGF0ZSgpIHsKICAgIHRoaXMudXBkYXRlU1ZHKCk7CiAgfQoKICB1cGRhdGVTVkcoKSB7CiAgICBsZXQgZCA9IGBgOwogICAgY29uc3Qgb3BzID0gdGhpcy5pbnN0cnVjdGlvbnMuc2xpY2UoKTsKICAgIHRoaXMucmVwbGFjZVNwbGluZVdpdGhCZXppZXJzKG9wcyk7CiAgICB3aGlsZSAob3BzLmxlbmd0aCkgewogICAgICBjb25zdCBwID0gb3BzLnNoaWZ0KCk7CiAgICAgIGlmIChwLm1vdmUpIGQgPSBgTSAke3AueH0gJHtwLnl9YDsKICAgICAgaWYgKHAubGluZSkgZCA9IGAke2R9IEwgJHtwLnh9ICR7cC55fWA7CiAgICAgIGlmIChwLnF1YWQpIHsKICAgICAgICBjb25zdCBvcCA9IG9wcy5zaGlmdCgpOwogICAgICAgIGQgPSBgJHtkfSBRICR7cC54fSAke3AueX0gJHtvcC54fSAke29wLnl9YDsKICAgICAgfQogICAgICBpZiAocC5iZXppZXIpIHsKICAgICAgICBjb25zdCBvcDIgPSBvcHMuc2hpZnQoKTsKICAgICAgICBjb25zdCBvcDMgPSBvcHMuc2hpZnQoKTsKICAgICAgICBkID0gYCR7ZH0gQyAke3AueH0gJHtwLnl9ICR7b3AyLnh9ICR7b3AyLnl9ICR7b3AzLnh9ICR7b3AzLnl9YDsKICAgICAgfQogICAgfQogICAgaWYgKHRoaXMuY2xvc2VkKSBkICs9IGAgWmA7CiAgICB0aGlzLnN2Z19kID0gZDsKICAgIHRoaXMucGF0aC5zZXRBdHRyaWJ1dGUoYGRgLCBkKTsKICB9CgogIGdldFNWRyhzaG93UG9pbnRzLCBmaWxsLCBzdHJva2UpIHsKICAgIGxldCBzdmcgPSBgPHBhdGggZmlsbD0iJHtmaWxsfSIgc3Ryb2tlPSIke3N0cm9rZX0iIGQ9IiR7dGhpcy5zdmdfZH0iLz5gOwogICAgaWYgKHNob3dQb2ludHMpIHsKICAgICAgdGhpcy5pbnN0cnVjdGlvbnMuZm9yRWFjaCgKICAgICAgICAocCkgPT4KICAgICAgICAgIChzdmcgPSBgJHtzdmd9XG48Y2lyY2xlIGZpbGw9IiR7ZmlsbH0iIHN0cm9rZT0iJHtzdHJva2V9IiBjeD0iJHtwLnh9IiBjeT0iJHtwLnl9IiByPSIzIi8+YCkKICAgICAgKTsKICAgIH0KICAgIHJldHVybiBzdmc7CiAgfQoKICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgLy8gQ29kZSAqanVzdCogZm9yIGNvbnZlcnRpbmcgY2FyZGluYWwgc3BsaW5lcyBpbnRvIHBvbHktQmV6aWVycwogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgcmVwbGFjZVNwbGluZVdpdGhCZXppZXJzKG9wcykgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKG9wc1tpXS5zcGxpbmUpIHsKICAgICAgICB0aGlzLmNvbnZlcnRTcGxpbmUob3BzLCBpKTsKICAgICAgfQogICAgfQogIH0KCiAgY29udmVydFNwbGluZShvcHMsIGkpIHsKICAgIGNvbnN0IHNwbGluZXMgPSBbXTsKICAgIC8vIHJlbW92ZSB0aGUgc2VxdWVuY2Ugb2Ygc3BsaW5lIHBvaW50cyBzdGFydGluZyBhdCBvcHNbaV0KICAgIHdoaWxlIChvcHNbaV0gJiYgb3BzW2ldLnNwbGluZSkgc3BsaW5lcy5wdXNoKG9wcy5zcGxpY2UoaSwgMSlbMF0pOwogICAgLy8gaW5qZWN0IHRoZSBlcXVpdmFsZW50IGJlemllciBzZXF1ZW5jZQogICAgb3BzLnNwbGljZShpLCAwLCAuLi50aGlzLnNwbGluZVBvaW50c1RvQmV6aWVyUG9pbnRzKHNwbGluZXMsIG9wcywgaSkpOwogIH0KCiAgc3BsaW5lUG9pbnRzVG9CZXppZXJQb2ludHMoc3BsaW5lcywgb3BzLCBpKSB7CiAgICBsZXQgYmV6aWVycyA9IFtdOwogICAgbGV0IHExID0gb3BzLmF0KGkgLSAyKTsKICAgIGxldCBxMiA9IG9wcy5hdChpIC0gMSk7CiAgICBsZXQgcTMsIHE0OwogICAgbGV0IHAgPSBzcGxpbmVzWzBdOwoKICAgIC8vIFRoZSBmaXJzdCAgc2VnbWVudCBuZWVkcyBzcGVjaWFsIGhhbmRsaW5nIHRvCiAgICAvLyBlbnN1cmUgdGhlIGRlcGFydHVyZSB0YW5nZW50IGlzIGNvcnJlY3QuCiAgICBxMyA9IHNwbGluZXNbMV0gPz8gb3BzWzBdOwogICAgYmV6aWVycy5wdXNoKC4uLnRoaXMuZmlyc3RTcGxpbmVUb0JlemllcihxMSwgcTIsIHAsIHEzLCBvcHMsIGkpKTsKCiAgICAvLyBJbnRlcm1lZGlhdGUgc2VnbWVudHMgYXJlICJub3JtYWwgY29udmVyc2lvbiBtYXRoIi4KICAgIGZvciAobGV0IGogPSAxOyBqIDwgc3BsaW5lcy5sZW5ndGg7IGorKykgewogICAgICBxMSA9IHEyOwogICAgICBxMiA9IHA7CiAgICAgIHAgPSBzcGxpbmVzW2pdOwogICAgICBxMyA9IHNwbGluZXNbaiArIDFdID8/IG9wc1tpXSA/PyBvcHNbMF07CiAgICAgIGJlemllcnMucHVzaCguLi50aGlzLmZ1bGxTcGxpbmVUb0JlemllcihxMSwgcTIsIHAsIHEzLCBvcHMsIGkpKTsKICAgIH0KCiAgICAvLyBUaGUgbGFzdCBzZWdtZW50IG5lZWRzIHNwZWNpYWwgaGFuZGxpbmcgdG8KICAgIC8vIGVuc3VyZSB0aGUgYXJyaXZhbCB0YW5nZW50IGlzIGNvcnJlY3QuCiAgICBxMyA9IG9wc1tpXSA/PyBvcHNbMF07CiAgICBxNCA9IG9wc1tpICsgMV0gPz8gb3BzWzFdOwogICAgYmV6aWVycy5wdXNoKC4uLnRoaXMubGFzdFNwbGluZVRvQmV6aWVyKHEyLCBwLCBxMywgcTQsIG9wcywgaSkpOwoKICAgIHJldHVybiBiZXppZXJzOwogIH0KCiAgLy8gcDMgaXMgb3VyIHByaW5jaXBhbCBwb2ludAogIGZpcnN0U3BsaW5lVG9CZXppZXIocDEsIHAyLCBwMywgcDQsIG9wcywgaSkgewogICAgLy8gUmVwb3NpdGlvbiBwMSBzbyB0aGF0IHRoZSB0YW5nZW50IGF0CiAgICAvLyBwMiB3aWxsIG1hdGNoIHRoZSBhY3R1YWwgdGFuZ2VudCBhdCBwMi4KICAgIHAxID0gdGhpcy51cGRhdGVGcm9tVGFuZ2VudChwMSwgcDIsIHAzKTsKICAgIHJldHVybiB0aGlzLmZ1bGxTcGxpbmVUb0JlemllcihwMSwgcDIsIHAzLCBwNCwgb3BzLCBpKTsKICB9CgogIC8vIHAyIGlzIG91ciBwcmluY2lwYWwgcG9pbnQKICBsYXN0U3BsaW5lVG9CZXppZXIocDEsIHAyLCBwMywgcDQsIG9wcywgaSkgewogICAgLy8gUmVwb3NpdGlvbiBwNCBzbyB0aGF0IHRoZSB0YW5nZW50IGF0CiAgICAvLyBwMyB3aWxsIG1hdGNoIHRoZSBhY3R1YWwgdGFuZ2VudCBhdCBwMy4KICAgIHA0ID0gdGhpcy51cGRhdGVGcm9tVGFuZ2VudChwNCwgcDMsIHAyKTsKICAgIHJldHVybiB0aGlzLmZ1bGxTcGxpbmVUb0JlemllcihwMSwgcDIsIHAzLCBwNCwgb3BzLCBpKTsKICB9CgogIC8vIGNyZWF0ZSB0aGUgQmV6aWVyIGVxdWl2YWxlbnQgb2YgcDItLXAzCiAgZnVsbFNwbGluZVRvQmV6aWVyKHAxLCBwMiwgcDMsIHA0LCBvcHMsIGkpIHsKICAgIGNvbnN0IFQgPSBwMy5UID8/IHAyLlQgPz8gMTsKICAgIGNvbnN0IHRlbnNpb24gPSA2ICogVDsKICAgIHJldHVybiBbCiAgICAgIHsKICAgICAgICBiZXppZXI6IHRydWUsCiAgICAgICAgeDogcDIueCArIChwMy54IC0gcDEueCkgLyB0ZW5zaW9uLAogICAgICAgIHk6IHAyLnkgKyAocDMueSAtIHAxLnkpIC8gdGVuc2lvbiwKICAgICAgfSwKICAgICAgewogICAgICAgIGJlemllcjogdHJ1ZSwKICAgICAgICB4OiBwMy54IC0gKHA0LnggLSBwMi54KSAvIHRlbnNpb24sCiAgICAgICAgeTogcDMueSAtIChwNC55IC0gcDIueSkgLyB0ZW5zaW9uLAogICAgICB9LAogICAgICB7IGJlemllcjogdHJ1ZSwgeDogcDMueCwgeTogcDMueSB9LAogICAgXTsKICB9CgogIHVwZGF0ZUZyb21UYW5nZW50KHExLCBxMiwgcDMpIHsKICAgIC8vIE5vIG1hdHRlciB3aGV0aGVyIHExIGFuZCBxMiBhcmUgbGluZSBvcgogICAgLy8gYmV6aWVyIGNvb3JkaW5hdGVzLCB0aGUgbG9naWMgaXMgdGhlIHNhbWUuCiAgICByZXR1cm4gewogICAgICB0YW5nZW50Q29ycmVjdGlvbjogdHJ1ZSwKICAgICAgeDogcDMueCArIChxMS54IC0gcTIueCksCiAgICAgIHk6IHAzLnkgKyAocTEueSAtIHEyLnkpLAogICAgfTsKICB9Cn0KCi8qKgogKiAuLi5kb2NzIGdvIGhlcmUuLi4KICovCmNsYXNzIFNoYXBlIHsKICBzZWdtZW50cyA9IFtdOwogIHJlc2l6YWJsZSA9IGZhbHNlOwogIG94ID0gMDsKICBveSA9IDA7CgogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5uZXdTZWdtZW50KCk7CiAgfQoKICBtYWtlTW92YWJsZShtb3ZhYmxlID0gdHJ1ZSkgewogICAgaWYgKG1vdmFibGUpIHsKICAgICAgc2V0TW92YWJsZSh0aGlzKTsKICAgIH0gZWxzZSB7CiAgICAgIHVuc2V0TW92YWJsZSh0aGlzKTsKICAgIH0KICB9CgogIGFsbG93UmVzaXppbmcoYWxsb3dlZCA9IHRydWUpIHsKICAgIHRoaXMucmVzaXphYmxlID0gYWxsb3dlZDsKICB9CgogIGNsb3NlKCkgewogICAgdGhpcy5uZXdTZWdtZW50KHRydWUpOwogIH0KCiAgbmV3U2VnbWVudChjbG9zZUN1cnJlbnQgPSBmYWxzZSkgewogICAgY29uc3QgeyBzZWdtZW50cyB9ID0gdGhpczsKICAgIGlmIChzZWdtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHNlZ21lbnRzLnB1c2gobmV3IFNlZ21lbnQoKSk7CiAgICB9CiAgICBjb25zdCBjdXJyZW50ID0gc2VnbWVudHMuYXQoLTEpOwogICAgaWYgKGN1cnJlbnQ/LnBvaW50cy5sZW5ndGggfHwgY3VycmVudD8uaW5zdHJ1Y3Rpb25zLmxlbmd0aCkgewogICAgICBpZiAoY2xvc2VDdXJyZW50KSBjdXJyZW50LmNsb3NlKCk7CiAgICAgIHNlZ21lbnRzLnB1c2gobmV3IFNlZ21lbnQoKSk7CiAgICB9CiAgfQoKICBhZGQoeCwgeSkgewogICAgY29uc3Qgc2VnbWVudCA9IHRoaXMuc2VnbWVudHMuYXQoLTEpOwogICAgbGV0IHB0czsKICAgIGlmIChzZWdtZW50Lmluc3RydWN0aW9ucy5sZW5ndGgpIHsKICAgICAgcHRzID0gc2VnbWVudC5saW5lVG8oeCwgeSk7CiAgICB9IGVsc2UgewogICAgICBwdHMgPSBzZWdtZW50Lm1vdmVUbyh4LCB5KTsKICAgIH0KICAgIHRoaXMucmVjb3JkUG9pbnRzKHB0cyk7CiAgfQoKICByZWNvcmRQb2ludHMocHRzKSB7CiAgICBjb25zdCBzZWdtZW50ID0gdGhpcy5zZWdtZW50cy5hdCgtMSk7CiAgICBpZiAodGhpcy5yZXNpemFibGUpIHsKICAgICAgcHRzLmZvckVhY2goKHApID0+IHsKICAgICAgICBwLl9fb25fbW92ZSA9ICgpID0+IHsKICAgICAgICAgIHNlZ21lbnQuaW52YWxpZGF0ZSgpOwogICAgICAgICAgdGhpcy5pbnZhbGlkYXRlKCk7CiAgICAgICAgfTsKICAgICAgICBzZXRNb3ZhYmxlKHApOwogICAgICB9KTsKICAgIH0KICAgIHRoaXMuYnVpbGRJbWFnZSgpOwogIH0KCiAgbW92ZVRvKHgsIHkpIHsKICAgIHRoaXMubmV3U2VnbWVudCgpOwogICAgdGhpcy5yZWNvcmRQb2ludHModGhpcy5zZWdtZW50cy5hdCgtMSkubW92ZVRvKHgsIHkpKTsKICB9CgogIGxpbmVUbyguLi5hcmdzKSB7CiAgICB0aGlzLnJlY29yZFBvaW50cyh0aGlzLnNlZ21lbnRzLmF0KC0xKT8ubGluZVRvKC4uLmFyZ3MpKTsKICB9CgogIGN1cnZlVG8oLi4uYXJncykgewogICAgdGhpcy5yZWNvcmRQb2ludHModGhpcy5zZWdtZW50cy5hdCgtMSk/LmN1cnZlVG8oLi4uYXJncykpOwogIH0KCiAgcXVhZFRvKC4uLmFyZ3MpIHsKICAgIHRoaXMucmVjb3JkUG9pbnRzKHRoaXMuc2VnbWVudHMuYXQoLTEpPy5xdWFkVG8oLi4uYXJncykpOwogIH0KCiAgc3BsaW5lVG8oLi4uYXJncykgewogICAgdGhpcy5yZWNvcmRQb2ludHModGhpcy5zZWdtZW50cy5hdCgtMSk/LnNwbGluZVRvKC4uLmFyZ3MpKTsKICB9CgogIG9mZnNldCh4LCB5KSB7CiAgICB0aGlzLm94ID0geDsKICAgIHRoaXMub3kgPSB5OwogIH0KCiAgb2Zmc2V0U2VnbWVudChzZWdtZW50SWQsIHgsIHkpIHsKICAgIGNvbnN0IHNlZ21lbnQgPSB0aGlzLnNlZ21lbnRzW3NlZ21lbnRJZF07CiAgICBzZWdtZW50Lm9mZnNldCh4LCB5KTsKICB9CgogIGNvbW1pdCgpIHsKICAgIGNvbnN0IHsgc2VnbWVudHMsIG94LCBveSB9ID0gdGhpczsKICAgIHNlZ21lbnRzLmZvckVhY2goKHApID0+IHAuY29tbWl0KG94LCBveSkpOwogICAgdGhpcy5veCA9IHRoaXMub3kgPSAwOwogICAgLy8gcmVidWlsZCBzbyBpdCdzIHJlYWR5IGJ5IHRoZSBuZXh0IHJlZHJhdwogICAgdGhpcy5idWlsZEltYWdlKCk7CiAgfQoKICByZXNldCgpIHsKICAgIHRoaXMub3ggPSAwOwogICAgdGhpcy5veSA9IDA7CiAgICAvLyByZWJ1aWxkIHNvIGl0J3MgcmVhZHkgYnkgdGhlIG5leHQgcmVkcmF3CiAgICB0aGlzLmJ1aWxkSW1hZ2UoKTsKICB9CgogIG5vRmlsbCgpIHsKICAgIHRoaXMuc2V0RmlsbChgbm9uZWApOwogIH0KCiAgc2V0RmlsbChmaWxsKSB7CiAgICBpZiAodGhpcy5maWxsU3R5bGUgIT09IGZpbGwpIHsKICAgICAgdGhpcy5maWxsU3R5bGUgPSBmaWxsOwogICAgICB0aGlzLmJ1aWxkSW1hZ2UoKTsKICAgIH0KICB9CgogIG5vU3Ryb2tlKCkgewogICAgdGhpcy5zZXRTdHJva2UoYG5vbmVgKTsKICB9CgogIHNldFN0cm9rZShzdHJva2UpIHsKICAgIGlmICh0aGlzLnN0cm9rZVN0eWxlICE9PSBzdHJva2UpIHsKICAgICAgdGhpcy5zdHJva2VTdHlsZSA9IHN0cm9rZTsKICAgICAgdGhpcy5idWlsZEltYWdlKCk7CiAgICB9CiAgfQoKICBpbnZhbGlkYXRlKCkgewogICAgdGhpcy5fY2FjaGVkX2ltYWdlID0gZmFsc2U7CiAgfQoKICBidWlsZEltYWdlKCkgewogICAgY29uc3QgeyBzaG93UG9pbnRzLCBmaWxsU3R5bGUsIHN0cm9rZVN0eWxlIH0gPSB0aGlzOwogICAgY29uc3Qgc3ZnID0gYDw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ij8+Cjxzdmcgd2lkdGg9IiR7d2lkdGh9cHgiIGhlaWdodD0iJHtoZWlnaHR9cHgiIHZpZXdCb3g9Ii0ke3dpZHRofSAtJHtoZWlnaHR9ICR7MyAqIHdpZHRofSAkezMgKiBoZWlnaHR9IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMCI+CiAgJHt0aGlzLnNlZ21lbnRzLm1hcCgocykgPT4gcy5nZXRTVkcoc2hvd1BvaW50cywgZmlsbFN0eWxlLCBzdHJva2VTdHlsZSkpfQo8L3N2Zz5gOwogICAgY29uc3QgaW1nID0gKHRoaXMuX2NhY2hlZF9pbWFnZSA9IG5ldyBJbWFnZSgpKTsKICAgIGltZy5sb2FkZWQgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICBpbWcub25sb2FkID0gKCkgPT4gcmVzb2x2ZSh0cnVlKTsKICAgIH0pOwogICAgaW1nLnNyYyA9IGBkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCR7YnRvYShzdmcpfWA7CiAgfQoKICBzaG93UG9pbnRzKHNob3dQb2ludHMgPSB0cnVlKSB7CiAgICBpZiAodGhpcy5zaG93UG9pbnRzICE9PSBzaG93UG9pbnRzKSB7CiAgICAgIHRoaXMuc2hvd1BvaW50cyA9IHNob3dQb2ludHM7CiAgICAgIHRoaXMuYnVpbGRJbWFnZSgpOwogICAgfQogIH0KCiAgYXN5bmMgZHJhdygpIHsKICAgIGlmICghdGhpcy5fY2FjaGVkX2ltYWdlKSB0aGlzLmJ1aWxkSW1hZ2UoKTsKICAgIGNvbnN0IHsgb3gsIG95LCBfY2FjaGVkX2ltYWdlIH0gPSB0aGlzOwogICAgYXdhaXQgX2NhY2hlZF9pbWFnZS5sb2FkZWQ7CiAgICBpbWFnZShfY2FjaGVkX2ltYWdlLCBveCAtIHdpZHRoLCBveSAtIGhlaWdodCwgMyAqIHdpZHRoLCAzICogaGVpZ2h0KTsKICB9CgogIGluc2lkZSh4LCB5KSB7CiAgICBjb25zdCB7IHNlZ21lbnRzLCBveCwgb3kgfSA9IHRoaXM7CiAgICByZXR1cm4gc2VnbWVudHMKICAgICAgLm1hcCgocywgaWQpID0+IHsKICAgICAgICBzLmlkID0gaWQ7CiAgICAgICAgcmV0dXJuIHM7CiAgICAgIH0pCiAgICAgIC5maWx0ZXIoKHMpID0+IHMuaW5zaWRlKHggLSBveCwgeSAtIG95KSk7CiAgfQp9CmNsYXNzIFZlY3RvciB7CiAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHsKICAgICAgeiA9IHguejsKICAgICAgeSA9IHgueTsKICAgICAgeCA9IHgueDsKICAgIH0KICAgIHRoaXMueCA9IHg7CiAgICB0aGlzLnkgPSB5OwogICAgaWYgKHogIT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLnogPSB6OwogICAgfQogIH0KCiAgZGlzdChvdGhlciwgeSwgeiA9IDApIHsKICAgIGlmICh5ICE9PSB1bmRlZmluZWQpIG90aGVyID0geyB4OiBvdGhlciwgeSwgeiB9OwogICAgbGV0IHN1bSA9IDA7CiAgICBzdW0gKz0gKHRoaXMueCAtIG90aGVyLngpICoqIDI7CiAgICBzdW0gKz0gKHRoaXMueSAtIG90aGVyLnkpICoqIDI7CiAgICBsZXQgejEgPSB0aGlzLnogPyB0aGlzLnogOiAwOwogICAgbGV0IHoyID0gb3RoZXIueiA/IG90aGVyLnogOiAwOwogICAgc3VtICs9ICh6MSAtIHoyKSAqKiAyOwogICAgcmV0dXJuIHN1bSAqKiAwLjU7CiAgfQoKICBub3JtYWxpemUoZikgewogICAgbGV0IG1hZyA9IHRoaXMuZGlzdCgwLCAwLCAwKTsKICAgIHJldHVybiBuZXcgVmVjdG9yKAogICAgICAoZiAqIHRoaXMueCkgLyBtYWcsCiAgICAgIChmICogdGhpcy55KSAvIG1hZywKICAgICAgKGYgKiB0aGlzLnopIC8gbWFnCiAgICApOwogIH0KCiAgZ2V0QW5nbGUoKSB7CiAgICByZXR1cm4gLU1hdGguYXRhbjIodGhpcy55LCB0aGlzLngpOwogIH0KCiAgcmVmbGVjdChvdGhlcikgewogICAgbGV0IHAgPSBuZXcgVmVjdG9yKG90aGVyLnggLSB0aGlzLngsIG90aGVyLnkgLSB0aGlzLnkpOwogICAgaWYgKG90aGVyLnogIT09IHVuZGVmaW5lZCkgewogICAgICBwLnogPSBvdGhlci56OwogICAgICBpZiAodGhpcy56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBwLnogLT0gdGhpcy56OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5zdWJ0cmFjdChwKTsKICB9CgogIGFkZChvdGhlcikgewogICAgbGV0IHAgPSBuZXcgVmVjdG9yKHRoaXMueCArIG90aGVyLngsIHRoaXMueSArIG90aGVyLnkpOwogICAgaWYgKHRoaXMueiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHAueiA9IHRoaXMuejsKICAgICAgaWYgKG90aGVyLnogIT09IHVuZGVmaW5lZCkgewogICAgICAgIHAueiArPSBvdGhlci56OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcDsKICB9CgogIHN1YnRyYWN0KG90aGVyKSB7CiAgICBsZXQgcCA9IG5ldyBWZWN0b3IodGhpcy54IC0gb3RoZXIueCwgdGhpcy55IC0gb3RoZXIueSk7CiAgICBpZiAodGhpcy56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcC56ID0gdGhpcy56OwogICAgICBpZiAob3RoZXIueiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcC56IC09IG90aGVyLno7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwOwogIH0KCiAgc2NhbGUoZiA9IDEpIHsKICAgIGlmIChmID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgVmVjdG9yKDAsIDAsIHRoaXMueiA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogMCk7CiAgICB9CiAgICBsZXQgcCA9IG5ldyBWZWN0b3IodGhpcy54ICogZiwgdGhpcy55ICogZik7CiAgICBpZiAodGhpcy56ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcC56ID0gdGhpcy56ICogZjsKICAgIH0KICAgIHJldHVybiBwOwogIH0KfQo="),R=class extends h{static{l(this,"GraphicsElement")}set onload(e){this._onload=e}set onerror(e){this._onerror=e}handleAttributeChange(...e){}handleChildChanges(...e){}connectedCallback(){super.connectedCallback(),this.label=document.createElement("label"),this.title||(console.warn("<graphics-element> is missing a title attribute. Always caption your figures."),this.title=""),this.label.textContent=this.title,M(this)?this.loadSource():new IntersectionObserver((e,x)=>e.forEach(t=>{t.isIntersecting&&(this.loadSource(),x.disconnect())}),{threshold:.1,rootMargin:`${window.innerHeight}px`}).observe(this)}getStyle(){return`
>>>>>>> 74accf2 (looking good.)
:host([hidden]) { display: none; }
style { display: none; }
.top-title { display: flex; flex-direction: row; justify-content: space-between; }
canvas { touch-action: none; user-select: none; position: relative; z-index: 1; display: block; margin: auto; border-radius: 0; box-sizing: content-box !important; border: 1px solid lightgrey;
&.crisp { image-rendering: -moz-crisp-edges; image-rendering: -webkit-crisp-edges; image-rendering: pixelated; image-rendering: crisp-edges; }
&:focus { border: 1px solid red; }}
a { &.view-source { font-size: 60%; text-decoration: none;
&.plus { padding-left: 0.5em; }}}
button.reset { font-size: 0.5em; top: -0.35em; position: relative; }
label:not(:empty) { display: block; font-style: italic; font-size: 0.9em; text-align: right; padding-right: 1em; margin-top: 0.35em; }
`}async loadSource(e,x=this.width,t=this.height,$){if(!x&&!t&&(x=parseFloat(this.getAttribute("width")),t=parseFloat(this.getAttribute("height")),isNaN(x)&&(x=void 0),isNaN(t)&&(t=void 0)),e){if(typeof e=="function")return console.warn(".loadSource() called with a function rather than string data: use .loadFromFunction() instead."),this.loadFromFunction(e)}else if(this.userCode)e=this.userCode;else{let a=this.getAttribute("src");if(a)e=await(await fetch(a)).text();else{let o=this.querySelector("graphics-source");o?e=o.textContent:e=`function setup() {
}
function draw() {
}
`}}if(this.userCode=e,!$)if(this.additionalSources)$=this.additionalSources;else{let a=this.querySelectorAll("source");$=await Promise.all(Array.from(a).map(o=>fetch(o.src).then(g=>g.text())))}this.additionalSources=$;let r=this.userCode;this.additionalSources.length>0&&(r=this.loadAdditionalSources(this.userCode,this.additionalSources));let E=r.matchAll(/addSlider\(['"`](.*)['"`]/g),i=[];for(let a of E)i.push(a[1]),r=r.replace(a[0],a[0]+`, (v) => (${a[1]} = v)`);if(i.length&&(r="let "+i.join(", ")+`;
`+r),r=r.replaceAll(/ from ['"].([^'"]+)['"]/g,` from "${C(location.href)}/$1"`),r.includes("function setup()")||(r=`function setup() {
}
`+r),!r.includes("setSize(")){let a="setSize();";x&&t&&(a=`setSize(${x}, ${t});`),r=r.replace("function setup() {",`function setup() {
  ${a}`)}let s=Object.entries(this.dataset);s.length&&s.forEach(([a,o])=>{parseFloat(o)!=o&&o!=="true"&&o!=="false"&&(o=`"${o}"`),r=r.replace("function setup() {",`function setup() {
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
  ${a} = ${o};`)}),import(`data:text/javascript;base64,${I(['"use strict";',`import { BSpline, CSS_COLOR_MAP } from "${k}";`,`const __randomId = "${Date.now()}";`,B,r,"export { reset as start, __canvas as canvas, halt, highlight, __getDescription as getDescription }"].join(`
=======
  ${a} = ${o};`)}),import(`data:text/javascript;base64,${I(['"use strict";',`import { BSpline, CSS_COLOR_MAP } from "${k}";`,`const __randomId = "${Date.now()}";`,B,r,`export {
  __reset as start,
  __canvas as canvas,
  __halt as halt,
  highlight,
  __getDescription as getDescription
}`].join(`
>>>>>>> 74accf2 (looking good.)
`))}`).then(async a=>{let{start:o,canvas:g,halt:d,highlight:A,getDescription:p}=a;this.canvas=g,this.halt=()=>d(),this.highlight=H=>A(H),this.render();let{width:b,height:u}=await o(this),m="graphics-element-description";this.querySelector(`.${m}`)?.remove(),this.querySelector("p")||this.handleGraphicsDescription(m,p),b&&u&&(this.style.width="",this.style.height="",this.width=b,this.height=u,this.setAttribute("width",b),this.setAttribute("height",u));let D=new CustomEvent("load");this.dispatchEvent(D),this._onload&&this._onload(D)}).catch(a=>{let o=new CustomEvent("error",{detail:a});if(this.dispatchEvent(o),this._onerror)this._onerror(a);else throw a})}handleGraphicsDescription(e,x=()=>{}){try{let t=x();if(t){let $=new DocumentFragment,r=document.createElement("div");r.classList.add(e),$.append(r),r.innerHTML=t,this.append(r),this.crossLink(!0)}}catch(t){console.error(t)}}loadAdditionalSources(e,x){if(!x)return e;let t=new Array(x.length);return e+`
=======
  ${a} = ${o};`)}),import(`data:text/javascript;base64,${p(['"use strict";',`import { BSpline, CSS_COLOR_MAP } from "${k}";`,`const __randomId = "${Date.now()}";`,B,r,"export { reset as start, __canvas as canvas, halt, highlight, __getDescription as getDescription }"].join(`
`))}`).then(async a=>{let{start:o,canvas:g,halt:d,highlight:L,getDescription:R}=a;this.canvas=g,this.halt=()=>d(),this.highlight=H=>L(H),this.render();let{width:b,height:u}=await o(this),A="graphics-element-description";this.querySelector(`.${A}`)?.remove(),this.querySelector("p")||this.handleGraphicsDescription(A,R),b&&u&&(this.style.width="",this.style.height="",this.width=b,this.height=u,this.setAttribute("width",b),this.setAttribute("height",u));let D=new CustomEvent("load");this.dispatchEvent(D),this._onload&&this._onload(D)}).catch(a=>{let o=new CustomEvent("error",{detail:a});if(this.dispatchEvent(o),this._onerror)this._onerror(a);else throw a})}handleGraphicsDescription(e,x=()=>{}){try{let t=x();if(t){let $=new DocumentFragment,r=document.createElement("div");r.classList.add(e),$.append(r),r.innerHTML=t,this.append(r),this.crossLink(!0)}}catch(t){console.error(t)}}loadAdditionalSources(e,x){if(!x)return e;let t=new Array(x.length);return e+`
>>>>>>> 4055541 (SVG-backed shapes)
=======
  ${a} = ${o};`)}),import(`data:text/javascript;base64,${I(['"use strict";',`import { BSpline, CSS_COLOR_MAP } from "${k}";`,`const __randomId = "${Date.now()}";`,B,r,"export { reset as start, __canvas as canvas, halt, highlight, __getDescription as getDescription }"].join(`
`))}`).then(async a=>{let{start:o,canvas:g,halt:d,highlight:A,getDescription:p}=a;this.canvas=g,this.halt=()=>d(),this.highlight=H=>A(H),this.render();let{width:b,height:u}=await o(this),m="graphics-element-description";this.querySelector(`.${m}`)?.remove(),this.querySelector("p")||this.handleGraphicsDescription(m,p),b&&u&&(this.style.width="",this.style.height="",this.width=b,this.height=u,this.setAttribute("width",b),this.setAttribute("height",u));let D=new CustomEvent("load");this.dispatchEvent(D),this._onload&&this._onload(D)}).catch(a=>{let o=new CustomEvent("error",{detail:a});if(this.dispatchEvent(o),this._onerror)this._onerror(a);else throw a})}handleGraphicsDescription(e,x=()=>{}){try{let t=x();if(t){let $=new DocumentFragment,r=document.createElement("div");r.classList.add(e),$.append(r),r.innerHTML=t,this.append(r),this.crossLink(!0)}}catch(t){console.error(t)}}loadAdditionalSources(e,x){if(!x)return e;let t=new Array(x.length);return e+`
>>>>>>> afd0eea (had an idea)
`+x.map(($,r)=>$.replace("function setup()",`function setup${r+1}()`).replace("function draw()",`function draw${r+1}()`)).join(`
`)+`
function __more_setup() { ${[...t].map(($,r)=>`if (typeof setup${r+1} !== \`undefined\`) setup${r+1}();`).join(`
`)} }
function __more_draw() { ${[...t].map(($,r)=>`if (typeof draw${r+1} !== \`undefined\`) draw${r+1}();`).join(`
`)} }
`}loadFromFunction(e){let x=e.toString();this.reset(x.substring(x.indexOf("{")+1,x.lastIndexOf("}")))}reset(e,x=[]){this.halt&&this.halt(),this.querySelector("button.remove-color")?.remove(),this.loadSource(e||this.userCode,this.width,this.height,x||this.additionalSources)}render(){super.render();let e=this._slot.parentNode;this.canvas&&e.insertBefore(this.canvas,this._slot),this.label&&e.insertBefore(this.label,this._slot);let x=document.createElement("div");x.classList.add("top-title");let t=document.createElement("span");t.classList.add("sources"),x.append(t);let $=document.createElement("button");$.classList.add("reset"),$.textContent=this.getAttribute("reset")||"reset",$.addEventListener("click",()=>this.reset()),x.append($);let r=this.getAttribute("src");if(r||(r=`data:text/plain;base64,${I(this.userCode)}`),r){let i=document.createElement("a");i.classList.add("view-source"),i.textContent=this.getAttribute("viewSource")||"view source",i.href=r,i.target="_blank",t.append(i),r.startsWith("data")&&(delete i.href,delete i.target,i.classList.add("fake-source-link"),i.addEventListener("click",()=>{let s=`<iframe width="100%" height="100%" src="${r}"></iframe>`,f=window.open(""),{document:a}=f;a.open(),a.write(s),a.write("<style>iframe { position: fixed; top: 0; right: 0; bottom: 0; left: 0; border:0; margin: 0; padding:0 }</style>"),a.close()}))}let E=this.querySelectorAll("source");E.length===0&&(E=(this.additionalSources??[]).map(i=>({src:`data:text/plain;base64,${I(i)}`}))),E.length&&E.forEach((i,s)=>{let{src:f}=i,a=document.createElement("a");a.classList.add("view-source","plus"),a.textContent=`[+${s+1}]`,a.href=f,a.target="_blank",t.append(a),f.startsWith("data")&&(delete a.href,delete a.target,a.classList.add("fake-source-link"),a.addEventListener("click",()=>{let o=`<iframe width="100%" height="100%" src="${f}"></iframe>`,g=window.open(""),{document:d}=g;d.open(),d.write(o),d.write("<style>iframe { position: fixed; top: 0; right: 0; bottom: 0; left: 0; border:0; margin: 0; padding:0 }</style>"),d.close()}))}),this.label&&e.insertBefore(x,this.canvas),this.crossLink()}crossLink(e){if(e&&(this.crossLinked=!1),this.crossLinked)return;this.crossLinked=!0;let x=!1;if(this.querySelectorAll("p").forEach(t=>{t.querySelectorAll("*").forEach($=>{if(!O.includes($.tagName))return;x=!0;let r;$.classList.remove("calm"),$.addEventListener("pointerenter",()=>{r??=getComputedStyle($)["-webkit-text-stroke-color"],this.highlight?.(r)}),$.addEventListener("pointerleave",()=>this.highlight?.(!1))})}),x){let t=document.createElement("button");t.textContent="remove colors",t.classList.add("remove-color"),t.addEventListener("click",()=>{this.querySelectorAll("p").forEach($=>{$.querySelectorAll("*").forEach(r=>{O.includes(r.tagName)&&r.classList.add("calm")})}),t.remove()}),this.append(t)}}},N=class extends h{static{l(this,"GraphicsSource")}constructor(){super(),this.style.display="none"}handleAttributeChange(){}handleChildChanges(){}};h.register(R),h.register(N),globalThis.GraphicsElement=R,await customElements.whenDefined("graphics-element"),await customElements.whenDefined("graphics-source");export{L as BSpline,w as CSS_COLOR_MAP,R as GraphicsElement,N as GraphicsSource};
