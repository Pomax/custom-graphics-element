var K=Object.defineProperty;var f=(a,e)=>K(a,"name",{value:e,configurable:!0});var G="registered as custom element";function U(a,e){console.warn(`missing implementation for ${e}(...data) in ${a.__proto__.constructor.name}`)}f(U,"NotImplemented");function C(a){return a.prototype.constructor.name.replace(/([A-Z])([a-z])/g,(e,t,r,$)=>{let x=`${t.toLowerCase()}${r}`;return $>0?`-${x}`:x})}f(C,"getElementTagName");var E=class extends HTMLElement{static{f(this,"CustomElement")}static register(e){if(!e[G]){let t=e.tagName||C(e);return customElements.define(t,e),e[G]=!0,customElements.whenDefined(t)}return Promise.resolve()}static get tagName(){return C(this)}constructor(e={}){super(),customElements.resolveScope||(customElements.resolveScope=function($){try{return $.getRootNode().host}catch(x){console.warn(x)}return window}),this._options=e;let t={childList:$=>{this.handleChildChanges(Array.from($.addedNodes),Array.from($.removedNodes)),this.render()},attributes:$=>{this.handleAttributeChange($.attributeName,$.oldValue,this.getAttribute($.attributeName)),this.render()}};this._observer=new MutationObserver($=>{this.isConnected&&$.forEach(x=>{t[x.type](x)})}),this._observer.observe(this,{childList:!0,attributes:!0});let r={mode:"open"};this._shadow=this.attachShadow(r),this._style=document.createElement("style"),this._style.textContent=this.getStyle(),this._options.header!==!1&&(this._header=document.createElement("header")),this._options.slot!==!1&&this._options.void!==!0&&(this._slot=document.createElement("slot")),this._options.footer!==!1&&(this._footer=document.createElement("footer"))}connectedCallback(){this.render()}handleChildChanges(e,t){this._options.void||U(this,"handleChildChanges")}handleAttributeChange(e,t,r){U(this,"handleAttributeChange")}getStyle(){return""}render(){this._shadow.innerHTML="",this._shadow.append(this._style),this._options.header!==!1&&this._shadow.append(this._header),this._options.slot!==!1&&this._shadow.append(this._slot),this._options.footer!==!1&&this._shadow.append(this._footer)}};var y=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREEN","DARKGREY","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREEN","GREENYELLOW","GREY","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREEN","LIGHTGREY","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TRANSPARENT","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN"],v={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(128, 128, 128)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",transparent:"rgba(0,0,0,0)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",ALICEBLUE:"rgb(240, 248, 255)",ANTIQUEWHITE:"rgb(250, 235, 215)",AQUA:"rgb(0, 255, 255)",AQUAMARINE:"rgb(127, 255, 212)",AZURE:"rgb(240, 255, 255)",BEIGE:"rgb(245, 245, 220)",BISQUE:"rgb(255, 228, 196)",BLACK:"rgb(0, 0, 0)",BLANCHEDALMOND:"rgb(255, 235, 205)",BLUE:"rgb(0, 0, 255)",BLUEVIOLET:"rgb(138, 43, 226)",BROWN:"rgb(165, 42, 42)",BURLYWOOD:"rgb(222, 184, 135)",CADETBLUE:"rgb(95, 158, 160)",CHARTREUSE:"rgb(127, 255, 0)",CHOCOLATE:"rgb(210, 105, 30)",CORAL:"rgb(255, 127, 80)",CORNFLOWERBLUE:"rgb(100, 149, 237)",CORNSILK:"rgb(255, 248, 220)",CRIMSON:"rgb(220, 20, 60)",CYAN:"rgb(0, 255, 255)",DARKBLUE:"rgb(0, 0, 139)",DARKCYAN:"rgb(0, 139, 139)",DARKGOLDENROD:"rgb(184, 134, 11)",DARKGRAY:"rgb(169, 169, 169)",DARKGREEN:"rgb(0, 100, 0)",DARKGREY:"rgb(169, 169, 169)",DARKKHAKI:"rgb(189, 183, 107)",DARKMAGENTA:"rgb(139, 0, 139)",DARKOLIVEGREEN:"rgb(85, 107, 47)",DARKORANGE:"rgb(255, 140, 0)",DARKORCHID:"rgb(153, 50, 204)",DARKRED:"rgb(139, 0, 0)",DARKSALMON:"rgb(233, 150, 122)",DARKSEAGREEN:"rgb(143, 188, 143)",DARKSLATEBLUE:"rgb(72, 61, 139)",DARKSLATEGRAY:"rgb(47, 79, 79)",DARKSLATEGREY:"rgb(47, 79, 79)",DARKTURQUOISE:"rgb(0, 206, 209)",DARKVIOLET:"rgb(148, 0, 211)",DEEPPINK:"rgb(255, 20, 147)",DEEPSKYBLUE:"rgb(0, 191, 255)",DIMGRAY:"rgb(105, 105, 105)",DIMGREY:"rgb(105, 105, 105)",DODGERBLUE:"rgb(30, 144, 255)",FIREBRICK:"rgb(178, 34, 34)",FLORALWHITE:"rgb(255, 250, 240)",FORESTGREEN:"rgb(34, 139, 34)",FUCHSIA:"rgb(255, 0, 255)",GAINSBORO:"rgb(220, 220, 220)",GHOSTWHITE:"rgb(248, 248, 255)",GOLD:"rgb(255, 215, 0)",GOLDENROD:"rgb(218, 165, 32)",GRAY:"rgb(128, 128, 128)",GREEN:"rgb(0, 128, 0)",GREENYELLOW:"rgb(173, 255, 47)",GREY:"rgb(128, 128, 128)",HONEYDEW:"rgb(240, 255, 240)",HOTPINK:"rgb(255, 105, 180)",INDIANRED:"rgb(205, 92, 92)",INDIGO:"rgb(75, 0, 130)",IVORY:"rgb(255, 255, 240)",KHAKI:"rgb(240, 230, 140)",LAVENDER:"rgb(230, 230, 250)",LAVENDERBLUSH:"rgb(255, 240, 245)",LAWNGREEN:"rgb(124, 252, 0)",LEMONCHIFFON:"rgb(255, 250, 205)",LIGHTBLUE:"rgb(173, 216, 230)",LIGHTCORAL:"rgb(240, 128, 128)",LIGHTCYAN:"rgb(224, 255, 255)",LIGHTGOLDENRODYELLOW:"rgb(250, 250, 210)",LIGHTGRAY:"rgb(211, 211, 211)",LIGHTGREEN:"rgb(144, 238, 144)",LIGHTGREY:"rgb(211, 211, 211)",LIGHTPINK:"rgb(255, 182, 193)",LIGHTSALMON:"rgb(255, 160, 122)",LIGHTSEAGREEN:"rgb(32, 178, 170)",LIGHTSKYBLUE:"rgb(135, 206, 250)",LIGHTSLATEGRAY:"rgb(119, 136, 153)",LIGHTSLATEGREY:"rgb(119, 136, 153)",LIGHTSTEELBLUE:"rgb(176, 196, 222)",LIGHTYELLOW:"rgb(255, 255, 224)",LIME:"rgb(0, 255, 0)",LIMEGREEN:"rgb(50, 205, 50)",LINEN:"rgb(250, 240, 230)",MAGENTA:"rgb(255, 0, 255)",MAROON:"rgb(128, 0, 0)",MEDIUMAQUAMARINE:"rgb(102, 205, 170)",MEDIUMBLUE:"rgb(0, 0, 205)",MEDIUMORCHID:"rgb(186, 85, 211)",MEDIUMPURPLE:"rgb(147, 112, 219)",MEDIUMSEAGREEN:"rgb(60, 179, 113)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",MEDIUMSPRINGGREEN:"rgb(0, 250, 154)",MEDIUMTURQUOISE:"rgb(72, 209, 204)",MEDIUMVIOLETRED:"rgb(199, 21, 133)",MIDNIGHTBLUE:"rgb(25, 25, 112)",MINTCREAM:"rgb(245, 255, 250)",MISTYROSE:"rgb(255, 228, 225)",MOCCASIN:"rgb(255, 228, 181)",NAVAJOWHITE:"rgb(255, 222, 173)",NAVY:"rgb(0, 0, 128)",OLDLACE:"rgb(253, 245, 230)",OLIVE:"rgb(128, 128, 0)",OLIVEDRAB:"rgb(107, 142, 35)",ORANGE:"rgb(255, 165, 0)",ORANGERED:"rgb(255, 69, 0)",ORCHID:"rgb(218, 112, 214)",PALEGOLDENROD:"rgb(238, 232, 170)",PALEGREEN:"rgb(152, 251, 152)",PALETURQUOISE:"rgb(175, 238, 238)",PALEVIOLETRED:"rgb(219, 112, 147)",PAPAYAWHIP:"rgb(255, 239, 213)",PEACHPUFF:"rgb(255, 218, 185)",PERU:"rgb(205, 133, 63)",PINK:"rgb(255, 192, 203)",PLUM:"rgb(221, 160, 221)",POWDERBLUE:"rgb(176, 224, 230)",PURPLE:"rgb(128, 0, 128)",REBECCAPURPLE:"rgb(102, 51, 153)",RED:"rgb(255, 0, 0)",ROSYBROWN:"rgb(188, 143, 143)",ROYALBLUE:"rgb(65, 105, 225)",SADDLEBROWN:"rgb(139, 69, 19)",SALMON:"rgb(250, 128, 114)",SANDYBROWN:"rgb(244, 164, 96)",SEAGREEN:"rgb(46, 139, 87)",SEASHELL:"rgb(255, 245, 238)",SIENNA:"rgb(160, 82, 45)",SILVER:"rgb(192, 192, 192)",SKYBLUE:"rgb(135, 206, 235)",SLATEBLUE:"rgb(106, 90, 205)",SLATEGRAY:"rgb(112, 128, 144)",SLATEGREY:"rgb(112, 128, 144)",SNOW:"rgb(255, 250, 250)",SPRINGGREEN:"rgb(0, 255, 127)",STEELBLUE:"rgb(70, 130, 180)",TAN:"rgb(210, 180, 140)",TEAL:"rgb(0, 128, 128)",THISTLE:"rgb(216, 191, 216)",TOMATO:"rgb(255, 99, 71)",TRANSPARENT:"rgba(0,0,0,0)",TURQUOISE:"rgb(64, 224, 208)",VIOLET:"rgb(238, 130, 238)",WHEAT:"rgb(245, 222, 179)",WHITE:"rgb(255, 255, 255)",WHITESMOKE:"rgb(245, 245, 245)",YELLOW:"rgb(255, 255, 0)",YELLOWGREEN:"rgb(154, 205, 50)"};function D(a,e,t,r,$,A,l){var i,n,s,o,g=t.length,c=t[0].length;if(e<1)throw new Error("degree must be at least 1 (linear)");if(e>g-1)throw new Error("degree must be less than or equal to point count - 1");if(!$)for($=[],i=0;i<g;i++)$[i]=1;if($.length<t.length&&($=$.concat($.slice(0,e))),r){if(r.length!==g+e+1)throw new Error("bad knot vector length")}else{var r=[];for(i=0;i<g+e+1;i++)r[i]=i}r.length===t.length&&(r=r.concat(r.slice(0,e)));var b=[e,r.length-1-e],L=r[b[0]],u=r[b[1]];if(l||(a=a*(u-L)+L),a<L||a>u)throw new Error("out of bounds");for(s=b[0];s<b[1]&&!(a>=r[s]&&a<=r[s+1]);s++);var d=[];for(i=0;i<g;i++){for(d[i]=[],n=0;n<c;n++)d[i][n]=t[i][n]*$[i];d[i][c]=$[i]}var m;for(o=1;o<=e+1;o++)for(i=s;i>s-e-1+o;i--)for(m=(a-r[i])/(r[i+e+1-o]-r[i]),n=0;n<c+1;n++)d[i][n]=(1-m)*d[i-1][n]+m*d[i][n];var A=A||[];for(i=0;i<c;i++)A[i]=d[s][i]/d[s][c];return A}f(D,"interpolate");var h=3,p=class{static{f(this,"BSpline")}constructor(e,t=!0){this.points=e,this.points=e.map(r=>r instanceof Array?r:[r.x,r.y]),this.formKnots(t),this.formWeights()}getLUT(e=100){let t=e-1;return[...new Array(e)].map((r,$)=>{let x=D($/t,h,this.points,this.knots,this.weights);return{x:x[0],y:x[1]}})}formKnots(e=!1){if(!e)return this.formUniformKnots();let t=[],r=this.points.length,$=r-h;for(let x=1;x<r-h;x++)t.push(x+h);for(let x=0;x<=h;x++)t=[h].concat(t);for(let x=0;x<=h;x++)t.push($+h);return this.knots=t}formUniformKnots(){return this.knots=[...new Array(this.points.length+h+1)].map((e,t)=>t)}formWeights(){return this.weights=this.points.map(e=>1)}};var R=class{static{f(this,"Point")}constructor(e,t){this.x=e,this.y=t}},O=class extends R{static{f(this,"Circle")}constructor(e,t,r){super(e,t),this.r=r}};var I=class a{static{f(this,"Vector")}constructor(e,t,r){arguments.length===1&&(r=e.z,t=e.y,e=e.x),this.x=e,this.y=t,r!==void 0&&(this.z=r)}dist(e,t,r=0){t!==void 0&&(e={x:e,y:t,z:r});let $=0;$+=(this.x-e.x)**2,$+=(this.y-e.y)**2;let x=this.z?this.z:0,l=e.z?e.z:0;return $+=(x-l)**2,$**.5}normalize(e){let t=this.dist(0,0,0);return new a(e*this.x/t,e*this.y/t,e*this.z/t)}getAngle(){return-Math.atan2(this.y,this.x)}reflect(e){let t=new a(e.x-this.x,e.y-this.y);return e.z!==void 0&&(t.z=e.z,this.z!==void 0&&(t.z-=this.z)),this.subtract(t)}add(e){let t=new a(this.x+e.x,this.y+e.y);return this.z!==void 0&&(t.z=this.z,e.z!==void 0&&(t.z+=e.z)),t}subtract(e){let t=new a(this.x-e.x,this.y-e.y);return this.z!==void 0&&(t.z=this.z,e.z!==void 0&&(t.z-=e.z)),t}scale(e=1){if(e===0)return new a(0,0,this.z===void 0?void 0:0);let t=new a(this.x*e,this.y*e);return this.z!==void 0&&(t.z=this.z*e),t}};function Y(a){if(a.length!==a[0].length){console.warn("Cannot invert non-square matrices");return}var e=0,t=0,r=0,$=a.length,x=0,l=0,i=[],n=[];for(e=0;e<$;e+=1)for(i[i.length]=[],n[n.length]=[],r=0;r<$;r+=1)e==r?i[e][r]=1:i[e][r]=0,n[e][r]=a[e][r];for(e=0;e<$;e+=1){if(x=n[e][e],x==0){for(t=e+1;t<$;t+=1)if(n[t][e]!=0){for(r=0;r<$;r++)x=n[e][r],n[e][r]=n[t][r],n[t][r]=x,x=i[e][r],i[e][r]=i[t][r],i[t][r]=x;break}if(x=n[e][e],x==0)return}for(r=0;r<$;r++)n[e][r]=n[e][r]/x,i[e][r]=i[e][r]/x;for(t=0;t<$;t++)if(t!=e)for(x=n[t][e],r=0;r<$;r++)n[t][r]-=x*n[e][r],i[t][r]-=x*i[e][r]}return i}f(Y,"invert");function P(a,e){var t=[],r=M(e);return a.forEach(($,x)=>{t[x]=[],r.forEach((l,i)=>{t[x][i]=$.map((n,s)=>l[s]*n).reduce((n,s)=>n+s,0)})}),t}f(P,"multiply");function M(a){return a[0].map((e,t)=>a.map(r=>r[t]))}f(M,"transpose");var N=class a{static{f(this,"Matrix")}constructor(e,t,r){r=e instanceof Array?e:r,this.data=r??[...new Array(e)].map($=>[...new Array(t)].map(x=>0)),this.rows=this.data.length,this.cols=this.data[0].length}setData(e){this.data=e}get(e,t){return this.data[e][t]}set(e,t,r){this.data[e][t]=r}row(e){return this.data[e]}col(e){var t=this.data,r=[];for(let $=0,x=t.length;$<x;$++)r.push(t[$][e]);return r}multiply(e){return new a(P(this.data,e.data))}invert(){return new a(Y(this.data))}transpose(){return new a(M(this.data))}};function S(a){let e=new TextEncoder().encode(a),t=String.fromCodePoint(...e);return btoa(t)}f(S,"base64");function H(a){let e=atob(a),t=Uint8Array.from(e,r=>r.codePointAt(0));return new TextDecoder().decode(t)}f(H,"decode64");function k(a){let e=/^(.*)\/([^.]+(\.([^\/?#]+))+)(\?[^#]*)?(#.*)?$/,t=a.match(e);if(t!==null){let{[1]:r,[2]:$,[4]:x}=t;a=r}return a}f(k,"getURLbase");function B(a){if(typeof window>"u"||typeof document>"u")return!0;var e=a.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}f(B,"isInViewport");var _=String(import.meta.url),W=H("Y29uc3QgQUxQSEFCRVRJQyA9IGBhbHBoYWJldGljYDsKY29uc3QgQVVUTyA9IGBhdXRvYDsKY29uc3QgQk9UVE9NID0gYGJvdHRvbWA7CmNvbnN0IEJPVFRPTV9MRUZUID0gYGJvdHRvbi1sZWZ0YDsKY29uc3QgQk9UVE9NX1JJR0hUID0gYGJvdHRvbS1yaWdodGA7CmNvbnN0IENFTlRFUiA9IGBjZW50ZXJgOwpjb25zdCBDT05TVFJBSU4gPSB0cnVlOwpjb25zdCBDUk9TUyA9IGBjcm9zc2hhaXJgOwpjb25zdCBFTkQgPSBgZW5kYDsKY29uc3QgSEFORCA9IGBwb2ludGVyYDsKY29uc3QgSEFOR0lORyA9IGBoYW5naW5nYDsKY29uc3QgSURFT0dSQVBISUMgPSBgaWRlb2dyYXBoaWNgOwpjb25zdCBMRUZUID0gYGxlZnRgOwpjb25zdCBNSURETEUgPSBgbWlkZGxlYDsKY29uc3QgUE9JTlRFUiA9IGBkZWZhdWx0YDsKY29uc3QgUklHSFQgPSBgcmlnaHRgOwpjb25zdCBTVEFSVCA9IGBzdGFydGA7CmNvbnN0IFRPUCA9IGB0b3BgOwpjb25zdCBUT1BfTEVGVCA9IGB0b3AtbGVmdGA7CmNvbnN0IFRPUF9SSUdIVCA9IGB0b3AtcmlnaHRgOwoKLy8gImludGVybmFsIiB2YXJzCgpsZXQgX19jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBjYW52YXNgKTsKX19jYW52YXMudGFiSW5kZXggPSAwOwpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBwb2ludGVyZG93bmAsICgpID0+IF9fY2FudmFzLmZvY3VzKCkpOwpsZXQgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwoKbGV0IF9fY3VycmVudF9jdXJzb3I7CmxldCBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19jdXJyZW50X2h1ZTsKbGV0IF9fZHJhd19ncmlkOwpsZXQgX19kcmF3aW5nOwpsZXQgX19lbGVtZW50OwpsZXQgX19maW5pc2hlZF9zZXR1cDsKbGV0IF9fZmlyc3Q7CmxldCBfX2ZvbnQ7CmxldCBfX2dyaWRfY29sb3I7CmxldCBfX2dyaWRfc3BhY2luZzsKbGV0IF9faGlnaGxpZ2h0X2NvbG9yOwpsZXQgX19tb3ZhYmxlX3BvaW50czsKbGV0IF9fcmVkcmF3aW5nOwpsZXQgX19zdGFydF90aW1lOwpsZXQgX19zdHlsZV9zdGFjazsKbGV0IF9fdGV4dFN0cm9rZTsKbGV0IF9fbGFzdF9mcmFtZTsKCmNvbnN0IF9fcHJuZyA9IG5ldyAoY2xhc3MgewogIGNvbnN0cnVjdG9yKHNlZWQgPSBEYXRlLm5vdygpKSB7CiAgICB0aGlzLmEgPSBzZWVkOwogIH0KICByZXNlZWQoc2VlZCkgewogICAgdGhpcy5hID0gc2VlZDsKICB9CiAgbmV4dCgpIHsKICAgIC8vIFNwbGl0TWl4MzIsIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS80NzU5MzMxNi83NDA1NTMKICAgIGxldCB7IGEgfSA9IHRoaXM7CiAgICBhIHw9IDA7CiAgICBhID0gKGEgKyAweDllMzc3OWI5KSB8IDA7CiAgICBsZXQgdCA9IGEgXiAoYSA+Pj4gMTYpOwogICAgdCA9IE1hdGguaW11bCh0LCAweDIxZjBhYWFkKTsKICAgIHQgPSB0IF4gKHQgPj4+IDE1KTsKICAgIHQgPSBNYXRoLmltdWwodCwgMHg3MzVhMmQ5Nyk7CiAgICB0aGlzLmEgPSBhOwogICAgcmV0dXJuICgodCA9IHQgXiAodCA+Pj4gMTUpKSA+Pj4gMCkgLyA0Mjk0OTY3Mjk2OwogIH0KfSkoKTsKCmFzeW5jIGZ1bmN0aW9uIHJlc2V0KGVsZW1lbnQgPSBfX2VsZW1lbnQpIHsKICBfX2VsZW1lbnQgPSBlbGVtZW50OwoKICAvLyBkZWZhdWx0IHZhcmlhYmxlIHZhbHVlcwogIF9fY3VycmVudF9jdXJzb3IgPSBgYXV0b2A7CiAgX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvciA9IGByZ2IoMCwyNTQsMTI0KWA7CiAgX19jdXJyZW50X2h1ZSA9IDA7CiAgX19kcmF3X2dyaWQgPSB0cnVlOwogIF9fZHJhd2luZyA9IGZhbHNlOwogIF9fZmluaXNoZWRfc2V0dXAgPSBmYWxzZTsKICBfX2ZvbnQgPSB7IGZhbWlseTogYHNhbnMtc2VyaWZgLCBzaXplOiAxNiwgd2VpZ2h0OiA0MDAgfTsKICBfX2dyaWRfY29sb3IgPSBgbGlnaHRncmV5YDsKICBfX2dyaWRfc3BhY2luZyA9IDIwOwogIF9faGlnaGxpZ2h0X2NvbG9yID0gZmFsc2U7CiAgX19tb3ZhYmxlX3BvaW50cyA9IFtdOwogIF9fcmVkcmF3aW5nID0gZmFsc2U7CiAgX19zdGFydF90aW1lID0gRGF0ZS5ub3coKTsKICBfX3N0eWxlX3N0YWNrID0gW107CiAgX190ZXh0U3Ryb2tlID0gYHRyYW5zcGFyZW50YDsKCiAgY3VycmVudFBvaW50ID0gZmFsc2U7CiAgcGxheWluZyA9IGZhbHNlOwogIGZyYW1lID0gMDsKICBwb2ludGVyLnggPSAwOwogIHBvaW50ZXIueSA9IDA7CiAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoa2V5Ym9hcmQpLmZvckVhY2goKG4pID0+IGRlbGV0ZSBrZXlib2FyZFtuXSk7CgogIC8vIG1ha2Ugc3VyZSB3ZSBkb24ndCBkb3VibGUtZ2VuZXJhdGUgdGhlc2U6CiAgY2xlYXJTbGlkZXJzKCk7CiAgY2xlYXJCdXR0b25zKCk7CgogIC8vIHJ1biBzZXR1cAogIGF3YWl0IF9fc2V0dXAoKTsKICBfX2ZpbmlzaGVkX3NldHVwID0gdHJ1ZTsKCiAgLy8gcnVuIGZpcnN0IGRyYXcKICBfX2xhc3RfZnJhbWUgPSBEYXRlLm5vdygpOwogIGF3YWl0IF9fZHJhdygpOwoKICByZXR1cm4geyB3aWR0aCwgaGVpZ2h0IH07Cn0KCmZ1bmN0aW9uIGhhbHQoKSB7CiAgcGxheWluZyA9IGZhbHNlOwogIF9fY2FudmFzID0gdW5kZWZpbmVkOwogIF9fY3R4ID0gdW5kZWZpbmVkOwogIF9fZmluaXNoZWRfc2V0dXAgPSBmYWxzZTsKICBfX2RyYXdpbmcgPSB0cnVlOwogIF9fcmVkcmF3aW5nID0gdHJ1ZTsKICBfX2ZpcnN0ID0gdW5kZWZpbmVkOwogIF9fbW92YWJsZV9wb2ludHMgPSB1bmRlZmluZWQ7CiAgX19jdXJyZW50X2N1cnNvciA9IHVuZGVmaW5lZDsKICBfX2N1cnJlbnRfaHVlID0gMDsKICBfX2ZvbnQgPSB1bmRlZmluZWQ7CiAgX19zdGFydF90aW1lID0gMDsKICBjbGVhclNsaWRlcnMoKTsKICBjbGVhckJ1dHRvbnMoKTsKfQoKZnVuY3Rpb24gX19nZXREZXNjcmlwdGlvbigpIHsKICBpZiAodHlwZW9mIGdldERlc2NyaXB0aW9uICE9PSBgdW5kZWZpbmVkYCkgcmV0dXJuIGdldERlc2NyaXB0aW9uKCk7Cn0KCmFzeW5jIGZ1bmN0aW9uIF9fc2V0dXAoKSB7CiAgaWYgKHR5cGVvZiBzZXR1cCAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IHNldHVwKCk7CiAgaWYgKHR5cGVvZiBfX21vcmVfc2V0dXAgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBfX21vcmVfc2V0dXAoKTsKICBpZiAoIXdpZHRoICYmICFoZWlnaHQpIHNldFNpemUoKTsKfQoKYXN5bmMgZnVuY3Rpb24gX19kcmF3KCkgewogIGlmICghX19maW5pc2hlZF9zZXR1cCkgcmV0dXJuOwogIGlmICghX19kcmF3aW5nKSB7CiAgICBfX2RyYXdpbmcgPSB0cnVlOwogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICAgIGZyYW1lRGVsdGEgPSBub3cgLSBfX2xhc3RfZnJhbWU7CiAgICBmcmFtZSsrOwogICAgcmVzZXRUcmFuc2Zvcm0oKTsKICAgIGlmICh0eXBlb2YgZHJhdyAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IGRyYXcoKTsKICAgIGlmICh0eXBlb2YgX19tb3JlX2RyYXcgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBfX21vcmVfZHJhdygpOwogICAgX19kcmF3aW5nID0gZmFsc2U7CiAgICBfX2xhc3RfZnJhbWUgPSBub3c7CiAgICBpZiAocGxheWluZykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IF9fZHJhdygpKTsKICB9Cn0KLyoqCiAqIFRoZSBjdXJyZW50IGZyYW1lIG51bWJlcgogKgogKiBAY29uc3RhbnQge251bWJlcn0KICovCmxldCBmcmFtZSA9IDA7CgovKioKICogVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgc2luY2UgdGhlIGxhc3QgZnJhbWUuCiAqCiAqIEBjb25zdGFudCB7bnVtYmVyfQogKi8KbGV0IGZyYW1lRGVsdGEgPSAwOwoKLyoqCiAqIFRoZSBoZWlnaHQgb2YgdGhlIGNhbnZhcyBpbiBwaXhlbHMKICoKICogQGNvbnN0YW50IHtudW1iZXJ9CiAqLwpsZXQgaGVpZ2h0ID0gMDsKCi8qKgogKiBUaGUgd2lkdGggb2YgdGhlIGNhbnZhcyBpbiBwaXhlbHMKICoKICogQGNvbnN0YW50IHtudW1iZXJ9CiAqLwpsZXQgd2lkdGggPSAwOwoKLyoqCiAqIFRoZSBjdXJyZW50IHBsYXkgc3RhdGUKICoKICogQGNvbnN0YW50IHtib29sZWFufQogKi8KbGV0IHBsYXlpbmcgPSBmYWxzZTsKCi8qKgogKiBUaGUgYHBvaW50ZXJgIG9iamVjdCByZXByZXNlbnRzIHRoZSBtb3VzZSBjdXJzb3IgKHdoZW4gdXNpbmcKICogYSBtb3VzZSkgb3IgZmluZ2VyIHBvc2l0aW9uIChmb3IgdG91Y2ggZGV2aWNlcyksIGFuZCBtb2RlbHMKICogc2V2ZXJhbCBhc3BlY3RzOgogKgogKiAtIGBhY3RpdmVgIChib29sZWFuKSBXaGV0aGVyIHRoZSBwb2ludGVyIGlzIGV2ZW4gb24gb3Igb3ZlciB0aGUgY2FudmFzLgogKiAtIGB4YCAobnVtYmVyKSBUaGUgcG9pbnRlcidzIHggb2Zmc2V0IGluIHBpeGVscyB3aXRoIHJlc3BlY3QgdG8gdGhlIGNhbnZhcwogKiAtIGB5YCAobnVtYmVyKSBUaGUgcG9pbnRlcidzIHkgb2Zmc2V0IGluIHBpeGVscyB3aXRoIHJlc3BlY3QgdG8gdGhlIGNhbnZhcwogKiAtIGBkb3duYCAoYm9vbGVhbikgV2hldGhlciB0aGUgcG9pbnRlciBpcyAiZW5nYWdlZCIgb3Igbm90CiAqIC0gYGRyYWdgIChib29sZWFuKSBXaGV0aGVyIGEgY2xpY2svdG91Y2gtZHJhZyBpcyBpbiBwcm9ncmVzcwogKiAtIGBtYXJrYCAoe3gseX0pIFdoZW4gZHJhZ2dpbmcsIHRoaXMgcmVwcmVzZW50cyB0aGUgb3JpZ2luYWwgY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnRlciAiZG93biIgZXZlbnQKICoKICogQGNvbnN0YW50IHtvYmplY3R9CiAqLwpjb25zdCBwb2ludGVyID0geyB4OiAwLCB5OiAwIH07CgovKioKICogSWYgYW55IHBvaW50cyB3ZXJlIHJlZ2lzdGVyZWQgYXMgbW92YWJsZSwgYW5kIHRoZSBwb2ludGVyIGlzCiAqIG5lYXIgZW5vdWdoIHRvIGEgbW92YWJsZSBwb2ludCwgdGhpcyB2YWx1ZSB3aWxsIHBvaW50IHRvCiAqIHRoYXQgbW92YWJsZSBwb2ludCwgb3IgYGZhbHNlYCBpZiB0aGUgcG9pbnRlciBpcyBub3QgbmVhcgogKiBhbnkgbW92YWJsZSBwb2ludCAob3IsIG9mIGNvdXJzZSwgdGhlcmUgYXJlIG5vIG1vdmFibGUgcG9pbnRzKQogKgogKiBAY29uc3RhbnQge1BvaW50TGlrZXxmYWxzZX0KICovCmxldCBjdXJyZW50UG9pbnQgPSBmYWxzZTsKCi8qKgogKiBUaGUgYGtleWJvYXJkYCBvYmplY3QgaXMgYSB0cnV0aCB0YWJsZSB0aGF0IGNhbiBiZSBjaGVja2VkIHRvCiAqIHNlZSBpZiBhbnkga2V5IGlzIGN1cnJlbnRseSBwcmVzc2VkLCBhbmQgaWYgc28sIHdoZW4gdGhhdAogKiBrZXlwcmVzcyB3YXMgaW5pdGlhdGVkLCBieSBzdG9yaW5nOgogKgogKiBgYGAKICogewogKiAgIFtrZXk6c3RyaW5nXTogZGF0ZXRpbWUKICogfQogKiBgYGAKICoKICogV2hlbiBhIGtleSBpcyByZWxlYXNlZCwgaXRzIG1hcHBpbmcgaXMgcmVtb3ZlZCBlbnRpcmVseSwKICogcmF0aGVyIHRoYW4gaXQgYmVpbmcgc2V0IHRvIGEgZmFsc2V5IHZhbHVlLgogKgogKiBAY29uc3RhbnQge29iamVjdH0KICovCmNvbnN0IGtleWJvYXJkID0ge307CgovLyBjb25zdGFudHMuLi4KY29uc3QgewogIC8qKgogICAqIFRoZSByYXRpbyBvZiBhIGNpcmNsZSdzIGNpcmN1bWZlcmVuY2UgdG8gaXRzIGRpYW1ldGVyLgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1BpCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKgogICAqIEBzZWUge0BsaW5rIFRBVX0KICAgKi8KICBQSSwKCiAgLyoqCiAgICogVGhlIGJhc2UgZm9yIHRoZSBuYXR1cmFsIGxvZ2FyaXRobS4KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FXyhtYXRoZW1hdGljYWxfY29uc3RhbnQpCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKi8KICBFLAp9ID0gTWF0aDsKCmNvbnN0IHsKICAvKioKICAgKiBBIHZlcnkgc21hbGwgdmFsdWUgZm9yIHBlcmZvcm1pbmcgaW1wcmVjaXNlIG1hdGggb3BlcmF0aW9ucwogICAqIHN1Y2ggYXMgY2hlY2tpbmcgd2hldGhlciBhIHZhbHVlIGlzIGFwcHJveGltYXRlbHkgdGhlIHNhbWUKICAgKiBhcyBzb21lIG90aGVyIHZhbHVlLgogICAqCiAgICogQGNvbnN0YW50IHtudW1iZXJ9CiAgICovCiAgZXBzaWxvbiwKCiAgLyoqCiAgICogQSB2ZXJ5IGxhcmdlIHZhbHVlIHRoYXQgY2FuIHN0aWxsIGJlIHVzZWQgdG8gZHJhdyB0aGluZ3MKICAgKiBvbiB0aGUgY2FudmFzIChzdWNoIGFzIGxpbmVzIGZyb20gLWh1Z2UgdG8gK2h1Z2UpLgogICAqCiAgICogQGNvbnN0YW50IHtudW1iZXJ9CiAgICovCiAgaHVnZSwKCiAgLyoqCiAgICogVGhlIHJhdGlvIG9mIGEgY2lyY2xlJ3MgY2lyY3VtZmVyZW5jZSB0byBpdHMgcmFkaXVzLgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1R1cm5fKGFuZ2xlKSNUYXVfcHJvcG9zYWxzCiAgICoKICAgKiBAY29uc3RhbnQge251bWJlcn0KICAgKgogICAqIEBzZWUge0BsaW5rIFBJfQogICAqLwogIFRBVSwKfSA9IHsgZXBzaWxvbjogMWUtMTAsIGh1Z2U6IDFfMDAwXzAwMCwgVEFVOiBQSSAqIDIgfTsKLyoqCiAqIEVuc3VyZSB0aGF0IHRoZXJlIGlzIG5vIGJvcmRlciBhcm91bmQgdGhlIGNhbnZhcyBlbGVtZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRCb3JkZXIoNSwgYHJlZGApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHRleHQoYGNsaWNrIG1lYCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlclVwKHgsIHkpIHsKICogICAgICAgc2V0Qm9yZGVyKDUsIGByZWRgKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgsIHkpIHsKICogICAgICAgbm9Cb3JkZXIoKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRCb3JkZXJ9CiAqLwpmdW5jdGlvbiBub0JvcmRlcigpIHsKICBzZXRCb3JkZXIoZmFsc2UpOwp9CgovKioKICogRGlzYWJsZSBib3RoIHN0cm9rZSBhbmQgZmlsbCBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KGBOb3cgeW91IHNlZSBtZWAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub0NvbG9yKCk7CiAqICAgICAgIHRleHQoYE5vdyB5b3UgZG9uJ3RgLCB3aWR0aC8yLCBoZWlnaHQvMiArIDI1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRDb2xvcn0KICogQHNlZSB7QGxpbmsgbm9TdHJva2V9CiAqIEBzZWUge0BsaW5rIG5vRmlsbH0KICovCmZ1bmN0aW9uIG5vQ29sb3IoKSB7CiAgbm9GaWxsKCk7CiAgbm9TdHJva2UoKTsKfQoKLyoqCiAqIEhpZGUgdGhlIGN1cnNvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgI0ZGMDJgKTsKICogICAgICAgcmVjdCgwLCAwLCB3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgICBzZXRDb2xvcihgIzBGRjJgKTsKICogICAgICAgcmVjdCh3aWR0aC8yLCAwLCB3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlck1vdmUoeCwgeSkgewogKiAgICAgICBpZiAoeCA8IHdpZHRoLzIpIHsKICogICAgICAgICBzZXRDdXJzb3IoQVVUTyk7CiAqICAgICAgIH0gZWxzZSB7CiAqICAgICAgICAgbm9DdXJzb3IoKTsKICogICAgICAgfQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldEN1cnNvcn0KICovCmZ1bmN0aW9uIG5vQ3Vyc29yKCkgewogIF9fY2FudmFzLnN0eWxlLmN1cnNvciA9IGBub25lYDsKfQoKLyoqCiAqIERpc2FibGUgdGhlIGZpbGwgY29sb3IuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKDEpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcmVjdCgyMCwgNzAsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYGZpbGxlZGAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgcmVjdCgzMCwgODAsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYG5vdCBmaWxsZWRgLCB3aWR0aC8yLCBoZWlnaHQvMiArIDI1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRGaWxsfQogKi8KZnVuY3Rpb24gbm9GaWxsKCkgewogIHNldEZpbGwoYHRyYW5zcGFyZW50YCk7Cn0KCi8qKgogKiBEaXNhYmxlIHRoZSBkZWZhdWx0IGdyaWQgYmFja2dyb3VuZC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICB0ZXh0KGBjbGljayBtZWAsIHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJVcCh4LCB5KSB7CiAqICAgICAgIHNldEdyaWQoMjAsIGBsaWdodGdyZXlgKTsKICogICAgICAgcmVkcmF3KCkKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKHgsIHkpIHsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICAgIHJlZHJhdygpCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2V0R3JpZH0KICovCmZ1bmN0aW9uIG5vR3JpZCgpIHsKICBfX2RyYXdfZ3JpZCA9IGZhbHNlOwp9CgovKioKICogU2V0IHRoZSBsaW5lIHN0cm9rZSB0byAic29saWQiLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRMaW5lRGFzaCgxKTsKICogICAgICAgbGluZSgwLDIwLHdpZHRoLDUwKTsKICogICAgICAgc2V0TGluZURhc2goNSk7CiAqICAgICAgIGxpbmUoMCwzMCx3aWR0aCw5MCk7CiAqICAgICAgIHNldExpbmVEYXNoKDEsMiwzLDQpOwogKiAgICAgICBsaW5lKDAsNDAsd2lkdGgsMTMwKTsKICogICAgICAgbm9MaW5lRGFzaCgpOwogKiAgICAgICBsaW5lKDAsNTAsd2lkdGgsMTgwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRMaW5lRGFzaH0KICovCgpmdW5jdGlvbiBub0xpbmVEYXNoKCkgewogIF9fY3R4LnNldExpbmVEYXNoKFtdKTsKfQoKLyoqCiAqIERpc2FibGUgdGhlIHN0cm9rZSBjb2xvci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoMSk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICByZWN0KDIwLCA3MCwgMjAsIDIwKTsKICogICAgICAgdGV4dChgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yIC0gMjUpOwogKiAgICAgICBub1N0cm9rZSgpOwogKiAgICAgICByZWN0KDQyLCA4MiwgMjAsIDIwKTsKICogICAgICAgdGV4dChgbm90IHN0cm9rZWRgLCB3aWR0aC8yLCBoZWlnaHQvMiArIDI1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBzZXRTdHJva2V9CiAqLwoKZnVuY3Rpb24gbm9TdHJva2UoKSB7CiAgc2V0U3Ryb2tlKGB0cmFuc3BhcmVudGApOwp9CgovKioKICogRGlzYWJsZSB0ZXh0IHN0cm9raW5nLCBidXQgbm90IHJlZ3VsYXIgc2hhcGUgc3Ryb2tpbmcuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKDEpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgcmVjdCgyMCwgNzAsIDIwLCAyMCk7CiAqICAgICAgIHRleHQoYHN0cm9rZWRgLCB3aWR0aC8yLCBoZWlnaHQvMiAtIDI1KTsKICogICAgICAgbm9UZXh0U3Ryb2tlKCk7CiAqICAgICAgIHJlY3QoNDIsIDgyLCAyMCwgMjApOwogKiAgICAgICB0ZXh0KGBub3Qgc3Ryb2tlZGAsIHdpZHRoLzIsIGhlaWdodC8yICsgMjUpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHNldFRleHRTdHJva2V9CiAqLwoKZnVuY3Rpb24gbm9UZXh0U3Ryb2tlKCkgewogIHNldFRleHRTdHJva2UoZmFsc2UsIHVuZGVmaW5lZCk7Cn0KLyoqCiAqIEFkZCBhIHNsaWRlciB0byB5b3VyIGZpZ3VyZSwgYWxsb3dpbmcgdXNlcnMgdG8gY29udHJvbAogKiBhIHZhcmlhYmxlIGluIHlvdXIgZ3JhcGhpY3MgY29kZSBkaXJlY3RseSBieSBpbnRlcmFjdGluZwogKiB3aXRoIHRoYXQgb24tcGFnZSBzbGlkZXIsIHdoaWNoIGlzIGVzcGVjaWFsbHkgaW1wb3J0YW50IGlmCiAqIHlvdSB3YW50IHlvdXIgZ3JhcGhpY3MgdG8gYmUgdXNlYWJsZSBieSB1c2VycyB3aG8gZG9uJ3QKICogaGF2ZSwgb3IgY2Fubm90IHVzZSwgYSBtb3VzZS4KICoKICogVGhlIGBwcm9wTGFiZWxgIHZhbHVlIHNob3VsZCBiZSB0aGUgbmFtZSBvZiB0aGUgdmFyaWFibGUKICogdGhhdCB5b3VyIGdyYXBoaWNzIGNvZGUgdXNlcywgYW5kIHNob3VsZCBfbm90XyBiZSAicHJlYWxsb2NhdGVkIgogKiBpbiB5b3VyIGNvZGUgd2l0aCBhIGNvbnN0LCBsZXQsIG9yIHZhcjogaXQgd2lsbCBhdXRvbWF0aWNhbGx5CiAqIGdldCBhZGRlZCBhcyBwYXJ0IG9mIHRoZSBzb3VyY2UgbG9hZGluZyBwcm9jZXNzLgogKgogKiBUaGUgb3B0aW9ucyBvYmplY3QgYWNjZXB0cyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXMgYW5kIHZhbHVlczoKICoKICogLSBtaW46bnVtYmVyIC0gdGhlIHNsaWRlcidzIG1pbmltdW0gdmFsdWUsIGRlZmF1bHRzIHRvIDAKICogLSBtYXg6bnVtYmVyIC0gdGhlIHNsaWRlcidzIG1heGltdW0gdmFsdWUsIGRlZmF1bHRzIHRvIDEKICogLSBzdGVwIC0gdGhlIHN0ZXAgc2l6ZSwgZGVmYXVsdHMgdG8gKG1heCAtIG1pbikvMTAKICogLSB2YWx1ZSAtIHRoZSBpbml0aWFsIHZhbHVlLCBkZWZhdWx0cyB0byAobWF4ICsgbWluKS8yCiAqIC0gY2xhc3NlcyAtIHRoZSBDU1MgY2xhc3NlcyB0aGF0IHdpbGwgYmUgdXNlZCwgZGVmYXVsdHMgdG8gYCJzbGlkZXIiYAogKiAtIHRyYW5zZm9ybSAtIGEgdmFsdWUgcHJlcHJvY2Vzc29yICBkZWZhdWx0cyB0byAodikgPT4gdgogKgogKiBUaGUgYHRyYW5zZm9ybWAgcHJlLXByb2Nlc3NvciBydW5zIGFmdGVyIHRoZSB1c2VyIHVwZGF0ZXMKICogdGhlIHNsaWRlciwgYnV0IGJlZm9yZSBpdHMgdmFsdWUgZ2V0cyBhc3NpZ25lZCB0byB5b3VyIHZhcmlhYmxlLAogKiBzbyB0aGF0IHlvdSBjYW4gbWFwIGl0IHRvIHNvbWV0aGluZyBlbHNlIChmb3IgaW5zdGFuY2UsIG51bWJlcnMKICogaW4gb25lIHJhbmdlIHRvIG51bWJlcnMgaW4gYSBjb21wbGV0ZWx5IGRpZmZlcmVudCByYW5nZSwgb3IgZXZlbgogKiBudW1iZXJzIHRvIHN0cmluZ3Mgb3IgZW50aXJlIG9iamVjdHMpCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSg0MDAsIDIwMCk7CiAqICAgICAgIGFkZFNsaWRlcihgYmdDb2xvcmAsIHsKICogICAgICAgICBtaW46IDAsCiAqICAgICAgICAgbWF4OiAyNTUsCiAqICAgICAgICAgc3RlcDogMSwKICogICAgICAgICB2YWx1ZTogMjAwLAogKiAgICAgICAgIHRyYW5zZm9ybTogKHYpID0+IHsKICogICAgICAgICAgIC8vIGNvbnZlcnQgdiBpbnRvIGEgaGV4IGNvbG9yIGNvZGUKICogICAgICAgICAgIHYgPSAodikudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsIGAwYCk7CiAqICAgICAgICAgICByZXR1cm4gYCMke3Z9JHt2fSR7dn1gOwogKiAgICAgICAgIH0KICogICAgICAgfSk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihiZ0NvbG9yKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gdmFyTmFtZSBUaGUgbmFtZSBmb3IgdGhlIHZhcmlhYmxlIHRoaXMgc2xpZGVyIGdldHMgdGllZCB0by4KICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgU2VlIGRlc2NyaXB0aW9uCiAqIEByZXR1cm5zIHtIVE1MSW5wdXRFbGVtZW50fSB0aGUgSFRNTCBpbnB1dCBlbGVtZW50IGZvciB0aGlzIHNsaWRlcgogKgogKiBAc2VlIHtAbGluayBjbGVhclNsaWRlcnN9CiAqLwpmdW5jdGlvbiBhZGRTbGlkZXIocHJvcExhYmVsLCBhc3NpZ24sIG9wdGlvbnMgPSB7fSkgewogIGxldCB7CiAgICBtaW4sCiAgICBtYXgsCiAgICBzdGVwLAogICAgdmFsdWUsCiAgICBjbGFzc2VzID0gYHNsaWRlcmAsCiAgICB0cmFuc2Zvcm0gPSAodikgPT4gdiwKICB9ID0gb3B0aW9uczsKCiAgbWluID0gbWluID09PSB1bmRlZmluZWQgPyAwIDogbWluOwogIG1heCA9IG1heCA9PT0gdW5kZWZpbmVkID8gMSA6IG1heDsKICBzdGVwID0gc3RlcCA9PT0gdW5kZWZpbmVkID8gKG1heCAtIG1pbikgLyAxMCA6IHN0ZXA7CiAgdmFsdWUgPSB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gKG1heCArIG1pbikgLyAyIDogdmFsdWU7CgogIC8vIGN1c3RvbSAicm91bmRpbmciLCBwdXJlbHkgZm9yIHN0cmluZ3MKICBjb25zdCByb3VuZCA9ICh2LCBkID0gNCkgPT4gewogICAgdiA9IGAke3Z9YDsKICAgIGNvbnN0IGZzID0gdi5pbmRleE9mKGAuYCk7CiAgICBpZiAoZnMgIT09IC0xKSB7CiAgICAgIGxldCBwcmVjID0gZCAtIGZzID4gMCA/IGQgLSBmcyA6IDA7CiAgICAgIHYgPSB2LnN1YnN0cmluZygwLCBmcyArIHByZWMpOwogICAgfQogICAgcmV0dXJuIHY7CiAgfTsKCiAgY29uc3QgY3JlYXRlID0gKHRhZykgPT4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOwoKICBsZXQgc2xpZGVyID0gY3JlYXRlKGBpbnB1dGApOwogIHNsaWRlci50eXBlID0gYHJhbmdlYDsKICBzbGlkZXIubWluID0gbWluOwogIHNsaWRlci5tYXggPSBtYXg7CiAgc2xpZGVyLnN0ZXAgPSBzdGVwOwogIHNsaWRlci5zZXRBdHRyaWJ1dGUoYHZhbHVlYCwgdmFsdWUpOwogIHNsaWRlci5zZXRBdHRyaWJ1dGUoYGNsYXNzYCwgY2xhc3Nlcyk7CgogIGNvbnN0IHVwZGF0ZSA9ICh7IHZhbHVlIH0pID0+IHsKICAgIHZhbHVlRmllbGQudGV4dENvbnRlbnQgPSByb3VuZCh2YWx1ZSk7CiAgICBhc3NpZ24odHJhbnNmb3JtKHBhcnNlRmxvYXQodmFsdWUpKSk7CiAgICBpZiAoIXBsYXlpbmcpIHJlZHJhdygpOwogIH07CgogIHNsaWRlci5hZGRFdmVudExpc3RlbmVyKGBpbnB1dGAsICh7IHRhcmdldCB9KSA9PiB1cGRhdGUodGFyZ2V0KSk7CgogIGxldCB0YWJsZSA9IF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKGB0YWJsZS5zbGlkZXItd3JhcHBlcmApOwogIGlmICghdGFibGUpIHsKICAgIHRhYmxlID0gY3JlYXRlKGB0YWJsZWApOwogICAgdGFibGUuY2xhc3NMaXN0LmFkZChgc2xpZGVyLXdyYXBwZXJgKTsKICAgIF9fZWxlbWVudC5wcmVwZW5kKHRhYmxlKTsKICB9CiAgbGV0IHRyID0gY3JlYXRlKGB0cmApOwoKICBsZXQgdGQgPSBjcmVhdGUoYHRkYCk7CiAgbGV0IGxhYmVsID0gY3JlYXRlKGBsYWJlbGApOwogIGxhYmVsLmNsYXNzTGlzdC5hZGQoYHNsaWRlci1sYWJlbGApOwogIGxhYmVsLmlubmVySFRNTCA9IHByb3BMYWJlbAogICAgLnJlcGxhY2UoL18oLispJC8sIGA8c3ViPiQxPC9zdWI+YCkKICAgIC5yZXBsYWNlKC8oXGQrKS8sIGA8c3ViPiQxPC9zdWI+YCk7CiAgdGQuYXBwZW5kKGxhYmVsKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbWluYCk7CiAgdGQudGV4dENvbnRlbnQgPSByb3VuZChzbGlkZXIubWluKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC53aWR0aCA9IGAqYDsKICB0ZC5hcHBlbmQoc2xpZGVyKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbWF4YCk7CiAgdGQudGV4dENvbnRlbnQgPSByb3VuZChzbGlkZXIubWF4KTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB2YXIgdmFsdWVGaWVsZCA9IGNyZWF0ZShgbGFiZWxgKTsgLy8gZnVuY3Rpb24gc2NvcGVkCiAgdmFsdWVGaWVsZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItdmFsdWVgKTsKICB0ZC5hcHBlbmQodmFsdWVGaWVsZCk7CiAgdHIuYXBwZW5kKHRkKTsKICB0ZC5hZGRFdmVudExpc3RlbmVyKGBwb2ludGVyZG93bmAsICgpID0+IHsKICAgIGNvbnN0IHZhbHVlID0gcHJvbXB0KGBuZXcgdmFsdWU/YCwgc2xpZGVyLnZhbHVlKTsKICAgIGlmICh2YWx1ZSAhPT0gbnVsbCkgewogICAgICBzbGlkZXIudmFsdWUgPSB2YWx1ZTsKICAgICAgdXBkYXRlKHsgdmFsdWUgfSk7CiAgICB9CiAgfSk7CgogIHRhYmxlLmFwcGVuZCh0cik7CgogIHVwZGF0ZShzbGlkZXIpOwogIHJldHVybiBzbGlkZXI7Cn0KCi8qKgogKiBSZW1vdmUgYWxsIHNsaWRlcnMgZm9yIHlvdXIgZmlndXJlIGZyb20gdGhlIHBhZ2UuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIGFkZFNsaWRlcihgeGApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHRleHQoYGNsaWNrIHRvIGNsZWFyYCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oKSB7CiAqICAgICAgIGNsZWFyU2xpZGVycygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIGFkZFNsaWRlcn0KICovCgpmdW5jdGlvbiBjbGVhclNsaWRlcnMoKSB7CiAgY29uc3QgdGFibGUgPSBfX2VsZW1lbnQucXVlcnlTZWxlY3RvcihgdGFibGUuc2xpZGVyLXdyYXBwZXJgKTsKICBpZiAodGFibGUpIHRhYmxlLmlubmVySFRNTCA9IGBgOwp9CgovKioKICogQWRkIGEgYnV0dG9uIGJlbG93IHlvdXIgZmlndXJlIHRoYXQgY2FuIHRyaWdnZXIgZXZlbnQtYmFzZWQKICogY29kZSwgd2hpY2ggaXMgZXNwZWNpYWxseSBpbXBvcnRhbnQgaWYgeW91IHdhbnQgeW91ciBncmFwaGljcwogKiB0byBiZSB1c2VhYmxlIGJ5IHVzZXJzIHdobyBkb24ndCBoYXZlLCBvciBjYW5ub3QgdXNlLCBhIG1vdXNlLgogKgogKiBvbkNsaWNrIGlzIHNpbWlsYXIgdG8gdGhlIHN0YW5kYXJkIEpTIGV2ZW50IGhhbmRsZXIsIGV4Y2VwdAogKiB0aGF0IHRoZSBjYWxsIGFyZ3VtZW50IGlzIGEgcmVmZXJlbmNlIHRvIHlvdXIgYnV0dG9uLCBub3QKICogdGhlIGNsaWNrIGV2ZW50LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgY29uc3QgY29sb3JzID0gW2B3aGl0ZWAsIGBibGFja2BdOwogKiAgICAgbGV0IGJnQ29sb3IgPSAwOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBhZGRCdXR0b24oYGZsaXAgYmFja2dyb3VuZGAsIChidXR0b24pID0+IHsKICogICAgICAgICBiZ0NvbG9yID0gLShiZ0NvbG9yIC0gMSk7CiAqICAgICAgICAgcmVkcmF3KCk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoY29sb3JzW2JnQ29sb3JdKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30gbGFiZWwgVGhlIHRleHQgbGFiZWwgZm9yIHlvdXIgYnV0dG9uCiAqIEBwYXJhbSB7RnVuY3Rpb259IG9uQ2xpY2sgVGhlIGNsaWNrIGhhbmRsaW5nIGZ1bmN0aW9uLCBzZWUgZGVzY3JpcHRpb24uCiAqIEByZXR1cm5zIHtIVE1MQnV0dG9uRWxlbWVudH0gVGhlIGJ1dHRvbiBlbGVtZW50IHRoaXMgYWRkZWQgdG8gdGhlIHBhZ2UKICoKICogQHNlZSB7QGxpbmsgY2xlYXJCdXR0b25zfQogKi8KZnVuY3Rpb24gYWRkQnV0dG9uKGxhYmVsLCBvbkNsaWNrKSB7CiAgaWYgKCFvbkNsaWNrKSB0aHJvdyBuZXcgRXJyb3IoYGEgYnV0dG9uIG11c3QgaGF2ZSBhbiBvbkNsaWNrIGhhbmRsZXJgKTsKICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBidXR0b25gKTsKICBidG4uY2xhc3NMaXN0LmFkZChgZ3JhcGhpY3MtZWxlbWVudC1idXR0b25gKTsKICBidG4udGV4dENvbnRlbnQgPSBsYWJlbDsKICBidG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCAoKSA9PiBvbkNsaWNrKGJ0bikpOwogIF9fZWxlbWVudC5wcmVwZW5kKGJ0bik7CiAgcmV0dXJuIGJ0bjsKfQoKLyoqCiAqIFJlbW92ZSBhbGwgYnV0dG9ucyBmb3IgeW91ciBmaWd1cmUgZnJvbSB0aGUgcGFnZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGB0aGlzIGRvZXMgbm90aGluZ2AsICgpID0+IHt9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KGBjbGljayB0byBjbGVhcmAsIHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJEb3duKCkgewogKiAgICAgICBjbGVhckJ1dHRvbnMoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBhZGRCdXR0b259CiAqLwpmdW5jdGlvbiBjbGVhckJ1dHRvbnMoKSB7CiAgX19lbGVtZW50CiAgICAucXVlcnlTZWxlY3RvckFsbChgYnV0dG9uLmdyYXBoaWNzLWVsZW1lbnQtYnV0dG9uYCkKICAgIC5mb3JFYWNoKChlKSA9PiBlLnJlbW92ZSgpKTsKfQovKioKICogRHJhdyBhIGNpcmN1bGFyIGFyYyB3aXRoIHJhZGl1cyBgcmAgYXQgKHgseSksCiAqIHN0YXJ0aW5nIGF0IGFuZ2xlIGBzYCBhbmQgZW5kaW5nIGF0IGFuZ2xlIGBlYC4KICogSWYgYHdlZGdlYCBpcyB0cnVlLCB0aGlzIHdpbGwgZHJhdyBhIGNsb3NlZAogKiBzaGFwZSB0aGF0IGlzIGFuY2hvcmVkIGF0ICh4LHkpLiBJZiBvbWl0dGVkCiAqIG9yIGV4cGxpY2l0bHkgc2V0IHRvIGZhbHNlLCB0aGlzIHdpbGwgZHJhdwogKiBhbiBvcGVuIHNoYXBlIHdpdGggYSBmaWxsIHRoYXQgY29ubmVjdHMgdGhlCiAqIGZpcnN0IGFuZCBsYXN0IHBvaW50IG9uIHRoZSBhcmMsIGJ1dCBubyBjbG9zaW5nCiAqIHN0cm9rZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYCNGMDAyYCk7CiAqICAgICAgIGFyYyh3aWR0aC8yICsgMzAsIGhlaWdodC8yIC0gNDAsIDQwLCAwLCAwLjY2KlRBVSk7CiAqICAgICAgIGFyYyh3aWR0aC8yIC0gMzAsIGhlaWdodC8yICsgMjAsIDQwLCAwLCAwLjY2KlRBVSwgdHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGNpcmN1bGFyIGNlbnRlciB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBjaXJjdWxhciBjZW50ZXIgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhpcyBhcmMgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydEFuZ2xlIFRoZSBzdGFydCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0gZW5kQW5nbGUgVGhlIGVuZCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge2Jvb2xlYW59IGRyYXdXZWRnZSBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRvIGRyYXcgYSB3ZWRnZSBvciBjYXBwZWQgY2lyY2xlIChkZWZhdWx0PWNpcmNsZSkKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHBvaW50IFRoZSBjaXJjdWxhciBjZW50ZXIge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhpcyBhcmMgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydEFuZ2xlIFRoZSBzdGFydCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0gZW5kQW5nbGUgVGhlIGVuZCBhbmdsZSBmb3IgdGhpcyBhcmMgaW4gcmFkaWFucwogKiBAcGFyYW0ge2Jvb2xlYW59IGRyYXdXZWRnZSBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRvIGRyYXcgYSB3ZWRnZSBvciBjYXBwZWQgY2lyY2xlIChkZWZhdWx0PWNpcmNsZSkKICoKICogQHNlZSB7QGxpbmsgY2lyY2xlfQogKi8KZnVuY3Rpb24gYXJjKHgsIHksIHIsIHMgPSAwLCBlID0gVEFVLCB3ZWRnZSA9IGZhbHNlKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB3ZWRnZSA9IGU7CiAgICBlID0gczsKICAgIHMgPSByOwogICAgciA9IHk7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgY29uc3Qgc3RlcCA9IDAuMTsKICBzdGFydCgpOwogIGlmICh3ZWRnZSkgdmVydGV4KHgsIHkpOwogIGxldCBhID0gczsKICB2ZXJ0ZXgoeCArIHIgKiBjb3MocyksIHkgKyByICogc2luKHMpKTsKICBmb3IgKGEgPSBzICsgc3RlcDsgYSA8IGU7IGEgKz0gc3RlcCkgewogICAgdmVydGV4KHggKyByICogY29zKGEpLCB5ICsgciAqIHNpbihhKSk7CiAgfQogIHZlcnRleCh4ICsgciAqIGNvcyhlKSwgeSArIHIgKiBzaW4oZSkpOwogIGlmICh3ZWRnZSkgdmVydGV4KHgsIHkpOwogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIHBhaXIgb2YgaG9yaXpvbnRhbCBhbmQgdmVydGljYWwgYXhlcy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Qm9yZGVyKDEsIGBibGFja2ApOwogKiAgICAgICBzZXRHcmlkKDUwLCBgbGlnaHRncmV5YCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBzZXRDdXJzb3IoYG5vbmVgKTsKICogICAgICAgY2xlYXIoYCNmZmZlZjdgKTsKICogICAgICAgc2V0Q29sb3IoYCMzMzNgKTsKICogICAgICAgdHJhbnNsYXRlKDI1LDI1KTsKICogICAgICAgYXhlcygKICogICAgICAgICBgdGltZSAocylgLCAwLCB3aWR0aC01MCwKICogICAgICAgICBgZGlzdGFuY2UgKGttKWAsIDAsIGhlaWdodC01MCwKICogICAgICAgICAiMCIsICI2MCIsCiAqICAgICAgICAgIjAiLCAiNTAwIik7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGhMYWJlbCB0aGUgaG9yaXpvbnRhbCBheGlzIGxhYmVsCiAqIEBwYXJhbSB7bnVtYmVyfSBocyB0aGUgc3RhcnQgKGxlZnQpIHBpeGVsIHZhbHVlIGZvciB0aGUgaG9yaXpvbnRhbCBheGlzCiAqIEBwYXJhbSB7bnVtYmVyfSBoZSB0aGUgZW5kIChyaWdodCkgcGl4ZWwgdmFsdWUgZm9yIHRoZSBob3Jpem9udGFsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IHZMYWJlbCB0aGUgdmVydGljYWwgYXhpcyBsYWJlbAogKiBAcGFyYW0ge251bWJlcn0gdnMgdGhlIHN0YXJ0ICh0b3ApIHBpeGVsIHZhbHVlIGZvciB0aGUgdmVydGljYWwgYXhpcwogKiBAcGFyYW0ge251bWJlcn0gdmUgdGhlIGVuZCAoYm90dG9tKSBwaXhlbCB2YWx1ZSBmb3IgdGhlIHZlcnRpY2FsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IGhzTGFiZWw/IGFuIG9wdGlvbmFsIGxhYmVsIGZvciB0aGUgc3RhcnQgKGxlZnQpIG9mIHRoZSBob3Jpem9udGFsIGF4aXMKICogQHBhcmFtIHtzdHJpbmd9IGhlTGFiZWw/IGFuIG9wdGlvbmFsIGxhYmVsIGZvciB0aGUgZW5kIChyaWdodCkgb2YgdGhlIGhvcml6b250YWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gdnNMYWJlbD8gYW4gb3B0aW9uYWwgbGFiZWwgZm9yIHRoZSBzdGFydCAodG9wKSBvZiB0aGUgdmVydGljYWwgYXhpcwogKiBAcGFyYW0ge3N0cmluZ30gdmVMYWJlbD8gYW4gb3B0aW9uYWwgbGFiZWwgZm9yIHRoZSBlbmQgKGJvdHRvbSkgb2YgdGhlIHZlcnRpY2FsIGF4aXMKICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiBheGVzKAogIGhMYWJlbCwKICBocywKICBoZSwKICB2TGFiZWwsCiAgdnMsCiAgdmUsCiAgaHNMYWJlbCA9IGZhbHNlLAogIGhlTGFiZWwgPSBmYWxzZSwKICB2c0xhYmVsID0gZmFsc2UsCiAgdmVMYWJlbCA9IGZhbHNlCikgewogIGxpbmUoaHMsIDAsIGhlLCAwKTsKICBsaW5lKDAsIHZzLCAwLCB2ZSk7CgogIGNvbnN0IGhwb3MgPSAwIC0gNTsKICB0ZXh0KGAke2hMYWJlbH0g4oaSYCwgd2lkdGggLyAyICsgNSwgaHBvcywgUklHSFQpOwogIHRleHQoaHNMYWJlbCA/IGhzTGFiZWwgOiBocywgaHMsIGhwb3MsIFJJR0hUKTsKICB0ZXh0KGhlTGFiZWwgPyBoZUxhYmVsIDogaGUsIGhlLCBocG9zLCBSSUdIVCk7CgogIGNvbnN0IHZwb3MgPSAtNTsKICBzYXZlKCk7CiAgdHJhbnNsYXRlKHZwb3MsIGhlaWdodCAvIDIpOwogIHJvdGF0ZSgtUEkgLyAyKTsKICB0ZXh0KGAke3ZMYWJlbH1gLCAwLCAwLCBMRUZUKTsKICByZXN0b3JlKCk7CiAgdGV4dChg4oaTYCwgdnBvcywgaGVpZ2h0IC8gMiArIDE2LCBSSUdIVCk7CiAgdGV4dCh2c0xhYmVsID8gdnNMYWJlbCA6IHZzLCB2cG9zLCB2cyArIDUsIFJJR0hUKTsKICB0ZXh0KHZlTGFiZWwgPyB2ZUxhYmVsIDogdmUsIHZwb3MsIHZlLCBSSUdIVCk7Cn0KCi8qKgogKiBEcmF3IG9uZSBvciBtb3JlIEJlemllciBjdXJ2ZXMgZnJvbSBhbiBhcnJheQogKiBvZiBQb2ludCBvciBQb2ludC1saWtlcyB0aGF0IGltcGxlbWVudDoKICoKICogYGBgCiAqIHsKICogICB4OiBudW1iZXIKICogICB5OiBudW1iZXIKICogfQogKiBgYGAKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYCNGMDAyYCk7CiAqICAgICAgIGJlemllcigKICogICAgICAgICBuZXcgUG9pbnQoMjAsIGhlaWdodCAtIDU1KSwKICogICAgICAgICBuZXcgUG9pbnQoMjAsIDI1KSwKICogICAgICAgICB7IHg6IHdpZHRoIC0gMjAsIHk6IDI1fSwKICogICAgICAgICB7IHg6IHdpZHRoIC0gMjAsIHk6IGhlaWdodCAtIDU1fQogKiAgICAgICApOwogKiAgICAgICBub0ZpbGwoKQogKiAgICAgICBiZXppZXIoCiAqICAgICAgICAgbmV3IFBvaW50KDAsIGhlaWdodCAtIDIwKSwKICogICAgICAgICBuZXcgUG9pbnQod2lkdGggLSAyMCwgaGVpZ2h0IC0gMjApLAogKiAgICAgICAgIHsgeDogMjAsIHk6IDIwfSwKICogICAgICAgICB7IHg6IHdpZHRoLCB5OiAyMH0KICogICAgICAgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcls4XX0gLi4uY29vcmRpbmF0ZXMgRWlnaHQgeCwgeSB2YWx1ZXMuCiAqIEBwYXJhbSB7bnVtYmVyWzZuXX0gLi4uYWRkaXRpb25hbENvb3JkaW5hdGVzPyBNdWx0aXBsZXMgb2Ygc2l4IHgsIHkgdmFsdWVzLgogKgogKiBAcGFyYW0ge1BvaW50TGlrZVs0XX0gLi4uY29vcmRpbmF0ZXMgRm91ciB7eCx5fSBjb29yZGluYXRlcy4KICogQHBhcmFtIHtQb2ludExpa2VbM25dfSAuLi5hZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IE11bHRpcGxlcyBvZiB0aHJlZSB7eCx5fSBjb29yZGluYXRlcy4KICoKICogQHNlZSB7QGxpbmsgYnNwbGluZX0KICogQHNlZSB7QGxpbmsgc3BsaW5lfQogKi8KZnVuY3Rpb24gYmV6aWVyKC4uLmFyZ3MpIHsKICBsZXQgcG9pbnRzID0gYXJnczsKCiAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBgbnVtYmVyYCkgewogICAgcG9pbnRzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgcG9pbnRzLnB1c2goeyB4OiBhcmdzW2ldLCB5OiBhcmdzW2kgKyAxXSB9KTsKICAgIH0KICB9CgogIGNvbnN0IGIgPSAodCwgYSwgYiwgYywgZCkgPT4gewogICAgY29uc3QgbXQgPSAxIC0gdDsKICAgIHJldHVybiBhICogbXQgKiogMyArIDMgKiBiICogbXQgKiogMiAqIHQgKyAzICogYyAqIG10ICogdCAqKiAyICsgZCAqIHQgKiogMzsKICB9OwoKICBsZXQgW3AwLCAuLi5yZXN0XSA9IHBvaW50czsKICBzdGFydCgpOwogIGZvciAobGV0IGkgPSAwLCBlID0gcmVzdC5sZW5ndGg7IGkgPCBlOyBpICs9IDMpIHsKICAgIGxldCBbcDEsIHAyLCBwM10gPSByZXN0LnNsaWNlKGksIGkgKyAzKTsKICAgIGlmIChwMSAmJiBwMiAmJiBwMykgewogICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IDE7IHQgKz0gMC4wMSkgewogICAgICAgIHZlcnRleChiKHQsIHAwLngsIHAxLngsIHAyLngsIHAzLngpLCBiKHQsIHAwLnksIHAxLnksIHAyLnksIHAzLnkpKTsKICAgICAgfQogICAgICB2ZXJ0ZXgocDMueCwgcDMueSk7CiAgICAgIHAwID0gcDM7CiAgICB9CiAgfQogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIEItc3BsaW5lIHVzaW5nIGZvdXIgb3IgbW9yZSBQb2ludCBvcgogKiBQb2ludC1saWtlcyB0aGF0IGltcGxlbWVudDoKICoKICogYGBgCiAqIHsKICogICB4OiBudW1iZXIKICogICB5OiBudW1iZXIKICogfQogKiBgYGAKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICByYW5nZSgwLCBUQVUsIFBJIC8gNSwgKGEpID0+IHBvaW50cy5wdXNoKAogKiAgICAgICAgIG5ldyBQb2ludCgKICogICAgICAgICAgIHJhbmRvbSgzMCkgKyA1MCAqIGNvcyhhKSwKICogICAgICAgICAgIHJhbmRvbSgzMCkgKyA1MCAqIHNpbihhKQogKiAgICAgICAgICkKICogICAgICAgKSk7CiAqICAgICAgIHNldE1vdmFibGUoLi4ucG9pbnRzKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGggLyAyLCBoZWlnaHQgLyAyKTsKICogICAgICAgbm9TdHJva2UoKTsKICogICAgICAgc2V0RmlsbChgIzAwMDJgKTsKICogICAgICAgYnNwbGluZSguLi5wb2ludHMpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHBvaW50cy5mb3JFYWNoKHAgPT4gcG9pbnQocCkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyWzhdfSAuLi5jb29yZGluYXRlcyBFaWdodCB4LCB5IHZhbHVlcy4KICogQHBhcmFtIHtudW1iZXJbMm5dfSAuLi5hZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IE11bHRpcGxlcyBvZiB4LCB5IHZhbHVlcy4KICoKICogQHBhcmFtIHtQb2ludExpa2VbNF19IC4uLmNvb3JkaW5hdGVzIEZvdXIge3gseX0gY29vcmRpbmF0ZXMuCiAqIEBwYXJhbSB7UG9pbnRMaWtlW25dfSAuLi5hZGRpdGlvbmFsQ29vcmRpbmF0ZXM/IFplcm8gb3IgbW9yZSB7eCx5fSBjb29yZGluYXRlcy4KICoKICogQHNlZSB7QGxpbmsgYmV6aWVyfQogKiBAc2VlIHtAbGluayBzcGxpbmV9CiAqLwoKZnVuY3Rpb24gYnNwbGluZSguLi5hcmdzKSB7CiAgbGV0IG9wZW4gPSB0cnVlOwogIGlmICh0eXBlb2YgYXJnc1thcmdzLmxlbmd0aCAtIDFdID09PSBgYm9vbGVhbmApIHsKICAgIG9wZW4gPSBhcmdzLnNwbGljZShhcmdzLmxlbmd0aCAtIDEsIDEpWzBdOwogIH0KCiAgbGV0IHBvaW50cyA9IGFyZ3M7CgogIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gYG51bWJlcmApIHsKICAgIHBvaW50cyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHBvaW50cy5wdXNoKHsgeDogYXJnc1tpXSwgeTogYXJnc1tpICsgMV0gfSk7CiAgICB9CiAgfQoKICBzdGFydCgpOwogIG5ldyBCU3BsaW5lKHBvaW50cywgb3BlbikuZ2V0TFVUKCkuZm9yRWFjaCgocCkgPT4gdmVydGV4KHAueCwgcC55KSk7CiAgZW5kKCk7Cn0KCi8qKgogKiBEcmF3IGEgY2lyY2xlIHdpdGggcmFkaXVzIGByYCBhdCBgeCx5YC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYCNGMDAyYCk7CiAqICAgICAgIGNpcmNsZSh3aWR0aC8yLCBoZWlnaHQvMiwgODApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBjaXJjbGUncyBjZW50ZXIgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgY2lyY2xlJ3MgY2VudGVyIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHIgVGhlIGNpcmNsZSdzIHJhZGl1cyBpbiBwaXhlbHMKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIGNpcmNsZSdzIGNlbnRlciB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSByIFRoZSBjaXJjbGUncyByYWRpdXMgaW4gcGl4ZWxzCiAqCiAqIEBzZWUge0BsaW5rIGFyY30KICovCmZ1bmN0aW9uIGNpcmNsZSh4LCB5LCByKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICByID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBhcmMoeCwgeSwgciwgMCwgVEFVLCBmYWxzZSk7Cn0KCi8qKgogKiBDbGVhciB0aGUgY2FudmFzLCBhbmQgc2V0IGl0IHRvIGEgc3BlY2lmaWMgKENTUykgY29sb3VyLgogKiBJZiBubyBgbm9HcmlkKClgIGNhbGwgd2FzIG1hZGUsIHRoaXMgd2lsbCB0aGVuIGFsc28gZHJhdwogKiB0aGUgYmFja2dyb3VuZCBncmlkLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHBpbmtgKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge2NvbG9yfSBjb2xvcj8gVGhlIChDU1MpIGJhY2tncm91bmQgY29sb3IgdG8gdXNlIChkZWZhdWx0ID0gYHdoaXRlYCkKICovCmZ1bmN0aW9uIGNsZWFyKGNvbG9yID0gYHdoaXRlYCkgewogIHNhdmUoKTsKICBfX2NhbnZhcy5zdHlsZS5iYWNrZ3JvdW5kID0gY29sb3I7CiAgX19jYW52YXMud2lkdGggPSB3aWR0aDsKICBfX2N0eCA9IF9fY2FudmFzLmdldENvbnRleHQoYDJkYCk7CiAgaWYgKF9fZHJhd19ncmlkKSBncmlkKCk7CiAgcmVzdG9yZSgpOwp9CgovKioKICogQ291bnRlcnBhcnQgdG8gc3RhcnQoKSwgZmluYWxpemVzIHRoZSBjdXJyZW50IHNoYXBlIGFuZAogKiBjb2xvdXJzIGl0LiBJZiBgY2xvc2VgIGlzIHRydWUsIGl0IHdpbGwgY2xvc2UgdGhlIHBhdGgKICogYmVmb3JlIGNvbG91cmluZy4KICoKICogSWYgYG5vRmlsbCgpYCBpcyBpbiBlZmZlY3QsIHRoZSBzaGFwZSB3aWxsIG5vdCBiZSBmaWxsZWQuCiAqIGlmIGBub1N0cm9rZSgpYCBpcyBpbiBlZmZlY3QsIHRoZSBzaGFwZSBvdXRsaW5lIHdpbGwgbm90IGJlIGNvbG91cmVkLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgZ29sZGApOwogKiAgICAgICBzdGFydCgpOwogKiAgICAgICB2ZXJ0ZXgoMCxoZWlnaHQvMik7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCAwKTsKICogICAgICAgdmVydGV4KHdpZHRoLCBoZWlnaHQvMik7CiAqICAgICAgIHZlcnRleCh3aWR0aC8yLCBoZWlnaHQpOwogKiAgICAgICBlbmQodHJ1ZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtib29sZWFufSBjbG9zZT8gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IHRvIGNsb3NlIHRoZSBwYXRoIChkZWZhdWx0ID0gZmFsc2UpCiAqCiAqIEBzZWUge0BsaW5rIHN0YXJ0fQogKiBAc2VlIHtAbGluayB2ZXJ0ZXh9CiAqLwpmdW5jdGlvbiBlbmQoY2xvc2UgPSBmYWxzZSkgewogIGlmIChjbG9zZSkgX19jdHguY2xvc2VQYXRoKCk7CiAgX19jdHguZmlsbCgpOwogIF9fY3R4LnN0cm9rZSgpOwogIGlmIChfX2N0eC5saW5lV2lkdGggJSAyID09PSAxKSB7CiAgICBfX2N0eC50cmFuc2xhdGUoLTAuNSwgLTAuNSk7CiAgfQp9CgovKioKICogRHJhdyBhbiBpbWFnZSBpbiBhIGdpdmVuIGxvY2F0aW9uIHdpdGggYW4gb3B0aW9uYWwKICogd2lkdGggYW5kIGhlaWdodC4gSWYgb21pdHRlZCwgdGhlIHdpZHRoIGFuZCBoZWlnaHQKICogd2lsbCBiZSB0aGUgaW1hZ2UncyBvd24gZGltZW5zaW9ucy4gTm90ZSB0aGF0IHRoZQogKiBpbWFnZSBtYXkgYmUgZWl0aGVyIGEgVVJMLCBvciBhbiA8aW1nPiBlbGVtZW50LgogKgogKiBOb3RlIHRoYXQgdGhpcyBpcyBhbiBhc3luYyBmdW5jdGlvbjogaWYgaXQgaXMgaW1wb3J0YW50CiAqIHRoYXQgbm90aGluZyBnZXRzIGRyYXduIHVudGlsIHRoZSBpbWFnZSBoYXMgYmVlbiBkcmF3biwKICogcmVtZW1iZXIgdG8gYGF3YWl0YCBpdHMgY2FsbC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGFzeW5jIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBhd2FpdCBpbWFnZShgaHR0cHM6Ly9kdW1teWltYWdlLmNvbS8xMDB4MTAwYCwgNTAsIDUwLCAxMDAsIDEwMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtJbWFnZXxzdHJpbmd9IGltZ09yVVJMIFRoZSBpbWFnZSB0byBkcmF3IGVpdGhlciBhcyBJbWFnZSBvYmplY3QsIG9yIGltYWdlIFVSTC4KICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGRyYXcgcG9zaXRpb24ncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBkcmF3IHBvc2l0aW9uJ3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gdyBUaGUgd2lkdGggb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcGFyYW0ge251bWJlcn0gaCBUaGUgaGVpZ2h0IG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHJldHVybnMge0ltYWdlfSBUaGUgZHJhd24gaW1hZ2UKICoKICogQHBhcmFtIHtJbWFnZXxzdHJpbmd9IGltZ09yVVJMIFRoZSBpbWFnZSB0byBkcmF3IGVpdGhlciBhcyBJbWFnZSBvYmplY3QsIG9yIGltYWdlIFVSTC4KICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIGRyYXcgcG9zaXRpb24gYXMge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge251bWJlcn0gdyBUaGUgd2lkdGggb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKiBAcGFyYW0ge251bWJlcn0gaCBUaGUgaGVpZ2h0IG92ZXIgd2hpY2ggdG8gZHJhdyB0aGUgaW1hZ2UKICogQHJldHVybnMge0ltYWdlfSBUaGUgZHJhd24gaW1hZ2UKICovCmFzeW5jIGZ1bmN0aW9uIGltYWdlKGltZywgeCA9IDAsIHkgPSAwLCB3LCBoKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICBoID0gdzsKICAgIHcgPSB5OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBpZiAodHlwZW9mIGltZyA9PT0gYHN0cmluZ2ApIHsKICAgIGltZyA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgY29uc3QgdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgaW1nYCk7CiAgICAgIHRhZy5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKHRhZyk7CiAgICAgIHRhZy5vbmVycm9yID0gKCkgPT4gcmVqZWN0KCk7CiAgICAgIHRhZy5zcmMgPSBpbWc7CiAgICB9KTsKICB9CiAgX19jdHguZHJhd0ltYWdlKGltZywgeCwgeSwgdyB8fCBpbWcud2lkdGgsIGggfHwgaW1nLmhlaWdodCk7CiAgcmV0dXJuIGltZzsKfQoKLyoqCiAqIERyYXcgYSBsaW5lIGZyb20gb25lIGNvb3JkaW5hdGUgdG8gYW5vdGhlci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHJhbmdlKDAsaGVpZ2h0LDIwLCAoaSkgPT4gbGluZSgwLCAwLCB3aWR0aCwgaSkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4MSBUaGUgZmlyc3QgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MSBUaGUgZmlyc3QgcG9pbnQncyB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB4MiBUaGUgc2Vjb25kIHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTIgVGhlIHNlY29uZCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAxIFRoZSBmaXJzdCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtQb2ludExpa2V9IHAyIFRoZSBzZWNvbmQgcG9pbnQncyB7eCx5fSBjb29yZGluYXRlCiAqLwpmdW5jdGlvbiBsaW5lKHgxLCB5MSwgeDIsIHkyKSB7CiAgaWYgKHgxLnggIT09IHVuZGVmaW5lZCAmJiB4MS55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkyID0geTEueTsKICAgIHgyID0geTEueDsKICAgIHkxID0geDEueTsKICAgIHgxID0geDEueDsKICB9CgogIHN0YXJ0KCk7CiAgdmVydGV4KHgxLCB5MSk7CiAgdmVydGV4KHgyLCB5Mik7CiAgZW5kKCk7Cn0KCi8qKgogKiBQbG90IGEgeT1mKHgpIGZ1bmN0aW9uLiBUaGUgaW5wdXQgdG8gdGhlIGZ1bmN0aW9uCiAqIHdpbGwgc3BhbiB0aGUgaW50ZXJ2YWwgW2EsYl0gdXNpbmcgdGhlIGluZGljYXRlZAogKiBudW1iZXIgb2Ygc3RlcHMsIGFuZCB0aGUgcmUgc3VsdCBtYXkgYmUgc2NhbGVkIGJvdGgKICogaW4gdGhlIHggYW5kIHkgZGlyZWN0aW9uIGluIG9yZGVyIHRvIGRyYXcgc29tZXRoaW5nCiAqIHRoYXQgeW91IGNhbiBhY3R1YWxseSBzZWUgKGUuZy4gaWYgeW91J3JlIHBsb3R0aW5nCiAqIHRvIHRoZSBkb21haW4gWzAsMV0geW91IHdvdWxkbid0IGJlIGFibGUgdG8gc2VlIHRoZQogKiByZXN1bHQgd2l0aG91dCBzY2FsaW5nKS4KICoKICogVGhpcyBmdW5jdGlvbiBpcyBhd2FyZSBvZiwgYW5kIHdpbGwgcGxvdCwgZGlzY29udGludWl0aWVzCiAqIHVzaW5nIHRoZSBzdGFuZGFyZCBvcGVuIGNpcmNsZSBub3RhdGlvbiwgdW5sZXNzIGluc3RydWN0ZWQKICogbm90IHRvIGRvIHNvIHVzaW5nIHRoZSBgaWdub3JlRGlzY29udGludWl0eWAgYm9vbGVhbiBmbGFnLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHRyYW5zbGF0ZSgwLCBoZWlnaHQgLyAyKTsKICogICAgICAgY29uc3QgZm4gPSAoeCkgPT4gY29zKHgpICoqIDYgLyBzaW4oeCkgLSBzaW4oeCkvMjsKICogICAgICAgcGxvdChmbiwgMCwgMipUQVUsIDEyMCwgd2lkdGggLyBUQVUsIGhlaWdodCAvIDIpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IGYgdGhlIGB5ID0gZih4KWAgZnVuY3Rpb24gdG8gcGxvdAogKiBAcGFyYW0ge251bWJlcn0gYT8gVGhlIGxvd2VyIGJvdW5kIGZvciB0aGUgaW5wdXQgdmFsdWUgKGRlZmF1bHQgPSAwKQogKiBAcGFyYW0ge251bWJlcn0gYj8gVGhlIHVwcGVyIGJvdW5kIGZvciB0aGUgaW5wdXQgdmFsdWUgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0ge251bWJlcn0gc3RlcHM/IFRoZSBudW1iZXIgb2YgcGxvdCBwb2ludHMgdG8gcGxvdCBvdmVyIHRoZSBpbnRlcnZhbCBbYSxiXSAoZGVmYXVsdCA9IDEwMCkKICogQHBhcmFtIHtudW1iZXJ9IHhzY2FsZT8gQW4gb3B0aW9uYWwgc2NhbGluZyBmYWN0b3IgdG8gYXBwbHkgdG8gZWFjaCBwbG90IHBvaW50J3MgeCB2YWx1ZSAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSB7bnVtYmVyfSB5c2NhbGU/IEFuIG9wdGlvbmFsIHNjYWxpbmcgZmFjdG9yIHRvIGFwcGx5IHRvIGVhY2ggcGxvdCBwb2ludCdzIHkgdmFsdWUgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0ge2Jvb2xlYW59IGlnbm9yZURpc2NvbnRpbnVpdHk/IERvIG5vdCBkcmF3IHNwZWNpYWwgZWxlbWVudHMgZm9yIGRpc2NvbnRpbnVpdGllcyAoZGVmYXVsdCA9IGZhbHNlKQogKgogKiBAc2VlIHtAbGluayBwbG90RGF0YX0KICovCmZ1bmN0aW9uIHBsb3QoCiAgZiwKICBhID0gMCwKICBiID0gMSwKICBzdGVwcyA9IDEwMCwKICB4c2NhbGUgPSAxLAogIHlzY2FsZSA9IDEsCiAgaWdub3JlRGlzY29udGludWl0eSA9IGZhbHNlCikgewogIGNvbnN0IGludGVydmFsID0gYiAtIGE7CiAgc3RhcnQoKTsKICBsZXQgW3B5LCBkeSwgcGR5XSA9IFswLCAwLCAwXTsKICBjb25zdCBzdGVwID0gaW50ZXJ2YWwgLyAoc3RlcHMgLSAxKTsKICBjb25zdCBkaXNjb250aW51aXR5ID0gKGksIHgsIHkpID0+IHsKICAgIGVuZCgpOwogICAgc2F2ZSgpOwogICAgbm9GaWxsKCk7CiAgICBwb2ludCh4ICogeHNjYWxlLCBweSAqIHlzY2FsZSk7CiAgICBwb2ludCh4ICogeHNjYWxlLCB5ICogeXNjYWxlKTsKICAgIHJlc3RvcmUoKTsKICAgIHN0YXJ0KCk7CiAgfTsKICBmb3IgKGxldCBpID0gMCwgeCwgeTsgaSA8IHN0ZXBzOyBpKyspIHsKICAgIHggPSBhICsgaSAqIHN0ZXA7CiAgICB5ID0gZih4KTsKICAgIC8vIElmIGYoeCkgY2hhbmdlcyBpbiB2aW9sYXRpb24gb2Ygd2hhdCBpdHMgZicoeCkgc3VnZ2VzdGVkLAogICAgLy8gdGhhdCdzIGEgZGlzY29udGludWl0eSBhbmQgd2UgZHJhdyBhbiBhc3ltcHRvdGUuCiAgICBkeSA9ICh5IC0gcHkpICogc3RlcDsKICAgIGlmICghaWdub3JlRGlzY29udGludWl0eSkgewogICAgICBpZiAocGR5ICE9PSBudWxsICYmIHNpZ24oeSAtIHB5KSAhPT0gc2lnbihwZHkpICYmIGFicyhwZHkpID4gMC4wMSkgewogICAgICAgIGRpc2NvbnRpbnVpdHkoaSwgeCwgeSk7CiAgICAgICAgcGR5ID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICBwZHkgPSBkeTsKICAgICAgfQogICAgfQogICAgdmVydGV4KHggKiB4c2NhbGUsIHkgKiB5c2NhbGUpOwogICAgcHkgPSB5OwogIH0KICBlbmQoKTsKfQoKLyoqCiAqIFBsb3QgYSAyRCBncmFwaCB1c2luZyBhIGNvbGxlY3Rpb24gb2YgYW55LWRpbWVuc2lvbmFsIGRhdGEsCiAqIGJ5IGluZGljYXRpbmcgd2hpY2ggZGltZW5zaW9uIHNob3VsZCBiZSB0cmVhdGVkIGFzIHRoZSBgeGAKICogYW5kIHdoaWNoIGRpbWVuc2lvbiBzaG91bGQgYmUgdHJlYXRlZCBhcyB0aGUgYHlgLiBJZiBubyBgeGAKICogYW5kIGB5YCBhcmUgcHJvdmlkZWQsIGBkYXRhYCB3aWxsIGJlIHRyZWF0ZWQgYSAxRCBhcnJheSBhbmQKICogd2lsbCBwbG90IHdpdGggdGhlIGFycmF5IGluZGV4IGFzIGB4YCBhbmQgZWxlbWVudCBhdCB0aGF0CiAqIGluZGV4IGFzIGB5YC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgdHJhbnNsYXRlKDAsIGhlaWdodC8yKTsKICoKICogICAgICAgc2V0U3Ryb2tlKGBkYXJrZ3JlZW5gKTsKICogICAgICAgbGV0IGRhdGEgPSBhcnJheSh3aWR0aCwgKGkpID0+IFtpLCBoZWlnaHQvMiAqIHNpbihpLzI1KV0pOwogKiAgICAgICBwbG90RGF0YShkYXRhLCAwLCAxKTsKICoKICogICAgICAgc2V0U3Ryb2tlKGBwdXJwbGVgKTsKICogICAgICAgZGF0YSA9IGFycmF5KHdpZHRoLCAoaSkgPT4gKHsKICogICAgICAgICBtZWVwOiBpLAogKiAgICAgICAgIG1vb3A6IGhlaWdodC8yICogY29zKGkvMjUpCiAqICAgICAgIH0pKTsKICogICAgICAgcGxvdERhdGEoZGF0YSwgYG1lZXBgLCBgbW9vcGApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7b2JqZWN0W119IGRhdGEgVGhlIGFueS1kaW1lbnNpb25hbCBkYXRhIGZyb20gd2hpY2ggdG8gcGxvdCBvbmUgZGltZW5zaW9uIGFnYWluIGFub3RoZXIKICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSB4PyBUaGUgcHJvcGVydHkgbmFtZSBvciBpbmRpdmlkdWFsIGVsZW1lbnQgYXJyYXkgaW5kZXggdG8gdXNlIGFzIHggZGltZW5zaW9uCiAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30geT8gVGhlIHByb3BlcnR5IG5hbWUgb3IgaW5kaXZpZHVhbCBlbGVtZW50IGFycmF5IGluZGV4IHRvIHVzZSBhcyB5IGRpbWVuc2lvbgogKgogKiBAc2VlIHtAbGluayBwbG90fQogKi8KZnVuY3Rpb24gcGxvdERhdGEoZGF0YSwgeCwgeSkgewogIHN0YXJ0KCk7CiAgaWYgKHggIT09IHVuZGVmaW5lZCAmJiB5ICE9PSB1bmRlZmluZWQpIHsKICAgIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgICB5ID0geC55OwogICAgICB4ID0geC54OwogICAgfQogICAgZGF0YS5mb3JFYWNoKChwKSA9PiB2ZXJ0ZXgocFt4XSwgcFt5XSkpOwogIH0gZWxzZSB7CiAgICBkYXRhLmZvckVhY2goKHksIHgpID0+IHZlcnRleCh4LCB5KSk7CiAgfQogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIHBvaW50IChlaXRoZXIgZnJvbSB4L3kgb3IgcG9pbnQtbGlrZSkuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcmFuZ2UoMCwgVEFVLCAoYSkgPT4gewogKiAgICAgICAgIHBvaW50KDQwICogY29zKGEpLCA0MCAqIHNpbihhKSk7CiAqICAgICAgIH0pOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBwb2ludCdzIGNlbnRlciB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBwb2ludCdzIGNlbnRlciB5IHBpeGVsIHZhbHVlCiAqCiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSBwb2ludCdzIGNlbnRlciB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBzZWUge0BsaW5rIGNpcmNsZX0KICovCmZ1bmN0aW9uIHBvaW50KHgsIHkpIHsKICBpZiAoeC54ICE9PSB1bmRlZmluZWQgJiYgeC55ICE9PSB1bmRlZmluZWQpIHsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBjaXJjbGUoeCwgeSwgMyk7Cn0KCi8qKgogKiBEcmF3IGEgcmVjdGFuZ2xlIGF0IHRoZSBzcGVjaWZpZWQgY29vcmRpbmF0ZSwgd2l0aAogKiB0aGUgc3BlY2lmaWMgd2lkdGggYW5kIGhlaWdodC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYHJlZGApOwogKiAgICAgICByZWN0KDQwLCA0MCwgd2lkdGggLSA4MCwgaGVpZ2h0IC0gODApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSByZWN0J3MgY29ybmVyICB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSByZWN0J3MgY29ybmVyICB5IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB3IFRoZSB3aWR0aCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEBwYXJhbSB7bnVtYmVyfSBoIFRoZSBoZWlnaHQgb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgcmVjdDtzIGNvcmRlciB7eCx5fSBjb29yZGluYXRlCiAqIEBwYXJhbSB7bnVtYmVyfSB3IFRoZSB3aWR0aCBvdmVyIHdoaWNoIHRvIGRyYXcgdGhlIGltYWdlCiAqIEBwYXJhbSB7bnVtYmVyfSBoIFRoZSBoZWlnaHQgb3ZlciB3aGljaCB0byBkcmF3IHRoZSBpbWFnZQogKi8KZnVuY3Rpb24gcmVjdCh4LCB5LCB3LCBoKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICBoID0gdzsKICAgIHcgPSB5OwogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBzdGFydCgpOwogIHZlcnRleCh4LCB5KTsKICB2ZXJ0ZXgoeCArIHcsIHkpOwogIHZlcnRleCh4ICsgdywgeSArIGgpOwogIHZlcnRleCh4LCB5ICsgaCk7CiAgdmVydGV4KHgsIHkpOwogIGVuZCgpOwp9CgovKioKICogRHJhdyBhIGNhcmRpbmFsIChoZXJtaXRlKSBzcGxpbmUgdGhhdCBwYXNzZXMgdGhyb3VnaCBlYWNoCiAqIHBvaW50IHByb3ZpZGVkLCB1c2luZyBhIG1hdGhlbWF0aWNhbGx5IHZpcnR1YWwgc3RhcnQgYW5kCiAqIGVuZCB0byBlbnN1cmUgdGhlIGN1cnZlIHN0YXJ0cyBhbmQgZW5kcyBhdCB0aGUgcHJvdmlkZWQKICogc3RhcnQgYW5kIGVuZCBwb2ludC4gVGhpcyBjYW4gYmUgYnlwYXNzZWQgYnkgc2V0dGluZwogKiB0aGUgYHZpcnR1YWxgIGFyZ3VtZW50IHRvIGBmYWxzZWAuCiAqCiAqIEFkZGl0aW9uYWxseSwgdGhlIHNwbGluZSdzIHRpZ2h0bmVzcywgd2hpY2ggY29udHJvbHMKICogaG93ICJiZW5keSIgdGhlIHNwbGluZSBpcyAodGhlIHRpZ2h0ZXIgdGhlIHNwbGluZSwKICogdGhlIHNoYXJwZXIgYmVuZHMgYmVjb21lKSBjYW4gYmUgY29udHJvbGxlZCBieSBzZXR0aW5nCiAqIHRoZSBgdGlnaHRuZXNzYCB2YWx1ZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICByYW5nZSgwLCBUQVUsIFBJIC8gNSwgKGEpID0+IHBvaW50cy5wdXNoKAogKiAgICAgICAgIG5ldyBQb2ludCgKICogICAgICAgICAgIHJhbmRvbSgzMCkgKyA1MCAqIGNvcyhhKSwKICogICAgICAgICAgIHJhbmRvbSgzMCkgKyA1MCAqIHNpbihhKQogKiAgICAgICAgICkKICogICAgICAgKSk7CiAqICAgICAgIHNldE1vdmFibGUoLi4ucG9pbnRzKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGggLyAyLCBoZWlnaHQgLyAyKTsKICogICAgICAgc2V0RmlsbChgIzAwMDJgKTsKICogICAgICAgc3BsaW5lKC4uLnBvaW50cyk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgcG9pbnRzLmZvckVhY2gocCA9PiBwb2ludChwKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICoKICogQHBhcmFtIHtQb2ludExpa2VbXX0gLi4ucG9pbnRzIFRoZSBwb2ludHMgYWNyb3NzIHdoaWNoIHRvIGZpdCBhIHNwbGluZQogKiBAcGFyYW0ge2Jvb2xlYW59IHZpcnR1YWw/IFdoZXRoZXIgb3Igbm90IHRvIGludmVudCBuZXcgbWF0aGVtYXRpY2FsIHBvaW50cyB0aGF0IGVuc3VyZSB0aGUgY3VydmUgc3RhcnRzIGFuZCBlbmRzIGF0IHRoZSBwcm92aWRlZCBzdGFydCBhbmQgZW5kIHBvaW50cy4gKGRlZmF1bHQgPSB0cnVlKQogKiBAcGFyYW0ge251bWJlcn0gdGlnaHRuZXNzPyBIb3cgdGlnaHQgdGhpcyBzcGxpbmUgc2hvdWxkIGJlIGZpdCB0aHJvdWdoIHRoZSBwb2ludHMgcHJvdmlkZWQuIFRoZSBoaWdoZXIgdGhlIHRpZ2h0bmVzcywgdGhlIG1vcmUgcG9seWdvbmFsIHRoZSBjdXJ2ZSBiZWNvbWVzIChkZWZhdWx0ID0gMSkKICoKICogQHNlZSB7QGxpbmsgYmV6aWVyfQogKiBAc2VlIHtAbGluayBic3BsaW5lfQogKi8KZnVuY3Rpb24gc3BsaW5lKC4uLmFyZ3MpIHsKICBsZXQgcG9pbnRzID0gYXJnczsKICBsZXQgdmlydHVhbCA9IHRydWU7CiAgbGV0IFQgPSAxOwoKICBpZiAodHlwZW9mIGFyZ3NbYXJncy5sZW5ndGggLSAxXSA9PT0gYGJvb2xlYW5gKSB7CiAgICBbdmlydHVhbF0gPSBhcmdzLnNwbGljZShhcmdzLmxlbmd0aCAtIDEsIDEpOwogIH0KCiAgaWYgKHR5cGVvZiBhcmdzW2FyZ3MubGVuZ3RoIC0gMl0gPT09IGBib29sZWFuYCkgewogICAgW3ZpcnR1YWwsIFRdID0gYXJncy5zcGxpY2UoYXJncy5sZW5ndGggLSAyLCAyKTsKICB9CgogIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gYG51bWJlcmApIHsKICAgIHBvaW50cyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHBvaW50cy5wdXNoKHsgeDogYXJnc1tpXSwgeTogYXJnc1tpICsgMV0gfSk7CiAgICB9CiAgfQoKICBsZXQgY3BvaW50cyA9IHBvaW50czsKICBpZiAodmlydHVhbCkgewogICAgY29uc3QgZjAgPSBwb2ludHNbMF0sCiAgICAgIGYxID0gcG9pbnRzWzFdLAogICAgICBmMiA9IHBvaW50c1syXSwKICAgICAgZnNtID0gbmV3IFZlY3RvcihmMC54IC8gMiArIGYyLnggLyAyLCBmMC55IC8gMiArIGYyLnkgLyAyKSwKICAgICAgZjByID0gbmV3IFZlY3RvcihmMCkucmVmbGVjdChmMSksCiAgICAgIGZzciA9IGZzbS5yZWZsZWN0KGYxKSwKICAgICAgZm4gPSBuZXcgVmVjdG9yKGYwci54IC8gMiArIGZzci54IC8gMiwgZjByLnkgLyAyICsgZnNyLnkgLyAyKSwKICAgICAgbDIgPSBwb2ludHMuYXQoLTMpLAogICAgICBsMSA9IHBvaW50cy5hdCgtMiksCiAgICAgIGwwID0gcG9pbnRzLmF0KC0xKSwKICAgICAgbHNtID0gbmV3IFZlY3RvcihsMC54IC8gMiArIGwyLnggLyAyLCBsMC55IC8gMiArIGwyLnkgLyAyKSwKICAgICAgbDByID0gbmV3IFZlY3RvcihsMCkucmVmbGVjdChsMSksCiAgICAgIGxuID0gbmV3IFZlY3RvcihsMHIueCAvIDIgKyBsc20ueCAvIDIsIGwwci55IC8gMiArIGxzbS55IC8gMik7CiAgICBjcG9pbnRzID0gW2ZuLCAuLi5wb2ludHMsIGxuXTsKICB9CgogIC8vIGZvdXIgcG9pbnQgc2xpZGluZyB3aW5kb3cgb3ZlciB0aGUgc2VnbWVudAogIGNvbnN0IGJlemllclBvaW50cyA9IFtdOwogIGZvciAobGV0IGkgPSAwLCBlID0gY3BvaW50cy5sZW5ndGggLSAzOyBpIDwgZTsgaSsrKSB7CiAgICBsZXQgW2MxLCBjMiwgYzMsIGM0XSA9IGNwb2ludHMuc2xpY2UoaSwgaSArIDQpOwogICAgbGV0IHAyID0gewogICAgICB4OiBjMi54ICsgKGMzLnggLSBjMS54KSAvICg2ICogVCksCiAgICAgIHk6IGMyLnkgKyAoYzMueSAtIGMxLnkpIC8gKDYgKiBUKSwKICAgIH07CiAgICBsZXQgcDMgPSB7CiAgICAgIHg6IGMzLnggLSAoYzQueCAtIGMyLngpIC8gKDYgKiBUKSwKICAgICAgeTogYzMueSAtIChjNC55IC0gYzIueSkgLyAoNiAqIFQpLAogICAgfTsKICAgIGlmIChpID09PSAwKSBiZXppZXJQb2ludHMucHVzaChjMik7CiAgICBiZXppZXJQb2ludHMucHVzaChwMiwgcDMsIGMzKTsKICB9CgogIGJlemllciguLi5iZXppZXJQb2ludHMpOwp9CgovKioKICogU3RhcnRzIGEgKG5ldykgc2hhcGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogKiAgICAgICBzZXRGaWxsKGBnb2xkYCk7CiAqICAgICAgIHN0YXJ0KCk7CiAqICAgICAgIHZlcnRleCgwLGhlaWdodC8yKTsKICogICAgICAgdmVydGV4KHdpZHRoLzIsIDApOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgsIGhlaWdodC8yKTsKICogICAgICAgdmVydGV4KHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIGVuZCh0cnVlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBlbmR9CiAqIEBzZWUge0BsaW5rIHZlcnRleH0KICovCmZ1bmN0aW9uIHN0YXJ0KCkgewogIGlmIChfX2N0eC5saW5lV2lkdGggJSAyID09PSAxKSB7CiAgICBfX2N0eC50cmFuc2xhdGUoMC41LCAwLjUpOwogIH0KICBfX2N0eC5iZWdpblBhdGgoKTsKICBfX2ZpcnN0ID0gZmFsc2U7Cn0KCi8qKgogKiBEcmF3IHNvbWUgdGV4dCB0byB0aGUgc2NyZWVuLiBJdHMgcGxhY2VtZW50IGlzCiAqIGRldGVybWluZWQgYnkgYm90aCB0aGUgY29vcmRpbmF0ZSBwcm92aWRlZCwgYW5kCiAqIHRoZSB4L3kgYWxpZ25tZW50IHByb3ZpZGVkLiBWYWxpZCBgeEFsaWduYCB2YWx1ZXMKICogYXJlOgogKgogKiAtIENFTlRFUiAtIHRoZSB0ZXh0IGFuY2hvciBpcyBpbiB0aGUgbWlkZGxlIG9mIHRoZSB0ZXh0LiBUZXh0IGlzIHBsYWNlZCBldmVubHkgb24gZWl0aGVyIHNpZGUuCiAqIC0gRU5EIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSByaWdodCBmb3IgTFRSIHRleHQsIGFuZCBvbiB0aGUgbGVmdCBmb3IgUlRMIHRleHQuCiAqIC0gTEVGVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgbGVmdCBzaWRlIG9mIHRoZSB0ZXh0LiBhbGwgdGV4dCBpcyB0byB0aGUgcmlnaHQuCiAqIC0gUklHSFQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIHJpZ2h0IHNpZGUgb2YgdGhlIHRleHQuIEFsbCB0ZXh0IGlzIHRvIHRoZSBsZWZ0LgogKiAtIFNUQVJUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSBsZWZ0IGZvciBMVFIgdGV4dCwgYW5kIG9uIHRoZSByaWdodCBmb3IgUlRMIHRleHQuCiAqCiAqIFZhbGlkIGB5QWxpZ25gIHZhbHVlcyBhcmU6CiAqCiAqIC0gQUxQSEFCRVRJQyAtIHN0YW5kYXJkIHRleHQgYWxpZ25tZW50CiAqIC0gQk9UVE9NIC0gdGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgYm90dG9tIG9mIHRoZSBib3VuZGluZyBib3gKICogLSBIQU5HSU5HIC0gcmVsZXZhbnQgZm9yIFRpYmV0YW4gYW5kIG90aGVyIEluZGljIHNjcmlwdHMuCiAqIC0gSURFT0dSQVBISUMgLSByZWxldmFudCBmb3IgaWRlb2dyYXBoaWMgQ0pLViB0ZXh0LgogKiAtIE1JRERMRSAtIFRoZSB2ZXJ0aWNhbCBlcXVpdmFsZW50IG9mICJjZW50ZXIiLgogKiAtIFRPUCAtIFRoZSB0ZXh0IGlzIGFsaWduZWQgdG8gdGhlIHRvcCBvZiB0aGUgdHlwb2dyYXBoaWMgImVtIHNxdWFyZSIuCiAqCiAqIE5vdGUgdGhhdCB0aGUgcHJpbWFyeSB0ZXh0IGNvbG91ciB1c2VzIHRoZSBmaWxsIGNvbG91ci4gSWYgdGV4dAogKiBzdHJva2luZyBpcyBlbmFibGVkLCB0aGUgdGhlIHRleHQgb3V0bGluZSB3aWxsIGJlIGNvbG91cmVkIHVzaW5nCiAqIHRoZSBjdXJyZW50IHN0cm9rZSBjb2xvdXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgdGV4dCgibm9ybWFsIHRleHQiLCB3aWR0aC8yLCA2MCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgc2V0VGV4dFN0cm9rZSgxKTsKICogICAgICAgdGV4dCgidW5maWxsZWQgdGV4dCIsIHdpZHRoLzIsIDEwMCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgICBzZXRTdHJva2UoYHJlZGApOwogKiAgICAgICBzZXRGaWxsKGB5ZWxsb3dgKTsKICogICAgICAgdGV4dCgiZmFuY3kgdGV4dCIsIHdpZHRoLzIsIDE0MCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHRleHQgd2Ugd2FudCB0byBzaG93CiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSB0ZXh0IGxvY2F0aW9uJ3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgdGV4dCBsb2NhdGlvbidzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtzdHJpbmd9IHhBbGlnbj8gQW4gb3B0aW9uYWwgaG9yaXpvbnRhbCBhbGlnbm1lbnQgc3RyaW5nCiAqIEBwYXJhbSB7c3RyaW5nfSB5QWxpZ24/IEFuIG9wdGlvbmFsIHZlcnRpY2FsICBhbGlnbm1lbnQgc3RyaW5nCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHRleHQgd2Ugd2FudCB0byBzaG93CiAqIEBwYXJhbSB7UG9pbnRMaWtlfSBwIFRoZSB0ZXh0IGxvY2F0aW9uJ3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge3N0cmluZ30geEFsaWduPyBBbiBvcHRpb25hbCBob3Jpem9udGFsIGFsaWdubWVudCBzdHJpbmcKICogQHBhcmFtIHtzdHJpbmd9IHlBbGlnbj8gQW4gb3B0aW9uYWwgdmVydGljYWwgIGFsaWdubWVudCBzdHJpbmcKICoKICogQHNlZSB7QGxpbmsgc2V0VGV4dFN0cm9rZX0KICovCmZ1bmN0aW9uIHRleHQoc3RyLCB4LCB5LCB4QWxpZ24sIHlBbGlnbikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeUFsaWduID0geEFsaWduOwogICAgeEFsaWduID0geTsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgc2F2ZSgpOwogIGlmICh4QWxpZ24pIHsKICAgIHNldFRleHRBbGlnbih4QWxpZ24sIHlBbGlnbik7CiAgfQogIF9fY3R4LmZpbGxUZXh0KHN0ciwgeCwgeSk7CiAgaWYgKF9fdGV4dFN0cm9rZSkgewogICAgc2V0U3Ryb2tlKF9fdGV4dFN0cm9rZSk7CiAgICBfX2N0eC5zdHJva2VUZXh0KHN0ciwgeCwgeSk7CiAgfQogIHJlc3RvcmUoKTsKfQoKLyoqCiAqIERyYXcgYSB0cmlhbmdsZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYHJlZGApOwogKiAgICAgICB0cmlhbmdsZSh3aWR0aC8yLCAzMCwgMS80ICogd2lkdGgsIDE2MCwgMy80ICogd2lkdGgsIDExMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHgxIFRoZSBmaXJzdCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkxIFRoZSBmaXJzdCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHgyIFRoZSBzZWNvbmQgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MiBUaGUgc2Vjb25kIHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geDMgVGhlIHRoaXJkIHBvaW50J3MgeCBwaXhlbCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geTMgVGhlIHRoaXJkIHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDEgVGhlIGZpcnN0IHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDIgVGhlIHNlY29uZCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICogQHBhcmFtIHtQb2ludExpa2V9IHAzIFRoZSB0aGlyZCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICovCmZ1bmN0aW9uIHRyaWFuZ2xlKHgxLCB5MSwgeDIsIHkyLCB4MywgeTMpIHsKICBpZiAoeDEueCAhPT0gdW5kZWZpbmVkICYmIHgxLnkgIT09IHVuZGVmaW5lZCkgewogICAgeTMgPSB4Mi55OwogICAgeDMgPSB4Mi54OwogICAgeTIgPSB5MS55OwogICAgeDIgPSB5MS54OwogICAgeTEgPSB4MS55OwogICAgeDEgPSB4MS54OwogIH0KCiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICB2ZXJ0ZXgoeDIsIHkyKTsKICB2ZXJ0ZXgoeDMsIHkzKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICBlbmQoKTsKfQoKLyoqCiAqIEFkZCBhIHZlcnRleCB0byB0aGUgY3VycmVudGx5IGFjdGl2ZSBzaGFwZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRTdHJva2UoYGJsYWNrYCk7CiAqICAgICAgIHNldEZpbGwoYHJlZGApOwogKiAgICAgICBzdGFydCgpOwogKiAgICAgICB2ZXJ0ZXgod2lkdGgvMiwgMzApOwogKiAgICAgICB2ZXJ0ZXgoMS80ICogd2lkdGgsIDE2MCk7CiAqICAgICAgIHZlcnRleCgzLzQgKiB3aWR0aCwgMTEwKTsKICogICAgICAgZW5kKCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIHZlcnRleCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkgVGhlIHZlcnRleCdzIHkgcGl4ZWwgdmFsdWUKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHZlcnRleCB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBzZWUge0BsaW5rIGVuZH0KICogQHNlZSB7QGxpbmsgc3RhcnR9CiAqLwpmdW5jdGlvbiB2ZXJ0ZXgoeCwgeSkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQogIGlmIChfX2ZpcnN0KSB7CiAgICBfX2N0eC5saW5lVG8oeCwgeSk7CiAgfSBlbHNlIHsKICAgIF9fZmlyc3QgPSB7IHgsIHkgfTsKICAgIF9fY3R4Lm1vdmVUbyh4LCB5KTsKICB9Cn0KLyoqCiAqIENyZWF0ZSBhbiBhcnJheSBvZiBzcGVjaWZpZWQgbGVuZ3RoLCBvcHRpb25hbGx5IGZpbGxlZCB1c2luZyBhCiAqIHRoYXQgdGFrZXMgYW4gaW5kZXggYXMgc2luZ2xlIGlucHV0IGFyZ3VtZW50IGZ1bmN0aW9uLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIG5vRmlsbCgpOwogKiAgICAgICB0cmFuc2xhdGUoMCwgaGVpZ2h0LzIpOwogKiAgICAgICBsZXQgZGF0YSA9IGFycmF5KHdpZHRoLCAoaSkgPT4gW2ksIGhlaWdodC8yICogc2luKGkvMjUpXSk7CiAqICAgICAgIHBsb3REYXRhKGRhdGEsIDAsIDEpOwogKiAgICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIFRoZSBzaXplIG9mIHRoZSBhcnJheSB5b3Ugd2FudAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmaWxsRnVuY3Rpb24/IFRoZSBvcHRpb25hbCBmdW5jdGlvbiB0aGF0IGdldHMgdXNlZCB0byBmaWxsIHRoZSBhcnJheQogKi8KZnVuY3Rpb24gYXJyYXkobGVuLCBmaWxsRnVuY3Rpb24pIHsKICBjb25zdCBhcnIgPSBuZXcgQXJyYXkobGVuKS5maWxsKCk7CiAgaWYgKGZpbGxGdW5jdGlvbikgewogICAgcmV0dXJuIGFyci5tYXAoKF8sIGkpID0+IGZpbGxGdW5jdGlvbihpKSk7CiAgfQogIHJldHVybiBhcnI7Cn0KCi8qKgogKiBFbXB0eSB0aGUgbGlzdCBvZiBtb3ZhYmxlIHBvaW50cyBpbiB5b3VyIGdyYXBoaWMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGBsb2NrYCwgKCkgPT4gewogKiAgICAgICAgIGNsZWFyTW92YWJsZSgpOwogKiAgICAgICAgIHJlZHJhdygpOwogKiAgICAgICB9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBmb3IobGV0IHAgb2YgcG9pbnRzKSB7CiAqICAgICAgICAgc2V0Q29sb3IoaXNNb3ZhYmxlKHApID8gYHJlZGAgOiBgZ3JleWApOwogKiAgICAgICAgIHBvaW50KHApOwogKiAgICAgICB9CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bih4LHkpIHsKICogICAgICAgaWYgKGN1cnJlbnRQb2ludCkgcmV0dXJuOwogKiAgICAgICBjb25zdCBwID0gbmV3IFBvaW50KHgseSk7CiAqICAgICAgIHBvaW50cy5wdXNoKHApOwogKiAgICAgICBzZXRNb3ZhYmxlKHApOwogKiAgICAgICByZWRyYXcoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayBpc01vdmFibGV9CiAqIEBzZWUge0BsaW5rIHNldE1vdmFibGV9CiAqLwpmdW5jdGlvbiBjbGVhck1vdmFibGUoKSB7CiAgX19tb3ZhYmxlX3BvaW50cy5zcGxpY2UoMCwgX19tb3ZhYmxlX3BvaW50cy5sZW5ndGgpOwp9CgovKioKICogQ3JlYXRlIGEgY29weSBvZiB0aGUgY3VycmVudCBjYW52YXMgZWxlbWVudAogKiBmb3IgdXNlIHNvbWV3aGVyZSBlbHNlIGluIHlvdXIgb3duIGNvZGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgcGlua2ApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oeCx5KSB7CiAqICAgICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoCiAqICAgICAgICAgbmV3IEN1c3RvbUV2ZW50KGBncmFwaGljczp1cGRhdGVgLCB7CiAqICAgICAgICAgICBkZXRhaWw6IHsKICogICAgICAgICAgICAgY2FudmFzOiBjb3B5KCkKICogICAgICAgICAgIH0KICogICAgICAgICB9KQogKiAgICAgICApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEByZXR1cm5zIHtIVE1MQ2FudmFzRWxlbWVudH0gQSBjb3B5IG9mIHRoZSBjdXJyZW50IGNhbnZhcwogKi8KZnVuY3Rpb24gY29weSgpIHsKICBjb25zdCBjb3B5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgY2FudmFzYCk7CiAgY29weS53aWR0aCA9IHdpZHRoOwogIGNvcHkuaGVpZ2h0ID0gaGVpZ2h0OwogIGNvbnN0IGN0eCA9IGNvcHkuZ2V0Q29udGV4dChgMmRgKTsKICBjdHguZHJhd0ltYWdlKF9fY2FudmFzLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICByZXR1cm4gY29weTsKfQoKLyoqCiAqIEdlbmVyYXRlcyBhIGNvbG9yIGJhc2VkIG9uIHRoZSBIU0wgY29sb3Igc3BhY2UuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihjb2xvcig0NSwgODAsIDkwKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IGh1ZSBpbiB0aGUgcmFuZ2UgWzAsIDM2MF0KICogQHBhcmFtIHtudW1iZXJ9IHNhdHVyYXRpb24gaW4gdGhlIHJhbmdlIFswLCAxMDBdCiAqIEBwYXJhbSB7bnVtYmVyfSBsaWdodG5lc3MgaW4gdGhlIHJhbmdlIFswLCAxMDBdCiAqIEBwYXJhbSB7bnVtYmVyfSBvcGFjaXR5IGluIHRoZSByYW5nZSBbMCwgMV0KICogQHJldHVybnMge3N0cmluZ30gQSBDU1MgaHNsYSBjb2xvciBzdHJpbmcKICoKICogQHNlZSB7QGxpbmsgcmFuZG9tQ29sb3J9CiAqLwpmdW5jdGlvbiBjb2xvcihoID0gX19jdXJyZW50X2h1ZSwgcyA9IDUwLCBsID0gNTAsIGEgPSAxKSB7CiAgcmV0dXJuIGBoc2xhKCR7aH0sJHtzfSUsJHtsfSUsJHthfSlgOwp9CgovKioKICogRmluZCBhbiBIVE1MIGVsZW1lbnQgaW5zaWRlIHlvdXIgZ3JhcGhpY3MtZWxlbWVudAogKiBieSBxdWVyeSBzZWxlY3Rvci4gVGhpcyBpcyBlcXVpdmFsZW50IHRvOgogKgogKiBgYGAKICogeW91ckVsZW1lbnQucXVlcnlTZWxlY3RvcihxcykKICogYGBgCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBxdWVyeVNlbGVjdG9yIEEgcXVlcnkgc2VsZWN0b3IKICogQHJldHVybnMge0hUTUxFbGVtZW50fG51bGx9IFRoZSBtYXRjaGVkIGVsZW1lbnQsIG9yIG51bGwgaWYgdGhlcmUgd2FzIG5vIG1hdGNoLgogKi8KZnVuY3Rpb24gZmluZChxcykgewogIHJldHVybiBfX2VsZW1lbnQucXVlcnlTZWxlY3Rvcihxcyk7Cn0KCi8qKgogKiBGaW5kIGFsbCBIVE1MIGVsZW1lbnRzIGluc2lkZSB5b3VyIGdyYXBoaWNzLWVsZW1lbnQKICogdGhhdCBtYXRjaCBhIGdpdmVuIHF1ZXJ5IHNlbGVjdG9yLiBUaGlzIGlzIGVxdWl2YWxlbnQgdG86CiAqCiAqIGBgYAogKiB5b3VyRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHFzKQogKiBgYGAKICoKICogTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gZG9lcyBfbm90XyByZXR1cm4gYSBOb2RlTGlzdAogKiBhbmQgaW5zdGVhZCByZXR1cm5zIGEgcGxhaW4gYXJyYXkuCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBxdWVyeVNlbGVjdG9yIEEgcXVlcnkgc2VsZWN0b3IKICogQHJldHVybnMge0hUTUxFbGVtZW50W119IEFuIGFycmF5IHdpdGggYWxsIG1hdGNoaW5nIGVsZW1lbnRzLCBbXSBpZiB0aGVyZSB3ZXJlIG5vIG1hdGNoZXMuCiAqLwpmdW5jdGlvbiBmaW5kQWxsKHFzKSB7CiAgcmV0dXJuIFsuLi5fX2VsZW1lbnQucXVlcnlTZWxlY3RvckFsbChxcyldOwp9CgovKioKICogTWFyayBhIHNwZWNpZmljIGNvbG9yIGFzIHRoZSBoaWdobGlnaHQgY29sb3IsCiAqIHdoaWNoIGNhdXNlcyB0aGUgZ3JhcGhpYyB0byByZWRyYXcgd2l0aCB0aGF0CiAqIGNvbG9yIHJlcGxhY2VkIGJ5IHdoaWNoZXZlciBjb2xvciB5b3UgcGlja2VkCiAqIGFzIGhpZ2hsaWdodCBjb2xvci4KICoKICogTm90ZSB0aGF0IHlvdSBjYW4gb25seSB1c2UgbmFtZWQgKENTUykgY29sb3JzCiAqIHdpdGggdGhpcyBmdW5jdGlvbi4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0SGlnaGxpZ2h0Q29sb3IoYGxpbWVgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldENvbG9yKGByZWRgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICB0ZXh0KCJsZXQncyBnbyIsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICBpZiAoc3RhdGUpIGhpZ2hsaWdodChgcmVkYCk7CiAqICAgICAgIGVsc2UgaGlnaGxpZ2h0KGZhbHNlKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge2NvbG9yfGJvb2xlYW59IGNvbG9yIFNldCB0aGUgY29sb3IgdGhhdCBzaG91bGQgZ2V0IHJlcGxhY2VkIHdpdGggdGhlIGhpZ2hsaWdodCBjb2xvciwgb3IgZGlzYWJsZSBoaWdobGlnaHQgd2hlbiBjb2xvciBpcyBgZmFsc2VgCiAqCiAqIEBzZWUge0BsaW5rIHNldEhpZ2hsaWdodENvbG9yfQogKi8KZnVuY3Rpb24gaGlnaGxpZ2h0KGNvbG9yKSB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdKSB7CiAgICBfX2hpZ2hsaWdodF9jb2xvciA9IENTU19DT0xPUl9NQVBbY29sb3JdOwogIH0gZWxzZSB7CiAgICBfX2hpZ2hsaWdodF9jb2xvciA9IGNvbG9yOwogIH0KICByZWRyYXcoKTsKfQoKLyoqCiAqIENoZWNrIHdoZXRoZXIgYSBwb2ludCBpcyByZWdpc3RlcmVkIGFzIG1vdmFibGUuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgYWRkQnV0dG9uKGBsb2NrYCwgKCkgPT4gewogKiAgICAgICAgIGNsZWFyTW92YWJsZSgpOwogKiAgICAgICAgIHJlZHJhdygpOwogKiAgICAgICB9KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBmb3IobGV0IHAgb2YgcG9pbnRzKSB7CiAqICAgICAgICAgc2V0Q29sb3IoaXNNb3ZhYmxlKHApID8gYHJlZGAgOiBgZ3JleWApOwogKiAgICAgICAgIHBvaW50KHApOwogKiAgICAgICB9CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyRG93bih4LHkpIHsKICogICAgICAgaWYgKGN1cnJlbnRQb2ludCkgcmV0dXJuOwogKiAgICAgICBjb25zdCBwID0gbmV3IFBvaW50KHgseSk7CiAqICAgICAgIHBvaW50cy5wdXNoKHApOwogKiAgICAgICBzZXRNb3ZhYmxlKHApOwogKiAgICAgICByZWRyYXcoKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gVGhlIHBvaW50IHRoYXQgd2Ugd2FudCB0byBjaGVjayAibW92YWJpbGl0eSIgZm9yCiAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIG91ciBwb2ludCBpcyBpbiB0aGUgbGlzdCBvZiBtb3ZhYmxlIHBvaW50cywgb3RoZXJ3aXNlIGZhbHNlCiAqCiAqIEBzZWUge0BsaW5rIGNsZWFyTW92YWJsZX0KICogQHNlZSB7QGxpbmsgc2V0TW92YWJsZX0KICovCmZ1bmN0aW9uIGlzTW92YWJsZShwb2ludCkgewogIHJldHVybiBfX21vdmFibGVfcG9pbnRzLmluY2x1ZGVzKHBvaW50KTsKfQoKLyoqCiAqIEdldCB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0aGF0IHRoaXMKICogZ3JhcGhpYyBoYXMgYmVlbiBydW5uaW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0QWxpZ24oQ0VOVEVSLCBNSURETEUpOwogKiAgICAgICBjb25zdCBzZWNvbmRzID0gKG1pbGxpcygpLzEwMDApfDA7CiAqICAgICAgIHRleHQoYCR7c2Vjb25kc31zYCwgd2lkdGgvMiwgaGVpZ2h0LzIpCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHJldHVybnMge251bWJlcn0gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZSB0aGUgZ3JhcGhpYyBsb2FkZWQgaW4KICovCmZ1bmN0aW9uIG1pbGxpcygpIHsKICByZXR1cm4gRGF0ZS5ub3coKSAtIF9fc3RhcnRfdGltZTsKfQoKLyoqCiAqIFBhdXNlIHRoZSBncmFwaGljIGlmIGl0cyBjdXJyZW50bHkgcGxheWluZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBsYXkoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgY29uc3Qgc2Vjb25kcyA9IChtaWxsaXMoKS8xMDAwKS50b0ZpeGVkKDEpOwogKiAgICAgICB0ZXh0KGAke3NlY29uZHN9c2AsIHdpZHRoLzIsIGhlaWdodC8yKQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckFjdGl2ZShzdGF0ZSkgewogKiAgICAgICBpZihzdGF0ZSkgewogKiAgICAgICAgIHBhdXNlKCk7CiAqICAgICAgIH0gZWxzZSB7CiAqICAgICAgICAgcGxheSgpOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgcGxheX0KICogQHNlZSB7QGxpbmsgdG9nZ2xlUGxheX0KICovCmZ1bmN0aW9uIHBhdXNlKCkgewogIHBsYXlpbmcgPSBmYWxzZTsKfQoKLyoqCiAqIFN0YXJ0IHBsYXlpbmcgeW91ciBncmFwaGljLCBtZWFuaW5nIGl0IHdpbGwgY2FsbCBkcmF3KCkKICogYXQgd2hhdGV2ZXIgcmF0ZSB0aGUgcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGxvb3AgaXMKICogYWxsb3dlZCB0byBydW4gb24geW91ciBjb21wdXRlci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGxldCBmcHMgPSAwOwogKiAgICAgbGV0IGNoZWNrZWQgPSBmYWxzZTsKICogICAgIGxldCBsYXN0RnJhbWVDaGVjayA9IDA7CiAqCiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIGNvbnN0IHNlY29uZHMgPSAobWlsbGlzKCkvMTAwMCkudG9GaXhlZCgxKTsKICogICAgICAgdGV4dChgZnBzOiAke2Zwc31gLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgICAgaWYgKHNlY29uZHMuZW5kc1dpdGgoYC4wYCkpIHsKICogICAgICAgICBpZiAoIWNoZWNrZWQpIHsKICogICAgICAgICAgIGNoZWNrZWQgPSB0cnVlOwogKiAgICAgICAgICAgZnBzID0gZnJhbWUgLSBsYXN0RnJhbWVDaGVjazsKICogICAgICAgICAgIGxhc3RGcmFtZUNoZWNrID0gZnJhbWU7CiAqICAgICAgICAgfQogKiAgICAgICB9IGVsc2UgewogKiAgICAgICAgIGNoZWNrZWQgPSBmYWxzZTsKICogICAgICAgfQogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBzZWUge0BsaW5rIHBhdXNlfQogKiBAc2VlIHtAbGluayB0b2dnbGVQbGF5fQogKi8KZnVuY3Rpb24gcGxheSgpIHsKICBwbGF5aW5nID0gdHJ1ZTsKICBfX2RyYXcoKTsKfQoKLyoqCiAqIEdlbmVyYXRlIGEgcmFuZG9tIGNvbG91ci4gTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24KICogYWxsb3dzIHlvdSB0byBnZXQgInRoZSBjdXJyZW50bHkgZ2VuZXJhdGVkIHJhbmRvbQogKiBjb2xvdXIiIGluIGRpZmZlcmVudCBvcGFjaXRpZXMgYnkgY2FsbGluZyB0aGUgZnVuY3Rpb24KICogd2l0aCBhbiBvcGFjaXR5IHZhbHVlLCBhbmQgYGZhbHNlYCBhcyBjeWNsZSBhcmd1bWVudC4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKHJhbmRvbUNvbG9yKCkpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlckRvd24oKSB7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBvcGFjaXR5IFRoZSBvcGFjaXR5IHZhbHVlIGluIHRoZSByYW5nZSBbMCwxXQogKiBAcGFyYW0ge251bWJlcn0gY3ljbGU/IEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyB3aGV0aGVyIG9yIG5vdCB0byBtb3ZlIG9uIHRvIHRoZSBuZXh0IGNvbG91ciAoZGVmYXVsdCA9IHRydWUpCiAqCiAqIEBzZWUge0BsaW5rIGNvbG9yfQogKi8KZnVuY3Rpb24gcmFuZG9tQ29sb3IoYSA9IDEuMCwgY3ljbGUgPSB0cnVlKSB7CiAgaWYgKGN5Y2xlKSBfX2N1cnJlbnRfaHVlID0gcmFuZG9tKDAsIDM2MCk7CiAgcmV0dXJuIGBoc2xhKCR7X19jdXJyZW50X2h1ZX0sNTAlLDUwJSwke2F9KWA7Cn0KCi8qKgogKiBBbiBhbHRlcm5hdGl2ZSB0byB3cml0aW5nIGZvciBsb29wcywgYmVjYXVzZQogKiBubyBvbmUgd2FudHMgdG8gY29uc3RhbnRseSB3cml0ZSB2YXIgYWxsb2NhdGlvbnMKICogdGhhdCBvbmx5IGxpdmUgZm9yIHRoZSBkdXJhdGlvbiBvZiBhIGxvb3AuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcmFuZ2UoMCwgVEFVLCAoYSkgPT4gcG9pbnQoNDAgKiBjb3MoYSksIDQwICogc2luKGEpKSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IFRoZSBlcXVpdmFsZW50IG9mIGEgZm9yIGxvb3AncyBpbml0aWFsIGBsZXQgaSA9IC4uLmAKICogQHBhcmFtIHtudW1iZXJ9IGVuZCBUaGUgZXF1aXZhbGVudCBvZiBhIGZvciBsb29wJ3MgYGkgPCBlbmRgCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGVwPyBUaGUgc3RlcCBzaXplIGJ5IHdoaWNoIHRvIGluY3JlbWVudCBhdCBlYWNoIGl0ZXJhdGlvbiAoZGVmYXVsdHMgPSBgKHN0YXJ0LWVuZCkvMTBgKQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBydW5GdW5jdGlvbiBUaGUgZnVuY3Rpb24gdG8gcnVuIGF0IGVhY2ggaXRlcmF0aW9uCiAqLwpmdW5jdGlvbiByYW5nZShzdGFydCwgZW5kLCBzdGVwLCBydW5GdW5jdGlvbikgewogIGlmICh0eXBlb2Ygc3RlcCA9PT0gYGZ1bmN0aW9uYCkgewogICAgcnVuRnVuY3Rpb24gPSBzdGVwOwogICAgc3RlcCA9IChlbmQgLSBzdGFydCkgLyAxMDsKICB9CiAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpICs9IHN0ZXApIHsKICAgIHJ1bkZ1bmN0aW9uKGkpOwogIH0KfQoKLyoqCiAqIFNhZmVseSB0cmlnZ2VyIGEgbmV3IGRyYXcgcGFzcy4gSWYgdGhlIGdyYXBoaWMgaXMgcnVubmluZwogKiBpbiBhbmltYXRlZCBtb2RlLCBvciBhIHJlZHJhdygpIGlzIHRyaWdnZXJlZCBfZHVyaW5nXyBhCiAqIHJlZHJhdygpLCB0aGlzIGNhbGwgd2lsbCBkbyBub3RoaW5nLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY29uc3QgaCA9IG1hcChwb2ludGVyLngsIDAsIHdpZHRoLCAwLCAzNjApOwogKiAgICAgICBjb25zdCBsID0gbWFwKHBvaW50ZXIueSwgMCwgaGVpZ2h0LCA1MCwgMCk7CiAqICAgICAgIGNsZWFyKGNvbG9yKGgsIDEwMCwgbCkpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlck1vdmUoKSB7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqLwpmdW5jdGlvbiByZWRyYXcoKSB7CiAgaWYgKF9fcmVkcmF3aW5nKSByZXR1cm47CiAgaWYgKHBsYXlpbmcpIHJldHVybjsKICBfX3JlZHJhd2luZyA9IHRydWU7CiAgX19kcmF3KCk7CiAgX19yZWRyYXdpbmcgPSBmYWxzZTsKfQoKLyoqCiAqIFJlc3RvcmUgdGhlIGdyYXBoaWNzIGNvbnRleHQgKHRyYW5zZm9ybXMsCiAqIGN1cnJlbnQgY29sb3JzLCBldGMpIHRvIHdoYXQgdGhleSB3ZXJlCiAqIHdoZW4gc2F2ZSgpIHdhcyBjYWxsZWQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBjb25zdCBwb2ludHMgPSBbXTsKICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIGxpbmUoMCwwLDgwLDApOwogKiAgICAgICBzYXZlKCk7CiAqICAgICAgIHNldENvbG9yKGBkYXJrZ3JlZW5gKQogKiAgICAgICByYW5nZSgwLCA1LCAxLCAoYSkgPT4gewogKiAgICAgICAgIHJvdGF0ZShQSS84KTsKICogICAgICAgICBsaW5lKDAsMCw4MCwwKTsKICogICAgICAgfSk7CiAqICAgICAgIHJlc3RvcmUoKTsKICogICAgICAgbGluZSgtMjAsMCwtODAsMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHNlZSB7QGxpbmsgc2F2ZX0KICovCmZ1bmN0aW9uIHJlc3RvcmUoKSB7CiAgX19jdHgucmVzdG9yZSgpOwp9CgovKioKICogTWFyayBvbmUgb3IgbW9yZSBwb2ludHMgYXMgbW92YWJsZSwgbWVhbmluZwogKiB0aGF0IHRoZSB1c2VyIGNhbiByZXBvc2l0aW9uIHRoZSBwb2ludCBhcm91bmQgb24KICogdGhlIGNhbnZhcyBieSB0b3VjaC9jbGljay1kcmFnZ2luZy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBmb3IgKGxldCBpID0gNDA7IGkgPCAyMDA7IGkgKz0gMjApIHsKICogICAgICAgICBwb2ludHMucHVzaChuZXcgUG9pbnQoaSAtIDIwLCAxMjApKTsKICogICAgICAgfQogKiAgICAgICBzZXRNb3ZhYmxlKC4uLnBvaW50cyk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBub0ZpbGwoKTsKICogICAgICAgc2V0U3Ryb2tlKGBwdXJwbGVgKTsKICogICAgICAgYnNwbGluZSguLi5wb2ludHMpOwogKiAgICAgICBmb3IobGV0IHAgb2YgcG9pbnRzKSBwb2ludChwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge1BvaW50TGlrZVtuXX0gcG9pbnRzIE9uZSBvciBtb3JlIHBvaW50cyB0byBtYXJrIGFzIG1vdmFibGUuCiAqCiAqIEBzZWUge0BsaW5rIGlzTW92YWJsZX0KICogQHNlZSB7QGxpbmsgY2xlYXJNb3ZhYmxlfQogKi8KZnVuY3Rpb24gc2V0TW92YWJsZSguLi5wb2ludHMpIHsKICBwb2ludHMuZm9yRWFjaCgocCkgPT4gewogICAgaWYgKF9fbW92YWJsZV9wb2ludHMuaW5kZXhPZihwKSA9PT0gLTEpIHsKICAgICAgX19tb3ZhYmxlX3BvaW50cy5wdXNoKHApOwogICAgfQogIH0pOwp9CgovKioKICogU2V0IChvciBjaGFuZ2UpIHRoZSBncmFwaGljJ3Mgc2l6ZS4gTm90ZSB0aGF0IHlvdXIgd2lkdGgKICogYW5kIGhlaWdodCB2YWx1ZXMgd2lsbCBnZXQgcm91bmRlZCB0byBpbnRlZ2VyIHZhbHVlcy4KICoKICogTm90ZSB0aGF0IGBzZXRTaXplYCB3aWxsIGltbWVkaWF0ZWx5IHRyaWdnZXIgYSByZWRyYXcsCiAqIHdoZXRoZXIgeW91IHdhbnQgaXQgdG8gb3Igbm90LCBiZWNhdXNlIGNoYW5naW5nIGNhbnZhcwogKiBkaW1lbnNpb25zIGNsZWFycyB0aGUgY2FudmFzLCBuZWNlc3NpdGF0aW5nIGEgcmVkcmF3LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoNDAwLCAyMDApOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgY2VudGVyKCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApCiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgdGV4dChgJHt3aWR0aH0vJHtoZWlnaHR9YCwgMCwgMCwgQ0VOVEVSLCBNSURETEUpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlclVwKCkgewogKiAgICAgICBzZXRTaXplKHJhbmRvbSgxMDAsNDAwKSwgMjAwKTsKICogICAgICAgLy8gTm90ZSB0aGF0IHRoZXJlIGlzIG5vIHJlZHJhdygpIGhlcmUhCiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIFRoZSBncmFwaGljcyB3aWR0aCBpbiBwaXhlbHMKICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCBUaGUgZ3JhcGhpY3MgaGVpZ2h0IGluIHBpeGVscwogKi8KZnVuY3Rpb24gc2V0U2l6ZSh3ID0gNDAwLCBoID0gMjAwKSB7CiAgd2lkdGggPSBfX2NhbnZhcy53aWR0aCA9IHcgfCAwOwogIGhlaWdodCA9IF9fY2FudmFzLmhlaWdodCA9IGggfCAwOwogIF9fZWxlbWVudC5zdHlsZS5tYXhXaWR0aCA9IGBjYWxjKDJlbSArICR7d2lkdGh9cHhgOwogIF9fY3R4ID0gX19jYW52YXMuZ2V0Q29udGV4dChgMmRgKTsKICBfX2RyYXcoKTsKfQoKLyoqCiAqIFNhdmUgdGhlIGN1cnJlbnQgZ3JhcGhpY3MgY29udGV4dCAodHJhbnNmb3JtcywKICogY3VycmVudCBjb2xvcnMsIGV0Yykgc28gdGhhdCB0aG9zZSBjYW4gYmUgcmVzdG9yZWQKICogYWZ0ZXIgY2hhbmdpbmcgdGhlbS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGNvbnN0IHBvaW50cyA9IFtdOwogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgbGluZSgwLDAsODAsMCk7CiAqICAgICAgIHNhdmUoKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApCiAqICAgICAgIHJhbmdlKDAsIDUsIDEsIChhKSA9PiB7CiAqICAgICAgICAgcm90YXRlKFBJLzgpOwogKiAgICAgICAgIGxpbmUoMCwwLDgwLDApOwogKiAgICAgICB9KTsKICogICAgICAgcmVzdG9yZSgpOwogKiAgICAgICBsaW5lKC0yMCwwLC04MCwwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiAqIEBzZWUge0BsaW5rIHJlc3RvcmV9CiAqLwpmdW5jdGlvbiBzYXZlKCkgewogIF9fY3R4LnNhdmUoKTsKfQoKLyoqCiAqIENvbnZlcnQgdGhlIGN1cnJlbnQgY2FudmFzIGludG8gYW4gZGF0YSBVUkwKICogdGhhdCByZXByZXNlbnRzIGEgUE5HIGltYWdlLgogKgogKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgY3VycmVudCBjYW52YXMgYXMgUE5HIGRhdGEgVVJMCiAqLwpmdW5jdGlvbiB0b0RhdGFVUkwoKSB7CiAgcmV0dXJuIF9fY2FudmFzLnRvRGF0YVVSTCgpOwp9CgovKioKICogSWYgdGhlIGdyYXBoaWMgaXMgY3VycmVudGx5IHBsYXlpbmcsIHBhdXNlIGl0LAogKiBhbmQgaWYgaXQncyBwYXVzZWQsIHBsYXkgaXQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRGb250U2l6ZSgyNSk7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIGNvbnN0IHNlY29uZHMgPSAobWlsbGlzKCkvMTAwMCkudG9GaXhlZCgxKTsKICogICAgICAgdGV4dChgJHtzZWNvbmRzfXNgLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJBY3RpdmUoc3RhdGUpIHsKICogICAgICAgdG9nZ2xlUGxheSgpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEByZXR1cm5zIHtib29sZWFufSBUaGUgbmV3IHBsYXkgc3RhdGUKICoKICogQHNlZSB7QGxpbmsgcGF1c2V9CiAqIEBzZWUge0BsaW5rIHBsYXl9CiAqLwpmdW5jdGlvbiB0b2dnbGVQbGF5KCkgewogIHBsYXlpbmcgPyBwYXVzZSgpIDogcGxheSgpOwogIHJldHVybiBwbGF5aW5nOwp9CmNvbnN0IHsKICAvKioKICAgKiBHZXQgdGhlIGFic29sdXRlIHZhbHVlIGZvciBzb21lIGlucHV0CiAgICoKICAgKiBFeGFtcGxlOgogICAqCiAgICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAgICogICA8Z3JhcGhpY3Mtc291cmNlPgogICAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogICAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogICAqICAgICAgIHRyYW5zbGF0ZSgwLCBoZWlnaHQvMik7CiAgICogICAgICAgbm9GaWxsKCk7CiAgICogICAgICAgc2V0U3Ryb2tlKGBibGFja2ApOwogICAqICAgICAgIGxpbmUoLWh1Z2UsIDAsIGh1Z2UsIDApOwogICAqCiAgICogICAgICAgY29uc3QgdzIgPSB3aWR0aC8yOwogICAqICAgICAgIGNvbnN0IGRhdGEgPSBhcnJheSh3aWR0aCwgKHgpID0+IFt4LCB4IC0gdzIsIGFicyh4IC0gdzIpXSk7CiAgICoKICAgKiAgICAgICBzZXRTdHJva2UoYHJlZGApOwogICAqICAgICAgIHBsb3REYXRhKGRhdGEsIDAsIDEpOwogICAqCiAgICogICAgICAgc2V0U3Ryb2tlKGBibHVlYCk7CiAgICogICAgICAgcGxvdERhdGEoZGF0YSwgMCwgMik7CiAgICogICAgIH0KICAgKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogICAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSB2IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgaW5wdXQgdmFsdWUgd2l0aCBpdHMgc2lnbiBzZXQgdG8gcG9zaXRpdmUKICAgKi8KICBhYnMsCgogIC8qKgogICAqIFRoZSBpbnZlcnNlIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IHYgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBpbnZlcnNlIGNvc2luZSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgYXNpbn0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICBhY29zLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIGh5cGVyYm9saWMgaW52ZXJzZSBjb3NpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGFzaW5ofQogICAqIEBzZWUge0BsaW5rIGFjb3N9CiAgICovCiAgYWNvc2gsCgogIC8qKgogICAqIFRoZSBpbnZlcnNlIHNpbmUgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBpbnZlcnNlIHNpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGFjb3N9CiAgICogQHNlZSB7QGxpbmsgYXNpbmh9CiAgICovCiAgYXNpbiwKCiAgLyoqCiAgICogVGhlIGh5cGVyYm9saWMgaW52ZXJzZSBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgaHlwZXJib2xpYyBpbnZlcnNlIHNpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGFjb3NofQogICAqIEBzZWUge0BsaW5rIGFzaW59CiAgICovCiAgYXNpbmgsCgogIC8qKgogICAqIFRoZSBpbnZlcnNlIHRhbmdlbnQgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBpbnZlcnNlIHRhbmdlbnQKICAgKgogICAqIEBzZWUge0BsaW5rIHRhbn0KICAgKi8KICBhdGFuLAoKICAvKioKICAgKiBUaGUgImF0YW4yIiBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0F0YW4yCiAgICoKICAgKiBAcGFyYW0ge3l9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcGFyYW0ge3h9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIGF0YW4yIGFuZ2xlIGZvciB0aGlzIG51bWJlciBwYWlyCiAgICovCiAgYXRhbjIsCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIGludmVyc2UgdGFuZ2VudCBmdW5jdGlvbgogICAqCiAgICogU2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVyc2VfaHlwZXJib2xpY19mdW5jdGlvbnMjRGVmaW5pdGlvbnNfaW5fdGVybXNfb2ZfbG9nYXJpdGhtcwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIGh5cGVyYm9saWMgaW52ZXJzZSB0YW5nZW50CiAgICoKICAgKiBAc2VlIHtAbGluayB0YW59CiAgICogQHNlZSB7QGxpbmsgYWNvc2h9CiAgICogQHNlZSB7QGxpbmsgYXNpbmh9CiAgICovCiAgYXRhbmgsCgogIC8qKgogICAqIFRoZSBjdWJlIHJvb3QgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSAocmVhbCkgY3ViZSByb290IG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBzcXJ0fQogICAqLwogIGNicnQsCgogIC8qKgogICAqIFRoZSAicm91bmQgdXAgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciIgZnVuY3Rpb24uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgaW50ZWdlciByZXN1bHQgYWZ0ZXIgcm91bmRpbmcgdXAuCiAgICoKICAgKiBAc2VlIHtAbGluayBmbG9vcn0KICAgKiBAc2VlIHtAbGluayByb3VuZH0KICAgKi8KICBjZWlsLAoKICAvKioKICAgKiBHZXQgdGhlIG51bWJlciBvZiBsZWFkaW5nIHplcm8gYml0cyBpbiB0aGUgMzItYml0IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiBhIG51bWJlcgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIG51bWJlciBvZiBsZWFkaW5nIHplcm8gYml0cyBpbiB0aGUgMzItYml0IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGF0IG51bWJlci4KICAgKi8KICBjbHozMiwKCiAgLyoqCiAgICogVGhlIGNvc2luZSBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIGNvc2luZQogICAqCiAgICogQHNlZSB7QGxpbmsgc2lufQogICAqLwogIGNvcywKCiAgLyoqCiAgICogVGhlIGh5cGVyYm9saWMgY29zaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgaHlwZXJib2xpYyBjb3NpbmUKICAgKgogICAqIEBzZWUge0BsaW5rIGNvc30KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICBjb3NoLAoKICAvKioKICAgKiBUaGUgZXhwb25lbnQgZnVuY3Rpb24sIHRoYXQgaXM6IGVeeAogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIHZhbHVlIG9mIEUgcmFpc2VkIHRvIHRoYXQgbnVtYmVyJ3MgcG93ZXIKICAgKgogICAqIEBzZWUge0BsaW5rIEV9CiAgICovCiAgZXhwLAoKICAvKioKICAgKiBUaGUgInJvdW5kIGRvd24gdG8gdGhlIG5lYXJlc3QgaW50ZWdlciIgZnVuY3Rpb24uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgaW50ZWdlciByZXN1bHQgYWZ0ZXIgcm91bmRpbmcgZG93bi4KICAgKgogICAqIEBzZWUge0BsaW5rIGNlaWx9CiAgICogQHNlZSB7QGxpbmsgcm91bmR9CiAgICovCiAgZmxvb3IsCgogIC8qKgogICAqIFJvdW5kIGEgbnVtYmVyIHRvIHRoZSBuZWFyZXN0IDMyIGJpdCwgcmF0aGVyIHRoYW4gdGhlCiAgICogc3RhbmRhcmQgSlMgNjQgYml0LCBmbG9hdGluZyBwb2ludCByZXByZXNlbnRhdGlvbi4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBudW1iZXIgYWZ0ZXIgcm91bmRpbmcgdG8gdGhlIG5lYXJlc3QgMzIgYml0IGZsb2F0aW5nIHBvaW50IHJlcHJlc2VudGF0aW9uLgogICAqCiAgICogQHNlZSB7QGxpbmsgcm91bmR9CiAgICovCiAgZnJvdW5kLAoKICAvKioKICAgKiBUaGUgRXVjbGlkZWFuIGh5cG90ZW51c2UgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyW119IC4uLmlucHV0IFR3byBvciBtb3JlIG51bWJlcnMKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIGh5cG90ZW51c2UgZ2l2ZW4gdGhvc2UgbnVtYmVycy4KICAgKi8KICBoeXBvdCwKCiAgLyoqCiAgICogVGhlIDMyIGJpdCBpbnRlZ2VyIG11bHRpcGxpY2F0aW9uIGZ1bmN0aW9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGEgQW55IDMyIGJpdCBpbnRlZ2VyCiAgICogQHBhcmFtIHtudW1iZXJ9IGIgQW55IDMyIGJpdCBpbnRlZ2VyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSAzMiBiaXQgaW50ZWdlciByZXN1bHQgb2YgYSAqIGIKICAgKi8KICBpbXVsLAoKICAvKioKICAgKiBUaGUgbmF0dXJhbCBsb2dhcml0aG0gZnVuY3Rpb24sIGkuZS4gdGhlIGJhc2UtRSBsb2dhcml0aG0KICAgKgogICAqIChOb3RlIHRoYXQgaW4gSlMgdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgImxvZyIgcmF0aGVyIHRoYW4gImxuIikKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBuYXR1cmFsIGxvZ2FyaXRobSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgRX0KICAgKiBAc2VlIHtAbGluayBsb2d9CiAgICovCiAgbG9nOiBsbiwKCiAgLyoqCiAgICogVGhlICJjb21tb24gbG9nYXJpdGhtIiBmdW5jdGlvbiwgaS5lLiB0aGUgYmFzZS0xMCBsb2dhcml0aG0uCiAgICoKICAgKiAoTm90ZSB0aGF0IGluIEpTIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkICJsb2cxMCIgcmF0aGVyIHRoYW4gImxvZyIpCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgY29tbW9uIGxvZ2FyaXRobSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgbG59CiAgICovCiAgbG9nMTA6IGxvZywKCiAgLyoqCiAgICogVGhlIGJpbmFyeSBsb2dhcml0aG0gZnVuY3Rpb24sIGkuZS4gdGhlIGJhc2UtMiBsb2dhcml0aG0uCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgYmFzZSAyIGxvZ2FyaXRobSBvZiB0aGF0IG51bWJlcgogICAqCiAgICogQHNlZSB7QGxpbmsgbG59CiAgICogQHNlZSB7QGxpbmsgbG9nfQogICAqLwogIGxvZzIsCgogIC8qKgogICAqIEZpbmQgdGhlIG1heGltdW0gdmFsdWUgaW4gYSBzZXQgb2YgbnVtYmVycwogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IC4uLmlucHV0IEFueSB0d28gb3IgIG1vcmUgbnVtYmVycwogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgaGlnaGVzdCB2YWx1ZWQgbnVtYmVyIGZyb20gYW1vbmcgdGhlIGlucHV0LgogICAqCiAgICogQHNlZSB7QGxpbmsgbWlufQogICAqLwogIG1heCwKCiAgLyoqCiAgICogRmluZCB0aGUgbWluaW11bSB2YWx1ZSBpbiBhIHNldCBvZiBudW1iZXJzCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gLi4uaW5wdXQgQW55IHR3byBvciAgbW9yZSBudW1iZXJzCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBsb3dlc3QgdmFsdWVkIG51bWJlciBmcm9tIGFtb25nIHRoZSBpbnB1dC4KICAgKgogICAqIEBzZWUge0BsaW5rIG1heH0KICAgKi8KICBtaW4sCgogIC8qKgogICAqIFRoZSBwb3dlciBmdW5jdGlvbi4KICAgKgogICAqIE5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIGEgaG9sZG92ZXIgZnJvbSBiZWZvcmUgSlMKICAgKiBoYWQgdGhlIGAqKmAgb3BlcmF0b3IgZm9yIHBlcmZvcm1pbmcgdGhpcyBjYWxjdWxhdGlvbi4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBhIEFueSBudW1iZXIKICAgKiBAcGFyYW0ge251bWJlcn0gYiBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcnxOYU59IG91dHB1dCBhICoqIGIgb3IgTmFOIGlmIHRoYXQgaXMgdW5kZWZpbmVkCiAgICovCiAgcG93LAoKICAvKioKICAgKiBUaGUgInJvdW5kIHRvIHRoZSBuZWFyZXN0IGludGVnZXIiIGZ1bmN0aW9uLCByb3VuZGluZyBhbnkKICAgKiB2YWx1ZSBbeC4wLCB4LjQ5OTkuLi5dIHRvIHgsIGFuZCBhbnkgdmFsdWUgW3guNSwgeC45OTkuLi5dCiAgICogdG8geCArIDEuCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgaW50ZWdlciByZXN1bHQgYWZ0ZXIgcm91bmRpbmcuCiAgICoKICAgKiBAc2VlIHtAbGluayBjZWlsfQogICAqIEBzZWUge0BsaW5rIGZsb29yfQogICAqLwogIHJvdW5kLAoKICAvKioKICAgKiBHZXQgdGhlIHNpZ24gb2YgYSBudW1iZXIKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0ICsxIGlmIHRoZSBudW1iZXIgd2FzIHBvc2l0aXZlLCAtMSBpZiBpdCB3YXMgbmVnYXRpdmUsIG9yIDAgaWYgdGhlIGlucHV0IHdhcyB6ZXJvLgogICAqLwogIHNpZ24sCgogIC8qKgogICAqIFRoZSBjb3NpbmUgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBzaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBjb3N9CiAgICovCiAgc2luLAoKICAvKioKICAgKiBUaGUgaHlwZXJib2xpYyBzaW5lIGZ1bmN0aW9uCiAgICoKICAgKiBTZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJzZV9oeXBlcmJvbGljX2Z1bmN0aW9ucyNEZWZpbml0aW9uc19pbl90ZXJtc19vZl9sb2dhcml0aG1zCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgaHlwZXJib2xpYyBzaW5lCiAgICoKICAgKiBAc2VlIHtAbGluayBzaW59CiAgICogQHNlZSB7QGxpbmsgYWNvc2h9CiAgICovCiAgc2luaCwKCiAgLyoqCiAgICogVGhlIHNxdWFyZSByb290IGZ1bmN0aW9uLgogICAqCiAgICoKICAgKiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBpcyBhIGhvbGRvdmVyIGZyb20gYmVmb3JlIEpTCiAgICogaGFkIHRoZSBgKipgIG9wZXJhdG9yIGZvciBwZXJmb3JtaW5nIHRoaXMgY2FsY3VsYXRpb24KICAgKiBieSB1c2luZyBgeCAqKiAwLjVgLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIHNxdWFyZSByb290IG9mIHRoYXQgbnVtYmVyCiAgICoKICAgKiBAc2VlIHtAbGluayBjYnJ0fQogICAqIEBzZWUge0BsaW5rIHBvd30KICAgKi8KICBzcXJ0LAoKICAvKioKICAgKiBUaGUgdGFuZ2VudCBmdW5jdGlvbgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlucHV0IEFueSBudW1iZXIKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBvdXRwdXQgVGhlIHRhbmdlbnQKICAgKi8KICB0YW4sCgogIC8qKgogICAqIFRoZSBoeXBlcmJvbGljIHRhbmdlbnQgZnVuY3Rpb24KICAgKgogICAqIFNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnNlX2h5cGVyYm9saWNfZnVuY3Rpb25zI0RlZmluaXRpb25zX2luX3Rlcm1zX29mX2xvZ2FyaXRobXMKICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSBpbnB1dCBBbnkgbnVtYmVyCiAgICogQHJldHVybnMge251bWJlcn0gb3V0cHV0IFRoZSBoeXBlcmJvbGljIHRhbmdlbnQKICAgKgogICAqIEBzZWUge0BsaW5rIHRhbn0KICAgKiBAc2VlIHtAbGluayBhc2luaH0KICAgKiBAc2VlIHtAbGluayBhY29zaH0KICAgKi8KICB0YW5oLAoKICAvKioKICAgKiBUcnVuY2F0ZSBhIGZyYWN0aW9uIHRvIGFuIGludGVnZXIgYnkgc2ltcGx5IGRyb3BwaW5nIHRoZSBmcmFjdGlvbmFsIHBhcnQuCiAgICogTm90ZSB0aGF0IHRoaXMgZGlmZmVycyBmcm9tIHRoZSBgZmxvb3JgIGZ1bmN0aW9uOgogICAqCiAgICogYGBgCiAgICogZmxvb3IoNC4yKTsgIC8vIDQKICAgKiBmbG9vcigtNC4yKTsgLy8gLTUKICAgKgogICAqIHRydW5jKDQuMik7ICAvLyA0CiAgICogdHJ1bmMoLTQuMik7IC8vIC00CiAgICogYGBgCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gaW5wdXQgQW55IG51bWJlcgogICAqIEByZXR1cm5zIHtudW1iZXJ9IG91dHB1dCBUaGUgaW50ZWdlciBwYXJ0IG9ubHkgb2YgdGhhdCBudW1iZXIKICAgKgogICAqIEBzZWUge0BsaW5rIGZsb29yfQogICAqLwogIHRydW5jLAp9ID0gTWF0aDsKCi8qKgogKiBDb25zdHJhaW4gYSBudW1iZXIgdG8gd2l0aGluIGEgZ2l2ZW4gcmFuZ2UuCiAqIFRoaXMgaXMgcmVhbGx5IG5vdGhpbmcgbW9yZSB0aGFuIGEgY29udmVuaWVudAogKiBmdW5jdGlvbiB3cmFwcGVyIGFyb3VuZCB0aGUgc3RhdGVtZW50OgogKgogKiBgYGAKICogdiA8IHMgPyBzIDogdiA+IGUgPyBlIDogdgogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb25zdHJhaW4KICogQHBhcmFtIHtudW1iZXJ9IGxvd2VyQm91bmQgVGhlIGxvd2VyIGJvdW5kIG9uIG91ciB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0gdXBwZXJCb3VuZCBUaGUgdXBwZXIgYm91bmQgb24gb3VyIHZhbHVlCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSB2YWx1ZSwgaWYgaXQgZmFsbHMgd2l0aGluZyBbbG93ZXJCb3VuZCx1cHBlckJvdW5kXSwgb3RoZXJ3aXNlIG9uZSBvZiB0aG9zZSBib3VuZHMuCiAqCiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbk1hcH0KICovCmZ1bmN0aW9uIGNvbnN0cmFpbih2LCBzLCBlKSB7CiAgcmV0dXJuIHYgPCBzID8gcyA6IHYgPiBlID8gZSA6IHY7Cn0KCi8qKgogKiBUaGUgY29zZWNhbnQgZnVuY3Rpb24sIHdoaWNoIGlzOgogKgogKiBgYGAKICogMSAvIHNpbih2KQogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSBpbnB1dCB2YWx1ZSwgaW4gcmFkaWFucy4KICogQHJldHVybnMge251bWJlcn0gVGhlIGNvc2VjYW50IG9mIG91ciB2YWx1ZS4KICoKICogQHNlZSB7QGxpbmsgc2VjfQogKi8KZnVuY3Rpb24gY3NjKHYpIHsKICByZXR1cm4gMSAvIHNpbih2KTsKfQoKLyoqCiAqIFRoZSBjb3RhbmdlbnQgZnVuY3Rpb24sIHdoaWNoIGlzOgogKgogKiBgYGAKICogY29zKHYpIC8gc2luKHYpCiAqIGBgYAogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIGlucHV0IHZhbHVlLCBpbiByYWRpYW5zLgogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY290YW5nZW50IG9mIG91ciB2YWx1ZS4KICoKICogQHNlZSB7QGxpbmsgdGFufQogKi8KZnVuY3Rpb24gY3RuKHYpIHsKICByZXR1cm4gY29zKHYpIC8gc2luKHYpOwp9CgovKioKICogQ29udmVydCBhIG51bWJlciBpbiByYWRpYW5zIHRvIGEgbnVtYmVyIGluIGRlZ3JlZXMuCiAqIFRoaXMgaXMgcmVhbGx5IG5vdGhpbmcgbW9yZSB0aGFuIGEgY29udmVuaWVudAogKiBmdW5jdGlvbiB3cmFwcGVyIGFyb3VuZCB0aGUgc3RhdGVtZW50OgogKgogKiBgYGAKICogdi9QSSAqIDE4MAogKiBgYGAKICoKICogV2l0aCBvbmUgdHJpY2ssIGluIHRoYXQgaXQgYWxsb3dzIHlvdSB0byBjb25zdHJhaW4gdGhlCiAqIHJlc3VsdGFudCB2YWx1ZSB0byB0aGUgc3RhbmRhcmQgWzAsIDM2MF0gaW50ZXJ2YWwuCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29uc3RyYWluCiAqIEBwYXJhbSB7Ym9vbGVhbn0gY29uc3RyYWluPyBBIGJvb2xlYW4gdGhhdCBkZXRlcm1pbmVzIHdoZXRoZXIgb3Igbm90IHRvIGNvbnN0cmFpbiB0aGUgcmVzdWx0YW50IHZhbHVlIHRvIFswLCAzNjBdIChkZWZhdWx0ID0gZmFsc2UpCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBkZWdyZWUgdmFsdWUgY29ycmVzcG9uZGluZyB0byB0aGUgaW5wdXQgdmFsdWUgaW4gcmFkaWFucywgb3B0aW9uYWxseSBjb25zdHJhaW5lZCB0byBbMCwgMzYwXQogKgogKiBAc2VlIHtAbGluayByYWRpYW5zfQogKiBAc2VlIHtAbGluayBjb25zdHJhaW59CiAqLwpmdW5jdGlvbiBkZWdyZWVzKHYsIGNvbnN0cmFpbiA9IGZhbHNlKSB7CiAgbGV0IGQgPSAodiAvIFBJKSAqIDE4MDsKICBpZiAoIWNvbnN0cmFpbikgcmV0dXJuIGQ7CiAgd2hpbGUgKGQgPCAwKSBkICs9IDM2MDsKICByZXR1cm4gZCAlIDM2MDsKfQoKLyoqCiAqIENhbGN1bGF0ZSB0aGUgMkQgRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gdHdvIHBvaW50cy4KICoKICogQHBhcmFtIHtudW1iZXJ9IHgxIFRoZSBmaXJzdCBwb2ludCdzIHggcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHkxIFRoZSBmaXJzdCBwb2ludCdzIHkgcGl4ZWwgdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHgyIFRoZSBzZWNvbmQgcG9pbnQncyB4IHBpeGVsIHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSB5MiBUaGUgc2Vjb25kIHBvaW50J3MgeSBwaXhlbCB2YWx1ZQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgZXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gdGhlIHR3byBjb29yZGluYXRlcwogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDEgVGhlIGZpcnN0IHBvaW50J3Mge3gseX0gY29vcmRpbmF0ZQogKiBAcGFyYW0ge1BvaW50TGlrZX0gcDIgVGhlIHNlY29uZCBwb2ludCdzIHt4LHl9IGNvb3JkaW5hdGUKICogQHJldHVybnMge251bWJlcn0gVGhlIGV1Y2xpZGVhbiBkaXN0YW5jZSBiZXR3ZWVuIHRoZSB0d28gY29vcmRpbmF0ZXMKICovCmZ1bmN0aW9uIGRpc3QoeDEsIHkxLCB4MiwgeTIpIHsKICBpZiAoeDEueCAhPT0gdW5kZWZpbmVkICYmIHgxLnkgIT09IHVuZGVmaW5lZCkgewogICAgeTIgPSB5MS55OwogICAgeDIgPSB5MS54OwogICAgeTEgPSB4MS55OwogICAgeDEgPSB4MS55OwogIH0KICBjb25zdCBkeCA9IHgyIC0geDE7CiAgY29uc3QgZHkgPSB5MiAtIHkxOwogIHJldHVybiBoeXBvdChkeCwgZHkpOwp9CgovKioKICogTWFwIGEgdmFsdWUgZnJvbSBvbmUgaW50ZXJ2YWwgdG8gYW5vdGhlciwgb3B0aW9uYWxseQogKiBjb25zdHJhaW5lZCB0byB0aGUgdGFyZ2V0IGludGVydmFsLgogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgT3VyIGlucHV0IHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyfSBvcmlnaW5hbFN0YXJ0IFRoZSBsb3dlciBib3VuZCBvZiBvdXIgZG9tYWluCiAqIEBwYXJhbSB7bnVtYmVyfSBvcmlnaW5hbEVuZCBUaGUgdXBwZXIgYm91bmQgb2Ygb3VyIGRvbWFpbgogKiBAcGFyYW0ge251bWJlcn0gbmV3U3RhcnQgVGhlIGxvd2VyIGJvdW5kIG9mIG91ciB0YXJnZXQgaW50ZXJ2YWwKICogQHBhcmFtIHtudW1iZXJ9IG5ld0VuZCBUaGUgdXBwZXIgYm91bmQgb24gb3VyIHRhcmdldCBpbnRlcnZhbAogKiBAcGFyYW0ge2Jvb2xlYW59IGNvbnN0cmFpbj8gIEEgYm9vbGVhbiB0aGF0IGRldGVybWluZXMgd2hldGhlciBvciBub3QgdG8gY29uc3RyYWluIHRoZSByZXN1bHRhbnQgdmFsdWUgdG8gWzAsMzYwXSAoZGVmYXVsdCA9IGZhbHNlKQogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgcmVzdWx0IG9mIG1hcHBpbmcgb3VyIHZhbHVlIGZyb20gb3VyIGRvbWFpbiBpbnRlcnZhbCB0byBvdXIgdGFyZ2V0IGludGVydmFsLCBvcHRpb25hbGx5IGNvbnN0cmFpbmVkIHRvIHRoZSB0YXJnZXQgaW50ZXJ2YWwuCiAqCiAqIEBzZWUge0BsaW5rIGNvbnN0cmFpbn0KICogQHNlZSB7QGxpbmsgY29uc3RyYWluTWFwfQogKi8KZnVuY3Rpb24gbWFwKHYsIHMsIGUsIG5zLCBuZSwgY29uc3RyYWluZWQgPSBmYWxzZSkgewogIGNvbnN0IGkxID0gZSAtIHMsCiAgICBpMiA9IG5lIC0gbnMsCiAgICBwID0gdiAtIHM7CiAgbGV0IHIgPSBucyArIChwICogaTIpIC8gaTE7CiAgaWYgKGNvbnN0cmFpbmVkKSByZXR1cm4gY29uc3RyYWluKHIsIG5zLCBuZSk7CiAgcmV0dXJuIHI7Cn0KCi8qKgogKiBDb252ZXJ0IGEgbnVtYmVyIGluIGRlZ3JlZXMgdG8gYSBudW1iZXIgaW4gcmFkaWFucy4KICogVGhpcyBpcyByZWFsbHkgbm90aGluZyBtb3JlIHRoYW4gYSBjb252ZW5pZW50CiAqIGZ1bmN0aW9uIHdyYXBwZXIgYXJvdW5kIHRoZSBzdGF0ZW1lbnQ6CiAqCiAqIGBgYAogKiB2LzE4MCAqIFBJCiAqIGBgYAogKgogKiBXaXRoIG9uZSB0cmljaywgaW4gdGhhdCBpdCBhbGxvd3MgeW91IHRvIGNvbnN0cmFpbiB0aGUKICogcmVzdWx0YW50IHZhbHVlIHRvIHRoZSBzdGFuZGFyZCBbMCwgVEFVXSBpbnRlcnZhbC4KICoKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb25zdHJhaW4KICogQHBhcmFtIHtib29sZWFufSBjb25zdHJhaW4/IEEgYm9vbGVhbiB0aGF0IGRldGVybWluZXMgd2hldGhlciBvciBub3QgdG8gY29uc3RyYWluIHRoZSByZXN1bHRhbnQgdmFsdWUgdG8gWzAsIFRBVV0gKGRlZmF1bHQgPSBmYWxzZSkKICogQHJldHVybnMge251bWJlcn0gVGhlIHJhZGlhbnMgdmFsdWUgY29ycmVzcG9uZGluZyB0byB0aGUgaW5wdXQgdmFsdWUgaW4gZGVncmVlcywgb3B0aW9uYWxseSBjb25zdHJhaW5lZCB0byBbMCwgVEFVXQogKgogKiBAc2VlIHtAbGluayBkZWdyZWVzfQogKiBAc2VlIHtAbGluayBjb25zdHJhaW59CiAqLwpmdW5jdGlvbiByYWRpYW5zKHYsIGNvbnN0cmFpbiA9IGZhbHNlKSB7CiAgbGV0IHIgPSAodiAvIDE4MCkgKiBQSTsKICBpZiAoIWNvbnN0cmFpbikgcmV0dXJuIHI7CiAgd2hpbGUgKHIgPCAwKSByICs9IFRBVTsKICByZXR1cm4gciAlIFRBVTsKfQoKLyoqCiAqIEdlbmVyYXRlIGEgcHNldWRvLXJhbmRvbSBudW1iZXIuCiAqCiAqIFRoaXMgaXMgYmFzZWQgb24gdGhlIFNwbGl0TWl4MzIgYWxnb3JpdGhtLCBjb3ZlcmVkCiAqIG92ZXIgb24gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzQ3NTkzMzE2Lzc0MDU1MwogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGBibGFja2ApOwogKiAgICAgICBzZXRGb250U2l6ZSgyMCk7CiAqICAgICAgIHJhbmdlKDAsIGhlaWdodCArIDIwLCAyMCwgKHYpID0+IHsKICogICAgICAgICB0ZXh0KHJhbmRvbSgpLCA1LCB2KTsKICogICAgICAgfSkKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKgogKgogKiBAcmV0dXJucyB7bnVtYmVyfSBBIHJhbmRvbSBudW1iZXIgaW4gdGhlIGludGVydmFsIFswLDEpCiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBhIFRoZSB1cHBlciBib3VuZCBmb3IgdGhlIHJhbmRvbSBudW1iZXIKICogQHJldHVybnMge251bWJlcn0gQSByYW5kb20gbnVtYmVyIGluIHRoZSBpbnRlcnZhbCBbMCxhKQogKgogKiBAcGFyYW0ge251bWJlcn0gYSBUaGUgbG93ZXIgYm91bmQgZm9yIHRoZSByYW5kb20gbnVtYmVyCiAqIEBwYXJhbSB7bnVtYmVyfSBiIFRoZSB1cHBlciBib3VuZCBmb3IgdGhlIHJhbmRvbSBudW1iZXIKICogQHJldHVybnMge251bWJlcn0gQSByYW5kb20gbnVtYmVyIGluIHRoZSBpbnRlcnZhbCBbYSwgYikKICoKICogQHNlZSB7QGxpbmsgcmFuZG9tU2VlZH0KICovCmZ1bmN0aW9uIHJhbmRvbShhID0gMSwgYikgewogIGNvbnN0IHIgPSBfX3BybmcubmV4dCgpOwogIGlmIChiID09PSB1bmRlZmluZWQpIHJldHVybiBhICogcjsKICByZXR1cm4gYSArIHIgKiAoYiAtIGEpOwp9CgovKioKICogU2V0IHRoZSBwc2V1ZG8tcmFuZG9tIG51bWJlciBnZW5lcmF0b3Igc2VlZC4gSWYgbm8gc2VlZAogKiB2YWx1ZSBpcyBwcm92aWRlZCwgdGhpcyBpcyBlcXVpdmFsZW50IHRvIGNhbGxpbmc6CiAqCiAqIGBgYAogKiByYW5kb21TZWVkKERhdGUubm93KCkgKiBNYXRoLnJhbmRvbSgpKQogKiBgYGAKICoKICogQHBhcmFtIHtudW1iZXJ9IHNlZWQ/IFRoZSByYW5kb20gc2VlZCB2YWx1ZS4KICoKICogQHNlZSB7QGxpbmsgcmFuZG9tfQogKi8KZnVuY3Rpb24gcmFuZG9tU2VlZChzZWVkID0gRGF0ZS5ub3coKSAqIE1hdGgucmFuZG9tKCkpIHsKICBfX3BybmcucmVzZWVkKHNlZWQpOwp9CgovKioKICogVGhlIHNlY2FudCBmdW5jdGlvbiwgd2hpY2ggaXM6CiAqCiAqIGBgYAogKiAxIC8gY29zKHYpCiAqIGBgYAogKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIGlucHV0IHZhbHVlLCBpbiByYWRpYW5zLgogKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgc2VjYW50IG9mIG91ciB2YWx1ZS4KICoKICogQHNlZSB7QGxpbmsgY3NjfQogKi8KZnVuY3Rpb24gc2VjKHYpIHsKICByZXR1cm4gMSAvIGNvcyh2KTsKfQovKioKICogUHJvamVjdCBhIDNEIGNvb3JkaW5hdGUgdG8gMkQuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldFByb2plY3Rvcih3aWR0aCAvIDIsIGhlaWdodCAvIDIsIDUwLCAtMC40KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgLTEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoMSwgMSwgLTEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAxKSwgcHJvamVjdCgxLCAxLCAxKSk7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgLTEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoLTEsIDEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KDEsIC0xLCAtMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KDEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAxKSk7CiAqICAgICAgIHNldENvbG9yKGBncmVlbmApOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoLTEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSAzRCBjb29yZGluYXRlJ3MgeCB2YWx1ZQogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgM0QgY29vcmRpbmF0ZSdzIHggdmFsdWUKICogQHBhcmFtIHtudW1iZXJ9IHogVGhlIDNEIGNvb3JkaW5hdGUncyB4IHZhbHVlCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgIFRoZSBwcm9qZWN0ZWQgMkQge3gseX0gY29vcmRpbmF0ZQogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUgMkQgY29vcmRpbmF0ZSBhcyB7eCx5LHp9IGNvb3JkaW5hdGUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCAgVGhlIHByb2plY3RlZCAyRCB7eCx5fSBjb29yZGluYXRlCiAqCiAqIEBzZWUge0BsaW5rIHNldFByb2plY3Rvcn0KICovCmZ1bmN0aW9uIHByb2plY3QoeCwgeSwgeikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCAmJiB4LnogIT09IHVuZGVmaW5lZCkgewogICAgeiA9IHguejsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICByZXR1cm4gX19wcm9qZWN0b3IucHJvamVjdCh4LCB5LCB6KTsKfQoKLyoqCiAqIFNldCB0aGUgcHJvamVjdG9yJ3MgeCwgeSwgYW5kIHogYXhpcyByb3RhdGlvbgogKiBpbiByYWRpYW5zLiBOb3RlIHRoYXQgdGhlc2UgYXJlIGFwcGxpZWQgaW4gb3JkZXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldFByb2plY3Rvcih3aWR0aCAvIDIsIGhlaWdodCAvIDIsIDUwLCAtMC40KTsKICogICAgICAgcGxheSgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIGNvbnN0IG0gPSBtaWxsaXMoKSAvIDUwMDA7CiAqICAgICAgIHJvdGF0ZVByb2plY3RvcihtLCAyICogbSwgMyAqIG0pOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgLTEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoMSwgMSwgLTEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAxKSwgcHJvamVjdCgxLCAxLCAxKSk7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgLTEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoLTEsIDEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KDEsIC0xLCAtMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KDEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAxKSk7CiAqICAgICAgIHNldENvbG9yKGBncmVlbmApOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoLTEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBhbmdsZSBvZiByb3RhdGlvbiBvdmVyIHRoZSB4IGF4aXMgaW4gcmFkaWFucwogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgYW5nbGUgb2Ygcm90YXRpb24gb3ZlciB0aGUgeSBheGlzIGluIHJhZGlhbnMKICogQHBhcmFtIHtudW1iZXJ9IHogVGhlIGFuZ2xlIG9mIHJvdGF0aW9uIG92ZXIgdGhlIHogYXhpcyBpbiByYWRpYW5zCiAqCiAqIEBzZWUge0BsaW5rIHByb2plY3R9CiAqLwpmdW5jdGlvbiByb3RhdGVQcm9qZWN0b3IoeCwgeSwgeikgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCAmJiB4LnogIT09IHVuZGVmaW5lZCkgewogICAgeiA9IHguejsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KICBfX3Byb2plY3Rvci5zZXRSb3RhdGlvbih4LCB5LCB6KTsKfQoKLyoqCiAqIFNldCB0aGUgcHJvamVjdCBwYXJhbWV0ZXJzLiBDdXJyZW50bHksIG9ubHkKICogY2FiaW5ldCBwcm9qZWN0IGlzIHN1cHBvcnRlZCwgd2hpY2ggYWNjZXB0cwogKiB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldFByb2plY3Rvcih3aWR0aCAvIDIsIGhlaWdodCAvIDIsIDUwLCAtMC40KTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgLTEsIC0xKSwgcHJvamVjdCgxLCAtMSwgLTEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAtMSwgMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoMSwgMSwgLTEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAxKSwgcHJvamVjdCgxLCAxLCAxKSk7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIGxpbmUocHJvamVjdCgtMSwgLTEsIC0xKSwgcHJvamVjdCgtMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoLTEsIDEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KDEsIC0xLCAtMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KDEsIDEsIC0xKSwgcHJvamVjdCgxLCAxLCAxKSk7CiAqICAgICAgIHNldENvbG9yKGBncmVlbmApOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgLTEpLCBwcm9qZWN0KDEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoMSwgMSwgMSksIHByb2plY3QoMSwgLTEsIDEpKTsKICogICAgICAgbGluZShwcm9qZWN0KC0xLCAxLCAtMSksIHByb2plY3QoLTEsIC0xLCAtMSkpOwogKiAgICAgICBsaW5lKHByb2plY3QoLTEsIDEsIDEpLCBwcm9qZWN0KC0xLCAtMSwgMSkpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSAge251bWJlcn0geE9mZnNldCBvZiB0aGUgcHJvamVjdGlvbiB3cnQgdGhlIGNhbnZhcyAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSAge251bWJlcn0geU9mZnNldCBvZiB0aGUgcHJvamVjdGlvbiB3cnQgdGhlIGNhbnZhcyAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSAge251bWJlcn0gc2NhbGUgZmFjdG9yIGZvciB0aGUgM0QgaW5wdXQgKGRlZmF1bHQgPSAxKQogKiBAcGFyYW0gIHtudW1iZXJ9IGNhYmluZXQgYW5nbGUgaW4gcmFkaWFucyAoZGVmYXVsdCA9IC1waS82KQogKgogKiBAc2VlIHtAbGluayBwcm9qZWN0fQogKi8KZnVuY3Rpb24gc2V0UHJvamVjdG9yKC4uLmFyZ3MpIHsKICBfX3Byb2plY3Rvci51cGRhdGUoLi4uYXJncyk7Cn0KLyoqCiAqIFNldCBhIGJvcmRlciBhcm91bmQgdGhlIGNhbnZhcy4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgc2V0Qm9yZGVyKDEwLCBgcmVkYCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ8Ym9vbGVhbn0gd2lkdGg/IFRoZSB3aWR0aCBvZiB0aGUgYm9yZGVyIGluIHBpeGVscywgZGlzYWJsaW5nIHRoZSBib3JkZXIgb21pdHRlZAogKiBAcGFyYW0ge3N0cmluZ30gY29sb3I/IFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyIChkZWZhdWx0ID0gYmxhY2spCiAqCiAqIEBzZWUge0BsaW5rIG5vQm9yZGVyfQogKi8KZnVuY3Rpb24gc2V0Qm9yZGVyKHdpZHRoID0gMSwgY29sb3IgPSBgYmxhY2tgKSB7CiAgaWYgKCF3aWR0aCkgewogICAgX19jYW52YXMuc3R5bGUuYm9yZGVyID0gYG5vbmVgOwogIH0gZWxzZSB7CiAgICBfX2NhbnZhcy5zdHlsZS5ib3JkZXIgPSBgJHt3aWR0aH1weCBzb2xpZCAke2NvbG9yfWA7CiAgfQp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IHN0cm9rZSBhbmQgZmlsbCBjb2xvdXIgYXQKICogdGhlIHNhbWUgdGltZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldENvbG9yKGBibHVlYCk7CiAqICAgICAgIHJlY3QoNTAsIDUwLCAxMDAsIDEwMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yIFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyCiAqCiAqIEBzZWUge0BsaW5rIHNldFN0cm9rZX0KICogQHNlZSB7QGxpbmsgc2V0RmlsbH0KICogQHNlZSB7QGxpbmsgbm9Db2xvcn0KICovCmZ1bmN0aW9uIHNldENvbG9yKGNvbG9yKSB7CiAgc2V0RmlsbChjb2xvcik7CiAgc2V0U3Ryb2tlKGNvbG9yKTsKfQoKLyoqCiAqIENoYW5nZSB0aGUgY3Vyc29yIHRvIGEgc3BlY2lmaWMgaWNvbjoKICoKICogLSBBVVRPIC0gdXNlIHdoYXRldmVyIHRoZSBicm93c2VyIHdvdWxkIG90aGVyd2lzZSB1c2UKICogLSBDUk9TUyAtIHVzZSBhIGNyb3NzLWhhaXIgaWNvbgogKiAtIFBPSU5URVIgLSB1c2UgdGhlICJwb2ludGVyIiBpY29uIHRoYXQgaXMgYWxzbyB1c2VkIGZvciBjbGlja2FibGUgbGlua3MKICoKICogVXNlIGFueSBvdGhlciBzdHJpbmcgZm91bmQgb3ZlciBvbiB0aGUgTUROIGN1cnNvciBhcnRpY2xlIHRvIHNldCBhIGN1cnNvciBub3QgY292ZXJlZCBieSB0aGUgYWJvdmUgY29uc3RhbnRzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYHdoaXRlYCk7CiAqICAgICAgIHNldENvbG9yKGAjRkYwMmApOwogKiAgICAgICByZWN0KDAsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICAgIHNldENvbG9yKGAjMEZGMmApOwogKiAgICAgICByZWN0KHdpZHRoLzIsIDAsIHdpZHRoLzIsIGhlaWdodCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBwb2ludGVyTW92ZSh4LCB5KSB7CiAqICAgICAgIGlmICh4IDwgd2lkdGgvMikgewogKiAgICAgICAgIHNldEN1cnNvcihBVVRPKTsKICogICAgICAgfSBlbHNlIHsKICogICAgICAgICBub0N1cnNvcigpOwogKiAgICAgICB9CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgVGhlIENTUyBjdXJzb3IgdHlwZQogKgogKiBAc2VlIHtAbGluayBub0N1cnNvcn0KICovCmZ1bmN0aW9uIHNldEN1cnNvcih0eXBlKSB7CiAgX19jdXJyZW50X2N1cnNvciA9IHR5cGU7CiAgX19jYW52YXMuc3R5bGUuY3Vyc29yID0gX19jdXJyZW50X2N1cnNvcjsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBmaWxsIGNvbG91ci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHJlY3QoNTAsIDUwLCAxMDAsIDEwMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yIFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyIChkZWZhdWx0ID0gYmxhY2spCiAqCiAqIEBzZWUge0BsaW5rIG5vRmlsbH0KICovCmZ1bmN0aW9uIHNldEZpbGwoY29sb3IgPSBgYmxhY2tgKSB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdID09PSBfX2hpZ2hsaWdodF9jb2xvcikgewogICAgY29sb3IgPSBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwogIH0KICBfX2N0eC5maWxsU3R5bGUgPSBjb2xvcjsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBmb250IHVzaW5nIGEgc2luZ2xlIHN0cmluZy4gRm9yIHRoZSBzeW50YXgsCiAqIHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9DU1MvZm9udAogKgogKiBAcGFyYW0ge3N0cmluZ30gZm9udCBBIENTUyBzaG9ydGhhbmQgZm9udCBwcm9wZXJ0eQogKgogKiBAc2VlIHtAbGluayBzZXRGb250RmFtaWx5fQogKiBAc2VlIHtAbGluayBzZXRGb250U2l6ZX0KICogQHNlZSB7QGxpbmsgc2V0Rm9udFdlaWdodH0KICovCmZ1bmN0aW9uIHNldEZvbnQoZm9udCkgewogIF9fY3R4LmZvbnQgPSBmb250IHx8IGAke19fZm9udC53ZWlnaHR9ICR7X19mb250LnNpemV9cHggJHtfX2ZvbnQuZmFtaWx5fWA7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgZm9udCBmYW1pbHkuCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIFRoZSBDU1MgZm9udCBmYW1pbHkgbmFtZQogKgogKiBAc2VlIHtAbGluayBzZXRGb250U2l6ZX0KICogQHNlZSB7QGxpbmsgc2V0Rm9udFdlaWdodH0KICovCmZ1bmN0aW9uIHNldEZvbnRGYW1pbHkobmFtZSkgewogIF9fZm9udC5mYW1pbHkgPSBuYW1lOwogIHNldEZvbnQoKTsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBmb250IHNpemUKICoKICogQHBhcmFtIHtudW1iZXJ9IHB4IFRoZSBmb250IHNpemUgaW4gcGl4ZWxzCiAqCiAqIEBzZWUge0BsaW5rIHNldEZvbnRGYW1pbHl9CiAqIEBzZWUge0BsaW5rIHNldEZvbnRXZWlnaHR9CiAqLwpmdW5jdGlvbiBzZXRGb250U2l6ZShweCkgewogIF9fZm9udC5zaXplID0gcHg7CiAgc2V0Rm9udCgpOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IGZvbnQgd2VpZ2h0CiAqCiAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gdmFsIFRoZSBDU1Mgd2VpZ2h0IG51bWJlciBvciBlaXRoZXIgb2YgdGhlIHNwZWNpYWwgc3RyaW5ncyAibm9ybWFsIiwgImJvbGQiLCAiYm9sZGVyIiwgb3IgImxpZ2h0ZXIiLgogKgogKiBAc2VlIHtAbGluayBzZXRGb250RmFtaWx5fQogKiBAc2VlIHtAbGluayBzZXRGb250U2l6ZX0KICovCmZ1bmN0aW9uIHNldEZvbnRXZWlnaHQodmFsKSB7CiAgX19mb250LndlaWdodCA9IHZhbDsKICBzZXRGb250KCk7Cn0KCi8qKgogKiBTZXQgdGhlIGJhY2tncm91bmQgZ3JpZCBzcGFjaW5nIGFuZCBjb2xvdXIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBzZXRHcmlkKDIwLCBgbGF2ZW5kZXJgKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSBzcGFjaW5nPyBUaGUgc3BhY2luZyBiZXR3ZWVuIGdyaWQgbGluZXMgaW4gcGl4ZWxzIChkZWZhdWx0ID0gMjApCiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvcj8gVGhlIENTUyBjb2xvciB0byB1c2UgZm9yIHRoZSBib3JkZXIgKGRlZmF1bHQgPSBsaWdodGdyZXkpCiAqCiAqIEBzZWUge0BsaW5rIG5vR3JpZH0KICovCmZ1bmN0aW9uIHNldEdyaWQoc3BhY2luZyA9IDIwLCBjb2xvciA9IGBsaWdodGdyZXlgKSB7CiAgX19kcmF3X2dyaWQgPSB0cnVlOwogIF9fZ3JpZF9zcGFjaW5nID0gc3BhY2luZzsKICBfX2dyaWRfY29sb3IgPSBjb2xvcjsKfQoKLyoqCiAqIFNldCB0aGUgY29sb3IgdGhhdCBzaG91bGQgYmUgdXNlZCB0byByZXBsYWNlIHdoYXRldmVyCiAqIGhpZ2hsaWdodCgpIG1hcmtlZCBhcyB0aGUgInRvIGhpZ2hsaWdodCIgY29sb3IuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIHNldEhpZ2hsaWdodENvbG9yKGBsaW1lYCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgc2V0VGV4dEFsaWduKENFTlRFUiwgTUlERExFKTsKICogICAgICAgdGV4dCgibGV0J3MgZ28iLCB3aWR0aC8yLCBoZWlnaHQvMikKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIHBvaW50ZXJBY3RpdmUoc3RhdGUpIHsKICogICAgICAgaWYgKHN0YXRlKSBoaWdobGlnaHQoYHJlZGApOwogKiAgICAgICBlbHNlIGhpZ2hsaWdodChmYWxzZSk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yIFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyCiAqCiAqIEBzZWUge0BsaW5rIGhpZ2hsaWdodH0KICovCmZ1bmN0aW9uIHNldEhpZ2hsaWdodENvbG9yKGNvbG9yKSB7CiAgX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvciA9IGNvbG9yOwp9CgovKioKICogU2V0IHRoZSBsaW5lIGRhc2ggcHJvcGVydHkuIFNlZSB0aGUgZm9sbG93aW5nIE1ETiBhcnRpY2xlIGZvciB0aGUgZGV0YWlsczoKICoKICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZG9jcy9XZWIvQVBJL0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC9zZXRMaW5lRGFzaAogKgogKiBAcGFyYW0gIHtudW1iZXJbXX0gLi4udmFsdWVzIFRoZSBkYXNoIGludGVydmFscyBpbiBwaXhlbAogKgogKiBAc2VlIHtAbGluayBub0xpbmVEYXNofQogKi8KZnVuY3Rpb24gc2V0TGluZURhc2goLi4udmFsdWVzKSB7CiAgX19jdHguc2V0TGluZURhc2godmFsdWVzKTsKfQoKLyoqCiAqIFNldCB0aGUgbGluZSB3aWR0aCBpbiBwaXhlbHMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHJhbmdlKDEsIDEwLCAoaSkgPT4gewogKiAgICAgICAgIHNldExpbmVXaWR0aChpKTsKICogICAgICAgICBsaW5lKDIwLCBpICogMjAsIDE4MCwgaSAqIDIwKTsKICogICAgICAgfSkKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0gd2lkdGg/IFRoZSBsaW5lIHdpZHRoIGluIHBpeGVscyAoZGVmYXVsdCA9IDEpCiAqCiAqIEBzZWUge0BsaW5rIHNldFRleHRTdHJva2V9CiAqLwpmdW5jdGlvbiBzZXRMaW5lV2lkdGgod2lkdGggPSAxKSB7CiAgX19jdHgubGluZVdpZHRoID0gd2lkdGg7Cn0KCi8qKgogKiBTZXQgdGhlIGN1cnJlbnQgc3Ryb2tlIGNvbG91ci4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKCk7CiAqICAgICAgIHNldFN0cm9rZShgYmxhY2tgKTsKICogICAgICAgc2V0RmlsbChgcmVkYCk7CiAqICAgICAgIHJlY3QoNTAsIDUwLCAxMDAsIDEwMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yIFRoZSBDU1MgY29sb3IgdG8gdXNlIGZvciB0aGUgYm9yZGVyIChkZWZhdWx0ID0gYmxhY2spCiAqCiAqIEBzZWUge0BsaW5rIHNldEZpbGx9CiAqIEBzZWUge0BsaW5rIHNldENvbG9yfQogKi8KZnVuY3Rpb24gc2V0U3Ryb2tlKGNvbG9yID0gYGJsYWNrYCkgewogIGlmIChDU1NfQ09MT1JfTUFQW2NvbG9yXSA9PT0gX19oaWdobGlnaHRfY29sb3IpIHsKICAgIGNvbG9yID0gX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvcjsKICB9CiAgX19jdHguc3Ryb2tlU3R5bGUgPSBjb2xvcjsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCB0ZXh0IGFsaWdubWVudCB2YWx1ZXMuCiAqCiAqIFZhbGlkIGB4QWxpZ25gIHZhbHVlcyBhcmU6CiAqCiAqIC0gQ0VOVEVSIC0gdGhlIHRleHQgYW5jaG9yIGlzIGluIHRoZSBtaWRkbGUgb2YgdGhlIHRleHQuIFRleHQgaXMgcGxhY2VkIGV2ZW5seSBvbiBlaXRoZXIgc2lkZS4KICogLSBFTkQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIHJpZ2h0IGZvciBMVFIgdGV4dCwgYW5kIG9uIHRoZSBsZWZ0IGZvciBSVEwgdGV4dC4KICogLSBMRUZUIC0gdGhlIHRleHQgYW5jaG9yIGlzIG9uIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIHRleHQuIGFsbCB0ZXh0IGlzIHRvIHRoZSByaWdodC4KICogLSBSSUdIVCAtIHRoZSB0ZXh0IGFuY2hvciBpcyBvbiB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgdGV4dC4gQWxsIHRleHQgaXMgdG8gdGhlIGxlZnQuCiAqIC0gU1RBUlQgLSB0aGUgdGV4dCBhbmNob3IgaXMgb24gdGhlIGxlZnQgZm9yIExUUiB0ZXh0LCBhbmQgb24gdGhlIHJpZ2h0IGZvciBSVEwgdGV4dC4KICoKICogVmFsaWQgYHlBbGlnbmAgdmFsdWVzIGFyZToKICoKICogLSBBTFBIQUJFVElDIC0gc3RhbmRhcmQgdGV4dCBhbGlnbm1lbnQgKGRlZmF1bHQpCiAqIC0gQk9UVE9NIC0gdGhlIHRleHQgaXMgYWxpZ25lZCB0byB0aGUgYm90dG9tIG9mIHRoZSBib3VuZGluZyBib3gKICogLSBIQU5HSU5HIC0gcmVsZXZhbnQgZm9yIFRpYmV0YW4gYW5kIG90aGVyIEluZGljIHNjcmlwdHMuCiAqIC0gSURFT0dSQVBISUMgLSByZWxldmFudCBmb3IgaWRlb2dyYXBoaWMgQ0pLViB0ZXh0LgogKiAtIE1JRERMRSAtIFRoZSB2ZXJ0aWNhbCBlcXVpdmFsZW50IG9mICJjZW50ZXIiLgogKiAtIFRPUCAtIFRoZSB0ZXh0IGlzIGFsaWduZWQgdG8gdGhlIHRvcCBvZiB0aGUgdHlwb2dyYXBoaWMgImVtIHNxdWFyZSIuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjApOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgbGluZSh3aWR0aCAvIDIsIDAsIHdpZHRoIC8gMiwgaGVpZ2h0KTsKICogICAgICAgbGluZSgwLCBoZWlnaHQgLyAyLCB3aWR0aCwgaGVpZ2h0IC8gMik7CiAqICAgICAgIHNldFRleHRBbGlnbihDRU5URVIsIE1JRERMRSk7CiAqICAgICAgIHRleHQoImNlbnRlciBtaWRkbGUiLCB3aWR0aCAvIDIsIGhlaWdodC8yKTsKICogICAgICAgbGluZSgwLCBoZWlnaHQgLyAyIC0gNTAsIHdpZHRoLCBoZWlnaHQgLyAyIC0gNTApOwogKiAgICAgICBzZXRUZXh0QWxpZ24oUklHSFQsIFRPUCk7CiAqICAgICAgIHRleHQoInJpZ2h0IHRvcCIsIHdpZHRoIC8gMiwgaGVpZ2h0LzIgLSA1MCk7CiAqICAgICAgIGxpbmUoMCwgaGVpZ2h0IC8gMiArIDUwLCB3aWR0aCwgaGVpZ2h0IC8gMiArIDUwKTsKICogICAgICAgc2V0VGV4dEFsaWduKExFRlQsIEJPVFRPTSk7CiAqICAgICAgIHRleHQoImxlZnQgYm90dG9tIiwgd2lkdGggLyAyLCBoZWlnaHQvMiArIDUwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge3N0cmluZ30geEFsaWduIFRoZSBDU1MgaG9yaXpvbnRhbCBhbGlnbm1lbnQKICogQHBhcmFtIHtzdHJpbmd9IHlBbGlnbiBUaGUgQ1NTIHZlcnRpY2FsIGFsaWdubWVudAogKi8KZnVuY3Rpb24gc2V0VGV4dEFsaWduKHhBbGlnbiwgeUFsaWduKSB7CiAgX19jdHgudGV4dEFsaWduID0geEFsaWduOwogIF9fY3R4LnRleHRCYXNlbGluZSA9IHlBbGlnbjsKfQoKLyoqCiAqIFNldCB0aGUgdGV4dCBvdXRsaW5lIHN0cm9raW5nIHByb3BlcnRpZXMuCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgd2hpdGVgKTsKICogICAgICAgc2V0Rm9udFNpemUoMjUpOwogKiAgICAgICBzZXRUZXh0U3Ryb2tlKGByZWRgLCAxKTsKICogICAgICAgc2V0RmlsbChgeWVsbG93YCk7CiAqICAgICAgIHRleHQoImZhbmN5IHRleHQiLCB3aWR0aC8yLCA4MCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgICBzZXRGb250U2l6ZSg2NSk7CiAqICAgICAgIHNldFRleHRTdHJva2UoYHJlZGAsIDMpOwogKiAgICAgICBzZXRGaWxsKGB5ZWxsb3dgKTsKICogICAgICAgdGV4dCgiZmFuY3kgdGV4dCIsIHdpZHRoLzIsIDE0MCwgQ0VOVEVSLCBDRU5URVIpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvciBUaGUgQ1NTIGNvbG9yIHRvIHVzZSBmb3IgdGhlIGJvcmRlcgogKiBAcGFyYW0ge251bWJlcn0gd2lkdGg/IFRoZSB0ZXh0IHN0cm9rZSB3aWR0aCBpbiBwaXhlbHMgKGRlZmF1bHQgPSAxKQogKgogKiBAc2VlIHtAbGluayBzZXRTdHJva2V9CiAqIEBzZWUge0BsaW5rIHNldExpbmVXaWR0aH0KICovCmZ1bmN0aW9uIHNldFRleHRTdHJva2UoY29sb3IsIHdpZHRoID0gMSkgewogIF9fdGV4dFN0cm9rZSA9IGNvbG9yOwogIHNldExpbmVXaWR0aCh3aWR0aCk7Cn0KLyoqCiAqIENlbnRlcnMgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIG9uIHlvdXIgZ3JhcGhpYy4KICogVGhpcyBpcyBlcXVpdmFsZW50IHRvIGNhbGxpbmc6CiAqCiAqIGBgYAogKiB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiBgYGAKICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGB3aGl0ZWApOwogKiAgICAgICBzZXRDb2xvcihgcmVkYCk7CiAqICAgICAgIGNlbnRlcigpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgbGluZSgwLCAtaHVnZSwgMCwgaHVnZSk7CiAqICAgICAgIGxpbmUoLWh1Z2UsIDAsIGh1Z2UsIDApOwogKiAgICAgICBzZXRDb2xvcihyYW5kb21Db2xvcigpKTsKICogICAgICAgcG9pbnQoIDEwLCAgMTApOwogKiAgICAgICBzZXRDb2xvcihyYW5kb21Db2xvcigpKTsKICogICAgICAgcG9pbnQoIDEwLCAtMTApOwogKiAgICAgICBzZXRDb2xvcihyYW5kb21Db2xvcigpKTsKICogICAgICAgcG9pbnQoLTEwLCAtMTApOwogKiAgICAgICBzZXRDb2xvcihyYW5kb21Db2xvcigpKTsKICogICAgICAgcG9pbnQoLTEwLCAgMTApOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqLwpmdW5jdGlvbiBjZW50ZXIoKSB7CiAgdHJhbnNsYXRlKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7Cn0KCi8qKgogKiBSZXNldCB0aGUgY29vcmRpbmF0ZSB0cmFuc2Zvcm0gbWF0cml4LgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBub0dyaWQoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBsaWdodGdyZXlgKTsKICogICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICB0cmFuc2xhdGUoNTAsNTApOwogKiAgICAgICBsaW5lKDAsMCwxMDAsMCk7CiAqICAgICAgIHBvaW50KDAsMCk7CiAqICAgICAgIHNldENvbG9yKGBkYXJrZ3JlZW5gKTsKICogICAgICAgcG9pbnQoMTAsMCk7CiAqICAgICAgIHJvdGF0ZShQSS80KTsKICogICAgICAgcG9pbnQoMTAsMCk7CiAqICAgICAgIGxpbmUoMCwwLDEwMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGJsdWVgKTsKICogICAgICAgcm90YXRlKC1QSS82KQogKiAgICAgICBwb2ludCgxMDAsMCk7CiAqICAgICAgIHNjYWxlKDAuNSwgMC41KTsKICogICAgICAgcG9pbnQoMTAwLDApOwogKiAgICAgICBsaW5lKDEwMCwwLDIwMCwwKTsKICogICAgICAgcmVzZXRUcmFuc2Zvcm0oKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIGxpbmUoMCwzLDEwMCwzKTsKICogICAgICAgcG9pbnQoMCwzKTsKICogICAgICAgcG9pbnQoMTAsMyk7CiAqICAgICAgIHBvaW50KDEwMCwzKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAc2VlIHtAbGluayB0cmFuc2Zvcm19CiAqLwpmdW5jdGlvbiByZXNldFRyYW5zZm9ybSgpIHsKICBfX2N0eC5yZXNldFRyYW5zZm9ybSgpOwp9CgovKioKICogUm90YXRlIHRoZSBjb29yZGluYXRlIHN5c3RlbSB3cnQgdGhlIGN1cnJlbnQgb3JpZ2luLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBub0dyaWQoKTsKICogICAgIH0KICoKICogICAgIGZ1bmN0aW9uIGRyYXcoKSB7CiAqICAgICAgIGNsZWFyKGBsaWdodGdyZXlgKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgc2V0Q29sb3IoYGJsYWNrYCk7CiAqICAgICAgIHBvaW50KDAsMCk7CiAqICAgICAgIHNldENvbG9yKGBkYXJrZ3JlZW5gKTsKICogICAgICAgbGluZSgwLDAsMjAsMjApOwogKiAgICAgICBwb2ludCgyMCwyMCk7CiAqICAgICAgIHJvdGF0ZShQSS80KTsKICogICAgICAgbGluZSgwLDAsMjAsMjApOwogKiAgICAgICBwb2ludCgyMCwyMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIFRoZSBhbmdsZSBieSB3aGljaCB0byByb3RhdGUgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIGluIHJhZGlhbnMKICoKICogQHNlZSB7QGxpbmsgdHJhbnNmb3JtfQogKiBAc2VlIHtAbGluayByZXNldFRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHJvdGF0ZShhbmdsZSA9IDApIHsKICBfX2N0eC5yb3RhdGUoYW5nbGUpOwp9CgovKioKICogU2NhbGUgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIHdydCB0aGUgY3VycmVudCBvcmlnaW4uCiAqCiAqIEV4YW1wbGU6CiAqCiAqIDxncmFwaGljcy1lbGVtZW50PgogKiAgIDxncmFwaGljcy1zb3VyY2U+CiAqICAgICBmdW5jdGlvbiBzZXR1cCgpIHsKICogICAgICAgc2V0U2l6ZSgyMDAsIDIwMCk7CiAqICAgICAgIG5vR3JpZCgpOwogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoYGxpZ2h0Z3JleWApOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogKiAgICAgICBzZXRDb2xvcihgYmxhY2tgKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgICAgc2V0Q29sb3IoYGRhcmtncmVlbmApOwogKiAgICAgICBsaW5lKDAsMCwyMCwyMCk7CiAqICAgICAgIHBvaW50KDIwLDIwKTsKICogICAgICAgcm90YXRlKFBJLzQpOwogKiAgICAgICBzY2FsZSgyKTsKICogICAgICAgbGluZSgwLDAsMjAsMjApOwogKiAgICAgICBwb2ludCgyMCwyMCk7CiAqICAgICB9CiAqICAgPC9ncmFwaGljcy1zb3VyY2U+CiAqIDwvZ3JhcGhpY3MtZWxlbWVudD4KICoKICogQHBhcmFtIHtudW1iZXJ9IHggVGhlIGFtb3VudCBieSB3aGljaCB0byBzY2FsZSB0aGUgeCBjb29yZGluYXRlcy4KICogQHBhcmFtIHtudW1iZXJ9IHk/IFRoZSBhbW91bnQgYnkgd2hpY2ggdG8gc2NhbGUgdGhlIHggY29vcmRpbmF0ZXMgKGRlZmF1bHQgPSBzYW1lIGFzIHgpCiAqCiAqIEBzZWUge0BsaW5rIHRyYW5zZm9ybX0KICogQHNlZSB7QGxpbmsgcmVzZXRUcmFuc2Zvcm19CiAqLwpmdW5jdGlvbiBzY2FsZSh4ID0gMSwgeSA9IHgpIHsKICBfX2N0eC5zY2FsZSh4LCB5KTsKfQoKLyoqCiAqIENvbnZlcnQgYSBzY3JlZW4gKGUuZy4gYnJvd3NlcikgY29vcmRpbmF0ZSBpbnRvIGl0cwogKiBjb3JyZXNwb25kaW5nICJ0cmFuc2Zvcm1lZCIgY29vcmRpbmF0ZS4KICoKICogRXhhbXBsZToKICoKICogPGdyYXBoaWNzLWVsZW1lbnQ+CiAqICAgPGdyYXBoaWNzLXNvdXJjZT4KICogICAgIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICAgICBzZXRTaXplKDIwMCwgMjAwKTsKICogICAgICAgbm9HcmlkKCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcihgbGlnaHRncmV5YCk7CiAqICAgICAgIHRyYW5zbGF0ZSh3aWR0aC8yLCBoZWlnaHQvMik7CiAqICAgICAgIHJvdGF0ZShQSS80KTsKICogICAgICAgc2NhbGUoMC41KTsKICogICAgICAgaWYgKHBvaW50ZXIuYWN0aXZlKSB7CiAqICAgICAgICAgc2V0Q29sb3IoYHJlZGApOwogKiAgICAgICAgIHBvaW50KHBvaW50ZXIueCwgcG9pbnRlci55KTsKICogICAgICAgICBzZXRDb2xvcihgYmx1ZWApOwogKiAgICAgICAgIHBvaW50KHNjcmVlblRvV29ybGQocG9pbnRlci54LCBwb2ludGVyLnkpKTsKICogICAgICAgfQogKiAgICAgfQogKgogKiAgICAgZnVuY3Rpb24gcG9pbnRlck1vdmUoKSB7CiAqICAgICAgIHJlZHJhdygpOwogKiAgICAgfQogKiAgIDwvZ3JhcGhpY3Mtc291cmNlPgogKiA8L2dyYXBoaWNzLWVsZW1lbnQ+CiAqCiAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBzY3JlZW4gY29vcmRpbmF0ZSdzIHggdmFsdWUgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSBzY3JlZW4gY29vcmRpbmF0ZSdzIHkgdmFsdWUgaW4gcGl4ZWxzCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgVGhlIHdvcmxkIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHNjcmVlbiB7eCx5fSBjb29yZGluYXRlCiAqIEByZXR1cm5zIHtQb2ludExpa2V9IHAgVGhlIHdvcmxkIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgcHJvamVjdH0KICogQHNlZSB7QGxpbmsgd29ybGRUb1NjcmVlbn0KICovCmZ1bmN0aW9uIHNjcmVlblRvV29ybGQoeCwgeSkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBsZXQgTSA9IF9fY3R4LmdldFRyYW5zZm9ybSgpLmludmVydFNlbGYoKTsKCiAgcmV0dXJuIG5ldyBQb2ludCh4ICogTS5hICsgeSAqIE0uYyArIE0uZSwgeCAqIE0uYiArIHkgKiBNLmQgKyBNLmYpOwp9CgovKioKICogU2V0IHRoZSBjdXJyZW50IHRyYW5zZm9ybSBtYXRyaXgsIGJhc2VkIG9uIGFwcGx5aW5nOgogKgogKiAgICAgICB8IGEgYiBjIHwKICogICBtID0gfCBkIGUgZiB8CiAqICAgICAgIHwgMCAwIDEgfAogKgogKiBXaXRoIHRoZSBwYXJhbWV0ZXJzIGRlZmF1bHRpbmcgdG8gdGhlIGlkZW50aXR5IG1hdHJpeC4KICoKICogU2VlIHRoZSBmb2xsb3dpbmcgTUROIGFydGljbGUgZm9yIG1vcmUgZGV0YWlscyBhYm91dCB0aGlzIGZ1bmN0aW9uOgogKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9kb2NzL1dlYi9BUEkvQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEL3RyYW5zZm9ybQogKgogKiBAcGFyYW0ge251bWJlcn0gYSAoZGVmYXVsdCA9IDEpCiAqIEBwYXJhbSB7bnVtYmVyfSBiIChkZWZhdWx0ID0gMCkKICogQHBhcmFtIHtudW1iZXJ9IGMgKGRlZmF1bHQgPSAwKQogKiBAcGFyYW0ge251bWJlcn0gZCAoZGVmYXVsdCA9IDApCiAqIEBwYXJhbSB7bnVtYmVyfSBlIChkZWZhdWx0ID0gMSkKICogQHBhcmFtIHtudW1iZXJ9IGYgKGRlZmF1bHQgPSAwKQogKgogKiBAc2VlIHtAbGluayByZXNldFRyYW5zZm9ybX0KICovCmZ1bmN0aW9uIHRyYW5zZm9ybShhID0gMSwgYiA9IDAsIGMgPSAwLCBkID0gMCwgZSA9IDEsIGYgPSAwKSB7CiAgX19jdHgudHJhbnNmb3JtKGEsIGIsIGMsIGQsIGUsIGYpOwp9CgovKioKICogVHJhbnNsYXRlIHRoZSBjb29yZGluYXRlIHN5c3RlbSBieSBzb21lIGFtb3VudCBvZiB4IGFuZCB5IHVuaXRzLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gZHJhdygpIHsKICogICAgICAgY2xlYXIoKTsKICogICAgICAgdHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC8yKTsKICogICAgICAgcG9pbnQoMCwwKTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgeCB2YWx1ZSBpbiBwaXhlbHMgdG8gYmUgdHJlYXRlZCBhcyB0aGUgbmV3ICJ6ZXJvIgogKiBAcGFyYW0ge251bWJlcn0geSBUaGUgeSB2YWx1ZSBpbiBwaXhlbHMgdG8gYmUgdHJlYXRlZCBhcyB0aGUgbmV3ICJ6ZXJvIgogKgogKiBAcGFyYW0ge1BvaW50TGlrZX0gcCBUaGUge3gseX0gY29vcmRpbmF0ZSB0byBiZSB0cmVhdGVkIGFzIHRoZSBuZXcgInplcm8iCiAqCiAqIEBzZWUge0BsaW5rIHRyYW5zZm9ybX0KICogQHNlZSB7QGxpbmsgcmVzZXRUcmFuc2Zvcm19CiAqLwpmdW5jdGlvbiB0cmFuc2xhdGUoeCA9IDAsIHkgPSAwKSB7CiAgaWYgKHgueCAhPT0gdW5kZWZpbmVkICYmIHgueSAhPT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CiAgX19jdHgudHJhbnNsYXRlKHgsIHkpOwp9CgovKioKICogQ29udmVydCBhbiBpbi1jYW52YXMgInRyYW5zZm9ybWVkIiBjb29yZGluYXRlIGludG8gaXRzCiAqIGNvcnJlc3BvbmRpbmcgInNjcmVlbiIgKGkuZS4gYnJvd3NlciBjYW52YXMgb2Zmc2V0KSBjb29yZGluYXRlLgogKgogKiBFeGFtcGxlOgogKgogKiA8Z3JhcGhpY3MtZWxlbWVudD4KICogICA8Z3JhcGhpY3Mtc291cmNlPgogKiAgICAgZnVuY3Rpb24gc2V0dXAoKSB7CiAqICAgICAgIHNldFNpemUoMjAwLCAyMDApOwogKiAgICAgICBwbGF5KCk7CiAqICAgICB9CiAqCiAqICAgICBmdW5jdGlvbiBkcmF3KCkgewogKiAgICAgICBjbGVhcigpOwogKiAgICAgICB0cmFuc2xhdGUod2lkdGggLyAyLCBoZWlnaHQgLyAyKTsKICoKICogICAgICAgcm90YXRlKG1pbGxpcygpIC8gMjAwMCk7CiAqICAgICAgIHNldEZvbnRTaXplKDI1KTsKICogICAgICAgY29uc3QgcCA9IG5ldyBQb2ludCgzMCwgMCk7CiAqICAgICAgIHBvaW50KHApOwogKiAgICAgICB0ZXh0KGAke3AueH0sJHtwLnl9YCwgcC54ICsgMTAsIHAueSArIDEwKTsKICoKICogICAgICAgY29uc3Qge3gsIHl9ID0gd29ybGRUb1NjcmVlbihwKTsKICogICAgICAgcmVzZXRUcmFuc2Zvcm0oKTsKICogICAgICAgc2V0Rm9udFNpemUoMTYpOwogKiAgICAgICB0ZXh0KGAke3gudG9GaXhlZCgpfSwke3kudG9GaXhlZCgpfWAsIHggLSAyNSwgeSAtIDE1KTsKICogICAgIH0KICogICA8L2dyYXBoaWNzLXNvdXJjZT4KICogPC9ncmFwaGljcy1lbGVtZW50PgogKgogKiBAcGFyYW0ge251bWJlcn0geCBUaGUgd29ybGQgY29vcmRpbmF0ZSdzIHggdmFsdWUgaW4gcGl4ZWxzCiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSB3b3JsZCBjb29yZGluYXRlJ3MgeSB2YWx1ZSBpbiBwaXhlbHMKICogQHJldHVybnMge1BvaW50TGlrZX0gcCBUaGUgc2NyZWVuIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHBhcmFtIHtQb2ludExpa2V9IHAgVGhlIHdvcmxkIHt4LHl9IGNvb3JkaW5hdGUKICogQHJldHVybnMge1BvaW50TGlrZX0gcCBUaGUgc2NyZWVuIHt4LHl9IGNvb3JkaW5hdGUKICoKICogQHNlZSB7QGxpbmsgcHJvamVjdH0KICogQHNlZSB7QGxpbmsgc2NyZWVuVG9Xb3JsZH0KICovCmZ1bmN0aW9uIHdvcmxkVG9TY3JlZW4oeCwgeSkgewogIGlmICh4LnggIT09IHVuZGVmaW5lZCAmJiB4LnkgIT09IHVuZGVmaW5lZCkgewogICAgeSA9IHgueTsKICAgIHggPSB4Lng7CiAgfQoKICBsZXQgTSA9IF9fY3R4LmdldFRyYW5zZm9ybSgpOwoKICByZXR1cm4gbmV3IFBvaW50KHggKiBNLmEgKyB5ICogTS5jICsgTS5lLCB4ICogTS5iICsgeSAqIE0uZCArIE0uZik7Cn0KZnVuY3Rpb24gZ3JpZCgpIHsKICBzYXZlKCk7CiAgc2V0TGluZVdpZHRoKDAuNSk7CiAgbm9GaWxsKCk7CiAgc2V0U3Ryb2tlKF9fZ3JpZF9jb2xvcik7CiAgZm9yICgKICAgIGxldCB4ID0gKC0wLjUgKyBfX2dyaWRfc3BhY2luZyAvIDIpIHwgMDsKICAgIHggPCB3aWR0aDsKICAgIHggKz0gX19ncmlkX3NwYWNpbmcKICApIHsKICAgIGxpbmUoeCwgMCwgeCwgaGVpZ2h0KTsKICB9CiAgZm9yICgKICAgIGxldCB5ID0gKC0wLjUgKyBfX2dyaWRfc3BhY2luZyAvIDIpIHwgMDsKICAgIHkgPCBoZWlnaHQ7CiAgICB5ICs9IF9fZ3JpZF9zcGFjaW5nCiAgKSB7CiAgICBsaW5lKDAsIHksIHdpZHRoLCB5KTsKICB9CiAgcmVzdG9yZSgpOwp9CmZ1bmN0aW9uIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCkgewogIC8vIFdlIGRvbid0IHdhbnQgdG8gaW50ZXJmZXJlIHdpdGggdGhlIGJyb3dzZXIsIHNvIHdlJ3JlIG9ubHkKICAvLyBnb2luZyB0byBhbGxvdyB1bm1vZGlmaWVkIGtleXMsIG9yIHNoaWZ0LW1vZGlmaWVkIGtleXMsCiAgLy8gYW5kIHRhYiBoYXMgdG8gYWx3YXlzIHdvcmsuIEZvciBvYnZpb3VzIHJlYXNvbnMuCiAgY29uc3QgdGFiID0gZXZ0LmtleSAhPT0gIlRhYiI7CiAgY29uc3QgZnVuY3Rpb25LZXkgPSBldnQua2V5Lm1hdGNoKC9GXGQrLykgPT09IG51bGw7CiAgY29uc3Qgc3BlY2lmaWNDaGVjayA9IHRhYiAmJiBmdW5jdGlvbktleTsKICBpZiAoIWV2dC5hbHRLZXkgJiYgIWV2dC5jdHJsS2V5ICYmICFldnQubWV0YUtleSAmJiBzcGVjaWZpY0NoZWNrKSB7CiAgICBpZiAoZXZ0LnRhcmdldCA9PT0gX19jYW52YXMpIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIF9fa2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpIHsKICBrZXlib2FyZFtrZXldID0gRGF0ZS5ub3coKTsKICBpZiAodHlwZW9mIGtleURvd24gIT09IGB1bmRlZmluZWRgKQogICAga2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9CgpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKGBrZXlkb3duYCwgKGV2dCkgPT4gewogIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCk7CiAgY29uc3QgeyBrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkgfSA9IGV2dDsKICBpZiAoX19maW5pc2hlZF9zZXR1cCkgX19rZXlEb3duKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn0pOwoKZnVuY3Rpb24gX19rZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpIHsKICBkZWxldGUga2V5Ym9hcmRba2V5XTsKICBpZiAodHlwZW9mIGtleVVwICE9PSBgdW5kZWZpbmVkYCkKICAgIGtleVVwKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn0KCl9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoYGtleXVwYCwgKGV2dCkgPT4gewogIF9fc2FmZWx5SW50ZXJjZXB0S2V5KGV2dCk7CiAgY29uc3QgeyBrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkgfSA9IGV2dDsKICBpZiAoX19maW5pc2hlZF9zZXR1cCkgX19rZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9KTsKZnVuY3Rpb24gX19jaGVja0ZvckN1cnJlbnRQb2ludCh4LCB5LCB0eXBlKSB7CiAgY3VycmVudFBvaW50ID0gZmFsc2U7CgogIGlmICghX19tb3ZhYmxlX3BvaW50cy5sZW5ndGgpIHJldHVybjsKCiAgY29uc3QgbWF0Y2hlcyA9IFtdOwogIGNvbnN0IG1hdGNoUGFkZGluZyA9IHR5cGUuaW5jbHVkZXMoYG1vdXNlYCkgPyAxMCA6IDMwOwoKICBfX21vdmFibGVfcG9pbnRzLmZvckVhY2goKHAsIHBvcykgPT4gewogICAgbGV0IHgyID0gcFswXSA9PT0gdW5kZWZpbmVkID8gcC54IDogcFswXTsKICAgIGxldCB5MiA9IHBbMV0gPT09IHVuZGVmaW5lZCA/IHAueSA6IHBbMV07CiAgICBjb25zdCBkID0gZGlzdCh4LCB5LCB4MiwgeTIpOwogICAgaWYgKGQgPCAocC5yID8gcC5yIDogMCkgKyBtYXRjaFBhZGRpbmcpIHsKICAgICAgbWF0Y2hlcy5wdXNoKHsgcCwgZCB9KTsKICAgIH0KICB9KTsKCiAgX19jYW52YXMuc3R5bGUuY3Vyc29yID0gYGF1dG9gOwoKICBpZiAobWF0Y2hlcy5sZW5ndGgpIHsKICAgIG1hdGNoZXMuc29ydCgoYSwgYikgPT4gYS5kIC0gYi5kKTsKICAgIGN1cnJlbnRQb2ludCA9IG1hdGNoZXNbMF0ucDsKICAgIF9fY2FudmFzLnN0eWxlLmN1cnNvciA9IGBwb2ludGVyYDsKICB9Cn0KCmZ1bmN0aW9uIF9fdG9Qb2ludGVyRXZlbnQoZXZ0KSB7CiAgbGV0IHBvaW50ZXIgPSBldnQ7CiAgLy8gQ29udmVydCBtb3VzZSBvciB0b3VjaCBpbnRvIGdlbmVyaWMgcG9pbnRlci4gV2hpY2ggd2UgbmVlZAogIC8vIHRvIGRvIGJlY2F1c2UgQ2hyb21lIG9uIE1hY09TIGhhcyBkZWNpZGVkIHRvIG5vdCBnZW5lcmF0ZQogIC8vIHBvaW50ZXIgZXZlbnRzIHdoZW4gdGhlcmUncyBhIG1vdXNlLiBUaGFua3MgR29vZ2xlIQogIGlmIChldnQudHlwZS5pbmNsdWRlcyhgdG91Y2hgKSkgewogICAgY29uc3QgeyB0b3VjaGVzLCBjaGFuZ2VkVG91Y2hlcyB9ID0gZXZ0Lm9yaWdpbmFsRXZlbnQgPz8gZXZ0OwogICAgcG9pbnRlciA9IHRvdWNoZXNbMF0gPz8gY2hhbmdlZFRvdWNoZXNbMF07CiAgfQogIGNvbnN0IHsgY2xpZW50WCwgY2xpZW50WSB9ID0gcG9pbnRlcjsKICBjb25zdCB7IGxlZnQsIHRvcCB9ID0gX19jYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgcmV0dXJuIHsgb2Zmc2V0WDogY2xpZW50WCAtIGxlZnQsIG9mZnNldFk6IGNsaWVudFkgLSB0b3AgfTsKfQoKZnVuY3Rpb24gX19wb2ludGVyRG93bih4LCB5KSB7CiAgaWYgKGN1cnJlbnRQb2ludCkgewogICAgY3VycmVudFBvaW50Ll9keCA9IGN1cnJlbnRQb2ludC54IC0geDsKICAgIGN1cnJlbnRQb2ludC5fZHkgPSBjdXJyZW50UG9pbnQueSAtIHk7CiAgfQogIGlmICh0eXBlb2YgcG9pbnRlckRvd24gIT09IGB1bmRlZmluZWRgKSBwb2ludGVyRG93bih4LCB5KTsKfQoKW2B0b3VjaHN0YXJ0YCwgYG1vdXNlZG93bmBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChldnQpID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGNvbnN0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gX190b1BvaW50ZXJFdmVudChldnQpOwogICAgICBjb25zdCB7IHgsIHkgfSA9IHNjcmVlblRvV29ybGQob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwgeyB4LCB5LCB0eXBlLCBkb3duOiB0cnVlLCBtYXJrOiB7IHgsIHkgfSB9KTsKICAgICAgX19jaGVja0ZvckN1cnJlbnRQb2ludCh4LCB5LCB0eXBlKTsKICAgICAgX19wb2ludGVyRG93bih4LCB5KTsKICAgIH0KICB9KTsKfSk7CgpmdW5jdGlvbiBfX3BvaW50ZXJVcCh4LCB5KSB7CiAgaWYgKHR5cGVvZiBwb2ludGVyVXAgIT09IGB1bmRlZmluZWRgKSBwb2ludGVyVXAoeCwgeSk7CiAgaWYgKHBvaW50ZXIubWFyaz8ueCA9PT0geCAmJiBwb2ludGVyLm1hcms/LnkgPT09IHkpIHsKICAgIGlmICh0eXBlb2YgcG9pbnRlckNsaWNrICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlckNsaWNrKHgsIHkpOwogIH0KfQoKW2B0b3VjaGVuZGAsIGBtb3VzZXVwYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2dCkgPT4gewogICAgaWYgKF9fZmluaXNoZWRfc2V0dXApIHsKICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgY29uc3QgeyBvZmZzZXRYLCBvZmZzZXRZIH0gPSBfX3RvUG9pbnRlckV2ZW50KGV2dCk7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUsIGRvd246IGZhbHNlLCBtYXJrOiBmYWxzZSB9KTsKICAgICAgX19wb2ludGVyVXAoeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyTW92ZSh4LCB5KSB7CiAgbGV0IHBvaW50TW92ZWQgPSBmYWxzZTsKICBpZiAocG9pbnRlci5kb3duICYmIGN1cnJlbnRQb2ludCkgewogICAgaWYgKGN1cnJlbnRQb2ludFswXSkgewogICAgICBjdXJyZW50UG9pbnRbMF0gPSB4ICsgY3VycmVudFBvaW50Ll9keDsKICAgICAgY3VycmVudFBvaW50WzFdID0geSArIGN1cnJlbnRQb2ludC5fZHk7CiAgICB9IGVsc2UgewogICAgICBjdXJyZW50UG9pbnQueCA9IHggKyBjdXJyZW50UG9pbnQuX2R4OwogICAgICBjdXJyZW50UG9pbnQueSA9IHkgKyBjdXJyZW50UG9pbnQuX2R5OwogICAgfQogICAgcG9pbnRNb3ZlZCA9IHRydWU7CiAgfQoKICBpZiAodHlwZW9mIHBvaW50ZXJNb3ZlICE9PSBgdW5kZWZpbmVkYCkgewogICAgcG9pbnRlck1vdmUoeCwgeSk7CiAgICBwb2ludGVyLmRyYWcgPSBmYWxzZTsKICAgIGlmIChwb2ludGVyLmRvd24gJiYgdHlwZW9mIHBvaW50ZXJEcmFnICE9PSBgdW5kZWZpbmVkYCkgewogICAgICBwb2ludGVyLmRyYWcgPSB0cnVlOwogICAgICBwb2ludGVyRHJhZyh4LCB5KTsKICAgIH0KICB9CiAgaWYgKHBvaW50TW92ZWQgJiYgIXBsYXlpbmcpIHJlZHJhdygpOwp9CgpbYHRvdWNobW92ZWAsIGBtb3VzZW1vdmVgXS5mb3JFYWNoKCh0eXBlKSA9PiB7CiAgX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCAoZXZ0KSA9PiB7CiAgICBpZiAoX19maW5pc2hlZF9zZXR1cCkgewogICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICBjb25zdCB7IG9mZnNldFgsIG9mZnNldFkgfSA9IF9fdG9Qb2ludGVyRXZlbnQoZXZ0KTsKICAgICAgY29uc3QgeyB4LCB5IH0gPSBzY3JlZW5Ub1dvcmxkKG9mZnNldFgsIG9mZnNldFkpOwogICAgICBPYmplY3QuYXNzaWduKHBvaW50ZXIsIHsgeCwgeSwgdHlwZSB9KTsKICAgICAgaWYgKCFwb2ludGVyLmRvd24pIF9fY2hlY2tGb3JDdXJyZW50UG9pbnQoeCwgeSwgdHlwZSk7CiAgICAgIF9fcG9pbnRlck1vdmUoeCwgeSk7CiAgICB9CiAgfSk7Cn0pOwoKZnVuY3Rpb24gX19wb2ludGVyQWN0aXZlKGFjdGl2ZSkgewogIGlmICh0eXBlb2YgcG9pbnRlckFjdGl2ZSAhPT0gYHVuZGVmaW5lZGApIHsKICAgIHBvaW50ZXJBY3RpdmUoYWN0aXZlKTsKICB9Cn0KCltgdG91Y2hzdGFydGAsIGBtb3VzZWVudGVyYF0uZm9yRWFjaCgodHlwZSkgPT4gewogIF9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKCkgPT4gewogICAgcG9pbnRlci5hY3RpdmUgPSB0cnVlOwogICAgX19wb2ludGVyQWN0aXZlKHRydWUpOwogIH0pOwp9KTsKCltgdG91Y2hlbmRgLCBgbW91c2VsZWF2ZWBdLmZvckVhY2goKHR5cGUpID0+IHsKICBfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsICgpID0+IHsKICAgIHBvaW50ZXIuYWN0aXZlID0gZmFsc2U7CiAgICBfX3BvaW50ZXJBY3RpdmUoZmFsc2UpOwogIH0pOwp9KTsKLyoqCiAqIGNvZGUgdXNlZCBieSBwcm9qZWN0LmpzLCBidXQgbmFtZWQgc28gdGhhdCBpdCBsb2FkcwogKiBmaXJzdCwgYW5kIGRvZXMgbm90IGdldCBhZGRlZCB0byB0aGUgZC50cyBmaWxlLgogKi8KY2xhc3MgQ2FiaW5ldFByb2plY3RvciB7CiAgQSA9IDA7CiAgQiA9IDA7CiAgQyA9IDA7CgogIGNvbnN0cnVjdG9yKG94LCBveSwgc2NhbGUsIHBoaSkgewogICAgdGhpcy51cGRhdGUob3gsIG95LCBzY2FsZSwgcGhpKTsKICB9CgogIHNldFJvdGF0aW9uKHggPSAwLCB5ID0gMCwgeiA9IDApIHsKICAgIHRoaXMuQSA9IHg7CiAgICB0aGlzLkIgPSB6OwogICAgdGhpcy5DID0geTsKICB9CgogIHJvdGF0ZSh4LCB5LCB6KSB7CiAgICBsZXQgeyBBLCBCLCBDIH0gPSB0aGlzOwogICAgbGV0IGEgPSB4OwogICAgbGV0IGIgPSB5ICogY29zKEEpIC0geiAqIHNpbihBKTsKICAgIGxldCBjID0geSAqIHNpbihBKSArIHogKiBjb3MoQSk7CiAgICB4ID0gYTsKICAgIHkgPSBiOwogICAgeiA9IGM7CiAgICBhID0geCAqIGNvcyhCKSArIHogKiBzaW4oQik7CiAgICBiID0geTsKICAgIGMgPSB4ICogLXNpbihCKSArIHogKiBjb3MoQik7CiAgICB4ID0gYTsKICAgIHkgPSBiOwogICAgeiA9IGM7CiAgICBhID0geCAqIGNvcyhDKSAtIHkgKiBzaW4oQyk7CiAgICBiID0geCAqIHNpbihDKSArIHkgKiBjb3MoQyk7CiAgICBjID0gejsKCiAgICByZXR1cm4gW2EsIGIsIGNdOwogIH0KCiAgdXBkYXRlKG94ID0gMCwgb3kgPSAwLCBzY2FsZSA9IDEsIHBoaSA9IC1QSSAvIDYpIHsKICAgIHRoaXMub2Zmc2V0ID0gbmV3IFBvaW50KG94LCBveSk7CiAgICB0aGlzLnNjYWxlID0gc2NhbGU7CiAgICB0aGlzLnBoaSA9IHBoaTsKICB9CgogIHByb2plY3QoeCwgeSwgeikgewogICAgY29uc3QgeyBvZmZzZXQsIHNjYWxlLCBwaGkgfSA9IHRoaXM7CiAgICB4ICo9IHNjYWxlOwogICAgeSAqPSBzY2FsZTsKICAgIHogKj0gc2NhbGU7CiAgICBbeCwgeSwgel0gPSB0aGlzLnJvdGF0ZSh4LCB5LCB6KTsKICAgIGNvbnN0IGEgPSB5LAogICAgICBiID0gLXosCiAgICAgIGMgPSAteCAvIDI7CgogICAgcmV0dXJuIG5ldyBQb2ludCgKICAgICAgb2Zmc2V0LnggKyBhICsgYyAqIGNvcyhwaGkpLAogICAgICBvZmZzZXQueSArIGIgKyBjICogc2luKHBoaSkKICAgICk7CiAgfQp9CgpsZXQgX19wcm9qZWN0b3IgPSBuZXcgQ2FiaW5ldFByb2plY3RvcigpOwo="),w=class extends E{static{f(this,"GraphicsElement")}handleAttributeChange(...e){}handleChildChanges(...e){}connectedCallback(){super.connectedCallback(),this.label=document.createElement("label"),this.title||(console.warn("<graphics-element> is missing a title attribute. Always caption your figures."),this.title=""),this.label.textContent=this.title,B(this)?this.loadSource():new IntersectionObserver((e,t)=>e.forEach(r=>{r.isIntersecting&&(this.loadSource(),t.disconnect())}),{threshold:.1,rootMargin:`${window.innerHeight}px`}).observe(this)}getStyle(){return`
:host([hidden]) { display: none; }
style { display: none; }
.top-title { display: flex; flex-direction: row; justify-content: space-between; }
canvas { touch-action: none; user-select: none; position: relative; z-index: 1; display: block; margin: auto; border-radius: 0; box-sizing: content-box !important; border: 1px solid lightgrey;
&.crisp { image-rendering: -moz-crisp-edges; image-rendering: -webkit-crisp-edges; image-rendering: pixelated; image-rendering: crisp-edges; }
&:focus { border: 1px solid red; }}
a { &.view-source { font-size: 60%; text-decoration: none;
&.plus { padding-left: 0.5em; }}}
button.reset { font-size: 0.5em; top: -0.35em; position: relative; }
label:not(:empty) { display: block; font-style: italic; font-size: 0.9em; text-align: right; padding-right: 1em; margin-top: 0.35em; }
`}async loadSource(e,t=this.width,r=this.height,$){if(!t&&!r&&(t=parseFloat(this.getAttribute("width")),r=parseFloat(this.getAttribute("height")),isNaN(t)&&(t=void 0),isNaN(r)&&(r=void 0)),e){if(typeof e=="function")return console.warn(".loadSource() called with a function rather than string data: use .loadFromFunction() instead."),this.loadFromFunction(e)}else if(this.userCode)e=this.userCode;else{let s=this.getAttribute("src");if(s)e=await(await fetch(s)).text();else{let o=this.querySelector("graphics-source");o?e=o.textContent:e=`function setup() {
}
function draw() {
}
`}}if(this.userCode=e,!$)if(this.additionalSources)$=this.additionalSources;else{let s=this.querySelectorAll("source");$=await Promise.all(Array.from(s).map(o=>fetch(o.src).then(g=>g.text())))}this.additionalSources=$;let x=this.userCode;this.additionalSources.length>0&&(x=this.loadAdditionalSources(this.userCode,this.additionalSources));let l=x.matchAll(/addSlider\(['"`](.*)['"`]/g),i=[];for(let s of l)i.push(s[1]),x=x.replace(s[0],s[0]+`, (v) => (${s[1]} = v)`);if(i.length&&(x="let "+i.join(", ")+`;
`+x),x=x.replaceAll(/ from ['"].([^'"]+)['"]/g,` from "${k(location.href)}/$1"`),x.includes("function setup()")||(x=`function setup() {
}
`+x),!x.includes("setSize(")){let s="setSize();";t&&r&&(s=`setSize(${t}, ${r});`),x=x.replace("function setup() {",`function setup() {
  ${s}`)}import(`data:text/javascript;base64,${S(['"use strict";',`import { BSpline, Point, Circle, Vector, Matrix, CSS_COLOR_MAP } from "${_}";`,`const __randomId = "${Date.now()}";`,W,x,"export { reset as start, __canvas as canvas, halt, highlight, __getDescription as getDescription }"].join(`
`))}`).then(async s=>{let{start:o,canvas:g,halt:c,highlight:b,getDescription:L}=s;this.canvas=g,this.halt=()=>c(),this.highlight=A=>b(A),this.render();let{width:u,height:d}=await o(this),m="graphics-element-description";this.querySelector(`.${m}`)?.remove(),this.querySelector("p")||this.handleGraphicsDescription(m,L),u&&d&&(this.style.width="",this.style.height="",this.width=u,this.height=d,this.setAttribute("width",u),this.setAttribute("height",d)),this.dispatchEvent(new CustomEvent("load")),this.onload&&this.onload()})}handleGraphicsDescription(e,t=()=>{}){try{let r=t();if(r){let $=new DocumentFragment,x=document.createElement("div");x.classList.add(e),$.append(x),x.innerHTML=r,this.append(x),this.crossLink(!0)}}catch(r){console.error(r)}}loadAdditionalSources(e,t){if(!t)return e;let r=new Array(t.length);return e+`
`+t.map(($,x)=>$.replace("function setup()",`function setup${x+1}()`).replace("function draw()",`function draw${x+1}()`)).join(`
`)+`
function __more_setup() { ${[...r].map(($,x)=>`if (typeof setup${x+1} !== \`undefined\`) setup${x+1}();`).join(`
`)} }
function __more_draw() { ${[...r].map(($,x)=>`if (typeof draw${x+1} !== \`undefined\`) draw${x+1}();`).join(`
`)} }
`}loadFromFunction(e){let t=e.toString();this.reset(t.substring(t.indexOf("{")+1,t.lastIndexOf("}")))}reset(e,t=[]){this.halt&&this.halt(),this.querySelector("button.remove-color")?.remove(),this.loadSource(e||this.userCode,this.width,this.height,t||this.additionalSources)}render(){super.render();let e=this._slot.parentNode;this.canvas&&e.insertBefore(this.canvas,this._slot),this.label&&e.insertBefore(this.label,this._slot);let t=document.createElement("div");t.classList.add("top-title");let r=document.createElement("span");r.classList.add("sources"),t.append(r);let $=document.createElement("button");$.classList.add("reset"),$.textContent=this.getAttribute("reset")||"reset",$.addEventListener("click",()=>this.reset()),t.append($);let x=this.getAttribute("src");if(x||(x=`data:text/plain;base64,${S(this.userCode)}`),x){let i=document.createElement("a");i.classList.add("view-source"),i.textContent=this.getAttribute("viewSource")||"view source",i.href=x,i.target="_blank",r.append(i),x.startsWith("data")&&(delete i.href,delete i.target,i.classList.add("fake-source-link"),i.addEventListener("click",()=>{let n=`<iframe width="100%" height="100%" src="${x}"></iframe>`,s=window.open(""),{document:o}=s;o.open(),o.write(n),o.write("<style>iframe { position: fixed; top: 0; right: 0; bottom: 0; left: 0; border:0; margin: 0; padding:0 }</style>"),o.close()}))}let l=this.querySelectorAll("source");l.length===0&&(l=(this.additionalSources??[]).map(i=>({src:`data:text/plain;base64,${S(i)}`}))),l.length&&l.forEach((i,n)=>{let{src:s}=i,o=document.createElement("a");o.classList.add("view-source","plus"),o.textContent=`[+${n+1}]`,o.href=s,o.target="_blank",r.append(o),s.startsWith("data")&&(delete o.href,delete o.target,o.classList.add("fake-source-link"),o.addEventListener("click",()=>{let g=`<iframe width="100%" height="100%" src="${s}"></iframe>`,c=window.open(""),{document:b}=c;b.open(),b.write(g),b.write("<style>iframe { position: fixed; top: 0; right: 0; bottom: 0; left: 0; border:0; margin: 0; padding:0 }</style>"),b.close()}))}),this.label&&e.insertBefore(t,this.canvas),this.crossLink()}crossLink(e){if(e&&(this.crossLinked=!1),this.crossLinked)return;this.crossLinked=!0;let t=!1;if(this.querySelectorAll("p").forEach(r=>{r.querySelectorAll("*").forEach($=>{if(!y.includes($.tagName))return;t=!0;let x;$.classList.remove("calm"),$.addEventListener("pointerenter",()=>{x??=getComputedStyle($)["-webkit-text-stroke-color"],this.highlight?.(x)}),$.addEventListener("pointerleave",()=>this.highlight?.(!1))})}),t){let r=document.createElement("button");r.textContent="remove colors",r.classList.add("remove-color"),r.addEventListener("click",()=>{this.querySelectorAll("p").forEach($=>{$.querySelectorAll("*").forEach(x=>{y.includes(x.tagName)&&x.classList.add("calm")})}),r.remove()}),this.append(r)}}},T=class extends E{static{f(this,"GraphicsSource")}constructor(){super(),this.style.display="none"}handleAttributeChange(){}handleChildChanges(){}};await E.register(w),await E.register(T);export{p as BSpline,v as CSS_COLOR_MAP,O as Circle,N as Matrix,R as Point,I as Vector};
